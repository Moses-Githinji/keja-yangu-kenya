<!DOCTYPE html>\n<html lang=\"en\">\n<head>\n    <meta charset=\"UTF-8\">\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\">\n    <title>Test Complete Authentication Flow</title>\n    <style>\n        body {\n            font-family: Arial, sans-serif;\n            max-width: 800px;\n            margin: 0 auto;\n            padding: 20px;\n        }\n        .test-section {\n            border: 1px solid #ddd;\n            padding: 15px;\n            margin: 10px 0;\n            border-radius: 5px;\n        }\n        .success {\n            background-color: #d4edda;\n            border-color: #c3e6cb;\n            color: #155724;\n        }\n        .error {\n            background-color: #f8d7da;\n            border-color: #f5c6cb;\n            color: #721c24;\n        }\n        .info {\n            background-color: #d1ecf1;\n            border-color: #bee5eb;\n            color: #0c5460;\n        }\n        button {\n            background: #007bff;\n            color: white;\n            border: none;\n            padding: 10px 15px;\n            margin: 5px;\n            border-radius: 3px;\n            cursor: pointer;\n        }\n        button:hover {\n            background: #0056b3;\n        }\n        pre {\n            background: #f8f9fa;\n            padding: 10px;\n            border-radius: 3px;\n            overflow-x: auto;\n        }\n    </style>\n</head>\n<body>\n    <h1>KejaYangu Authentication Test</h1>\n    <p>This page tests the complete authentication flow for the KejaYangu application.</p>\n\n    <div class=\"test-section\">\n        <h3>1. Clear Local Storage</h3>\n        <button onclick=\"clearStorage()\">Clear All Storage</button>\n        <div id=\"clear-result\"></div>\n    </div>\n\n    <div class=\"test-section\">\n        <h3>2. Test User Login</h3>\n        <p>Using test credentials: agent@example.com / Agent@123</p>\n        <button onclick=\"testLogin()\">Test Login</button>\n        <div id=\"login-result\"></div>\n    </div>\n\n    <div class=\"test-section\">\n        <h3>3. Test Profile Fetch</h3>\n        <button onclick=\"testProfile()\">Test Profile Fetch</button>\n        <div id=\"profile-result\"></div>\n    </div>\n\n    <div class=\"test-section\">\n        <h3>4. Test Invalid Token</h3>\n        <button onclick=\"testInvalidToken()\">Test with Invalid Token</button>\n        <div id=\"invalid-result\"></div>\n    </div>\n\n    <div class=\"test-section\">\n        <h3>5. Check Local Storage</h3>\n        <button onclick=\"checkStorage()\">Check Storage Contents</button>\n        <div id=\"storage-result\"></div>\n    </div>\n\n    <script>\n        const API_BASE = 'http://localhost:5000/api/v1';\n\n        function log(elementId, message, type = 'info') {\n            const element = document.getElementById(elementId);\n            element.className = `test-section ${type}`;\n            element.innerHTML = `<pre>${JSON.stringify(message, null, 2)}</pre>`;\n        }\n\n        async function clearStorage() {\n            localStorage.removeItem('accessToken');\n            localStorage.removeItem('refreshToken');\n            log('clear-result', 'Local storage cleared successfully', 'success');\n        }\n\n        async function testLogin() {\n            try {\n                const response = await fetch(`${API_BASE}/auth/login`, {\n                    method: 'POST',\n                    headers: {\n                        'Content-Type': 'application/json',\n                    },\n                    body: JSON.stringify({\n                        email: 'agent@example.com',\n                        password: 'Agent@123'\n                    })\n                });\n\n                const data = await response.json();\n                \n                if (response.ok) {\n                    // Store tokens\n                    localStorage.setItem('accessToken', data.data.accessToken);\n                    localStorage.setItem('refreshToken', data.data.refreshToken);\n                    log('login-result', {\n                        success: true,\n                        message: 'Login successful',\n                        user: data.data.user,\n                        tokensStored: true\n                    }, 'success');\n                } else {\n                    log('login-result', {\n                        success: false,\n                        status: response.status,\n                        error: data\n                    }, 'error');\n                }\n            } catch (error) {\n                log('login-result', {\n                    success: false,\n                    error: error.message\n                }, 'error');\n            }\n        }\n\n        async function testProfile() {\n            try {\n                const token = localStorage.getItem('accessToken');\n                if (!token) {\n                    log('profile-result', 'No access token found. Please login first.', 'error');\n                    return;\n                }\n\n                const response = await fetch(`${API_BASE}/users/profile`, {\n                    headers: {\n                        'Authorization': `Bearer ${token}`,\n                    }\n                });\n\n                const data = await response.json();\n                \n                if (response.ok) {\n                    log('profile-result', {\n                        success: true,\n                        message: 'Profile fetched successfully',\n                        user: data.data\n                    }, 'success');\n                } else {\n                    log('profile-result', {\n                        success: false,\n                        status: response.status,\n                        error: data\n                    }, 'error');\n                }\n            } catch (error) {\n                log('profile-result', {\n                    success: false,\n                    error: error.message\n                }, 'error');\n            }\n        }\n\n        async function testInvalidToken() {\n            try {\n                // Set an invalid token\n                localStorage.setItem('accessToken', 'invalid.token.here');\n\n                const response = await fetch(`${API_BASE}/users/profile`, {\n                    headers: {\n                        'Authorization': `Bearer invalid.token.here`,\n                    }\n                });\n\n                const data = await response.json();\n                \n                log('invalid-result', {\n                    status: response.status,\n                    error: data,\n                    expected: 'Should return 401 Unauthorized'\n                }, response.status === 401 ? 'success' : 'error');\n                \n                // Clean up\n                localStorage.removeItem('accessToken');\n            } catch (error) {\n                log('invalid-result', {\n                    success: false,\n                    error: error.message\n                }, 'error');\n            }\n        }\n\n        function checkStorage() {\n            const accessToken = localStorage.getItem('accessToken');\n            const refreshToken = localStorage.getItem('refreshToken');\n            \n            const storage = {\n                accessToken: accessToken ? `${accessToken.substring(0, 20)}...` : null,\n                refreshToken: refreshToken ? `${refreshToken.substring(0, 20)}...` : null,\n                hasAccessToken: !!accessToken,\n                hasRefreshToken: !!refreshToken\n            };\n            \n            log('storage-result', storage, 'info');\n        }\n\n        // Auto-run storage check on page load\n        window.onload = function() {\n            checkStorage();\n        };\n    </script>\n</body>\n</html>