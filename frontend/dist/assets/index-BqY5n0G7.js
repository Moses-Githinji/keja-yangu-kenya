var _9=Object.defineProperty;var Qk=e=>{throw TypeError(e)};var v9=(e,s,l)=>s in e?_9(e,s,{enumerable:!0,configurable:!0,writable:!0,value:l}):e[s]=l;var yb=(e,s,l)=>v9(e,typeof s!="symbol"?s+"":s,l),_T=(e,s,l)=>s.has(e)||Qk("Cannot "+l);var Qt=(e,s,l)=>(_T(e,s,"read from private field"),l?l.call(e):s.get(e)),Cr=(e,s,l)=>s.has(e)?Qk("Cannot add the same private member more than once"):s instanceof WeakSet?s.add(e):s.set(e,l),Fn=(e,s,l,d)=>(_T(e,s,"write to private field"),d?d.call(e,l):s.set(e,l),l),Vo=(e,s,l)=>(_T(e,s,"access private method"),l);var _b=(e,s,l,d)=>({set _(m){Fn(e,s,m,l)},get _(){return Qt(e,s,d)}});function b9(e,s){for(var l=0;l<s.length;l++){const d=s[l];if(typeof d!="string"&&!Array.isArray(d)){for(const m in d)if(m!=="default"&&!(m in e)){const _=Object.getOwnPropertyDescriptor(d,m);_&&Object.defineProperty(e,m,_.get?_:{enumerable:!0,get:()=>d[m]})}}}return Object.freeze(Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}))}(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const m of document.querySelectorAll('link[rel="modulepreload"]'))d(m);new MutationObserver(m=>{for(const _ of m)if(_.type==="childList")for(const w of _.addedNodes)w.tagName==="LINK"&&w.rel==="modulepreload"&&d(w)}).observe(document,{childList:!0,subtree:!0});function l(m){const _={};return m.integrity&&(_.integrity=m.integrity),m.referrerPolicy&&(_.referrerPolicy=m.referrerPolicy),m.crossOrigin==="use-credentials"?_.credentials="include":m.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function d(m){if(m.ep)return;m.ep=!0;const _=l(m);fetch(m.href,_)}})();var w9=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function bC(e){return e&&e.__esModule&&Object.prototype.hasOwnProperty.call(e,"default")?e.default:e}var K4={exports:{}},x2={},X4={exports:{}},hr={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var W0=Symbol.for("react.element"),S9=Symbol.for("react.portal"),j9=Symbol.for("react.fragment"),T9=Symbol.for("react.strict_mode"),N9=Symbol.for("react.profiler"),E9=Symbol.for("react.provider"),C9=Symbol.for("react.context"),A9=Symbol.for("react.forward_ref"),P9=Symbol.for("react.suspense"),I9=Symbol.for("react.memo"),M9=Symbol.for("react.lazy"),e3=Symbol.iterator;function R9(e){return e===null||typeof e!="object"?null:(e=e3&&e[e3]||e["@@iterator"],typeof e=="function"?e:null)}var Y4={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},J4=Object.assign,Q4={};function dx(e,s,l){this.props=e,this.context=s,this.refs=Q4,this.updater=l||Y4}dx.prototype.isReactComponent={};dx.prototype.setState=function(e,s){if(typeof e!="object"&&typeof e!="function"&&e!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,e,s,"setState")};dx.prototype.forceUpdate=function(e){this.updater.enqueueForceUpdate(this,e,"forceUpdate")};function ez(){}ez.prototype=dx.prototype;function wC(e,s,l){this.props=e,this.context=s,this.refs=Q4,this.updater=l||Y4}var SC=wC.prototype=new ez;SC.constructor=wC;J4(SC,dx.prototype);SC.isPureReactComponent=!0;var t3=Array.isArray,tz=Object.prototype.hasOwnProperty,jC={current:null},sz={key:!0,ref:!0,__self:!0,__source:!0};function nz(e,s,l){var d,m={},_=null,w=null;if(s!=null)for(d in s.ref!==void 0&&(w=s.ref),s.key!==void 0&&(_=""+s.key),s)tz.call(s,d)&&!sz.hasOwnProperty(d)&&(m[d]=s[d]);var o=arguments.length-2;if(o===1)m.children=l;else if(1<o){for(var E=Array(o),P=0;P<o;P++)E[P]=arguments[P+2];m.children=E}if(e&&e.defaultProps)for(d in o=e.defaultProps,o)m[d]===void 0&&(m[d]=o[d]);return{$$typeof:W0,type:e,key:_,ref:w,props:m,_owner:jC.current}}function k9(e,s){return{$$typeof:W0,type:e.type,key:s,ref:e.ref,props:e.props,_owner:e._owner}}function TC(e){return typeof e=="object"&&e!==null&&e.$$typeof===W0}function D9(e){var s={"=":"=0",":":"=2"};return"$"+e.replace(/[=:]/g,function(l){return s[l]})}var s3=/\/+/g;function vT(e,s){return typeof e=="object"&&e!==null&&e.key!=null?D9(""+e.key):s.toString(36)}function Yb(e,s,l,d,m){var _=typeof e;(_==="undefined"||_==="boolean")&&(e=null);var w=!1;if(e===null)w=!0;else switch(_){case"string":case"number":w=!0;break;case"object":switch(e.$$typeof){case W0:case S9:w=!0}}if(w)return w=e,m=m(w),e=d===""?"."+vT(w,0):d,t3(m)?(l="",e!=null&&(l=e.replace(s3,"$&/")+"/"),Yb(m,s,l,"",function(P){return P})):m!=null&&(TC(m)&&(m=k9(m,l+(!m.key||w&&w.key===m.key?"":(""+m.key).replace(s3,"$&/")+"/")+e)),s.push(m)),1;if(w=0,d=d===""?".":d+":",t3(e))for(var o=0;o<e.length;o++){_=e[o];var E=d+vT(_,o);w+=Yb(_,s,l,E,m)}else if(E=R9(e),typeof E=="function")for(e=E.call(e),o=0;!(_=e.next()).done;)_=_.value,E=d+vT(_,o++),w+=Yb(_,s,l,E,m);else if(_==="object")throw s=String(e),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(e).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return w}function vb(e,s,l){if(e==null)return e;var d=[],m=0;return Yb(e,d,"","",function(_){return s.call(l,_,m++)}),d}function L9(e){if(e._status===-1){var s=e._result;s=s(),s.then(function(l){(e._status===0||e._status===-1)&&(e._status=1,e._result=l)},function(l){(e._status===0||e._status===-1)&&(e._status=2,e._result=l)}),e._status===-1&&(e._status=0,e._result=s)}if(e._status===1)return e._result.default;throw e._result}var xa={current:null},Jb={transition:null},z9={ReactCurrentDispatcher:xa,ReactCurrentBatchConfig:Jb,ReactCurrentOwner:jC};function rz(){throw Error("act(...) is not supported in production builds of React.")}hr.Children={map:vb,forEach:function(e,s,l){vb(e,function(){s.apply(this,arguments)},l)},count:function(e){var s=0;return vb(e,function(){s++}),s},toArray:function(e){return vb(e,function(s){return s})||[]},only:function(e){if(!TC(e))throw Error("React.Children.only expected to receive a single React element child.");return e}};hr.Component=dx;hr.Fragment=j9;hr.Profiler=N9;hr.PureComponent=wC;hr.StrictMode=T9;hr.Suspense=P9;hr.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=z9;hr.act=rz;hr.cloneElement=function(e,s,l){if(e==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+e+".");var d=J4({},e.props),m=e.key,_=e.ref,w=e._owner;if(s!=null){if(s.ref!==void 0&&(_=s.ref,w=jC.current),s.key!==void 0&&(m=""+s.key),e.type&&e.type.defaultProps)var o=e.type.defaultProps;for(E in s)tz.call(s,E)&&!sz.hasOwnProperty(E)&&(d[E]=s[E]===void 0&&o!==void 0?o[E]:s[E])}var E=arguments.length-2;if(E===1)d.children=l;else if(1<E){o=Array(E);for(var P=0;P<E;P++)o[P]=arguments[P+2];d.children=o}return{$$typeof:W0,type:e.type,key:m,ref:_,props:d,_owner:w}};hr.createContext=function(e){return e={$$typeof:C9,_currentValue:e,_currentValue2:e,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},e.Provider={$$typeof:E9,_context:e},e.Consumer=e};hr.createElement=nz;hr.createFactory=function(e){var s=nz.bind(null,e);return s.type=e,s};hr.createRef=function(){return{current:null}};hr.forwardRef=function(e){return{$$typeof:A9,render:e}};hr.isValidElement=TC;hr.lazy=function(e){return{$$typeof:M9,_payload:{_status:-1,_result:e},_init:L9}};hr.memo=function(e,s){return{$$typeof:I9,type:e,compare:s===void 0?null:s}};hr.startTransition=function(e){var s=Jb.transition;Jb.transition={};try{e()}finally{Jb.transition=s}};hr.unstable_act=rz;hr.useCallback=function(e,s){return xa.current.useCallback(e,s)};hr.useContext=function(e){return xa.current.useContext(e)};hr.useDebugValue=function(){};hr.useDeferredValue=function(e){return xa.current.useDeferredValue(e)};hr.useEffect=function(e,s){return xa.current.useEffect(e,s)};hr.useId=function(){return xa.current.useId()};hr.useImperativeHandle=function(e,s,l){return xa.current.useImperativeHandle(e,s,l)};hr.useInsertionEffect=function(e,s){return xa.current.useInsertionEffect(e,s)};hr.useLayoutEffect=function(e,s){return xa.current.useLayoutEffect(e,s)};hr.useMemo=function(e,s){return xa.current.useMemo(e,s)};hr.useReducer=function(e,s,l){return xa.current.useReducer(e,s,l)};hr.useRef=function(e){return xa.current.useRef(e)};hr.useState=function(e){return xa.current.useState(e)};hr.useSyncExternalStore=function(e,s,l){return xa.current.useSyncExternalStore(e,s,l)};hr.useTransition=function(){return xa.current.useTransition()};hr.version="18.3.1";X4.exports=hr;var z=X4.exports;const vs=bC(z),NC=b9({__proto__:null,default:vs},[z]);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O9=z,F9=Symbol.for("react.element"),B9=Symbol.for("react.fragment"),V9=Object.prototype.hasOwnProperty,U9=O9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,$9={key:!0,ref:!0,__self:!0,__source:!0};function iz(e,s,l){var d,m={},_=null,w=null;l!==void 0&&(_=""+l),s.key!==void 0&&(_=""+s.key),s.ref!==void 0&&(w=s.ref);for(d in s)V9.call(s,d)&&!$9.hasOwnProperty(d)&&(m[d]=s[d]);if(e&&e.defaultProps)for(d in s=e.defaultProps,s)m[d]===void 0&&(m[d]=s[d]);return{$$typeof:F9,type:e,key:_,ref:w,props:m,_owner:U9.current}}x2.Fragment=B9;x2.jsx=iz;x2.jsxs=iz;K4.exports=x2;var n=K4.exports,oz={exports:{}},ul={},az={exports:{}},lz={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(e){function s(ze,Xe){var Ot=ze.length;ze.push(Xe);e:for(;0<Ot;){var nt=Ot-1>>>1,Mt=ze[nt];if(0<m(Mt,Xe))ze[nt]=Xe,ze[Ot]=Mt,Ot=nt;else break e}}function l(ze){return ze.length===0?null:ze[0]}function d(ze){if(ze.length===0)return null;var Xe=ze[0],Ot=ze.pop();if(Ot!==Xe){ze[0]=Ot;e:for(var nt=0,Mt=ze.length,ss=Mt>>>1;nt<ss;){var Ps=2*(nt+1)-1,xn=ze[Ps],Ms=Ps+1,Xt=ze[Ms];if(0>m(xn,Ot))Ms<Mt&&0>m(Xt,xn)?(ze[nt]=Xt,ze[Ms]=Ot,nt=Ms):(ze[nt]=xn,ze[Ps]=Ot,nt=Ps);else if(Ms<Mt&&0>m(Xt,Ot))ze[nt]=Xt,ze[Ms]=Ot,nt=Ms;else break e}}return Xe}function m(ze,Xe){var Ot=ze.sortIndex-Xe.sortIndex;return Ot!==0?Ot:ze.id-Xe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;e.unstable_now=function(){return _.now()}}else{var w=Date,o=w.now();e.unstable_now=function(){return w.now()-o}}var E=[],P=[],M=1,L=null,F=3,$=!1,Y=!1,H=!1,X=typeof setTimeout=="function"?setTimeout:null,Z=typeof clearTimeout=="function"?clearTimeout:null,W=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(ze){for(var Xe=l(P);Xe!==null;){if(Xe.callback===null)d(P);else if(Xe.startTime<=ze)d(P),Xe.sortIndex=Xe.expirationTime,s(E,Xe);else break;Xe=l(P)}}function oe(ze){if(H=!1,q(ze),!Y)if(l(E)!==null)Y=!0,Vt(ae);else{var Xe=l(P);Xe!==null&&Bt(oe,Xe.startTime-ze)}}function ae(ze,Xe){Y=!1,H&&(H=!1,Z(Le),Le=-1),$=!0;var Ot=F;try{for(q(Xe),L=l(E);L!==null&&(!(L.expirationTime>Xe)||ze&&!yt());){var nt=L.callback;if(typeof nt=="function"){L.callback=null,F=L.priorityLevel;var Mt=nt(L.expirationTime<=Xe);Xe=e.unstable_now(),typeof Mt=="function"?L.callback=Mt:L===l(E)&&d(E),q(Xe)}else d(E);L=l(E)}if(L!==null)var ss=!0;else{var Ps=l(P);Ps!==null&&Bt(oe,Ps.startTime-Xe),ss=!1}return ss}finally{L=null,F=Ot,$=!1}}var Ne=!1,Pe=null,Le=-1,ct=5,xt=-1;function yt(){return!(e.unstable_now()-xt<ct)}function Ht(){if(Pe!==null){var ze=e.unstable_now();xt=ze;var Xe=!0;try{Xe=Pe(!0,ze)}finally{Xe?Dt():(Ne=!1,Pe=null)}}else Ne=!1}var Dt;if(typeof W=="function")Dt=function(){W(Ht)};else if(typeof MessageChannel<"u"){var wt=new MessageChannel,rs=wt.port2;wt.port1.onmessage=Ht,Dt=function(){rs.postMessage(null)}}else Dt=function(){X(Ht,0)};function Vt(ze){Pe=ze,Ne||(Ne=!0,Dt())}function Bt(ze,Xe){Le=X(function(){ze(e.unstable_now())},Xe)}e.unstable_IdlePriority=5,e.unstable_ImmediatePriority=1,e.unstable_LowPriority=4,e.unstable_NormalPriority=3,e.unstable_Profiling=null,e.unstable_UserBlockingPriority=2,e.unstable_cancelCallback=function(ze){ze.callback=null},e.unstable_continueExecution=function(){Y||$||(Y=!0,Vt(ae))},e.unstable_forceFrameRate=function(ze){0>ze||125<ze?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):ct=0<ze?Math.floor(1e3/ze):5},e.unstable_getCurrentPriorityLevel=function(){return F},e.unstable_getFirstCallbackNode=function(){return l(E)},e.unstable_next=function(ze){switch(F){case 1:case 2:case 3:var Xe=3;break;default:Xe=F}var Ot=F;F=Xe;try{return ze()}finally{F=Ot}},e.unstable_pauseExecution=function(){},e.unstable_requestPaint=function(){},e.unstable_runWithPriority=function(ze,Xe){switch(ze){case 1:case 2:case 3:case 4:case 5:break;default:ze=3}var Ot=F;F=ze;try{return Xe()}finally{F=Ot}},e.unstable_scheduleCallback=function(ze,Xe,Ot){var nt=e.unstable_now();switch(typeof Ot=="object"&&Ot!==null?(Ot=Ot.delay,Ot=typeof Ot=="number"&&0<Ot?nt+Ot:nt):Ot=nt,ze){case 1:var Mt=-1;break;case 2:Mt=250;break;case 5:Mt=1073741823;break;case 4:Mt=1e4;break;default:Mt=5e3}return Mt=Ot+Mt,ze={id:M++,callback:Xe,priorityLevel:ze,startTime:Ot,expirationTime:Mt,sortIndex:-1},Ot>nt?(ze.sortIndex=Ot,s(P,ze),l(E)===null&&ze===l(P)&&(H?(Z(Le),Le=-1):H=!0,Bt(oe,Ot-nt))):(ze.sortIndex=Mt,s(E,ze),Y||$||(Y=!0,Vt(ae))),ze},e.unstable_shouldYield=yt,e.unstable_wrapCallback=function(ze){var Xe=F;return function(){var Ot=F;F=Xe;try{return ze.apply(this,arguments)}finally{F=Ot}}}})(lz);az.exports=lz;var G9=az.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var H9=z,nl=G9;function ms(e){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+e,l=1;l<arguments.length;l++)s+="&args[]="+encodeURIComponent(arguments[l]);return"Minified React error #"+e+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var cz=new Set,u0={};function Tf(e,s){qg(e,s),qg(e+"Capture",s)}function qg(e,s){for(u0[e]=s,e=0;e<s.length;e++)cz.add(s[e])}var qu=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),AN=Object.prototype.hasOwnProperty,W9=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,n3={},r3={};function q9(e){return AN.call(r3,e)?!0:AN.call(n3,e)?!1:W9.test(e)?r3[e]=!0:(n3[e]=!0,!1)}function Z9(e,s,l,d){if(l!==null&&l.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return d?!1:l!==null?!l.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function K9(e,s,l,d){if(s===null||typeof s>"u"||Z9(e,s,l,d))return!0;if(d)return!1;if(l!==null)switch(l.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function ya(e,s,l,d,m,_,w){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=d,this.attributeNamespace=m,this.mustUseProperty=l,this.propertyName=e,this.type=s,this.sanitizeURL=_,this.removeEmptyString=w}var ko={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){ko[e]=new ya(e,0,!1,e,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var s=e[0];ko[s]=new ya(s,1,!1,e[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(e){ko[e]=new ya(e,2,!1,e.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){ko[e]=new ya(e,2,!1,e,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){ko[e]=new ya(e,3,!1,e.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(e){ko[e]=new ya(e,3,!0,e,null,!1,!1)});["capture","download"].forEach(function(e){ko[e]=new ya(e,4,!1,e,null,!1,!1)});["cols","rows","size","span"].forEach(function(e){ko[e]=new ya(e,6,!1,e,null,!1,!1)});["rowSpan","start"].forEach(function(e){ko[e]=new ya(e,5,!1,e.toLowerCase(),null,!1,!1)});var EC=/[\-:]([a-z])/g;function CC(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var s=e.replace(EC,CC);ko[s]=new ya(s,1,!1,e,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var s=e.replace(EC,CC);ko[s]=new ya(s,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(e){var s=e.replace(EC,CC);ko[s]=new ya(s,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(e){ko[e]=new ya(e,1,!1,e.toLowerCase(),null,!1,!1)});ko.xlinkHref=new ya("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(e){ko[e]=new ya(e,1,!1,e.toLowerCase(),null,!0,!0)});function AC(e,s,l,d){var m=ko.hasOwnProperty(s)?ko[s]:null;(m!==null?m.type!==0:d||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(K9(s,l,m,d)&&(l=null),d||m===null?q9(s)&&(l===null?e.removeAttribute(s):e.setAttribute(s,""+l)):m.mustUseProperty?e[m.propertyName]=l===null?m.type===3?!1:"":l:(s=m.attributeName,d=m.attributeNamespace,l===null?e.removeAttribute(s):(m=m.type,l=m===3||m===4&&l===!0?"":""+l,d?e.setAttributeNS(d,s,l):e.setAttribute(s,l))))}var id=H9.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,bb=Symbol.for("react.element"),ag=Symbol.for("react.portal"),lg=Symbol.for("react.fragment"),PC=Symbol.for("react.strict_mode"),PN=Symbol.for("react.profiler"),uz=Symbol.for("react.provider"),dz=Symbol.for("react.context"),IC=Symbol.for("react.forward_ref"),IN=Symbol.for("react.suspense"),MN=Symbol.for("react.suspense_list"),MC=Symbol.for("react.memo"),ih=Symbol.for("react.lazy"),hz=Symbol.for("react.offscreen"),i3=Symbol.iterator;function P_(e){return e===null||typeof e!="object"?null:(e=i3&&e[i3]||e["@@iterator"],typeof e=="function"?e:null)}var fi=Object.assign,bT;function U_(e){if(bT===void 0)try{throw Error()}catch(l){var s=l.stack.trim().match(/\n( *(at )?)/);bT=s&&s[1]||""}return`
`+bT+e}var wT=!1;function ST(e,s){if(!e||wT)return"";wT=!0;var l=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(P){var d=P}Reflect.construct(e,[],s)}else{try{s.call()}catch(P){d=P}e.call(s.prototype)}else{try{throw Error()}catch(P){d=P}e()}}catch(P){if(P&&d&&typeof P.stack=="string"){for(var m=P.stack.split(`
`),_=d.stack.split(`
`),w=m.length-1,o=_.length-1;1<=w&&0<=o&&m[w]!==_[o];)o--;for(;1<=w&&0<=o;w--,o--)if(m[w]!==_[o]){if(w!==1||o!==1)do if(w--,o--,0>o||m[w]!==_[o]){var E=`
`+m[w].replace(" at new "," at ");return e.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",e.displayName)),E}while(1<=w&&0<=o);break}}}finally{wT=!1,Error.prepareStackTrace=l}return(e=e?e.displayName||e.name:"")?U_(e):""}function X9(e){switch(e.tag){case 5:return U_(e.type);case 16:return U_("Lazy");case 13:return U_("Suspense");case 19:return U_("SuspenseList");case 0:case 2:case 15:return e=ST(e.type,!1),e;case 11:return e=ST(e.type.render,!1),e;case 1:return e=ST(e.type,!0),e;default:return""}}function RN(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case lg:return"Fragment";case ag:return"Portal";case PN:return"Profiler";case PC:return"StrictMode";case IN:return"Suspense";case MN:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case dz:return(e.displayName||"Context")+".Consumer";case uz:return(e._context.displayName||"Context")+".Provider";case IC:var s=e.render;return e=e.displayName,e||(e=s.displayName||s.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case MC:return s=e.displayName||null,s!==null?s:RN(e.type)||"Memo";case ih:s=e._payload,e=e._init;try{return RN(e(s))}catch{}}return null}function Y9(e){var s=e.type;switch(e.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=s.render,e=e.displayName||e.name||"",s.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return RN(s);case 8:return s===PC?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Ah(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function pz(e){var s=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function J9(e){var s=pz(e)?"checked":"value",l=Object.getOwnPropertyDescriptor(e.constructor.prototype,s),d=""+e[s];if(!e.hasOwnProperty(s)&&typeof l<"u"&&typeof l.get=="function"&&typeof l.set=="function"){var m=l.get,_=l.set;return Object.defineProperty(e,s,{configurable:!0,get:function(){return m.call(this)},set:function(w){d=""+w,_.call(this,w)}}),Object.defineProperty(e,s,{enumerable:l.enumerable}),{getValue:function(){return d},setValue:function(w){d=""+w},stopTracking:function(){e._valueTracker=null,delete e[s]}}}}function wb(e){e._valueTracker||(e._valueTracker=J9(e))}function fz(e){if(!e)return!1;var s=e._valueTracker;if(!s)return!0;var l=s.getValue(),d="";return e&&(d=pz(e)?e.checked?"true":"false":e.value),e=d,e!==l?(s.setValue(e),!0):!1}function bw(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function kN(e,s){var l=s.checked;return fi({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:l??e._wrapperState.initialChecked})}function o3(e,s){var l=s.defaultValue==null?"":s.defaultValue,d=s.checked!=null?s.checked:s.defaultChecked;l=Ah(s.value!=null?s.value:l),e._wrapperState={initialChecked:d,initialValue:l,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function mz(e,s){s=s.checked,s!=null&&AC(e,"checked",s,!1)}function DN(e,s){mz(e,s);var l=Ah(s.value),d=s.type;if(l!=null)d==="number"?(l===0&&e.value===""||e.value!=l)&&(e.value=""+l):e.value!==""+l&&(e.value=""+l);else if(d==="submit"||d==="reset"){e.removeAttribute("value");return}s.hasOwnProperty("value")?LN(e,s.type,l):s.hasOwnProperty("defaultValue")&&LN(e,s.type,Ah(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(e.defaultChecked=!!s.defaultChecked)}function a3(e,s,l){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var d=s.type;if(!(d!=="submit"&&d!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+e._wrapperState.initialValue,l||s===e.value||(e.value=s),e.defaultValue=s}l=e.name,l!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,l!==""&&(e.name=l)}function LN(e,s,l){(s!=="number"||bw(e.ownerDocument)!==e)&&(l==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+l&&(e.defaultValue=""+l))}var $_=Array.isArray;function Ng(e,s,l,d){if(e=e.options,s){s={};for(var m=0;m<l.length;m++)s["$"+l[m]]=!0;for(l=0;l<e.length;l++)m=s.hasOwnProperty("$"+e[l].value),e[l].selected!==m&&(e[l].selected=m),m&&d&&(e[l].defaultSelected=!0)}else{for(l=""+Ah(l),s=null,m=0;m<e.length;m++){if(e[m].value===l){e[m].selected=!0,d&&(e[m].defaultSelected=!0);return}s!==null||e[m].disabled||(s=e[m])}s!==null&&(s.selected=!0)}}function zN(e,s){if(s.dangerouslySetInnerHTML!=null)throw Error(ms(91));return fi({},s,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function l3(e,s){var l=s.value;if(l==null){if(l=s.children,s=s.defaultValue,l!=null){if(s!=null)throw Error(ms(92));if($_(l)){if(1<l.length)throw Error(ms(93));l=l[0]}s=l}s==null&&(s=""),l=s}e._wrapperState={initialValue:Ah(l)}}function gz(e,s){var l=Ah(s.value),d=Ah(s.defaultValue);l!=null&&(l=""+l,l!==e.value&&(e.value=l),s.defaultValue==null&&e.defaultValue!==l&&(e.defaultValue=l)),d!=null&&(e.defaultValue=""+d)}function c3(e){var s=e.textContent;s===e._wrapperState.initialValue&&s!==""&&s!==null&&(e.value=s)}function xz(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ON(e,s){return e==null||e==="http://www.w3.org/1999/xhtml"?xz(s):e==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var Sb,yz=function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,l,d,m){MSApp.execUnsafeLocalFunction(function(){return e(s,l,d,m)})}:e}(function(e,s){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=s;else{for(Sb=Sb||document.createElement("div"),Sb.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=Sb.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;s.firstChild;)e.appendChild(s.firstChild)}});function d0(e,s){if(s){var l=e.firstChild;if(l&&l===e.lastChild&&l.nodeType===3){l.nodeValue=s;return}}e.textContent=s}var K_={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Q9=["Webkit","ms","Moz","O"];Object.keys(K_).forEach(function(e){Q9.forEach(function(s){s=s+e.charAt(0).toUpperCase()+e.substring(1),K_[s]=K_[e]})});function _z(e,s,l){return s==null||typeof s=="boolean"||s===""?"":l||typeof s!="number"||s===0||K_.hasOwnProperty(e)&&K_[e]?(""+s).trim():s+"px"}function vz(e,s){e=e.style;for(var l in s)if(s.hasOwnProperty(l)){var d=l.indexOf("--")===0,m=_z(l,s[l],d);l==="float"&&(l="cssFloat"),d?e.setProperty(l,m):e[l]=m}}var eW=fi({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function FN(e,s){if(s){if(eW[e]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(ms(137,e));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(ms(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(ms(61))}if(s.style!=null&&typeof s.style!="object")throw Error(ms(62))}}function BN(e,s){if(e.indexOf("-")===-1)return typeof s.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var VN=null;function RC(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var UN=null,Eg=null,Cg=null;function u3(e){if(e=K0(e)){if(typeof UN!="function")throw Error(ms(280));var s=e.stateNode;s&&(s=w2(s),UN(e.stateNode,e.type,s))}}function bz(e){Eg?Cg?Cg.push(e):Cg=[e]:Eg=e}function wz(){if(Eg){var e=Eg,s=Cg;if(Cg=Eg=null,u3(e),s)for(e=0;e<s.length;e++)u3(s[e])}}function Sz(e,s){return e(s)}function jz(){}var jT=!1;function Tz(e,s,l){if(jT)return e(s,l);jT=!0;try{return Sz(e,s,l)}finally{jT=!1,(Eg!==null||Cg!==null)&&(jz(),wz())}}function h0(e,s){var l=e.stateNode;if(l===null)return null;var d=w2(l);if(d===null)return null;l=d[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(d=!d.disabled)||(e=e.type,d=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!d;break e;default:e=!1}if(e)return null;if(l&&typeof l!="function")throw Error(ms(231,s,typeof l));return l}var $N=!1;if(qu)try{var I_={};Object.defineProperty(I_,"passive",{get:function(){$N=!0}}),window.addEventListener("test",I_,I_),window.removeEventListener("test",I_,I_)}catch{$N=!1}function tW(e,s,l,d,m,_,w,o,E){var P=Array.prototype.slice.call(arguments,3);try{s.apply(l,P)}catch(M){this.onError(M)}}var X_=!1,ww=null,Sw=!1,GN=null,sW={onError:function(e){X_=!0,ww=e}};function nW(e,s,l,d,m,_,w,o,E){X_=!1,ww=null,tW.apply(sW,arguments)}function rW(e,s,l,d,m,_,w,o,E){if(nW.apply(this,arguments),X_){if(X_){var P=ww;X_=!1,ww=null}else throw Error(ms(198));Sw||(Sw=!0,GN=P)}}function Nf(e){var s=e,l=e;if(e.alternate)for(;s.return;)s=s.return;else{e=s;do s=e,s.flags&4098&&(l=s.return),e=s.return;while(e)}return s.tag===3?l:null}function Nz(e){if(e.tag===13){var s=e.memoizedState;if(s===null&&(e=e.alternate,e!==null&&(s=e.memoizedState)),s!==null)return s.dehydrated}return null}function d3(e){if(Nf(e)!==e)throw Error(ms(188))}function iW(e){var s=e.alternate;if(!s){if(s=Nf(e),s===null)throw Error(ms(188));return s!==e?null:e}for(var l=e,d=s;;){var m=l.return;if(m===null)break;var _=m.alternate;if(_===null){if(d=m.return,d!==null){l=d;continue}break}if(m.child===_.child){for(_=m.child;_;){if(_===l)return d3(m),e;if(_===d)return d3(m),s;_=_.sibling}throw Error(ms(188))}if(l.return!==d.return)l=m,d=_;else{for(var w=!1,o=m.child;o;){if(o===l){w=!0,l=m,d=_;break}if(o===d){w=!0,d=m,l=_;break}o=o.sibling}if(!w){for(o=_.child;o;){if(o===l){w=!0,l=_,d=m;break}if(o===d){w=!0,d=_,l=m;break}o=o.sibling}if(!w)throw Error(ms(189))}}if(l.alternate!==d)throw Error(ms(190))}if(l.tag!==3)throw Error(ms(188));return l.stateNode.current===l?e:s}function Ez(e){return e=iW(e),e!==null?Cz(e):null}function Cz(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var s=Cz(e);if(s!==null)return s;e=e.sibling}return null}var Az=nl.unstable_scheduleCallback,h3=nl.unstable_cancelCallback,oW=nl.unstable_shouldYield,aW=nl.unstable_requestPaint,ki=nl.unstable_now,lW=nl.unstable_getCurrentPriorityLevel,kC=nl.unstable_ImmediatePriority,Pz=nl.unstable_UserBlockingPriority,jw=nl.unstable_NormalPriority,cW=nl.unstable_LowPriority,Iz=nl.unstable_IdlePriority,y2=null,Yc=null;function uW(e){if(Yc&&typeof Yc.onCommitFiberRoot=="function")try{Yc.onCommitFiberRoot(y2,e,void 0,(e.current.flags&128)===128)}catch{}}var sc=Math.clz32?Math.clz32:pW,dW=Math.log,hW=Math.LN2;function pW(e){return e>>>=0,e===0?32:31-(dW(e)/hW|0)|0}var jb=64,Tb=4194304;function G_(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function Tw(e,s){var l=e.pendingLanes;if(l===0)return 0;var d=0,m=e.suspendedLanes,_=e.pingedLanes,w=l&268435455;if(w!==0){var o=w&~m;o!==0?d=G_(o):(_&=w,_!==0&&(d=G_(_)))}else w=l&~m,w!==0?d=G_(w):_!==0&&(d=G_(_));if(d===0)return 0;if(s!==0&&s!==d&&!(s&m)&&(m=d&-d,_=s&-s,m>=_||m===16&&(_&4194240)!==0))return s;if(d&4&&(d|=l&16),s=e.entangledLanes,s!==0)for(e=e.entanglements,s&=d;0<s;)l=31-sc(s),m=1<<l,d|=e[l],s&=~m;return d}function fW(e,s){switch(e){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function mW(e,s){for(var l=e.suspendedLanes,d=e.pingedLanes,m=e.expirationTimes,_=e.pendingLanes;0<_;){var w=31-sc(_),o=1<<w,E=m[w];E===-1?(!(o&l)||o&d)&&(m[w]=fW(o,s)):E<=s&&(e.expiredLanes|=o),_&=~o}}function HN(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function Mz(){var e=jb;return jb<<=1,!(jb&4194240)&&(jb=64),e}function TT(e){for(var s=[],l=0;31>l;l++)s.push(e);return s}function q0(e,s,l){e.pendingLanes|=s,s!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,s=31-sc(s),e[s]=l}function gW(e,s){var l=e.pendingLanes&~s;e.pendingLanes=s,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=s,e.mutableReadLanes&=s,e.entangledLanes&=s,s=e.entanglements;var d=e.eventTimes;for(e=e.expirationTimes;0<l;){var m=31-sc(l),_=1<<m;s[m]=0,d[m]=-1,e[m]=-1,l&=~_}}function DC(e,s){var l=e.entangledLanes|=s;for(e=e.entanglements;l;){var d=31-sc(l),m=1<<d;m&s|e[d]&s&&(e[d]|=s),l&=~m}}var Fr=0;function Rz(e){return e&=-e,1<e?4<e?e&268435455?16:536870912:4:1}var kz,LC,Dz,Lz,zz,WN=!1,Nb=[],yh=null,_h=null,vh=null,p0=new Map,f0=new Map,ah=[],xW="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function p3(e,s){switch(e){case"focusin":case"focusout":yh=null;break;case"dragenter":case"dragleave":_h=null;break;case"mouseover":case"mouseout":vh=null;break;case"pointerover":case"pointerout":p0.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":f0.delete(s.pointerId)}}function M_(e,s,l,d,m,_){return e===null||e.nativeEvent!==_?(e={blockedOn:s,domEventName:l,eventSystemFlags:d,nativeEvent:_,targetContainers:[m]},s!==null&&(s=K0(s),s!==null&&LC(s)),e):(e.eventSystemFlags|=d,s=e.targetContainers,m!==null&&s.indexOf(m)===-1&&s.push(m),e)}function yW(e,s,l,d,m){switch(s){case"focusin":return yh=M_(yh,e,s,l,d,m),!0;case"dragenter":return _h=M_(_h,e,s,l,d,m),!0;case"mouseover":return vh=M_(vh,e,s,l,d,m),!0;case"pointerover":var _=m.pointerId;return p0.set(_,M_(p0.get(_)||null,e,s,l,d,m)),!0;case"gotpointercapture":return _=m.pointerId,f0.set(_,M_(f0.get(_)||null,e,s,l,d,m)),!0}return!1}function Oz(e){var s=Zp(e.target);if(s!==null){var l=Nf(s);if(l!==null){if(s=l.tag,s===13){if(s=Nz(l),s!==null){e.blockedOn=s,zz(e.priority,function(){Dz(l)});return}}else if(s===3&&l.stateNode.current.memoizedState.isDehydrated){e.blockedOn=l.tag===3?l.stateNode.containerInfo:null;return}}}e.blockedOn=null}function Qb(e){if(e.blockedOn!==null)return!1;for(var s=e.targetContainers;0<s.length;){var l=qN(e.domEventName,e.eventSystemFlags,s[0],e.nativeEvent);if(l===null){l=e.nativeEvent;var d=new l.constructor(l.type,l);VN=d,l.target.dispatchEvent(d),VN=null}else return s=K0(l),s!==null&&LC(s),e.blockedOn=l,!1;s.shift()}return!0}function f3(e,s,l){Qb(e)&&l.delete(s)}function _W(){WN=!1,yh!==null&&Qb(yh)&&(yh=null),_h!==null&&Qb(_h)&&(_h=null),vh!==null&&Qb(vh)&&(vh=null),p0.forEach(f3),f0.forEach(f3)}function R_(e,s){e.blockedOn===s&&(e.blockedOn=null,WN||(WN=!0,nl.unstable_scheduleCallback(nl.unstable_NormalPriority,_W)))}function m0(e){function s(m){return R_(m,e)}if(0<Nb.length){R_(Nb[0],e);for(var l=1;l<Nb.length;l++){var d=Nb[l];d.blockedOn===e&&(d.blockedOn=null)}}for(yh!==null&&R_(yh,e),_h!==null&&R_(_h,e),vh!==null&&R_(vh,e),p0.forEach(s),f0.forEach(s),l=0;l<ah.length;l++)d=ah[l],d.blockedOn===e&&(d.blockedOn=null);for(;0<ah.length&&(l=ah[0],l.blockedOn===null);)Oz(l),l.blockedOn===null&&ah.shift()}var Ag=id.ReactCurrentBatchConfig,Nw=!0;function vW(e,s,l,d){var m=Fr,_=Ag.transition;Ag.transition=null;try{Fr=1,zC(e,s,l,d)}finally{Fr=m,Ag.transition=_}}function bW(e,s,l,d){var m=Fr,_=Ag.transition;Ag.transition=null;try{Fr=4,zC(e,s,l,d)}finally{Fr=m,Ag.transition=_}}function zC(e,s,l,d){if(Nw){var m=qN(e,s,l,d);if(m===null)DT(e,s,d,Ew,l),p3(e,d);else if(yW(m,e,s,l,d))d.stopPropagation();else if(p3(e,d),s&4&&-1<xW.indexOf(e)){for(;m!==null;){var _=K0(m);if(_!==null&&kz(_),_=qN(e,s,l,d),_===null&&DT(e,s,d,Ew,l),_===m)break;m=_}m!==null&&d.stopPropagation()}else DT(e,s,d,null,l)}}var Ew=null;function qN(e,s,l,d){if(Ew=null,e=RC(d),e=Zp(e),e!==null)if(s=Nf(e),s===null)e=null;else if(l=s.tag,l===13){if(e=Nz(s),e!==null)return e;e=null}else if(l===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;e=null}else s!==e&&(e=null);return Ew=e,null}function Fz(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(lW()){case kC:return 1;case Pz:return 4;case jw:case cW:return 16;case Iz:return 536870912;default:return 16}default:return 16}}var fh=null,OC=null,ew=null;function Bz(){if(ew)return ew;var e,s=OC,l=s.length,d,m="value"in fh?fh.value:fh.textContent,_=m.length;for(e=0;e<l&&s[e]===m[e];e++);var w=l-e;for(d=1;d<=w&&s[l-d]===m[_-d];d++);return ew=m.slice(e,1<d?1-d:void 0)}function tw(e){var s=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&s===13&&(e=13)):e=s,e===10&&(e=13),32<=e||e===13?e:0}function Eb(){return!0}function m3(){return!1}function dl(e){function s(l,d,m,_,w){this._reactName=l,this._targetInst=m,this.type=d,this.nativeEvent=_,this.target=w,this.currentTarget=null;for(var o in e)e.hasOwnProperty(o)&&(l=e[o],this[o]=l?l(_):_[o]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?Eb:m3,this.isPropagationStopped=m3,this}return fi(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var l=this.nativeEvent;l&&(l.preventDefault?l.preventDefault():typeof l.returnValue!="unknown"&&(l.returnValue=!1),this.isDefaultPrevented=Eb)},stopPropagation:function(){var l=this.nativeEvent;l&&(l.stopPropagation?l.stopPropagation():typeof l.cancelBubble!="unknown"&&(l.cancelBubble=!0),this.isPropagationStopped=Eb)},persist:function(){},isPersistent:Eb}),s}var hx={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},FC=dl(hx),Z0=fi({},hx,{view:0,detail:0}),wW=dl(Z0),NT,ET,k_,_2=fi({},Z0,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:BC,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==k_&&(k_&&e.type==="mousemove"?(NT=e.screenX-k_.screenX,ET=e.screenY-k_.screenY):ET=NT=0,k_=e),NT)},movementY:function(e){return"movementY"in e?e.movementY:ET}}),g3=dl(_2),SW=fi({},_2,{dataTransfer:0}),jW=dl(SW),TW=fi({},Z0,{relatedTarget:0}),CT=dl(TW),NW=fi({},hx,{animationName:0,elapsedTime:0,pseudoElement:0}),EW=dl(NW),CW=fi({},hx,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),AW=dl(CW),PW=fi({},hx,{data:0}),x3=dl(PW),IW={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},MW={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},RW={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function kW(e){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(e):(e=RW[e])?!!s[e]:!1}function BC(){return kW}var DW=fi({},Z0,{key:function(e){if(e.key){var s=IW[e.key]||e.key;if(s!=="Unidentified")return s}return e.type==="keypress"?(e=tw(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?MW[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:BC,charCode:function(e){return e.type==="keypress"?tw(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?tw(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),LW=dl(DW),zW=fi({},_2,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),y3=dl(zW),OW=fi({},Z0,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:BC}),FW=dl(OW),BW=fi({},hx,{propertyName:0,elapsedTime:0,pseudoElement:0}),VW=dl(BW),UW=fi({},_2,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),$W=dl(UW),GW=[9,13,27,32],VC=qu&&"CompositionEvent"in window,Y_=null;qu&&"documentMode"in document&&(Y_=document.documentMode);var HW=qu&&"TextEvent"in window&&!Y_,Vz=qu&&(!VC||Y_&&8<Y_&&11>=Y_),_3=" ",v3=!1;function Uz(e,s){switch(e){case"keyup":return GW.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function $z(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var cg=!1;function WW(e,s){switch(e){case"compositionend":return $z(s);case"keypress":return s.which!==32?null:(v3=!0,_3);case"textInput":return e=s.data,e===_3&&v3?null:e;default:return null}}function qW(e,s){if(cg)return e==="compositionend"||!VC&&Uz(e,s)?(e=Bz(),ew=OC=fh=null,cg=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return Vz&&s.locale!=="ko"?null:s.data;default:return null}}var ZW={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function b3(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s==="input"?!!ZW[e.type]:s==="textarea"}function Gz(e,s,l,d){bz(d),s=Cw(s,"onChange"),0<s.length&&(l=new FC("onChange","change",null,l,d),e.push({event:l,listeners:s}))}var J_=null,g0=null;function KW(e){tO(e,0)}function v2(e){var s=hg(e);if(fz(s))return e}function XW(e,s){if(e==="change")return s}var Hz=!1;if(qu){var AT;if(qu){var PT="oninput"in document;if(!PT){var w3=document.createElement("div");w3.setAttribute("oninput","return;"),PT=typeof w3.oninput=="function"}AT=PT}else AT=!1;Hz=AT&&(!document.documentMode||9<document.documentMode)}function S3(){J_&&(J_.detachEvent("onpropertychange",Wz),g0=J_=null)}function Wz(e){if(e.propertyName==="value"&&v2(g0)){var s=[];Gz(s,g0,e,RC(e)),Tz(KW,s)}}function YW(e,s,l){e==="focusin"?(S3(),J_=s,g0=l,J_.attachEvent("onpropertychange",Wz)):e==="focusout"&&S3()}function JW(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return v2(g0)}function QW(e,s){if(e==="click")return v2(s)}function eq(e,s){if(e==="input"||e==="change")return v2(s)}function tq(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var rc=typeof Object.is=="function"?Object.is:tq;function x0(e,s){if(rc(e,s))return!0;if(typeof e!="object"||e===null||typeof s!="object"||s===null)return!1;var l=Object.keys(e),d=Object.keys(s);if(l.length!==d.length)return!1;for(d=0;d<l.length;d++){var m=l[d];if(!AN.call(s,m)||!rc(e[m],s[m]))return!1}return!0}function j3(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function T3(e,s){var l=j3(e);e=0;for(var d;l;){if(l.nodeType===3){if(d=e+l.textContent.length,e<=s&&d>=s)return{node:l,offset:s-e};e=d}e:{for(;l;){if(l.nextSibling){l=l.nextSibling;break e}l=l.parentNode}l=void 0}l=j3(l)}}function qz(e,s){return e&&s?e===s?!0:e&&e.nodeType===3?!1:s&&s.nodeType===3?qz(e,s.parentNode):"contains"in e?e.contains(s):e.compareDocumentPosition?!!(e.compareDocumentPosition(s)&16):!1:!1}function Zz(){for(var e=window,s=bw();s instanceof e.HTMLIFrameElement;){try{var l=typeof s.contentWindow.location.href=="string"}catch{l=!1}if(l)e=s.contentWindow;else break;s=bw(e.document)}return s}function UC(e){var s=e&&e.nodeName&&e.nodeName.toLowerCase();return s&&(s==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||s==="textarea"||e.contentEditable==="true")}function sq(e){var s=Zz(),l=e.focusedElem,d=e.selectionRange;if(s!==l&&l&&l.ownerDocument&&qz(l.ownerDocument.documentElement,l)){if(d!==null&&UC(l)){if(s=d.start,e=d.end,e===void 0&&(e=s),"selectionStart"in l)l.selectionStart=s,l.selectionEnd=Math.min(e,l.value.length);else if(e=(s=l.ownerDocument||document)&&s.defaultView||window,e.getSelection){e=e.getSelection();var m=l.textContent.length,_=Math.min(d.start,m);d=d.end===void 0?_:Math.min(d.end,m),!e.extend&&_>d&&(m=d,d=_,_=m),m=T3(l,_);var w=T3(l,d);m&&w&&(e.rangeCount!==1||e.anchorNode!==m.node||e.anchorOffset!==m.offset||e.focusNode!==w.node||e.focusOffset!==w.offset)&&(s=s.createRange(),s.setStart(m.node,m.offset),e.removeAllRanges(),_>d?(e.addRange(s),e.extend(w.node,w.offset)):(s.setEnd(w.node,w.offset),e.addRange(s)))}}for(s=[],e=l;e=e.parentNode;)e.nodeType===1&&s.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof l.focus=="function"&&l.focus(),l=0;l<s.length;l++)e=s[l],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var nq=qu&&"documentMode"in document&&11>=document.documentMode,ug=null,ZN=null,Q_=null,KN=!1;function N3(e,s,l){var d=l.window===l?l.document:l.nodeType===9?l:l.ownerDocument;KN||ug==null||ug!==bw(d)||(d=ug,"selectionStart"in d&&UC(d)?d={start:d.selectionStart,end:d.selectionEnd}:(d=(d.ownerDocument&&d.ownerDocument.defaultView||window).getSelection(),d={anchorNode:d.anchorNode,anchorOffset:d.anchorOffset,focusNode:d.focusNode,focusOffset:d.focusOffset}),Q_&&x0(Q_,d)||(Q_=d,d=Cw(ZN,"onSelect"),0<d.length&&(s=new FC("onSelect","select",null,s,l),e.push({event:s,listeners:d}),s.target=ug)))}function Cb(e,s){var l={};return l[e.toLowerCase()]=s.toLowerCase(),l["Webkit"+e]="webkit"+s,l["Moz"+e]="moz"+s,l}var dg={animationend:Cb("Animation","AnimationEnd"),animationiteration:Cb("Animation","AnimationIteration"),animationstart:Cb("Animation","AnimationStart"),transitionend:Cb("Transition","TransitionEnd")},IT={},Kz={};qu&&(Kz=document.createElement("div").style,"AnimationEvent"in window||(delete dg.animationend.animation,delete dg.animationiteration.animation,delete dg.animationstart.animation),"TransitionEvent"in window||delete dg.transitionend.transition);function b2(e){if(IT[e])return IT[e];if(!dg[e])return e;var s=dg[e],l;for(l in s)if(s.hasOwnProperty(l)&&l in Kz)return IT[e]=s[l];return e}var Xz=b2("animationend"),Yz=b2("animationiteration"),Jz=b2("animationstart"),Qz=b2("transitionend"),eO=new Map,E3="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function zh(e,s){eO.set(e,s),Tf(s,[e])}for(var MT=0;MT<E3.length;MT++){var RT=E3[MT],rq=RT.toLowerCase(),iq=RT[0].toUpperCase()+RT.slice(1);zh(rq,"on"+iq)}zh(Xz,"onAnimationEnd");zh(Yz,"onAnimationIteration");zh(Jz,"onAnimationStart");zh("dblclick","onDoubleClick");zh("focusin","onFocus");zh("focusout","onBlur");zh(Qz,"onTransitionEnd");qg("onMouseEnter",["mouseout","mouseover"]);qg("onMouseLeave",["mouseout","mouseover"]);qg("onPointerEnter",["pointerout","pointerover"]);qg("onPointerLeave",["pointerout","pointerover"]);Tf("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));Tf("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));Tf("onBeforeInput",["compositionend","keypress","textInput","paste"]);Tf("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));Tf("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));Tf("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var H_="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),oq=new Set("cancel close invalid load scroll toggle".split(" ").concat(H_));function C3(e,s,l){var d=e.type||"unknown-event";e.currentTarget=l,rW(d,s,void 0,e),e.currentTarget=null}function tO(e,s){s=(s&4)!==0;for(var l=0;l<e.length;l++){var d=e[l],m=d.event;d=d.listeners;e:{var _=void 0;if(s)for(var w=d.length-1;0<=w;w--){var o=d[w],E=o.instance,P=o.currentTarget;if(o=o.listener,E!==_&&m.isPropagationStopped())break e;C3(m,o,P),_=E}else for(w=0;w<d.length;w++){if(o=d[w],E=o.instance,P=o.currentTarget,o=o.listener,E!==_&&m.isPropagationStopped())break e;C3(m,o,P),_=E}}}if(Sw)throw e=GN,Sw=!1,GN=null,e}function ei(e,s){var l=s[eE];l===void 0&&(l=s[eE]=new Set);var d=e+"__bubble";l.has(d)||(sO(s,e,2,!1),l.add(d))}function kT(e,s,l){var d=0;s&&(d|=4),sO(l,e,d,s)}var Ab="_reactListening"+Math.random().toString(36).slice(2);function y0(e){if(!e[Ab]){e[Ab]=!0,cz.forEach(function(l){l!=="selectionchange"&&(oq.has(l)||kT(l,!1,e),kT(l,!0,e))});var s=e.nodeType===9?e:e.ownerDocument;s===null||s[Ab]||(s[Ab]=!0,kT("selectionchange",!1,s))}}function sO(e,s,l,d){switch(Fz(s)){case 1:var m=vW;break;case 4:m=bW;break;default:m=zC}l=m.bind(null,s,l,e),m=void 0,!$N||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(m=!0),d?m!==void 0?e.addEventListener(s,l,{capture:!0,passive:m}):e.addEventListener(s,l,!0):m!==void 0?e.addEventListener(s,l,{passive:m}):e.addEventListener(s,l,!1)}function DT(e,s,l,d,m){var _=d;if(!(s&1)&&!(s&2)&&d!==null)e:for(;;){if(d===null)return;var w=d.tag;if(w===3||w===4){var o=d.stateNode.containerInfo;if(o===m||o.nodeType===8&&o.parentNode===m)break;if(w===4)for(w=d.return;w!==null;){var E=w.tag;if((E===3||E===4)&&(E=w.stateNode.containerInfo,E===m||E.nodeType===8&&E.parentNode===m))return;w=w.return}for(;o!==null;){if(w=Zp(o),w===null)return;if(E=w.tag,E===5||E===6){d=_=w;continue e}o=o.parentNode}}d=d.return}Tz(function(){var P=_,M=RC(l),L=[];e:{var F=eO.get(e);if(F!==void 0){var $=FC,Y=e;switch(e){case"keypress":if(tw(l)===0)break e;case"keydown":case"keyup":$=LW;break;case"focusin":Y="focus",$=CT;break;case"focusout":Y="blur",$=CT;break;case"beforeblur":case"afterblur":$=CT;break;case"click":if(l.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":$=g3;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":$=jW;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":$=FW;break;case Xz:case Yz:case Jz:$=EW;break;case Qz:$=VW;break;case"scroll":$=wW;break;case"wheel":$=$W;break;case"copy":case"cut":case"paste":$=AW;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":$=y3}var H=(s&4)!==0,X=!H&&e==="scroll",Z=H?F!==null?F+"Capture":null:F;H=[];for(var W=P,q;W!==null;){q=W;var oe=q.stateNode;if(q.tag===5&&oe!==null&&(q=oe,Z!==null&&(oe=h0(W,Z),oe!=null&&H.push(_0(W,oe,q)))),X)break;W=W.return}0<H.length&&(F=new $(F,Y,null,l,M),L.push({event:F,listeners:H}))}}if(!(s&7)){e:{if(F=e==="mouseover"||e==="pointerover",$=e==="mouseout"||e==="pointerout",F&&l!==VN&&(Y=l.relatedTarget||l.fromElement)&&(Zp(Y)||Y[Zu]))break e;if(($||F)&&(F=M.window===M?M:(F=M.ownerDocument)?F.defaultView||F.parentWindow:window,$?(Y=l.relatedTarget||l.toElement,$=P,Y=Y?Zp(Y):null,Y!==null&&(X=Nf(Y),Y!==X||Y.tag!==5&&Y.tag!==6)&&(Y=null)):($=null,Y=P),$!==Y)){if(H=g3,oe="onMouseLeave",Z="onMouseEnter",W="mouse",(e==="pointerout"||e==="pointerover")&&(H=y3,oe="onPointerLeave",Z="onPointerEnter",W="pointer"),X=$==null?F:hg($),q=Y==null?F:hg(Y),F=new H(oe,W+"leave",$,l,M),F.target=X,F.relatedTarget=q,oe=null,Zp(M)===P&&(H=new H(Z,W+"enter",Y,l,M),H.target=q,H.relatedTarget=X,oe=H),X=oe,$&&Y)t:{for(H=$,Z=Y,W=0,q=H;q;q=sg(q))W++;for(q=0,oe=Z;oe;oe=sg(oe))q++;for(;0<W-q;)H=sg(H),W--;for(;0<q-W;)Z=sg(Z),q--;for(;W--;){if(H===Z||Z!==null&&H===Z.alternate)break t;H=sg(H),Z=sg(Z)}H=null}else H=null;$!==null&&A3(L,F,$,H,!1),Y!==null&&X!==null&&A3(L,X,Y,H,!0)}}e:{if(F=P?hg(P):window,$=F.nodeName&&F.nodeName.toLowerCase(),$==="select"||$==="input"&&F.type==="file")var ae=XW;else if(b3(F))if(Hz)ae=eq;else{ae=JW;var Ne=YW}else($=F.nodeName)&&$.toLowerCase()==="input"&&(F.type==="checkbox"||F.type==="radio")&&(ae=QW);if(ae&&(ae=ae(e,P))){Gz(L,ae,l,M);break e}Ne&&Ne(e,F,P),e==="focusout"&&(Ne=F._wrapperState)&&Ne.controlled&&F.type==="number"&&LN(F,"number",F.value)}switch(Ne=P?hg(P):window,e){case"focusin":(b3(Ne)||Ne.contentEditable==="true")&&(ug=Ne,ZN=P,Q_=null);break;case"focusout":Q_=ZN=ug=null;break;case"mousedown":KN=!0;break;case"contextmenu":case"mouseup":case"dragend":KN=!1,N3(L,l,M);break;case"selectionchange":if(nq)break;case"keydown":case"keyup":N3(L,l,M)}var Pe;if(VC)e:{switch(e){case"compositionstart":var Le="onCompositionStart";break e;case"compositionend":Le="onCompositionEnd";break e;case"compositionupdate":Le="onCompositionUpdate";break e}Le=void 0}else cg?Uz(e,l)&&(Le="onCompositionEnd"):e==="keydown"&&l.keyCode===229&&(Le="onCompositionStart");Le&&(Vz&&l.locale!=="ko"&&(cg||Le!=="onCompositionStart"?Le==="onCompositionEnd"&&cg&&(Pe=Bz()):(fh=M,OC="value"in fh?fh.value:fh.textContent,cg=!0)),Ne=Cw(P,Le),0<Ne.length&&(Le=new x3(Le,e,null,l,M),L.push({event:Le,listeners:Ne}),Pe?Le.data=Pe:(Pe=$z(l),Pe!==null&&(Le.data=Pe)))),(Pe=HW?WW(e,l):qW(e,l))&&(P=Cw(P,"onBeforeInput"),0<P.length&&(M=new x3("onBeforeInput","beforeinput",null,l,M),L.push({event:M,listeners:P}),M.data=Pe))}tO(L,s)})}function _0(e,s,l){return{instance:e,listener:s,currentTarget:l}}function Cw(e,s){for(var l=s+"Capture",d=[];e!==null;){var m=e,_=m.stateNode;m.tag===5&&_!==null&&(m=_,_=h0(e,l),_!=null&&d.unshift(_0(e,_,m)),_=h0(e,s),_!=null&&d.push(_0(e,_,m))),e=e.return}return d}function sg(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function A3(e,s,l,d,m){for(var _=s._reactName,w=[];l!==null&&l!==d;){var o=l,E=o.alternate,P=o.stateNode;if(E!==null&&E===d)break;o.tag===5&&P!==null&&(o=P,m?(E=h0(l,_),E!=null&&w.unshift(_0(l,E,o))):m||(E=h0(l,_),E!=null&&w.push(_0(l,E,o)))),l=l.return}w.length!==0&&e.push({event:s,listeners:w})}var aq=/\r\n?/g,lq=/\u0000|\uFFFD/g;function P3(e){return(typeof e=="string"?e:""+e).replace(aq,`
`).replace(lq,"")}function Pb(e,s,l){if(s=P3(s),P3(e)!==s&&l)throw Error(ms(425))}function Aw(){}var XN=null,YN=null;function JN(e,s){return e==="textarea"||e==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var QN=typeof setTimeout=="function"?setTimeout:void 0,cq=typeof clearTimeout=="function"?clearTimeout:void 0,I3=typeof Promise=="function"?Promise:void 0,uq=typeof queueMicrotask=="function"?queueMicrotask:typeof I3<"u"?function(e){return I3.resolve(null).then(e).catch(dq)}:QN;function dq(e){setTimeout(function(){throw e})}function LT(e,s){var l=s,d=0;do{var m=l.nextSibling;if(e.removeChild(l),m&&m.nodeType===8)if(l=m.data,l==="/$"){if(d===0){e.removeChild(m),m0(s);return}d--}else l!=="$"&&l!=="$?"&&l!=="$!"||d++;l=m}while(l);m0(s)}function bh(e){for(;e!=null;e=e.nextSibling){var s=e.nodeType;if(s===1||s===3)break;if(s===8){if(s=e.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return e}function M3(e){e=e.previousSibling;for(var s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="$"||l==="$!"||l==="$?"){if(s===0)return e;s--}else l==="/$"&&s++}e=e.previousSibling}return null}var px=Math.random().toString(36).slice(2),Zc="__reactFiber$"+px,v0="__reactProps$"+px,Zu="__reactContainer$"+px,eE="__reactEvents$"+px,hq="__reactListeners$"+px,pq="__reactHandles$"+px;function Zp(e){var s=e[Zc];if(s)return s;for(var l=e.parentNode;l;){if(s=l[Zu]||l[Zc]){if(l=s.alternate,s.child!==null||l!==null&&l.child!==null)for(e=M3(e);e!==null;){if(l=e[Zc])return l;e=M3(e)}return s}e=l,l=e.parentNode}return null}function K0(e){return e=e[Zc]||e[Zu],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function hg(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(ms(33))}function w2(e){return e[v0]||null}var tE=[],pg=-1;function Oh(e){return{current:e}}function si(e){0>pg||(e.current=tE[pg],tE[pg]=null,pg--)}function Kr(e,s){pg++,tE[pg]=e.current,e.current=s}var Ph={},Zo=Oh(Ph),Da=Oh(!1),pf=Ph;function Zg(e,s){var l=e.type.contextTypes;if(!l)return Ph;var d=e.stateNode;if(d&&d.__reactInternalMemoizedUnmaskedChildContext===s)return d.__reactInternalMemoizedMaskedChildContext;var m={},_;for(_ in l)m[_]=s[_];return d&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=m),m}function La(e){return e=e.childContextTypes,e!=null}function Pw(){si(Da),si(Zo)}function R3(e,s,l){if(Zo.current!==Ph)throw Error(ms(168));Kr(Zo,s),Kr(Da,l)}function nO(e,s,l){var d=e.stateNode;if(s=s.childContextTypes,typeof d.getChildContext!="function")return l;d=d.getChildContext();for(var m in d)if(!(m in s))throw Error(ms(108,Y9(e)||"Unknown",m));return fi({},l,d)}function Iw(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||Ph,pf=Zo.current,Kr(Zo,e),Kr(Da,Da.current),!0}function k3(e,s,l){var d=e.stateNode;if(!d)throw Error(ms(169));l?(e=nO(e,s,pf),d.__reactInternalMemoizedMergedChildContext=e,si(Da),si(Zo),Kr(Zo,e)):si(Da),Kr(Da,l)}var Ou=null,S2=!1,zT=!1;function rO(e){Ou===null?Ou=[e]:Ou.push(e)}function fq(e){S2=!0,rO(e)}function Fh(){if(!zT&&Ou!==null){zT=!0;var e=0,s=Fr;try{var l=Ou;for(Fr=1;e<l.length;e++){var d=l[e];do d=d(!0);while(d!==null)}Ou=null,S2=!1}catch(m){throw Ou!==null&&(Ou=Ou.slice(e+1)),Az(kC,Fh),m}finally{Fr=s,zT=!1}}return null}var fg=[],mg=0,Mw=null,Rw=0,Sl=[],jl=0,ff=null,Vu=1,Uu="";function Hp(e,s){fg[mg++]=Rw,fg[mg++]=Mw,Mw=e,Rw=s}function iO(e,s,l){Sl[jl++]=Vu,Sl[jl++]=Uu,Sl[jl++]=ff,ff=e;var d=Vu;e=Uu;var m=32-sc(d)-1;d&=~(1<<m),l+=1;var _=32-sc(s)+m;if(30<_){var w=m-m%5;_=(d&(1<<w)-1).toString(32),d>>=w,m-=w,Vu=1<<32-sc(s)+m|l<<m|d,Uu=_+e}else Vu=1<<_|l<<m|d,Uu=e}function $C(e){e.return!==null&&(Hp(e,1),iO(e,1,0))}function GC(e){for(;e===Mw;)Mw=fg[--mg],fg[mg]=null,Rw=fg[--mg],fg[mg]=null;for(;e===ff;)ff=Sl[--jl],Sl[jl]=null,Uu=Sl[--jl],Sl[jl]=null,Vu=Sl[--jl],Sl[jl]=null}var Qa=null,Ja=null,ii=!1,tc=null;function oO(e,s){var l=Tl(5,null,null,0);l.elementType="DELETED",l.stateNode=s,l.return=e,s=e.deletions,s===null?(e.deletions=[l],e.flags|=16):s.push(l)}function D3(e,s){switch(e.tag){case 5:var l=e.type;return s=s.nodeType!==1||l.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(e.stateNode=s,Qa=e,Ja=bh(s.firstChild),!0):!1;case 6:return s=e.pendingProps===""||s.nodeType!==3?null:s,s!==null?(e.stateNode=s,Qa=e,Ja=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(l=ff!==null?{id:Vu,overflow:Uu}:null,e.memoizedState={dehydrated:s,treeContext:l,retryLane:1073741824},l=Tl(18,null,null,0),l.stateNode=s,l.return=e,e.child=l,Qa=e,Ja=null,!0):!1;default:return!1}}function sE(e){return(e.mode&1)!==0&&(e.flags&128)===0}function nE(e){if(ii){var s=Ja;if(s){var l=s;if(!D3(e,s)){if(sE(e))throw Error(ms(418));s=bh(l.nextSibling);var d=Qa;s&&D3(e,s)?oO(d,l):(e.flags=e.flags&-4097|2,ii=!1,Qa=e)}}else{if(sE(e))throw Error(ms(418));e.flags=e.flags&-4097|2,ii=!1,Qa=e}}}function L3(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;Qa=e}function Ib(e){if(e!==Qa)return!1;if(!ii)return L3(e),ii=!0,!1;var s;if((s=e.tag!==3)&&!(s=e.tag!==5)&&(s=e.type,s=s!=="head"&&s!=="body"&&!JN(e.type,e.memoizedProps)),s&&(s=Ja)){if(sE(e))throw aO(),Error(ms(418));for(;s;)oO(e,s),s=bh(s.nextSibling)}if(L3(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(ms(317));e:{for(e=e.nextSibling,s=0;e;){if(e.nodeType===8){var l=e.data;if(l==="/$"){if(s===0){Ja=bh(e.nextSibling);break e}s--}else l!=="$"&&l!=="$!"&&l!=="$?"||s++}e=e.nextSibling}Ja=null}}else Ja=Qa?bh(e.stateNode.nextSibling):null;return!0}function aO(){for(var e=Ja;e;)e=bh(e.nextSibling)}function Kg(){Ja=Qa=null,ii=!1}function HC(e){tc===null?tc=[e]:tc.push(e)}var mq=id.ReactCurrentBatchConfig;function D_(e,s,l){if(e=l.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(l._owner){if(l=l._owner,l){if(l.tag!==1)throw Error(ms(309));var d=l.stateNode}if(!d)throw Error(ms(147,e));var m=d,_=""+e;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===_?s.ref:(s=function(w){var o=m.refs;w===null?delete o[_]:o[_]=w},s._stringRef=_,s)}if(typeof e!="string")throw Error(ms(284));if(!l._owner)throw Error(ms(290,e))}return e}function Mb(e,s){throw e=Object.prototype.toString.call(s),Error(ms(31,e==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":e))}function z3(e){var s=e._init;return s(e._payload)}function lO(e){function s(Z,W){if(e){var q=Z.deletions;q===null?(Z.deletions=[W],Z.flags|=16):q.push(W)}}function l(Z,W){if(!e)return null;for(;W!==null;)s(Z,W),W=W.sibling;return null}function d(Z,W){for(Z=new Map;W!==null;)W.key!==null?Z.set(W.key,W):Z.set(W.index,W),W=W.sibling;return Z}function m(Z,W){return Z=Th(Z,W),Z.index=0,Z.sibling=null,Z}function _(Z,W,q){return Z.index=q,e?(q=Z.alternate,q!==null?(q=q.index,q<W?(Z.flags|=2,W):q):(Z.flags|=2,W)):(Z.flags|=1048576,W)}function w(Z){return e&&Z.alternate===null&&(Z.flags|=2),Z}function o(Z,W,q,oe){return W===null||W.tag!==6?(W=GT(q,Z.mode,oe),W.return=Z,W):(W=m(W,q),W.return=Z,W)}function E(Z,W,q,oe){var ae=q.type;return ae===lg?M(Z,W,q.props.children,oe,q.key):W!==null&&(W.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===ih&&z3(ae)===W.type)?(oe=m(W,q.props),oe.ref=D_(Z,W,q),oe.return=Z,oe):(oe=lw(q.type,q.key,q.props,null,Z.mode,oe),oe.ref=D_(Z,W,q),oe.return=Z,oe)}function P(Z,W,q,oe){return W===null||W.tag!==4||W.stateNode.containerInfo!==q.containerInfo||W.stateNode.implementation!==q.implementation?(W=HT(q,Z.mode,oe),W.return=Z,W):(W=m(W,q.children||[]),W.return=Z,W)}function M(Z,W,q,oe,ae){return W===null||W.tag!==7?(W=cf(q,Z.mode,oe,ae),W.return=Z,W):(W=m(W,q),W.return=Z,W)}function L(Z,W,q){if(typeof W=="string"&&W!==""||typeof W=="number")return W=GT(""+W,Z.mode,q),W.return=Z,W;if(typeof W=="object"&&W!==null){switch(W.$$typeof){case bb:return q=lw(W.type,W.key,W.props,null,Z.mode,q),q.ref=D_(Z,null,W),q.return=Z,q;case ag:return W=HT(W,Z.mode,q),W.return=Z,W;case ih:var oe=W._init;return L(Z,oe(W._payload),q)}if($_(W)||P_(W))return W=cf(W,Z.mode,q,null),W.return=Z,W;Mb(Z,W)}return null}function F(Z,W,q,oe){var ae=W!==null?W.key:null;if(typeof q=="string"&&q!==""||typeof q=="number")return ae!==null?null:o(Z,W,""+q,oe);if(typeof q=="object"&&q!==null){switch(q.$$typeof){case bb:return q.key===ae?E(Z,W,q,oe):null;case ag:return q.key===ae?P(Z,W,q,oe):null;case ih:return ae=q._init,F(Z,W,ae(q._payload),oe)}if($_(q)||P_(q))return ae!==null?null:M(Z,W,q,oe,null);Mb(Z,q)}return null}function $(Z,W,q,oe,ae){if(typeof oe=="string"&&oe!==""||typeof oe=="number")return Z=Z.get(q)||null,o(W,Z,""+oe,ae);if(typeof oe=="object"&&oe!==null){switch(oe.$$typeof){case bb:return Z=Z.get(oe.key===null?q:oe.key)||null,E(W,Z,oe,ae);case ag:return Z=Z.get(oe.key===null?q:oe.key)||null,P(W,Z,oe,ae);case ih:var Ne=oe._init;return $(Z,W,q,Ne(oe._payload),ae)}if($_(oe)||P_(oe))return Z=Z.get(q)||null,M(W,Z,oe,ae,null);Mb(W,oe)}return null}function Y(Z,W,q,oe){for(var ae=null,Ne=null,Pe=W,Le=W=0,ct=null;Pe!==null&&Le<q.length;Le++){Pe.index>Le?(ct=Pe,Pe=null):ct=Pe.sibling;var xt=F(Z,Pe,q[Le],oe);if(xt===null){Pe===null&&(Pe=ct);break}e&&Pe&&xt.alternate===null&&s(Z,Pe),W=_(xt,W,Le),Ne===null?ae=xt:Ne.sibling=xt,Ne=xt,Pe=ct}if(Le===q.length)return l(Z,Pe),ii&&Hp(Z,Le),ae;if(Pe===null){for(;Le<q.length;Le++)Pe=L(Z,q[Le],oe),Pe!==null&&(W=_(Pe,W,Le),Ne===null?ae=Pe:Ne.sibling=Pe,Ne=Pe);return ii&&Hp(Z,Le),ae}for(Pe=d(Z,Pe);Le<q.length;Le++)ct=$(Pe,Z,Le,q[Le],oe),ct!==null&&(e&&ct.alternate!==null&&Pe.delete(ct.key===null?Le:ct.key),W=_(ct,W,Le),Ne===null?ae=ct:Ne.sibling=ct,Ne=ct);return e&&Pe.forEach(function(yt){return s(Z,yt)}),ii&&Hp(Z,Le),ae}function H(Z,W,q,oe){var ae=P_(q);if(typeof ae!="function")throw Error(ms(150));if(q=ae.call(q),q==null)throw Error(ms(151));for(var Ne=ae=null,Pe=W,Le=W=0,ct=null,xt=q.next();Pe!==null&&!xt.done;Le++,xt=q.next()){Pe.index>Le?(ct=Pe,Pe=null):ct=Pe.sibling;var yt=F(Z,Pe,xt.value,oe);if(yt===null){Pe===null&&(Pe=ct);break}e&&Pe&&yt.alternate===null&&s(Z,Pe),W=_(yt,W,Le),Ne===null?ae=yt:Ne.sibling=yt,Ne=yt,Pe=ct}if(xt.done)return l(Z,Pe),ii&&Hp(Z,Le),ae;if(Pe===null){for(;!xt.done;Le++,xt=q.next())xt=L(Z,xt.value,oe),xt!==null&&(W=_(xt,W,Le),Ne===null?ae=xt:Ne.sibling=xt,Ne=xt);return ii&&Hp(Z,Le),ae}for(Pe=d(Z,Pe);!xt.done;Le++,xt=q.next())xt=$(Pe,Z,Le,xt.value,oe),xt!==null&&(e&&xt.alternate!==null&&Pe.delete(xt.key===null?Le:xt.key),W=_(xt,W,Le),Ne===null?ae=xt:Ne.sibling=xt,Ne=xt);return e&&Pe.forEach(function(Ht){return s(Z,Ht)}),ii&&Hp(Z,Le),ae}function X(Z,W,q,oe){if(typeof q=="object"&&q!==null&&q.type===lg&&q.key===null&&(q=q.props.children),typeof q=="object"&&q!==null){switch(q.$$typeof){case bb:e:{for(var ae=q.key,Ne=W;Ne!==null;){if(Ne.key===ae){if(ae=q.type,ae===lg){if(Ne.tag===7){l(Z,Ne.sibling),W=m(Ne,q.props.children),W.return=Z,Z=W;break e}}else if(Ne.elementType===ae||typeof ae=="object"&&ae!==null&&ae.$$typeof===ih&&z3(ae)===Ne.type){l(Z,Ne.sibling),W=m(Ne,q.props),W.ref=D_(Z,Ne,q),W.return=Z,Z=W;break e}l(Z,Ne);break}else s(Z,Ne);Ne=Ne.sibling}q.type===lg?(W=cf(q.props.children,Z.mode,oe,q.key),W.return=Z,Z=W):(oe=lw(q.type,q.key,q.props,null,Z.mode,oe),oe.ref=D_(Z,W,q),oe.return=Z,Z=oe)}return w(Z);case ag:e:{for(Ne=q.key;W!==null;){if(W.key===Ne)if(W.tag===4&&W.stateNode.containerInfo===q.containerInfo&&W.stateNode.implementation===q.implementation){l(Z,W.sibling),W=m(W,q.children||[]),W.return=Z,Z=W;break e}else{l(Z,W);break}else s(Z,W);W=W.sibling}W=HT(q,Z.mode,oe),W.return=Z,Z=W}return w(Z);case ih:return Ne=q._init,X(Z,W,Ne(q._payload),oe)}if($_(q))return Y(Z,W,q,oe);if(P_(q))return H(Z,W,q,oe);Mb(Z,q)}return typeof q=="string"&&q!==""||typeof q=="number"?(q=""+q,W!==null&&W.tag===6?(l(Z,W.sibling),W=m(W,q),W.return=Z,Z=W):(l(Z,W),W=GT(q,Z.mode,oe),W.return=Z,Z=W),w(Z)):l(Z,W)}return X}var Xg=lO(!0),cO=lO(!1),kw=Oh(null),Dw=null,gg=null,WC=null;function qC(){WC=gg=Dw=null}function ZC(e){var s=kw.current;si(kw),e._currentValue=s}function rE(e,s,l){for(;e!==null;){var d=e.alternate;if((e.childLanes&s)!==s?(e.childLanes|=s,d!==null&&(d.childLanes|=s)):d!==null&&(d.childLanes&s)!==s&&(d.childLanes|=s),e===l)break;e=e.return}}function Pg(e,s){Dw=e,WC=gg=null,e=e.dependencies,e!==null&&e.firstContext!==null&&(e.lanes&s&&(Ra=!0),e.firstContext=null)}function Al(e){var s=e._currentValue;if(WC!==e)if(e={context:e,memoizedValue:s,next:null},gg===null){if(Dw===null)throw Error(ms(308));gg=e,Dw.dependencies={lanes:0,firstContext:e}}else gg=gg.next=e;return s}var Kp=null;function KC(e){Kp===null?Kp=[e]:Kp.push(e)}function uO(e,s,l,d){var m=s.interleaved;return m===null?(l.next=l,KC(s)):(l.next=m.next,m.next=l),s.interleaved=l,Ku(e,d)}function Ku(e,s){e.lanes|=s;var l=e.alternate;for(l!==null&&(l.lanes|=s),l=e,e=e.return;e!==null;)e.childLanes|=s,l=e.alternate,l!==null&&(l.childLanes|=s),l=e,e=e.return;return l.tag===3?l.stateNode:null}var oh=!1;function XC(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function dO(e,s){e=e.updateQueue,s.updateQueue===e&&(s.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Gu(e,s){return{eventTime:e,lane:s,tag:0,payload:null,callback:null,next:null}}function wh(e,s,l){var d=e.updateQueue;if(d===null)return null;if(d=d.shared,Tr&2){var m=d.pending;return m===null?s.next=s:(s.next=m.next,m.next=s),d.pending=s,Ku(e,l)}return m=d.interleaved,m===null?(s.next=s,KC(d)):(s.next=m.next,m.next=s),d.interleaved=s,Ku(e,l)}function sw(e,s,l){if(s=s.updateQueue,s!==null&&(s=s.shared,(l&4194240)!==0)){var d=s.lanes;d&=e.pendingLanes,l|=d,s.lanes=l,DC(e,l)}}function O3(e,s){var l=e.updateQueue,d=e.alternate;if(d!==null&&(d=d.updateQueue,l===d)){var m=null,_=null;if(l=l.firstBaseUpdate,l!==null){do{var w={eventTime:l.eventTime,lane:l.lane,tag:l.tag,payload:l.payload,callback:l.callback,next:null};_===null?m=_=w:_=_.next=w,l=l.next}while(l!==null);_===null?m=_=s:_=_.next=s}else m=_=s;l={baseState:d.baseState,firstBaseUpdate:m,lastBaseUpdate:_,shared:d.shared,effects:d.effects},e.updateQueue=l;return}e=l.lastBaseUpdate,e===null?l.firstBaseUpdate=s:e.next=s,l.lastBaseUpdate=s}function Lw(e,s,l,d){var m=e.updateQueue;oh=!1;var _=m.firstBaseUpdate,w=m.lastBaseUpdate,o=m.shared.pending;if(o!==null){m.shared.pending=null;var E=o,P=E.next;E.next=null,w===null?_=P:w.next=P,w=E;var M=e.alternate;M!==null&&(M=M.updateQueue,o=M.lastBaseUpdate,o!==w&&(o===null?M.firstBaseUpdate=P:o.next=P,M.lastBaseUpdate=E))}if(_!==null){var L=m.baseState;w=0,M=P=E=null,o=_;do{var F=o.lane,$=o.eventTime;if((d&F)===F){M!==null&&(M=M.next={eventTime:$,lane:0,tag:o.tag,payload:o.payload,callback:o.callback,next:null});e:{var Y=e,H=o;switch(F=s,$=l,H.tag){case 1:if(Y=H.payload,typeof Y=="function"){L=Y.call($,L,F);break e}L=Y;break e;case 3:Y.flags=Y.flags&-65537|128;case 0:if(Y=H.payload,F=typeof Y=="function"?Y.call($,L,F):Y,F==null)break e;L=fi({},L,F);break e;case 2:oh=!0}}o.callback!==null&&o.lane!==0&&(e.flags|=64,F=m.effects,F===null?m.effects=[o]:F.push(o))}else $={eventTime:$,lane:F,tag:o.tag,payload:o.payload,callback:o.callback,next:null},M===null?(P=M=$,E=L):M=M.next=$,w|=F;if(o=o.next,o===null){if(o=m.shared.pending,o===null)break;F=o,o=F.next,F.next=null,m.lastBaseUpdate=F,m.shared.pending=null}}while(!0);if(M===null&&(E=L),m.baseState=E,m.firstBaseUpdate=P,m.lastBaseUpdate=M,s=m.shared.interleaved,s!==null){m=s;do w|=m.lane,m=m.next;while(m!==s)}else _===null&&(m.shared.lanes=0);gf|=w,e.lanes=w,e.memoizedState=L}}function F3(e,s,l){if(e=s.effects,s.effects=null,e!==null)for(s=0;s<e.length;s++){var d=e[s],m=d.callback;if(m!==null){if(d.callback=null,d=l,typeof m!="function")throw Error(ms(191,m));m.call(d)}}}var X0={},Jc=Oh(X0),b0=Oh(X0),w0=Oh(X0);function Xp(e){if(e===X0)throw Error(ms(174));return e}function YC(e,s){switch(Kr(w0,s),Kr(b0,e),Kr(Jc,X0),e=s.nodeType,e){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:ON(null,"");break;default:e=e===8?s.parentNode:s,s=e.namespaceURI||null,e=e.tagName,s=ON(s,e)}si(Jc),Kr(Jc,s)}function Yg(){si(Jc),si(b0),si(w0)}function hO(e){Xp(w0.current);var s=Xp(Jc.current),l=ON(s,e.type);s!==l&&(Kr(b0,e),Kr(Jc,l))}function JC(e){b0.current===e&&(si(Jc),si(b0))}var li=Oh(0);function zw(e){for(var s=e;s!==null;){if(s.tag===13){var l=s.memoizedState;if(l!==null&&(l=l.dehydrated,l===null||l.data==="$?"||l.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var OT=[];function QC(){for(var e=0;e<OT.length;e++)OT[e]._workInProgressVersionPrimary=null;OT.length=0}var nw=id.ReactCurrentDispatcher,FT=id.ReactCurrentBatchConfig,mf=0,di=null,no=null,yo=null,Ow=!1,e0=!1,S0=0,gq=0;function Uo(){throw Error(ms(321))}function eA(e,s){if(s===null)return!1;for(var l=0;l<s.length&&l<e.length;l++)if(!rc(e[l],s[l]))return!1;return!0}function tA(e,s,l,d,m,_){if(mf=_,di=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,nw.current=e===null||e.memoizedState===null?vq:bq,e=l(d,m),e0){_=0;do{if(e0=!1,S0=0,25<=_)throw Error(ms(301));_+=1,yo=no=null,s.updateQueue=null,nw.current=wq,e=l(d,m)}while(e0)}if(nw.current=Fw,s=no!==null&&no.next!==null,mf=0,yo=no=di=null,Ow=!1,s)throw Error(ms(300));return e}function sA(){var e=S0!==0;return S0=0,e}function Gc(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return yo===null?di.memoizedState=yo=e:yo=yo.next=e,yo}function Pl(){if(no===null){var e=di.alternate;e=e!==null?e.memoizedState:null}else e=no.next;var s=yo===null?di.memoizedState:yo.next;if(s!==null)yo=s,no=e;else{if(e===null)throw Error(ms(310));no=e,e={memoizedState:no.memoizedState,baseState:no.baseState,baseQueue:no.baseQueue,queue:no.queue,next:null},yo===null?di.memoizedState=yo=e:yo=yo.next=e}return yo}function j0(e,s){return typeof s=="function"?s(e):s}function BT(e){var s=Pl(),l=s.queue;if(l===null)throw Error(ms(311));l.lastRenderedReducer=e;var d=no,m=d.baseQueue,_=l.pending;if(_!==null){if(m!==null){var w=m.next;m.next=_.next,_.next=w}d.baseQueue=m=_,l.pending=null}if(m!==null){_=m.next,d=d.baseState;var o=w=null,E=null,P=_;do{var M=P.lane;if((mf&M)===M)E!==null&&(E=E.next={lane:0,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null}),d=P.hasEagerState?P.eagerState:e(d,P.action);else{var L={lane:M,action:P.action,hasEagerState:P.hasEagerState,eagerState:P.eagerState,next:null};E===null?(o=E=L,w=d):E=E.next=L,di.lanes|=M,gf|=M}P=P.next}while(P!==null&&P!==_);E===null?w=d:E.next=o,rc(d,s.memoizedState)||(Ra=!0),s.memoizedState=d,s.baseState=w,s.baseQueue=E,l.lastRenderedState=d}if(e=l.interleaved,e!==null){m=e;do _=m.lane,di.lanes|=_,gf|=_,m=m.next;while(m!==e)}else m===null&&(l.lanes=0);return[s.memoizedState,l.dispatch]}function VT(e){var s=Pl(),l=s.queue;if(l===null)throw Error(ms(311));l.lastRenderedReducer=e;var d=l.dispatch,m=l.pending,_=s.memoizedState;if(m!==null){l.pending=null;var w=m=m.next;do _=e(_,w.action),w=w.next;while(w!==m);rc(_,s.memoizedState)||(Ra=!0),s.memoizedState=_,s.baseQueue===null&&(s.baseState=_),l.lastRenderedState=_}return[_,d]}function pO(){}function fO(e,s){var l=di,d=Pl(),m=s(),_=!rc(d.memoizedState,m);if(_&&(d.memoizedState=m,Ra=!0),d=d.queue,nA(xO.bind(null,l,d,e),[e]),d.getSnapshot!==s||_||yo!==null&&yo.memoizedState.tag&1){if(l.flags|=2048,T0(9,gO.bind(null,l,d,m,s),void 0,null),vo===null)throw Error(ms(349));mf&30||mO(l,s,m)}return m}function mO(e,s,l){e.flags|=16384,e={getSnapshot:s,value:l},s=di.updateQueue,s===null?(s={lastEffect:null,stores:null},di.updateQueue=s,s.stores=[e]):(l=s.stores,l===null?s.stores=[e]:l.push(e))}function gO(e,s,l,d){s.value=l,s.getSnapshot=d,yO(s)&&_O(e)}function xO(e,s,l){return l(function(){yO(s)&&_O(e)})}function yO(e){var s=e.getSnapshot;e=e.value;try{var l=s();return!rc(e,l)}catch{return!0}}function _O(e){var s=Ku(e,1);s!==null&&nc(s,e,1,-1)}function B3(e){var s=Gc();return typeof e=="function"&&(e=e()),s.memoizedState=s.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:j0,lastRenderedState:e},s.queue=e,e=e.dispatch=_q.bind(null,di,e),[s.memoizedState,e]}function T0(e,s,l,d){return e={tag:e,create:s,destroy:l,deps:d,next:null},s=di.updateQueue,s===null?(s={lastEffect:null,stores:null},di.updateQueue=s,s.lastEffect=e.next=e):(l=s.lastEffect,l===null?s.lastEffect=e.next=e:(d=l.next,l.next=e,e.next=d,s.lastEffect=e)),e}function vO(){return Pl().memoizedState}function rw(e,s,l,d){var m=Gc();di.flags|=e,m.memoizedState=T0(1|s,l,void 0,d===void 0?null:d)}function j2(e,s,l,d){var m=Pl();d=d===void 0?null:d;var _=void 0;if(no!==null){var w=no.memoizedState;if(_=w.destroy,d!==null&&eA(d,w.deps)){m.memoizedState=T0(s,l,_,d);return}}di.flags|=e,m.memoizedState=T0(1|s,l,_,d)}function V3(e,s){return rw(8390656,8,e,s)}function nA(e,s){return j2(2048,8,e,s)}function bO(e,s){return j2(4,2,e,s)}function wO(e,s){return j2(4,4,e,s)}function SO(e,s){if(typeof s=="function")return e=e(),s(e),function(){s(null)};if(s!=null)return e=e(),s.current=e,function(){s.current=null}}function jO(e,s,l){return l=l!=null?l.concat([e]):null,j2(4,4,SO.bind(null,s,e),l)}function rA(){}function TO(e,s){var l=Pl();s=s===void 0?null:s;var d=l.memoizedState;return d!==null&&s!==null&&eA(s,d[1])?d[0]:(l.memoizedState=[e,s],e)}function NO(e,s){var l=Pl();s=s===void 0?null:s;var d=l.memoizedState;return d!==null&&s!==null&&eA(s,d[1])?d[0]:(e=e(),l.memoizedState=[e,s],e)}function EO(e,s,l){return mf&21?(rc(l,s)||(l=Mz(),di.lanes|=l,gf|=l,e.baseState=!0),s):(e.baseState&&(e.baseState=!1,Ra=!0),e.memoizedState=l)}function xq(e,s){var l=Fr;Fr=l!==0&&4>l?l:4,e(!0);var d=FT.transition;FT.transition={};try{e(!1),s()}finally{Fr=l,FT.transition=d}}function CO(){return Pl().memoizedState}function yq(e,s,l){var d=jh(e);if(l={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null},AO(e))PO(s,l);else if(l=uO(e,s,l,d),l!==null){var m=ga();nc(l,e,d,m),IO(l,s,d)}}function _q(e,s,l){var d=jh(e),m={lane:d,action:l,hasEagerState:!1,eagerState:null,next:null};if(AO(e))PO(s,m);else{var _=e.alternate;if(e.lanes===0&&(_===null||_.lanes===0)&&(_=s.lastRenderedReducer,_!==null))try{var w=s.lastRenderedState,o=_(w,l);if(m.hasEagerState=!0,m.eagerState=o,rc(o,w)){var E=s.interleaved;E===null?(m.next=m,KC(s)):(m.next=E.next,E.next=m),s.interleaved=m;return}}catch{}finally{}l=uO(e,s,m,d),l!==null&&(m=ga(),nc(l,e,d,m),IO(l,s,d))}}function AO(e){var s=e.alternate;return e===di||s!==null&&s===di}function PO(e,s){e0=Ow=!0;var l=e.pending;l===null?s.next=s:(s.next=l.next,l.next=s),e.pending=s}function IO(e,s,l){if(l&4194240){var d=s.lanes;d&=e.pendingLanes,l|=d,s.lanes=l,DC(e,l)}}var Fw={readContext:Al,useCallback:Uo,useContext:Uo,useEffect:Uo,useImperativeHandle:Uo,useInsertionEffect:Uo,useLayoutEffect:Uo,useMemo:Uo,useReducer:Uo,useRef:Uo,useState:Uo,useDebugValue:Uo,useDeferredValue:Uo,useTransition:Uo,useMutableSource:Uo,useSyncExternalStore:Uo,useId:Uo,unstable_isNewReconciler:!1},vq={readContext:Al,useCallback:function(e,s){return Gc().memoizedState=[e,s===void 0?null:s],e},useContext:Al,useEffect:V3,useImperativeHandle:function(e,s,l){return l=l!=null?l.concat([e]):null,rw(4194308,4,SO.bind(null,s,e),l)},useLayoutEffect:function(e,s){return rw(4194308,4,e,s)},useInsertionEffect:function(e,s){return rw(4,2,e,s)},useMemo:function(e,s){var l=Gc();return s=s===void 0?null:s,e=e(),l.memoizedState=[e,s],e},useReducer:function(e,s,l){var d=Gc();return s=l!==void 0?l(s):s,d.memoizedState=d.baseState=s,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:s},d.queue=e,e=e.dispatch=yq.bind(null,di,e),[d.memoizedState,e]},useRef:function(e){var s=Gc();return e={current:e},s.memoizedState=e},useState:B3,useDebugValue:rA,useDeferredValue:function(e){return Gc().memoizedState=e},useTransition:function(){var e=B3(!1),s=e[0];return e=xq.bind(null,e[1]),Gc().memoizedState=e,[s,e]},useMutableSource:function(){},useSyncExternalStore:function(e,s,l){var d=di,m=Gc();if(ii){if(l===void 0)throw Error(ms(407));l=l()}else{if(l=s(),vo===null)throw Error(ms(349));mf&30||mO(d,s,l)}m.memoizedState=l;var _={value:l,getSnapshot:s};return m.queue=_,V3(xO.bind(null,d,_,e),[e]),d.flags|=2048,T0(9,gO.bind(null,d,_,l,s),void 0,null),l},useId:function(){var e=Gc(),s=vo.identifierPrefix;if(ii){var l=Uu,d=Vu;l=(d&~(1<<32-sc(d)-1)).toString(32)+l,s=":"+s+"R"+l,l=S0++,0<l&&(s+="H"+l.toString(32)),s+=":"}else l=gq++,s=":"+s+"r"+l.toString(32)+":";return e.memoizedState=s},unstable_isNewReconciler:!1},bq={readContext:Al,useCallback:TO,useContext:Al,useEffect:nA,useImperativeHandle:jO,useInsertionEffect:bO,useLayoutEffect:wO,useMemo:NO,useReducer:BT,useRef:vO,useState:function(){return BT(j0)},useDebugValue:rA,useDeferredValue:function(e){var s=Pl();return EO(s,no.memoizedState,e)},useTransition:function(){var e=BT(j0)[0],s=Pl().memoizedState;return[e,s]},useMutableSource:pO,useSyncExternalStore:fO,useId:CO,unstable_isNewReconciler:!1},wq={readContext:Al,useCallback:TO,useContext:Al,useEffect:nA,useImperativeHandle:jO,useInsertionEffect:bO,useLayoutEffect:wO,useMemo:NO,useReducer:VT,useRef:vO,useState:function(){return VT(j0)},useDebugValue:rA,useDeferredValue:function(e){var s=Pl();return no===null?s.memoizedState=e:EO(s,no.memoizedState,e)},useTransition:function(){var e=VT(j0)[0],s=Pl().memoizedState;return[e,s]},useMutableSource:pO,useSyncExternalStore:fO,useId:CO,unstable_isNewReconciler:!1};function Xl(e,s){if(e&&e.defaultProps){s=fi({},s),e=e.defaultProps;for(var l in e)s[l]===void 0&&(s[l]=e[l]);return s}return s}function iE(e,s,l,d){s=e.memoizedState,l=l(d,s),l=l==null?s:fi({},s,l),e.memoizedState=l,e.lanes===0&&(e.updateQueue.baseState=l)}var T2={isMounted:function(e){return(e=e._reactInternals)?Nf(e)===e:!1},enqueueSetState:function(e,s,l){e=e._reactInternals;var d=ga(),m=jh(e),_=Gu(d,m);_.payload=s,l!=null&&(_.callback=l),s=wh(e,_,m),s!==null&&(nc(s,e,m,d),sw(s,e,m))},enqueueReplaceState:function(e,s,l){e=e._reactInternals;var d=ga(),m=jh(e),_=Gu(d,m);_.tag=1,_.payload=s,l!=null&&(_.callback=l),s=wh(e,_,m),s!==null&&(nc(s,e,m,d),sw(s,e,m))},enqueueForceUpdate:function(e,s){e=e._reactInternals;var l=ga(),d=jh(e),m=Gu(l,d);m.tag=2,s!=null&&(m.callback=s),s=wh(e,m,d),s!==null&&(nc(s,e,d,l),sw(s,e,d))}};function U3(e,s,l,d,m,_,w){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(d,_,w):s.prototype&&s.prototype.isPureReactComponent?!x0(l,d)||!x0(m,_):!0}function MO(e,s,l){var d=!1,m=Ph,_=s.contextType;return typeof _=="object"&&_!==null?_=Al(_):(m=La(s)?pf:Zo.current,d=s.contextTypes,_=(d=d!=null)?Zg(e,m):Ph),s=new s(l,_),e.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=T2,e.stateNode=s,s._reactInternals=e,d&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=m,e.__reactInternalMemoizedMaskedChildContext=_),s}function $3(e,s,l,d){e=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(l,d),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(l,d),s.state!==e&&T2.enqueueReplaceState(s,s.state,null)}function oE(e,s,l,d){var m=e.stateNode;m.props=l,m.state=e.memoizedState,m.refs={},XC(e);var _=s.contextType;typeof _=="object"&&_!==null?m.context=Al(_):(_=La(s)?pf:Zo.current,m.context=Zg(e,_)),m.state=e.memoizedState,_=s.getDerivedStateFromProps,typeof _=="function"&&(iE(e,s,_,l),m.state=e.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof m.getSnapshotBeforeUpdate=="function"||typeof m.UNSAFE_componentWillMount!="function"&&typeof m.componentWillMount!="function"||(s=m.state,typeof m.componentWillMount=="function"&&m.componentWillMount(),typeof m.UNSAFE_componentWillMount=="function"&&m.UNSAFE_componentWillMount(),s!==m.state&&T2.enqueueReplaceState(m,m.state,null),Lw(e,l,m,d),m.state=e.memoizedState),typeof m.componentDidMount=="function"&&(e.flags|=4194308)}function Jg(e,s){try{var l="",d=s;do l+=X9(d),d=d.return;while(d);var m=l}catch(_){m=`
Error generating stack: `+_.message+`
`+_.stack}return{value:e,source:s,stack:m,digest:null}}function UT(e,s,l){return{value:e,source:null,stack:l??null,digest:s??null}}function aE(e,s){try{console.error(s.value)}catch(l){setTimeout(function(){throw l})}}var Sq=typeof WeakMap=="function"?WeakMap:Map;function RO(e,s,l){l=Gu(-1,l),l.tag=3,l.payload={element:null};var d=s.value;return l.callback=function(){Vw||(Vw=!0,xE=d),aE(e,s)},l}function kO(e,s,l){l=Gu(-1,l),l.tag=3;var d=e.type.getDerivedStateFromError;if(typeof d=="function"){var m=s.value;l.payload=function(){return d(m)},l.callback=function(){aE(e,s)}}var _=e.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(l.callback=function(){aE(e,s),typeof d!="function"&&(Sh===null?Sh=new Set([this]):Sh.add(this));var w=s.stack;this.componentDidCatch(s.value,{componentStack:w!==null?w:""})}),l}function G3(e,s,l){var d=e.pingCache;if(d===null){d=e.pingCache=new Sq;var m=new Set;d.set(s,m)}else m=d.get(s),m===void 0&&(m=new Set,d.set(s,m));m.has(l)||(m.add(l),e=zq.bind(null,e,s,l),s.then(e,e))}function H3(e){do{var s;if((s=e.tag===13)&&(s=e.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return e;e=e.return}while(e!==null);return null}function W3(e,s,l,d,m){return e.mode&1?(e.flags|=65536,e.lanes=m,e):(e===s?e.flags|=65536:(e.flags|=128,l.flags|=131072,l.flags&=-52805,l.tag===1&&(l.alternate===null?l.tag=17:(s=Gu(-1,1),s.tag=2,wh(l,s,1))),l.lanes|=1),e)}var jq=id.ReactCurrentOwner,Ra=!1;function pa(e,s,l,d){s.child=e===null?cO(s,null,l,d):Xg(s,e.child,l,d)}function q3(e,s,l,d,m){l=l.render;var _=s.ref;return Pg(s,m),d=tA(e,s,l,d,_,m),l=sA(),e!==null&&!Ra?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~m,Xu(e,s,m)):(ii&&l&&$C(s),s.flags|=1,pa(e,s,d,m),s.child)}function Z3(e,s,l,d,m){if(e===null){var _=l.type;return typeof _=="function"&&!hA(_)&&_.defaultProps===void 0&&l.compare===null&&l.defaultProps===void 0?(s.tag=15,s.type=_,DO(e,s,_,d,m)):(e=lw(l.type,null,d,s,s.mode,m),e.ref=s.ref,e.return=s,s.child=e)}if(_=e.child,!(e.lanes&m)){var w=_.memoizedProps;if(l=l.compare,l=l!==null?l:x0,l(w,d)&&e.ref===s.ref)return Xu(e,s,m)}return s.flags|=1,e=Th(_,d),e.ref=s.ref,e.return=s,s.child=e}function DO(e,s,l,d,m){if(e!==null){var _=e.memoizedProps;if(x0(_,d)&&e.ref===s.ref)if(Ra=!1,s.pendingProps=d=_,(e.lanes&m)!==0)e.flags&131072&&(Ra=!0);else return s.lanes=e.lanes,Xu(e,s,m)}return lE(e,s,l,d,m)}function LO(e,s,l){var d=s.pendingProps,m=d.children,_=e!==null?e.memoizedState:null;if(d.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kr(yg,Ka),Ka|=l;else{if(!(l&1073741824))return e=_!==null?_.baseLanes|l:l,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:e,cachePool:null,transitions:null},s.updateQueue=null,Kr(yg,Ka),Ka|=e,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},d=_!==null?_.baseLanes:l,Kr(yg,Ka),Ka|=d}else _!==null?(d=_.baseLanes|l,s.memoizedState=null):d=l,Kr(yg,Ka),Ka|=d;return pa(e,s,m,l),s.child}function zO(e,s){var l=s.ref;(e===null&&l!==null||e!==null&&e.ref!==l)&&(s.flags|=512,s.flags|=2097152)}function lE(e,s,l,d,m){var _=La(l)?pf:Zo.current;return _=Zg(s,_),Pg(s,m),l=tA(e,s,l,d,_,m),d=sA(),e!==null&&!Ra?(s.updateQueue=e.updateQueue,s.flags&=-2053,e.lanes&=~m,Xu(e,s,m)):(ii&&d&&$C(s),s.flags|=1,pa(e,s,l,m),s.child)}function K3(e,s,l,d,m){if(La(l)){var _=!0;Iw(s)}else _=!1;if(Pg(s,m),s.stateNode===null)iw(e,s),MO(s,l,d),oE(s,l,d,m),d=!0;else if(e===null){var w=s.stateNode,o=s.memoizedProps;w.props=o;var E=w.context,P=l.contextType;typeof P=="object"&&P!==null?P=Al(P):(P=La(l)?pf:Zo.current,P=Zg(s,P));var M=l.getDerivedStateFromProps,L=typeof M=="function"||typeof w.getSnapshotBeforeUpdate=="function";L||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(o!==d||E!==P)&&$3(s,w,d,P),oh=!1;var F=s.memoizedState;w.state=F,Lw(s,d,w,m),E=s.memoizedState,o!==d||F!==E||Da.current||oh?(typeof M=="function"&&(iE(s,l,M,d),E=s.memoizedState),(o=oh||U3(s,l,o,d,F,E,P))?(L||typeof w.UNSAFE_componentWillMount!="function"&&typeof w.componentWillMount!="function"||(typeof w.componentWillMount=="function"&&w.componentWillMount(),typeof w.UNSAFE_componentWillMount=="function"&&w.UNSAFE_componentWillMount()),typeof w.componentDidMount=="function"&&(s.flags|=4194308)):(typeof w.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=d,s.memoizedState=E),w.props=d,w.state=E,w.context=P,d=o):(typeof w.componentDidMount=="function"&&(s.flags|=4194308),d=!1)}else{w=s.stateNode,dO(e,s),o=s.memoizedProps,P=s.type===s.elementType?o:Xl(s.type,o),w.props=P,L=s.pendingProps,F=w.context,E=l.contextType,typeof E=="object"&&E!==null?E=Al(E):(E=La(l)?pf:Zo.current,E=Zg(s,E));var $=l.getDerivedStateFromProps;(M=typeof $=="function"||typeof w.getSnapshotBeforeUpdate=="function")||typeof w.UNSAFE_componentWillReceiveProps!="function"&&typeof w.componentWillReceiveProps!="function"||(o!==L||F!==E)&&$3(s,w,d,E),oh=!1,F=s.memoizedState,w.state=F,Lw(s,d,w,m);var Y=s.memoizedState;o!==L||F!==Y||Da.current||oh?(typeof $=="function"&&(iE(s,l,$,d),Y=s.memoizedState),(P=oh||U3(s,l,P,d,F,Y,E)||!1)?(M||typeof w.UNSAFE_componentWillUpdate!="function"&&typeof w.componentWillUpdate!="function"||(typeof w.componentWillUpdate=="function"&&w.componentWillUpdate(d,Y,E),typeof w.UNSAFE_componentWillUpdate=="function"&&w.UNSAFE_componentWillUpdate(d,Y,E)),typeof w.componentDidUpdate=="function"&&(s.flags|=4),typeof w.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof w.componentDidUpdate!="function"||o===e.memoizedProps&&F===e.memoizedState||(s.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&F===e.memoizedState||(s.flags|=1024),s.memoizedProps=d,s.memoizedState=Y),w.props=d,w.state=Y,w.context=E,d=P):(typeof w.componentDidUpdate!="function"||o===e.memoizedProps&&F===e.memoizedState||(s.flags|=4),typeof w.getSnapshotBeforeUpdate!="function"||o===e.memoizedProps&&F===e.memoizedState||(s.flags|=1024),d=!1)}return cE(e,s,l,d,_,m)}function cE(e,s,l,d,m,_){zO(e,s);var w=(s.flags&128)!==0;if(!d&&!w)return m&&k3(s,l,!1),Xu(e,s,_);d=s.stateNode,jq.current=s;var o=w&&typeof l.getDerivedStateFromError!="function"?null:d.render();return s.flags|=1,e!==null&&w?(s.child=Xg(s,e.child,null,_),s.child=Xg(s,null,o,_)):pa(e,s,o,_),s.memoizedState=d.state,m&&k3(s,l,!0),s.child}function OO(e){var s=e.stateNode;s.pendingContext?R3(e,s.pendingContext,s.pendingContext!==s.context):s.context&&R3(e,s.context,!1),YC(e,s.containerInfo)}function X3(e,s,l,d,m){return Kg(),HC(m),s.flags|=256,pa(e,s,l,d),s.child}var uE={dehydrated:null,treeContext:null,retryLane:0};function dE(e){return{baseLanes:e,cachePool:null,transitions:null}}function FO(e,s,l){var d=s.pendingProps,m=li.current,_=!1,w=(s.flags&128)!==0,o;if((o=w)||(o=e!==null&&e.memoizedState===null?!1:(m&2)!==0),o?(_=!0,s.flags&=-129):(e===null||e.memoizedState!==null)&&(m|=1),Kr(li,m&1),e===null)return nE(s),e=s.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?(s.mode&1?e.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(w=d.children,e=d.fallback,_?(d=s.mode,_=s.child,w={mode:"hidden",children:w},!(d&1)&&_!==null?(_.childLanes=0,_.pendingProps=w):_=C2(w,d,0,null),e=cf(e,d,l,null),_.return=s,e.return=s,_.sibling=e,s.child=_,s.child.memoizedState=dE(l),s.memoizedState=uE,e):iA(s,w));if(m=e.memoizedState,m!==null&&(o=m.dehydrated,o!==null))return Tq(e,s,w,d,o,m,l);if(_){_=d.fallback,w=s.mode,m=e.child,o=m.sibling;var E={mode:"hidden",children:d.children};return!(w&1)&&s.child!==m?(d=s.child,d.childLanes=0,d.pendingProps=E,s.deletions=null):(d=Th(m,E),d.subtreeFlags=m.subtreeFlags&14680064),o!==null?_=Th(o,_):(_=cf(_,w,l,null),_.flags|=2),_.return=s,d.return=s,d.sibling=_,s.child=d,d=_,_=s.child,w=e.child.memoizedState,w=w===null?dE(l):{baseLanes:w.baseLanes|l,cachePool:null,transitions:w.transitions},_.memoizedState=w,_.childLanes=e.childLanes&~l,s.memoizedState=uE,d}return _=e.child,e=_.sibling,d=Th(_,{mode:"visible",children:d.children}),!(s.mode&1)&&(d.lanes=l),d.return=s,d.sibling=null,e!==null&&(l=s.deletions,l===null?(s.deletions=[e],s.flags|=16):l.push(e)),s.child=d,s.memoizedState=null,d}function iA(e,s){return s=C2({mode:"visible",children:s},e.mode,0,null),s.return=e,e.child=s}function Rb(e,s,l,d){return d!==null&&HC(d),Xg(s,e.child,null,l),e=iA(s,s.pendingProps.children),e.flags|=2,s.memoizedState=null,e}function Tq(e,s,l,d,m,_,w){if(l)return s.flags&256?(s.flags&=-257,d=UT(Error(ms(422))),Rb(e,s,w,d)):s.memoizedState!==null?(s.child=e.child,s.flags|=128,null):(_=d.fallback,m=s.mode,d=C2({mode:"visible",children:d.children},m,0,null),_=cf(_,m,w,null),_.flags|=2,d.return=s,_.return=s,d.sibling=_,s.child=d,s.mode&1&&Xg(s,e.child,null,w),s.child.memoizedState=dE(w),s.memoizedState=uE,_);if(!(s.mode&1))return Rb(e,s,w,null);if(m.data==="$!"){if(d=m.nextSibling&&m.nextSibling.dataset,d)var o=d.dgst;return d=o,_=Error(ms(419)),d=UT(_,d,void 0),Rb(e,s,w,d)}if(o=(w&e.childLanes)!==0,Ra||o){if(d=vo,d!==null){switch(w&-w){case 4:m=2;break;case 16:m=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:m=32;break;case 536870912:m=268435456;break;default:m=0}m=m&(d.suspendedLanes|w)?0:m,m!==0&&m!==_.retryLane&&(_.retryLane=m,Ku(e,m),nc(d,e,m,-1))}return dA(),d=UT(Error(ms(421))),Rb(e,s,w,d)}return m.data==="$?"?(s.flags|=128,s.child=e.child,s=Oq.bind(null,e),m._reactRetry=s,null):(e=_.treeContext,Ja=bh(m.nextSibling),Qa=s,ii=!0,tc=null,e!==null&&(Sl[jl++]=Vu,Sl[jl++]=Uu,Sl[jl++]=ff,Vu=e.id,Uu=e.overflow,ff=s),s=iA(s,d.children),s.flags|=4096,s)}function Y3(e,s,l){e.lanes|=s;var d=e.alternate;d!==null&&(d.lanes|=s),rE(e.return,s,l)}function $T(e,s,l,d,m){var _=e.memoizedState;_===null?e.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:d,tail:l,tailMode:m}:(_.isBackwards=s,_.rendering=null,_.renderingStartTime=0,_.last=d,_.tail=l,_.tailMode=m)}function BO(e,s,l){var d=s.pendingProps,m=d.revealOrder,_=d.tail;if(pa(e,s,d.children,l),d=li.current,d&2)d=d&1|2,s.flags|=128;else{if(e!==null&&e.flags&128)e:for(e=s.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Y3(e,l,s);else if(e.tag===19)Y3(e,l,s);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===s)break e;for(;e.sibling===null;){if(e.return===null||e.return===s)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}d&=1}if(Kr(li,d),!(s.mode&1))s.memoizedState=null;else switch(m){case"forwards":for(l=s.child,m=null;l!==null;)e=l.alternate,e!==null&&zw(e)===null&&(m=l),l=l.sibling;l=m,l===null?(m=s.child,s.child=null):(m=l.sibling,l.sibling=null),$T(s,!1,m,l,_);break;case"backwards":for(l=null,m=s.child,s.child=null;m!==null;){if(e=m.alternate,e!==null&&zw(e)===null){s.child=m;break}e=m.sibling,m.sibling=l,l=m,m=e}$T(s,!0,l,null,_);break;case"together":$T(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function iw(e,s){!(s.mode&1)&&e!==null&&(e.alternate=null,s.alternate=null,s.flags|=2)}function Xu(e,s,l){if(e!==null&&(s.dependencies=e.dependencies),gf|=s.lanes,!(l&s.childLanes))return null;if(e!==null&&s.child!==e.child)throw Error(ms(153));if(s.child!==null){for(e=s.child,l=Th(e,e.pendingProps),s.child=l,l.return=s;e.sibling!==null;)e=e.sibling,l=l.sibling=Th(e,e.pendingProps),l.return=s;l.sibling=null}return s.child}function Nq(e,s,l){switch(s.tag){case 3:OO(s),Kg();break;case 5:hO(s);break;case 1:La(s.type)&&Iw(s);break;case 4:YC(s,s.stateNode.containerInfo);break;case 10:var d=s.type._context,m=s.memoizedProps.value;Kr(kw,d._currentValue),d._currentValue=m;break;case 13:if(d=s.memoizedState,d!==null)return d.dehydrated!==null?(Kr(li,li.current&1),s.flags|=128,null):l&s.child.childLanes?FO(e,s,l):(Kr(li,li.current&1),e=Xu(e,s,l),e!==null?e.sibling:null);Kr(li,li.current&1);break;case 19:if(d=(l&s.childLanes)!==0,e.flags&128){if(d)return BO(e,s,l);s.flags|=128}if(m=s.memoizedState,m!==null&&(m.rendering=null,m.tail=null,m.lastEffect=null),Kr(li,li.current),d)break;return null;case 22:case 23:return s.lanes=0,LO(e,s,l)}return Xu(e,s,l)}var VO,hE,UO,$O;VO=function(e,s){for(var l=s.child;l!==null;){if(l.tag===5||l.tag===6)e.appendChild(l.stateNode);else if(l.tag!==4&&l.child!==null){l.child.return=l,l=l.child;continue}if(l===s)break;for(;l.sibling===null;){if(l.return===null||l.return===s)return;l=l.return}l.sibling.return=l.return,l=l.sibling}};hE=function(){};UO=function(e,s,l,d){var m=e.memoizedProps;if(m!==d){e=s.stateNode,Xp(Jc.current);var _=null;switch(l){case"input":m=kN(e,m),d=kN(e,d),_=[];break;case"select":m=fi({},m,{value:void 0}),d=fi({},d,{value:void 0}),_=[];break;case"textarea":m=zN(e,m),d=zN(e,d),_=[];break;default:typeof m.onClick!="function"&&typeof d.onClick=="function"&&(e.onclick=Aw)}FN(l,d);var w;l=null;for(P in m)if(!d.hasOwnProperty(P)&&m.hasOwnProperty(P)&&m[P]!=null)if(P==="style"){var o=m[P];for(w in o)o.hasOwnProperty(w)&&(l||(l={}),l[w]="")}else P!=="dangerouslySetInnerHTML"&&P!=="children"&&P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&P!=="autoFocus"&&(u0.hasOwnProperty(P)?_||(_=[]):(_=_||[]).push(P,null));for(P in d){var E=d[P];if(o=m!=null?m[P]:void 0,d.hasOwnProperty(P)&&E!==o&&(E!=null||o!=null))if(P==="style")if(o){for(w in o)!o.hasOwnProperty(w)||E&&E.hasOwnProperty(w)||(l||(l={}),l[w]="");for(w in E)E.hasOwnProperty(w)&&o[w]!==E[w]&&(l||(l={}),l[w]=E[w])}else l||(_||(_=[]),_.push(P,l)),l=E;else P==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,o=o?o.__html:void 0,E!=null&&o!==E&&(_=_||[]).push(P,E)):P==="children"?typeof E!="string"&&typeof E!="number"||(_=_||[]).push(P,""+E):P!=="suppressContentEditableWarning"&&P!=="suppressHydrationWarning"&&(u0.hasOwnProperty(P)?(E!=null&&P==="onScroll"&&ei("scroll",e),_||o===E||(_=[])):(_=_||[]).push(P,E))}l&&(_=_||[]).push("style",l);var P=_;(s.updateQueue=P)&&(s.flags|=4)}};$O=function(e,s,l,d){l!==d&&(s.flags|=4)};function L_(e,s){if(!ii)switch(e.tailMode){case"hidden":s=e.tail;for(var l=null;s!==null;)s.alternate!==null&&(l=s),s=s.sibling;l===null?e.tail=null:l.sibling=null;break;case"collapsed":l=e.tail;for(var d=null;l!==null;)l.alternate!==null&&(d=l),l=l.sibling;d===null?s||e.tail===null?e.tail=null:e.tail.sibling=null:d.sibling=null}}function $o(e){var s=e.alternate!==null&&e.alternate.child===e.child,l=0,d=0;if(s)for(var m=e.child;m!==null;)l|=m.lanes|m.childLanes,d|=m.subtreeFlags&14680064,d|=m.flags&14680064,m.return=e,m=m.sibling;else for(m=e.child;m!==null;)l|=m.lanes|m.childLanes,d|=m.subtreeFlags,d|=m.flags,m.return=e,m=m.sibling;return e.subtreeFlags|=d,e.childLanes=l,s}function Eq(e,s,l){var d=s.pendingProps;switch(GC(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return $o(s),null;case 1:return La(s.type)&&Pw(),$o(s),null;case 3:return d=s.stateNode,Yg(),si(Da),si(Zo),QC(),d.pendingContext&&(d.context=d.pendingContext,d.pendingContext=null),(e===null||e.child===null)&&(Ib(s)?s.flags|=4:e===null||e.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,tc!==null&&(vE(tc),tc=null))),hE(e,s),$o(s),null;case 5:JC(s);var m=Xp(w0.current);if(l=s.type,e!==null&&s.stateNode!=null)UO(e,s,l,d,m),e.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!d){if(s.stateNode===null)throw Error(ms(166));return $o(s),null}if(e=Xp(Jc.current),Ib(s)){d=s.stateNode,l=s.type;var _=s.memoizedProps;switch(d[Zc]=s,d[v0]=_,e=(s.mode&1)!==0,l){case"dialog":ei("cancel",d),ei("close",d);break;case"iframe":case"object":case"embed":ei("load",d);break;case"video":case"audio":for(m=0;m<H_.length;m++)ei(H_[m],d);break;case"source":ei("error",d);break;case"img":case"image":case"link":ei("error",d),ei("load",d);break;case"details":ei("toggle",d);break;case"input":o3(d,_),ei("invalid",d);break;case"select":d._wrapperState={wasMultiple:!!_.multiple},ei("invalid",d);break;case"textarea":l3(d,_),ei("invalid",d)}FN(l,_),m=null;for(var w in _)if(_.hasOwnProperty(w)){var o=_[w];w==="children"?typeof o=="string"?d.textContent!==o&&(_.suppressHydrationWarning!==!0&&Pb(d.textContent,o,e),m=["children",o]):typeof o=="number"&&d.textContent!==""+o&&(_.suppressHydrationWarning!==!0&&Pb(d.textContent,o,e),m=["children",""+o]):u0.hasOwnProperty(w)&&o!=null&&w==="onScroll"&&ei("scroll",d)}switch(l){case"input":wb(d),a3(d,_,!0);break;case"textarea":wb(d),c3(d);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(d.onclick=Aw)}d=m,s.updateQueue=d,d!==null&&(s.flags|=4)}else{w=m.nodeType===9?m:m.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=xz(l)),e==="http://www.w3.org/1999/xhtml"?l==="script"?(e=w.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof d.is=="string"?e=w.createElement(l,{is:d.is}):(e=w.createElement(l),l==="select"&&(w=e,d.multiple?w.multiple=!0:d.size&&(w.size=d.size))):e=w.createElementNS(e,l),e[Zc]=s,e[v0]=d,VO(e,s,!1,!1),s.stateNode=e;e:{switch(w=BN(l,d),l){case"dialog":ei("cancel",e),ei("close",e),m=d;break;case"iframe":case"object":case"embed":ei("load",e),m=d;break;case"video":case"audio":for(m=0;m<H_.length;m++)ei(H_[m],e);m=d;break;case"source":ei("error",e),m=d;break;case"img":case"image":case"link":ei("error",e),ei("load",e),m=d;break;case"details":ei("toggle",e),m=d;break;case"input":o3(e,d),m=kN(e,d),ei("invalid",e);break;case"option":m=d;break;case"select":e._wrapperState={wasMultiple:!!d.multiple},m=fi({},d,{value:void 0}),ei("invalid",e);break;case"textarea":l3(e,d),m=zN(e,d),ei("invalid",e);break;default:m=d}FN(l,m),o=m;for(_ in o)if(o.hasOwnProperty(_)){var E=o[_];_==="style"?vz(e,E):_==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&yz(e,E)):_==="children"?typeof E=="string"?(l!=="textarea"||E!=="")&&d0(e,E):typeof E=="number"&&d0(e,""+E):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(u0.hasOwnProperty(_)?E!=null&&_==="onScroll"&&ei("scroll",e):E!=null&&AC(e,_,E,w))}switch(l){case"input":wb(e),a3(e,d,!1);break;case"textarea":wb(e),c3(e);break;case"option":d.value!=null&&e.setAttribute("value",""+Ah(d.value));break;case"select":e.multiple=!!d.multiple,_=d.value,_!=null?Ng(e,!!d.multiple,_,!1):d.defaultValue!=null&&Ng(e,!!d.multiple,d.defaultValue,!0);break;default:typeof m.onClick=="function"&&(e.onclick=Aw)}switch(l){case"button":case"input":case"select":case"textarea":d=!!d.autoFocus;break e;case"img":d=!0;break e;default:d=!1}}d&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return $o(s),null;case 6:if(e&&s.stateNode!=null)$O(e,s,e.memoizedProps,d);else{if(typeof d!="string"&&s.stateNode===null)throw Error(ms(166));if(l=Xp(w0.current),Xp(Jc.current),Ib(s)){if(d=s.stateNode,l=s.memoizedProps,d[Zc]=s,(_=d.nodeValue!==l)&&(e=Qa,e!==null))switch(e.tag){case 3:Pb(d.nodeValue,l,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&Pb(d.nodeValue,l,(e.mode&1)!==0)}_&&(s.flags|=4)}else d=(l.nodeType===9?l:l.ownerDocument).createTextNode(d),d[Zc]=s,s.stateNode=d}return $o(s),null;case 13:if(si(li),d=s.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(ii&&Ja!==null&&s.mode&1&&!(s.flags&128))aO(),Kg(),s.flags|=98560,_=!1;else if(_=Ib(s),d!==null&&d.dehydrated!==null){if(e===null){if(!_)throw Error(ms(318));if(_=s.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(ms(317));_[Zc]=s}else Kg(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;$o(s),_=!1}else tc!==null&&(vE(tc),tc=null),_=!0;if(!_)return s.flags&65536?s:null}return s.flags&128?(s.lanes=l,s):(d=d!==null,d!==(e!==null&&e.memoizedState!==null)&&d&&(s.child.flags|=8192,s.mode&1&&(e===null||li.current&1?ro===0&&(ro=3):dA())),s.updateQueue!==null&&(s.flags|=4),$o(s),null);case 4:return Yg(),hE(e,s),e===null&&y0(s.stateNode.containerInfo),$o(s),null;case 10:return ZC(s.type._context),$o(s),null;case 17:return La(s.type)&&Pw(),$o(s),null;case 19:if(si(li),_=s.memoizedState,_===null)return $o(s),null;if(d=(s.flags&128)!==0,w=_.rendering,w===null)if(d)L_(_,!1);else{if(ro!==0||e!==null&&e.flags&128)for(e=s.child;e!==null;){if(w=zw(e),w!==null){for(s.flags|=128,L_(_,!1),d=w.updateQueue,d!==null&&(s.updateQueue=d,s.flags|=4),s.subtreeFlags=0,d=l,l=s.child;l!==null;)_=l,e=d,_.flags&=14680066,w=_.alternate,w===null?(_.childLanes=0,_.lanes=e,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=w.childLanes,_.lanes=w.lanes,_.child=w.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=w.memoizedProps,_.memoizedState=w.memoizedState,_.updateQueue=w.updateQueue,_.type=w.type,e=w.dependencies,_.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),l=l.sibling;return Kr(li,li.current&1|2),s.child}e=e.sibling}_.tail!==null&&ki()>Qg&&(s.flags|=128,d=!0,L_(_,!1),s.lanes=4194304)}else{if(!d)if(e=zw(w),e!==null){if(s.flags|=128,d=!0,l=e.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),L_(_,!0),_.tail===null&&_.tailMode==="hidden"&&!w.alternate&&!ii)return $o(s),null}else 2*ki()-_.renderingStartTime>Qg&&l!==1073741824&&(s.flags|=128,d=!0,L_(_,!1),s.lanes=4194304);_.isBackwards?(w.sibling=s.child,s.child=w):(l=_.last,l!==null?l.sibling=w:s.child=w,_.last=w)}return _.tail!==null?(s=_.tail,_.rendering=s,_.tail=s.sibling,_.renderingStartTime=ki(),s.sibling=null,l=li.current,Kr(li,d?l&1|2:l&1),s):($o(s),null);case 22:case 23:return uA(),d=s.memoizedState!==null,e!==null&&e.memoizedState!==null!==d&&(s.flags|=8192),d&&s.mode&1?Ka&1073741824&&($o(s),s.subtreeFlags&6&&(s.flags|=8192)):$o(s),null;case 24:return null;case 25:return null}throw Error(ms(156,s.tag))}function Cq(e,s){switch(GC(s),s.tag){case 1:return La(s.type)&&Pw(),e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 3:return Yg(),si(Da),si(Zo),QC(),e=s.flags,e&65536&&!(e&128)?(s.flags=e&-65537|128,s):null;case 5:return JC(s),null;case 13:if(si(li),e=s.memoizedState,e!==null&&e.dehydrated!==null){if(s.alternate===null)throw Error(ms(340));Kg()}return e=s.flags,e&65536?(s.flags=e&-65537|128,s):null;case 19:return si(li),null;case 4:return Yg(),null;case 10:return ZC(s.type._context),null;case 22:case 23:return uA(),null;case 24:return null;default:return null}}var kb=!1,Ho=!1,Aq=typeof WeakSet=="function"?WeakSet:Set,Us=null;function xg(e,s){var l=e.ref;if(l!==null)if(typeof l=="function")try{l(null)}catch(d){Ti(e,s,d)}else l.current=null}function pE(e,s,l){try{l()}catch(d){Ti(e,s,d)}}var J3=!1;function Pq(e,s){if(XN=Nw,e=Zz(),UC(e)){if("selectionStart"in e)var l={start:e.selectionStart,end:e.selectionEnd};else e:{l=(l=e.ownerDocument)&&l.defaultView||window;var d=l.getSelection&&l.getSelection();if(d&&d.rangeCount!==0){l=d.anchorNode;var m=d.anchorOffset,_=d.focusNode;d=d.focusOffset;try{l.nodeType,_.nodeType}catch{l=null;break e}var w=0,o=-1,E=-1,P=0,M=0,L=e,F=null;t:for(;;){for(var $;L!==l||m!==0&&L.nodeType!==3||(o=w+m),L!==_||d!==0&&L.nodeType!==3||(E=w+d),L.nodeType===3&&(w+=L.nodeValue.length),($=L.firstChild)!==null;)F=L,L=$;for(;;){if(L===e)break t;if(F===l&&++P===m&&(o=w),F===_&&++M===d&&(E=w),($=L.nextSibling)!==null)break;L=F,F=L.parentNode}L=$}l=o===-1||E===-1?null:{start:o,end:E}}else l=null}l=l||{start:0,end:0}}else l=null;for(YN={focusedElem:e,selectionRange:l},Nw=!1,Us=s;Us!==null;)if(s=Us,e=s.child,(s.subtreeFlags&1028)!==0&&e!==null)e.return=s,Us=e;else for(;Us!==null;){s=Us;try{var Y=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(Y!==null){var H=Y.memoizedProps,X=Y.memoizedState,Z=s.stateNode,W=Z.getSnapshotBeforeUpdate(s.elementType===s.type?H:Xl(s.type,H),X);Z.__reactInternalSnapshotBeforeUpdate=W}break;case 3:var q=s.stateNode.containerInfo;q.nodeType===1?q.textContent="":q.nodeType===9&&q.documentElement&&q.removeChild(q.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(ms(163))}}catch(oe){Ti(s,s.return,oe)}if(e=s.sibling,e!==null){e.return=s.return,Us=e;break}Us=s.return}return Y=J3,J3=!1,Y}function t0(e,s,l){var d=s.updateQueue;if(d=d!==null?d.lastEffect:null,d!==null){var m=d=d.next;do{if((m.tag&e)===e){var _=m.destroy;m.destroy=void 0,_!==void 0&&pE(s,l,_)}m=m.next}while(m!==d)}}function N2(e,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var l=s=s.next;do{if((l.tag&e)===e){var d=l.create;l.destroy=d()}l=l.next}while(l!==s)}}function fE(e){var s=e.ref;if(s!==null){var l=e.stateNode;switch(e.tag){case 5:e=l;break;default:e=l}typeof s=="function"?s(e):s.current=e}}function GO(e){var s=e.alternate;s!==null&&(e.alternate=null,GO(s)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(s=e.stateNode,s!==null&&(delete s[Zc],delete s[v0],delete s[eE],delete s[hq],delete s[pq])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function HO(e){return e.tag===5||e.tag===3||e.tag===4}function Q3(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||HO(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function mE(e,s,l){var d=e.tag;if(d===5||d===6)e=e.stateNode,s?l.nodeType===8?l.parentNode.insertBefore(e,s):l.insertBefore(e,s):(l.nodeType===8?(s=l.parentNode,s.insertBefore(e,l)):(s=l,s.appendChild(e)),l=l._reactRootContainer,l!=null||s.onclick!==null||(s.onclick=Aw));else if(d!==4&&(e=e.child,e!==null))for(mE(e,s,l),e=e.sibling;e!==null;)mE(e,s,l),e=e.sibling}function gE(e,s,l){var d=e.tag;if(d===5||d===6)e=e.stateNode,s?l.insertBefore(e,s):l.appendChild(e);else if(d!==4&&(e=e.child,e!==null))for(gE(e,s,l),e=e.sibling;e!==null;)gE(e,s,l),e=e.sibling}var Io=null,ec=!1;function Qd(e,s,l){for(l=l.child;l!==null;)WO(e,s,l),l=l.sibling}function WO(e,s,l){if(Yc&&typeof Yc.onCommitFiberUnmount=="function")try{Yc.onCommitFiberUnmount(y2,l)}catch{}switch(l.tag){case 5:Ho||xg(l,s);case 6:var d=Io,m=ec;Io=null,Qd(e,s,l),Io=d,ec=m,Io!==null&&(ec?(e=Io,l=l.stateNode,e.nodeType===8?e.parentNode.removeChild(l):e.removeChild(l)):Io.removeChild(l.stateNode));break;case 18:Io!==null&&(ec?(e=Io,l=l.stateNode,e.nodeType===8?LT(e.parentNode,l):e.nodeType===1&&LT(e,l),m0(e)):LT(Io,l.stateNode));break;case 4:d=Io,m=ec,Io=l.stateNode.containerInfo,ec=!0,Qd(e,s,l),Io=d,ec=m;break;case 0:case 11:case 14:case 15:if(!Ho&&(d=l.updateQueue,d!==null&&(d=d.lastEffect,d!==null))){m=d=d.next;do{var _=m,w=_.destroy;_=_.tag,w!==void 0&&(_&2||_&4)&&pE(l,s,w),m=m.next}while(m!==d)}Qd(e,s,l);break;case 1:if(!Ho&&(xg(l,s),d=l.stateNode,typeof d.componentWillUnmount=="function"))try{d.props=l.memoizedProps,d.state=l.memoizedState,d.componentWillUnmount()}catch(o){Ti(l,s,o)}Qd(e,s,l);break;case 21:Qd(e,s,l);break;case 22:l.mode&1?(Ho=(d=Ho)||l.memoizedState!==null,Qd(e,s,l),Ho=d):Qd(e,s,l);break;default:Qd(e,s,l)}}function eD(e){var s=e.updateQueue;if(s!==null){e.updateQueue=null;var l=e.stateNode;l===null&&(l=e.stateNode=new Aq),s.forEach(function(d){var m=Fq.bind(null,e,d);l.has(d)||(l.add(d),d.then(m,m))})}}function Wl(e,s){var l=s.deletions;if(l!==null)for(var d=0;d<l.length;d++){var m=l[d];try{var _=e,w=s,o=w;e:for(;o!==null;){switch(o.tag){case 5:Io=o.stateNode,ec=!1;break e;case 3:Io=o.stateNode.containerInfo,ec=!0;break e;case 4:Io=o.stateNode.containerInfo,ec=!0;break e}o=o.return}if(Io===null)throw Error(ms(160));WO(_,w,m),Io=null,ec=!1;var E=m.alternate;E!==null&&(E.return=null),m.return=null}catch(P){Ti(m,s,P)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)qO(s,e),s=s.sibling}function qO(e,s){var l=e.alternate,d=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Wl(s,e),Uc(e),d&4){try{t0(3,e,e.return),N2(3,e)}catch(H){Ti(e,e.return,H)}try{t0(5,e,e.return)}catch(H){Ti(e,e.return,H)}}break;case 1:Wl(s,e),Uc(e),d&512&&l!==null&&xg(l,l.return);break;case 5:if(Wl(s,e),Uc(e),d&512&&l!==null&&xg(l,l.return),e.flags&32){var m=e.stateNode;try{d0(m,"")}catch(H){Ti(e,e.return,H)}}if(d&4&&(m=e.stateNode,m!=null)){var _=e.memoizedProps,w=l!==null?l.memoizedProps:_,o=e.type,E=e.updateQueue;if(e.updateQueue=null,E!==null)try{o==="input"&&_.type==="radio"&&_.name!=null&&mz(m,_),BN(o,w);var P=BN(o,_);for(w=0;w<E.length;w+=2){var M=E[w],L=E[w+1];M==="style"?vz(m,L):M==="dangerouslySetInnerHTML"?yz(m,L):M==="children"?d0(m,L):AC(m,M,L,P)}switch(o){case"input":DN(m,_);break;case"textarea":gz(m,_);break;case"select":var F=m._wrapperState.wasMultiple;m._wrapperState.wasMultiple=!!_.multiple;var $=_.value;$!=null?Ng(m,!!_.multiple,$,!1):F!==!!_.multiple&&(_.defaultValue!=null?Ng(m,!!_.multiple,_.defaultValue,!0):Ng(m,!!_.multiple,_.multiple?[]:"",!1))}m[v0]=_}catch(H){Ti(e,e.return,H)}}break;case 6:if(Wl(s,e),Uc(e),d&4){if(e.stateNode===null)throw Error(ms(162));m=e.stateNode,_=e.memoizedProps;try{m.nodeValue=_}catch(H){Ti(e,e.return,H)}}break;case 3:if(Wl(s,e),Uc(e),d&4&&l!==null&&l.memoizedState.isDehydrated)try{m0(s.containerInfo)}catch(H){Ti(e,e.return,H)}break;case 4:Wl(s,e),Uc(e);break;case 13:Wl(s,e),Uc(e),m=e.child,m.flags&8192&&(_=m.memoizedState!==null,m.stateNode.isHidden=_,!_||m.alternate!==null&&m.alternate.memoizedState!==null||(lA=ki())),d&4&&eD(e);break;case 22:if(M=l!==null&&l.memoizedState!==null,e.mode&1?(Ho=(P=Ho)||M,Wl(s,e),Ho=P):Wl(s,e),Uc(e),d&8192){if(P=e.memoizedState!==null,(e.stateNode.isHidden=P)&&!M&&e.mode&1)for(Us=e,M=e.child;M!==null;){for(L=Us=M;Us!==null;){switch(F=Us,$=F.child,F.tag){case 0:case 11:case 14:case 15:t0(4,F,F.return);break;case 1:xg(F,F.return);var Y=F.stateNode;if(typeof Y.componentWillUnmount=="function"){d=F,l=F.return;try{s=d,Y.props=s.memoizedProps,Y.state=s.memoizedState,Y.componentWillUnmount()}catch(H){Ti(d,l,H)}}break;case 5:xg(F,F.return);break;case 22:if(F.memoizedState!==null){sD(L);continue}}$!==null?($.return=F,Us=$):sD(L)}M=M.sibling}e:for(M=null,L=e;;){if(L.tag===5){if(M===null){M=L;try{m=L.stateNode,P?(_=m.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(o=L.stateNode,E=L.memoizedProps.style,w=E!=null&&E.hasOwnProperty("display")?E.display:null,o.style.display=_z("display",w))}catch(H){Ti(e,e.return,H)}}}else if(L.tag===6){if(M===null)try{L.stateNode.nodeValue=P?"":L.memoizedProps}catch(H){Ti(e,e.return,H)}}else if((L.tag!==22&&L.tag!==23||L.memoizedState===null||L===e)&&L.child!==null){L.child.return=L,L=L.child;continue}if(L===e)break e;for(;L.sibling===null;){if(L.return===null||L.return===e)break e;M===L&&(M=null),L=L.return}M===L&&(M=null),L.sibling.return=L.return,L=L.sibling}}break;case 19:Wl(s,e),Uc(e),d&4&&eD(e);break;case 21:break;default:Wl(s,e),Uc(e)}}function Uc(e){var s=e.flags;if(s&2){try{e:{for(var l=e.return;l!==null;){if(HO(l)){var d=l;break e}l=l.return}throw Error(ms(160))}switch(d.tag){case 5:var m=d.stateNode;d.flags&32&&(d0(m,""),d.flags&=-33);var _=Q3(e);gE(e,_,m);break;case 3:case 4:var w=d.stateNode.containerInfo,o=Q3(e);mE(e,o,w);break;default:throw Error(ms(161))}}catch(E){Ti(e,e.return,E)}e.flags&=-3}s&4096&&(e.flags&=-4097)}function Iq(e,s,l){Us=e,ZO(e)}function ZO(e,s,l){for(var d=(e.mode&1)!==0;Us!==null;){var m=Us,_=m.child;if(m.tag===22&&d){var w=m.memoizedState!==null||kb;if(!w){var o=m.alternate,E=o!==null&&o.memoizedState!==null||Ho;o=kb;var P=Ho;if(kb=w,(Ho=E)&&!P)for(Us=m;Us!==null;)w=Us,E=w.child,w.tag===22&&w.memoizedState!==null?nD(m):E!==null?(E.return=w,Us=E):nD(m);for(;_!==null;)Us=_,ZO(_),_=_.sibling;Us=m,kb=o,Ho=P}tD(e)}else m.subtreeFlags&8772&&_!==null?(_.return=m,Us=_):tD(e)}}function tD(e){for(;Us!==null;){var s=Us;if(s.flags&8772){var l=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:Ho||N2(5,s);break;case 1:var d=s.stateNode;if(s.flags&4&&!Ho)if(l===null)d.componentDidMount();else{var m=s.elementType===s.type?l.memoizedProps:Xl(s.type,l.memoizedProps);d.componentDidUpdate(m,l.memoizedState,d.__reactInternalSnapshotBeforeUpdate)}var _=s.updateQueue;_!==null&&F3(s,_,d);break;case 3:var w=s.updateQueue;if(w!==null){if(l=null,s.child!==null)switch(s.child.tag){case 5:l=s.child.stateNode;break;case 1:l=s.child.stateNode}F3(s,w,l)}break;case 5:var o=s.stateNode;if(l===null&&s.flags&4){l=o;var E=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&l.focus();break;case"img":E.src&&(l.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var P=s.alternate;if(P!==null){var M=P.memoizedState;if(M!==null){var L=M.dehydrated;L!==null&&m0(L)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(ms(163))}Ho||s.flags&512&&fE(s)}catch(F){Ti(s,s.return,F)}}if(s===e){Us=null;break}if(l=s.sibling,l!==null){l.return=s.return,Us=l;break}Us=s.return}}function sD(e){for(;Us!==null;){var s=Us;if(s===e){Us=null;break}var l=s.sibling;if(l!==null){l.return=s.return,Us=l;break}Us=s.return}}function nD(e){for(;Us!==null;){var s=Us;try{switch(s.tag){case 0:case 11:case 15:var l=s.return;try{N2(4,s)}catch(E){Ti(s,l,E)}break;case 1:var d=s.stateNode;if(typeof d.componentDidMount=="function"){var m=s.return;try{d.componentDidMount()}catch(E){Ti(s,m,E)}}var _=s.return;try{fE(s)}catch(E){Ti(s,_,E)}break;case 5:var w=s.return;try{fE(s)}catch(E){Ti(s,w,E)}}}catch(E){Ti(s,s.return,E)}if(s===e){Us=null;break}var o=s.sibling;if(o!==null){o.return=s.return,Us=o;break}Us=s.return}}var Mq=Math.ceil,Bw=id.ReactCurrentDispatcher,oA=id.ReactCurrentOwner,Nl=id.ReactCurrentBatchConfig,Tr=0,vo=null,qi=null,Ro=0,Ka=0,yg=Oh(0),ro=0,N0=null,gf=0,E2=0,aA=0,s0=null,Ma=null,lA=0,Qg=1/0,zu=null,Vw=!1,xE=null,Sh=null,Db=!1,mh=null,Uw=0,n0=0,yE=null,ow=-1,aw=0;function ga(){return Tr&6?ki():ow!==-1?ow:ow=ki()}function jh(e){return e.mode&1?Tr&2&&Ro!==0?Ro&-Ro:mq.transition!==null?(aw===0&&(aw=Mz()),aw):(e=Fr,e!==0||(e=window.event,e=e===void 0?16:Fz(e.type)),e):1}function nc(e,s,l,d){if(50<n0)throw n0=0,yE=null,Error(ms(185));q0(e,l,d),(!(Tr&2)||e!==vo)&&(e===vo&&(!(Tr&2)&&(E2|=l),ro===4&&lh(e,Ro)),za(e,d),l===1&&Tr===0&&!(s.mode&1)&&(Qg=ki()+500,S2&&Fh()))}function za(e,s){var l=e.callbackNode;mW(e,s);var d=Tw(e,e===vo?Ro:0);if(d===0)l!==null&&h3(l),e.callbackNode=null,e.callbackPriority=0;else if(s=d&-d,e.callbackPriority!==s){if(l!=null&&h3(l),s===1)e.tag===0?fq(rD.bind(null,e)):rO(rD.bind(null,e)),uq(function(){!(Tr&6)&&Fh()}),l=null;else{switch(Rz(d)){case 1:l=kC;break;case 4:l=Pz;break;case 16:l=jw;break;case 536870912:l=Iz;break;default:l=jw}l=sF(l,KO.bind(null,e))}e.callbackPriority=s,e.callbackNode=l}}function KO(e,s){if(ow=-1,aw=0,Tr&6)throw Error(ms(327));var l=e.callbackNode;if(Ig()&&e.callbackNode!==l)return null;var d=Tw(e,e===vo?Ro:0);if(d===0)return null;if(d&30||d&e.expiredLanes||s)s=$w(e,d);else{s=d;var m=Tr;Tr|=2;var _=YO();(vo!==e||Ro!==s)&&(zu=null,Qg=ki()+500,lf(e,s));do try{Dq();break}catch(o){XO(e,o)}while(!0);qC(),Bw.current=_,Tr=m,qi!==null?s=0:(vo=null,Ro=0,s=ro)}if(s!==0){if(s===2&&(m=HN(e),m!==0&&(d=m,s=_E(e,m))),s===1)throw l=N0,lf(e,0),lh(e,d),za(e,ki()),l;if(s===6)lh(e,d);else{if(m=e.current.alternate,!(d&30)&&!Rq(m)&&(s=$w(e,d),s===2&&(_=HN(e),_!==0&&(d=_,s=_E(e,_))),s===1))throw l=N0,lf(e,0),lh(e,d),za(e,ki()),l;switch(e.finishedWork=m,e.finishedLanes=d,s){case 0:case 1:throw Error(ms(345));case 2:Wp(e,Ma,zu);break;case 3:if(lh(e,d),(d&130023424)===d&&(s=lA+500-ki(),10<s)){if(Tw(e,0)!==0)break;if(m=e.suspendedLanes,(m&d)!==d){ga(),e.pingedLanes|=e.suspendedLanes&m;break}e.timeoutHandle=QN(Wp.bind(null,e,Ma,zu),s);break}Wp(e,Ma,zu);break;case 4:if(lh(e,d),(d&4194240)===d)break;for(s=e.eventTimes,m=-1;0<d;){var w=31-sc(d);_=1<<w,w=s[w],w>m&&(m=w),d&=~_}if(d=m,d=ki()-d,d=(120>d?120:480>d?480:1080>d?1080:1920>d?1920:3e3>d?3e3:4320>d?4320:1960*Mq(d/1960))-d,10<d){e.timeoutHandle=QN(Wp.bind(null,e,Ma,zu),d);break}Wp(e,Ma,zu);break;case 5:Wp(e,Ma,zu);break;default:throw Error(ms(329))}}}return za(e,ki()),e.callbackNode===l?KO.bind(null,e):null}function _E(e,s){var l=s0;return e.current.memoizedState.isDehydrated&&(lf(e,s).flags|=256),e=$w(e,s),e!==2&&(s=Ma,Ma=l,s!==null&&vE(s)),e}function vE(e){Ma===null?Ma=e:Ma.push.apply(Ma,e)}function Rq(e){for(var s=e;;){if(s.flags&16384){var l=s.updateQueue;if(l!==null&&(l=l.stores,l!==null))for(var d=0;d<l.length;d++){var m=l[d],_=m.getSnapshot;m=m.value;try{if(!rc(_(),m))return!1}catch{return!1}}}if(l=s.child,s.subtreeFlags&16384&&l!==null)l.return=s,s=l;else{if(s===e)break;for(;s.sibling===null;){if(s.return===null||s.return===e)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function lh(e,s){for(s&=~aA,s&=~E2,e.suspendedLanes|=s,e.pingedLanes&=~s,e=e.expirationTimes;0<s;){var l=31-sc(s),d=1<<l;e[l]=-1,s&=~d}}function rD(e){if(Tr&6)throw Error(ms(327));Ig();var s=Tw(e,0);if(!(s&1))return za(e,ki()),null;var l=$w(e,s);if(e.tag!==0&&l===2){var d=HN(e);d!==0&&(s=d,l=_E(e,d))}if(l===1)throw l=N0,lf(e,0),lh(e,s),za(e,ki()),l;if(l===6)throw Error(ms(345));return e.finishedWork=e.current.alternate,e.finishedLanes=s,Wp(e,Ma,zu),za(e,ki()),null}function cA(e,s){var l=Tr;Tr|=1;try{return e(s)}finally{Tr=l,Tr===0&&(Qg=ki()+500,S2&&Fh())}}function xf(e){mh!==null&&mh.tag===0&&!(Tr&6)&&Ig();var s=Tr;Tr|=1;var l=Nl.transition,d=Fr;try{if(Nl.transition=null,Fr=1,e)return e()}finally{Fr=d,Nl.transition=l,Tr=s,!(Tr&6)&&Fh()}}function uA(){Ka=yg.current,si(yg)}function lf(e,s){e.finishedWork=null,e.finishedLanes=0;var l=e.timeoutHandle;if(l!==-1&&(e.timeoutHandle=-1,cq(l)),qi!==null)for(l=qi.return;l!==null;){var d=l;switch(GC(d),d.tag){case 1:d=d.type.childContextTypes,d!=null&&Pw();break;case 3:Yg(),si(Da),si(Zo),QC();break;case 5:JC(d);break;case 4:Yg();break;case 13:si(li);break;case 19:si(li);break;case 10:ZC(d.type._context);break;case 22:case 23:uA()}l=l.return}if(vo=e,qi=e=Th(e.current,null),Ro=Ka=s,ro=0,N0=null,aA=E2=gf=0,Ma=s0=null,Kp!==null){for(s=0;s<Kp.length;s++)if(l=Kp[s],d=l.interleaved,d!==null){l.interleaved=null;var m=d.next,_=l.pending;if(_!==null){var w=_.next;_.next=m,d.next=w}l.pending=d}Kp=null}return e}function XO(e,s){do{var l=qi;try{if(qC(),nw.current=Fw,Ow){for(var d=di.memoizedState;d!==null;){var m=d.queue;m!==null&&(m.pending=null),d=d.next}Ow=!1}if(mf=0,yo=no=di=null,e0=!1,S0=0,oA.current=null,l===null||l.return===null){ro=1,N0=s,qi=null;break}e:{var _=e,w=l.return,o=l,E=s;if(s=Ro,o.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var P=E,M=o,L=M.tag;if(!(M.mode&1)&&(L===0||L===11||L===15)){var F=M.alternate;F?(M.updateQueue=F.updateQueue,M.memoizedState=F.memoizedState,M.lanes=F.lanes):(M.updateQueue=null,M.memoizedState=null)}var $=H3(w);if($!==null){$.flags&=-257,W3($,w,o,_,s),$.mode&1&&G3(_,P,s),s=$,E=P;var Y=s.updateQueue;if(Y===null){var H=new Set;H.add(E),s.updateQueue=H}else Y.add(E);break e}else{if(!(s&1)){G3(_,P,s),dA();break e}E=Error(ms(426))}}else if(ii&&o.mode&1){var X=H3(w);if(X!==null){!(X.flags&65536)&&(X.flags|=256),W3(X,w,o,_,s),HC(Jg(E,o));break e}}_=E=Jg(E,o),ro!==4&&(ro=2),s0===null?s0=[_]:s0.push(_),_=w;do{switch(_.tag){case 3:_.flags|=65536,s&=-s,_.lanes|=s;var Z=RO(_,E,s);O3(_,Z);break e;case 1:o=E;var W=_.type,q=_.stateNode;if(!(_.flags&128)&&(typeof W.getDerivedStateFromError=="function"||q!==null&&typeof q.componentDidCatch=="function"&&(Sh===null||!Sh.has(q)))){_.flags|=65536,s&=-s,_.lanes|=s;var oe=kO(_,o,s);O3(_,oe);break e}}_=_.return}while(_!==null)}QO(l)}catch(ae){s=ae,qi===l&&l!==null&&(qi=l=l.return);continue}break}while(!0)}function YO(){var e=Bw.current;return Bw.current=Fw,e===null?Fw:e}function dA(){(ro===0||ro===3||ro===2)&&(ro=4),vo===null||!(gf&268435455)&&!(E2&268435455)||lh(vo,Ro)}function $w(e,s){var l=Tr;Tr|=2;var d=YO();(vo!==e||Ro!==s)&&(zu=null,lf(e,s));do try{kq();break}catch(m){XO(e,m)}while(!0);if(qC(),Tr=l,Bw.current=d,qi!==null)throw Error(ms(261));return vo=null,Ro=0,ro}function kq(){for(;qi!==null;)JO(qi)}function Dq(){for(;qi!==null&&!oW();)JO(qi)}function JO(e){var s=tF(e.alternate,e,Ka);e.memoizedProps=e.pendingProps,s===null?QO(e):qi=s,oA.current=null}function QO(e){var s=e;do{var l=s.alternate;if(e=s.return,s.flags&32768){if(l=Cq(l,s),l!==null){l.flags&=32767,qi=l;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{ro=6,qi=null;return}}else if(l=Eq(l,s,Ka),l!==null){qi=l;return}if(s=s.sibling,s!==null){qi=s;return}qi=s=e}while(s!==null);ro===0&&(ro=5)}function Wp(e,s,l){var d=Fr,m=Nl.transition;try{Nl.transition=null,Fr=1,Lq(e,s,l,d)}finally{Nl.transition=m,Fr=d}return null}function Lq(e,s,l,d){do Ig();while(mh!==null);if(Tr&6)throw Error(ms(327));l=e.finishedWork;var m=e.finishedLanes;if(l===null)return null;if(e.finishedWork=null,e.finishedLanes=0,l===e.current)throw Error(ms(177));e.callbackNode=null,e.callbackPriority=0;var _=l.lanes|l.childLanes;if(gW(e,_),e===vo&&(qi=vo=null,Ro=0),!(l.subtreeFlags&2064)&&!(l.flags&2064)||Db||(Db=!0,sF(jw,function(){return Ig(),null})),_=(l.flags&15990)!==0,l.subtreeFlags&15990||_){_=Nl.transition,Nl.transition=null;var w=Fr;Fr=1;var o=Tr;Tr|=4,oA.current=null,Pq(e,l),qO(l,e),sq(YN),Nw=!!XN,YN=XN=null,e.current=l,Iq(l),aW(),Tr=o,Fr=w,Nl.transition=_}else e.current=l;if(Db&&(Db=!1,mh=e,Uw=m),_=e.pendingLanes,_===0&&(Sh=null),uW(l.stateNode),za(e,ki()),s!==null)for(d=e.onRecoverableError,l=0;l<s.length;l++)m=s[l],d(m.value,{componentStack:m.stack,digest:m.digest});if(Vw)throw Vw=!1,e=xE,xE=null,e;return Uw&1&&e.tag!==0&&Ig(),_=e.pendingLanes,_&1?e===yE?n0++:(n0=0,yE=e):n0=0,Fh(),null}function Ig(){if(mh!==null){var e=Rz(Uw),s=Nl.transition,l=Fr;try{if(Nl.transition=null,Fr=16>e?16:e,mh===null)var d=!1;else{if(e=mh,mh=null,Uw=0,Tr&6)throw Error(ms(331));var m=Tr;for(Tr|=4,Us=e.current;Us!==null;){var _=Us,w=_.child;if(Us.flags&16){var o=_.deletions;if(o!==null){for(var E=0;E<o.length;E++){var P=o[E];for(Us=P;Us!==null;){var M=Us;switch(M.tag){case 0:case 11:case 15:t0(8,M,_)}var L=M.child;if(L!==null)L.return=M,Us=L;else for(;Us!==null;){M=Us;var F=M.sibling,$=M.return;if(GO(M),M===P){Us=null;break}if(F!==null){F.return=$,Us=F;break}Us=$}}}var Y=_.alternate;if(Y!==null){var H=Y.child;if(H!==null){Y.child=null;do{var X=H.sibling;H.sibling=null,H=X}while(H!==null)}}Us=_}}if(_.subtreeFlags&2064&&w!==null)w.return=_,Us=w;else e:for(;Us!==null;){if(_=Us,_.flags&2048)switch(_.tag){case 0:case 11:case 15:t0(9,_,_.return)}var Z=_.sibling;if(Z!==null){Z.return=_.return,Us=Z;break e}Us=_.return}}var W=e.current;for(Us=W;Us!==null;){w=Us;var q=w.child;if(w.subtreeFlags&2064&&q!==null)q.return=w,Us=q;else e:for(w=W;Us!==null;){if(o=Us,o.flags&2048)try{switch(o.tag){case 0:case 11:case 15:N2(9,o)}}catch(ae){Ti(o,o.return,ae)}if(o===w){Us=null;break e}var oe=o.sibling;if(oe!==null){oe.return=o.return,Us=oe;break e}Us=o.return}}if(Tr=m,Fh(),Yc&&typeof Yc.onPostCommitFiberRoot=="function")try{Yc.onPostCommitFiberRoot(y2,e)}catch{}d=!0}return d}finally{Fr=l,Nl.transition=s}}return!1}function iD(e,s,l){s=Jg(l,s),s=RO(e,s,1),e=wh(e,s,1),s=ga(),e!==null&&(q0(e,1,s),za(e,s))}function Ti(e,s,l){if(e.tag===3)iD(e,e,l);else for(;s!==null;){if(s.tag===3){iD(s,e,l);break}else if(s.tag===1){var d=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof d.componentDidCatch=="function"&&(Sh===null||!Sh.has(d))){e=Jg(l,e),e=kO(s,e,1),s=wh(s,e,1),e=ga(),s!==null&&(q0(s,1,e),za(s,e));break}}s=s.return}}function zq(e,s,l){var d=e.pingCache;d!==null&&d.delete(s),s=ga(),e.pingedLanes|=e.suspendedLanes&l,vo===e&&(Ro&l)===l&&(ro===4||ro===3&&(Ro&130023424)===Ro&&500>ki()-lA?lf(e,0):aA|=l),za(e,s)}function eF(e,s){s===0&&(e.mode&1?(s=Tb,Tb<<=1,!(Tb&130023424)&&(Tb=4194304)):s=1);var l=ga();e=Ku(e,s),e!==null&&(q0(e,s,l),za(e,l))}function Oq(e){var s=e.memoizedState,l=0;s!==null&&(l=s.retryLane),eF(e,l)}function Fq(e,s){var l=0;switch(e.tag){case 13:var d=e.stateNode,m=e.memoizedState;m!==null&&(l=m.retryLane);break;case 19:d=e.stateNode;break;default:throw Error(ms(314))}d!==null&&d.delete(s),eF(e,l)}var tF;tF=function(e,s,l){if(e!==null)if(e.memoizedProps!==s.pendingProps||Da.current)Ra=!0;else{if(!(e.lanes&l)&&!(s.flags&128))return Ra=!1,Nq(e,s,l);Ra=!!(e.flags&131072)}else Ra=!1,ii&&s.flags&1048576&&iO(s,Rw,s.index);switch(s.lanes=0,s.tag){case 2:var d=s.type;iw(e,s),e=s.pendingProps;var m=Zg(s,Zo.current);Pg(s,l),m=tA(null,s,d,e,m,l);var _=sA();return s.flags|=1,typeof m=="object"&&m!==null&&typeof m.render=="function"&&m.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,La(d)?(_=!0,Iw(s)):_=!1,s.memoizedState=m.state!==null&&m.state!==void 0?m.state:null,XC(s),m.updater=T2,s.stateNode=m,m._reactInternals=s,oE(s,d,e,l),s=cE(null,s,d,!0,_,l)):(s.tag=0,ii&&_&&$C(s),pa(null,s,m,l),s=s.child),s;case 16:d=s.elementType;e:{switch(iw(e,s),e=s.pendingProps,m=d._init,d=m(d._payload),s.type=d,m=s.tag=Vq(d),e=Xl(d,e),m){case 0:s=lE(null,s,d,e,l);break e;case 1:s=K3(null,s,d,e,l);break e;case 11:s=q3(null,s,d,e,l);break e;case 14:s=Z3(null,s,d,Xl(d.type,e),l);break e}throw Error(ms(306,d,""))}return s;case 0:return d=s.type,m=s.pendingProps,m=s.elementType===d?m:Xl(d,m),lE(e,s,d,m,l);case 1:return d=s.type,m=s.pendingProps,m=s.elementType===d?m:Xl(d,m),K3(e,s,d,m,l);case 3:e:{if(OO(s),e===null)throw Error(ms(387));d=s.pendingProps,_=s.memoizedState,m=_.element,dO(e,s),Lw(s,d,null,l);var w=s.memoizedState;if(d=w.element,_.isDehydrated)if(_={element:d,isDehydrated:!1,cache:w.cache,pendingSuspenseBoundaries:w.pendingSuspenseBoundaries,transitions:w.transitions},s.updateQueue.baseState=_,s.memoizedState=_,s.flags&256){m=Jg(Error(ms(423)),s),s=X3(e,s,d,l,m);break e}else if(d!==m){m=Jg(Error(ms(424)),s),s=X3(e,s,d,l,m);break e}else for(Ja=bh(s.stateNode.containerInfo.firstChild),Qa=s,ii=!0,tc=null,l=cO(s,null,d,l),s.child=l;l;)l.flags=l.flags&-3|4096,l=l.sibling;else{if(Kg(),d===m){s=Xu(e,s,l);break e}pa(e,s,d,l)}s=s.child}return s;case 5:return hO(s),e===null&&nE(s),d=s.type,m=s.pendingProps,_=e!==null?e.memoizedProps:null,w=m.children,JN(d,m)?w=null:_!==null&&JN(d,_)&&(s.flags|=32),zO(e,s),pa(e,s,w,l),s.child;case 6:return e===null&&nE(s),null;case 13:return FO(e,s,l);case 4:return YC(s,s.stateNode.containerInfo),d=s.pendingProps,e===null?s.child=Xg(s,null,d,l):pa(e,s,d,l),s.child;case 11:return d=s.type,m=s.pendingProps,m=s.elementType===d?m:Xl(d,m),q3(e,s,d,m,l);case 7:return pa(e,s,s.pendingProps,l),s.child;case 8:return pa(e,s,s.pendingProps.children,l),s.child;case 12:return pa(e,s,s.pendingProps.children,l),s.child;case 10:e:{if(d=s.type._context,m=s.pendingProps,_=s.memoizedProps,w=m.value,Kr(kw,d._currentValue),d._currentValue=w,_!==null)if(rc(_.value,w)){if(_.children===m.children&&!Da.current){s=Xu(e,s,l);break e}}else for(_=s.child,_!==null&&(_.return=s);_!==null;){var o=_.dependencies;if(o!==null){w=_.child;for(var E=o.firstContext;E!==null;){if(E.context===d){if(_.tag===1){E=Gu(-1,l&-l),E.tag=2;var P=_.updateQueue;if(P!==null){P=P.shared;var M=P.pending;M===null?E.next=E:(E.next=M.next,M.next=E),P.pending=E}}_.lanes|=l,E=_.alternate,E!==null&&(E.lanes|=l),rE(_.return,l,s),o.lanes|=l;break}E=E.next}}else if(_.tag===10)w=_.type===s.type?null:_.child;else if(_.tag===18){if(w=_.return,w===null)throw Error(ms(341));w.lanes|=l,o=w.alternate,o!==null&&(o.lanes|=l),rE(w,l,s),w=_.sibling}else w=_.child;if(w!==null)w.return=_;else for(w=_;w!==null;){if(w===s){w=null;break}if(_=w.sibling,_!==null){_.return=w.return,w=_;break}w=w.return}_=w}pa(e,s,m.children,l),s=s.child}return s;case 9:return m=s.type,d=s.pendingProps.children,Pg(s,l),m=Al(m),d=d(m),s.flags|=1,pa(e,s,d,l),s.child;case 14:return d=s.type,m=Xl(d,s.pendingProps),m=Xl(d.type,m),Z3(e,s,d,m,l);case 15:return DO(e,s,s.type,s.pendingProps,l);case 17:return d=s.type,m=s.pendingProps,m=s.elementType===d?m:Xl(d,m),iw(e,s),s.tag=1,La(d)?(e=!0,Iw(s)):e=!1,Pg(s,l),MO(s,d,m),oE(s,d,m,l),cE(null,s,d,!0,e,l);case 19:return BO(e,s,l);case 22:return LO(e,s,l)}throw Error(ms(156,s.tag))};function sF(e,s){return Az(e,s)}function Bq(e,s,l,d){this.tag=e,this.key=l,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=d,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Tl(e,s,l,d){return new Bq(e,s,l,d)}function hA(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Vq(e){if(typeof e=="function")return hA(e)?1:0;if(e!=null){if(e=e.$$typeof,e===IC)return 11;if(e===MC)return 14}return 2}function Th(e,s){var l=e.alternate;return l===null?(l=Tl(e.tag,s,e.key,e.mode),l.elementType=e.elementType,l.type=e.type,l.stateNode=e.stateNode,l.alternate=e,e.alternate=l):(l.pendingProps=s,l.type=e.type,l.flags=0,l.subtreeFlags=0,l.deletions=null),l.flags=e.flags&14680064,l.childLanes=e.childLanes,l.lanes=e.lanes,l.child=e.child,l.memoizedProps=e.memoizedProps,l.memoizedState=e.memoizedState,l.updateQueue=e.updateQueue,s=e.dependencies,l.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},l.sibling=e.sibling,l.index=e.index,l.ref=e.ref,l}function lw(e,s,l,d,m,_){var w=2;if(d=e,typeof e=="function")hA(e)&&(w=1);else if(typeof e=="string")w=5;else e:switch(e){case lg:return cf(l.children,m,_,s);case PC:w=8,m|=8;break;case PN:return e=Tl(12,l,s,m|2),e.elementType=PN,e.lanes=_,e;case IN:return e=Tl(13,l,s,m),e.elementType=IN,e.lanes=_,e;case MN:return e=Tl(19,l,s,m),e.elementType=MN,e.lanes=_,e;case hz:return C2(l,m,_,s);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case uz:w=10;break e;case dz:w=9;break e;case IC:w=11;break e;case MC:w=14;break e;case ih:w=16,d=null;break e}throw Error(ms(130,e==null?e:typeof e,""))}return s=Tl(w,l,s,m),s.elementType=e,s.type=d,s.lanes=_,s}function cf(e,s,l,d){return e=Tl(7,e,d,s),e.lanes=l,e}function C2(e,s,l,d){return e=Tl(22,e,d,s),e.elementType=hz,e.lanes=l,e.stateNode={isHidden:!1},e}function GT(e,s,l){return e=Tl(6,e,null,s),e.lanes=l,e}function HT(e,s,l){return s=Tl(4,e.children!==null?e.children:[],e.key,s),s.lanes=l,s.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},s}function Uq(e,s,l,d,m){this.tag=s,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=TT(0),this.expirationTimes=TT(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=TT(0),this.identifierPrefix=d,this.onRecoverableError=m,this.mutableSourceEagerHydrationData=null}function pA(e,s,l,d,m,_,w,o,E){return e=new Uq(e,s,l,o,E),s===1?(s=1,_===!0&&(s|=8)):s=0,_=Tl(3,null,null,s),e.current=_,_.stateNode=e,_.memoizedState={element:d,isDehydrated:l,cache:null,transitions:null,pendingSuspenseBoundaries:null},XC(_),e}function $q(e,s,l){var d=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:ag,key:d==null?null:""+d,children:e,containerInfo:s,implementation:l}}function nF(e){if(!e)return Ph;e=e._reactInternals;e:{if(Nf(e)!==e||e.tag!==1)throw Error(ms(170));var s=e;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(La(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(ms(171))}if(e.tag===1){var l=e.type;if(La(l))return nO(e,l,s)}return s}function rF(e,s,l,d,m,_,w,o,E){return e=pA(l,d,!0,e,m,_,w,o,E),e.context=nF(null),l=e.current,d=ga(),m=jh(l),_=Gu(d,m),_.callback=s??null,wh(l,_,m),e.current.lanes=m,q0(e,m,d),za(e,d),e}function A2(e,s,l,d){var m=s.current,_=ga(),w=jh(m);return l=nF(l),s.context===null?s.context=l:s.pendingContext=l,s=Gu(_,w),s.payload={element:e},d=d===void 0?null:d,d!==null&&(s.callback=d),e=wh(m,s,w),e!==null&&(nc(e,m,w,_),sw(e,m,w)),w}function Gw(e){if(e=e.current,!e.child)return null;switch(e.child.tag){case 5:return e.child.stateNode;default:return e.child.stateNode}}function oD(e,s){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var l=e.retryLane;e.retryLane=l!==0&&l<s?l:s}}function fA(e,s){oD(e,s),(e=e.alternate)&&oD(e,s)}function Gq(){return null}var iF=typeof reportError=="function"?reportError:function(e){console.error(e)};function mA(e){this._internalRoot=e}P2.prototype.render=mA.prototype.render=function(e){var s=this._internalRoot;if(s===null)throw Error(ms(409));A2(e,s,null,null)};P2.prototype.unmount=mA.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var s=e.containerInfo;xf(function(){A2(null,e,null,null)}),s[Zu]=null}};function P2(e){this._internalRoot=e}P2.prototype.unstable_scheduleHydration=function(e){if(e){var s=Lz();e={blockedOn:null,target:e,priority:s};for(var l=0;l<ah.length&&s!==0&&s<ah[l].priority;l++);ah.splice(l,0,e),l===0&&Oz(e)}};function gA(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function I2(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function aD(){}function Hq(e,s,l,d,m){if(m){if(typeof d=="function"){var _=d;d=function(){var P=Gw(w);_.call(P)}}var w=rF(s,d,e,0,null,!1,!1,"",aD);return e._reactRootContainer=w,e[Zu]=w.current,y0(e.nodeType===8?e.parentNode:e),xf(),w}for(;m=e.lastChild;)e.removeChild(m);if(typeof d=="function"){var o=d;d=function(){var P=Gw(E);o.call(P)}}var E=pA(e,0,!1,null,null,!1,!1,"",aD);return e._reactRootContainer=E,e[Zu]=E.current,y0(e.nodeType===8?e.parentNode:e),xf(function(){A2(s,E,l,d)}),E}function M2(e,s,l,d,m){var _=l._reactRootContainer;if(_){var w=_;if(typeof m=="function"){var o=m;m=function(){var E=Gw(w);o.call(E)}}A2(s,w,e,m)}else w=Hq(l,s,e,m,d);return Gw(w)}kz=function(e){switch(e.tag){case 3:var s=e.stateNode;if(s.current.memoizedState.isDehydrated){var l=G_(s.pendingLanes);l!==0&&(DC(s,l|1),za(s,ki()),!(Tr&6)&&(Qg=ki()+500,Fh()))}break;case 13:xf(function(){var d=Ku(e,1);if(d!==null){var m=ga();nc(d,e,1,m)}}),fA(e,1)}};LC=function(e){if(e.tag===13){var s=Ku(e,134217728);if(s!==null){var l=ga();nc(s,e,134217728,l)}fA(e,134217728)}};Dz=function(e){if(e.tag===13){var s=jh(e),l=Ku(e,s);if(l!==null){var d=ga();nc(l,e,s,d)}fA(e,s)}};Lz=function(){return Fr};zz=function(e,s){var l=Fr;try{return Fr=e,s()}finally{Fr=l}};UN=function(e,s,l){switch(s){case"input":if(DN(e,l),s=l.name,l.type==="radio"&&s!=null){for(l=e;l.parentNode;)l=l.parentNode;for(l=l.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<l.length;s++){var d=l[s];if(d!==e&&d.form===e.form){var m=w2(d);if(!m)throw Error(ms(90));fz(d),DN(d,m)}}}break;case"textarea":gz(e,l);break;case"select":s=l.value,s!=null&&Ng(e,!!l.multiple,s,!1)}};Sz=cA;jz=xf;var Wq={usingClientEntryPoint:!1,Events:[K0,hg,w2,bz,wz,cA]},z_={findFiberByHostInstance:Zp,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},qq={bundleType:z_.bundleType,version:z_.version,rendererPackageName:z_.rendererPackageName,rendererConfig:z_.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:id.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=Ez(e),e===null?null:e.stateNode},findFiberByHostInstance:z_.findFiberByHostInstance||Gq,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Lb=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Lb.isDisabled&&Lb.supportsFiber)try{y2=Lb.inject(qq),Yc=Lb}catch{}}ul.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wq;ul.createPortal=function(e,s){var l=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!gA(s))throw Error(ms(200));return $q(e,s,null,l)};ul.createRoot=function(e,s){if(!gA(e))throw Error(ms(299));var l=!1,d="",m=iF;return s!=null&&(s.unstable_strictMode===!0&&(l=!0),s.identifierPrefix!==void 0&&(d=s.identifierPrefix),s.onRecoverableError!==void 0&&(m=s.onRecoverableError)),s=pA(e,1,!1,null,null,l,!1,d,m),e[Zu]=s.current,y0(e.nodeType===8?e.parentNode:e),new mA(s)};ul.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var s=e._reactInternals;if(s===void 0)throw typeof e.render=="function"?Error(ms(188)):(e=Object.keys(e).join(","),Error(ms(268,e)));return e=Ez(s),e=e===null?null:e.stateNode,e};ul.flushSync=function(e){return xf(e)};ul.hydrate=function(e,s,l){if(!I2(s))throw Error(ms(200));return M2(null,e,s,!0,l)};ul.hydrateRoot=function(e,s,l){if(!gA(e))throw Error(ms(405));var d=l!=null&&l.hydratedSources||null,m=!1,_="",w=iF;if(l!=null&&(l.unstable_strictMode===!0&&(m=!0),l.identifierPrefix!==void 0&&(_=l.identifierPrefix),l.onRecoverableError!==void 0&&(w=l.onRecoverableError)),s=rF(s,null,e,1,l??null,m,!1,_,w),e[Zu]=s.current,y0(e),d)for(e=0;e<d.length;e++)l=d[e],m=l._getVersion,m=m(l._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[l,m]:s.mutableSourceEagerHydrationData.push(l,m);return new P2(s)};ul.render=function(e,s,l){if(!I2(s))throw Error(ms(200));return M2(null,e,s,!1,l)};ul.unmountComponentAtNode=function(e){if(!I2(e))throw Error(ms(40));return e._reactRootContainer?(xf(function(){M2(null,null,e,!1,function(){e._reactRootContainer=null,e[Zu]=null})}),!0):!1};ul.unstable_batchedUpdates=cA;ul.unstable_renderSubtreeIntoContainer=function(e,s,l,d){if(!I2(l))throw Error(ms(200));if(e==null||e._reactInternals===void 0)throw Error(ms(38));return M2(e,s,l,!1,d)};ul.version="18.3.1-next-f1338f8080-20240426";function oF(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(oF)}catch(e){console.error(e)}}oF(),oz.exports=ul;var Ef=oz.exports;const aF=bC(Ef);var lF,lD=Ef;lF=lD.createRoot,lD.hydrateRoot;/**
 * @remix-run/router v1.23.0
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function E0(){return E0=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(e[d]=l[d])}return e},E0.apply(this,arguments)}var gh;(function(e){e.Pop="POP",e.Push="PUSH",e.Replace="REPLACE"})(gh||(gh={}));const cD="popstate";function Zq(e){e===void 0&&(e={});function s(d,m){let{pathname:_,search:w,hash:o}=d.location;return bE("",{pathname:_,search:w,hash:o},m.state&&m.state.usr||null,m.state&&m.state.key||"default")}function l(d,m){return typeof m=="string"?m:Hw(m)}return Xq(s,l,null,e)}function Di(e,s){if(e===!1||e===null||typeof e>"u")throw new Error(s)}function cF(e,s){if(!e){typeof console<"u"&&console.warn(s);try{throw new Error(s)}catch{}}}function Kq(){return Math.random().toString(36).substr(2,8)}function uD(e,s){return{usr:e.state,key:e.key,idx:s}}function bE(e,s,l,d){return l===void 0&&(l=null),E0({pathname:typeof e=="string"?e:e.pathname,search:"",hash:""},typeof s=="string"?fx(s):s,{state:l,key:s&&s.key||d||Kq()})}function Hw(e){let{pathname:s="/",search:l="",hash:d=""}=e;return l&&l!=="?"&&(s+=l.charAt(0)==="?"?l:"?"+l),d&&d!=="#"&&(s+=d.charAt(0)==="#"?d:"#"+d),s}function fx(e){let s={};if(e){let l=e.indexOf("#");l>=0&&(s.hash=e.substr(l),e=e.substr(0,l));let d=e.indexOf("?");d>=0&&(s.search=e.substr(d),e=e.substr(0,d)),e&&(s.pathname=e)}return s}function Xq(e,s,l,d){d===void 0&&(d={});let{window:m=document.defaultView,v5Compat:_=!1}=d,w=m.history,o=gh.Pop,E=null,P=M();P==null&&(P=0,w.replaceState(E0({},w.state,{idx:P}),""));function M(){return(w.state||{idx:null}).idx}function L(){o=gh.Pop;let X=M(),Z=X==null?null:X-P;P=X,E&&E({action:o,location:H.location,delta:Z})}function F(X,Z){o=gh.Push;let W=bE(H.location,X,Z);P=M()+1;let q=uD(W,P),oe=H.createHref(W);try{w.pushState(q,"",oe)}catch(ae){if(ae instanceof DOMException&&ae.name==="DataCloneError")throw ae;m.location.assign(oe)}_&&E&&E({action:o,location:H.location,delta:1})}function $(X,Z){o=gh.Replace;let W=bE(H.location,X,Z);P=M();let q=uD(W,P),oe=H.createHref(W);w.replaceState(q,"",oe),_&&E&&E({action:o,location:H.location,delta:0})}function Y(X){let Z=m.location.origin!=="null"?m.location.origin:m.location.href,W=typeof X=="string"?X:Hw(X);return W=W.replace(/ $/,"%20"),Di(Z,"No window.location.(origin|href) available to create URL for href: "+W),new URL(W,Z)}let H={get action(){return o},get location(){return e(m,w)},listen(X){if(E)throw new Error("A history only accepts one active listener");return m.addEventListener(cD,L),E=X,()=>{m.removeEventListener(cD,L),E=null}},createHref(X){return s(m,X)},createURL:Y,encodeLocation(X){let Z=Y(X);return{pathname:Z.pathname,search:Z.search,hash:Z.hash}},push:F,replace:$,go(X){return w.go(X)}};return H}var dD;(function(e){e.data="data",e.deferred="deferred",e.redirect="redirect",e.error="error"})(dD||(dD={}));function Yq(e,s,l){return l===void 0&&(l="/"),Jq(e,s,l,!1)}function Jq(e,s,l,d){let m=typeof s=="string"?fx(s):s,_=xA(m.pathname||"/",l);if(_==null)return null;let w=uF(e);Qq(w);let o=null;for(let E=0;o==null&&E<w.length;++E){let P=uZ(_);o=lZ(w[E],P,d)}return o}function uF(e,s,l,d){s===void 0&&(s=[]),l===void 0&&(l=[]),d===void 0&&(d="");let m=(_,w,o)=>{let E={relativePath:o===void 0?_.path||"":o,caseSensitive:_.caseSensitive===!0,childrenIndex:w,route:_};E.relativePath.startsWith("/")&&(Di(E.relativePath.startsWith(d),'Absolute route path "'+E.relativePath+'" nested under path '+('"'+d+'" is not valid. An absolute child route path ')+"must start with the combined path of all its parent routes."),E.relativePath=E.relativePath.slice(d.length));let P=Nh([d,E.relativePath]),M=l.concat(E);_.children&&_.children.length>0&&(Di(_.index!==!0,"Index routes must not have child routes. Please remove "+('all child routes from route path "'+P+'".')),uF(_.children,s,M,P)),!(_.path==null&&!_.index)&&s.push({path:P,score:oZ(P,_.index),routesMeta:M})};return e.forEach((_,w)=>{var o;if(_.path===""||!((o=_.path)!=null&&o.includes("?")))m(_,w);else for(let E of dF(_.path))m(_,w,E)}),s}function dF(e){let s=e.split("/");if(s.length===0)return[];let[l,...d]=s,m=l.endsWith("?"),_=l.replace(/\?$/,"");if(d.length===0)return m?[_,""]:[_];let w=dF(d.join("/")),o=[];return o.push(...w.map(E=>E===""?_:[_,E].join("/"))),m&&o.push(...w),o.map(E=>e.startsWith("/")&&E===""?"/":E)}function Qq(e){e.sort((s,l)=>s.score!==l.score?l.score-s.score:aZ(s.routesMeta.map(d=>d.childrenIndex),l.routesMeta.map(d=>d.childrenIndex)))}const eZ=/^:[\w-]+$/,tZ=3,sZ=2,nZ=1,rZ=10,iZ=-2,hD=e=>e==="*";function oZ(e,s){let l=e.split("/"),d=l.length;return l.some(hD)&&(d+=iZ),s&&(d+=sZ),l.filter(m=>!hD(m)).reduce((m,_)=>m+(eZ.test(_)?tZ:_===""?nZ:rZ),d)}function aZ(e,s){return e.length===s.length&&e.slice(0,-1).every((d,m)=>d===s[m])?e[e.length-1]-s[s.length-1]:0}function lZ(e,s,l){let{routesMeta:d}=e,m={},_="/",w=[];for(let o=0;o<d.length;++o){let E=d[o],P=o===d.length-1,M=_==="/"?s:s.slice(_.length)||"/",L=pD({path:E.relativePath,caseSensitive:E.caseSensitive,end:P},M),F=E.route;if(!L&&P&&l&&!d[d.length-1].route.index&&(L=pD({path:E.relativePath,caseSensitive:E.caseSensitive,end:!1},M)),!L)return null;Object.assign(m,L.params),w.push({params:m,pathname:Nh([_,L.pathname]),pathnameBase:fZ(Nh([_,L.pathnameBase])),route:F}),L.pathnameBase!=="/"&&(_=Nh([_,L.pathnameBase]))}return w}function pD(e,s){typeof e=="string"&&(e={path:e,caseSensitive:!1,end:!0});let[l,d]=cZ(e.path,e.caseSensitive,e.end),m=s.match(l);if(!m)return null;let _=m[0],w=_.replace(/(.)\/+$/,"$1"),o=m.slice(1);return{params:d.reduce((P,M,L)=>{let{paramName:F,isOptional:$}=M;if(F==="*"){let H=o[L]||"";w=_.slice(0,_.length-H.length).replace(/(.)\/+$/,"$1")}const Y=o[L];return $&&!Y?P[F]=void 0:P[F]=(Y||"").replace(/%2F/g,"/"),P},{}),pathname:_,pathnameBase:w,pattern:e}}function cZ(e,s,l){s===void 0&&(s=!1),l===void 0&&(l=!0),cF(e==="*"||!e.endsWith("*")||e.endsWith("/*"),'Route path "'+e+'" will be treated as if it were '+('"'+e.replace(/\*$/,"/*")+'" because the `*` character must ')+"always follow a `/` in the pattern. To get rid of this warning, "+('please change the route path to "'+e.replace(/\*$/,"/*")+'".'));let d=[],m="^"+e.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(w,o,E)=>(d.push({paramName:o,isOptional:E!=null}),E?"/?([^\\/]+)?":"/([^\\/]+)"));return e.endsWith("*")?(d.push({paramName:"*"}),m+=e==="*"||e==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):l?m+="\\/*$":e!==""&&e!=="/"&&(m+="(?:(?=\\/|$))"),[new RegExp(m,s?void 0:"i"),d]}function uZ(e){try{return e.split("/").map(s=>decodeURIComponent(s).replace(/\//g,"%2F")).join("/")}catch(s){return cF(!1,'The URL path "'+e+'" could not be decoded because it is is a malformed URL segment. This is probably due to a bad percent '+("encoding ("+s+").")),e}}function xA(e,s){if(s==="/")return e;if(!e.toLowerCase().startsWith(s.toLowerCase()))return null;let l=s.endsWith("/")?s.length-1:s.length,d=e.charAt(l);return d&&d!=="/"?null:e.slice(l)||"/"}function dZ(e,s){s===void 0&&(s="/");let{pathname:l,search:d="",hash:m=""}=typeof e=="string"?fx(e):e;return{pathname:l?l.startsWith("/")?l:hZ(l,s):s,search:mZ(d),hash:gZ(m)}}function hZ(e,s){let l=s.replace(/\/+$/,"").split("/");return e.split("/").forEach(m=>{m===".."?l.length>1&&l.pop():m!=="."&&l.push(m)}),l.length>1?l.join("/"):"/"}function WT(e,s,l,d){return"Cannot include a '"+e+"' character in a manually specified "+("`to."+s+"` field ["+JSON.stringify(d)+"].  Please separate it out to the ")+("`to."+l+"` field. Alternatively you may provide the full path as ")+'a string in <Link to="..."> and the router will parse it for you.'}function pZ(e){return e.filter((s,l)=>l===0||s.route.path&&s.route.path.length>0)}function yA(e,s){let l=pZ(e);return s?l.map((d,m)=>m===l.length-1?d.pathname:d.pathnameBase):l.map(d=>d.pathnameBase)}function _A(e,s,l,d){d===void 0&&(d=!1);let m;typeof e=="string"?m=fx(e):(m=E0({},e),Di(!m.pathname||!m.pathname.includes("?"),WT("?","pathname","search",m)),Di(!m.pathname||!m.pathname.includes("#"),WT("#","pathname","hash",m)),Di(!m.search||!m.search.includes("#"),WT("#","search","hash",m)));let _=e===""||m.pathname==="",w=_?"/":m.pathname,o;if(w==null)o=l;else{let L=s.length-1;if(!d&&w.startsWith("..")){let F=w.split("/");for(;F[0]==="..";)F.shift(),L-=1;m.pathname=F.join("/")}o=L>=0?s[L]:"/"}let E=dZ(m,o),P=w&&w!=="/"&&w.endsWith("/"),M=(_||w===".")&&l.endsWith("/");return!E.pathname.endsWith("/")&&(P||M)&&(E.pathname+="/"),E}const Nh=e=>e.join("/").replace(/\/\/+/g,"/"),fZ=e=>e.replace(/\/+$/,"").replace(/^\/*/,"/"),mZ=e=>!e||e==="?"?"":e.startsWith("?")?e:"?"+e,gZ=e=>!e||e==="#"?"":e.startsWith("#")?e:"#"+e;function xZ(e){return e!=null&&typeof e.status=="number"&&typeof e.statusText=="string"&&typeof e.internal=="boolean"&&"data"in e}const hF=["post","put","patch","delete"];new Set(hF);const yZ=["get",...hF];new Set(yZ);/**
 * React Router v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function C0(){return C0=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(e[d]=l[d])}return e},C0.apply(this,arguments)}const vA=z.createContext(null),_Z=z.createContext(null),Bh=z.createContext(null),R2=z.createContext(null),Vh=z.createContext({outlet:null,matches:[],isDataRoute:!1}),pF=z.createContext(null);function vZ(e,s){let{relative:l}=s===void 0?{}:s;mx()||Di(!1);let{basename:d,navigator:m}=z.useContext(Bh),{hash:_,pathname:w,search:o}=mF(e,{relative:l}),E=w;return d!=="/"&&(E=w==="/"?d:Nh([d,w])),m.createHref({pathname:E,search:o,hash:_})}function mx(){return z.useContext(R2)!=null}function cc(){return mx()||Di(!1),z.useContext(R2).location}function fF(e){z.useContext(Bh).static||z.useLayoutEffect(e)}function Xr(){let{isDataRoute:e}=z.useContext(Vh);return e?RZ():bZ()}function bZ(){mx()||Di(!1);let e=z.useContext(vA),{basename:s,future:l,navigator:d}=z.useContext(Bh),{matches:m}=z.useContext(Vh),{pathname:_}=cc(),w=JSON.stringify(yA(m,l.v7_relativeSplatPath)),o=z.useRef(!1);return fF(()=>{o.current=!0}),z.useCallback(function(P,M){if(M===void 0&&(M={}),!o.current)return;if(typeof P=="number"){d.go(P);return}let L=_A(P,JSON.parse(w),_,M.relative==="path");e==null&&s!=="/"&&(L.pathname=L.pathname==="/"?s:Nh([s,L.pathname])),(M.replace?d.replace:d.push)(L,M.state,M)},[s,d,w,_,e])}function mF(e,s){let{relative:l}=s===void 0?{}:s,{future:d}=z.useContext(Bh),{matches:m}=z.useContext(Vh),{pathname:_}=cc(),w=JSON.stringify(yA(m,d.v7_relativeSplatPath));return z.useMemo(()=>_A(e,JSON.parse(w),_,l==="path"),[e,w,_,l])}function wZ(e,s){return SZ(e,s)}function SZ(e,s,l,d){mx()||Di(!1);let{navigator:m}=z.useContext(Bh),{matches:_}=z.useContext(Vh),w=_[_.length-1],o=w?w.params:{};w&&w.pathname;let E=w?w.pathnameBase:"/";w&&w.route;let P=cc(),M;if(s){var L;let X=typeof s=="string"?fx(s):s;E==="/"||(L=X.pathname)!=null&&L.startsWith(E)||Di(!1),M=X}else M=P;let F=M.pathname||"/",$=F;if(E!=="/"){let X=E.replace(/^\//,"").split("/");$="/"+F.replace(/^\//,"").split("/").slice(X.length).join("/")}let Y=Yq(e,{pathname:$}),H=CZ(Y&&Y.map(X=>Object.assign({},X,{params:Object.assign({},o,X.params),pathname:Nh([E,m.encodeLocation?m.encodeLocation(X.pathname).pathname:X.pathname]),pathnameBase:X.pathnameBase==="/"?E:Nh([E,m.encodeLocation?m.encodeLocation(X.pathnameBase).pathname:X.pathnameBase])})),_,l,d);return s&&H?z.createElement(R2.Provider,{value:{location:C0({pathname:"/",search:"",hash:"",state:null,key:"default"},M),navigationType:gh.Pop}},H):H}function jZ(){let e=MZ(),s=xZ(e)?e.status+" "+e.statusText:e instanceof Error?e.message:JSON.stringify(e),l=e instanceof Error?e.stack:null,m={padding:"0.5rem",backgroundColor:"rgba(200,200,200, 0.5)"};return z.createElement(z.Fragment,null,z.createElement("h2",null,"Unexpected Application Error!"),z.createElement("h3",{style:{fontStyle:"italic"}},s),l?z.createElement("pre",{style:m},l):null,null)}const TZ=z.createElement(jZ,null);class NZ extends z.Component{constructor(s){super(s),this.state={location:s.location,revalidation:s.revalidation,error:s.error}}static getDerivedStateFromError(s){return{error:s}}static getDerivedStateFromProps(s,l){return l.location!==s.location||l.revalidation!=="idle"&&s.revalidation==="idle"?{error:s.error,location:s.location,revalidation:s.revalidation}:{error:s.error!==void 0?s.error:l.error,location:l.location,revalidation:s.revalidation||l.revalidation}}componentDidCatch(s,l){console.error("React Router caught the following error during render",s,l)}render(){return this.state.error!==void 0?z.createElement(Vh.Provider,{value:this.props.routeContext},z.createElement(pF.Provider,{value:this.state.error,children:this.props.component})):this.props.children}}function EZ(e){let{routeContext:s,match:l,children:d}=e,m=z.useContext(vA);return m&&m.static&&m.staticContext&&(l.route.errorElement||l.route.ErrorBoundary)&&(m.staticContext._deepestRenderedBoundaryId=l.route.id),z.createElement(Vh.Provider,{value:s},d)}function CZ(e,s,l,d){var m;if(s===void 0&&(s=[]),l===void 0&&(l=null),d===void 0&&(d=null),e==null){var _;if(!l)return null;if(l.errors)e=l.matches;else if((_=d)!=null&&_.v7_partialHydration&&s.length===0&&!l.initialized&&l.matches.length>0)e=l.matches;else return null}let w=e,o=(m=l)==null?void 0:m.errors;if(o!=null){let M=w.findIndex(L=>L.route.id&&(o==null?void 0:o[L.route.id])!==void 0);M>=0||Di(!1),w=w.slice(0,Math.min(w.length,M+1))}let E=!1,P=-1;if(l&&d&&d.v7_partialHydration)for(let M=0;M<w.length;M++){let L=w[M];if((L.route.HydrateFallback||L.route.hydrateFallbackElement)&&(P=M),L.route.id){let{loaderData:F,errors:$}=l,Y=L.route.loader&&F[L.route.id]===void 0&&(!$||$[L.route.id]===void 0);if(L.route.lazy||Y){E=!0,P>=0?w=w.slice(0,P+1):w=[w[0]];break}}}return w.reduceRight((M,L,F)=>{let $,Y=!1,H=null,X=null;l&&($=o&&L.route.id?o[L.route.id]:void 0,H=L.route.errorElement||TZ,E&&(P<0&&F===0?(Y=!0,X=null):P===F&&(Y=!0,X=L.route.hydrateFallbackElement||null)));let Z=s.concat(w.slice(0,F+1)),W=()=>{let q;return $?q=H:Y?q=X:L.route.Component?q=z.createElement(L.route.Component,null):L.route.element?q=L.route.element:q=M,z.createElement(EZ,{match:L,routeContext:{outlet:M,matches:Z,isDataRoute:l!=null},children:q})};return l&&(L.route.ErrorBoundary||L.route.errorElement||F===0)?z.createElement(NZ,{location:l.location,revalidation:l.revalidation,component:H,error:$,children:W(),routeContext:{outlet:null,matches:Z,isDataRoute:!0}}):W()},null)}var gF=function(e){return e.UseBlocker="useBlocker",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e}(gF||{}),Ww=function(e){return e.UseBlocker="useBlocker",e.UseLoaderData="useLoaderData",e.UseActionData="useActionData",e.UseRouteError="useRouteError",e.UseNavigation="useNavigation",e.UseRouteLoaderData="useRouteLoaderData",e.UseMatches="useMatches",e.UseRevalidator="useRevalidator",e.UseNavigateStable="useNavigate",e.UseRouteId="useRouteId",e}(Ww||{});function AZ(e){let s=z.useContext(vA);return s||Di(!1),s}function PZ(e){let s=z.useContext(_Z);return s||Di(!1),s}function IZ(e){let s=z.useContext(Vh);return s||Di(!1),s}function xF(e){let s=IZ(),l=s.matches[s.matches.length-1];return l.route.id||Di(!1),l.route.id}function MZ(){var e;let s=z.useContext(pF),l=PZ(Ww.UseRouteError),d=xF(Ww.UseRouteError);return s!==void 0?s:(e=l.errors)==null?void 0:e[d]}function RZ(){let{router:e}=AZ(gF.UseNavigateStable),s=xF(Ww.UseNavigateStable),l=z.useRef(!1);return fF(()=>{l.current=!0}),z.useCallback(function(m,_){_===void 0&&(_={}),l.current&&(typeof m=="number"?e.navigate(m):e.navigate(m,C0({fromRouteId:s},_)))},[e,s])}function kZ(e,s){e==null||e.v7_startTransition,e==null||e.v7_relativeSplatPath}function fD(e){let{to:s,replace:l,state:d,relative:m}=e;mx()||Di(!1);let{future:_,static:w}=z.useContext(Bh),{matches:o}=z.useContext(Vh),{pathname:E}=cc(),P=Xr(),M=_A(s,yA(o,_.v7_relativeSplatPath),E,m==="path"),L=JSON.stringify(M);return z.useEffect(()=>P(JSON.parse(L),{replace:l,state:d,relative:m}),[P,L,m,l,d]),null}function Dn(e){Di(!1)}function DZ(e){let{basename:s="/",children:l=null,location:d,navigationType:m=gh.Pop,navigator:_,static:w=!1,future:o}=e;mx()&&Di(!1);let E=s.replace(/^\/*/,"/"),P=z.useMemo(()=>({basename:E,navigator:_,static:w,future:C0({v7_relativeSplatPath:!1},o)}),[E,o,_,w]);typeof d=="string"&&(d=fx(d));let{pathname:M="/",search:L="",hash:F="",state:$=null,key:Y="default"}=d,H=z.useMemo(()=>{let X=xA(M,E);return X==null?null:{location:{pathname:X,search:L,hash:F,state:$,key:Y},navigationType:m}},[E,M,L,F,$,Y,m]);return H==null?null:z.createElement(Bh.Provider,{value:P},z.createElement(R2.Provider,{children:l,value:H}))}function LZ(e){let{children:s,location:l}=e;return wZ(wE(s),l)}new Promise(()=>{});function wE(e,s){s===void 0&&(s=[]);let l=[];return z.Children.forEach(e,(d,m)=>{if(!z.isValidElement(d))return;let _=[...s,m];if(d.type===z.Fragment){l.push.apply(l,wE(d.props.children,_));return}d.type!==Dn&&Di(!1),!d.props.index||!d.props.children||Di(!1);let w={id:d.props.id||_.join("-"),caseSensitive:d.props.caseSensitive,element:d.props.element,Component:d.props.Component,index:d.props.index,path:d.props.path,loader:d.props.loader,action:d.props.action,errorElement:d.props.errorElement,ErrorBoundary:d.props.ErrorBoundary,hasErrorBoundary:d.props.ErrorBoundary!=null||d.props.errorElement!=null,shouldRevalidate:d.props.shouldRevalidate,handle:d.props.handle,lazy:d.props.lazy};d.props.children&&(w.children=wE(d.props.children,_)),l.push(w)}),l}/**
 * React Router DOM v6.30.1
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */function SE(){return SE=Object.assign?Object.assign.bind():function(e){for(var s=1;s<arguments.length;s++){var l=arguments[s];for(var d in l)Object.prototype.hasOwnProperty.call(l,d)&&(e[d]=l[d])}return e},SE.apply(this,arguments)}function zZ(e,s){if(e==null)return{};var l={},d=Object.keys(e),m,_;for(_=0;_<d.length;_++)m=d[_],!(s.indexOf(m)>=0)&&(l[m]=e[m]);return l}function OZ(e){return!!(e.metaKey||e.altKey||e.ctrlKey||e.shiftKey)}function FZ(e,s){return e.button===0&&(!s||s==="_self")&&!OZ(e)}function jE(e){return e===void 0&&(e=""),new URLSearchParams(typeof e=="string"||Array.isArray(e)||e instanceof URLSearchParams?e:Object.keys(e).reduce((s,l)=>{let d=e[l];return s.concat(Array.isArray(d)?d.map(m=>[l,m]):[[l,d]])},[]))}function BZ(e,s){let l=jE(e);return s&&s.forEach((d,m)=>{l.has(m)||s.getAll(m).forEach(_=>{l.append(m,_)})}),l}const VZ=["onClick","relative","reloadDocument","replace","state","target","to","preventScrollReset","viewTransition"],UZ="6";try{window.__reactRouterVersion=UZ}catch{}const $Z="startTransition",mD=NC[$Z];function GZ(e){let{basename:s,children:l,future:d,window:m}=e,_=z.useRef();_.current==null&&(_.current=Zq({window:m,v5Compat:!0}));let w=_.current,[o,E]=z.useState({action:w.action,location:w.location}),{v7_startTransition:P}=d||{},M=z.useCallback(L=>{P&&mD?mD(()=>E(L)):E(L)},[E,P]);return z.useLayoutEffect(()=>w.listen(M),[w,M]),z.useEffect(()=>kZ(d),[d]),z.createElement(DZ,{basename:s,children:l,location:o.location,navigationType:o.action,navigator:w,future:d})}const HZ=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u",WZ=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,_r=z.forwardRef(function(s,l){let{onClick:d,relative:m,reloadDocument:_,replace:w,state:o,target:E,to:P,preventScrollReset:M,viewTransition:L}=s,F=zZ(s,VZ),{basename:$}=z.useContext(Bh),Y,H=!1;if(typeof P=="string"&&WZ.test(P)&&(Y=P,HZ))try{let q=new URL(window.location.href),oe=P.startsWith("//")?new URL(q.protocol+P):new URL(P),ae=xA(oe.pathname,$);oe.origin===q.origin&&ae!=null?P=ae+oe.search+oe.hash:H=!0}catch{}let X=vZ(P,{relative:m}),Z=qZ(P,{replace:w,state:o,target:E,preventScrollReset:M,relative:m,viewTransition:L});function W(q){d&&d(q),q.defaultPrevented||Z(q)}return z.createElement("a",SE({},F,{href:Y||X,onClick:H||_?d:W,ref:l,target:E}))});var gD;(function(e){e.UseScrollRestoration="useScrollRestoration",e.UseSubmit="useSubmit",e.UseSubmitFetcher="useSubmitFetcher",e.UseFetcher="useFetcher",e.useViewTransitionState="useViewTransitionState"})(gD||(gD={}));var xD;(function(e){e.UseFetcher="useFetcher",e.UseFetchers="useFetchers",e.UseScrollRestoration="useScrollRestoration"})(xD||(xD={}));function qZ(e,s){let{target:l,replace:d,state:m,preventScrollReset:_,relative:w,viewTransition:o}=s===void 0?{}:s,E=Xr(),P=cc(),M=mF(e,{relative:w});return z.useCallback(L=>{if(FZ(L,l)){L.preventDefault();let F=d!==void 0?d:Hw(P)===Hw(M);E(e,{replace:F,state:m,preventScrollReset:_,relative:w,viewTransition:o})}},[P,E,M,d,m,l,e,_,w,o])}function k2(e){let s=z.useRef(jE(e)),l=z.useRef(!1),d=cc(),m=z.useMemo(()=>BZ(d.search,l.current?null:s.current),[d.search]),_=Xr(),w=z.useCallback((o,E)=>{const P=jE(typeof o=="function"?o(m):o);l.current=!0,_("?"+P,E)},[_,m]);return[m,w]}var D2=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(e){return this.listeners.add(e),this.onSubscribe(),()=>{this.listeners.delete(e),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},L2=typeof window>"u"||"Deno"in globalThis;function Yl(){}function ZZ(e,s){return typeof e=="function"?e(s):e}function KZ(e){return typeof e=="number"&&e>=0&&e!==1/0}function XZ(e,s){return Math.max(e+(s||0)-Date.now(),0)}function TE(e,s){return typeof e=="function"?e(s):e}function YZ(e,s){return typeof e=="function"?e(s):e}function yD(e,s){const{type:l="all",exact:d,fetchStatus:m,predicate:_,queryKey:w,stale:o}=e;if(w){if(d){if(s.queryHash!==bA(w,s.options))return!1}else if(!P0(s.queryKey,w))return!1}if(l!=="all"){const E=s.isActive();if(l==="active"&&!E||l==="inactive"&&E)return!1}return!(typeof o=="boolean"&&s.isStale()!==o||m&&m!==s.state.fetchStatus||_&&!_(s))}function _D(e,s){const{exact:l,status:d,predicate:m,mutationKey:_}=e;if(_){if(!s.options.mutationKey)return!1;if(l){if(A0(s.options.mutationKey)!==A0(_))return!1}else if(!P0(s.options.mutationKey,_))return!1}return!(d&&s.state.status!==d||m&&!m(s))}function bA(e,s){return((s==null?void 0:s.queryKeyHashFn)||A0)(e)}function A0(e){return JSON.stringify(e,(s,l)=>NE(l)?Object.keys(l).sort().reduce((d,m)=>(d[m]=l[m],d),{}):l)}function P0(e,s){return e===s?!0:typeof e!=typeof s?!1:e&&s&&typeof e=="object"&&typeof s=="object"?Object.keys(s).every(l=>P0(e[l],s[l])):!1}function yF(e,s){if(e===s)return e;const l=vD(e)&&vD(s);if(l||NE(e)&&NE(s)){const d=l?e:Object.keys(e),m=d.length,_=l?s:Object.keys(s),w=_.length,o=l?[]:{},E=new Set(d);let P=0;for(let M=0;M<w;M++){const L=l?M:_[M];(!l&&E.has(L)||l)&&e[L]===void 0&&s[L]===void 0?(o[L]=void 0,P++):(o[L]=yF(e[L],s[L]),o[L]===e[L]&&e[L]!==void 0&&P++)}return m===w&&P===m?e:o}return s}function vD(e){return Array.isArray(e)&&e.length===Object.keys(e).length}function NE(e){if(!bD(e))return!1;const s=e.constructor;if(s===void 0)return!0;const l=s.prototype;return!(!bD(l)||!l.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(e)!==Object.prototype)}function bD(e){return Object.prototype.toString.call(e)==="[object Object]"}function JZ(e){return new Promise(s=>{setTimeout(s,e)})}function QZ(e,s,l){return typeof l.structuralSharing=="function"?l.structuralSharing(e,s):l.structuralSharing!==!1?yF(e,s):s}function eK(e,s,l=0){const d=[...e,s];return l&&d.length>l?d.slice(1):d}function tK(e,s,l=0){const d=[s,...e];return l&&d.length>l?d.slice(0,-1):d}var wA=Symbol();function _F(e,s){return!e.queryFn&&(s!=null&&s.initialPromise)?()=>s.initialPromise:!e.queryFn||e.queryFn===wA?()=>Promise.reject(new Error(`Missing queryFn: '${e.queryHash}'`)):e.queryFn}var tf,ch,Fg,V4,sK=(V4=class extends D2{constructor(){super();Cr(this,tf);Cr(this,ch);Cr(this,Fg);Fn(this,Fg,s=>{if(!L2&&window.addEventListener){const l=()=>s();return window.addEventListener("visibilitychange",l,!1),()=>{window.removeEventListener("visibilitychange",l)}}})}onSubscribe(){Qt(this,ch)||this.setEventListener(Qt(this,Fg))}onUnsubscribe(){var s;this.hasListeners()||((s=Qt(this,ch))==null||s.call(this),Fn(this,ch,void 0))}setEventListener(s){var l;Fn(this,Fg,s),(l=Qt(this,ch))==null||l.call(this),Fn(this,ch,s(d=>{typeof d=="boolean"?this.setFocused(d):this.onFocus()}))}setFocused(s){Qt(this,tf)!==s&&(Fn(this,tf,s),this.onFocus())}onFocus(){const s=this.isFocused();this.listeners.forEach(l=>{l(s)})}isFocused(){var s;return typeof Qt(this,tf)=="boolean"?Qt(this,tf):((s=globalThis.document)==null?void 0:s.visibilityState)!=="hidden"}},tf=new WeakMap,ch=new WeakMap,Fg=new WeakMap,V4),vF=new sK,Bg,uh,Vg,U4,nK=(U4=class extends D2{constructor(){super();Cr(this,Bg,!0);Cr(this,uh);Cr(this,Vg);Fn(this,Vg,s=>{if(!L2&&window.addEventListener){const l=()=>s(!0),d=()=>s(!1);return window.addEventListener("online",l,!1),window.addEventListener("offline",d,!1),()=>{window.removeEventListener("online",l),window.removeEventListener("offline",d)}}})}onSubscribe(){Qt(this,uh)||this.setEventListener(Qt(this,Vg))}onUnsubscribe(){var s;this.hasListeners()||((s=Qt(this,uh))==null||s.call(this),Fn(this,uh,void 0))}setEventListener(s){var l;Fn(this,Vg,s),(l=Qt(this,uh))==null||l.call(this),Fn(this,uh,s(this.setOnline.bind(this)))}setOnline(s){Qt(this,Bg)!==s&&(Fn(this,Bg,s),this.listeners.forEach(d=>{d(s)}))}isOnline(){return Qt(this,Bg)}},Bg=new WeakMap,uh=new WeakMap,Vg=new WeakMap,U4),qw=new nK;function rK(){let e,s;const l=new Promise((m,_)=>{e=m,s=_});l.status="pending",l.catch(()=>{});function d(m){Object.assign(l,m),delete l.resolve,delete l.reject}return l.resolve=m=>{d({status:"fulfilled",value:m}),e(m)},l.reject=m=>{d({status:"rejected",reason:m}),s(m)},l}function iK(e){return Math.min(1e3*2**e,3e4)}function bF(e){return(e??"online")==="online"?qw.isOnline():!0}var wF=class extends Error{constructor(e){super("CancelledError"),this.revert=e==null?void 0:e.revert,this.silent=e==null?void 0:e.silent}};function qT(e){return e instanceof wF}function SF(e){let s=!1,l=0,d=!1,m;const _=rK(),w=H=>{var X;d||(F(new wF(H)),(X=e.abort)==null||X.call(e))},o=()=>{s=!0},E=()=>{s=!1},P=()=>vF.isFocused()&&(e.networkMode==="always"||qw.isOnline())&&e.canRun(),M=()=>bF(e.networkMode)&&e.canRun(),L=H=>{var X;d||(d=!0,(X=e.onSuccess)==null||X.call(e,H),m==null||m(),_.resolve(H))},F=H=>{var X;d||(d=!0,(X=e.onError)==null||X.call(e,H),m==null||m(),_.reject(H))},$=()=>new Promise(H=>{var X;m=Z=>{(d||P())&&H(Z)},(X=e.onPause)==null||X.call(e)}).then(()=>{var H;m=void 0,d||(H=e.onContinue)==null||H.call(e)}),Y=()=>{if(d)return;let H;const X=l===0?e.initialPromise:void 0;try{H=X??e.fn()}catch(Z){H=Promise.reject(Z)}Promise.resolve(H).then(L).catch(Z=>{var Ne;if(d)return;const W=e.retry??(L2?0:3),q=e.retryDelay??iK,oe=typeof q=="function"?q(l,Z):q,ae=W===!0||typeof W=="number"&&l<W||typeof W=="function"&&W(l,Z);if(s||!ae){F(Z);return}l++,(Ne=e.onFail)==null||Ne.call(e,l,Z),JZ(oe).then(()=>P()?void 0:$()).then(()=>{s?F(Z):Y()})})};return{promise:_,cancel:w,continue:()=>(m==null||m(),_),cancelRetry:o,continueRetry:E,canStart:M,start:()=>(M()?Y():$().then(Y),_)}}var oK=e=>setTimeout(e,0);function aK(){let e=[],s=0,l=o=>{o()},d=o=>{o()},m=oK;const _=o=>{s?e.push(o):m(()=>{l(o)})},w=()=>{const o=e;e=[],o.length&&m(()=>{d(()=>{o.forEach(E=>{l(E)})})})};return{batch:o=>{let E;s++;try{E=o()}finally{s--,s||w()}return E},batchCalls:o=>(...E)=>{_(()=>{o(...E)})},schedule:_,setNotifyFunction:o=>{l=o},setBatchNotifyFunction:o=>{d=o},setScheduler:o=>{m=o}}}var fa=aK(),sf,$4,jF=($4=class{constructor(){Cr(this,sf)}destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),KZ(this.gcTime)&&Fn(this,sf,setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(e){this.gcTime=Math.max(this.gcTime||0,e??(L2?1/0:5*60*1e3))}clearGcTimeout(){Qt(this,sf)&&(clearTimeout(Qt(this,sf)),Fn(this,sf,void 0))}},sf=new WeakMap,$4),Ug,nf,wl,rf,Go,G0,of,Jl,Lu,G4,lK=(G4=class extends jF{constructor(s){super();Cr(this,Jl);Cr(this,Ug);Cr(this,nf);Cr(this,wl);Cr(this,rf);Cr(this,Go);Cr(this,G0);Cr(this,of);Fn(this,of,!1),Fn(this,G0,s.defaultOptions),this.setOptions(s.options),this.observers=[],Fn(this,rf,s.client),Fn(this,wl,Qt(this,rf).getQueryCache()),this.queryKey=s.queryKey,this.queryHash=s.queryHash,Fn(this,Ug,uK(this.options)),this.state=s.state??Qt(this,Ug),this.scheduleGc()}get meta(){return this.options.meta}get promise(){var s;return(s=Qt(this,Go))==null?void 0:s.promise}setOptions(s){this.options={...Qt(this,G0),...s},this.updateGcTime(this.options.gcTime)}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&Qt(this,wl).remove(this)}setData(s,l){const d=QZ(this.state.data,s,this.options);return Vo(this,Jl,Lu).call(this,{data:d,type:"success",dataUpdatedAt:l==null?void 0:l.updatedAt,manual:l==null?void 0:l.manual}),d}setState(s,l){Vo(this,Jl,Lu).call(this,{type:"setState",state:s,setStateOptions:l})}cancel(s){var d,m;const l=(d=Qt(this,Go))==null?void 0:d.promise;return(m=Qt(this,Go))==null||m.cancel(s),l?l.then(Yl).catch(Yl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(Qt(this,Ug))}isActive(){return this.observers.some(s=>YZ(s.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===wA||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(s=>TE(s.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(s=>s.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(s=0){return this.state.data===void 0?!0:s==="static"?!1:this.state.isInvalidated?!0:!XZ(this.state.dataUpdatedAt,s)}onFocus(){var l;const s=this.observers.find(d=>d.shouldFetchOnWindowFocus());s==null||s.refetch({cancelRefetch:!1}),(l=Qt(this,Go))==null||l.continue()}onOnline(){var l;const s=this.observers.find(d=>d.shouldFetchOnReconnect());s==null||s.refetch({cancelRefetch:!1}),(l=Qt(this,Go))==null||l.continue()}addObserver(s){this.observers.includes(s)||(this.observers.push(s),this.clearGcTimeout(),Qt(this,wl).notify({type:"observerAdded",query:this,observer:s}))}removeObserver(s){this.observers.includes(s)&&(this.observers=this.observers.filter(l=>l!==s),this.observers.length||(Qt(this,Go)&&(Qt(this,of)?Qt(this,Go).cancel({revert:!0}):Qt(this,Go).cancelRetry()),this.scheduleGc()),Qt(this,wl).notify({type:"observerRemoved",query:this,observer:s}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||Vo(this,Jl,Lu).call(this,{type:"invalidate"})}fetch(s,l){var P,M,L;if(this.state.fetchStatus!=="idle"){if(this.state.data!==void 0&&(l!=null&&l.cancelRefetch))this.cancel({silent:!0});else if(Qt(this,Go))return Qt(this,Go).continueRetry(),Qt(this,Go).promise}if(s&&this.setOptions(s),!this.options.queryFn){const F=this.observers.find($=>$.options.queryFn);F&&this.setOptions(F.options)}const d=new AbortController,m=F=>{Object.defineProperty(F,"signal",{enumerable:!0,get:()=>(Fn(this,of,!0),d.signal)})},_=()=>{const F=_F(this.options,l),Y=(()=>{const H={client:Qt(this,rf),queryKey:this.queryKey,meta:this.meta};return m(H),H})();return Fn(this,of,!1),this.options.persister?this.options.persister(F,Y,this):F(Y)},o=(()=>{const F={fetchOptions:l,options:this.options,queryKey:this.queryKey,client:Qt(this,rf),state:this.state,fetchFn:_};return m(F),F})();(P=this.options.behavior)==null||P.onFetch(o,this),Fn(this,nf,this.state),(this.state.fetchStatus==="idle"||this.state.fetchMeta!==((M=o.fetchOptions)==null?void 0:M.meta))&&Vo(this,Jl,Lu).call(this,{type:"fetch",meta:(L=o.fetchOptions)==null?void 0:L.meta});const E=F=>{var $,Y,H,X;qT(F)&&F.silent||Vo(this,Jl,Lu).call(this,{type:"error",error:F}),qT(F)||((Y=($=Qt(this,wl).config).onError)==null||Y.call($,F,this),(X=(H=Qt(this,wl).config).onSettled)==null||X.call(H,this.state.data,F,this)),this.scheduleGc()};return Fn(this,Go,SF({initialPromise:l==null?void 0:l.initialPromise,fn:o.fetchFn,abort:d.abort.bind(d),onSuccess:F=>{var $,Y,H,X;if(F===void 0){E(new Error(`${this.queryHash} data is undefined`));return}try{this.setData(F)}catch(Z){E(Z);return}(Y=($=Qt(this,wl).config).onSuccess)==null||Y.call($,F,this),(X=(H=Qt(this,wl).config).onSettled)==null||X.call(H,F,this.state.error,this),this.scheduleGc()},onError:E,onFail:(F,$)=>{Vo(this,Jl,Lu).call(this,{type:"failed",failureCount:F,error:$})},onPause:()=>{Vo(this,Jl,Lu).call(this,{type:"pause"})},onContinue:()=>{Vo(this,Jl,Lu).call(this,{type:"continue"})},retry:o.options.retry,retryDelay:o.options.retryDelay,networkMode:o.options.networkMode,canRun:()=>!0})),Qt(this,Go).start()}},Ug=new WeakMap,nf=new WeakMap,wl=new WeakMap,rf=new WeakMap,Go=new WeakMap,G0=new WeakMap,of=new WeakMap,Jl=new WeakSet,Lu=function(s){const l=d=>{switch(s.type){case"failed":return{...d,fetchFailureCount:s.failureCount,fetchFailureReason:s.error};case"pause":return{...d,fetchStatus:"paused"};case"continue":return{...d,fetchStatus:"fetching"};case"fetch":return{...d,...cK(d.data,this.options),fetchMeta:s.meta??null};case"success":return Fn(this,nf,void 0),{...d,data:s.data,dataUpdateCount:d.dataUpdateCount+1,dataUpdatedAt:s.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!s.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};case"error":const m=s.error;return qT(m)&&m.revert&&Qt(this,nf)?{...Qt(this,nf),fetchStatus:"idle"}:{...d,error:m,errorUpdateCount:d.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:d.fetchFailureCount+1,fetchFailureReason:m,fetchStatus:"idle",status:"error"};case"invalidate":return{...d,isInvalidated:!0};case"setState":return{...d,...s.state}}};this.state=l(this.state),fa.batch(()=>{this.observers.forEach(d=>{d.onQueryUpdate()}),Qt(this,wl).notify({query:this,type:"updated",action:s})})},G4);function cK(e,s){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:bF(s.networkMode)?"fetching":"paused",...e===void 0&&{error:null,status:"pending"}}}function uK(e){const s=typeof e.initialData=="function"?e.initialData():e.initialData,l=s!==void 0,d=l?typeof e.initialDataUpdatedAt=="function"?e.initialDataUpdatedAt():e.initialDataUpdatedAt:0;return{data:s,dataUpdateCount:0,dataUpdatedAt:l?d??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:l?"success":"pending",fetchStatus:"idle"}}var Hc,H4,dK=(H4=class extends D2{constructor(s={}){super();Cr(this,Hc);this.config=s,Fn(this,Hc,new Map)}build(s,l,d){const m=l.queryKey,_=l.queryHash??bA(m,l);let w=this.get(_);return w||(w=new lK({client:s,queryKey:m,queryHash:_,options:s.defaultQueryOptions(l),state:d,defaultOptions:s.getQueryDefaults(m)}),this.add(w)),w}add(s){Qt(this,Hc).has(s.queryHash)||(Qt(this,Hc).set(s.queryHash,s),this.notify({type:"added",query:s}))}remove(s){const l=Qt(this,Hc).get(s.queryHash);l&&(s.destroy(),l===s&&Qt(this,Hc).delete(s.queryHash),this.notify({type:"removed",query:s}))}clear(){fa.batch(()=>{this.getAll().forEach(s=>{this.remove(s)})})}get(s){return Qt(this,Hc).get(s)}getAll(){return[...Qt(this,Hc).values()]}find(s){const l={exact:!0,...s};return this.getAll().find(d=>yD(l,d))}findAll(s={}){const l=this.getAll();return Object.keys(s).length>0?l.filter(d=>yD(s,d)):l}notify(s){fa.batch(()=>{this.listeners.forEach(l=>{l(s)})})}onFocus(){fa.batch(()=>{this.getAll().forEach(s=>{s.onFocus()})})}onOnline(){fa.batch(()=>{this.getAll().forEach(s=>{s.onOnline()})})}},Hc=new WeakMap,H4),Wc,ha,af,qc,sh,W4,hK=(W4=class extends jF{constructor(s){super();Cr(this,qc);Cr(this,Wc);Cr(this,ha);Cr(this,af);this.mutationId=s.mutationId,Fn(this,ha,s.mutationCache),Fn(this,Wc,[]),this.state=s.state||pK(),this.setOptions(s.options),this.scheduleGc()}setOptions(s){this.options=s,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(s){Qt(this,Wc).includes(s)||(Qt(this,Wc).push(s),this.clearGcTimeout(),Qt(this,ha).notify({type:"observerAdded",mutation:this,observer:s}))}removeObserver(s){Fn(this,Wc,Qt(this,Wc).filter(l=>l!==s)),this.scheduleGc(),Qt(this,ha).notify({type:"observerRemoved",mutation:this,observer:s})}optionalRemove(){Qt(this,Wc).length||(this.state.status==="pending"?this.scheduleGc():Qt(this,ha).remove(this))}continue(){var s;return((s=Qt(this,af))==null?void 0:s.continue())??this.execute(this.state.variables)}async execute(s){var _,w,o,E,P,M,L,F,$,Y,H,X,Z,W,q,oe,ae,Ne,Pe,Le;const l=()=>{Vo(this,qc,sh).call(this,{type:"continue"})};Fn(this,af,SF({fn:()=>this.options.mutationFn?this.options.mutationFn(s):Promise.reject(new Error("No mutationFn found")),onFail:(ct,xt)=>{Vo(this,qc,sh).call(this,{type:"failed",failureCount:ct,error:xt})},onPause:()=>{Vo(this,qc,sh).call(this,{type:"pause"})},onContinue:l,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>Qt(this,ha).canRun(this)}));const d=this.state.status==="pending",m=!Qt(this,af).canStart();try{if(d)l();else{Vo(this,qc,sh).call(this,{type:"pending",variables:s,isPaused:m}),await((w=(_=Qt(this,ha).config).onMutate)==null?void 0:w.call(_,s,this));const xt=await((E=(o=this.options).onMutate)==null?void 0:E.call(o,s));xt!==this.state.context&&Vo(this,qc,sh).call(this,{type:"pending",context:xt,variables:s,isPaused:m})}const ct=await Qt(this,af).start();return await((M=(P=Qt(this,ha).config).onSuccess)==null?void 0:M.call(P,ct,s,this.state.context,this)),await((F=(L=this.options).onSuccess)==null?void 0:F.call(L,ct,s,this.state.context)),await((Y=($=Qt(this,ha).config).onSettled)==null?void 0:Y.call($,ct,null,this.state.variables,this.state.context,this)),await((X=(H=this.options).onSettled)==null?void 0:X.call(H,ct,null,s,this.state.context)),Vo(this,qc,sh).call(this,{type:"success",data:ct}),ct}catch(ct){try{throw await((W=(Z=Qt(this,ha).config).onError)==null?void 0:W.call(Z,ct,s,this.state.context,this)),await((oe=(q=this.options).onError)==null?void 0:oe.call(q,ct,s,this.state.context)),await((Ne=(ae=Qt(this,ha).config).onSettled)==null?void 0:Ne.call(ae,void 0,ct,this.state.variables,this.state.context,this)),await((Le=(Pe=this.options).onSettled)==null?void 0:Le.call(Pe,void 0,ct,s,this.state.context)),ct}finally{Vo(this,qc,sh).call(this,{type:"error",error:ct})}}finally{Qt(this,ha).runNext(this)}}},Wc=new WeakMap,ha=new WeakMap,af=new WeakMap,qc=new WeakSet,sh=function(s){const l=d=>{switch(s.type){case"failed":return{...d,failureCount:s.failureCount,failureReason:s.error};case"pause":return{...d,isPaused:!0};case"continue":return{...d,isPaused:!1};case"pending":return{...d,context:s.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:s.isPaused,status:"pending",variables:s.variables,submittedAt:Date.now()};case"success":return{...d,data:s.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...d,data:void 0,error:s.error,failureCount:d.failureCount+1,failureReason:s.error,isPaused:!1,status:"error"}}};this.state=l(this.state),fa.batch(()=>{Qt(this,Wc).forEach(d=>{d.onMutationUpdate(s)}),Qt(this,ha).notify({mutation:this,type:"updated",action:s})})},W4);function pK(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var Fu,Ql,H0,q4,fK=(q4=class extends D2{constructor(s={}){super();Cr(this,Fu);Cr(this,Ql);Cr(this,H0);this.config=s,Fn(this,Fu,new Set),Fn(this,Ql,new Map),Fn(this,H0,0)}build(s,l,d){const m=new hK({mutationCache:this,mutationId:++_b(this,H0)._,options:s.defaultMutationOptions(l),state:d});return this.add(m),m}add(s){Qt(this,Fu).add(s);const l=zb(s);if(typeof l=="string"){const d=Qt(this,Ql).get(l);d?d.push(s):Qt(this,Ql).set(l,[s])}this.notify({type:"added",mutation:s})}remove(s){if(Qt(this,Fu).delete(s)){const l=zb(s);if(typeof l=="string"){const d=Qt(this,Ql).get(l);if(d)if(d.length>1){const m=d.indexOf(s);m!==-1&&d.splice(m,1)}else d[0]===s&&Qt(this,Ql).delete(l)}}this.notify({type:"removed",mutation:s})}canRun(s){const l=zb(s);if(typeof l=="string"){const d=Qt(this,Ql).get(l),m=d==null?void 0:d.find(_=>_.state.status==="pending");return!m||m===s}else return!0}runNext(s){var d;const l=zb(s);if(typeof l=="string"){const m=(d=Qt(this,Ql).get(l))==null?void 0:d.find(_=>_!==s&&_.state.isPaused);return(m==null?void 0:m.continue())??Promise.resolve()}else return Promise.resolve()}clear(){fa.batch(()=>{Qt(this,Fu).forEach(s=>{this.notify({type:"removed",mutation:s})}),Qt(this,Fu).clear(),Qt(this,Ql).clear()})}getAll(){return Array.from(Qt(this,Fu))}find(s){const l={exact:!0,...s};return this.getAll().find(d=>_D(l,d))}findAll(s={}){return this.getAll().filter(l=>_D(s,l))}notify(s){fa.batch(()=>{this.listeners.forEach(l=>{l(s)})})}resumePausedMutations(){const s=this.getAll().filter(l=>l.state.isPaused);return fa.batch(()=>Promise.all(s.map(l=>l.continue().catch(Yl))))}},Fu=new WeakMap,Ql=new WeakMap,H0=new WeakMap,q4);function zb(e){var s;return(s=e.options.scope)==null?void 0:s.id}function wD(e){return{onFetch:(s,l)=>{var M,L,F,$,Y;const d=s.options,m=(F=(L=(M=s.fetchOptions)==null?void 0:M.meta)==null?void 0:L.fetchMore)==null?void 0:F.direction,_=(($=s.state.data)==null?void 0:$.pages)||[],w=((Y=s.state.data)==null?void 0:Y.pageParams)||[];let o={pages:[],pageParams:[]},E=0;const P=async()=>{let H=!1;const X=q=>{Object.defineProperty(q,"signal",{enumerable:!0,get:()=>(s.signal.aborted?H=!0:s.signal.addEventListener("abort",()=>{H=!0}),s.signal)})},Z=_F(s.options,s.fetchOptions),W=async(q,oe,ae)=>{if(H)return Promise.reject();if(oe==null&&q.pages.length)return Promise.resolve(q);const Pe=(()=>{const yt={client:s.client,queryKey:s.queryKey,pageParam:oe,direction:ae?"backward":"forward",meta:s.options.meta};return X(yt),yt})(),Le=await Z(Pe),{maxPages:ct}=s.options,xt=ae?tK:eK;return{pages:xt(q.pages,Le,ct),pageParams:xt(q.pageParams,oe,ct)}};if(m&&_.length){const q=m==="backward",oe=q?mK:SD,ae={pages:_,pageParams:w},Ne=oe(d,ae);o=await W(ae,Ne,q)}else{const q=e??_.length;do{const oe=E===0?w[0]??d.initialPageParam:SD(d,o);if(E>0&&oe==null)break;o=await W(o,oe),E++}while(E<q)}return o};s.options.persister?s.fetchFn=()=>{var H,X;return(X=(H=s.options).persister)==null?void 0:X.call(H,P,{client:s.client,queryKey:s.queryKey,meta:s.options.meta,signal:s.signal},l)}:s.fetchFn=P}}}function SD(e,{pages:s,pageParams:l}){const d=s.length-1;return s.length>0?e.getNextPageParam(s[d],s,l[d],l):void 0}function mK(e,{pages:s,pageParams:l}){var d;return s.length>0?(d=e.getPreviousPageParam)==null?void 0:d.call(e,s[0],s,l[0],l):void 0}var Si,dh,hh,$g,Gg,ph,Hg,Wg,Z4,gK=(Z4=class{constructor(e={}){Cr(this,Si);Cr(this,dh);Cr(this,hh);Cr(this,$g);Cr(this,Gg);Cr(this,ph);Cr(this,Hg);Cr(this,Wg);Fn(this,Si,e.queryCache||new dK),Fn(this,dh,e.mutationCache||new fK),Fn(this,hh,e.defaultOptions||{}),Fn(this,$g,new Map),Fn(this,Gg,new Map),Fn(this,ph,0)}mount(){_b(this,ph)._++,Qt(this,ph)===1&&(Fn(this,Hg,vF.subscribe(async e=>{e&&(await this.resumePausedMutations(),Qt(this,Si).onFocus())})),Fn(this,Wg,qw.subscribe(async e=>{e&&(await this.resumePausedMutations(),Qt(this,Si).onOnline())})))}unmount(){var e,s;_b(this,ph)._--,Qt(this,ph)===0&&((e=Qt(this,Hg))==null||e.call(this),Fn(this,Hg,void 0),(s=Qt(this,Wg))==null||s.call(this),Fn(this,Wg,void 0))}isFetching(e){return Qt(this,Si).findAll({...e,fetchStatus:"fetching"}).length}isMutating(e){return Qt(this,dh).findAll({...e,status:"pending"}).length}getQueryData(e){var l;const s=this.defaultQueryOptions({queryKey:e});return(l=Qt(this,Si).get(s.queryHash))==null?void 0:l.state.data}ensureQueryData(e){const s=this.defaultQueryOptions(e),l=Qt(this,Si).build(this,s),d=l.state.data;return d===void 0?this.fetchQuery(e):(e.revalidateIfStale&&l.isStaleByTime(TE(s.staleTime,l))&&this.prefetchQuery(s),Promise.resolve(d))}getQueriesData(e){return Qt(this,Si).findAll(e).map(({queryKey:s,state:l})=>{const d=l.data;return[s,d]})}setQueryData(e,s,l){const d=this.defaultQueryOptions({queryKey:e}),m=Qt(this,Si).get(d.queryHash),_=m==null?void 0:m.state.data,w=ZZ(s,_);if(w!==void 0)return Qt(this,Si).build(this,d).setData(w,{...l,manual:!0})}setQueriesData(e,s,l){return fa.batch(()=>Qt(this,Si).findAll(e).map(({queryKey:d})=>[d,this.setQueryData(d,s,l)]))}getQueryState(e){var l;const s=this.defaultQueryOptions({queryKey:e});return(l=Qt(this,Si).get(s.queryHash))==null?void 0:l.state}removeQueries(e){const s=Qt(this,Si);fa.batch(()=>{s.findAll(e).forEach(l=>{s.remove(l)})})}resetQueries(e,s){const l=Qt(this,Si);return fa.batch(()=>(l.findAll(e).forEach(d=>{d.reset()}),this.refetchQueries({type:"active",...e},s)))}cancelQueries(e,s={}){const l={revert:!0,...s},d=fa.batch(()=>Qt(this,Si).findAll(e).map(m=>m.cancel(l)));return Promise.all(d).then(Yl).catch(Yl)}invalidateQueries(e,s={}){return fa.batch(()=>(Qt(this,Si).findAll(e).forEach(l=>{l.invalidate()}),(e==null?void 0:e.refetchType)==="none"?Promise.resolve():this.refetchQueries({...e,type:(e==null?void 0:e.refetchType)??(e==null?void 0:e.type)??"active"},s)))}refetchQueries(e,s={}){const l={...s,cancelRefetch:s.cancelRefetch??!0},d=fa.batch(()=>Qt(this,Si).findAll(e).filter(m=>!m.isDisabled()&&!m.isStatic()).map(m=>{let _=m.fetch(void 0,l);return l.throwOnError||(_=_.catch(Yl)),m.state.fetchStatus==="paused"?Promise.resolve():_}));return Promise.all(d).then(Yl)}fetchQuery(e){const s=this.defaultQueryOptions(e);s.retry===void 0&&(s.retry=!1);const l=Qt(this,Si).build(this,s);return l.isStaleByTime(TE(s.staleTime,l))?l.fetch(s):Promise.resolve(l.state.data)}prefetchQuery(e){return this.fetchQuery(e).then(Yl).catch(Yl)}fetchInfiniteQuery(e){return e.behavior=wD(e.pages),this.fetchQuery(e)}prefetchInfiniteQuery(e){return this.fetchInfiniteQuery(e).then(Yl).catch(Yl)}ensureInfiniteQueryData(e){return e.behavior=wD(e.pages),this.ensureQueryData(e)}resumePausedMutations(){return qw.isOnline()?Qt(this,dh).resumePausedMutations():Promise.resolve()}getQueryCache(){return Qt(this,Si)}getMutationCache(){return Qt(this,dh)}getDefaultOptions(){return Qt(this,hh)}setDefaultOptions(e){Fn(this,hh,e)}setQueryDefaults(e,s){Qt(this,$g).set(A0(e),{queryKey:e,defaultOptions:s})}getQueryDefaults(e){const s=[...Qt(this,$g).values()],l={};return s.forEach(d=>{P0(e,d.queryKey)&&Object.assign(l,d.defaultOptions)}),l}setMutationDefaults(e,s){Qt(this,Gg).set(A0(e),{mutationKey:e,defaultOptions:s})}getMutationDefaults(e){const s=[...Qt(this,Gg).values()],l={};return s.forEach(d=>{P0(e,d.mutationKey)&&Object.assign(l,d.defaultOptions)}),l}defaultQueryOptions(e){if(e._defaulted)return e;const s={...Qt(this,hh).queries,...this.getQueryDefaults(e.queryKey),...e,_defaulted:!0};return s.queryHash||(s.queryHash=bA(s.queryKey,s)),s.refetchOnReconnect===void 0&&(s.refetchOnReconnect=s.networkMode!=="always"),s.throwOnError===void 0&&(s.throwOnError=!!s.suspense),!s.networkMode&&s.persister&&(s.networkMode="offlineFirst"),s.queryFn===wA&&(s.enabled=!1),s}defaultMutationOptions(e){return e!=null&&e._defaulted?e:{...Qt(this,hh).mutations,...(e==null?void 0:e.mutationKey)&&this.getMutationDefaults(e.mutationKey),...e,_defaulted:!0}}clear(){Qt(this,Si).clear(),Qt(this,dh).clear()}},Si=new WeakMap,dh=new WeakMap,hh=new WeakMap,$g=new WeakMap,Gg=new WeakMap,ph=new WeakMap,Hg=new WeakMap,Wg=new WeakMap,Z4),xK=z.createContext(void 0),yK=({client:e,children:s})=>(z.useEffect(()=>(e.mount(),()=>{e.unmount()}),[e]),n.jsx(xK.Provider,{value:e,children:s}));function bs(e,s,{checkForDefaultPrevented:l=!0}={}){return function(m){if(e==null||e(m),l===!1||!m.defaultPrevented)return s==null?void 0:s(m)}}function jD(e,s){if(typeof e=="function")return e(s);e!=null&&(e.current=s)}function z2(...e){return s=>{let l=!1;const d=e.map(m=>{const _=jD(m,s);return!l&&typeof _=="function"&&(l=!0),_});if(l)return()=>{for(let m=0;m<d.length;m++){const _=d[m];typeof _=="function"?_():jD(e[m],null)}}}}function Gn(...e){return z.useCallback(z2(...e),e)}function _K(e,s){const l=z.createContext(s),d=_=>{const{children:w,...o}=_,E=z.useMemo(()=>o,Object.values(o));return n.jsx(l.Provider,{value:E,children:w})};d.displayName=e+"Provider";function m(_){const w=z.useContext(l);if(w)return w;if(s!==void 0)return s;throw new Error(`\`${_}\` must be used within \`${e}\``)}return[d,m]}function Xo(e,s=[]){let l=[];function d(_,w){const o=z.createContext(w),E=l.length;l=[...l,w];const P=L=>{var Z;const{scope:F,children:$,...Y}=L,H=((Z=F==null?void 0:F[e])==null?void 0:Z[E])||o,X=z.useMemo(()=>Y,Object.values(Y));return n.jsx(H.Provider,{value:X,children:$})};P.displayName=_+"Provider";function M(L,F){var H;const $=((H=F==null?void 0:F[e])==null?void 0:H[E])||o,Y=z.useContext($);if(Y)return Y;if(w!==void 0)return w;throw new Error(`\`${L}\` must be used within \`${_}\``)}return[P,M]}const m=()=>{const _=l.map(w=>z.createContext(w));return function(o){const E=(o==null?void 0:o[e])||_;return z.useMemo(()=>({[`__scope${e}`]:{...o,[e]:E}}),[o,E])}};return m.scopeName=e,[d,vK(m,...s)]}function vK(...e){const s=e[0];if(e.length===1)return s;const l=()=>{const d=e.map(m=>({useScope:m(),scopeName:m.scopeName}));return function(_){const w=d.reduce((o,{useScope:E,scopeName:P})=>{const L=E(_)[`__scope${P}`];return{...o,...L}},{});return z.useMemo(()=>({[`__scope${s.scopeName}`]:w}),[w])}};return l.scopeName=s.scopeName,l}function yf(e){const s=wK(e),l=z.forwardRef((d,m)=>{const{children:_,...w}=d,o=z.Children.toArray(_),E=o.find(SK);if(E){const P=E.props.children,M=o.map(L=>L===E?z.Children.count(P)>1?z.Children.only(null):z.isValidElement(P)?P.props.children:null:L);return n.jsx(s,{...w,ref:m,children:z.isValidElement(P)?z.cloneElement(P,void 0,M):null})}return n.jsx(s,{...w,ref:m,children:_})});return l.displayName=`${e}.Slot`,l}var bK=yf("Slot");function wK(e){const s=z.forwardRef((l,d)=>{const{children:m,..._}=l;if(z.isValidElement(m)){const w=TK(m),o=jK(_,m.props);return m.type!==z.Fragment&&(o.ref=d?z2(d,w):w),z.cloneElement(m,o)}return z.Children.count(m)>1?z.Children.only(null):null});return s.displayName=`${e}.SlotClone`,s}var TF=Symbol("radix.slottable");function NF(e){const s=({children:l})=>n.jsx(n.Fragment,{children:l});return s.displayName=`${e}.Slottable`,s.__radixId=TF,s}function SK(e){return z.isValidElement(e)&&typeof e.type=="function"&&"__radixId"in e.type&&e.type.__radixId===TF}function jK(e,s){const l={...s};for(const d in s){const m=e[d],_=s[d];/^on[A-Z]/.test(d)?m&&_?l[d]=(...o)=>{const E=_(...o);return m(...o),E}:m&&(l[d]=m):d==="style"?l[d]={...m,..._}:d==="className"&&(l[d]=[m,_].filter(Boolean).join(" "))}return{...e,...l}}function TK(e){var d,m;let s=(d=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:d.get,l=s&&"isReactWarning"in s&&s.isReactWarning;return l?e.ref:(s=(m=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:m.get,l=s&&"isReactWarning"in s&&s.isReactWarning,l?e.props.ref:e.props.ref||e.ref)}var NK=["a","button","div","form","h2","h3","img","input","label","li","nav","ol","p","select","span","svg","ul"],Ys=NK.reduce((e,s)=>{const l=yf(`Primitive.${s}`),d=z.forwardRef((m,_)=>{const{asChild:w,...o}=m,E=w?l:s;return typeof window<"u"&&(window[Symbol.for("radix-ui")]=!0),n.jsx(E,{...o,ref:_})});return d.displayName=`Primitive.${s}`,{...e,[s]:d}},{});function SA(e,s){e&&Ef.flushSync(()=>e.dispatchEvent(s))}function Ci(e){const s=z.useRef(e);return z.useEffect(()=>{s.current=e}),z.useMemo(()=>(...l)=>{var d;return(d=s.current)==null?void 0:d.call(s,...l)},[])}function EK(e,s=globalThis==null?void 0:globalThis.document){const l=Ci(e);z.useEffect(()=>{const d=m=>{m.key==="Escape"&&l(m)};return s.addEventListener("keydown",d,{capture:!0}),()=>s.removeEventListener("keydown",d,{capture:!0})},[l,s])}var CK="DismissableLayer",EE="dismissableLayer.update",AK="dismissableLayer.pointerDownOutside",PK="dismissableLayer.focusOutside",TD,EF=z.createContext({layers:new Set,layersWithOutsidePointerEventsDisabled:new Set,branches:new Set}),gx=z.forwardRef((e,s)=>{const{disableOutsidePointerEvents:l=!1,onEscapeKeyDown:d,onPointerDownOutside:m,onFocusOutside:_,onInteractOutside:w,onDismiss:o,...E}=e,P=z.useContext(EF),[M,L]=z.useState(null),F=(M==null?void 0:M.ownerDocument)??(globalThis==null?void 0:globalThis.document),[,$]=z.useState({}),Y=Gn(s,Pe=>L(Pe)),H=Array.from(P.layers),[X]=[...P.layersWithOutsidePointerEventsDisabled].slice(-1),Z=H.indexOf(X),W=M?H.indexOf(M):-1,q=P.layersWithOutsidePointerEventsDisabled.size>0,oe=W>=Z,ae=MK(Pe=>{const Le=Pe.target,ct=[...P.branches].some(xt=>xt.contains(Le));!oe||ct||(m==null||m(Pe),w==null||w(Pe),Pe.defaultPrevented||o==null||o())},F),Ne=RK(Pe=>{const Le=Pe.target;[...P.branches].some(xt=>xt.contains(Le))||(_==null||_(Pe),w==null||w(Pe),Pe.defaultPrevented||o==null||o())},F);return EK(Pe=>{W===P.layers.size-1&&(d==null||d(Pe),!Pe.defaultPrevented&&o&&(Pe.preventDefault(),o()))},F),z.useEffect(()=>{if(M)return l&&(P.layersWithOutsidePointerEventsDisabled.size===0&&(TD=F.body.style.pointerEvents,F.body.style.pointerEvents="none"),P.layersWithOutsidePointerEventsDisabled.add(M)),P.layers.add(M),ND(),()=>{l&&P.layersWithOutsidePointerEventsDisabled.size===1&&(F.body.style.pointerEvents=TD)}},[M,F,l,P]),z.useEffect(()=>()=>{M&&(P.layers.delete(M),P.layersWithOutsidePointerEventsDisabled.delete(M),ND())},[M,P]),z.useEffect(()=>{const Pe=()=>$({});return document.addEventListener(EE,Pe),()=>document.removeEventListener(EE,Pe)},[]),n.jsx(Ys.div,{...E,ref:Y,style:{pointerEvents:q?oe?"auto":"none":void 0,...e.style},onFocusCapture:bs(e.onFocusCapture,Ne.onFocusCapture),onBlurCapture:bs(e.onBlurCapture,Ne.onBlurCapture),onPointerDownCapture:bs(e.onPointerDownCapture,ae.onPointerDownCapture)})});gx.displayName=CK;var IK="DismissableLayerBranch",CF=z.forwardRef((e,s)=>{const l=z.useContext(EF),d=z.useRef(null),m=Gn(s,d);return z.useEffect(()=>{const _=d.current;if(_)return l.branches.add(_),()=>{l.branches.delete(_)}},[l.branches]),n.jsx(Ys.div,{...e,ref:m})});CF.displayName=IK;function MK(e,s=globalThis==null?void 0:globalThis.document){const l=Ci(e),d=z.useRef(!1),m=z.useRef(()=>{});return z.useEffect(()=>{const _=o=>{if(o.target&&!d.current){let E=function(){AF(AK,l,P,{discrete:!0})};const P={originalEvent:o};o.pointerType==="touch"?(s.removeEventListener("click",m.current),m.current=E,s.addEventListener("click",m.current,{once:!0})):E()}else s.removeEventListener("click",m.current);d.current=!1},w=window.setTimeout(()=>{s.addEventListener("pointerdown",_)},0);return()=>{window.clearTimeout(w),s.removeEventListener("pointerdown",_),s.removeEventListener("click",m.current)}},[s,l]),{onPointerDownCapture:()=>d.current=!0}}function RK(e,s=globalThis==null?void 0:globalThis.document){const l=Ci(e),d=z.useRef(!1);return z.useEffect(()=>{const m=_=>{_.target&&!d.current&&AF(PK,l,{originalEvent:_},{discrete:!1})};return s.addEventListener("focusin",m),()=>s.removeEventListener("focusin",m)},[s,l]),{onFocusCapture:()=>d.current=!0,onBlurCapture:()=>d.current=!1}}function ND(){const e=new CustomEvent(EE);document.dispatchEvent(e)}function AF(e,s,l,{discrete:d}){const m=l.originalEvent.target,_=new CustomEvent(e,{bubbles:!1,cancelable:!0,detail:l});s&&m.addEventListener(e,s,{once:!0}),d?SA(m,_):m.dispatchEvent(_)}var kK=gx,DK=CF,Fi=globalThis!=null&&globalThis.document?z.useLayoutEffect:()=>{},LK=NC[" useId ".trim().toString()]||(()=>{}),zK=0;function Qc(e){const[s,l]=z.useState(LK());return Fi(()=>{l(d=>d??String(zK++))},[e]),s?`radix-${s}`:""}const OK=["top","right","bottom","left"],Ih=Math.min,Xa=Math.max,Zw=Math.round,Ob=Math.floor,eu=e=>({x:e,y:e}),FK={left:"right",right:"left",bottom:"top",top:"bottom"},BK={start:"end",end:"start"};function CE(e,s,l){return Xa(e,Ih(s,l))}function Yu(e,s){return typeof e=="function"?e(s):e}function Ju(e){return e.split("-")[0]}function xx(e){return e.split("-")[1]}function jA(e){return e==="x"?"y":"x"}function TA(e){return e==="y"?"height":"width"}const VK=new Set(["top","bottom"]);function Xc(e){return VK.has(Ju(e))?"y":"x"}function NA(e){return jA(Xc(e))}function UK(e,s,l){l===void 0&&(l=!1);const d=xx(e),m=NA(e),_=TA(m);let w=m==="x"?d===(l?"end":"start")?"right":"left":d==="start"?"bottom":"top";return s.reference[_]>s.floating[_]&&(w=Kw(w)),[w,Kw(w)]}function $K(e){const s=Kw(e);return[AE(e),s,AE(s)]}function AE(e){return e.replace(/start|end/g,s=>BK[s])}const ED=["left","right"],CD=["right","left"],GK=["top","bottom"],HK=["bottom","top"];function WK(e,s,l){switch(e){case"top":case"bottom":return l?s?CD:ED:s?ED:CD;case"left":case"right":return s?GK:HK;default:return[]}}function qK(e,s,l,d){const m=xx(e);let _=WK(Ju(e),l==="start",d);return m&&(_=_.map(w=>w+"-"+m),s&&(_=_.concat(_.map(AE)))),_}function Kw(e){return e.replace(/left|right|bottom|top/g,s=>FK[s])}function ZK(e){return{top:0,right:0,bottom:0,left:0,...e}}function PF(e){return typeof e!="number"?ZK(e):{top:e,right:e,bottom:e,left:e}}function Xw(e){const{x:s,y:l,width:d,height:m}=e;return{width:d,height:m,top:l,left:s,right:s+d,bottom:l+m,x:s,y:l}}function AD(e,s,l){let{reference:d,floating:m}=e;const _=Xc(s),w=NA(s),o=TA(w),E=Ju(s),P=_==="y",M=d.x+d.width/2-m.width/2,L=d.y+d.height/2-m.height/2,F=d[o]/2-m[o]/2;let $;switch(E){case"top":$={x:M,y:d.y-m.height};break;case"bottom":$={x:M,y:d.y+d.height};break;case"right":$={x:d.x+d.width,y:L};break;case"left":$={x:d.x-m.width,y:L};break;default:$={x:d.x,y:d.y}}switch(xx(s)){case"start":$[w]-=F*(l&&P?-1:1);break;case"end":$[w]+=F*(l&&P?-1:1);break}return $}const KK=async(e,s,l)=>{const{placement:d="bottom",strategy:m="absolute",middleware:_=[],platform:w}=l,o=_.filter(Boolean),E=await(w.isRTL==null?void 0:w.isRTL(s));let P=await w.getElementRects({reference:e,floating:s,strategy:m}),{x:M,y:L}=AD(P,d,E),F=d,$={},Y=0;for(let H=0;H<o.length;H++){const{name:X,fn:Z}=o[H],{x:W,y:q,data:oe,reset:ae}=await Z({x:M,y:L,initialPlacement:d,placement:F,strategy:m,middlewareData:$,rects:P,platform:w,elements:{reference:e,floating:s}});M=W??M,L=q??L,$={...$,[X]:{...$[X],...oe}},ae&&Y<=50&&(Y++,typeof ae=="object"&&(ae.placement&&(F=ae.placement),ae.rects&&(P=ae.rects===!0?await w.getElementRects({reference:e,floating:s,strategy:m}):ae.rects),{x:M,y:L}=AD(P,F,E)),H=-1)}return{x:M,y:L,placement:F,strategy:m,middlewareData:$}};async function I0(e,s){var l;s===void 0&&(s={});const{x:d,y:m,platform:_,rects:w,elements:o,strategy:E}=e,{boundary:P="clippingAncestors",rootBoundary:M="viewport",elementContext:L="floating",altBoundary:F=!1,padding:$=0}=Yu(s,e),Y=PF($),X=o[F?L==="floating"?"reference":"floating":L],Z=Xw(await _.getClippingRect({element:(l=await(_.isElement==null?void 0:_.isElement(X)))==null||l?X:X.contextElement||await(_.getDocumentElement==null?void 0:_.getDocumentElement(o.floating)),boundary:P,rootBoundary:M,strategy:E})),W=L==="floating"?{x:d,y:m,width:w.floating.width,height:w.floating.height}:w.reference,q=await(_.getOffsetParent==null?void 0:_.getOffsetParent(o.floating)),oe=await(_.isElement==null?void 0:_.isElement(q))?await(_.getScale==null?void 0:_.getScale(q))||{x:1,y:1}:{x:1,y:1},ae=Xw(_.convertOffsetParentRelativeRectToViewportRelativeRect?await _.convertOffsetParentRelativeRectToViewportRelativeRect({elements:o,rect:W,offsetParent:q,strategy:E}):W);return{top:(Z.top-ae.top+Y.top)/oe.y,bottom:(ae.bottom-Z.bottom+Y.bottom)/oe.y,left:(Z.left-ae.left+Y.left)/oe.x,right:(ae.right-Z.right+Y.right)/oe.x}}const XK=e=>({name:"arrow",options:e,async fn(s){const{x:l,y:d,placement:m,rects:_,platform:w,elements:o,middlewareData:E}=s,{element:P,padding:M=0}=Yu(e,s)||{};if(P==null)return{};const L=PF(M),F={x:l,y:d},$=NA(m),Y=TA($),H=await w.getDimensions(P),X=$==="y",Z=X?"top":"left",W=X?"bottom":"right",q=X?"clientHeight":"clientWidth",oe=_.reference[Y]+_.reference[$]-F[$]-_.floating[Y],ae=F[$]-_.reference[$],Ne=await(w.getOffsetParent==null?void 0:w.getOffsetParent(P));let Pe=Ne?Ne[q]:0;(!Pe||!await(w.isElement==null?void 0:w.isElement(Ne)))&&(Pe=o.floating[q]||_.floating[Y]);const Le=oe/2-ae/2,ct=Pe/2-H[Y]/2-1,xt=Ih(L[Z],ct),yt=Ih(L[W],ct),Ht=xt,Dt=Pe-H[Y]-yt,wt=Pe/2-H[Y]/2+Le,rs=CE(Ht,wt,Dt),Vt=!E.arrow&&xx(m)!=null&&wt!==rs&&_.reference[Y]/2-(wt<Ht?xt:yt)-H[Y]/2<0,Bt=Vt?wt<Ht?wt-Ht:wt-Dt:0;return{[$]:F[$]+Bt,data:{[$]:rs,centerOffset:wt-rs-Bt,...Vt&&{alignmentOffset:Bt}},reset:Vt}}}),YK=function(e){return e===void 0&&(e={}),{name:"flip",options:e,async fn(s){var l,d;const{placement:m,middlewareData:_,rects:w,initialPlacement:o,platform:E,elements:P}=s,{mainAxis:M=!0,crossAxis:L=!0,fallbackPlacements:F,fallbackStrategy:$="bestFit",fallbackAxisSideDirection:Y="none",flipAlignment:H=!0,...X}=Yu(e,s);if((l=_.arrow)!=null&&l.alignmentOffset)return{};const Z=Ju(m),W=Xc(o),q=Ju(o)===o,oe=await(E.isRTL==null?void 0:E.isRTL(P.floating)),ae=F||(q||!H?[Kw(o)]:$K(o)),Ne=Y!=="none";!F&&Ne&&ae.push(...qK(o,H,Y,oe));const Pe=[o,...ae],Le=await I0(s,X),ct=[];let xt=((d=_.flip)==null?void 0:d.overflows)||[];if(M&&ct.push(Le[Z]),L){const wt=UK(m,w,oe);ct.push(Le[wt[0]],Le[wt[1]])}if(xt=[...xt,{placement:m,overflows:ct}],!ct.every(wt=>wt<=0)){var yt,Ht;const wt=(((yt=_.flip)==null?void 0:yt.index)||0)+1,rs=Pe[wt];if(rs&&(!(L==="alignment"?W!==Xc(rs):!1)||xt.every(ze=>ze.overflows[0]>0&&Xc(ze.placement)===W)))return{data:{index:wt,overflows:xt},reset:{placement:rs}};let Vt=(Ht=xt.filter(Bt=>Bt.overflows[0]<=0).sort((Bt,ze)=>Bt.overflows[1]-ze.overflows[1])[0])==null?void 0:Ht.placement;if(!Vt)switch($){case"bestFit":{var Dt;const Bt=(Dt=xt.filter(ze=>{if(Ne){const Xe=Xc(ze.placement);return Xe===W||Xe==="y"}return!0}).map(ze=>[ze.placement,ze.overflows.filter(Xe=>Xe>0).reduce((Xe,Ot)=>Xe+Ot,0)]).sort((ze,Xe)=>ze[1]-Xe[1])[0])==null?void 0:Dt[0];Bt&&(Vt=Bt);break}case"initialPlacement":Vt=o;break}if(m!==Vt)return{reset:{placement:Vt}}}return{}}}};function PD(e,s){return{top:e.top-s.height,right:e.right-s.width,bottom:e.bottom-s.height,left:e.left-s.width}}function ID(e){return OK.some(s=>e[s]>=0)}const JK=function(e){return e===void 0&&(e={}),{name:"hide",options:e,async fn(s){const{rects:l}=s,{strategy:d="referenceHidden",...m}=Yu(e,s);switch(d){case"referenceHidden":{const _=await I0(s,{...m,elementContext:"reference"}),w=PD(_,l.reference);return{data:{referenceHiddenOffsets:w,referenceHidden:ID(w)}}}case"escaped":{const _=await I0(s,{...m,altBoundary:!0}),w=PD(_,l.floating);return{data:{escapedOffsets:w,escaped:ID(w)}}}default:return{}}}}},IF=new Set(["left","top"]);async function QK(e,s){const{placement:l,platform:d,elements:m}=e,_=await(d.isRTL==null?void 0:d.isRTL(m.floating)),w=Ju(l),o=xx(l),E=Xc(l)==="y",P=IF.has(w)?-1:1,M=_&&E?-1:1,L=Yu(s,e);let{mainAxis:F,crossAxis:$,alignmentAxis:Y}=typeof L=="number"?{mainAxis:L,crossAxis:0,alignmentAxis:null}:{mainAxis:L.mainAxis||0,crossAxis:L.crossAxis||0,alignmentAxis:L.alignmentAxis};return o&&typeof Y=="number"&&($=o==="end"?Y*-1:Y),E?{x:$*M,y:F*P}:{x:F*P,y:$*M}}const eX=function(e){return e===void 0&&(e=0),{name:"offset",options:e,async fn(s){var l,d;const{x:m,y:_,placement:w,middlewareData:o}=s,E=await QK(s,e);return w===((l=o.offset)==null?void 0:l.placement)&&(d=o.arrow)!=null&&d.alignmentOffset?{}:{x:m+E.x,y:_+E.y,data:{...E,placement:w}}}}},tX=function(e){return e===void 0&&(e={}),{name:"shift",options:e,async fn(s){const{x:l,y:d,placement:m}=s,{mainAxis:_=!0,crossAxis:w=!1,limiter:o={fn:X=>{let{x:Z,y:W}=X;return{x:Z,y:W}}},...E}=Yu(e,s),P={x:l,y:d},M=await I0(s,E),L=Xc(Ju(m)),F=jA(L);let $=P[F],Y=P[L];if(_){const X=F==="y"?"top":"left",Z=F==="y"?"bottom":"right",W=$+M[X],q=$-M[Z];$=CE(W,$,q)}if(w){const X=L==="y"?"top":"left",Z=L==="y"?"bottom":"right",W=Y+M[X],q=Y-M[Z];Y=CE(W,Y,q)}const H=o.fn({...s,[F]:$,[L]:Y});return{...H,data:{x:H.x-l,y:H.y-d,enabled:{[F]:_,[L]:w}}}}}},sX=function(e){return e===void 0&&(e={}),{options:e,fn(s){const{x:l,y:d,placement:m,rects:_,middlewareData:w}=s,{offset:o=0,mainAxis:E=!0,crossAxis:P=!0}=Yu(e,s),M={x:l,y:d},L=Xc(m),F=jA(L);let $=M[F],Y=M[L];const H=Yu(o,s),X=typeof H=="number"?{mainAxis:H,crossAxis:0}:{mainAxis:0,crossAxis:0,...H};if(E){const q=F==="y"?"height":"width",oe=_.reference[F]-_.floating[q]+X.mainAxis,ae=_.reference[F]+_.reference[q]-X.mainAxis;$<oe?$=oe:$>ae&&($=ae)}if(P){var Z,W;const q=F==="y"?"width":"height",oe=IF.has(Ju(m)),ae=_.reference[L]-_.floating[q]+(oe&&((Z=w.offset)==null?void 0:Z[L])||0)+(oe?0:X.crossAxis),Ne=_.reference[L]+_.reference[q]+(oe?0:((W=w.offset)==null?void 0:W[L])||0)-(oe?X.crossAxis:0);Y<ae?Y=ae:Y>Ne&&(Y=Ne)}return{[F]:$,[L]:Y}}}},nX=function(e){return e===void 0&&(e={}),{name:"size",options:e,async fn(s){var l,d;const{placement:m,rects:_,platform:w,elements:o}=s,{apply:E=()=>{},...P}=Yu(e,s),M=await I0(s,P),L=Ju(m),F=xx(m),$=Xc(m)==="y",{width:Y,height:H}=_.floating;let X,Z;L==="top"||L==="bottom"?(X=L,Z=F===(await(w.isRTL==null?void 0:w.isRTL(o.floating))?"start":"end")?"left":"right"):(Z=L,X=F==="end"?"top":"bottom");const W=H-M.top-M.bottom,q=Y-M.left-M.right,oe=Ih(H-M[X],W),ae=Ih(Y-M[Z],q),Ne=!s.middlewareData.shift;let Pe=oe,Le=ae;if((l=s.middlewareData.shift)!=null&&l.enabled.x&&(Le=q),(d=s.middlewareData.shift)!=null&&d.enabled.y&&(Pe=W),Ne&&!F){const xt=Xa(M.left,0),yt=Xa(M.right,0),Ht=Xa(M.top,0),Dt=Xa(M.bottom,0);$?Le=Y-2*(xt!==0||yt!==0?xt+yt:Xa(M.left,M.right)):Pe=H-2*(Ht!==0||Dt!==0?Ht+Dt:Xa(M.top,M.bottom))}await E({...s,availableWidth:Le,availableHeight:Pe});const ct=await w.getDimensions(o.floating);return Y!==ct.width||H!==ct.height?{reset:{rects:!0}}:{}}}};function O2(){return typeof window<"u"}function yx(e){return MF(e)?(e.nodeName||"").toLowerCase():"#document"}function el(e){var s;return(e==null||(s=e.ownerDocument)==null?void 0:s.defaultView)||window}function cu(e){var s;return(s=(MF(e)?e.ownerDocument:e.document)||window.document)==null?void 0:s.documentElement}function MF(e){return O2()?e instanceof Node||e instanceof el(e).Node:!1}function ic(e){return O2()?e instanceof Element||e instanceof el(e).Element:!1}function ou(e){return O2()?e instanceof HTMLElement||e instanceof el(e).HTMLElement:!1}function MD(e){return!O2()||typeof ShadowRoot>"u"?!1:e instanceof ShadowRoot||e instanceof el(e).ShadowRoot}const rX=new Set(["inline","contents"]);function Y0(e){const{overflow:s,overflowX:l,overflowY:d,display:m}=oc(e);return/auto|scroll|overlay|hidden|clip/.test(s+d+l)&&!rX.has(m)}const iX=new Set(["table","td","th"]);function oX(e){return iX.has(yx(e))}const aX=[":popover-open",":modal"];function F2(e){return aX.some(s=>{try{return e.matches(s)}catch{return!1}})}const lX=["transform","translate","scale","rotate","perspective"],cX=["transform","translate","scale","rotate","perspective","filter"],uX=["paint","layout","strict","content"];function EA(e){const s=CA(),l=ic(e)?oc(e):e;return lX.some(d=>l[d]?l[d]!=="none":!1)||(l.containerType?l.containerType!=="normal":!1)||!s&&(l.backdropFilter?l.backdropFilter!=="none":!1)||!s&&(l.filter?l.filter!=="none":!1)||cX.some(d=>(l.willChange||"").includes(d))||uX.some(d=>(l.contain||"").includes(d))}function dX(e){let s=Mh(e);for(;ou(s)&&!ex(s);){if(EA(s))return s;if(F2(s))return null;s=Mh(s)}return null}function CA(){return typeof CSS>"u"||!CSS.supports?!1:CSS.supports("-webkit-backdrop-filter","none")}const hX=new Set(["html","body","#document"]);function ex(e){return hX.has(yx(e))}function oc(e){return el(e).getComputedStyle(e)}function B2(e){return ic(e)?{scrollLeft:e.scrollLeft,scrollTop:e.scrollTop}:{scrollLeft:e.scrollX,scrollTop:e.scrollY}}function Mh(e){if(yx(e)==="html")return e;const s=e.assignedSlot||e.parentNode||MD(e)&&e.host||cu(e);return MD(s)?s.host:s}function RF(e){const s=Mh(e);return ex(s)?e.ownerDocument?e.ownerDocument.body:e.body:ou(s)&&Y0(s)?s:RF(s)}function M0(e,s,l){var d;s===void 0&&(s=[]),l===void 0&&(l=!0);const m=RF(e),_=m===((d=e.ownerDocument)==null?void 0:d.body),w=el(m);if(_){const o=PE(w);return s.concat(w,w.visualViewport||[],Y0(m)?m:[],o&&l?M0(o):[])}return s.concat(m,M0(m,[],l))}function PE(e){return e.parent&&Object.getPrototypeOf(e.parent)?e.frameElement:null}function kF(e){const s=oc(e);let l=parseFloat(s.width)||0,d=parseFloat(s.height)||0;const m=ou(e),_=m?e.offsetWidth:l,w=m?e.offsetHeight:d,o=Zw(l)!==_||Zw(d)!==w;return o&&(l=_,d=w),{width:l,height:d,$:o}}function AA(e){return ic(e)?e:e.contextElement}function Mg(e){const s=AA(e);if(!ou(s))return eu(1);const l=s.getBoundingClientRect(),{width:d,height:m,$:_}=kF(s);let w=(_?Zw(l.width):l.width)/d,o=(_?Zw(l.height):l.height)/m;return(!w||!Number.isFinite(w))&&(w=1),(!o||!Number.isFinite(o))&&(o=1),{x:w,y:o}}const pX=eu(0);function DF(e){const s=el(e);return!CA()||!s.visualViewport?pX:{x:s.visualViewport.offsetLeft,y:s.visualViewport.offsetTop}}function fX(e,s,l){return s===void 0&&(s=!1),!l||s&&l!==el(e)?!1:s}function _f(e,s,l,d){s===void 0&&(s=!1),l===void 0&&(l=!1);const m=e.getBoundingClientRect(),_=AA(e);let w=eu(1);s&&(d?ic(d)&&(w=Mg(d)):w=Mg(e));const o=fX(_,l,d)?DF(_):eu(0);let E=(m.left+o.x)/w.x,P=(m.top+o.y)/w.y,M=m.width/w.x,L=m.height/w.y;if(_){const F=el(_),$=d&&ic(d)?el(d):d;let Y=F,H=PE(Y);for(;H&&d&&$!==Y;){const X=Mg(H),Z=H.getBoundingClientRect(),W=oc(H),q=Z.left+(H.clientLeft+parseFloat(W.paddingLeft))*X.x,oe=Z.top+(H.clientTop+parseFloat(W.paddingTop))*X.y;E*=X.x,P*=X.y,M*=X.x,L*=X.y,E+=q,P+=oe,Y=el(H),H=PE(Y)}}return Xw({width:M,height:L,x:E,y:P})}function PA(e,s){const l=B2(e).scrollLeft;return s?s.left+l:_f(cu(e)).left+l}function LF(e,s,l){l===void 0&&(l=!1);const d=e.getBoundingClientRect(),m=d.left+s.scrollLeft-(l?0:PA(e,d)),_=d.top+s.scrollTop;return{x:m,y:_}}function mX(e){let{elements:s,rect:l,offsetParent:d,strategy:m}=e;const _=m==="fixed",w=cu(d),o=s?F2(s.floating):!1;if(d===w||o&&_)return l;let E={scrollLeft:0,scrollTop:0},P=eu(1);const M=eu(0),L=ou(d);if((L||!L&&!_)&&((yx(d)!=="body"||Y0(w))&&(E=B2(d)),ou(d))){const $=_f(d);P=Mg(d),M.x=$.x+d.clientLeft,M.y=$.y+d.clientTop}const F=w&&!L&&!_?LF(w,E,!0):eu(0);return{width:l.width*P.x,height:l.height*P.y,x:l.x*P.x-E.scrollLeft*P.x+M.x+F.x,y:l.y*P.y-E.scrollTop*P.y+M.y+F.y}}function gX(e){return Array.from(e.getClientRects())}function xX(e){const s=cu(e),l=B2(e),d=e.ownerDocument.body,m=Xa(s.scrollWidth,s.clientWidth,d.scrollWidth,d.clientWidth),_=Xa(s.scrollHeight,s.clientHeight,d.scrollHeight,d.clientHeight);let w=-l.scrollLeft+PA(e);const o=-l.scrollTop;return oc(d).direction==="rtl"&&(w+=Xa(s.clientWidth,d.clientWidth)-m),{width:m,height:_,x:w,y:o}}function yX(e,s){const l=el(e),d=cu(e),m=l.visualViewport;let _=d.clientWidth,w=d.clientHeight,o=0,E=0;if(m){_=m.width,w=m.height;const P=CA();(!P||P&&s==="fixed")&&(o=m.offsetLeft,E=m.offsetTop)}return{width:_,height:w,x:o,y:E}}const _X=new Set(["absolute","fixed"]);function vX(e,s){const l=_f(e,!0,s==="fixed"),d=l.top+e.clientTop,m=l.left+e.clientLeft,_=ou(e)?Mg(e):eu(1),w=e.clientWidth*_.x,o=e.clientHeight*_.y,E=m*_.x,P=d*_.y;return{width:w,height:o,x:E,y:P}}function RD(e,s,l){let d;if(s==="viewport")d=yX(e,l);else if(s==="document")d=xX(cu(e));else if(ic(s))d=vX(s,l);else{const m=DF(e);d={x:s.x-m.x,y:s.y-m.y,width:s.width,height:s.height}}return Xw(d)}function zF(e,s){const l=Mh(e);return l===s||!ic(l)||ex(l)?!1:oc(l).position==="fixed"||zF(l,s)}function bX(e,s){const l=s.get(e);if(l)return l;let d=M0(e,[],!1).filter(o=>ic(o)&&yx(o)!=="body"),m=null;const _=oc(e).position==="fixed";let w=_?Mh(e):e;for(;ic(w)&&!ex(w);){const o=oc(w),E=EA(w);!E&&o.position==="fixed"&&(m=null),(_?!E&&!m:!E&&o.position==="static"&&!!m&&_X.has(m.position)||Y0(w)&&!E&&zF(e,w))?d=d.filter(M=>M!==w):m=o,w=Mh(w)}return s.set(e,d),d}function wX(e){let{element:s,boundary:l,rootBoundary:d,strategy:m}=e;const w=[...l==="clippingAncestors"?F2(s)?[]:bX(s,this._c):[].concat(l),d],o=w[0],E=w.reduce((P,M)=>{const L=RD(s,M,m);return P.top=Xa(L.top,P.top),P.right=Ih(L.right,P.right),P.bottom=Ih(L.bottom,P.bottom),P.left=Xa(L.left,P.left),P},RD(s,o,m));return{width:E.right-E.left,height:E.bottom-E.top,x:E.left,y:E.top}}function SX(e){const{width:s,height:l}=kF(e);return{width:s,height:l}}function jX(e,s,l){const d=ou(s),m=cu(s),_=l==="fixed",w=_f(e,!0,_,s);let o={scrollLeft:0,scrollTop:0};const E=eu(0);function P(){E.x=PA(m)}if(d||!d&&!_)if((yx(s)!=="body"||Y0(m))&&(o=B2(s)),d){const $=_f(s,!0,_,s);E.x=$.x+s.clientLeft,E.y=$.y+s.clientTop}else m&&P();_&&!d&&m&&P();const M=m&&!d&&!_?LF(m,o):eu(0),L=w.left+o.scrollLeft-E.x-M.x,F=w.top+o.scrollTop-E.y-M.y;return{x:L,y:F,width:w.width,height:w.height}}function ZT(e){return oc(e).position==="static"}function kD(e,s){if(!ou(e)||oc(e).position==="fixed")return null;if(s)return s(e);let l=e.offsetParent;return cu(e)===l&&(l=l.ownerDocument.body),l}function OF(e,s){const l=el(e);if(F2(e))return l;if(!ou(e)){let m=Mh(e);for(;m&&!ex(m);){if(ic(m)&&!ZT(m))return m;m=Mh(m)}return l}let d=kD(e,s);for(;d&&oX(d)&&ZT(d);)d=kD(d,s);return d&&ex(d)&&ZT(d)&&!EA(d)?l:d||dX(e)||l}const TX=async function(e){const s=this.getOffsetParent||OF,l=this.getDimensions,d=await l(e.floating);return{reference:jX(e.reference,await s(e.floating),e.strategy),floating:{x:0,y:0,width:d.width,height:d.height}}};function NX(e){return oc(e).direction==="rtl"}const EX={convertOffsetParentRelativeRectToViewportRelativeRect:mX,getDocumentElement:cu,getClippingRect:wX,getOffsetParent:OF,getElementRects:TX,getClientRects:gX,getDimensions:SX,getScale:Mg,isElement:ic,isRTL:NX};function FF(e,s){return e.x===s.x&&e.y===s.y&&e.width===s.width&&e.height===s.height}function CX(e,s){let l=null,d;const m=cu(e);function _(){var o;clearTimeout(d),(o=l)==null||o.disconnect(),l=null}function w(o,E){o===void 0&&(o=!1),E===void 0&&(E=1),_();const P=e.getBoundingClientRect(),{left:M,top:L,width:F,height:$}=P;if(o||s(),!F||!$)return;const Y=Ob(L),H=Ob(m.clientWidth-(M+F)),X=Ob(m.clientHeight-(L+$)),Z=Ob(M),q={rootMargin:-Y+"px "+-H+"px "+-X+"px "+-Z+"px",threshold:Xa(0,Ih(1,E))||1};let oe=!0;function ae(Ne){const Pe=Ne[0].intersectionRatio;if(Pe!==E){if(!oe)return w();Pe?w(!1,Pe):d=setTimeout(()=>{w(!1,1e-7)},1e3)}Pe===1&&!FF(P,e.getBoundingClientRect())&&w(),oe=!1}try{l=new IntersectionObserver(ae,{...q,root:m.ownerDocument})}catch{l=new IntersectionObserver(ae,q)}l.observe(e)}return w(!0),_}function AX(e,s,l,d){d===void 0&&(d={});const{ancestorScroll:m=!0,ancestorResize:_=!0,elementResize:w=typeof ResizeObserver=="function",layoutShift:o=typeof IntersectionObserver=="function",animationFrame:E=!1}=d,P=AA(e),M=m||_?[...P?M0(P):[],...M0(s)]:[];M.forEach(Z=>{m&&Z.addEventListener("scroll",l,{passive:!0}),_&&Z.addEventListener("resize",l)});const L=P&&o?CX(P,l):null;let F=-1,$=null;w&&($=new ResizeObserver(Z=>{let[W]=Z;W&&W.target===P&&$&&($.unobserve(s),cancelAnimationFrame(F),F=requestAnimationFrame(()=>{var q;(q=$)==null||q.observe(s)})),l()}),P&&!E&&$.observe(P),$.observe(s));let Y,H=E?_f(e):null;E&&X();function X(){const Z=_f(e);H&&!FF(H,Z)&&l(),H=Z,Y=requestAnimationFrame(X)}return l(),()=>{var Z;M.forEach(W=>{m&&W.removeEventListener("scroll",l),_&&W.removeEventListener("resize",l)}),L==null||L(),(Z=$)==null||Z.disconnect(),$=null,E&&cancelAnimationFrame(Y)}}const PX=eX,IX=tX,MX=YK,RX=nX,kX=JK,DD=XK,DX=sX,LX=(e,s,l)=>{const d=new Map,m={platform:EX,...l},_={...m.platform,_c:d};return KK(e,s,{...m,platform:_})};var zX=typeof document<"u",OX=function(){},cw=zX?z.useLayoutEffect:OX;function Yw(e,s){if(e===s)return!0;if(typeof e!=typeof s)return!1;if(typeof e=="function"&&e.toString()===s.toString())return!0;let l,d,m;if(e&&s&&typeof e=="object"){if(Array.isArray(e)){if(l=e.length,l!==s.length)return!1;for(d=l;d--!==0;)if(!Yw(e[d],s[d]))return!1;return!0}if(m=Object.keys(e),l=m.length,l!==Object.keys(s).length)return!1;for(d=l;d--!==0;)if(!{}.hasOwnProperty.call(s,m[d]))return!1;for(d=l;d--!==0;){const _=m[d];if(!(_==="_owner"&&e.$$typeof)&&!Yw(e[_],s[_]))return!1}return!0}return e!==e&&s!==s}function BF(e){return typeof window>"u"?1:(e.ownerDocument.defaultView||window).devicePixelRatio||1}function LD(e,s){const l=BF(e);return Math.round(s*l)/l}function KT(e){const s=z.useRef(e);return cw(()=>{s.current=e}),s}function FX(e){e===void 0&&(e={});const{placement:s="bottom",strategy:l="absolute",middleware:d=[],platform:m,elements:{reference:_,floating:w}={},transform:o=!0,whileElementsMounted:E,open:P}=e,[M,L]=z.useState({x:0,y:0,strategy:l,placement:s,middlewareData:{},isPositioned:!1}),[F,$]=z.useState(d);Yw(F,d)||$(d);const[Y,H]=z.useState(null),[X,Z]=z.useState(null),W=z.useCallback(ze=>{ze!==Ne.current&&(Ne.current=ze,H(ze))},[]),q=z.useCallback(ze=>{ze!==Pe.current&&(Pe.current=ze,Z(ze))},[]),oe=_||Y,ae=w||X,Ne=z.useRef(null),Pe=z.useRef(null),Le=z.useRef(M),ct=E!=null,xt=KT(E),yt=KT(m),Ht=KT(P),Dt=z.useCallback(()=>{if(!Ne.current||!Pe.current)return;const ze={placement:s,strategy:l,middleware:F};yt.current&&(ze.platform=yt.current),LX(Ne.current,Pe.current,ze).then(Xe=>{const Ot={...Xe,isPositioned:Ht.current!==!1};wt.current&&!Yw(Le.current,Ot)&&(Le.current=Ot,Ef.flushSync(()=>{L(Ot)}))})},[F,s,l,yt,Ht]);cw(()=>{P===!1&&Le.current.isPositioned&&(Le.current.isPositioned=!1,L(ze=>({...ze,isPositioned:!1})))},[P]);const wt=z.useRef(!1);cw(()=>(wt.current=!0,()=>{wt.current=!1}),[]),cw(()=>{if(oe&&(Ne.current=oe),ae&&(Pe.current=ae),oe&&ae){if(xt.current)return xt.current(oe,ae,Dt);Dt()}},[oe,ae,Dt,xt,ct]);const rs=z.useMemo(()=>({reference:Ne,floating:Pe,setReference:W,setFloating:q}),[W,q]),Vt=z.useMemo(()=>({reference:oe,floating:ae}),[oe,ae]),Bt=z.useMemo(()=>{const ze={position:l,left:0,top:0};if(!Vt.floating)return ze;const Xe=LD(Vt.floating,M.x),Ot=LD(Vt.floating,M.y);return o?{...ze,transform:"translate("+Xe+"px, "+Ot+"px)",...BF(Vt.floating)>=1.5&&{willChange:"transform"}}:{position:l,left:Xe,top:Ot}},[l,o,Vt.floating,M.x,M.y]);return z.useMemo(()=>({...M,update:Dt,refs:rs,elements:Vt,floatingStyles:Bt}),[M,Dt,rs,Vt,Bt])}const BX=e=>{function s(l){return{}.hasOwnProperty.call(l,"current")}return{name:"arrow",options:e,fn(l){const{element:d,padding:m}=typeof e=="function"?e(l):e;return d&&s(d)?d.current!=null?DD({element:d.current,padding:m}).fn(l):{}:d?DD({element:d,padding:m}).fn(l):{}}}},VX=(e,s)=>({...PX(e),options:[e,s]}),UX=(e,s)=>({...IX(e),options:[e,s]}),$X=(e,s)=>({...DX(e),options:[e,s]}),GX=(e,s)=>({...MX(e),options:[e,s]}),HX=(e,s)=>({...RX(e),options:[e,s]}),WX=(e,s)=>({...kX(e),options:[e,s]}),qX=(e,s)=>({...BX(e),options:[e,s]});var ZX="Arrow",VF=z.forwardRef((e,s)=>{const{children:l,width:d=10,height:m=5,..._}=e;return n.jsx(Ys.svg,{..._,ref:s,width:d,height:m,viewBox:"0 0 30 10",preserveAspectRatio:"none",children:e.asChild?l:n.jsx("polygon",{points:"0,0 30,0 15,10"})})});VF.displayName=ZX;var KX=VF;function IA(e){const[s,l]=z.useState(void 0);return Fi(()=>{if(e){l({width:e.offsetWidth,height:e.offsetHeight});const d=new ResizeObserver(m=>{if(!Array.isArray(m)||!m.length)return;const _=m[0];let w,o;if("borderBoxSize"in _){const E=_.borderBoxSize,P=Array.isArray(E)?E[0]:E;w=P.inlineSize,o=P.blockSize}else w=e.offsetWidth,o=e.offsetHeight;l({width:w,height:o})});return d.observe(e,{box:"border-box"}),()=>d.unobserve(e)}else l(void 0)},[e]),s}var MA="Popper",[UF,_x]=Xo(MA),[XX,$F]=UF(MA),GF=e=>{const{__scopePopper:s,children:l}=e,[d,m]=z.useState(null);return n.jsx(XX,{scope:s,anchor:d,onAnchorChange:m,children:l})};GF.displayName=MA;var HF="PopperAnchor",WF=z.forwardRef((e,s)=>{const{__scopePopper:l,virtualRef:d,...m}=e,_=$F(HF,l),w=z.useRef(null),o=Gn(s,w);return z.useEffect(()=>{_.onAnchorChange((d==null?void 0:d.current)||w.current)}),d?null:n.jsx(Ys.div,{...m,ref:o})});WF.displayName=HF;var RA="PopperContent",[YX,JX]=UF(RA),qF=z.forwardRef((e,s)=>{var Xt,It,Ns,ws,tn,cn;const{__scopePopper:l,side:d="bottom",sideOffset:m=0,align:_="center",alignOffset:w=0,arrowPadding:o=0,avoidCollisions:E=!0,collisionBoundary:P=[],collisionPadding:M=0,sticky:L="partial",hideWhenDetached:F=!1,updatePositionStrategy:$="optimized",onPlaced:Y,...H}=e,X=$F(RA,l),[Z,W]=z.useState(null),q=Gn(s,wr=>W(wr)),[oe,ae]=z.useState(null),Ne=IA(oe),Pe=(Ne==null?void 0:Ne.width)??0,Le=(Ne==null?void 0:Ne.height)??0,ct=d+(_!=="center"?"-"+_:""),xt=typeof M=="number"?M:{top:0,right:0,bottom:0,left:0,...M},yt=Array.isArray(P)?P:[P],Ht=yt.length>0,Dt={padding:xt,boundary:yt.filter(eY),altBoundary:Ht},{refs:wt,floatingStyles:rs,placement:Vt,isPositioned:Bt,middlewareData:ze}=FX({strategy:"fixed",placement:ct,whileElementsMounted:(...wr)=>AX(...wr,{animationFrame:$==="always"}),elements:{reference:X.anchor},middleware:[VX({mainAxis:m+Le,alignmentAxis:w}),E&&UX({mainAxis:!0,crossAxis:!1,limiter:L==="partial"?$X():void 0,...Dt}),E&&GX({...Dt}),HX({...Dt,apply:({elements:wr,rects:cr,availableWidth:vn,availableHeight:Js})=>{const{width:Rr,height:Jo}=cr.reference,ao=wr.floating.style;ao.setProperty("--radix-popper-available-width",`${vn}px`),ao.setProperty("--radix-popper-available-height",`${Js}px`),ao.setProperty("--radix-popper-anchor-width",`${Rr}px`),ao.setProperty("--radix-popper-anchor-height",`${Jo}px`)}}),oe&&qX({element:oe,padding:o}),tY({arrowWidth:Pe,arrowHeight:Le}),F&&WX({strategy:"referenceHidden",...Dt})]}),[Xe,Ot]=XF(Vt),nt=Ci(Y);Fi(()=>{Bt&&(nt==null||nt())},[Bt,nt]);const Mt=(Xt=ze.arrow)==null?void 0:Xt.x,ss=(It=ze.arrow)==null?void 0:It.y,Ps=((Ns=ze.arrow)==null?void 0:Ns.centerOffset)!==0,[xn,Ms]=z.useState();return Fi(()=>{Z&&Ms(window.getComputedStyle(Z).zIndex)},[Z]),n.jsx("div",{ref:wt.setFloating,"data-radix-popper-content-wrapper":"",style:{...rs,transform:Bt?rs.transform:"translate(0, -200%)",minWidth:"max-content",zIndex:xn,"--radix-popper-transform-origin":[(ws=ze.transformOrigin)==null?void 0:ws.x,(tn=ze.transformOrigin)==null?void 0:tn.y].join(" "),...((cn=ze.hide)==null?void 0:cn.referenceHidden)&&{visibility:"hidden",pointerEvents:"none"}},dir:e.dir,children:n.jsx(YX,{scope:l,placedSide:Xe,onArrowChange:ae,arrowX:Mt,arrowY:ss,shouldHideArrow:Ps,children:n.jsx(Ys.div,{"data-side":Xe,"data-align":Ot,...H,ref:q,style:{...H.style,animation:Bt?void 0:"none"}})})})});qF.displayName=RA;var ZF="PopperArrow",QX={top:"bottom",right:"left",bottom:"top",left:"right"},KF=z.forwardRef(function(s,l){const{__scopePopper:d,...m}=s,_=JX(ZF,d),w=QX[_.placedSide];return n.jsx("span",{ref:_.onArrowChange,style:{position:"absolute",left:_.arrowX,top:_.arrowY,[w]:0,transformOrigin:{top:"",right:"0 0",bottom:"center 0",left:"100% 0"}[_.placedSide],transform:{top:"translateY(100%)",right:"translateY(50%) rotate(90deg) translateX(-50%)",bottom:"rotate(180deg)",left:"translateY(50%) rotate(-90deg) translateX(50%)"}[_.placedSide],visibility:_.shouldHideArrow?"hidden":void 0},children:n.jsx(KX,{...m,ref:l,style:{...m.style,display:"block"}})})});KF.displayName=ZF;function eY(e){return e!==null}var tY=e=>({name:"transformOrigin",options:e,fn(s){var X,Z,W;const{placement:l,rects:d,middlewareData:m}=s,w=((X=m.arrow)==null?void 0:X.centerOffset)!==0,o=w?0:e.arrowWidth,E=w?0:e.arrowHeight,[P,M]=XF(l),L={start:"0%",center:"50%",end:"100%"}[M],F=(((Z=m.arrow)==null?void 0:Z.x)??0)+o/2,$=(((W=m.arrow)==null?void 0:W.y)??0)+E/2;let Y="",H="";return P==="bottom"?(Y=w?L:`${F}px`,H=`${-E}px`):P==="top"?(Y=w?L:`${F}px`,H=`${d.floating.height+E}px`):P==="right"?(Y=`${-E}px`,H=w?L:`${$}px`):P==="left"&&(Y=`${d.floating.width+E}px`,H=w?L:`${$}px`),{data:{x:Y,y:H}}}});function XF(e){const[s,l="center"]=e.split("-");return[s,l]}var YF=GF,kA=WF,DA=qF,LA=KF,sY="Portal",J0=z.forwardRef((e,s)=>{var o;const{container:l,...d}=e,[m,_]=z.useState(!1);Fi(()=>_(!0),[]);const w=l||m&&((o=globalThis==null?void 0:globalThis.document)==null?void 0:o.body);return w?aF.createPortal(n.jsx(Ys.div,{...d,ref:s}),w):null});J0.displayName=sY;function nY(e,s){return z.useReducer((l,d)=>s[l][d]??l,e)}var Yo=e=>{const{present:s,children:l}=e,d=rY(s),m=typeof l=="function"?l({present:d.isPresent}):z.Children.only(l),_=Gn(d.ref,iY(m));return typeof l=="function"||d.isPresent?z.cloneElement(m,{ref:_}):null};Yo.displayName="Presence";function rY(e){const[s,l]=z.useState(),d=z.useRef(null),m=z.useRef(e),_=z.useRef("none"),w=e?"mounted":"unmounted",[o,E]=nY(w,{mounted:{UNMOUNT:"unmounted",ANIMATION_OUT:"unmountSuspended"},unmountSuspended:{MOUNT:"mounted",ANIMATION_END:"unmounted"},unmounted:{MOUNT:"mounted"}});return z.useEffect(()=>{const P=Fb(d.current);_.current=o==="mounted"?P:"none"},[o]),Fi(()=>{const P=d.current,M=m.current;if(M!==e){const F=_.current,$=Fb(P);e?E("MOUNT"):$==="none"||(P==null?void 0:P.display)==="none"?E("UNMOUNT"):E(M&&F!==$?"ANIMATION_OUT":"UNMOUNT"),m.current=e}},[e,E]),Fi(()=>{if(s){let P;const M=s.ownerDocument.defaultView??window,L=$=>{const H=Fb(d.current).includes($.animationName);if($.target===s&&H&&(E("ANIMATION_END"),!m.current)){const X=s.style.animationFillMode;s.style.animationFillMode="forwards",P=M.setTimeout(()=>{s.style.animationFillMode==="forwards"&&(s.style.animationFillMode=X)})}},F=$=>{$.target===s&&(_.current=Fb(d.current))};return s.addEventListener("animationstart",F),s.addEventListener("animationcancel",L),s.addEventListener("animationend",L),()=>{M.clearTimeout(P),s.removeEventListener("animationstart",F),s.removeEventListener("animationcancel",L),s.removeEventListener("animationend",L)}}else E("ANIMATION_END")},[s,E]),{isPresent:["mounted","unmountSuspended"].includes(o),ref:z.useCallback(P=>{d.current=P?getComputedStyle(P):null,l(P)},[])}}function Fb(e){return(e==null?void 0:e.animationName)||"none"}function iY(e){var d,m;let s=(d=Object.getOwnPropertyDescriptor(e.props,"ref"))==null?void 0:d.get,l=s&&"isReactWarning"in s&&s.isReactWarning;return l?e.ref:(s=(m=Object.getOwnPropertyDescriptor(e,"ref"))==null?void 0:m.get,l=s&&"isReactWarning"in s&&s.isReactWarning,l?e.props.ref:e.props.ref||e.ref)}var oY=NC[" useInsertionEffect ".trim().toString()]||Fi;function Qu({prop:e,defaultProp:s,onChange:l=()=>{},caller:d}){const[m,_,w]=aY({defaultProp:s,onChange:l}),o=e!==void 0,E=o?e:m;{const M=z.useRef(e!==void 0);z.useEffect(()=>{const L=M.current;L!==o&&console.warn(`${d} is changing from ${L?"controlled":"uncontrolled"} to ${o?"controlled":"uncontrolled"}. Components should not switch from controlled to uncontrolled (or vice versa). Decide between using a controlled or uncontrolled value for the lifetime of the component.`),M.current=o},[o,d])}const P=z.useCallback(M=>{var L;if(o){const F=lY(M)?M(e):M;F!==e&&((L=w.current)==null||L.call(w,F))}else _(M)},[o,e,_,w]);return[E,P]}function aY({defaultProp:e,onChange:s}){const[l,d]=z.useState(e),m=z.useRef(l),_=z.useRef(s);return oY(()=>{_.current=s},[s]),z.useEffect(()=>{var w;m.current!==l&&((w=_.current)==null||w.call(_,l),m.current=l)},[l,m]),[l,d,_]}function lY(e){return typeof e=="function"}var JF=Object.freeze({position:"absolute",border:0,width:1,height:1,padding:0,margin:-1,overflow:"hidden",clip:"rect(0, 0, 0, 0)",whiteSpace:"nowrap",wordWrap:"normal"}),cY="VisuallyHidden",V2=z.forwardRef((e,s)=>n.jsx(Ys.span,{...e,ref:s,style:{...JF,...e.style}}));V2.displayName=cY;var uY=V2,[U2,Lde]=Xo("Tooltip",[_x]),zA=_x(),QF="TooltipProvider",dY=700,zD="tooltip.open",[hY,e5]=U2(QF),t5=e=>{const{__scopeTooltip:s,delayDuration:l=dY,skipDelayDuration:d=300,disableHoverableContent:m=!1,children:_}=e,w=z.useRef(!0),o=z.useRef(!1),E=z.useRef(0);return z.useEffect(()=>{const P=E.current;return()=>window.clearTimeout(P)},[]),n.jsx(hY,{scope:s,isOpenDelayedRef:w,delayDuration:l,onOpen:z.useCallback(()=>{window.clearTimeout(E.current),w.current=!1},[]),onClose:z.useCallback(()=>{window.clearTimeout(E.current),E.current=window.setTimeout(()=>w.current=!0,d)},[d]),isPointerInTransitRef:o,onPointerInTransitChange:z.useCallback(P=>{o.current=P},[]),disableHoverableContent:m,children:_})};t5.displayName=QF;var s5="Tooltip",[zde,$2]=U2(s5),IE="TooltipTrigger",pY=z.forwardRef((e,s)=>{const{__scopeTooltip:l,...d}=e,m=$2(IE,l),_=e5(IE,l),w=zA(l),o=z.useRef(null),E=Gn(s,o,m.onTriggerChange),P=z.useRef(!1),M=z.useRef(!1),L=z.useCallback(()=>P.current=!1,[]);return z.useEffect(()=>()=>document.removeEventListener("pointerup",L),[L]),n.jsx(kA,{asChild:!0,...w,children:n.jsx(Ys.button,{"aria-describedby":m.open?m.contentId:void 0,"data-state":m.stateAttribute,...d,ref:E,onPointerMove:bs(e.onPointerMove,F=>{F.pointerType!=="touch"&&!M.current&&!_.isPointerInTransitRef.current&&(m.onTriggerEnter(),M.current=!0)}),onPointerLeave:bs(e.onPointerLeave,()=>{m.onTriggerLeave(),M.current=!1}),onPointerDown:bs(e.onPointerDown,()=>{m.open&&m.onClose(),P.current=!0,document.addEventListener("pointerup",L,{once:!0})}),onFocus:bs(e.onFocus,()=>{P.current||m.onOpen()}),onBlur:bs(e.onBlur,m.onClose),onClick:bs(e.onClick,m.onClose)})})});pY.displayName=IE;var fY="TooltipPortal",[Ode,mY]=U2(fY,{forceMount:void 0}),tx="TooltipContent",n5=z.forwardRef((e,s)=>{const l=mY(tx,e.__scopeTooltip),{forceMount:d=l.forceMount,side:m="top",..._}=e,w=$2(tx,e.__scopeTooltip);return n.jsx(Yo,{present:d||w.open,children:w.disableHoverableContent?n.jsx(r5,{side:m,..._,ref:s}):n.jsx(gY,{side:m,..._,ref:s})})}),gY=z.forwardRef((e,s)=>{const l=$2(tx,e.__scopeTooltip),d=e5(tx,e.__scopeTooltip),m=z.useRef(null),_=Gn(s,m),[w,o]=z.useState(null),{trigger:E,onClose:P}=l,M=m.current,{onPointerInTransitChange:L}=d,F=z.useCallback(()=>{o(null),L(!1)},[L]),$=z.useCallback((Y,H)=>{const X=Y.currentTarget,Z={x:Y.clientX,y:Y.clientY},W=bY(Z,X.getBoundingClientRect()),q=wY(Z,W),oe=SY(H.getBoundingClientRect()),ae=TY([...q,...oe]);o(ae),L(!0)},[L]);return z.useEffect(()=>()=>F(),[F]),z.useEffect(()=>{if(E&&M){const Y=X=>$(X,M),H=X=>$(X,E);return E.addEventListener("pointerleave",Y),M.addEventListener("pointerleave",H),()=>{E.removeEventListener("pointerleave",Y),M.removeEventListener("pointerleave",H)}}},[E,M,$,F]),z.useEffect(()=>{if(w){const Y=H=>{const X=H.target,Z={x:H.clientX,y:H.clientY},W=(E==null?void 0:E.contains(X))||(M==null?void 0:M.contains(X)),q=!jY(Z,w);W?F():q&&(F(),P())};return document.addEventListener("pointermove",Y),()=>document.removeEventListener("pointermove",Y)}},[E,M,w,P,F]),n.jsx(r5,{...e,ref:_})}),[xY,yY]=U2(s5,{isInside:!1}),_Y=NF("TooltipContent"),r5=z.forwardRef((e,s)=>{const{__scopeTooltip:l,children:d,"aria-label":m,onEscapeKeyDown:_,onPointerDownOutside:w,...o}=e,E=$2(tx,l),P=zA(l),{onClose:M}=E;return z.useEffect(()=>(document.addEventListener(zD,M),()=>document.removeEventListener(zD,M)),[M]),z.useEffect(()=>{if(E.trigger){const L=F=>{const $=F.target;$!=null&&$.contains(E.trigger)&&M()};return window.addEventListener("scroll",L,{capture:!0}),()=>window.removeEventListener("scroll",L,{capture:!0})}},[E.trigger,M]),n.jsx(gx,{asChild:!0,disableOutsidePointerEvents:!1,onEscapeKeyDown:_,onPointerDownOutside:w,onFocusOutside:L=>L.preventDefault(),onDismiss:M,children:n.jsxs(DA,{"data-state":E.stateAttribute,...P,...o,ref:s,style:{...o.style,"--radix-tooltip-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-tooltip-content-available-width":"var(--radix-popper-available-width)","--radix-tooltip-content-available-height":"var(--radix-popper-available-height)","--radix-tooltip-trigger-width":"var(--radix-popper-anchor-width)","--radix-tooltip-trigger-height":"var(--radix-popper-anchor-height)"},children:[n.jsx(_Y,{children:d}),n.jsx(xY,{scope:l,isInside:!0,children:n.jsx(uY,{id:E.contentId,role:"tooltip",children:m||d})})]})})});n5.displayName=tx;var i5="TooltipArrow",vY=z.forwardRef((e,s)=>{const{__scopeTooltip:l,...d}=e,m=zA(l);return yY(i5,l).isInside?null:n.jsx(LA,{...m,...d,ref:s})});vY.displayName=i5;function bY(e,s){const l=Math.abs(s.top-e.y),d=Math.abs(s.bottom-e.y),m=Math.abs(s.right-e.x),_=Math.abs(s.left-e.x);switch(Math.min(l,d,m,_)){case _:return"left";case m:return"right";case l:return"top";case d:return"bottom";default:throw new Error("unreachable")}}function wY(e,s,l=5){const d=[];switch(s){case"top":d.push({x:e.x-l,y:e.y+l},{x:e.x+l,y:e.y+l});break;case"bottom":d.push({x:e.x-l,y:e.y-l},{x:e.x+l,y:e.y-l});break;case"left":d.push({x:e.x+l,y:e.y-l},{x:e.x+l,y:e.y+l});break;case"right":d.push({x:e.x-l,y:e.y-l},{x:e.x-l,y:e.y+l});break}return d}function SY(e){const{top:s,right:l,bottom:d,left:m}=e;return[{x:m,y:s},{x:l,y:s},{x:l,y:d},{x:m,y:d}]}function jY(e,s){const{x:l,y:d}=e;let m=!1;for(let _=0,w=s.length-1;_<s.length;w=_++){const o=s[_],E=s[w],P=o.x,M=o.y,L=E.x,F=E.y;M>d!=F>d&&l<(L-P)*(d-M)/(F-M)+P&&(m=!m)}return m}function TY(e){const s=e.slice();return s.sort((l,d)=>l.x<d.x?-1:l.x>d.x?1:l.y<d.y?-1:l.y>d.y?1:0),NY(s)}function NY(e){if(e.length<=1)return e.slice();const s=[];for(let d=0;d<e.length;d++){const m=e[d];for(;s.length>=2;){const _=s[s.length-1],w=s[s.length-2];if((_.x-w.x)*(m.y-w.y)>=(_.y-w.y)*(m.x-w.x))s.pop();else break}s.push(m)}s.pop();const l=[];for(let d=e.length-1;d>=0;d--){const m=e[d];for(;l.length>=2;){const _=l[l.length-1],w=l[l.length-2];if((_.x-w.x)*(m.y-w.y)>=(_.y-w.y)*(m.x-w.x))l.pop();else break}l.push(m)}return l.pop(),s.length===1&&l.length===1&&s[0].x===l[0].x&&s[0].y===l[0].y?s:s.concat(l)}var EY=t5,o5=n5;function a5(e){var s,l,d="";if(typeof e=="string"||typeof e=="number")d+=e;else if(typeof e=="object")if(Array.isArray(e)){var m=e.length;for(s=0;s<m;s++)e[s]&&(l=a5(e[s]))&&(d&&(d+=" "),d+=l)}else for(l in e)e[l]&&(d&&(d+=" "),d+=l);return d}function l5(){for(var e,s,l=0,d="",m=arguments.length;l<m;l++)(e=arguments[l])&&(s=a5(e))&&(d&&(d+=" "),d+=s);return d}const OA="-",CY=e=>{const s=PY(e),{conflictingClassGroups:l,conflictingClassGroupModifiers:d}=e;return{getClassGroupId:w=>{const o=w.split(OA);return o[0]===""&&o.length!==1&&o.shift(),c5(o,s)||AY(w)},getConflictingClassGroupIds:(w,o)=>{const E=l[w]||[];return o&&d[w]?[...E,...d[w]]:E}}},c5=(e,s)=>{var w;if(e.length===0)return s.classGroupId;const l=e[0],d=s.nextPart.get(l),m=d?c5(e.slice(1),d):void 0;if(m)return m;if(s.validators.length===0)return;const _=e.join(OA);return(w=s.validators.find(({validator:o})=>o(_)))==null?void 0:w.classGroupId},OD=/^\[(.+)\]$/,AY=e=>{if(OD.test(e)){const s=OD.exec(e)[1],l=s==null?void 0:s.substring(0,s.indexOf(":"));if(l)return"arbitrary.."+l}},PY=e=>{const{theme:s,prefix:l}=e,d={nextPart:new Map,validators:[]};return MY(Object.entries(e.classGroups),l).forEach(([_,w])=>{ME(w,d,_,s)}),d},ME=(e,s,l,d)=>{e.forEach(m=>{if(typeof m=="string"){const _=m===""?s:FD(s,m);_.classGroupId=l;return}if(typeof m=="function"){if(IY(m)){ME(m(d),s,l,d);return}s.validators.push({validator:m,classGroupId:l});return}Object.entries(m).forEach(([_,w])=>{ME(w,FD(s,_),l,d)})})},FD=(e,s)=>{let l=e;return s.split(OA).forEach(d=>{l.nextPart.has(d)||l.nextPart.set(d,{nextPart:new Map,validators:[]}),l=l.nextPart.get(d)}),l},IY=e=>e.isThemeGetter,MY=(e,s)=>s?e.map(([l,d])=>{const m=d.map(_=>typeof _=="string"?s+_:typeof _=="object"?Object.fromEntries(Object.entries(_).map(([w,o])=>[s+w,o])):_);return[l,m]}):e,RY=e=>{if(e<1)return{get:()=>{},set:()=>{}};let s=0,l=new Map,d=new Map;const m=(_,w)=>{l.set(_,w),s++,s>e&&(s=0,d=l,l=new Map)};return{get(_){let w=l.get(_);if(w!==void 0)return w;if((w=d.get(_))!==void 0)return m(_,w),w},set(_,w){l.has(_)?l.set(_,w):m(_,w)}}},u5="!",kY=e=>{const{separator:s,experimentalParseClassName:l}=e,d=s.length===1,m=s[0],_=s.length,w=o=>{const E=[];let P=0,M=0,L;for(let X=0;X<o.length;X++){let Z=o[X];if(P===0){if(Z===m&&(d||o.slice(X,X+_)===s)){E.push(o.slice(M,X)),M=X+_;continue}if(Z==="/"){L=X;continue}}Z==="["?P++:Z==="]"&&P--}const F=E.length===0?o:o.substring(M),$=F.startsWith(u5),Y=$?F.substring(1):F,H=L&&L>M?L-M:void 0;return{modifiers:E,hasImportantModifier:$,baseClassName:Y,maybePostfixModifierPosition:H}};return l?o=>l({className:o,parseClassName:w}):w},DY=e=>{if(e.length<=1)return e;const s=[];let l=[];return e.forEach(d=>{d[0]==="["?(s.push(...l.sort(),d),l=[]):l.push(d)}),s.push(...l.sort()),s},LY=e=>({cache:RY(e.cacheSize),parseClassName:kY(e),...CY(e)}),zY=/\s+/,OY=(e,s)=>{const{parseClassName:l,getClassGroupId:d,getConflictingClassGroupIds:m}=s,_=[],w=e.trim().split(zY);let o="";for(let E=w.length-1;E>=0;E-=1){const P=w[E],{modifiers:M,hasImportantModifier:L,baseClassName:F,maybePostfixModifierPosition:$}=l(P);let Y=!!$,H=d(Y?F.substring(0,$):F);if(!H){if(!Y){o=P+(o.length>0?" "+o:o);continue}if(H=d(F),!H){o=P+(o.length>0?" "+o:o);continue}Y=!1}const X=DY(M).join(":"),Z=L?X+u5:X,W=Z+H;if(_.includes(W))continue;_.push(W);const q=m(H,Y);for(let oe=0;oe<q.length;++oe){const ae=q[oe];_.push(Z+ae)}o=P+(o.length>0?" "+o:o)}return o};function FY(){let e=0,s,l,d="";for(;e<arguments.length;)(s=arguments[e++])&&(l=d5(s))&&(d&&(d+=" "),d+=l);return d}const d5=e=>{if(typeof e=="string")return e;let s,l="";for(let d=0;d<e.length;d++)e[d]&&(s=d5(e[d]))&&(l&&(l+=" "),l+=s);return l};function BY(e,...s){let l,d,m,_=w;function w(E){const P=s.reduce((M,L)=>L(M),e());return l=LY(P),d=l.cache.get,m=l.cache.set,_=o,o(E)}function o(E){const P=d(E);if(P)return P;const M=OY(E,l);return m(E,M),M}return function(){return _(FY.apply(null,arguments))}}const Qr=e=>{const s=l=>l[e]||[];return s.isThemeGetter=!0,s},h5=/^\[(?:([a-z-]+):)?(.+)\]$/i,VY=/^\d+\/\d+$/,UY=new Set(["px","full","screen"]),$Y=/^(\d+(\.\d+)?)?(xs|sm|md|lg|xl)$/,GY=/\d+(%|px|r?em|[sdl]?v([hwib]|min|max)|pt|pc|in|cm|mm|cap|ch|ex|r?lh|cq(w|h|i|b|min|max))|\b(calc|min|max|clamp)\(.+\)|^0$/,HY=/^(rgba?|hsla?|hwb|(ok)?(lab|lch))\(.+\)$/,WY=/^(inset_)?-?((\d+)?\.?(\d+)[a-z]+|0)_-?((\d+)?\.?(\d+)[a-z]+|0)/,qY=/^(url|image|image-set|cross-fade|element|(repeating-)?(linear|radial|conic)-gradient)\(.+\)$/,Du=e=>Rg(e)||UY.has(e)||VY.test(e),eh=e=>vx(e,"length",tJ),Rg=e=>!!e&&!Number.isNaN(Number(e)),XT=e=>vx(e,"number",Rg),O_=e=>!!e&&Number.isInteger(Number(e)),ZY=e=>e.endsWith("%")&&Rg(e.slice(0,-1)),Qn=e=>h5.test(e),th=e=>$Y.test(e),KY=new Set(["length","size","percentage"]),XY=e=>vx(e,KY,p5),YY=e=>vx(e,"position",p5),JY=new Set(["image","url"]),QY=e=>vx(e,JY,nJ),eJ=e=>vx(e,"",sJ),F_=()=>!0,vx=(e,s,l)=>{const d=h5.exec(e);return d?d[1]?typeof s=="string"?d[1]===s:s.has(d[1]):l(d[2]):!1},tJ=e=>GY.test(e)&&!HY.test(e),p5=()=>!1,sJ=e=>WY.test(e),nJ=e=>qY.test(e),rJ=()=>{const e=Qr("colors"),s=Qr("spacing"),l=Qr("blur"),d=Qr("brightness"),m=Qr("borderColor"),_=Qr("borderRadius"),w=Qr("borderSpacing"),o=Qr("borderWidth"),E=Qr("contrast"),P=Qr("grayscale"),M=Qr("hueRotate"),L=Qr("invert"),F=Qr("gap"),$=Qr("gradientColorStops"),Y=Qr("gradientColorStopPositions"),H=Qr("inset"),X=Qr("margin"),Z=Qr("opacity"),W=Qr("padding"),q=Qr("saturate"),oe=Qr("scale"),ae=Qr("sepia"),Ne=Qr("skew"),Pe=Qr("space"),Le=Qr("translate"),ct=()=>["auto","contain","none"],xt=()=>["auto","hidden","clip","visible","scroll"],yt=()=>["auto",Qn,s],Ht=()=>[Qn,s],Dt=()=>["",Du,eh],wt=()=>["auto",Rg,Qn],rs=()=>["bottom","center","left","left-bottom","left-top","right","right-bottom","right-top","top"],Vt=()=>["solid","dashed","dotted","double","none"],Bt=()=>["normal","multiply","screen","overlay","darken","lighten","color-dodge","color-burn","hard-light","soft-light","difference","exclusion","hue","saturation","color","luminosity"],ze=()=>["start","end","center","between","around","evenly","stretch"],Xe=()=>["","0",Qn],Ot=()=>["auto","avoid","all","avoid-page","page","left","right","column"],nt=()=>[Rg,Qn];return{cacheSize:500,separator:":",theme:{colors:[F_],spacing:[Du,eh],blur:["none","",th,Qn],brightness:nt(),borderColor:[e],borderRadius:["none","","full",th,Qn],borderSpacing:Ht(),borderWidth:Dt(),contrast:nt(),grayscale:Xe(),hueRotate:nt(),invert:Xe(),gap:Ht(),gradientColorStops:[e],gradientColorStopPositions:[ZY,eh],inset:yt(),margin:yt(),opacity:nt(),padding:Ht(),saturate:nt(),scale:nt(),sepia:Xe(),skew:nt(),space:Ht(),translate:Ht()},classGroups:{aspect:[{aspect:["auto","square","video",Qn]}],container:["container"],columns:[{columns:[th]}],"break-after":[{"break-after":Ot()}],"break-before":[{"break-before":Ot()}],"break-inside":[{"break-inside":["auto","avoid","avoid-page","avoid-column"]}],"box-decoration":[{"box-decoration":["slice","clone"]}],box:[{box:["border","content"]}],display:["block","inline-block","inline","flex","inline-flex","table","inline-table","table-caption","table-cell","table-column","table-column-group","table-footer-group","table-header-group","table-row-group","table-row","flow-root","grid","inline-grid","contents","list-item","hidden"],float:[{float:["right","left","none","start","end"]}],clear:[{clear:["left","right","both","none","start","end"]}],isolation:["isolate","isolation-auto"],"object-fit":[{object:["contain","cover","fill","none","scale-down"]}],"object-position":[{object:[...rs(),Qn]}],overflow:[{overflow:xt()}],"overflow-x":[{"overflow-x":xt()}],"overflow-y":[{"overflow-y":xt()}],overscroll:[{overscroll:ct()}],"overscroll-x":[{"overscroll-x":ct()}],"overscroll-y":[{"overscroll-y":ct()}],position:["static","fixed","absolute","relative","sticky"],inset:[{inset:[H]}],"inset-x":[{"inset-x":[H]}],"inset-y":[{"inset-y":[H]}],start:[{start:[H]}],end:[{end:[H]}],top:[{top:[H]}],right:[{right:[H]}],bottom:[{bottom:[H]}],left:[{left:[H]}],visibility:["visible","invisible","collapse"],z:[{z:["auto",O_,Qn]}],basis:[{basis:yt()}],"flex-direction":[{flex:["row","row-reverse","col","col-reverse"]}],"flex-wrap":[{flex:["wrap","wrap-reverse","nowrap"]}],flex:[{flex:["1","auto","initial","none",Qn]}],grow:[{grow:Xe()}],shrink:[{shrink:Xe()}],order:[{order:["first","last","none",O_,Qn]}],"grid-cols":[{"grid-cols":[F_]}],"col-start-end":[{col:["auto",{span:["full",O_,Qn]},Qn]}],"col-start":[{"col-start":wt()}],"col-end":[{"col-end":wt()}],"grid-rows":[{"grid-rows":[F_]}],"row-start-end":[{row:["auto",{span:[O_,Qn]},Qn]}],"row-start":[{"row-start":wt()}],"row-end":[{"row-end":wt()}],"grid-flow":[{"grid-flow":["row","col","dense","row-dense","col-dense"]}],"auto-cols":[{"auto-cols":["auto","min","max","fr",Qn]}],"auto-rows":[{"auto-rows":["auto","min","max","fr",Qn]}],gap:[{gap:[F]}],"gap-x":[{"gap-x":[F]}],"gap-y":[{"gap-y":[F]}],"justify-content":[{justify:["normal",...ze()]}],"justify-items":[{"justify-items":["start","end","center","stretch"]}],"justify-self":[{"justify-self":["auto","start","end","center","stretch"]}],"align-content":[{content:["normal",...ze(),"baseline"]}],"align-items":[{items:["start","end","center","baseline","stretch"]}],"align-self":[{self:["auto","start","end","center","stretch","baseline"]}],"place-content":[{"place-content":[...ze(),"baseline"]}],"place-items":[{"place-items":["start","end","center","baseline","stretch"]}],"place-self":[{"place-self":["auto","start","end","center","stretch"]}],p:[{p:[W]}],px:[{px:[W]}],py:[{py:[W]}],ps:[{ps:[W]}],pe:[{pe:[W]}],pt:[{pt:[W]}],pr:[{pr:[W]}],pb:[{pb:[W]}],pl:[{pl:[W]}],m:[{m:[X]}],mx:[{mx:[X]}],my:[{my:[X]}],ms:[{ms:[X]}],me:[{me:[X]}],mt:[{mt:[X]}],mr:[{mr:[X]}],mb:[{mb:[X]}],ml:[{ml:[X]}],"space-x":[{"space-x":[Pe]}],"space-x-reverse":["space-x-reverse"],"space-y":[{"space-y":[Pe]}],"space-y-reverse":["space-y-reverse"],w:[{w:["auto","min","max","fit","svw","lvw","dvw",Qn,s]}],"min-w":[{"min-w":[Qn,s,"min","max","fit"]}],"max-w":[{"max-w":[Qn,s,"none","full","min","max","fit","prose",{screen:[th]},th]}],h:[{h:[Qn,s,"auto","min","max","fit","svh","lvh","dvh"]}],"min-h":[{"min-h":[Qn,s,"min","max","fit","svh","lvh","dvh"]}],"max-h":[{"max-h":[Qn,s,"min","max","fit","svh","lvh","dvh"]}],size:[{size:[Qn,s,"auto","min","max","fit"]}],"font-size":[{text:["base",th,eh]}],"font-smoothing":["antialiased","subpixel-antialiased"],"font-style":["italic","not-italic"],"font-weight":[{font:["thin","extralight","light","normal","medium","semibold","bold","extrabold","black",XT]}],"font-family":[{font:[F_]}],"fvn-normal":["normal-nums"],"fvn-ordinal":["ordinal"],"fvn-slashed-zero":["slashed-zero"],"fvn-figure":["lining-nums","oldstyle-nums"],"fvn-spacing":["proportional-nums","tabular-nums"],"fvn-fraction":["diagonal-fractions","stacked-fractions"],tracking:[{tracking:["tighter","tight","normal","wide","wider","widest",Qn]}],"line-clamp":[{"line-clamp":["none",Rg,XT]}],leading:[{leading:["none","tight","snug","normal","relaxed","loose",Du,Qn]}],"list-image":[{"list-image":["none",Qn]}],"list-style-type":[{list:["none","disc","decimal",Qn]}],"list-style-position":[{list:["inside","outside"]}],"placeholder-color":[{placeholder:[e]}],"placeholder-opacity":[{"placeholder-opacity":[Z]}],"text-alignment":[{text:["left","center","right","justify","start","end"]}],"text-color":[{text:[e]}],"text-opacity":[{"text-opacity":[Z]}],"text-decoration":["underline","overline","line-through","no-underline"],"text-decoration-style":[{decoration:[...Vt(),"wavy"]}],"text-decoration-thickness":[{decoration:["auto","from-font",Du,eh]}],"underline-offset":[{"underline-offset":["auto",Du,Qn]}],"text-decoration-color":[{decoration:[e]}],"text-transform":["uppercase","lowercase","capitalize","normal-case"],"text-overflow":["truncate","text-ellipsis","text-clip"],"text-wrap":[{text:["wrap","nowrap","balance","pretty"]}],indent:[{indent:Ht()}],"vertical-align":[{align:["baseline","top","middle","bottom","text-top","text-bottom","sub","super",Qn]}],whitespace:[{whitespace:["normal","nowrap","pre","pre-line","pre-wrap","break-spaces"]}],break:[{break:["normal","words","all","keep"]}],hyphens:[{hyphens:["none","manual","auto"]}],content:[{content:["none",Qn]}],"bg-attachment":[{bg:["fixed","local","scroll"]}],"bg-clip":[{"bg-clip":["border","padding","content","text"]}],"bg-opacity":[{"bg-opacity":[Z]}],"bg-origin":[{"bg-origin":["border","padding","content"]}],"bg-position":[{bg:[...rs(),YY]}],"bg-repeat":[{bg:["no-repeat",{repeat:["","x","y","round","space"]}]}],"bg-size":[{bg:["auto","cover","contain",XY]}],"bg-image":[{bg:["none",{"gradient-to":["t","tr","r","br","b","bl","l","tl"]},QY]}],"bg-color":[{bg:[e]}],"gradient-from-pos":[{from:[Y]}],"gradient-via-pos":[{via:[Y]}],"gradient-to-pos":[{to:[Y]}],"gradient-from":[{from:[$]}],"gradient-via":[{via:[$]}],"gradient-to":[{to:[$]}],rounded:[{rounded:[_]}],"rounded-s":[{"rounded-s":[_]}],"rounded-e":[{"rounded-e":[_]}],"rounded-t":[{"rounded-t":[_]}],"rounded-r":[{"rounded-r":[_]}],"rounded-b":[{"rounded-b":[_]}],"rounded-l":[{"rounded-l":[_]}],"rounded-ss":[{"rounded-ss":[_]}],"rounded-se":[{"rounded-se":[_]}],"rounded-ee":[{"rounded-ee":[_]}],"rounded-es":[{"rounded-es":[_]}],"rounded-tl":[{"rounded-tl":[_]}],"rounded-tr":[{"rounded-tr":[_]}],"rounded-br":[{"rounded-br":[_]}],"rounded-bl":[{"rounded-bl":[_]}],"border-w":[{border:[o]}],"border-w-x":[{"border-x":[o]}],"border-w-y":[{"border-y":[o]}],"border-w-s":[{"border-s":[o]}],"border-w-e":[{"border-e":[o]}],"border-w-t":[{"border-t":[o]}],"border-w-r":[{"border-r":[o]}],"border-w-b":[{"border-b":[o]}],"border-w-l":[{"border-l":[o]}],"border-opacity":[{"border-opacity":[Z]}],"border-style":[{border:[...Vt(),"hidden"]}],"divide-x":[{"divide-x":[o]}],"divide-x-reverse":["divide-x-reverse"],"divide-y":[{"divide-y":[o]}],"divide-y-reverse":["divide-y-reverse"],"divide-opacity":[{"divide-opacity":[Z]}],"divide-style":[{divide:Vt()}],"border-color":[{border:[m]}],"border-color-x":[{"border-x":[m]}],"border-color-y":[{"border-y":[m]}],"border-color-s":[{"border-s":[m]}],"border-color-e":[{"border-e":[m]}],"border-color-t":[{"border-t":[m]}],"border-color-r":[{"border-r":[m]}],"border-color-b":[{"border-b":[m]}],"border-color-l":[{"border-l":[m]}],"divide-color":[{divide:[m]}],"outline-style":[{outline:["",...Vt()]}],"outline-offset":[{"outline-offset":[Du,Qn]}],"outline-w":[{outline:[Du,eh]}],"outline-color":[{outline:[e]}],"ring-w":[{ring:Dt()}],"ring-w-inset":["ring-inset"],"ring-color":[{ring:[e]}],"ring-opacity":[{"ring-opacity":[Z]}],"ring-offset-w":[{"ring-offset":[Du,eh]}],"ring-offset-color":[{"ring-offset":[e]}],shadow:[{shadow:["","inner","none",th,eJ]}],"shadow-color":[{shadow:[F_]}],opacity:[{opacity:[Z]}],"mix-blend":[{"mix-blend":[...Bt(),"plus-lighter","plus-darker"]}],"bg-blend":[{"bg-blend":Bt()}],filter:[{filter:["","none"]}],blur:[{blur:[l]}],brightness:[{brightness:[d]}],contrast:[{contrast:[E]}],"drop-shadow":[{"drop-shadow":["","none",th,Qn]}],grayscale:[{grayscale:[P]}],"hue-rotate":[{"hue-rotate":[M]}],invert:[{invert:[L]}],saturate:[{saturate:[q]}],sepia:[{sepia:[ae]}],"backdrop-filter":[{"backdrop-filter":["","none"]}],"backdrop-blur":[{"backdrop-blur":[l]}],"backdrop-brightness":[{"backdrop-brightness":[d]}],"backdrop-contrast":[{"backdrop-contrast":[E]}],"backdrop-grayscale":[{"backdrop-grayscale":[P]}],"backdrop-hue-rotate":[{"backdrop-hue-rotate":[M]}],"backdrop-invert":[{"backdrop-invert":[L]}],"backdrop-opacity":[{"backdrop-opacity":[Z]}],"backdrop-saturate":[{"backdrop-saturate":[q]}],"backdrop-sepia":[{"backdrop-sepia":[ae]}],"border-collapse":[{border:["collapse","separate"]}],"border-spacing":[{"border-spacing":[w]}],"border-spacing-x":[{"border-spacing-x":[w]}],"border-spacing-y":[{"border-spacing-y":[w]}],"table-layout":[{table:["auto","fixed"]}],caption:[{caption:["top","bottom"]}],transition:[{transition:["none","all","","colors","opacity","shadow","transform",Qn]}],duration:[{duration:nt()}],ease:[{ease:["linear","in","out","in-out",Qn]}],delay:[{delay:nt()}],animate:[{animate:["none","spin","ping","pulse","bounce",Qn]}],transform:[{transform:["","gpu","none"]}],scale:[{scale:[oe]}],"scale-x":[{"scale-x":[oe]}],"scale-y":[{"scale-y":[oe]}],rotate:[{rotate:[O_,Qn]}],"translate-x":[{"translate-x":[Le]}],"translate-y":[{"translate-y":[Le]}],"skew-x":[{"skew-x":[Ne]}],"skew-y":[{"skew-y":[Ne]}],"transform-origin":[{origin:["center","top","top-right","right","bottom-right","bottom","bottom-left","left","top-left",Qn]}],accent:[{accent:["auto",e]}],appearance:[{appearance:["none","auto"]}],cursor:[{cursor:["auto","default","pointer","wait","text","move","help","not-allowed","none","context-menu","progress","cell","crosshair","vertical-text","alias","copy","no-drop","grab","grabbing","all-scroll","col-resize","row-resize","n-resize","e-resize","s-resize","w-resize","ne-resize","nw-resize","se-resize","sw-resize","ew-resize","ns-resize","nesw-resize","nwse-resize","zoom-in","zoom-out",Qn]}],"caret-color":[{caret:[e]}],"pointer-events":[{"pointer-events":["none","auto"]}],resize:[{resize:["none","y","x",""]}],"scroll-behavior":[{scroll:["auto","smooth"]}],"scroll-m":[{"scroll-m":Ht()}],"scroll-mx":[{"scroll-mx":Ht()}],"scroll-my":[{"scroll-my":Ht()}],"scroll-ms":[{"scroll-ms":Ht()}],"scroll-me":[{"scroll-me":Ht()}],"scroll-mt":[{"scroll-mt":Ht()}],"scroll-mr":[{"scroll-mr":Ht()}],"scroll-mb":[{"scroll-mb":Ht()}],"scroll-ml":[{"scroll-ml":Ht()}],"scroll-p":[{"scroll-p":Ht()}],"scroll-px":[{"scroll-px":Ht()}],"scroll-py":[{"scroll-py":Ht()}],"scroll-ps":[{"scroll-ps":Ht()}],"scroll-pe":[{"scroll-pe":Ht()}],"scroll-pt":[{"scroll-pt":Ht()}],"scroll-pr":[{"scroll-pr":Ht()}],"scroll-pb":[{"scroll-pb":Ht()}],"scroll-pl":[{"scroll-pl":Ht()}],"snap-align":[{snap:["start","end","center","align-none"]}],"snap-stop":[{snap:["normal","always"]}],"snap-type":[{snap:["none","x","y","both"]}],"snap-strictness":[{snap:["mandatory","proximity"]}],touch:[{touch:["auto","none","manipulation"]}],"touch-x":[{"touch-pan":["x","left","right"]}],"touch-y":[{"touch-pan":["y","up","down"]}],"touch-pz":["touch-pinch-zoom"],select:[{select:["none","text","all","auto"]}],"will-change":[{"will-change":["auto","scroll","contents","transform",Qn]}],fill:[{fill:[e,"none"]}],"stroke-w":[{stroke:[Du,eh,XT]}],stroke:[{stroke:[e,"none"]}],sr:["sr-only","not-sr-only"],"forced-color-adjust":[{"forced-color-adjust":["auto","none"]}]},conflictingClassGroups:{overflow:["overflow-x","overflow-y"],overscroll:["overscroll-x","overscroll-y"],inset:["inset-x","inset-y","start","end","top","right","bottom","left"],"inset-x":["right","left"],"inset-y":["top","bottom"],flex:["basis","grow","shrink"],gap:["gap-x","gap-y"],p:["px","py","ps","pe","pt","pr","pb","pl"],px:["pr","pl"],py:["pt","pb"],m:["mx","my","ms","me","mt","mr","mb","ml"],mx:["mr","ml"],my:["mt","mb"],size:["w","h"],"font-size":["leading"],"fvn-normal":["fvn-ordinal","fvn-slashed-zero","fvn-figure","fvn-spacing","fvn-fraction"],"fvn-ordinal":["fvn-normal"],"fvn-slashed-zero":["fvn-normal"],"fvn-figure":["fvn-normal"],"fvn-spacing":["fvn-normal"],"fvn-fraction":["fvn-normal"],"line-clamp":["display","overflow"],rounded:["rounded-s","rounded-e","rounded-t","rounded-r","rounded-b","rounded-l","rounded-ss","rounded-se","rounded-ee","rounded-es","rounded-tl","rounded-tr","rounded-br","rounded-bl"],"rounded-s":["rounded-ss","rounded-es"],"rounded-e":["rounded-se","rounded-ee"],"rounded-t":["rounded-tl","rounded-tr"],"rounded-r":["rounded-tr","rounded-br"],"rounded-b":["rounded-br","rounded-bl"],"rounded-l":["rounded-tl","rounded-bl"],"border-spacing":["border-spacing-x","border-spacing-y"],"border-w":["border-w-s","border-w-e","border-w-t","border-w-r","border-w-b","border-w-l"],"border-w-x":["border-w-r","border-w-l"],"border-w-y":["border-w-t","border-w-b"],"border-color":["border-color-s","border-color-e","border-color-t","border-color-r","border-color-b","border-color-l"],"border-color-x":["border-color-r","border-color-l"],"border-color-y":["border-color-t","border-color-b"],"scroll-m":["scroll-mx","scroll-my","scroll-ms","scroll-me","scroll-mt","scroll-mr","scroll-mb","scroll-ml"],"scroll-mx":["scroll-mr","scroll-ml"],"scroll-my":["scroll-mt","scroll-mb"],"scroll-p":["scroll-px","scroll-py","scroll-ps","scroll-pe","scroll-pt","scroll-pr","scroll-pb","scroll-pl"],"scroll-px":["scroll-pr","scroll-pl"],"scroll-py":["scroll-pt","scroll-pb"],touch:["touch-x","touch-y","touch-pz"],"touch-x":["touch"],"touch-y":["touch"],"touch-pz":["touch"]},conflictingClassGroupModifiers:{"font-size":["leading"]}}},iJ=BY(rJ);function Ds(...e){return iJ(l5(e))}const oJ=EY,aJ=z.forwardRef(({className:e,sideOffset:s=4,...l},d)=>n.jsx(o5,{ref:d,sideOffset:s,className:Ds("z-50 overflow-hidden rounded-md border bg-popover px-3 py-1.5 text-sm text-popover-foreground shadow-md animate-in fade-in-0 zoom-in-95 data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=closed]:zoom-out-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...l}));aJ.displayName=o5.displayName;const lJ=1,cJ=1e6;let YT=0;function uJ(){return YT=(YT+1)%Number.MAX_SAFE_INTEGER,YT.toString()}const JT=new Map,BD=e=>{if(JT.has(e))return;const s=setTimeout(()=>{JT.delete(e),r0({type:"REMOVE_TOAST",toastId:e})},cJ);JT.set(e,s)},dJ=(e,s)=>{switch(s.type){case"ADD_TOAST":return{...e,toasts:[s.toast,...e.toasts].slice(0,lJ)};case"UPDATE_TOAST":return{...e,toasts:e.toasts.map(l=>l.id===s.toast.id?{...l,...s.toast}:l)};case"DISMISS_TOAST":{const{toastId:l}=s;return l?BD(l):e.toasts.forEach(d=>{BD(d.id)}),{...e,toasts:e.toasts.map(d=>d.id===l||l===void 0?{...d,open:!1}:d)}}case"REMOVE_TOAST":return s.toastId===void 0?{...e,toasts:[]}:{...e,toasts:e.toasts.filter(l=>l.id!==s.toastId)}}},uw=[];let dw={toasts:[]};function r0(e){dw=dJ(dw,e),uw.forEach(s=>{s(dw)})}function _g({...e}){const s=uJ(),l=m=>r0({type:"UPDATE_TOAST",toast:{...m,id:s}}),d=()=>r0({type:"DISMISS_TOAST",toastId:s});return r0({type:"ADD_TOAST",toast:{...e,id:s,open:!0,onOpenChange:m=>{m||d()}}}),{id:s,dismiss:d,update:l}}function Bi(){const[e,s]=z.useState(dw);return z.useEffect(()=>(uw.push(s),()=>{const l=uw.indexOf(s);l>-1&&uw.splice(l,1)}),[e]),{...e,toast:_g,dismiss:l=>r0({type:"DISMISS_TOAST",toastId:l})}}function G2(e){const s=e+"CollectionProvider",[l,d]=Xo(s),[m,_]=l(s,{collectionRef:{current:null},itemMap:new Map}),w=H=>{const{scope:X,children:Z}=H,W=vs.useRef(null),q=vs.useRef(new Map).current;return n.jsx(m,{scope:X,itemMap:q,collectionRef:W,children:Z})};w.displayName=s;const o=e+"CollectionSlot",E=yf(o),P=vs.forwardRef((H,X)=>{const{scope:Z,children:W}=H,q=_(o,Z),oe=Gn(X,q.collectionRef);return n.jsx(E,{ref:oe,children:W})});P.displayName=o;const M=e+"CollectionItemSlot",L="data-radix-collection-item",F=yf(M),$=vs.forwardRef((H,X)=>{const{scope:Z,children:W,...q}=H,oe=vs.useRef(null),ae=Gn(X,oe),Ne=_(M,Z);return vs.useEffect(()=>(Ne.itemMap.set(oe,{ref:oe,...q}),()=>void Ne.itemMap.delete(oe))),n.jsx(F,{[L]:"",ref:ae,children:W})});$.displayName=M;function Y(H){const X=_(e+"CollectionConsumer",H);return vs.useCallback(()=>{const W=X.collectionRef.current;if(!W)return[];const q=Array.from(W.querySelectorAll(`[${L}]`));return Array.from(X.itemMap.values()).sort((Ne,Pe)=>q.indexOf(Ne.ref.current)-q.indexOf(Pe.ref.current))},[X.collectionRef,X.itemMap])}return[{Provider:w,Slot:P,ItemSlot:$},Y,d]}var FA="ToastProvider",[BA,hJ,pJ]=G2("Toast"),[f5,Fde]=Xo("Toast",[pJ]),[fJ,H2]=f5(FA),m5=e=>{const{__scopeToast:s,label:l="Notification",duration:d=5e3,swipeDirection:m="right",swipeThreshold:_=50,children:w}=e,[o,E]=z.useState(null),[P,M]=z.useState(0),L=z.useRef(!1),F=z.useRef(!1);return l.trim()||console.error(`Invalid prop \`label\` supplied to \`${FA}\`. Expected non-empty \`string\`.`),n.jsx(BA.Provider,{scope:s,children:n.jsx(fJ,{scope:s,label:l,duration:d,swipeDirection:m,swipeThreshold:_,toastCount:P,viewport:o,onViewportChange:E,onToastAdd:z.useCallback(()=>M($=>$+1),[]),onToastRemove:z.useCallback(()=>M($=>$-1),[]),isFocusedToastEscapeKeyDownRef:L,isClosePausedRef:F,children:w})})};m5.displayName=FA;var g5="ToastViewport",mJ=["F8"],RE="toast.viewportPause",kE="toast.viewportResume",x5=z.forwardRef((e,s)=>{const{__scopeToast:l,hotkey:d=mJ,label:m="Notifications ({hotkey})",..._}=e,w=H2(g5,l),o=hJ(l),E=z.useRef(null),P=z.useRef(null),M=z.useRef(null),L=z.useRef(null),F=Gn(s,L,w.onViewportChange),$=d.join("+").replace(/Key/g,"").replace(/Digit/g,""),Y=w.toastCount>0;z.useEffect(()=>{const X=Z=>{var q;d.length!==0&&d.every(oe=>Z[oe]||Z.code===oe)&&((q=L.current)==null||q.focus())};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[d]),z.useEffect(()=>{const X=E.current,Z=L.current;if(Y&&X&&Z){const W=()=>{if(!w.isClosePausedRef.current){const Ne=new CustomEvent(RE);Z.dispatchEvent(Ne),w.isClosePausedRef.current=!0}},q=()=>{if(w.isClosePausedRef.current){const Ne=new CustomEvent(kE);Z.dispatchEvent(Ne),w.isClosePausedRef.current=!1}},oe=Ne=>{!X.contains(Ne.relatedTarget)&&q()},ae=()=>{X.contains(document.activeElement)||q()};return X.addEventListener("focusin",W),X.addEventListener("focusout",oe),X.addEventListener("pointermove",W),X.addEventListener("pointerleave",ae),window.addEventListener("blur",W),window.addEventListener("focus",q),()=>{X.removeEventListener("focusin",W),X.removeEventListener("focusout",oe),X.removeEventListener("pointermove",W),X.removeEventListener("pointerleave",ae),window.removeEventListener("blur",W),window.removeEventListener("focus",q)}}},[Y,w.isClosePausedRef]);const H=z.useCallback(({tabbingDirection:X})=>{const W=o().map(q=>{const oe=q.ref.current,ae=[oe,...CJ(oe)];return X==="forwards"?ae:ae.reverse()});return(X==="forwards"?W.reverse():W).flat()},[o]);return z.useEffect(()=>{const X=L.current;if(X){const Z=W=>{var ae,Ne,Pe;const q=W.altKey||W.ctrlKey||W.metaKey;if(W.key==="Tab"&&!q){const Le=document.activeElement,ct=W.shiftKey;if(W.target===X&&ct){(ae=P.current)==null||ae.focus();return}const Ht=H({tabbingDirection:ct?"backwards":"forwards"}),Dt=Ht.findIndex(wt=>wt===Le);QT(Ht.slice(Dt+1))?W.preventDefault():ct?(Ne=P.current)==null||Ne.focus():(Pe=M.current)==null||Pe.focus()}};return X.addEventListener("keydown",Z),()=>X.removeEventListener("keydown",Z)}},[o,H]),n.jsxs(DK,{ref:E,role:"region","aria-label":m.replace("{hotkey}",$),tabIndex:-1,style:{pointerEvents:Y?void 0:"none"},children:[Y&&n.jsx(DE,{ref:P,onFocusFromOutsideViewport:()=>{const X=H({tabbingDirection:"forwards"});QT(X)}}),n.jsx(BA.Slot,{scope:l,children:n.jsx(Ys.ol,{tabIndex:-1,..._,ref:F})}),Y&&n.jsx(DE,{ref:M,onFocusFromOutsideViewport:()=>{const X=H({tabbingDirection:"backwards"});QT(X)}})]})});x5.displayName=g5;var y5="ToastFocusProxy",DE=z.forwardRef((e,s)=>{const{__scopeToast:l,onFocusFromOutsideViewport:d,...m}=e,_=H2(y5,l);return n.jsx(V2,{"aria-hidden":!0,tabIndex:0,...m,ref:s,style:{position:"fixed"},onFocus:w=>{var P;const o=w.relatedTarget;!((P=_.viewport)!=null&&P.contains(o))&&d()}})});DE.displayName=y5;var Q0="Toast",gJ="toast.swipeStart",xJ="toast.swipeMove",yJ="toast.swipeCancel",_J="toast.swipeEnd",_5=z.forwardRef((e,s)=>{const{forceMount:l,open:d,defaultOpen:m,onOpenChange:_,...w}=e,[o,E]=Qu({prop:d,defaultProp:m??!0,onChange:_,caller:Q0});return n.jsx(Yo,{present:l||o,children:n.jsx(wJ,{open:o,...w,ref:s,onClose:()=>E(!1),onPause:Ci(e.onPause),onResume:Ci(e.onResume),onSwipeStart:bs(e.onSwipeStart,P=>{P.currentTarget.setAttribute("data-swipe","start")}),onSwipeMove:bs(e.onSwipeMove,P=>{const{x:M,y:L}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","move"),P.currentTarget.style.setProperty("--radix-toast-swipe-move-x",`${M}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-move-y",`${L}px`)}),onSwipeCancel:bs(e.onSwipeCancel,P=>{P.currentTarget.setAttribute("data-swipe","cancel"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-end-y")}),onSwipeEnd:bs(e.onSwipeEnd,P=>{const{x:M,y:L}=P.detail.delta;P.currentTarget.setAttribute("data-swipe","end"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-x"),P.currentTarget.style.removeProperty("--radix-toast-swipe-move-y"),P.currentTarget.style.setProperty("--radix-toast-swipe-end-x",`${M}px`),P.currentTarget.style.setProperty("--radix-toast-swipe-end-y",`${L}px`),E(!1)})})})});_5.displayName=Q0;var[vJ,bJ]=f5(Q0,{onClose(){}}),wJ=z.forwardRef((e,s)=>{const{__scopeToast:l,type:d="foreground",duration:m,open:_,onClose:w,onEscapeKeyDown:o,onPause:E,onResume:P,onSwipeStart:M,onSwipeMove:L,onSwipeCancel:F,onSwipeEnd:$,...Y}=e,H=H2(Q0,l),[X,Z]=z.useState(null),W=Gn(s,wt=>Z(wt)),q=z.useRef(null),oe=z.useRef(null),ae=m||H.duration,Ne=z.useRef(0),Pe=z.useRef(ae),Le=z.useRef(0),{onToastAdd:ct,onToastRemove:xt}=H,yt=Ci(()=>{var rs;(X==null?void 0:X.contains(document.activeElement))&&((rs=H.viewport)==null||rs.focus()),w()}),Ht=z.useCallback(wt=>{!wt||wt===1/0||(window.clearTimeout(Le.current),Ne.current=new Date().getTime(),Le.current=window.setTimeout(yt,wt))},[yt]);z.useEffect(()=>{const wt=H.viewport;if(wt){const rs=()=>{Ht(Pe.current),P==null||P()},Vt=()=>{const Bt=new Date().getTime()-Ne.current;Pe.current=Pe.current-Bt,window.clearTimeout(Le.current),E==null||E()};return wt.addEventListener(RE,Vt),wt.addEventListener(kE,rs),()=>{wt.removeEventListener(RE,Vt),wt.removeEventListener(kE,rs)}}},[H.viewport,ae,E,P,Ht]),z.useEffect(()=>{_&&!H.isClosePausedRef.current&&Ht(ae)},[_,ae,H.isClosePausedRef,Ht]),z.useEffect(()=>(ct(),()=>xt()),[ct,xt]);const Dt=z.useMemo(()=>X?N5(X):null,[X]);return H.viewport?n.jsxs(n.Fragment,{children:[Dt&&n.jsx(SJ,{__scopeToast:l,role:"status","aria-live":d==="foreground"?"assertive":"polite","aria-atomic":!0,children:Dt}),n.jsx(vJ,{scope:l,onClose:yt,children:Ef.createPortal(n.jsx(BA.ItemSlot,{scope:l,children:n.jsx(kK,{asChild:!0,onEscapeKeyDown:bs(o,()=>{H.isFocusedToastEscapeKeyDownRef.current||yt(),H.isFocusedToastEscapeKeyDownRef.current=!1}),children:n.jsx(Ys.li,{role:"status","aria-live":"off","aria-atomic":!0,tabIndex:0,"data-state":_?"open":"closed","data-swipe-direction":H.swipeDirection,...Y,ref:W,style:{userSelect:"none",touchAction:"none",...e.style},onKeyDown:bs(e.onKeyDown,wt=>{wt.key==="Escape"&&(o==null||o(wt.nativeEvent),wt.nativeEvent.defaultPrevented||(H.isFocusedToastEscapeKeyDownRef.current=!0,yt()))}),onPointerDown:bs(e.onPointerDown,wt=>{wt.button===0&&(q.current={x:wt.clientX,y:wt.clientY})}),onPointerMove:bs(e.onPointerMove,wt=>{if(!q.current)return;const rs=wt.clientX-q.current.x,Vt=wt.clientY-q.current.y,Bt=!!oe.current,ze=["left","right"].includes(H.swipeDirection),Xe=["left","up"].includes(H.swipeDirection)?Math.min:Math.max,Ot=ze?Xe(0,rs):0,nt=ze?0:Xe(0,Vt),Mt=wt.pointerType==="touch"?10:2,ss={x:Ot,y:nt},Ps={originalEvent:wt,delta:ss};Bt?(oe.current=ss,Bb(xJ,L,Ps,{discrete:!1})):VD(ss,H.swipeDirection,Mt)?(oe.current=ss,Bb(gJ,M,Ps,{discrete:!1}),wt.target.setPointerCapture(wt.pointerId)):(Math.abs(rs)>Mt||Math.abs(Vt)>Mt)&&(q.current=null)}),onPointerUp:bs(e.onPointerUp,wt=>{const rs=oe.current,Vt=wt.target;if(Vt.hasPointerCapture(wt.pointerId)&&Vt.releasePointerCapture(wt.pointerId),oe.current=null,q.current=null,rs){const Bt=wt.currentTarget,ze={originalEvent:wt,delta:rs};VD(rs,H.swipeDirection,H.swipeThreshold)?Bb(_J,$,ze,{discrete:!0}):Bb(yJ,F,ze,{discrete:!0}),Bt.addEventListener("click",Xe=>Xe.preventDefault(),{once:!0})}})})})}),H.viewport)})]}):null}),SJ=e=>{const{__scopeToast:s,children:l,...d}=e,m=H2(Q0,s),[_,w]=z.useState(!1),[o,E]=z.useState(!1);return NJ(()=>w(!0)),z.useEffect(()=>{const P=window.setTimeout(()=>E(!0),1e3);return()=>window.clearTimeout(P)},[]),o?null:n.jsx(J0,{asChild:!0,children:n.jsx(V2,{...d,children:_&&n.jsxs(n.Fragment,{children:[m.label," ",l]})})})},jJ="ToastTitle",v5=z.forwardRef((e,s)=>{const{__scopeToast:l,...d}=e;return n.jsx(Ys.div,{...d,ref:s})});v5.displayName=jJ;var TJ="ToastDescription",b5=z.forwardRef((e,s)=>{const{__scopeToast:l,...d}=e;return n.jsx(Ys.div,{...d,ref:s})});b5.displayName=TJ;var w5="ToastAction",S5=z.forwardRef((e,s)=>{const{altText:l,...d}=e;return l.trim()?n.jsx(T5,{altText:l,asChild:!0,children:n.jsx(VA,{...d,ref:s})}):(console.error(`Invalid prop \`altText\` supplied to \`${w5}\`. Expected non-empty \`string\`.`),null)});S5.displayName=w5;var j5="ToastClose",VA=z.forwardRef((e,s)=>{const{__scopeToast:l,...d}=e,m=bJ(j5,l);return n.jsx(T5,{asChild:!0,children:n.jsx(Ys.button,{type:"button",...d,ref:s,onClick:bs(e.onClick,m.onClose)})})});VA.displayName=j5;var T5=z.forwardRef((e,s)=>{const{__scopeToast:l,altText:d,...m}=e;return n.jsx(Ys.div,{"data-radix-toast-announce-exclude":"","data-radix-toast-announce-alt":d||void 0,...m,ref:s})});function N5(e){const s=[];return Array.from(e.childNodes).forEach(d=>{if(d.nodeType===d.TEXT_NODE&&d.textContent&&s.push(d.textContent),EJ(d)){const m=d.ariaHidden||d.hidden||d.style.display==="none",_=d.dataset.radixToastAnnounceExclude==="";if(!m)if(_){const w=d.dataset.radixToastAnnounceAlt;w&&s.push(w)}else s.push(...N5(d))}}),s}function Bb(e,s,l,{discrete:d}){const m=l.originalEvent.currentTarget,_=new CustomEvent(e,{bubbles:!0,cancelable:!0,detail:l});s&&m.addEventListener(e,s,{once:!0}),d?SA(m,_):m.dispatchEvent(_)}var VD=(e,s,l=0)=>{const d=Math.abs(e.x),m=Math.abs(e.y),_=d>m;return s==="left"||s==="right"?_&&d>l:!_&&m>l};function NJ(e=()=>{}){const s=Ci(e);Fi(()=>{let l=0,d=0;return l=window.requestAnimationFrame(()=>d=window.requestAnimationFrame(s)),()=>{window.cancelAnimationFrame(l),window.cancelAnimationFrame(d)}},[s])}function EJ(e){return e.nodeType===e.ELEMENT_NODE}function CJ(e){const s=[],l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const m=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||m?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;l.nextNode();)s.push(l.currentNode);return s}function QT(e){const s=document.activeElement;return e.some(l=>l===s?!0:(l.focus(),document.activeElement!==s))}var AJ=m5,E5=x5,C5=_5,A5=v5,P5=b5,I5=S5,M5=VA;const UD=e=>typeof e=="boolean"?`${e}`:e===0?"0":e,$D=l5,ev=(e,s)=>l=>{var d;if((s==null?void 0:s.variants)==null)return $D(e,l==null?void 0:l.class,l==null?void 0:l.className);const{variants:m,defaultVariants:_}=s,w=Object.keys(m).map(P=>{const M=l==null?void 0:l[P],L=_==null?void 0:_[P];if(M===null)return null;const F=UD(M)||UD(L);return m[P][F]}),o=l&&Object.entries(l).reduce((P,M)=>{let[L,F]=M;return F===void 0||(P[L]=F),P},{}),E=s==null||(d=s.compoundVariants)===null||d===void 0?void 0:d.reduce((P,M)=>{let{class:L,className:F,...$}=M;return Object.entries($).every(Y=>{let[H,X]=Y;return Array.isArray(X)?X.includes({..._,...o}[H]):{..._,...o}[H]===X})?[...P,L,F]:P},[]);return $D(e,w,E,l==null?void 0:l.class,l==null?void 0:l.className)};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PJ=e=>e.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),R5=(...e)=>e.filter((s,l,d)=>!!s&&s.trim()!==""&&d.indexOf(s)===l).join(" ").trim();/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var IJ={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const MJ=z.forwardRef(({color:e="currentColor",size:s=24,strokeWidth:l=2,absoluteStrokeWidth:d,className:m="",children:_,iconNode:w,...o},E)=>z.createElement("svg",{ref:E,...IJ,width:s,height:s,stroke:e,strokeWidth:d?Number(l)*24/Number(s):l,className:R5("lucide",m),...o},[...w.map(([P,M])=>z.createElement(P,M)),...Array.isArray(_)?_:[_]]));/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ps=(e,s)=>{const l=z.forwardRef(({className:d,...m},_)=>z.createElement(MJ,{ref:_,iconNode:s,className:R5(`lucide-${PJ(e)}`,d),...m}));return l.displayName=`${e}`,l};/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kg=ps("Activity",[["path",{d:"M22 12h-2.48a2 2 0 0 0-1.93 1.46l-2.35 8.36a.25.25 0 0 1-.48 0L9.24 2.18a.25.25 0 0 0-.48 0l-2.35 8.36A2 2 0 0 1 4.49 12H2",key:"169zse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GD=ps("Archive",[["rect",{width:"20",height:"5",x:"2",y:"3",rx:"1",key:"1wp1u1"}],["path",{d:"M4 8v11a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8",key:"1s80jp"}],["path",{d:"M10 12h4",key:"a56b0p"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Cf=ps("ArrowLeft",[["path",{d:"m12 19-7-7 7-7",key:"1l729n"}],["path",{d:"M19 12H5",key:"x3x0zl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Dg=ps("ArrowRight",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"m12 5 7 7-7 7",key:"xquz4c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Rh=ps("Award",[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sx=ps("Bath",[["path",{d:"M10 4 8 6",key:"1rru8s"}],["path",{d:"M17 19v2",key:"ts1sot"}],["path",{d:"M2 12h20",key:"9i4pu4"}],["path",{d:"M7 19v2",key:"12npes"}],["path",{d:"M9 5 7.621 3.621A2.121 2.121 0 0 0 4 5v12a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2v-5",key:"14ym8i"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nx=ps("Bed",[["path",{d:"M2 4v16",key:"vw9hq8"}],["path",{d:"M2 8h18a2 2 0 0 1 2 2v10",key:"1dgv2r"}],["path",{d:"M2 17h20",key:"18nfp3"}],["path",{d:"M6 8v9",key:"1yriud"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const au=ps("Bell",[["path",{d:"M6 8a6 6 0 0 1 12 0c0 7 3 9 3 9H3s3-2 3-9",key:"1qo2s2"}],["path",{d:"M10.3 21a1.94 1.94 0 0 0 3.4 0",key:"qgo35s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RJ=ps("Bot",[["path",{d:"M12 8V4H8",key:"hb8ula"}],["rect",{width:"16",height:"12",x:"4",y:"8",rx:"2",key:"enze0r"}],["path",{d:"M2 14h2",key:"vft8re"}],["path",{d:"M20 14h2",key:"4cs60a"}],["path",{d:"M15 13v2",key:"1xurst"}],["path",{d:"M9 13v2",key:"rq6x2g"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UA=ps("Building2",[["path",{d:"M6 22V4a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v18Z",key:"1b4qmf"}],["path",{d:"M6 12H4a2 2 0 0 0-2 2v6a2 2 0 0 0 2 2h2",key:"i71pzd"}],["path",{d:"M18 9h2a2 2 0 0 1 2 2v9a2 2 0 0 1-2 2h-2",key:"10jefs"}],["path",{d:"M10 6h4",key:"1itunk"}],["path",{d:"M10 10h4",key:"tcdvrf"}],["path",{d:"M10 14h4",key:"kelpxr"}],["path",{d:"M10 18h4",key:"1ulq68"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ya=ps("Building",[["rect",{width:"16",height:"20",x:"4",y:"2",rx:"2",ry:"2",key:"76otgf"}],["path",{d:"M9 22v-4h6v4",key:"r93iot"}],["path",{d:"M8 6h.01",key:"1dz90k"}],["path",{d:"M16 6h.01",key:"1x0f13"}],["path",{d:"M12 6h.01",key:"1vi96p"}],["path",{d:"M12 10h.01",key:"1nrarc"}],["path",{d:"M12 14h.01",key:"1etili"}],["path",{d:"M16 10h.01",key:"1m94wz"}],["path",{d:"M16 14h.01",key:"1gbofw"}],["path",{d:"M8 10h.01",key:"19clt8"}],["path",{d:"M8 14h.01",key:"6423bh"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bx=ps("Calendar",[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const kJ=ps("Camera",[["path",{d:"M14.5 4h-5L7 7H4a2 2 0 0 0-2 2v9a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2h-3l-2.5-3z",key:"1tc9qg"}],["circle",{cx:"12",cy:"13",r:"3",key:"1vg3eu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vf=ps("ChartColumn",[["path",{d:"M3 3v16a2 2 0 0 0 2 2h16",key:"c24i48"}],["path",{d:"M18 17V9",key:"2bz60n"}],["path",{d:"M13 17V5",key:"1frdt8"}],["path",{d:"M8 17v-3",key:"17ska0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DJ=ps("CheckCheck",[["path",{d:"M18 6 7 17l-5-5",key:"116fxf"}],["path",{d:"m22 10-7.5 7.5L13 16",key:"ke71qq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Eh=ps("Check",[["path",{d:"M20 6 9 17l-5-5",key:"1gmf2c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const W2=ps("ChevronDown",[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const q2=ps("ChevronLeft",[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tv=ps("ChevronRight",[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LJ=ps("ChevronUp",[["path",{d:"m18 15-6-6-6 6",key:"153udz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rl=ps("CircleAlert",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const dr=ps("CircleCheckBig",[["path",{d:"M21.801 10A10 10 0 1 1 17 3.335",key:"yps3ct"}],["path",{d:"m9 11 3 3L22 4",key:"1pflzl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Vb=ps("CircleHelp",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3",key:"1u773s"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tu=ps("CircleX",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"m15 9-6 6",key:"1uzhvr"}],["path",{d:"m9 9 6 6",key:"z0biqf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zJ=ps("Circle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ko=ps("Clock",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["polyline",{points:"12 6 12 12 16 14",key:"68esgv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const OJ=ps("Cloud",[["path",{d:"M17.5 19H9a7 7 0 1 1 6.71-9h1.79a4.5 4.5 0 1 1 0 9Z",key:"p7xjir"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FJ=ps("Cpu",[["rect",{width:"16",height:"16",x:"4",y:"4",rx:"2",key:"14l7u7"}],["rect",{width:"6",height:"6",x:"9",y:"9",rx:"1",key:"5aljv4"}],["path",{d:"M15 2v2",key:"13l42r"}],["path",{d:"M15 20v2",key:"15mkzm"}],["path",{d:"M2 15h2",key:"1gxd5l"}],["path",{d:"M2 9h2",key:"1bbxkp"}],["path",{d:"M20 15h2",key:"19e6y8"}],["path",{d:"M20 9h2",key:"19tzq7"}],["path",{d:"M9 2v2",key:"165o2o"}],["path",{d:"M9 20v2",key:"i2bqo8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BJ=ps("CreditCard",[["rect",{width:"20",height:"14",x:"2",y:"5",rx:"2",key:"ynyp8z"}],["line",{x1:"2",x2:"22",y1:"10",y2:"10",key:"1b3vmo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const VJ=ps("Database",[["ellipse",{cx:"12",cy:"5",rx:"9",ry:"3",key:"msslwz"}],["path",{d:"M3 5V19A9 3 0 0 0 21 19V5",key:"1wlel7"}],["path",{d:"M3 12A9 3 0 0 0 21 12",key:"mv7ke4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const hi=ps("DollarSign",[["line",{x1:"12",x2:"12",y1:"2",y2:"22",key:"7eqyqh"}],["path",{d:"M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6",key:"1b0p4s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jw=ps("Download",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"7 10 12 15 17 10",key:"2ggqvy"}],["line",{x1:"12",x2:"12",y1:"15",y2:"3",key:"1vk2je"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const UJ=ps("EllipsisVertical",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"12",cy:"5",r:"1",key:"gxeob9"}],["circle",{cx:"12",cy:"19",r:"1",key:"lyex9k"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Z2=ps("Ellipsis",[["circle",{cx:"12",cy:"12",r:"1",key:"41hilf"}],["circle",{cx:"19",cy:"12",r:"1",key:"1wjl8i"}],["circle",{cx:"5",cy:"12",r:"1",key:"1pcz8c"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Hu=ps("EyeOff",[["path",{d:"M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49",key:"ct8e1f"}],["path",{d:"M14.084 14.158a3 3 0 0 1-4.242-4.242",key:"151rxh"}],["path",{d:"M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143",key:"13bj9a"}],["path",{d:"m2 2 20 20",key:"1ooewy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pi=ps("Eye",[["path",{d:"M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0",key:"1nclc0"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $J=ps("Facebook",[["path",{d:"M18 2h-3a5 5 0 0 0-5 5v3H7v4h3v8h4v-8h3l1-4h-4V7a1 1 0 0 1 1-1h3z",key:"1jg4f8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k5=ps("FileText",[["path",{d:"M15 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7Z",key:"1rqfz7"}],["path",{d:"M14 2v4a2 2 0 0 0 2 2h4",key:"tnqrlb"}],["path",{d:"M10 9H8",key:"b1mrlr"}],["path",{d:"M16 13H8",key:"t4e002"}],["path",{d:"M16 17H8",key:"z1uh3a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wx=ps("Filter",[["polygon",{points:"22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3",key:"1yg77f"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const D5=ps("Grid3x3",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}],["path",{d:"M3 9h18",key:"1pudct"}],["path",{d:"M3 15h18",key:"5xshup"}],["path",{d:"M9 3v18",key:"fh3hqa"}],["path",{d:"M15 3v18",key:"14nvp0"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GJ=ps("HardDrive",[["line",{x1:"22",x2:"2",y1:"12",y2:"12",key:"1y58io"}],["path",{d:"M5.45 5.11 2 12v6a2 2 0 0 0 2 2h16a2 2 0 0 0 2-2v-6l-3.45-6.89A2 2 0 0 0 16.76 4H7.24a2 2 0 0 0-1.79 1.11z",key:"oot6mr"}],["line",{x1:"6",x2:"6.01",y1:"16",y2:"16",key:"sgf278"}],["line",{x1:"10",x2:"10.01",y1:"16",y2:"16",key:"1l4acy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const su=ps("Heart",[["path",{d:"M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z",key:"c3ymky"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HJ=ps("Hospital",[["path",{d:"M12 6v4",key:"16clxf"}],["path",{d:"M14 14h-4",key:"esezmu"}],["path",{d:"M14 18h-4",key:"16mqa2"}],["path",{d:"M14 8h-4",key:"z8ypaz"}],["path",{d:"M18 12h2a2 2 0 0 1 2 2v6a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-9a2 2 0 0 1 2-2h2",key:"b1k337"}],["path",{d:"M18 22V4a2 2 0 0 0-2-2H8a2 2 0 0 0-2 2v18",key:"16g51d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bo=ps("House",[["path",{d:"M15 21v-8a1 1 0 0 0-1-1h-4a1 1 0 0 0-1 1v8",key:"5wwlr5"}],["path",{d:"M3 10a2 2 0 0 1 .709-1.528l7-5.999a2 2 0 0 1 2.582 0l7 5.999A2 2 0 0 1 21 10v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"1d0kgt"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qw=ps("Info",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WJ=ps("Instagram",[["rect",{width:"20",height:"20",x:"2",y:"2",rx:"5",ry:"5",key:"2e1cvw"}],["path",{d:"M16 11.37A4 4 0 1 1 12.63 8 4 4 0 0 1 16 11.37z",key:"9exkf1"}],["line",{x1:"17.5",x2:"17.51",y1:"6.5",y2:"6.5",key:"r4j83e"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const qJ=ps("Key",[["path",{d:"m15.5 7.5 2.3 2.3a1 1 0 0 0 1.4 0l2.1-2.1a1 1 0 0 0 0-1.4L19 4",key:"g0fldk"}],["path",{d:"m21 2-9.6 9.6",key:"1j0ho8"}],["circle",{cx:"7.5",cy:"15.5",r:"5.5",key:"yqb3hr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ZJ=ps("LayoutDashboard",[["rect",{width:"7",height:"9",x:"3",y:"3",rx:"1",key:"10lvy0"}],["rect",{width:"7",height:"5",x:"14",y:"3",rx:"1",key:"16une8"}],["rect",{width:"7",height:"9",x:"14",y:"12",rx:"1",key:"1hutg5"}],["rect",{width:"7",height:"5",x:"3",y:"16",rx:"1",key:"ldoo1y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const KJ=ps("Linkedin",[["path",{d:"M16 8a6 6 0 0 1 6 6v7h-4v-7a2 2 0 0 0-2-2 2 2 0 0 0-2 2v7h-4v-7a6 6 0 0 1 6-6z",key:"c2jq9f"}],["rect",{width:"4",height:"12",x:"2",y:"9",key:"mk3on5"}],["circle",{cx:"4",cy:"4",r:"2",key:"bt5ra8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const L5=ps("List",[["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 18h.01",key:"1tta3j"}],["path",{d:"M3 6h.01",key:"1rqtza"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 18h13",key:"1lx6n3"}],["path",{d:"M8 6h13",key:"ik3vkj"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const e2=ps("LoaderCircle",[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const XJ=ps("Loader",[["path",{d:"M12 2v4",key:"3427ic"}],["path",{d:"m16.2 7.8 2.9-2.9",key:"r700ao"}],["path",{d:"M18 12h4",key:"wj9ykh"}],["path",{d:"m16.2 16.2 2.9 2.9",key:"1bxg5t"}],["path",{d:"M12 18v4",key:"jadmvz"}],["path",{d:"m4.9 19.1 2.9-2.9",key:"bwix9q"}],["path",{d:"M2 12h4",key:"j09sii"}],["path",{d:"m4.9 4.9 2.9 2.9",key:"giyufr"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const R0=ps("Lock",[["rect",{width:"18",height:"11",x:"3",y:"11",rx:"2",ry:"2",key:"1w4ew1"}],["path",{d:"M7 11V7a5 5 0 0 1 10 0v4",key:"fwvmzm"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HD=ps("LogIn",[["path",{d:"M15 3h4a2 2 0 0 1 2 2v14a2 2 0 0 1-2 2h-4",key:"u53s6r"}],["polyline",{points:"10 17 15 12 10 7",key:"1ail0h"}],["line",{x1:"15",x2:"3",y1:"12",y2:"12",key:"v6grx8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const LE=ps("LogOut",[["path",{d:"M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4",key:"1uf3rs"}],["polyline",{points:"16 17 21 12 16 7",key:"1gabdz"}],["line",{x1:"21",x2:"9",y1:"12",y2:"12",key:"1uyos4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const il=ps("Mail",[["rect",{width:"20",height:"16",x:"2",y:"4",rx:"2",key:"18n3k1"}],["path",{d:"m22 7-8.97 5.7a1.94 1.94 0 0 1-2.06 0L2 7",key:"1ocrg3"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ai=ps("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const YJ=ps("Menu",[["line",{x1:"4",x2:"20",y1:"12",y2:"12",key:"1e0a9i"}],["line",{x1:"4",x2:"20",y1:"6",y2:"6",key:"1owob3"}],["line",{x1:"4",x2:"20",y1:"18",y2:"18",key:"yk5zj1"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sv=ps("MessageCircle",[["path",{d:"M7.9 20A9 9 0 1 0 4 16.1L2 22Z",key:"vv11sd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tl=ps("MessageSquare",[["path",{d:"M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z",key:"1lielz"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const JJ=ps("PenLine",[["path",{d:"M12 20h9",key:"t2du7b"}],["path",{d:"M16.376 3.622a1 1 0 0 1 3.002 3.002L7.368 18.635a2 2 0 0 1-.855.506l-2.872.838a.5.5 0 0 1-.62-.62l.838-2.872a2 2 0 0 1 .506-.854z",key:"1ykcvy"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Uh=ps("Phone",[["path",{d:"M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z",key:"foiqr5"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const QJ=ps("PiggyBank",[["path",{d:"M19 5c-1.5 0-2.8 1.4-3 2-3.5-1.5-11-.3-11 5 0 1.8 0 3 2 4.5V20h4v-2h3v2h4v-4c1-.5 1.7-1 2-2h2v-4h-2c0-1-.5-1.5-1-2V5z",key:"1ivx2i"}],["path",{d:"M2 9v1c0 1.1.9 2 2 2h1",key:"nm575m"}],["path",{d:"M16 11h.01",key:"xkw8gn"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eQ=ps("Plane",[["path",{d:"M17.8 19.2 16 11l3.5-3.5C21 6 21.5 4 21 3c-1-.5-3 0-4.5 1.5L13 8 4.8 6.2c-.5-.1-.9.1-1.1.5l-.3.5c-.2.5-.1 1 .3 1.3L9 12l-2 3H4l-1 1 3 2 2 3 1-1v-3l3-2 3.5 5.3c.3.4.8.5 1.3.3l.5-.2c.4-.3.6-.7.5-1.2z",key:"1v9wt8"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const z5=ps("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tQ=ps("Receipt",[["path",{d:"M4 2v20l2-1 2 1 2-1 2 1 2-1 2 1 2-1 2 1V2l-2 1-2-1-2 1-2-1-2 1-2-1-2 1Z",key:"q3az6g"}],["path",{d:"M16 8h-6a2 2 0 1 0 0 4h4a2 2 0 1 1 0 4H8",key:"1h4pet"}],["path",{d:"M12 17.5v-11",key:"1jc1ny"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Wu=ps("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const $A=ps("RotateCcw",[["path",{d:"M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8",key:"1357e3"}],["path",{d:"M3 3v5h5",key:"1xhq8a"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const GA=ps("Save",[["path",{d:"M15.2 3a2 2 0 0 1 1.4.6l3.8 3.8a2 2 0 0 1 .6 1.4V19a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2z",key:"1c8476"}],["path",{d:"M17 21v-7a1 1 0 0 0-1-1H8a1 1 0 0 0-1 1v7",key:"1ydtos"}],["path",{d:"M7 3v4a1 1 0 0 0 1 1h7",key:"t51u73"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const O5=ps("School",[["path",{d:"M14 22v-4a2 2 0 1 0-4 0v4",key:"hhkicm"}],["path",{d:"m18 10 3.447 1.724a1 1 0 0 1 .553.894V20a2 2 0 0 1-2 2H4a2 2 0 0 1-2-2v-7.382a1 1 0 0 1 .553-.894L6 10",key:"1xqip1"}],["path",{d:"M18 5v17",key:"1sw6gf"}],["path",{d:"m4 6 7.106-3.553a2 2 0 0 1 1.788 0L20 6",key:"9d2mlk"}],["path",{d:"M6 5v17",key:"1xfsm0"}],["circle",{cx:"12",cy:"9",r:"2",key:"1092wv"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Li=ps("Search",[["circle",{cx:"11",cy:"11",r:"8",key:"4ej97u"}],["path",{d:"m21 21-4.3-4.3",key:"1qie3q"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const K2=ps("Send",[["path",{d:"M14.536 21.686a.5.5 0 0 0 .937-.024l6.5-19a.496.496 0 0 0-.635-.635l-19 6.5a.5.5 0 0 0-.024.937l7.93 3.18a2 2 0 0 1 1.112 1.11z",key:"1ffxy3"}],["path",{d:"m21.854 2.147-10.94 10.939",key:"12cjpa"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sQ=ps("Server",[["rect",{width:"20",height:"8",x:"2",y:"2",rx:"2",ry:"2",key:"ngkwjq"}],["rect",{width:"20",height:"8",x:"2",y:"14",rx:"2",ry:"2",key:"iecqi9"}],["line",{x1:"6",x2:"6.01",y1:"6",y2:"6",key:"16zg32"}],["line",{x1:"6",x2:"6.01",y1:"18",y2:"18",key:"nzw8ys"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rx=ps("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F5=ps("Share2",[["circle",{cx:"18",cy:"5",r:"3",key:"gq8acd"}],["circle",{cx:"6",cy:"12",r:"3",key:"w7nqdw"}],["circle",{cx:"18",cy:"19",r:"3",key:"1xt0gg"}],["line",{x1:"8.59",x2:"15.42",y1:"13.51",y2:"17.49",key:"47mynk"}],["line",{x1:"15.41",x2:"8.59",y1:"6.51",y2:"10.49",key:"1n3mei"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nQ=ps("ShieldX",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}],["path",{d:"m14.5 9.5-5 5",key:"17q4r4"}],["path",{d:"m9.5 9.5 5 5",key:"18nt4w"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ac=ps("Shield",[["path",{d:"M20 13c0 5-3.5 7.5-7.66 8.95a1 1 0 0 1-.67-.01C7.5 20.5 4 18 4 13V6a1 1 0 0 1 1-1c2 0 4.5-1.2 6.24-2.72a1.17 1.17 0 0 1 1.52 0C14.51 3.81 17 5 19 5a1 1 0 0 1 1 1z",key:"oel41y"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rQ=ps("ShoppingBag",[["path",{d:"M6 2 3 6v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V6l-3-4Z",key:"hou9p0"}],["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M16 10a4 4 0 0 1-8 0",key:"1ltviw"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const B5=ps("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a1 1 0 0 1 3 3l-9.013 9.014a2 2 0 0 1-.853.505l-2.873.84a.5.5 0 0 1-.62-.62l.84-2.873a2 2 0 0 1 .506-.852z",key:"ohrbg2"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ix=ps("Square",[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",key:"afitv7"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lc=ps("Star",[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iQ=ps("Target",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oQ=ps("Timer",[["line",{x1:"10",x2:"14",y1:"2",y2:"2",key:"14vaq8"}],["line",{x1:"12",x2:"15",y1:"14",y2:"11",key:"17fdiu"}],["circle",{cx:"12",cy:"14",r:"8",key:"1e1u0o"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aQ=ps("TramFront",[["rect",{width:"16",height:"16",x:"4",y:"3",rx:"2",key:"1wxw4b"}],["path",{d:"M4 11h16",key:"mpoxn0"}],["path",{d:"M12 3v8",key:"1h2ygw"}],["path",{d:"m8 19-2 3",key:"13i0xs"}],["path",{d:"m18 22-2-3",key:"1p0ohu"}],["path",{d:"M8 15h.01",key:"a7atzg"}],["path",{d:"M16 15h.01",key:"rnfrdf"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ox=ps("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lQ=ps("TreePine",[["path",{d:"m17 14 3 3.3a1 1 0 0 1-.7 1.7H4.7a1 1 0 0 1-.7-1.7L7 14h-.3a1 1 0 0 1-.7-1.7L9 9h-.2A1 1 0 0 1 8 7.3L12 3l4 4.3a1 1 0 0 1-.8 1.7H15l3 3.3a1 1 0 0 1-.7 1.7H17Z",key:"cpyugq"}],["path",{d:"M12 22v-3",key:"kmzjlo"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const zE=ps("TrendingDown",[["polyline",{points:"22 17 13.5 8.5 8.5 13.5 2 7",key:"1r2t7k"}],["polyline",{points:"16 17 22 17 22 11",key:"11uiuu"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Ei=ps("TrendingUp",[["polyline",{points:"22 7 13.5 15.5 8.5 10.5 2 17",key:"126l90"}],["polyline",{points:"16 7 22 7 22 13",key:"kwv8wd"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ed=ps("TriangleAlert",[["path",{d:"m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3",key:"wmoenq"}],["path",{d:"M12 9v4",key:"juzpu7"}],["path",{d:"M12 17h.01",key:"p32p05"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cQ=ps("Twitter",[["path",{d:"M22 4s-.7 2.1-2 3.4c1.6 10-9.4 17.3-18 11.6 2.2.1 4.4-.6 6-2C3 15.5.5 9.6 3 5c2.2 2.6 5.6 4.1 9 4-.9-4.2 4-6.6 7-3.8 1.1 0 3-1.2 3-1.2z",key:"pff0z6"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V5=ps("Upload",[["path",{d:"M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4",key:"ih7n3h"}],["polyline",{points:"17 8 12 3 7 8",key:"t8dd8p"}],["line",{x1:"12",x2:"12",y1:"3",y2:"15",key:"widbto"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const HA=ps("UserCheck",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["polyline",{points:"16 11 18 13 22 9",key:"1pwet4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const t2=ps("UserPlus",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"19",x2:"19",y1:"8",y2:"14",key:"1bvyxn"}],["line",{x1:"22",x2:"16",y1:"11",y2:"11",key:"1shjgl"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const k0=ps("UserX",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["line",{x1:"17",x2:"22",y1:"8",y2:"13",key:"3nzzx3"}],["line",{x1:"22",x2:"17",y1:"8",y2:"13",key:"1swrse"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lu=ps("User",[["path",{d:"M19 21v-2a4 4 0 0 0-4-4H9a4 4 0 0 0-4 4v2",key:"975kel"}],["circle",{cx:"12",cy:"7",r:"4",key:"17ys0d"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _o=ps("Users",[["path",{d:"M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2",key:"1yyitq"}],["circle",{cx:"9",cy:"7",r:"4",key:"nufk8"}],["path",{d:"M22 21v-2a4 4 0 0 0-3-3.87",key:"kshegd"}],["path",{d:"M16 3.13a4 4 0 0 1 0 7.75",key:"1da9ce"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const WD=ps("Wallet",[["path",{d:"M19 7V4a1 1 0 0 0-1-1H5a2 2 0 0 0 0 4h15a1 1 0 0 1 1 1v4h-3a2 2 0 0 0 0 4h3a1 1 0 0 0 1-1v-2a1 1 0 0 0-1-1",key:"18etb6"}],["path",{d:"M3 5v14a2 2 0 0 0 2 2h15a1 1 0 0 0 1-1v-4",key:"xoc0q4"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uQ=ps("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.462.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ol=ps("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]),dQ=AJ,U5=z.forwardRef(({className:e,...s},l)=>n.jsx(E5,{ref:l,className:Ds("fixed top-0 z-[100] flex max-h-screen w-full flex-col-reverse p-4 sm:bottom-0 sm:right-0 sm:top-auto sm:flex-col md:max-w-[420px]",e),...s}));U5.displayName=E5.displayName;const hQ=ev("group pointer-events-auto relative flex w-full items-center justify-between space-x-4 overflow-hidden rounded-md border p-6 pr-8 shadow-lg transition-all data-[swipe=cancel]:translate-x-0 data-[swipe=end]:translate-x-[var(--radix-toast-swipe-end-x)] data-[swipe=move]:translate-x-[var(--radix-toast-swipe-move-x)] data-[swipe=move]:transition-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[swipe=end]:animate-out data-[state=closed]:fade-out-80 data-[state=closed]:slide-out-to-right-full data-[state=open]:slide-in-from-top-full data-[state=open]:sm:slide-in-from-bottom-full",{variants:{variant:{default:"border bg-background text-foreground",destructive:"destructive group border-destructive bg-destructive text-destructive-foreground"}},defaultVariants:{variant:"default"}}),$5=z.forwardRef(({className:e,variant:s,...l},d)=>n.jsx(C5,{ref:d,className:Ds(hQ({variant:s}),e),...l}));$5.displayName=C5.displayName;const pQ=z.forwardRef(({className:e,...s},l)=>n.jsx(I5,{ref:l,className:Ds("inline-flex h-8 shrink-0 items-center justify-center rounded-md border bg-transparent px-3 text-sm font-medium ring-offset-background transition-colors hover:bg-secondary focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 group-[.destructive]:border-muted/40 group-[.destructive]:hover:border-destructive/30 group-[.destructive]:hover:bg-destructive group-[.destructive]:hover:text-destructive-foreground group-[.destructive]:focus:ring-destructive",e),...s}));pQ.displayName=I5.displayName;const G5=z.forwardRef(({className:e,...s},l)=>n.jsx(M5,{ref:l,className:Ds("absolute right-2 top-2 rounded-md p-1 text-foreground/50 opacity-0 transition-opacity hover:text-foreground focus:opacity-100 focus:outline-none focus:ring-2 group-hover:opacity-100 group-[.destructive]:text-red-300 group-[.destructive]:hover:text-red-50 group-[.destructive]:focus:ring-red-400 group-[.destructive]:focus:ring-offset-red-600",e),"toast-close":"",...s,children:n.jsx(ol,{className:"h-4 w-4"})}));G5.displayName=M5.displayName;const H5=z.forwardRef(({className:e,...s},l)=>n.jsx(A5,{ref:l,className:Ds("text-sm font-semibold",e),...s}));H5.displayName=A5.displayName;const W5=z.forwardRef(({className:e,...s},l)=>n.jsx(P5,{ref:l,className:Ds("text-sm opacity-90",e),...s}));W5.displayName=P5.displayName;function fQ(){const{toasts:e}=Bi();return n.jsxs(dQ,{children:[e.map(function({id:s,title:l,description:d,action:m,..._}){return n.jsxs($5,{..._,children:[n.jsxs("div",{className:"grid gap-1",children:[l&&n.jsx(H5,{children:l}),d&&n.jsx(W5,{children:d})]}),m,n.jsx(G5,{})]},s)}),n.jsx(U5,{})]})}var qD=["light","dark"],mQ="(prefers-color-scheme: dark)",gQ=z.createContext(void 0),xQ={setTheme:e=>{},themes:[]},yQ=()=>{var e;return(e=z.useContext(gQ))!=null?e:xQ};z.memo(({forcedTheme:e,storageKey:s,attribute:l,enableSystem:d,enableColorScheme:m,defaultTheme:_,value:w,attrs:o,nonce:E})=>{let P=_==="system",M=l==="class"?`var d=document.documentElement,c=d.classList;${`c.remove(${o.map(Y=>`'${Y}'`).join(",")})`};`:`var d=document.documentElement,n='${l}',s='setAttribute';`,L=m?qD.includes(_)&&_?`if(e==='light'||e==='dark'||!e)d.style.colorScheme=e||'${_}'`:"if(e==='light'||e==='dark')d.style.colorScheme=e":"",F=(Y,H=!1,X=!0)=>{let Z=w?w[Y]:Y,W=H?Y+"|| ''":`'${Z}'`,q="";return m&&X&&!H&&qD.includes(Y)&&(q+=`d.style.colorScheme = '${Y}';`),l==="class"?H||Z?q+=`c.add(${W})`:q+="null":Z&&(q+=`d[s](n,${W})`),q},$=e?`!function(){${M}${F(e)}}()`:d?`!function(){try{${M}var e=localStorage.getItem('${s}');if('system'===e||(!e&&${P})){var t='${mQ}',m=window.matchMedia(t);if(m.media!==t||m.matches){${F("dark")}}else{${F("light")}}}else if(e){${w?`var x=${JSON.stringify(w)};`:""}${F(w?"x[e]":"e",!0)}}${P?"":"else{"+F(_,!1,!1)+"}"}${L}}catch(e){}}()`:`!function(){try{${M}var e=localStorage.getItem('${s}');if(e){${w?`var x=${JSON.stringify(w)};`:""}${F(w?"x[e]":"e",!0)}}else{${F(_,!1,!1)};}${L}}catch(t){}}();`;return z.createElement("script",{nonce:E,dangerouslySetInnerHTML:{__html:$}})});var _Q=e=>{switch(e){case"success":return wQ;case"info":return jQ;case"warning":return SQ;case"error":return TQ;default:return null}},vQ=Array(12).fill(0),bQ=({visible:e,className:s})=>vs.createElement("div",{className:["sonner-loading-wrapper",s].filter(Boolean).join(" "),"data-visible":e},vs.createElement("div",{className:"sonner-spinner"},vQ.map((l,d)=>vs.createElement("div",{className:"sonner-loading-bar",key:`spinner-bar-${d}`})))),wQ=vs.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vs.createElement("path",{fillRule:"evenodd",d:"M10 18a8 8 0 100-16 8 8 0 000 16zm3.857-9.809a.75.75 0 00-1.214-.882l-3.483 4.79-1.88-1.88a.75.75 0 10-1.06 1.061l2.5 2.5a.75.75 0 001.137-.089l4-5.5z",clipRule:"evenodd"})),SQ=vs.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 24 24",fill:"currentColor",height:"20",width:"20"},vs.createElement("path",{fillRule:"evenodd",d:"M9.401 3.003c1.155-2 4.043-2 5.197 0l7.355 12.748c1.154 2-.29 4.5-2.599 4.5H4.645c-2.309 0-3.752-2.5-2.598-4.5L9.4 3.003zM12 8.25a.75.75 0 01.75.75v3.75a.75.75 0 01-1.5 0V9a.75.75 0 01.75-.75zm0 8.25a.75.75 0 100-1.5.75.75 0 000 1.5z",clipRule:"evenodd"})),jQ=vs.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vs.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a.75.75 0 000 1.5h.253a.25.25 0 01.244.304l-.459 2.066A1.75 1.75 0 0010.747 15H11a.75.75 0 000-1.5h-.253a.25.25 0 01-.244-.304l.459-2.066A1.75 1.75 0 009.253 9H9z",clipRule:"evenodd"})),TQ=vs.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 20 20",fill:"currentColor",height:"20",width:"20"},vs.createElement("path",{fillRule:"evenodd",d:"M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-8-5a.75.75 0 01.75.75v4.5a.75.75 0 01-1.5 0v-4.5A.75.75 0 0110 5zm0 10a1 1 0 100-2 1 1 0 000 2z",clipRule:"evenodd"})),NQ=vs.createElement("svg",{xmlns:"http://www.w3.org/2000/svg",width:"12",height:"12",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"},vs.createElement("line",{x1:"18",y1:"6",x2:"6",y2:"18"}),vs.createElement("line",{x1:"6",y1:"6",x2:"18",y2:"18"})),EQ=()=>{let[e,s]=vs.useState(document.hidden);return vs.useEffect(()=>{let l=()=>{s(document.hidden)};return document.addEventListener("visibilitychange",l),()=>window.removeEventListener("visibilitychange",l)},[]),e},OE=1,CQ=class{constructor(){this.subscribe=e=>(this.subscribers.push(e),()=>{let s=this.subscribers.indexOf(e);this.subscribers.splice(s,1)}),this.publish=e=>{this.subscribers.forEach(s=>s(e))},this.addToast=e=>{this.publish(e),this.toasts=[...this.toasts,e]},this.create=e=>{var s;let{message:l,...d}=e,m=typeof(e==null?void 0:e.id)=="number"||((s=e.id)==null?void 0:s.length)>0?e.id:OE++,_=this.toasts.find(o=>o.id===m),w=e.dismissible===void 0?!0:e.dismissible;return this.dismissedToasts.has(m)&&this.dismissedToasts.delete(m),_?this.toasts=this.toasts.map(o=>o.id===m?(this.publish({...o,...e,id:m,title:l}),{...o,...e,id:m,dismissible:w,title:l}):o):this.addToast({title:l,...d,dismissible:w,id:m}),m},this.dismiss=e=>(this.dismissedToasts.add(e),e||this.toasts.forEach(s=>{this.subscribers.forEach(l=>l({id:s.id,dismiss:!0}))}),this.subscribers.forEach(s=>s({id:e,dismiss:!0})),e),this.message=(e,s)=>this.create({...s,message:e}),this.error=(e,s)=>this.create({...s,message:e,type:"error"}),this.success=(e,s)=>this.create({...s,type:"success",message:e}),this.info=(e,s)=>this.create({...s,type:"info",message:e}),this.warning=(e,s)=>this.create({...s,type:"warning",message:e}),this.loading=(e,s)=>this.create({...s,type:"loading",message:e}),this.promise=(e,s)=>{if(!s)return;let l;s.loading!==void 0&&(l=this.create({...s,promise:e,type:"loading",message:s.loading,description:typeof s.description!="function"?s.description:void 0}));let d=e instanceof Promise?e:e(),m=l!==void 0,_,w=d.then(async E=>{if(_=["resolve",E],vs.isValidElement(E))m=!1,this.create({id:l,type:"default",message:E});else if(PQ(E)&&!E.ok){m=!1;let P=typeof s.error=="function"?await s.error(`HTTP error! status: ${E.status}`):s.error,M=typeof s.description=="function"?await s.description(`HTTP error! status: ${E.status}`):s.description;this.create({id:l,type:"error",message:P,description:M})}else if(s.success!==void 0){m=!1;let P=typeof s.success=="function"?await s.success(E):s.success,M=typeof s.description=="function"?await s.description(E):s.description;this.create({id:l,type:"success",message:P,description:M})}}).catch(async E=>{if(_=["reject",E],s.error!==void 0){m=!1;let P=typeof s.error=="function"?await s.error(E):s.error,M=typeof s.description=="function"?await s.description(E):s.description;this.create({id:l,type:"error",message:P,description:M})}}).finally(()=>{var E;m&&(this.dismiss(l),l=void 0),(E=s.finally)==null||E.call(s)}),o=()=>new Promise((E,P)=>w.then(()=>_[0]==="reject"?P(_[1]):E(_[1])).catch(P));return typeof l!="string"&&typeof l!="number"?{unwrap:o}:Object.assign(l,{unwrap:o})},this.custom=(e,s)=>{let l=(s==null?void 0:s.id)||OE++;return this.create({jsx:e(l),id:l,...s}),l},this.getActiveToasts=()=>this.toasts.filter(e=>!this.dismissedToasts.has(e.id)),this.subscribers=[],this.toasts=[],this.dismissedToasts=new Set}},Ia=new CQ,AQ=(e,s)=>{let l=(s==null?void 0:s.id)||OE++;return Ia.addToast({title:e,...s,id:l}),l},PQ=e=>e&&typeof e=="object"&&"ok"in e&&typeof e.ok=="boolean"&&"status"in e&&typeof e.status=="number",IQ=AQ,MQ=()=>Ia.toasts,RQ=()=>Ia.getActiveToasts();Object.assign(IQ,{success:Ia.success,info:Ia.info,warning:Ia.warning,error:Ia.error,custom:Ia.custom,message:Ia.message,promise:Ia.promise,dismiss:Ia.dismiss,loading:Ia.loading},{getHistory:MQ,getToasts:RQ});function kQ(e,{insertAt:s}={}){if(typeof document>"u")return;let l=document.head||document.getElementsByTagName("head")[0],d=document.createElement("style");d.type="text/css",s==="top"&&l.firstChild?l.insertBefore(d,l.firstChild):l.appendChild(d),d.styleSheet?d.styleSheet.cssText=e:d.appendChild(document.createTextNode(e))}kQ(`:where(html[dir="ltr"]),:where([data-sonner-toaster][dir="ltr"]){--toast-icon-margin-start: -3px;--toast-icon-margin-end: 4px;--toast-svg-margin-start: -1px;--toast-svg-margin-end: 0px;--toast-button-margin-start: auto;--toast-button-margin-end: 0;--toast-close-button-start: 0;--toast-close-button-end: unset;--toast-close-button-transform: translate(-35%, -35%)}:where(html[dir="rtl"]),:where([data-sonner-toaster][dir="rtl"]){--toast-icon-margin-start: 4px;--toast-icon-margin-end: -3px;--toast-svg-margin-start: 0px;--toast-svg-margin-end: -1px;--toast-button-margin-start: 0;--toast-button-margin-end: auto;--toast-close-button-start: unset;--toast-close-button-end: 0;--toast-close-button-transform: translate(35%, -35%)}:where([data-sonner-toaster]){position:fixed;width:var(--width);font-family:ui-sans-serif,system-ui,-apple-system,BlinkMacSystemFont,Segoe UI,Roboto,Helvetica Neue,Arial,Noto Sans,sans-serif,Apple Color Emoji,Segoe UI Emoji,Segoe UI Symbol,Noto Color Emoji;--gray1: hsl(0, 0%, 99%);--gray2: hsl(0, 0%, 97.3%);--gray3: hsl(0, 0%, 95.1%);--gray4: hsl(0, 0%, 93%);--gray5: hsl(0, 0%, 90.9%);--gray6: hsl(0, 0%, 88.7%);--gray7: hsl(0, 0%, 85.8%);--gray8: hsl(0, 0%, 78%);--gray9: hsl(0, 0%, 56.1%);--gray10: hsl(0, 0%, 52.3%);--gray11: hsl(0, 0%, 43.5%);--gray12: hsl(0, 0%, 9%);--border-radius: 8px;box-sizing:border-box;padding:0;margin:0;list-style:none;outline:none;z-index:999999999;transition:transform .4s ease}:where([data-sonner-toaster][data-lifted="true"]){transform:translateY(-10px)}@media (hover: none) and (pointer: coarse){:where([data-sonner-toaster][data-lifted="true"]){transform:none}}:where([data-sonner-toaster][data-x-position="right"]){right:var(--offset-right)}:where([data-sonner-toaster][data-x-position="left"]){left:var(--offset-left)}:where([data-sonner-toaster][data-x-position="center"]){left:50%;transform:translate(-50%)}:where([data-sonner-toaster][data-y-position="top"]){top:var(--offset-top)}:where([data-sonner-toaster][data-y-position="bottom"]){bottom:var(--offset-bottom)}:where([data-sonner-toast]){--y: translateY(100%);--lift-amount: calc(var(--lift) * var(--gap));z-index:var(--z-index);position:absolute;opacity:0;transform:var(--y);filter:blur(0);touch-action:none;transition:transform .4s,opacity .4s,height .4s,box-shadow .2s;box-sizing:border-box;outline:none;overflow-wrap:anywhere}:where([data-sonner-toast][data-styled="true"]){padding:16px;background:var(--normal-bg);border:1px solid var(--normal-border);color:var(--normal-text);border-radius:var(--border-radius);box-shadow:0 4px 12px #0000001a;width:var(--width);font-size:13px;display:flex;align-items:center;gap:6px}:where([data-sonner-toast]:focus-visible){box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast][data-y-position="top"]){top:0;--y: translateY(-100%);--lift: 1;--lift-amount: calc(1 * var(--gap))}:where([data-sonner-toast][data-y-position="bottom"]){bottom:0;--y: translateY(100%);--lift: -1;--lift-amount: calc(var(--lift) * var(--gap))}:where([data-sonner-toast]) :where([data-description]){font-weight:400;line-height:1.4;color:inherit}:where([data-sonner-toast]) :where([data-title]){font-weight:500;line-height:1.5;color:inherit}:where([data-sonner-toast]) :where([data-icon]){display:flex;height:16px;width:16px;position:relative;justify-content:flex-start;align-items:center;flex-shrink:0;margin-left:var(--toast-icon-margin-start);margin-right:var(--toast-icon-margin-end)}:where([data-sonner-toast][data-promise="true"]) :where([data-icon])>svg{opacity:0;transform:scale(.8);transform-origin:center;animation:sonner-fade-in .3s ease forwards}:where([data-sonner-toast]) :where([data-icon])>*{flex-shrink:0}:where([data-sonner-toast]) :where([data-icon]) svg{margin-left:var(--toast-svg-margin-start);margin-right:var(--toast-svg-margin-end)}:where([data-sonner-toast]) :where([data-content]){display:flex;flex-direction:column;gap:2px}[data-sonner-toast][data-styled=true] [data-button]{border-radius:4px;padding-left:8px;padding-right:8px;height:24px;font-size:12px;color:var(--normal-bg);background:var(--normal-text);margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end);border:none;cursor:pointer;outline:none;display:flex;align-items:center;flex-shrink:0;transition:opacity .4s,box-shadow .2s}:where([data-sonner-toast]) :where([data-button]):focus-visible{box-shadow:0 0 0 2px #0006}:where([data-sonner-toast]) :where([data-button]):first-of-type{margin-left:var(--toast-button-margin-start);margin-right:var(--toast-button-margin-end)}:where([data-sonner-toast]) :where([data-cancel]){color:var(--normal-text);background:rgba(0,0,0,.08)}:where([data-sonner-toast][data-theme="dark"]) :where([data-cancel]){background:rgba(255,255,255,.3)}:where([data-sonner-toast]) :where([data-close-button]){position:absolute;left:var(--toast-close-button-start);right:var(--toast-close-button-end);top:0;height:20px;width:20px;display:flex;justify-content:center;align-items:center;padding:0;color:var(--gray12);border:1px solid var(--gray4);transform:var(--toast-close-button-transform);border-radius:50%;cursor:pointer;z-index:1;transition:opacity .1s,background .2s,border-color .2s}[data-sonner-toast] [data-close-button]{background:var(--gray1)}:where([data-sonner-toast]) :where([data-close-button]):focus-visible{box-shadow:0 4px 12px #0000001a,0 0 0 2px #0003}:where([data-sonner-toast]) :where([data-disabled="true"]){cursor:not-allowed}:where([data-sonner-toast]):hover :where([data-close-button]):hover{background:var(--gray2);border-color:var(--gray5)}:where([data-sonner-toast][data-swiping="true"]):before{content:"";position:absolute;left:-50%;right:-50%;height:100%;z-index:-1}:where([data-sonner-toast][data-y-position="top"][data-swiping="true"]):before{bottom:50%;transform:scaleY(3) translateY(50%)}:where([data-sonner-toast][data-y-position="bottom"][data-swiping="true"]):before{top:50%;transform:scaleY(3) translateY(-50%)}:where([data-sonner-toast][data-swiping="false"][data-removed="true"]):before{content:"";position:absolute;inset:0;transform:scaleY(2)}:where([data-sonner-toast]):after{content:"";position:absolute;left:0;height:calc(var(--gap) + 1px);bottom:100%;width:100%}:where([data-sonner-toast][data-mounted="true"]){--y: translateY(0);opacity:1}:where([data-sonner-toast][data-expanded="false"][data-front="false"]){--scale: var(--toasts-before) * .05 + 1;--y: translateY(calc(var(--lift-amount) * var(--toasts-before))) scale(calc(-1 * var(--scale)));height:var(--front-toast-height)}:where([data-sonner-toast])>*{transition:opacity .4s}:where([data-sonner-toast][data-expanded="false"][data-front="false"][data-styled="true"])>*{opacity:0}:where([data-sonner-toast][data-visible="false"]){opacity:0;pointer-events:none}:where([data-sonner-toast][data-mounted="true"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset)));height:var(--initial-height)}:where([data-sonner-toast][data-removed="true"][data-front="true"][data-swipe-out="false"]){--y: translateY(calc(var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="true"]){--y: translateY(calc(var(--lift) * var(--offset) + var(--lift) * -100%));opacity:0}:where([data-sonner-toast][data-removed="true"][data-front="false"][data-swipe-out="false"][data-expanded="false"]){--y: translateY(40%);opacity:0;transition:transform .5s,opacity .2s}:where([data-sonner-toast][data-removed="true"][data-front="false"]):before{height:calc(var(--initial-height) + 20%)}[data-sonner-toast][data-swiping=true]{transform:var(--y) translateY(var(--swipe-amount-y, 0px)) translate(var(--swipe-amount-x, 0px));transition:none}[data-sonner-toast][data-swiped=true]{user-select:none}[data-sonner-toast][data-swipe-out=true][data-y-position=bottom],[data-sonner-toast][data-swipe-out=true][data-y-position=top]{animation-duration:.2s;animation-timing-function:ease-out;animation-fill-mode:forwards}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=left]{animation-name:swipe-out-left}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=right]{animation-name:swipe-out-right}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=up]{animation-name:swipe-out-up}[data-sonner-toast][data-swipe-out=true][data-swipe-direction=down]{animation-name:swipe-out-down}@keyframes swipe-out-left{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) - 100%));opacity:0}}@keyframes swipe-out-right{0%{transform:var(--y) translate(var(--swipe-amount-x));opacity:1}to{transform:var(--y) translate(calc(var(--swipe-amount-x) + 100%));opacity:0}}@keyframes swipe-out-up{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) - 100%));opacity:0}}@keyframes swipe-out-down{0%{transform:var(--y) translateY(var(--swipe-amount-y));opacity:1}to{transform:var(--y) translateY(calc(var(--swipe-amount-y) + 100%));opacity:0}}@media (max-width: 600px){[data-sonner-toaster]{position:fixed;right:var(--mobile-offset-right);left:var(--mobile-offset-left);width:100%}[data-sonner-toaster][dir=rtl]{left:calc(var(--mobile-offset-left) * -1)}[data-sonner-toaster] [data-sonner-toast]{left:0;right:0;width:calc(100% - var(--mobile-offset-left) * 2)}[data-sonner-toaster][data-x-position=left]{left:var(--mobile-offset-left)}[data-sonner-toaster][data-y-position=bottom]{bottom:var(--mobile-offset-bottom)}[data-sonner-toaster][data-y-position=top]{top:var(--mobile-offset-top)}[data-sonner-toaster][data-x-position=center]{left:var(--mobile-offset-left);right:var(--mobile-offset-right);transform:none}}[data-sonner-toaster][data-theme=light]{--normal-bg: #fff;--normal-border: var(--gray4);--normal-text: var(--gray12);--success-bg: hsl(143, 85%, 96%);--success-border: hsl(145, 92%, 91%);--success-text: hsl(140, 100%, 27%);--info-bg: hsl(208, 100%, 97%);--info-border: hsl(221, 91%, 91%);--info-text: hsl(210, 92%, 45%);--warning-bg: hsl(49, 100%, 97%);--warning-border: hsl(49, 91%, 91%);--warning-text: hsl(31, 92%, 45%);--error-bg: hsl(359, 100%, 97%);--error-border: hsl(359, 100%, 94%);--error-text: hsl(360, 100%, 45%)}[data-sonner-toaster][data-theme=light] [data-sonner-toast][data-invert=true]{--normal-bg: #000;--normal-border: hsl(0, 0%, 20%);--normal-text: var(--gray1)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast][data-invert=true]{--normal-bg: #fff;--normal-border: var(--gray3);--normal-text: var(--gray12)}[data-sonner-toaster][data-theme=dark]{--normal-bg: #000;--normal-bg-hover: hsl(0, 0%, 12%);--normal-border: hsl(0, 0%, 20%);--normal-border-hover: hsl(0, 0%, 25%);--normal-text: var(--gray1);--success-bg: hsl(150, 100%, 6%);--success-border: hsl(147, 100%, 12%);--success-text: hsl(150, 86%, 65%);--info-bg: hsl(215, 100%, 6%);--info-border: hsl(223, 100%, 12%);--info-text: hsl(216, 87%, 65%);--warning-bg: hsl(64, 100%, 6%);--warning-border: hsl(60, 100%, 12%);--warning-text: hsl(46, 87%, 65%);--error-bg: hsl(358, 76%, 10%);--error-border: hsl(357, 89%, 16%);--error-text: hsl(358, 100%, 81%)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]{background:var(--normal-bg);border-color:var(--normal-border);color:var(--normal-text)}[data-sonner-toaster][data-theme=dark] [data-sonner-toast] [data-close-button]:hover{background:var(--normal-bg-hover);border-color:var(--normal-border-hover)}[data-rich-colors=true][data-sonner-toast][data-type=success],[data-rich-colors=true][data-sonner-toast][data-type=success] [data-close-button]{background:var(--success-bg);border-color:var(--success-border);color:var(--success-text)}[data-rich-colors=true][data-sonner-toast][data-type=info],[data-rich-colors=true][data-sonner-toast][data-type=info] [data-close-button]{background:var(--info-bg);border-color:var(--info-border);color:var(--info-text)}[data-rich-colors=true][data-sonner-toast][data-type=warning],[data-rich-colors=true][data-sonner-toast][data-type=warning] [data-close-button]{background:var(--warning-bg);border-color:var(--warning-border);color:var(--warning-text)}[data-rich-colors=true][data-sonner-toast][data-type=error],[data-rich-colors=true][data-sonner-toast][data-type=error] [data-close-button]{background:var(--error-bg);border-color:var(--error-border);color:var(--error-text)}.sonner-loading-wrapper{--size: 16px;height:var(--size);width:var(--size);position:absolute;inset:0;z-index:10}.sonner-loading-wrapper[data-visible=false]{transform-origin:center;animation:sonner-fade-out .2s ease forwards}.sonner-spinner{position:relative;top:50%;left:50%;height:var(--size);width:var(--size)}.sonner-loading-bar{animation:sonner-spin 1.2s linear infinite;background:var(--gray11);border-radius:6px;height:8%;left:-10%;position:absolute;top:-3.9%;width:24%}.sonner-loading-bar:nth-child(1){animation-delay:-1.2s;transform:rotate(.0001deg) translate(146%)}.sonner-loading-bar:nth-child(2){animation-delay:-1.1s;transform:rotate(30deg) translate(146%)}.sonner-loading-bar:nth-child(3){animation-delay:-1s;transform:rotate(60deg) translate(146%)}.sonner-loading-bar:nth-child(4){animation-delay:-.9s;transform:rotate(90deg) translate(146%)}.sonner-loading-bar:nth-child(5){animation-delay:-.8s;transform:rotate(120deg) translate(146%)}.sonner-loading-bar:nth-child(6){animation-delay:-.7s;transform:rotate(150deg) translate(146%)}.sonner-loading-bar:nth-child(7){animation-delay:-.6s;transform:rotate(180deg) translate(146%)}.sonner-loading-bar:nth-child(8){animation-delay:-.5s;transform:rotate(210deg) translate(146%)}.sonner-loading-bar:nth-child(9){animation-delay:-.4s;transform:rotate(240deg) translate(146%)}.sonner-loading-bar:nth-child(10){animation-delay:-.3s;transform:rotate(270deg) translate(146%)}.sonner-loading-bar:nth-child(11){animation-delay:-.2s;transform:rotate(300deg) translate(146%)}.sonner-loading-bar:nth-child(12){animation-delay:-.1s;transform:rotate(330deg) translate(146%)}@keyframes sonner-fade-in{0%{opacity:0;transform:scale(.8)}to{opacity:1;transform:scale(1)}}@keyframes sonner-fade-out{0%{opacity:1;transform:scale(1)}to{opacity:0;transform:scale(.8)}}@keyframes sonner-spin{0%{opacity:1}to{opacity:.15}}@media (prefers-reduced-motion){[data-sonner-toast],[data-sonner-toast]>*,.sonner-loading-bar{transition:none!important;animation:none!important}}.sonner-loader{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);transform-origin:center;transition:opacity .2s,transform .2s}.sonner-loader[data-visible=false]{opacity:0;transform:scale(.8) translate(-50%,-50%)}
`);function Ub(e){return e.label!==void 0}var DQ=3,LQ="32px",zQ="16px",ZD=4e3,OQ=356,FQ=14,BQ=20,VQ=200;function ql(...e){return e.filter(Boolean).join(" ")}function UQ(e){let[s,l]=e.split("-"),d=[];return s&&d.push(s),l&&d.push(l),d}var $Q=e=>{var s,l,d,m,_,w,o,E,P,M,L;let{invert:F,toast:$,unstyled:Y,interacting:H,setHeights:X,visibleToasts:Z,heights:W,index:q,toasts:oe,expanded:ae,removeToast:Ne,defaultRichColors:Pe,closeButton:Le,style:ct,cancelButtonStyle:xt,actionButtonStyle:yt,className:Ht="",descriptionClassName:Dt="",duration:wt,position:rs,gap:Vt,loadingIcon:Bt,expandByDefault:ze,classNames:Xe,icons:Ot,closeButtonAriaLabel:nt="Close toast",pauseWhenPageIsHidden:Mt}=e,[ss,Ps]=vs.useState(null),[xn,Ms]=vs.useState(null),[Xt,It]=vs.useState(!1),[Ns,ws]=vs.useState(!1),[tn,cn]=vs.useState(!1),[wr,cr]=vs.useState(!1),[vn,Js]=vs.useState(!1),[Rr,Jo]=vs.useState(0),[ao,lo]=vs.useState(0),gi=vs.useRef($.duration||wt||ZD),va=vs.useRef(null),Ki=vs.useRef(null),Rl=q===0,hc=q+1<=Z,kr=$.type,xi=$.dismissible!==!1,du=$.className||"",Ba=$.descriptionClassName||"",Va=vs.useMemo(()=>W.findIndex(et=>et.toastId===$.id)||0,[W,$.id]),Pi=vs.useMemo(()=>{var et;return(et=$.closeButton)!=null?et:Le},[$.closeButton,Le]),co=vs.useMemo(()=>$.duration||wt||ZD,[$.duration,wt]),ba=vs.useRef(0),uo=vs.useRef(0),Ua=vs.useRef(0),So=vs.useRef(null),[pc,sr]=rs.split("-"),fc=vs.useMemo(()=>W.reduce((et,er,Dr)=>Dr>=Va?et:et+er.height,0),[W,Va]),mc=EQ(),jo=$.invert||F,kl=kr==="loading";uo.current=vs.useMemo(()=>Va*Vt+fc,[Va,fc]),vs.useEffect(()=>{gi.current=co},[co]),vs.useEffect(()=>{It(!0)},[]),vs.useEffect(()=>{let et=Ki.current;if(et){let er=et.getBoundingClientRect().height;return lo(er),X(Dr=>[{toastId:$.id,height:er,position:$.position},...Dr]),()=>X(Dr=>Dr.filter(Xi=>Xi.toastId!==$.id))}},[X,$.id]),vs.useLayoutEffect(()=>{if(!Xt)return;let et=Ki.current,er=et.style.height;et.style.height="auto";let Dr=et.getBoundingClientRect().height;et.style.height=er,lo(Dr),X(Xi=>Xi.find(Ks=>Ks.toastId===$.id)?Xi.map(Ks=>Ks.toastId===$.id?{...Ks,height:Dr}:Ks):[{toastId:$.id,height:Dr,position:$.position},...Xi])},[Xt,$.title,$.description,X,$.id]);let wa=vs.useCallback(()=>{ws(!0),Jo(uo.current),X(et=>et.filter(er=>er.toastId!==$.id)),setTimeout(()=>{Ne($)},VQ)},[$,Ne,X,uo]);vs.useEffect(()=>{if($.promise&&kr==="loading"||$.duration===1/0||$.type==="loading")return;let et;return ae||H||Mt&&mc?(()=>{if(Ua.current<ba.current){let er=new Date().getTime()-ba.current;gi.current=gi.current-er}Ua.current=new Date().getTime()})():gi.current!==1/0&&(ba.current=new Date().getTime(),et=setTimeout(()=>{var er;(er=$.onAutoClose)==null||er.call($,$),wa()},gi.current)),()=>clearTimeout(et)},[ae,H,$,kr,Mt,mc,wa]),vs.useEffect(()=>{$.delete&&wa()},[wa,$.delete]);function gc(){var et,er,Dr;return Ot!=null&&Ot.loading?vs.createElement("div",{className:ql(Xe==null?void 0:Xe.loader,(et=$==null?void 0:$.classNames)==null?void 0:et.loader,"sonner-loader"),"data-visible":kr==="loading"},Ot.loading):Bt?vs.createElement("div",{className:ql(Xe==null?void 0:Xe.loader,(er=$==null?void 0:$.classNames)==null?void 0:er.loader,"sonner-loader"),"data-visible":kr==="loading"},Bt):vs.createElement(bQ,{className:ql(Xe==null?void 0:Xe.loader,(Dr=$==null?void 0:$.classNames)==null?void 0:Dr.loader),visible:kr==="loading"})}return vs.createElement("li",{tabIndex:0,ref:Ki,className:ql(Ht,du,Xe==null?void 0:Xe.toast,(s=$==null?void 0:$.classNames)==null?void 0:s.toast,Xe==null?void 0:Xe.default,Xe==null?void 0:Xe[kr],(l=$==null?void 0:$.classNames)==null?void 0:l[kr]),"data-sonner-toast":"","data-rich-colors":(d=$.richColors)!=null?d:Pe,"data-styled":!($.jsx||$.unstyled||Y),"data-mounted":Xt,"data-promise":!!$.promise,"data-swiped":vn,"data-removed":Ns,"data-visible":hc,"data-y-position":pc,"data-x-position":sr,"data-index":q,"data-front":Rl,"data-swiping":tn,"data-dismissible":xi,"data-type":kr,"data-invert":jo,"data-swipe-out":wr,"data-swipe-direction":xn,"data-expanded":!!(ae||ze&&Xt),style:{"--index":q,"--toasts-before":q,"--z-index":oe.length-q,"--offset":`${Ns?Rr:uo.current}px`,"--initial-height":ze?"auto":`${ao}px`,...ct,...$.style},onDragEnd:()=>{cn(!1),Ps(null),So.current=null},onPointerDown:et=>{kl||!xi||(va.current=new Date,Jo(uo.current),et.target.setPointerCapture(et.pointerId),et.target.tagName!=="BUTTON"&&(cn(!0),So.current={x:et.clientX,y:et.clientY}))},onPointerUp:()=>{var et,er,Dr,Xi;if(wr||!xi)return;So.current=null;let Ks=Number(((et=Ki.current)==null?void 0:et.style.getPropertyValue("--swipe-amount-x").replace("px",""))||0),Be=Number(((er=Ki.current)==null?void 0:er.style.getPropertyValue("--swipe-amount-y").replace("px",""))||0),ne=new Date().getTime()-((Dr=va.current)==null?void 0:Dr.getTime()),ie=ss==="x"?Ks:Be,fe=Math.abs(ie)/ne;if(Math.abs(ie)>=BQ||fe>.11){Jo(uo.current),(Xi=$.onDismiss)==null||Xi.call($,$),Ms(ss==="x"?Ks>0?"right":"left":Be>0?"down":"up"),wa(),cr(!0),Js(!1);return}cn(!1),Ps(null)},onPointerMove:et=>{var er,Dr,Xi,Ks;if(!So.current||!xi||((er=window.getSelection())==null?void 0:er.toString().length)>0)return;let Be=et.clientY-So.current.y,ne=et.clientX-So.current.x,ie=(Dr=e.swipeDirections)!=null?Dr:UQ(rs);!ss&&(Math.abs(ne)>1||Math.abs(Be)>1)&&Ps(Math.abs(ne)>Math.abs(Be)?"x":"y");let fe={x:0,y:0};ss==="y"?(ie.includes("top")||ie.includes("bottom"))&&(ie.includes("top")&&Be<0||ie.includes("bottom")&&Be>0)&&(fe.y=Be):ss==="x"&&(ie.includes("left")||ie.includes("right"))&&(ie.includes("left")&&ne<0||ie.includes("right")&&ne>0)&&(fe.x=ne),(Math.abs(fe.x)>0||Math.abs(fe.y)>0)&&Js(!0),(Xi=Ki.current)==null||Xi.style.setProperty("--swipe-amount-x",`${fe.x}px`),(Ks=Ki.current)==null||Ks.style.setProperty("--swipe-amount-y",`${fe.y}px`)}},Pi&&!$.jsx?vs.createElement("button",{"aria-label":nt,"data-disabled":kl,"data-close-button":!0,onClick:kl||!xi?()=>{}:()=>{var et;wa(),(et=$.onDismiss)==null||et.call($,$)},className:ql(Xe==null?void 0:Xe.closeButton,(m=$==null?void 0:$.classNames)==null?void 0:m.closeButton)},(_=Ot==null?void 0:Ot.close)!=null?_:NQ):null,$.jsx||z.isValidElement($.title)?$.jsx?$.jsx:typeof $.title=="function"?$.title():$.title:vs.createElement(vs.Fragment,null,kr||$.icon||$.promise?vs.createElement("div",{"data-icon":"",className:ql(Xe==null?void 0:Xe.icon,(w=$==null?void 0:$.classNames)==null?void 0:w.icon)},$.promise||$.type==="loading"&&!$.icon?$.icon||gc():null,$.type!=="loading"?$.icon||(Ot==null?void 0:Ot[kr])||_Q(kr):null):null,vs.createElement("div",{"data-content":"",className:ql(Xe==null?void 0:Xe.content,(o=$==null?void 0:$.classNames)==null?void 0:o.content)},vs.createElement("div",{"data-title":"",className:ql(Xe==null?void 0:Xe.title,(E=$==null?void 0:$.classNames)==null?void 0:E.title)},typeof $.title=="function"?$.title():$.title),$.description?vs.createElement("div",{"data-description":"",className:ql(Dt,Ba,Xe==null?void 0:Xe.description,(P=$==null?void 0:$.classNames)==null?void 0:P.description)},typeof $.description=="function"?$.description():$.description):null),z.isValidElement($.cancel)?$.cancel:$.cancel&&Ub($.cancel)?vs.createElement("button",{"data-button":!0,"data-cancel":!0,style:$.cancelButtonStyle||xt,onClick:et=>{var er,Dr;Ub($.cancel)&&xi&&((Dr=(er=$.cancel).onClick)==null||Dr.call(er,et),wa())},className:ql(Xe==null?void 0:Xe.cancelButton,(M=$==null?void 0:$.classNames)==null?void 0:M.cancelButton)},$.cancel.label):null,z.isValidElement($.action)?$.action:$.action&&Ub($.action)?vs.createElement("button",{"data-button":!0,"data-action":!0,style:$.actionButtonStyle||yt,onClick:et=>{var er,Dr;Ub($.action)&&((Dr=(er=$.action).onClick)==null||Dr.call(er,et),!et.defaultPrevented&&wa())},className:ql(Xe==null?void 0:Xe.actionButton,(L=$==null?void 0:$.classNames)==null?void 0:L.actionButton)},$.action.label):null))};function KD(){if(typeof window>"u"||typeof document>"u")return"ltr";let e=document.documentElement.getAttribute("dir");return e==="auto"||!e?window.getComputedStyle(document.documentElement).direction:e}function GQ(e,s){let l={};return[e,s].forEach((d,m)=>{let _=m===1,w=_?"--mobile-offset":"--offset",o=_?zQ:LQ;function E(P){["top","right","bottom","left"].forEach(M=>{l[`${w}-${M}`]=typeof P=="number"?`${P}px`:P})}typeof d=="number"||typeof d=="string"?E(d):typeof d=="object"?["top","right","bottom","left"].forEach(P=>{d[P]===void 0?l[`${w}-${P}`]=o:l[`${w}-${P}`]=typeof d[P]=="number"?`${d[P]}px`:d[P]}):E(o)}),l}var HQ=z.forwardRef(function(e,s){let{invert:l,position:d="bottom-right",hotkey:m=["altKey","KeyT"],expand:_,closeButton:w,className:o,offset:E,mobileOffset:P,theme:M="light",richColors:L,duration:F,style:$,visibleToasts:Y=DQ,toastOptions:H,dir:X=KD(),gap:Z=FQ,loadingIcon:W,icons:q,containerAriaLabel:oe="Notifications",pauseWhenPageIsHidden:ae}=e,[Ne,Pe]=vs.useState([]),Le=vs.useMemo(()=>Array.from(new Set([d].concat(Ne.filter(Mt=>Mt.position).map(Mt=>Mt.position)))),[Ne,d]),[ct,xt]=vs.useState([]),[yt,Ht]=vs.useState(!1),[Dt,wt]=vs.useState(!1),[rs,Vt]=vs.useState(M!=="system"?M:typeof window<"u"&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light"),Bt=vs.useRef(null),ze=m.join("+").replace(/Key/g,"").replace(/Digit/g,""),Xe=vs.useRef(null),Ot=vs.useRef(!1),nt=vs.useCallback(Mt=>{Pe(ss=>{var Ps;return(Ps=ss.find(xn=>xn.id===Mt.id))!=null&&Ps.delete||Ia.dismiss(Mt.id),ss.filter(({id:xn})=>xn!==Mt.id)})},[]);return vs.useEffect(()=>Ia.subscribe(Mt=>{if(Mt.dismiss){Pe(ss=>ss.map(Ps=>Ps.id===Mt.id?{...Ps,delete:!0}:Ps));return}setTimeout(()=>{aF.flushSync(()=>{Pe(ss=>{let Ps=ss.findIndex(xn=>xn.id===Mt.id);return Ps!==-1?[...ss.slice(0,Ps),{...ss[Ps],...Mt},...ss.slice(Ps+1)]:[Mt,...ss]})})})}),[]),vs.useEffect(()=>{if(M!=="system"){Vt(M);return}if(M==="system"&&(window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches?Vt("dark"):Vt("light")),typeof window>"u")return;let Mt=window.matchMedia("(prefers-color-scheme: dark)");try{Mt.addEventListener("change",({matches:ss})=>{Vt(ss?"dark":"light")})}catch{Mt.addListener(({matches:Ps})=>{try{Vt(Ps?"dark":"light")}catch(xn){console.error(xn)}})}},[M]),vs.useEffect(()=>{Ne.length<=1&&Ht(!1)},[Ne]),vs.useEffect(()=>{let Mt=ss=>{var Ps,xn;m.every(Ms=>ss[Ms]||ss.code===Ms)&&(Ht(!0),(Ps=Bt.current)==null||Ps.focus()),ss.code==="Escape"&&(document.activeElement===Bt.current||(xn=Bt.current)!=null&&xn.contains(document.activeElement))&&Ht(!1)};return document.addEventListener("keydown",Mt),()=>document.removeEventListener("keydown",Mt)},[m]),vs.useEffect(()=>{if(Bt.current)return()=>{Xe.current&&(Xe.current.focus({preventScroll:!0}),Xe.current=null,Ot.current=!1)}},[Bt.current]),vs.createElement("section",{ref:s,"aria-label":`${oe} ${ze}`,tabIndex:-1,"aria-live":"polite","aria-relevant":"additions text","aria-atomic":"false",suppressHydrationWarning:!0},Le.map((Mt,ss)=>{var Ps;let[xn,Ms]=Mt.split("-");return Ne.length?vs.createElement("ol",{key:Mt,dir:X==="auto"?KD():X,tabIndex:-1,ref:Bt,className:o,"data-sonner-toaster":!0,"data-theme":rs,"data-y-position":xn,"data-lifted":yt&&Ne.length>1&&!_,"data-x-position":Ms,style:{"--front-toast-height":`${((Ps=ct[0])==null?void 0:Ps.height)||0}px`,"--width":`${OQ}px`,"--gap":`${Z}px`,...$,...GQ(E,P)},onBlur:Xt=>{Ot.current&&!Xt.currentTarget.contains(Xt.relatedTarget)&&(Ot.current=!1,Xe.current&&(Xe.current.focus({preventScroll:!0}),Xe.current=null))},onFocus:Xt=>{Xt.target instanceof HTMLElement&&Xt.target.dataset.dismissible==="false"||Ot.current||(Ot.current=!0,Xe.current=Xt.relatedTarget)},onMouseEnter:()=>Ht(!0),onMouseMove:()=>Ht(!0),onMouseLeave:()=>{Dt||Ht(!1)},onDragEnd:()=>Ht(!1),onPointerDown:Xt=>{Xt.target instanceof HTMLElement&&Xt.target.dataset.dismissible==="false"||wt(!0)},onPointerUp:()=>wt(!1)},Ne.filter(Xt=>!Xt.position&&ss===0||Xt.position===Mt).map((Xt,It)=>{var Ns,ws;return vs.createElement($Q,{key:Xt.id,icons:q,index:It,toast:Xt,defaultRichColors:L,duration:(Ns=H==null?void 0:H.duration)!=null?Ns:F,className:H==null?void 0:H.className,descriptionClassName:H==null?void 0:H.descriptionClassName,invert:l,visibleToasts:Y,closeButton:(ws=H==null?void 0:H.closeButton)!=null?ws:w,interacting:Dt,position:Mt,style:H==null?void 0:H.style,unstyled:H==null?void 0:H.unstyled,classNames:H==null?void 0:H.classNames,cancelButtonStyle:H==null?void 0:H.cancelButtonStyle,actionButtonStyle:H==null?void 0:H.actionButtonStyle,removeToast:nt,toasts:Ne.filter(tn=>tn.position==Xt.position),heights:ct.filter(tn=>tn.position==Xt.position),setHeights:xt,expandByDefault:_,gap:Z,loadingIcon:W,expanded:yt,pauseWhenPageIsHidden:ae,swipeDirections:e.swipeDirections})})):null}))});const WQ=({...e})=>{const{theme:s="system"}=yQ();return n.jsx(HQ,{theme:s,className:"toaster group",toastOptions:{classNames:{toast:"group toast group-[.toaster]:bg-background group-[.toaster]:text-foreground group-[.toaster]:border-border group-[.toaster]:shadow-lg",description:"group-[.toast]:text-muted-foreground",actionButton:"group-[.toast]:bg-primary group-[.toast]:text-primary-foreground",cancelButton:"group-[.toast]:bg-muted group-[.toast]:text-muted-foreground"}},...e})},WA=ev("inline-flex items-center justify-center gap-2 whitespace-nowrap rounded-md text-sm font-medium ring-offset-background transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 [&_svg]:pointer-events-none [&_svg]:size-4 [&_svg]:shrink-0",{variants:{variant:{default:"bg-primary text-primary-foreground hover:bg-primary/90",destructive:"bg-destructive text-destructive-foreground hover:bg-destructive/90",outline:"border border-input bg-background hover:bg-accent hover:text-accent-foreground",secondary:"bg-secondary text-secondary-foreground hover:bg-secondary/80",ghost:"hover:bg-accent hover:text-accent-foreground",link:"text-primary underline-offset-4 hover:underline"},size:{default:"h-10 px-4 py-2",sm:"h-9 rounded-md px-3",lg:"h-11 rounded-md px-8",icon:"h-10 w-10"}},defaultVariants:{variant:"default",size:"default"}}),dt=z.forwardRef(({className:e,variant:s,size:l,asChild:d=!1,...m},_)=>{const w=d?bK:"button";return n.jsx(w,{className:Ds(WA({variant:s,size:l,className:e})),ref:_,...m})});dt.displayName="Button";const qQ=({id:e,type:s,title:l,description:d,duration:m=5e3,onClose:_})=>{const[w,o]=z.useState(!1);z.useEffect(()=>{if(o(!0),s!=="loading"&&m>0){const L=setTimeout(()=>{E()},m);return()=>clearTimeout(L)}},[m,s]);const E=()=>{o(!1),setTimeout(()=>_(e),300)},P=()=>{switch(s){case"success":return n.jsx(dr,{className:"h-5 w-5 text-success"});case"error":return n.jsx(tu,{className:"h-5 w-5 text-destructive"});case"warning":return n.jsx(rl,{className:"h-5 w-5 text-warning"});case"loading":return n.jsx(XJ,{className:"h-5 w-5 text-primary animate-spin"})}},M=()=>{switch(s){case"success":return"border-success/20 bg-success/5";case"error":return"border-destructive/20 bg-destructive/5";case"warning":return"border-warning/20 bg-warning/5";case"loading":return"border-primary/20 bg-primary/5"}};return n.jsxs("div",{className:`flex items-start gap-3 p-4 rounded-lg border backdrop-blur-sm transition-all duration-300 ${M()} ${w?"opacity-100 translate-x-0":"opacity-0 translate-x-full"}`,children:[n.jsx("div",{className:"flex-shrink-0 mt-0.5",children:P()}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"text-sm font-semibold text-card-foreground",children:l}),d&&n.jsx("p",{className:"text-sm text-muted-foreground mt-1",children:d})]}),s!=="loading"&&n.jsx(dt,{variant:"ghost",size:"icon",className:"h-6 w-6 flex-shrink-0",onClick:E,children:n.jsx(ol,{className:"h-4 w-4"})})]})},q5=z.createContext(void 0),Z5=()=>{const e=z.useContext(q5);if(!e)throw new Error("useToast must be used within a ToastProvider");return e},ZQ=({children:e})=>{const[s,l]=z.useState([]),d=P=>{const M=Date.now().toString();return l(L=>[...L,{...P,id:M}]),M},m=(P,M)=>{d({type:"success",title:P,description:M})},_=(P,M)=>{d({type:"error",title:P,description:M})},w=(P,M)=>{d({type:"warning",title:P,description:M})},o=(P,M)=>d({type:"loading",title:P,description:M,duration:0}),E=P=>{l(M=>M.filter(L=>L.id!==P))};return n.jsxs(q5.Provider,{value:{showToast:d,showSuccess:m,showError:_,showWarning:w,showLoading:o,hideToast:E},children:[e,n.jsx("div",{className:"fixed top-4 right-4 z-50 space-y-2 max-w-sm w-full",children:s.map(P=>n.jsx(qQ,{...P,onClose:E},P.id))})]})};function K5(e,s){return function(){return e.apply(s,arguments)}}const{toString:KQ}=Object.prototype,{getPrototypeOf:qA}=Object,{iterator:X2,toStringTag:X5}=Symbol,Y2=(e=>s=>{const l=KQ.call(s);return e[l]||(e[l]=l.slice(8,-1).toLowerCase())})(Object.create(null)),uc=e=>(e=e.toLowerCase(),s=>Y2(s)===e),J2=e=>s=>typeof s===e,{isArray:Sx}=Array,D0=J2("undefined");function nv(e){return e!==null&&!D0(e)&&e.constructor!==null&&!D0(e.constructor)&&Oa(e.constructor.isBuffer)&&e.constructor.isBuffer(e)}const Y5=uc("ArrayBuffer");function XQ(e){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(e):s=e&&e.buffer&&Y5(e.buffer),s}const YQ=J2("string"),Oa=J2("function"),J5=J2("number"),rv=e=>e!==null&&typeof e=="object",JQ=e=>e===!0||e===!1,hw=e=>{if(Y2(e)!=="object")return!1;const s=qA(e);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(X5 in e)&&!(X2 in e)},QQ=e=>{if(!rv(e)||nv(e))return!1;try{return Object.keys(e).length===0&&Object.getPrototypeOf(e)===Object.prototype}catch{return!1}},eee=uc("Date"),tee=uc("File"),see=uc("Blob"),nee=uc("FileList"),ree=e=>rv(e)&&Oa(e.pipe),iee=e=>{let s;return e&&(typeof FormData=="function"&&e instanceof FormData||Oa(e.append)&&((s=Y2(e))==="formdata"||s==="object"&&Oa(e.toString)&&e.toString()==="[object FormData]"))},oee=uc("URLSearchParams"),[aee,lee,cee,uee]=["ReadableStream","Request","Response","Headers"].map(uc),dee=e=>e.trim?e.trim():e.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function iv(e,s,{allOwnKeys:l=!1}={}){if(e===null||typeof e>"u")return;let d,m;if(typeof e!="object"&&(e=[e]),Sx(e))for(d=0,m=e.length;d<m;d++)s.call(null,e[d],d,e);else{if(nv(e))return;const _=l?Object.getOwnPropertyNames(e):Object.keys(e),w=_.length;let o;for(d=0;d<w;d++)o=_[d],s.call(null,e[o],o,e)}}function Q5(e,s){if(nv(e))return null;s=s.toLowerCase();const l=Object.keys(e);let d=l.length,m;for(;d-- >0;)if(m=l[d],s===m.toLowerCase())return m;return null}const Yp=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,eB=e=>!D0(e)&&e!==Yp;function FE(){const{caseless:e}=eB(this)&&this||{},s={},l=(d,m)=>{const _=e&&Q5(s,m)||m;hw(s[_])&&hw(d)?s[_]=FE(s[_],d):hw(d)?s[_]=FE({},d):Sx(d)?s[_]=d.slice():s[_]=d};for(let d=0,m=arguments.length;d<m;d++)arguments[d]&&iv(arguments[d],l);return s}const hee=(e,s,l,{allOwnKeys:d}={})=>(iv(s,(m,_)=>{l&&Oa(m)?e[_]=K5(m,l):e[_]=m},{allOwnKeys:d}),e),pee=e=>(e.charCodeAt(0)===65279&&(e=e.slice(1)),e),fee=(e,s,l,d)=>{e.prototype=Object.create(s.prototype,d),e.prototype.constructor=e,Object.defineProperty(e,"super",{value:s.prototype}),l&&Object.assign(e.prototype,l)},mee=(e,s,l,d)=>{let m,_,w;const o={};if(s=s||{},e==null)return s;do{for(m=Object.getOwnPropertyNames(e),_=m.length;_-- >0;)w=m[_],(!d||d(w,e,s))&&!o[w]&&(s[w]=e[w],o[w]=!0);e=l!==!1&&qA(e)}while(e&&(!l||l(e,s))&&e!==Object.prototype);return s},gee=(e,s,l)=>{e=String(e),(l===void 0||l>e.length)&&(l=e.length),l-=s.length;const d=e.indexOf(s,l);return d!==-1&&d===l},xee=e=>{if(!e)return null;if(Sx(e))return e;let s=e.length;if(!J5(s))return null;const l=new Array(s);for(;s-- >0;)l[s]=e[s];return l},yee=(e=>s=>e&&s instanceof e)(typeof Uint8Array<"u"&&qA(Uint8Array)),_ee=(e,s)=>{const d=(e&&e[X2]).call(e);let m;for(;(m=d.next())&&!m.done;){const _=m.value;s.call(e,_[0],_[1])}},vee=(e,s)=>{let l;const d=[];for(;(l=e.exec(s))!==null;)d.push(l);return d},bee=uc("HTMLFormElement"),wee=e=>e.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(l,d,m){return d.toUpperCase()+m}),XD=(({hasOwnProperty:e})=>(s,l)=>e.call(s,l))(Object.prototype),See=uc("RegExp"),tB=(e,s)=>{const l=Object.getOwnPropertyDescriptors(e),d={};iv(l,(m,_)=>{let w;(w=s(m,_,e))!==!1&&(d[_]=w||m)}),Object.defineProperties(e,d)},jee=e=>{tB(e,(s,l)=>{if(Oa(e)&&["arguments","caller","callee"].indexOf(l)!==-1)return!1;const d=e[l];if(Oa(d)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+l+"'")})}})},Tee=(e,s)=>{const l={},d=m=>{m.forEach(_=>{l[_]=!0})};return Sx(e)?d(e):d(String(e).split(s)),l},Nee=()=>{},Eee=(e,s)=>e!=null&&Number.isFinite(e=+e)?e:s;function Cee(e){return!!(e&&Oa(e.append)&&e[X5]==="FormData"&&e[X2])}const Aee=e=>{const s=new Array(10),l=(d,m)=>{if(rv(d)){if(s.indexOf(d)>=0)return;if(nv(d))return d;if(!("toJSON"in d)){s[m]=d;const _=Sx(d)?[]:{};return iv(d,(w,o)=>{const E=l(w,m+1);!D0(E)&&(_[o]=E)}),s[m]=void 0,_}}return d};return l(e,0)},Pee=uc("AsyncFunction"),Iee=e=>e&&(rv(e)||Oa(e))&&Oa(e.then)&&Oa(e.catch),sB=((e,s)=>e?setImmediate:s?((l,d)=>(Yp.addEventListener("message",({source:m,data:_})=>{m===Yp&&_===l&&d.length&&d.shift()()},!1),m=>{d.push(m),Yp.postMessage(l,"*")}))(`axios@${Math.random()}`,[]):l=>setTimeout(l))(typeof setImmediate=="function",Oa(Yp.postMessage)),Mee=typeof queueMicrotask<"u"?queueMicrotask.bind(Yp):typeof process<"u"&&process.nextTick||sB,Ree=e=>e!=null&&Oa(e[X2]),Lt={isArray:Sx,isArrayBuffer:Y5,isBuffer:nv,isFormData:iee,isArrayBufferView:XQ,isString:YQ,isNumber:J5,isBoolean:JQ,isObject:rv,isPlainObject:hw,isEmptyObject:QQ,isReadableStream:aee,isRequest:lee,isResponse:cee,isHeaders:uee,isUndefined:D0,isDate:eee,isFile:tee,isBlob:see,isRegExp:See,isFunction:Oa,isStream:ree,isURLSearchParams:oee,isTypedArray:yee,isFileList:nee,forEach:iv,merge:FE,extend:hee,trim:dee,stripBOM:pee,inherits:fee,toFlatObject:mee,kindOf:Y2,kindOfTest:uc,endsWith:gee,toArray:xee,forEachEntry:_ee,matchAll:vee,isHTMLForm:bee,hasOwnProperty:XD,hasOwnProp:XD,reduceDescriptors:tB,freezeMethods:jee,toObjectSet:Tee,toCamelCase:wee,noop:Nee,toFiniteNumber:Eee,findKey:Q5,global:Yp,isContextDefined:eB,isSpecCompliantForm:Cee,toJSONObject:Aee,isAsyncFn:Pee,isThenable:Iee,setImmediate:sB,asap:Mee,isIterable:Ree};function Wn(e,s,l,d,m){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=e,this.name="AxiosError",s&&(this.code=s),l&&(this.config=l),d&&(this.request=d),m&&(this.response=m,this.status=m.status?m.status:null)}Lt.inherits(Wn,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Lt.toJSONObject(this.config),code:this.code,status:this.status}}});const nB=Wn.prototype,rB={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(e=>{rB[e]={value:e}});Object.defineProperties(Wn,rB);Object.defineProperty(nB,"isAxiosError",{value:!0});Wn.from=(e,s,l,d,m,_)=>{const w=Object.create(nB);return Lt.toFlatObject(e,w,function(E){return E!==Error.prototype},o=>o!=="isAxiosError"),Wn.call(w,e.message,s,l,d,m),w.cause=e,w.name=e.name,_&&Object.assign(w,_),w};const kee=null;function BE(e){return Lt.isPlainObject(e)||Lt.isArray(e)}function iB(e){return Lt.endsWith(e,"[]")?e.slice(0,-2):e}function YD(e,s,l){return e?e.concat(s).map(function(m,_){return m=iB(m),!l&&_?"["+m+"]":m}).join(l?".":""):s}function Dee(e){return Lt.isArray(e)&&!e.some(BE)}const Lee=Lt.toFlatObject(Lt,{},null,function(s){return/^is[A-Z]/.test(s)});function Q2(e,s,l){if(!Lt.isObject(e))throw new TypeError("target must be an object");s=s||new FormData,l=Lt.toFlatObject(l,{metaTokens:!0,dots:!1,indexes:!1},!1,function(H,X){return!Lt.isUndefined(X[H])});const d=l.metaTokens,m=l.visitor||M,_=l.dots,w=l.indexes,E=(l.Blob||typeof Blob<"u"&&Blob)&&Lt.isSpecCompliantForm(s);if(!Lt.isFunction(m))throw new TypeError("visitor must be a function");function P(Y){if(Y===null)return"";if(Lt.isDate(Y))return Y.toISOString();if(Lt.isBoolean(Y))return Y.toString();if(!E&&Lt.isBlob(Y))throw new Wn("Blob is not supported. Use a Buffer instead.");return Lt.isArrayBuffer(Y)||Lt.isTypedArray(Y)?E&&typeof Blob=="function"?new Blob([Y]):Buffer.from(Y):Y}function M(Y,H,X){let Z=Y;if(Y&&!X&&typeof Y=="object"){if(Lt.endsWith(H,"{}"))H=d?H:H.slice(0,-2),Y=JSON.stringify(Y);else if(Lt.isArray(Y)&&Dee(Y)||(Lt.isFileList(Y)||Lt.endsWith(H,"[]"))&&(Z=Lt.toArray(Y)))return H=iB(H),Z.forEach(function(q,oe){!(Lt.isUndefined(q)||q===null)&&s.append(w===!0?YD([H],oe,_):w===null?H:H+"[]",P(q))}),!1}return BE(Y)?!0:(s.append(YD(X,H,_),P(Y)),!1)}const L=[],F=Object.assign(Lee,{defaultVisitor:M,convertValue:P,isVisitable:BE});function $(Y,H){if(!Lt.isUndefined(Y)){if(L.indexOf(Y)!==-1)throw Error("Circular reference detected in "+H.join("."));L.push(Y),Lt.forEach(Y,function(Z,W){(!(Lt.isUndefined(Z)||Z===null)&&m.call(s,Z,Lt.isString(W)?W.trim():W,H,F))===!0&&$(Z,H?H.concat(W):[W])}),L.pop()}}if(!Lt.isObject(e))throw new TypeError("data must be an object");return $(e),s}function JD(e){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(e).replace(/[!'()~]|%20|%00/g,function(d){return s[d]})}function ZA(e,s){this._pairs=[],e&&Q2(e,this,s)}const oB=ZA.prototype;oB.append=function(s,l){this._pairs.push([s,l])};oB.toString=function(s){const l=s?function(d){return s.call(this,d,JD)}:JD;return this._pairs.map(function(m){return l(m[0])+"="+l(m[1])},"").join("&")};function zee(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function aB(e,s,l){if(!s)return e;const d=l&&l.encode||zee;Lt.isFunction(l)&&(l={serialize:l});const m=l&&l.serialize;let _;if(m?_=m(s,l):_=Lt.isURLSearchParams(s)?s.toString():new ZA(s,l).toString(d),_){const w=e.indexOf("#");w!==-1&&(e=e.slice(0,w)),e+=(e.indexOf("?")===-1?"?":"&")+_}return e}class QD{constructor(){this.handlers=[]}use(s,l,d){return this.handlers.push({fulfilled:s,rejected:l,synchronous:d?d.synchronous:!1,runWhen:d?d.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){Lt.forEach(this.handlers,function(d){d!==null&&s(d)})}}const lB={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},Oee=typeof URLSearchParams<"u"?URLSearchParams:ZA,Fee=typeof FormData<"u"?FormData:null,Bee=typeof Blob<"u"?Blob:null,Vee={isBrowser:!0,classes:{URLSearchParams:Oee,FormData:Fee,Blob:Bee},protocols:["http","https","file","blob","url","data"]},KA=typeof window<"u"&&typeof document<"u",VE=typeof navigator=="object"&&navigator||void 0,Uee=KA&&(!VE||["ReactNative","NativeScript","NS"].indexOf(VE.product)<0),$ee=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",Gee=KA&&window.location.href||"http://localhost",Hee=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:KA,hasStandardBrowserEnv:Uee,hasStandardBrowserWebWorkerEnv:$ee,navigator:VE,origin:Gee},Symbol.toStringTag,{value:"Module"})),Wo={...Hee,...Vee};function Wee(e,s){return Q2(e,new Wo.classes.URLSearchParams,{visitor:function(l,d,m,_){return Wo.isNode&&Lt.isBuffer(l)?(this.append(d,l.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)},...s})}function qee(e){return Lt.matchAll(/\w+|\[(\w*)]/g,e).map(s=>s[0]==="[]"?"":s[1]||s[0])}function Zee(e){const s={},l=Object.keys(e);let d;const m=l.length;let _;for(d=0;d<m;d++)_=l[d],s[_]=e[_];return s}function cB(e){function s(l,d,m,_){let w=l[_++];if(w==="__proto__")return!0;const o=Number.isFinite(+w),E=_>=l.length;return w=!w&&Lt.isArray(m)?m.length:w,E?(Lt.hasOwnProp(m,w)?m[w]=[m[w],d]:m[w]=d,!o):((!m[w]||!Lt.isObject(m[w]))&&(m[w]=[]),s(l,d,m[w],_)&&Lt.isArray(m[w])&&(m[w]=Zee(m[w])),!o)}if(Lt.isFormData(e)&&Lt.isFunction(e.entries)){const l={};return Lt.forEachEntry(e,(d,m)=>{s(qee(d),m,l,0)}),l}return null}function Kee(e,s,l){if(Lt.isString(e))try{return(s||JSON.parse)(e),Lt.trim(e)}catch(d){if(d.name!=="SyntaxError")throw d}return(0,JSON.stringify)(e)}const ov={transitional:lB,adapter:["xhr","http","fetch"],transformRequest:[function(s,l){const d=l.getContentType()||"",m=d.indexOf("application/json")>-1,_=Lt.isObject(s);if(_&&Lt.isHTMLForm(s)&&(s=new FormData(s)),Lt.isFormData(s))return m?JSON.stringify(cB(s)):s;if(Lt.isArrayBuffer(s)||Lt.isBuffer(s)||Lt.isStream(s)||Lt.isFile(s)||Lt.isBlob(s)||Lt.isReadableStream(s))return s;if(Lt.isArrayBufferView(s))return s.buffer;if(Lt.isURLSearchParams(s))return l.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let o;if(_){if(d.indexOf("application/x-www-form-urlencoded")>-1)return Wee(s,this.formSerializer).toString();if((o=Lt.isFileList(s))||d.indexOf("multipart/form-data")>-1){const E=this.env&&this.env.FormData;return Q2(o?{"files[]":s}:s,E&&new E,this.formSerializer)}}return _||m?(l.setContentType("application/json",!1),Kee(s)):s}],transformResponse:[function(s){const l=this.transitional||ov.transitional,d=l&&l.forcedJSONParsing,m=this.responseType==="json";if(Lt.isResponse(s)||Lt.isReadableStream(s))return s;if(s&&Lt.isString(s)&&(d&&!this.responseType||m)){const w=!(l&&l.silentJSONParsing)&&m;try{return JSON.parse(s)}catch(o){if(w)throw o.name==="SyntaxError"?Wn.from(o,Wn.ERR_BAD_RESPONSE,this,null,this.response):o}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Wo.classes.FormData,Blob:Wo.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Lt.forEach(["delete","get","head","post","put","patch"],e=>{ov.headers[e]={}});const Xee=Lt.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),Yee=e=>{const s={};let l,d,m;return e&&e.split(`
`).forEach(function(w){m=w.indexOf(":"),l=w.substring(0,m).trim().toLowerCase(),d=w.substring(m+1).trim(),!(!l||s[l]&&Xee[l])&&(l==="set-cookie"?s[l]?s[l].push(d):s[l]=[d]:s[l]=s[l]?s[l]+", "+d:d)}),s},eL=Symbol("internals");function B_(e){return e&&String(e).trim().toLowerCase()}function pw(e){return e===!1||e==null?e:Lt.isArray(e)?e.map(pw):String(e)}function Jee(e){const s=Object.create(null),l=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let d;for(;d=l.exec(e);)s[d[1]]=d[2];return s}const Qee=e=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(e.trim());function eN(e,s,l,d,m){if(Lt.isFunction(d))return d.call(this,s,l);if(m&&(s=l),!!Lt.isString(s)){if(Lt.isString(d))return s.indexOf(d)!==-1;if(Lt.isRegExp(d))return d.test(s)}}function ete(e){return e.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,l,d)=>l.toUpperCase()+d)}function tte(e,s){const l=Lt.toCamelCase(" "+s);["get","set","has"].forEach(d=>{Object.defineProperty(e,d+l,{value:function(m,_,w){return this[d].call(this,s,m,_,w)},configurable:!0})})}class Fa{constructor(s){s&&this.set(s)}set(s,l,d){const m=this;function _(o,E,P){const M=B_(E);if(!M)throw new Error("header name must be a non-empty string");const L=Lt.findKey(m,M);(!L||m[L]===void 0||P===!0||P===void 0&&m[L]!==!1)&&(m[L||E]=pw(o))}const w=(o,E)=>Lt.forEach(o,(P,M)=>_(P,M,E));if(Lt.isPlainObject(s)||s instanceof this.constructor)w(s,l);else if(Lt.isString(s)&&(s=s.trim())&&!Qee(s))w(Yee(s),l);else if(Lt.isObject(s)&&Lt.isIterable(s)){let o={},E,P;for(const M of s){if(!Lt.isArray(M))throw TypeError("Object iterator must return a key-value pair");o[P=M[0]]=(E=o[P])?Lt.isArray(E)?[...E,M[1]]:[E,M[1]]:M[1]}w(o,l)}else s!=null&&_(l,s,d);return this}get(s,l){if(s=B_(s),s){const d=Lt.findKey(this,s);if(d){const m=this[d];if(!l)return m;if(l===!0)return Jee(m);if(Lt.isFunction(l))return l.call(this,m,d);if(Lt.isRegExp(l))return l.exec(m);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,l){if(s=B_(s),s){const d=Lt.findKey(this,s);return!!(d&&this[d]!==void 0&&(!l||eN(this,this[d],d,l)))}return!1}delete(s,l){const d=this;let m=!1;function _(w){if(w=B_(w),w){const o=Lt.findKey(d,w);o&&(!l||eN(d,d[o],o,l))&&(delete d[o],m=!0)}}return Lt.isArray(s)?s.forEach(_):_(s),m}clear(s){const l=Object.keys(this);let d=l.length,m=!1;for(;d--;){const _=l[d];(!s||eN(this,this[_],_,s,!0))&&(delete this[_],m=!0)}return m}normalize(s){const l=this,d={};return Lt.forEach(this,(m,_)=>{const w=Lt.findKey(d,_);if(w){l[w]=pw(m),delete l[_];return}const o=s?ete(_):String(_).trim();o!==_&&delete l[_],l[o]=pw(m),d[o]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const l=Object.create(null);return Lt.forEach(this,(d,m)=>{d!=null&&d!==!1&&(l[m]=s&&Lt.isArray(d)?d.join(", "):d)}),l}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,l])=>s+": "+l).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...l){const d=new this(s);return l.forEach(m=>d.set(m)),d}static accessor(s){const d=(this[eL]=this[eL]={accessors:{}}).accessors,m=this.prototype;function _(w){const o=B_(w);d[o]||(tte(m,w),d[o]=!0)}return Lt.isArray(s)?s.forEach(_):_(s),this}}Fa.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Lt.reduceDescriptors(Fa.prototype,({value:e},s)=>{let l=s[0].toUpperCase()+s.slice(1);return{get:()=>e,set(d){this[l]=d}}});Lt.freezeMethods(Fa);function tN(e,s){const l=this||ov,d=s||l,m=Fa.from(d.headers);let _=d.data;return Lt.forEach(e,function(o){_=o.call(l,_,m.normalize(),s?s.status:void 0)}),m.normalize(),_}function uB(e){return!!(e&&e.__CANCEL__)}function jx(e,s,l){Wn.call(this,e??"canceled",Wn.ERR_CANCELED,s,l),this.name="CanceledError"}Lt.inherits(jx,Wn,{__CANCEL__:!0});function dB(e,s,l){const d=l.config.validateStatus;!l.status||!d||d(l.status)?e(l):s(new Wn("Request failed with status code "+l.status,[Wn.ERR_BAD_REQUEST,Wn.ERR_BAD_RESPONSE][Math.floor(l.status/100)-4],l.config,l.request,l))}function ste(e){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return s&&s[1]||""}function nte(e,s){e=e||10;const l=new Array(e),d=new Array(e);let m=0,_=0,w;return s=s!==void 0?s:1e3,function(E){const P=Date.now(),M=d[_];w||(w=P),l[m]=E,d[m]=P;let L=_,F=0;for(;L!==m;)F+=l[L++],L=L%e;if(m=(m+1)%e,m===_&&(_=(_+1)%e),P-w<s)return;const $=M&&P-M;return $?Math.round(F*1e3/$):void 0}}function rte(e,s){let l=0,d=1e3/s,m,_;const w=(P,M=Date.now())=>{l=M,m=null,_&&(clearTimeout(_),_=null),e(...P)};return[(...P)=>{const M=Date.now(),L=M-l;L>=d?w(P,M):(m=P,_||(_=setTimeout(()=>{_=null,w(m)},d-L)))},()=>m&&w(m)]}const s2=(e,s,l=3)=>{let d=0;const m=nte(50,250);return rte(_=>{const w=_.loaded,o=_.lengthComputable?_.total:void 0,E=w-d,P=m(E),M=w<=o;d=w;const L={loaded:w,total:o,progress:o?w/o:void 0,bytes:E,rate:P||void 0,estimated:P&&o&&M?(o-w)/P:void 0,event:_,lengthComputable:o!=null,[s?"download":"upload"]:!0};e(L)},l)},tL=(e,s)=>{const l=e!=null;return[d=>s[0]({lengthComputable:l,total:e,loaded:d}),s[1]]},sL=e=>(...s)=>Lt.asap(()=>e(...s)),ite=Wo.hasStandardBrowserEnv?((e,s)=>l=>(l=new URL(l,Wo.origin),e.protocol===l.protocol&&e.host===l.host&&(s||e.port===l.port)))(new URL(Wo.origin),Wo.navigator&&/(msie|trident)/i.test(Wo.navigator.userAgent)):()=>!0,ote=Wo.hasStandardBrowserEnv?{write(e,s,l,d,m,_){const w=[e+"="+encodeURIComponent(s)];Lt.isNumber(l)&&w.push("expires="+new Date(l).toGMTString()),Lt.isString(d)&&w.push("path="+d),Lt.isString(m)&&w.push("domain="+m),_===!0&&w.push("secure"),document.cookie=w.join("; ")},read(e){const s=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return s?decodeURIComponent(s[3]):null},remove(e){this.write(e,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function ate(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)}function lte(e,s){return s?e.replace(/\/?\/$/,"")+"/"+s.replace(/^\/+/,""):e}function hB(e,s,l){let d=!ate(s);return e&&(d||l==!1)?lte(e,s):s}const nL=e=>e instanceof Fa?{...e}:e;function bf(e,s){s=s||{};const l={};function d(P,M,L,F){return Lt.isPlainObject(P)&&Lt.isPlainObject(M)?Lt.merge.call({caseless:F},P,M):Lt.isPlainObject(M)?Lt.merge({},M):Lt.isArray(M)?M.slice():M}function m(P,M,L,F){if(Lt.isUndefined(M)){if(!Lt.isUndefined(P))return d(void 0,P,L,F)}else return d(P,M,L,F)}function _(P,M){if(!Lt.isUndefined(M))return d(void 0,M)}function w(P,M){if(Lt.isUndefined(M)){if(!Lt.isUndefined(P))return d(void 0,P)}else return d(void 0,M)}function o(P,M,L){if(L in s)return d(P,M);if(L in e)return d(void 0,P)}const E={url:_,method:_,data:_,baseURL:w,transformRequest:w,transformResponse:w,paramsSerializer:w,timeout:w,timeoutMessage:w,withCredentials:w,withXSRFToken:w,adapter:w,responseType:w,xsrfCookieName:w,xsrfHeaderName:w,onUploadProgress:w,onDownloadProgress:w,decompress:w,maxContentLength:w,maxBodyLength:w,beforeRedirect:w,transport:w,httpAgent:w,httpsAgent:w,cancelToken:w,socketPath:w,responseEncoding:w,validateStatus:o,headers:(P,M,L)=>m(nL(P),nL(M),L,!0)};return Lt.forEach(Object.keys({...e,...s}),function(M){const L=E[M]||m,F=L(e[M],s[M],M);Lt.isUndefined(F)&&L!==o||(l[M]=F)}),l}const pB=e=>{const s=bf({},e);let{data:l,withXSRFToken:d,xsrfHeaderName:m,xsrfCookieName:_,headers:w,auth:o}=s;s.headers=w=Fa.from(w),s.url=aB(hB(s.baseURL,s.url,s.allowAbsoluteUrls),e.params,e.paramsSerializer),o&&w.set("Authorization","Basic "+btoa((o.username||"")+":"+(o.password?unescape(encodeURIComponent(o.password)):"")));let E;if(Lt.isFormData(l)){if(Wo.hasStandardBrowserEnv||Wo.hasStandardBrowserWebWorkerEnv)w.setContentType(void 0);else if((E=w.getContentType())!==!1){const[P,...M]=E?E.split(";").map(L=>L.trim()).filter(Boolean):[];w.setContentType([P||"multipart/form-data",...M].join("; "))}}if(Wo.hasStandardBrowserEnv&&(d&&Lt.isFunction(d)&&(d=d(s)),d||d!==!1&&ite(s.url))){const P=m&&_&&ote.read(_);P&&w.set(m,P)}return s},cte=typeof XMLHttpRequest<"u",ute=cte&&function(e){return new Promise(function(l,d){const m=pB(e);let _=m.data;const w=Fa.from(m.headers).normalize();let{responseType:o,onUploadProgress:E,onDownloadProgress:P}=m,M,L,F,$,Y;function H(){$&&$(),Y&&Y(),m.cancelToken&&m.cancelToken.unsubscribe(M),m.signal&&m.signal.removeEventListener("abort",M)}let X=new XMLHttpRequest;X.open(m.method.toUpperCase(),m.url,!0),X.timeout=m.timeout;function Z(){if(!X)return;const q=Fa.from("getAllResponseHeaders"in X&&X.getAllResponseHeaders()),ae={data:!o||o==="text"||o==="json"?X.responseText:X.response,status:X.status,statusText:X.statusText,headers:q,config:e,request:X};dB(function(Pe){l(Pe),H()},function(Pe){d(Pe),H()},ae),X=null}"onloadend"in X?X.onloadend=Z:X.onreadystatechange=function(){!X||X.readyState!==4||X.status===0&&!(X.responseURL&&X.responseURL.indexOf("file:")===0)||setTimeout(Z)},X.onabort=function(){X&&(d(new Wn("Request aborted",Wn.ECONNABORTED,e,X)),X=null)},X.onerror=function(){d(new Wn("Network Error",Wn.ERR_NETWORK,e,X)),X=null},X.ontimeout=function(){let oe=m.timeout?"timeout of "+m.timeout+"ms exceeded":"timeout exceeded";const ae=m.transitional||lB;m.timeoutErrorMessage&&(oe=m.timeoutErrorMessage),d(new Wn(oe,ae.clarifyTimeoutError?Wn.ETIMEDOUT:Wn.ECONNABORTED,e,X)),X=null},_===void 0&&w.setContentType(null),"setRequestHeader"in X&&Lt.forEach(w.toJSON(),function(oe,ae){X.setRequestHeader(ae,oe)}),Lt.isUndefined(m.withCredentials)||(X.withCredentials=!!m.withCredentials),o&&o!=="json"&&(X.responseType=m.responseType),P&&([F,Y]=s2(P,!0),X.addEventListener("progress",F)),E&&X.upload&&([L,$]=s2(E),X.upload.addEventListener("progress",L),X.upload.addEventListener("loadend",$)),(m.cancelToken||m.signal)&&(M=q=>{X&&(d(!q||q.type?new jx(null,e,X):q),X.abort(),X=null)},m.cancelToken&&m.cancelToken.subscribe(M),m.signal&&(m.signal.aborted?M():m.signal.addEventListener("abort",M)));const W=ste(m.url);if(W&&Wo.protocols.indexOf(W)===-1){d(new Wn("Unsupported protocol "+W+":",Wn.ERR_BAD_REQUEST,e));return}X.send(_||null)})},dte=(e,s)=>{const{length:l}=e=e?e.filter(Boolean):[];if(s||l){let d=new AbortController,m;const _=function(P){if(!m){m=!0,o();const M=P instanceof Error?P:this.reason;d.abort(M instanceof Wn?M:new jx(M instanceof Error?M.message:M))}};let w=s&&setTimeout(()=>{w=null,_(new Wn(`timeout ${s} of ms exceeded`,Wn.ETIMEDOUT))},s);const o=()=>{e&&(w&&clearTimeout(w),w=null,e.forEach(P=>{P.unsubscribe?P.unsubscribe(_):P.removeEventListener("abort",_)}),e=null)};e.forEach(P=>P.addEventListener("abort",_));const{signal:E}=d;return E.unsubscribe=()=>Lt.asap(o),E}},hte=function*(e,s){let l=e.byteLength;if(l<s){yield e;return}let d=0,m;for(;d<l;)m=d+s,yield e.slice(d,m),d=m},pte=async function*(e,s){for await(const l of fte(e))yield*hte(l,s)},fte=async function*(e){if(e[Symbol.asyncIterator]){yield*e;return}const s=e.getReader();try{for(;;){const{done:l,value:d}=await s.read();if(l)break;yield d}}finally{await s.cancel()}},rL=(e,s,l,d)=>{const m=pte(e,s);let _=0,w,o=E=>{w||(w=!0,d&&d(E))};return new ReadableStream({async pull(E){try{const{done:P,value:M}=await m.next();if(P){o(),E.close();return}let L=M.byteLength;if(l){let F=_+=L;l(F)}E.enqueue(new Uint8Array(M))}catch(P){throw o(P),P}},cancel(E){return o(E),m.return()}},{highWaterMark:2})},eS=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",fB=eS&&typeof ReadableStream=="function",mte=eS&&(typeof TextEncoder=="function"?(e=>s=>e.encode(s))(new TextEncoder):async e=>new Uint8Array(await new Response(e).arrayBuffer())),mB=(e,...s)=>{try{return!!e(...s)}catch{return!1}},gte=fB&&mB(()=>{let e=!1;const s=new Request(Wo.origin,{body:new ReadableStream,method:"POST",get duplex(){return e=!0,"half"}}).headers.has("Content-Type");return e&&!s}),iL=64*1024,UE=fB&&mB(()=>Lt.isReadableStream(new Response("").body)),n2={stream:UE&&(e=>e.body)};eS&&(e=>{["text","arrayBuffer","blob","formData","stream"].forEach(s=>{!n2[s]&&(n2[s]=Lt.isFunction(e[s])?l=>l[s]():(l,d)=>{throw new Wn(`Response type '${s}' is not supported`,Wn.ERR_NOT_SUPPORT,d)})})})(new Response);const xte=async e=>{if(e==null)return 0;if(Lt.isBlob(e))return e.size;if(Lt.isSpecCompliantForm(e))return(await new Request(Wo.origin,{method:"POST",body:e}).arrayBuffer()).byteLength;if(Lt.isArrayBufferView(e)||Lt.isArrayBuffer(e))return e.byteLength;if(Lt.isURLSearchParams(e)&&(e=e+""),Lt.isString(e))return(await mte(e)).byteLength},yte=async(e,s)=>{const l=Lt.toFiniteNumber(e.getContentLength());return l??xte(s)},_te=eS&&(async e=>{let{url:s,method:l,data:d,signal:m,cancelToken:_,timeout:w,onDownloadProgress:o,onUploadProgress:E,responseType:P,headers:M,withCredentials:L="same-origin",fetchOptions:F}=pB(e);P=P?(P+"").toLowerCase():"text";let $=dte([m,_&&_.toAbortSignal()],w),Y;const H=$&&$.unsubscribe&&(()=>{$.unsubscribe()});let X;try{if(E&&gte&&l!=="get"&&l!=="head"&&(X=await yte(M,d))!==0){let ae=new Request(s,{method:"POST",body:d,duplex:"half"}),Ne;if(Lt.isFormData(d)&&(Ne=ae.headers.get("content-type"))&&M.setContentType(Ne),ae.body){const[Pe,Le]=tL(X,s2(sL(E)));d=rL(ae.body,iL,Pe,Le)}}Lt.isString(L)||(L=L?"include":"omit");const Z="credentials"in Request.prototype;Y=new Request(s,{...F,signal:$,method:l.toUpperCase(),headers:M.normalize().toJSON(),body:d,duplex:"half",credentials:Z?L:void 0});let W=await fetch(Y,F);const q=UE&&(P==="stream"||P==="response");if(UE&&(o||q&&H)){const ae={};["status","statusText","headers"].forEach(ct=>{ae[ct]=W[ct]});const Ne=Lt.toFiniteNumber(W.headers.get("content-length")),[Pe,Le]=o&&tL(Ne,s2(sL(o),!0))||[];W=new Response(rL(W.body,iL,Pe,()=>{Le&&Le(),H&&H()}),ae)}P=P||"text";let oe=await n2[Lt.findKey(n2,P)||"text"](W,e);return!q&&H&&H(),await new Promise((ae,Ne)=>{dB(ae,Ne,{data:oe,headers:Fa.from(W.headers),status:W.status,statusText:W.statusText,config:e,request:Y})})}catch(Z){throw H&&H(),Z&&Z.name==="TypeError"&&/Load failed|fetch/i.test(Z.message)?Object.assign(new Wn("Network Error",Wn.ERR_NETWORK,e,Y),{cause:Z.cause||Z}):Wn.from(Z,Z&&Z.code,e,Y)}}),$E={http:kee,xhr:ute,fetch:_te};Lt.forEach($E,(e,s)=>{if(e){try{Object.defineProperty(e,"name",{value:s})}catch{}Object.defineProperty(e,"adapterName",{value:s})}});const oL=e=>`- ${e}`,vte=e=>Lt.isFunction(e)||e===null||e===!1,gB={getAdapter:e=>{e=Lt.isArray(e)?e:[e];const{length:s}=e;let l,d;const m={};for(let _=0;_<s;_++){l=e[_];let w;if(d=l,!vte(l)&&(d=$E[(w=String(l)).toLowerCase()],d===void 0))throw new Wn(`Unknown adapter '${w}'`);if(d)break;m[w||"#"+_]=d}if(!d){const _=Object.entries(m).map(([o,E])=>`adapter ${o} `+(E===!1?"is not supported by the environment":"is not available in the build"));let w=s?_.length>1?`since :
`+_.map(oL).join(`
`):" "+oL(_[0]):"as no adapter specified";throw new Wn("There is no suitable adapter to dispatch the request "+w,"ERR_NOT_SUPPORT")}return d},adapters:$E};function sN(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new jx(null,e)}function aL(e){return sN(e),e.headers=Fa.from(e.headers),e.data=tN.call(e,e.transformRequest),["post","put","patch"].indexOf(e.method)!==-1&&e.headers.setContentType("application/x-www-form-urlencoded",!1),gB.getAdapter(e.adapter||ov.adapter)(e).then(function(d){return sN(e),d.data=tN.call(e,e.transformResponse,d),d.headers=Fa.from(d.headers),d},function(d){return uB(d)||(sN(e),d&&d.response&&(d.response.data=tN.call(e,e.transformResponse,d.response),d.response.headers=Fa.from(d.response.headers))),Promise.reject(d)})}const xB="1.11.0",tS={};["object","boolean","number","function","string","symbol"].forEach((e,s)=>{tS[e]=function(d){return typeof d===e||"a"+(s<1?"n ":" ")+e}});const lL={};tS.transitional=function(s,l,d){function m(_,w){return"[Axios v"+xB+"] Transitional option '"+_+"'"+w+(d?". "+d:"")}return(_,w,o)=>{if(s===!1)throw new Wn(m(w," has been removed"+(l?" in "+l:"")),Wn.ERR_DEPRECATED);return l&&!lL[w]&&(lL[w]=!0,console.warn(m(w," has been deprecated since v"+l+" and will be removed in the near future"))),s?s(_,w,o):!0}};tS.spelling=function(s){return(l,d)=>(console.warn(`${d} is likely a misspelling of ${s}`),!0)};function bte(e,s,l){if(typeof e!="object")throw new Wn("options must be an object",Wn.ERR_BAD_OPTION_VALUE);const d=Object.keys(e);let m=d.length;for(;m-- >0;){const _=d[m],w=s[_];if(w){const o=e[_],E=o===void 0||w(o,_,e);if(E!==!0)throw new Wn("option "+_+" must be "+E,Wn.ERR_BAD_OPTION_VALUE);continue}if(l!==!0)throw new Wn("Unknown option "+_,Wn.ERR_BAD_OPTION)}}const fw={assertOptions:bte,validators:tS},$c=fw.validators;class uf{constructor(s){this.defaults=s||{},this.interceptors={request:new QD,response:new QD}}async request(s,l){try{return await this._request(s,l)}catch(d){if(d instanceof Error){let m={};Error.captureStackTrace?Error.captureStackTrace(m):m=new Error;const _=m.stack?m.stack.replace(/^.+\n/,""):"";try{d.stack?_&&!String(d.stack).endsWith(_.replace(/^.+\n.+\n/,""))&&(d.stack+=`
`+_):d.stack=_}catch{}}throw d}}_request(s,l){typeof s=="string"?(l=l||{},l.url=s):l=s||{},l=bf(this.defaults,l);const{transitional:d,paramsSerializer:m,headers:_}=l;d!==void 0&&fw.assertOptions(d,{silentJSONParsing:$c.transitional($c.boolean),forcedJSONParsing:$c.transitional($c.boolean),clarifyTimeoutError:$c.transitional($c.boolean)},!1),m!=null&&(Lt.isFunction(m)?l.paramsSerializer={serialize:m}:fw.assertOptions(m,{encode:$c.function,serialize:$c.function},!0)),l.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?l.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:l.allowAbsoluteUrls=!0),fw.assertOptions(l,{baseUrl:$c.spelling("baseURL"),withXsrfToken:$c.spelling("withXSRFToken")},!0),l.method=(l.method||this.defaults.method||"get").toLowerCase();let w=_&&Lt.merge(_.common,_[l.method]);_&&Lt.forEach(["delete","get","head","post","put","patch","common"],Y=>{delete _[Y]}),l.headers=Fa.concat(w,_);const o=[];let E=!0;this.interceptors.request.forEach(function(H){typeof H.runWhen=="function"&&H.runWhen(l)===!1||(E=E&&H.synchronous,o.unshift(H.fulfilled,H.rejected))});const P=[];this.interceptors.response.forEach(function(H){P.push(H.fulfilled,H.rejected)});let M,L=0,F;if(!E){const Y=[aL.bind(this),void 0];for(Y.unshift(...o),Y.push(...P),F=Y.length,M=Promise.resolve(l);L<F;)M=M.then(Y[L++],Y[L++]);return M}F=o.length;let $=l;for(L=0;L<F;){const Y=o[L++],H=o[L++];try{$=Y($)}catch(X){H.call(this,X);break}}try{M=aL.call(this,$)}catch(Y){return Promise.reject(Y)}for(L=0,F=P.length;L<F;)M=M.then(P[L++],P[L++]);return M}getUri(s){s=bf(this.defaults,s);const l=hB(s.baseURL,s.url,s.allowAbsoluteUrls);return aB(l,s.params,s.paramsSerializer)}}Lt.forEach(["delete","get","head","options"],function(s){uf.prototype[s]=function(l,d){return this.request(bf(d||{},{method:s,url:l,data:(d||{}).data}))}});Lt.forEach(["post","put","patch"],function(s){function l(d){return function(_,w,o){return this.request(bf(o||{},{method:s,headers:d?{"Content-Type":"multipart/form-data"}:{},url:_,data:w}))}}uf.prototype[s]=l(),uf.prototype[s+"Form"]=l(!0)});class XA{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let l;this.promise=new Promise(function(_){l=_});const d=this;this.promise.then(m=>{if(!d._listeners)return;let _=d._listeners.length;for(;_-- >0;)d._listeners[_](m);d._listeners=null}),this.promise.then=m=>{let _;const w=new Promise(o=>{d.subscribe(o),_=o}).then(m);return w.cancel=function(){d.unsubscribe(_)},w},s(function(_,w,o){d.reason||(d.reason=new jx(_,w,o),l(d.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const l=this._listeners.indexOf(s);l!==-1&&this._listeners.splice(l,1)}toAbortSignal(){const s=new AbortController,l=d=>{s.abort(d)};return this.subscribe(l),s.signal.unsubscribe=()=>this.unsubscribe(l),s.signal}static source(){let s;return{token:new XA(function(m){s=m}),cancel:s}}}function wte(e){return function(l){return e.apply(null,l)}}function Ste(e){return Lt.isObject(e)&&e.isAxiosError===!0}const GE={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(GE).forEach(([e,s])=>{GE[s]=e});function yB(e){const s=new uf(e),l=K5(uf.prototype.request,s);return Lt.extend(l,uf.prototype,s,{allOwnKeys:!0}),Lt.extend(l,s,null,{allOwnKeys:!0}),l.create=function(m){return yB(bf(e,m))},l}const Zi=yB(ov);Zi.Axios=uf;Zi.CanceledError=jx;Zi.CancelToken=XA;Zi.isCancel=uB;Zi.VERSION=xB;Zi.toFormData=Q2;Zi.AxiosError=Wn;Zi.Cancel=Zi.CanceledError;Zi.all=function(s){return Promise.all(s)};Zi.spread=wte;Zi.isAxiosError=Ste;Zi.mergeConfig=bf;Zi.AxiosHeaders=Fa;Zi.formToJSON=e=>cB(Lt.isHTMLForm(e)?new FormData(e):e);Zi.getAdapter=gB.getAdapter;Zi.HttpStatusCode=GE;Zi.default=Zi;const Xs=Zi.create({baseURL:"http://localhost:5000/api/v1",timeout:"10000",headers:{"Content-Type":"application/json"}});Xs.interceptors.request.use(e=>{const s=localStorage.getItem("accessToken");return s&&(e.headers.Authorization=`Bearer ${s}`),e},e=>Promise.reject(e));Xs.interceptors.response.use(e=>e,async e=>{var s;if(((s=e.response)==null?void 0:s.status)===401){const l=localStorage.getItem("refreshToken");if(l)try{const d=await Xs.post("/auth/refresh",{refreshToken:l}),{accessToken:m,refreshToken:_}=d.data.data;return localStorage.setItem("accessToken",m),localStorage.setItem("refreshToken",_),e.config.headers.Authorization=`Bearer ${m}`,Xs.request(e.config)}catch{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),window.location.href="/auth/signin"}}return Promise.reject(e)});const Ni={auth:{signUp:e=>Xs.post("/auth/register",e),signIn:e=>Xs.post("/auth/login",e),refreshToken:e=>Xs.post("/auth/refresh",{refreshToken:e}),logout:()=>Xs.post("/auth/logout"),forgotPassword:e=>Xs.post("/auth/forgot-password",{email:e}),resetPassword:(e,s)=>Xs.post("/auth/reset-password",{token:e,password:s}),verifyEmail:(e,s)=>Xs.post("/auth/verify-email",{email:e,code:s}),resendVerification:e=>Xs.post("/auth/resend-verification",{email:e})},users:{getProfile:()=>Xs.get("/users/profile"),updateProfile:e=>Xs.put("/users/profile",e),deleteAccount:()=>Xs.delete("/users/profile"),getPreferences:()=>Xs.get("/users/preferences"),updatePreferences:e=>Xs.put("/users/preferences",e),getSavedProperties:()=>Xs.get("/users/saved-properties"),saveProperty:e=>Xs.post("/users/saved-properties",{propertyId:e}),removeSavedProperty:e=>Xs.delete(`/users/saved-properties/${e}`),getAllUsers:e=>Xs.get("/users",{params:e}),getUserById:e=>Xs.get(`/users/${e}`),updateUserStatus:(e,s)=>Xs.put(`/users/${e}/status`,s),deleteUser:e=>Xs.delete(`/users/${e}`)},properties:{getAll:e=>Xs.get("/properties",{params:e}),getById:e=>Xs.get(`/properties/${e}`),getFeatured:()=>Xs.get("/properties/featured"),create:e=>Xs.post("/properties",e),update:(e,s)=>Xs.put(`/properties/${e}`,s),delete:e=>Xs.delete(`/properties/${e}`),uploadImages:(e,s)=>{const l=new FormData;return s.forEach((d,m)=>{l.append("images",d)}),Xs.post(`/properties/${e}/images`,l,{headers:{"Content-Type":"multipart/form-data"}})},deleteImage:(e,s)=>Xs.delete(`/properties/${e}/images/${s}`),getInquiries:e=>Xs.get(`/properties/${e}/inquiries`),createInquiry:(e,s)=>Xs.post(`/properties/${e}/inquiries`,s)},search:{searchProperties:e=>Xs.get("/search",{params:e}),getFilters:()=>Xs.get("/search/filters"),getTrending:()=>Xs.get("/search/trending")},agents:{getAll:e=>Xs.get("/agents",{params:e}),getById:e=>Xs.get(`/agents/${e}`),getVerified:()=>Xs.get("/agents/verified"),getBySpecialization:e=>Xs.get(`/agents/specialization/${e}`),getStats:()=>Xs.get("/agents/stats"),apply:e=>Xs.post("/agents/apply",e),getApplications:e=>Xs.get("/agents/applications",{params:e}),getApplicationById:e=>Xs.get(`/agents/applications/${e}`),approveApplication:e=>Xs.put(`/agents/applications/${e}/approve`),rejectApplication:(e,s)=>Xs.put(`/agents/applications/${e}/reject`,{reason:s})},chat:{getConversations:()=>Xs.get("/chat"),getMessages:e=>Xs.get(`/chat/${e}/messages`),sendMessage:(e,s)=>Xs.post(`/chat/${e}/messages`,s),createChat:(e,s,l)=>Xs.post("/chat",{agentId:e,propertyId:s,message:l})},payments:{createPayment:e=>Xs.post("/payments",e),getPaymentHistory:()=>Xs.get("/payments"),getPaymentById:e=>Xs.get(`/payments/${e}`),refundPayment:(e,s)=>Xs.post(`/payments/${e}/refund`,{reason:s})},notifications:{getAll:()=>Xs.get("/notifications"),markAsRead:e=>Xs.put(`/notifications/${e}/read`),markAllAsRead:()=>Xs.put("/notifications/read-all"),deleteNotification:e=>Xs.delete(`/notifications/${e}`)},upload:{uploadImage:(e,s="general")=>{const l=new FormData;return l.append("image",e),l.append("folder",s),Xs.post("/upload/image",l,{headers:{"Content-Type":"multipart/form-data"}})},uploadImages:(e,s="properties")=>{const l=new FormData;return e.forEach(d=>{l.append("images",d)}),Xs.post("/upload/images",l,{headers:{"Content-Type":"multipart/form-data"}})},uploadDocument:(e,s="documents")=>{const l=new FormData;return l.append("document",e),l.append("folder",s),Xs.post("/upload/document",l,{headers:{"Content-Type":"multipart/form-data"}})}}},jte={user:null,isAuthenticated:!1,isLoading:!0,error:null},Mr={SET_LOADING:"SET_LOADING",SET_USER:"SET_USER",SET_ERROR:"SET_ERROR",LOGOUT:"LOGOUT",CLEAR_ERROR:"CLEAR_ERROR"},Tte=(e,s)=>{switch(s.type){case Mr.SET_LOADING:return{...e,isLoading:s.payload};case Mr.SET_USER:return{...e,user:s.payload,isAuthenticated:!!s.payload,isLoading:!1,error:null};case Mr.SET_ERROR:return{...e,error:s.payload,isLoading:!1};case Mr.LOGOUT:return{...e,user:null,isAuthenticated:!1,isLoading:!1,error:null};case Mr.CLEAR_ERROR:return{...e,error:null};default:return e}},_B=z.createContext(void 0),Nte=({children:e})=>{const[s,l]=z.useReducer(Tte,jte);z.useEffect(()=>{(async()=>{if(localStorage.getItem("accessToken"))try{const H=await Ni.users.getProfile();l({type:Mr.SET_USER,payload:H.data.data})}catch{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),l({type:Mr.SET_LOADING,payload:!1})}else l({type:Mr.SET_LOADING,payload:!1})})()},[]);const F={...s,signUp:async $=>{var Y,H;try{l({type:Mr.SET_LOADING,payload:!0});const X=await Ni.auth.signUp($),{user:Z,accessToken:W,refreshToken:q}=X.data.data;return localStorage.setItem("accessToken",W),localStorage.setItem("refreshToken",q),l({type:Mr.SET_USER,payload:Z}),{success:!0,data:X.data}}catch(X){const Z=((H=(Y=X.response)==null?void 0:Y.data)==null?void 0:H.message)||"Registration failed";return l({type:Mr.SET_ERROR,payload:Z}),{success:!1,error:Z}}},signIn:async $=>{var Y,H;try{l({type:Mr.SET_LOADING,payload:!0});const X=await Ni.auth.signIn($),{user:Z,accessToken:W,refreshToken:q}=X.data.data;return localStorage.setItem("accessToken",W),localStorage.setItem("refreshToken",q),l({type:Mr.SET_USER,payload:Z}),{success:!0,data:X.data}}catch(X){const Z=((H=(Y=X.response)==null?void 0:Y.data)==null?void 0:H.message)||"Login failed";return l({type:Mr.SET_ERROR,payload:Z}),{success:!1,error:Z}}},logout:async()=>{try{await Ni.auth.logout()}catch($){console.warn("Logout API call failed:",$)}finally{localStorage.removeItem("accessToken"),localStorage.removeItem("refreshToken"),l({type:Mr.LOGOUT})}},forgotPassword:async $=>{var Y,H;try{l({type:Mr.SET_LOADING,payload:!0});const X=await Ni.auth.forgotPassword($);return l({type:Mr.SET_LOADING,payload:!1}),{success:!0,data:X.data}}catch(X){const Z=((H=(Y=X.response)==null?void 0:Y.data)==null?void 0:H.message)||"Password reset request failed";return l({type:Mr.SET_ERROR,payload:Z}),{success:!1,error:Z}}},resetPassword:async($,Y)=>{var H,X;try{l({type:Mr.SET_LOADING,payload:!0});const Z=await Ni.auth.resetPassword($,Y);return l({type:Mr.SET_LOADING,payload:!1}),{success:!0,data:Z.data}}catch(Z){const W=((X=(H=Z.response)==null?void 0:H.data)==null?void 0:X.message)||"Password reset failed";return l({type:Mr.SET_ERROR,payload:W}),{success:!1,error:W}}},verifyEmail:async($,Y)=>{var H,X;try{l({type:Mr.SET_LOADING,payload:!0});const Z=await Ni.auth.verifyEmail($,Y);return l({type:Mr.SET_LOADING,payload:!1}),{success:!0,data:Z.data}}catch(Z){const W=((X=(H=Z.response)==null?void 0:H.data)==null?void 0:X.message)||"Email verification failed";return l({type:Mr.SET_ERROR,payload:W}),{success:!1,error:W}}},resendVerification:async $=>{var Y,H;try{l({type:Mr.SET_LOADING,payload:!0});const X=await Ni.auth.resendVerification($);return l({type:Mr.SET_LOADING,payload:!1}),{success:!0,data:X.data}}catch(X){const Z=((H=(Y=X.response)==null?void 0:Y.data)==null?void 0:H.message)||"Failed to resend verification code";return l({type:Mr.SET_ERROR,payload:Z}),{success:!1,error:Z}}},updateProfile:async $=>{var Y,H;try{l({type:Mr.SET_LOADING,payload:!0});const X=await Ni.users.updateProfile($);return l({type:Mr.SET_USER,payload:X.data.data}),{success:!0,data:X.data}}catch(X){const Z=((H=(Y=X.response)==null?void 0:Y.data)==null?void 0:H.message)||"Profile update failed";return l({type:Mr.SET_ERROR,payload:Z}),{success:!1,error:Z}}},clearError:()=>{l({type:Mr.CLEAR_ERROR})}};return n.jsx(_B.Provider,{value:F,children:e})},mi=()=>{const e=z.useContext(_B);if(!e)throw new Error("useAuth must be used within an AuthProvider");return e},ri=({children:e,requiredRole:s})=>{const{isAuthenticated:l,isLoading:d,user:m}=mi(),_=cc();return d?n.jsx("div",{className:"flex items-center justify-center min-h-screen",children:n.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-gray-900",children:"Loading"})}):l?s&&(m==null?void 0:m.role)!==s?n.jsx(fD,{to:"/unauthorized",replace:!0}):n.jsx(n.Fragment,{children:e}):n.jsx(fD,{to:"/auth/signin",state:{from:_},replace:!0})};var nN="focusScope.autoFocusOnMount",rN="focusScope.autoFocusOnUnmount",cL={bubbles:!1,cancelable:!0},Ete="FocusScope",sS=z.forwardRef((e,s)=>{const{loop:l=!1,trapped:d=!1,onMountAutoFocus:m,onUnmountAutoFocus:_,...w}=e,[o,E]=z.useState(null),P=Ci(m),M=Ci(_),L=z.useRef(null),F=Gn(s,H=>E(H)),$=z.useRef({paused:!1,pause(){this.paused=!0},resume(){this.paused=!1}}).current;z.useEffect(()=>{if(d){let H=function(q){if($.paused||!o)return;const oe=q.target;o.contains(oe)?L.current=oe:nh(L.current,{select:!0})},X=function(q){if($.paused||!o)return;const oe=q.relatedTarget;oe!==null&&(o.contains(oe)||nh(L.current,{select:!0}))},Z=function(q){if(document.activeElement===document.body)for(const ae of q)ae.removedNodes.length>0&&nh(o)};document.addEventListener("focusin",H),document.addEventListener("focusout",X);const W=new MutationObserver(Z);return o&&W.observe(o,{childList:!0,subtree:!0}),()=>{document.removeEventListener("focusin",H),document.removeEventListener("focusout",X),W.disconnect()}}},[d,o,$.paused]),z.useEffect(()=>{if(o){dL.add($);const H=document.activeElement;if(!o.contains(H)){const Z=new CustomEvent(nN,cL);o.addEventListener(nN,P),o.dispatchEvent(Z),Z.defaultPrevented||(Cte(Rte(vB(o)),{select:!0}),document.activeElement===H&&nh(o))}return()=>{o.removeEventListener(nN,P),setTimeout(()=>{const Z=new CustomEvent(rN,cL);o.addEventListener(rN,M),o.dispatchEvent(Z),Z.defaultPrevented||nh(H??document.body,{select:!0}),o.removeEventListener(rN,M),dL.remove($)},0)}}},[o,P,M,$]);const Y=z.useCallback(H=>{if(!l&&!d||$.paused)return;const X=H.key==="Tab"&&!H.altKey&&!H.ctrlKey&&!H.metaKey,Z=document.activeElement;if(X&&Z){const W=H.currentTarget,[q,oe]=Ate(W);q&&oe?!H.shiftKey&&Z===oe?(H.preventDefault(),l&&nh(q,{select:!0})):H.shiftKey&&Z===q&&(H.preventDefault(),l&&nh(oe,{select:!0})):Z===W&&H.preventDefault()}},[l,d,$.paused]);return n.jsx(Ys.div,{tabIndex:-1,...w,ref:F,onKeyDown:Y})});sS.displayName=Ete;function Cte(e,{select:s=!1}={}){const l=document.activeElement;for(const d of e)if(nh(d,{select:s}),document.activeElement!==l)return}function Ate(e){const s=vB(e),l=uL(s,e),d=uL(s.reverse(),e);return[l,d]}function vB(e){const s=[],l=document.createTreeWalker(e,NodeFilter.SHOW_ELEMENT,{acceptNode:d=>{const m=d.tagName==="INPUT"&&d.type==="hidden";return d.disabled||d.hidden||m?NodeFilter.FILTER_SKIP:d.tabIndex>=0?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP}});for(;l.nextNode();)s.push(l.currentNode);return s}function uL(e,s){for(const l of e)if(!Pte(l,{upTo:s}))return l}function Pte(e,{upTo:s}){if(getComputedStyle(e).visibility==="hidden")return!0;for(;e;){if(s!==void 0&&e===s)return!1;if(getComputedStyle(e).display==="none")return!0;e=e.parentElement}return!1}function Ite(e){return e instanceof HTMLInputElement&&"select"in e}function nh(e,{select:s=!1}={}){if(e&&e.focus){const l=document.activeElement;e.focus({preventScroll:!0}),e!==l&&Ite(e)&&s&&e.select()}}var dL=Mte();function Mte(){let e=[];return{add(s){const l=e[0];s!==l&&(l==null||l.pause()),e=hL(e,s),e.unshift(s)},remove(s){var l;e=hL(e,s),(l=e[0])==null||l.resume()}}}function hL(e,s){const l=[...e],d=l.indexOf(s);return d!==-1&&l.splice(d,1),l}function Rte(e){return e.filter(s=>s.tagName!=="A")}var iN=0;function YA(){z.useEffect(()=>{const e=document.querySelectorAll("[data-radix-focus-guard]");return document.body.insertAdjacentElement("afterbegin",e[0]??pL()),document.body.insertAdjacentElement("beforeend",e[1]??pL()),iN++,()=>{iN===1&&document.querySelectorAll("[data-radix-focus-guard]").forEach(s=>s.remove()),iN--}},[])}function pL(){const e=document.createElement("span");return e.setAttribute("data-radix-focus-guard",""),e.tabIndex=0,e.style.outline="none",e.style.opacity="0",e.style.position="fixed",e.style.pointerEvents="none",e}var Kc=function(){return Kc=Object.assign||function(s){for(var l,d=1,m=arguments.length;d<m;d++){l=arguments[d];for(var _ in l)Object.prototype.hasOwnProperty.call(l,_)&&(s[_]=l[_])}return s},Kc.apply(this,arguments)};function bB(e,s){var l={};for(var d in e)Object.prototype.hasOwnProperty.call(e,d)&&s.indexOf(d)<0&&(l[d]=e[d]);if(e!=null&&typeof Object.getOwnPropertySymbols=="function")for(var m=0,d=Object.getOwnPropertySymbols(e);m<d.length;m++)s.indexOf(d[m])<0&&Object.prototype.propertyIsEnumerable.call(e,d[m])&&(l[d[m]]=e[d[m]]);return l}function kte(e,s,l){if(l||arguments.length===2)for(var d=0,m=s.length,_;d<m;d++)(_||!(d in s))&&(_||(_=Array.prototype.slice.call(s,0,d)),_[d]=s[d]);return e.concat(_||Array.prototype.slice.call(s))}var mw="right-scroll-bar-position",gw="width-before-scroll-bar",Dte="with-scroll-bars-hidden",Lte="--removed-body-scroll-bar-size";function oN(e,s){return typeof e=="function"?e(s):e&&(e.current=s),e}function zte(e,s){var l=z.useState(function(){return{value:e,callback:s,facade:{get current(){return l.value},set current(d){var m=l.value;m!==d&&(l.value=d,l.callback(d,m))}}}})[0];return l.callback=s,l.facade}var Ote=typeof window<"u"?z.useLayoutEffect:z.useEffect,fL=new WeakMap;function Fte(e,s){var l=zte(null,function(d){return e.forEach(function(m){return oN(m,d)})});return Ote(function(){var d=fL.get(l);if(d){var m=new Set(d),_=new Set(e),w=l.current;m.forEach(function(o){_.has(o)||oN(o,null)}),_.forEach(function(o){m.has(o)||oN(o,w)})}fL.set(l,e)},[e]),l}function Bte(e){return e}function Vte(e,s){s===void 0&&(s=Bte);var l=[],d=!1,m={read:function(){if(d)throw new Error("Sidecar: could not `read` from an `assigned` medium. `read` could be used only with `useMedium`.");return l.length?l[l.length-1]:e},useMedium:function(_){var w=s(_,d);return l.push(w),function(){l=l.filter(function(o){return o!==w})}},assignSyncMedium:function(_){for(d=!0;l.length;){var w=l;l=[],w.forEach(_)}l={push:function(o){return _(o)},filter:function(){return l}}},assignMedium:function(_){d=!0;var w=[];if(l.length){var o=l;l=[],o.forEach(_),w=l}var E=function(){var M=w;w=[],M.forEach(_)},P=function(){return Promise.resolve().then(E)};P(),l={push:function(M){w.push(M),P()},filter:function(M){return w=w.filter(M),l}}}};return m}function Ute(e){e===void 0&&(e={});var s=Vte(null);return s.options=Kc({async:!0,ssr:!1},e),s}var wB=function(e){var s=e.sideCar,l=bB(e,["sideCar"]);if(!s)throw new Error("Sidecar: please provide `sideCar` property to import the right car");var d=s.read();if(!d)throw new Error("Sidecar medium not found");return z.createElement(d,Kc({},l))};wB.isSideCarExport=!0;function $te(e,s){return e.useMedium(s),wB}var SB=Ute(),aN=function(){},nS=z.forwardRef(function(e,s){var l=z.useRef(null),d=z.useState({onScrollCapture:aN,onWheelCapture:aN,onTouchMoveCapture:aN}),m=d[0],_=d[1],w=e.forwardProps,o=e.children,E=e.className,P=e.removeScrollBar,M=e.enabled,L=e.shards,F=e.sideCar,$=e.noRelative,Y=e.noIsolation,H=e.inert,X=e.allowPinchZoom,Z=e.as,W=Z===void 0?"div":Z,q=e.gapMode,oe=bB(e,["forwardProps","children","className","removeScrollBar","enabled","shards","sideCar","noRelative","noIsolation","inert","allowPinchZoom","as","gapMode"]),ae=F,Ne=Fte([l,s]),Pe=Kc(Kc({},oe),m);return z.createElement(z.Fragment,null,M&&z.createElement(ae,{sideCar:SB,removeScrollBar:P,shards:L,noRelative:$,noIsolation:Y,inert:H,setCallbacks:_,allowPinchZoom:!!X,lockRef:l,gapMode:q}),w?z.cloneElement(z.Children.only(o),Kc(Kc({},Pe),{ref:Ne})):z.createElement(W,Kc({},Pe,{className:E,ref:Ne}),o))});nS.defaultProps={enabled:!0,removeScrollBar:!0,inert:!1};nS.classNames={fullWidth:gw,zeroRight:mw};var Gte=function(){if(typeof __webpack_nonce__<"u")return __webpack_nonce__};function Hte(){if(!document)return null;var e=document.createElement("style");e.type="text/css";var s=Gte();return s&&e.setAttribute("nonce",s),e}function Wte(e,s){e.styleSheet?e.styleSheet.cssText=s:e.appendChild(document.createTextNode(s))}function qte(e){var s=document.head||document.getElementsByTagName("head")[0];s.appendChild(e)}var Zte=function(){var e=0,s=null;return{add:function(l){e==0&&(s=Hte())&&(Wte(s,l),qte(s)),e++},remove:function(){e--,!e&&s&&(s.parentNode&&s.parentNode.removeChild(s),s=null)}}},Kte=function(){var e=Zte();return function(s,l){z.useEffect(function(){return e.add(s),function(){e.remove()}},[s&&l])}},jB=function(){var e=Kte(),s=function(l){var d=l.styles,m=l.dynamic;return e(d,m),null};return s},Xte={left:0,top:0,right:0,gap:0},lN=function(e){return parseInt(e||"",10)||0},Yte=function(e){var s=window.getComputedStyle(document.body),l=s[e==="padding"?"paddingLeft":"marginLeft"],d=s[e==="padding"?"paddingTop":"marginTop"],m=s[e==="padding"?"paddingRight":"marginRight"];return[lN(l),lN(d),lN(m)]},Jte=function(e){if(e===void 0&&(e="margin"),typeof window>"u")return Xte;var s=Yte(e),l=document.documentElement.clientWidth,d=window.innerWidth;return{left:s[0],top:s[1],right:s[2],gap:Math.max(0,d-l+s[2]-s[0])}},Qte=jB(),Lg="data-scroll-locked",ese=function(e,s,l,d){var m=e.left,_=e.top,w=e.right,o=e.gap;return l===void 0&&(l="margin"),`
  .`.concat(Dte,` {
   overflow: hidden `).concat(d,`;
   padding-right: `).concat(o,"px ").concat(d,`;
  }
  body[`).concat(Lg,`] {
    overflow: hidden `).concat(d,`;
    overscroll-behavior: contain;
    `).concat([s&&"position: relative ".concat(d,";"),l==="margin"&&`
    padding-left: `.concat(m,`px;
    padding-top: `).concat(_,`px;
    padding-right: `).concat(w,`px;
    margin-left:0;
    margin-top:0;
    margin-right: `).concat(o,"px ").concat(d,`;
    `),l==="padding"&&"padding-right: ".concat(o,"px ").concat(d,";")].filter(Boolean).join(""),`
  }
  
  .`).concat(mw,` {
    right: `).concat(o,"px ").concat(d,`;
  }
  
  .`).concat(gw,` {
    margin-right: `).concat(o,"px ").concat(d,`;
  }
  
  .`).concat(mw," .").concat(mw,` {
    right: 0 `).concat(d,`;
  }
  
  .`).concat(gw," .").concat(gw,` {
    margin-right: 0 `).concat(d,`;
  }
  
  body[`).concat(Lg,`] {
    `).concat(Lte,": ").concat(o,`px;
  }
`)},mL=function(){var e=parseInt(document.body.getAttribute(Lg)||"0",10);return isFinite(e)?e:0},tse=function(){z.useEffect(function(){return document.body.setAttribute(Lg,(mL()+1).toString()),function(){var e=mL()-1;e<=0?document.body.removeAttribute(Lg):document.body.setAttribute(Lg,e.toString())}},[])},sse=function(e){var s=e.noRelative,l=e.noImportant,d=e.gapMode,m=d===void 0?"margin":d;tse();var _=z.useMemo(function(){return Jte(m)},[m]);return z.createElement(Qte,{styles:ese(_,!s,m,l?"":"!important")})},HE=!1;if(typeof window<"u")try{var $b=Object.defineProperty({},"passive",{get:function(){return HE=!0,!0}});window.addEventListener("test",$b,$b),window.removeEventListener("test",$b,$b)}catch{HE=!1}var ng=HE?{passive:!1}:!1,nse=function(e){return e.tagName==="TEXTAREA"},TB=function(e,s){if(!(e instanceof Element))return!1;var l=window.getComputedStyle(e);return l[s]!=="hidden"&&!(l.overflowY===l.overflowX&&!nse(e)&&l[s]==="visible")},rse=function(e){return TB(e,"overflowY")},ise=function(e){return TB(e,"overflowX")},gL=function(e,s){var l=s.ownerDocument,d=s;do{typeof ShadowRoot<"u"&&d instanceof ShadowRoot&&(d=d.host);var m=NB(e,d);if(m){var _=EB(e,d),w=_[1],o=_[2];if(w>o)return!0}d=d.parentNode}while(d&&d!==l.body);return!1},ose=function(e){var s=e.scrollTop,l=e.scrollHeight,d=e.clientHeight;return[s,l,d]},ase=function(e){var s=e.scrollLeft,l=e.scrollWidth,d=e.clientWidth;return[s,l,d]},NB=function(e,s){return e==="v"?rse(s):ise(s)},EB=function(e,s){return e==="v"?ose(s):ase(s)},lse=function(e,s){return e==="h"&&s==="rtl"?-1:1},cse=function(e,s,l,d,m){var _=lse(e,window.getComputedStyle(s).direction),w=_*d,o=l.target,E=s.contains(o),P=!1,M=w>0,L=0,F=0;do{if(!o)break;var $=EB(e,o),Y=$[0],H=$[1],X=$[2],Z=H-X-_*Y;(Y||Z)&&NB(e,o)&&(L+=Z,F+=Y);var W=o.parentNode;o=W&&W.nodeType===Node.DOCUMENT_FRAGMENT_NODE?W.host:W}while(!E&&o!==document.body||E&&(s.contains(o)||s===o));return(M&&(Math.abs(L)<1||!m)||!M&&(Math.abs(F)<1||!m))&&(P=!0),P},Gb=function(e){return"changedTouches"in e?[e.changedTouches[0].clientX,e.changedTouches[0].clientY]:[0,0]},xL=function(e){return[e.deltaX,e.deltaY]},yL=function(e){return e&&"current"in e?e.current:e},use=function(e,s){return e[0]===s[0]&&e[1]===s[1]},dse=function(e){return`
  .block-interactivity-`.concat(e,` {pointer-events: none;}
  .allow-interactivity-`).concat(e,` {pointer-events: all;}
`)},hse=0,rg=[];function pse(e){var s=z.useRef([]),l=z.useRef([0,0]),d=z.useRef(),m=z.useState(hse++)[0],_=z.useState(jB)[0],w=z.useRef(e);z.useEffect(function(){w.current=e},[e]),z.useEffect(function(){if(e.inert){document.body.classList.add("block-interactivity-".concat(m));var H=kte([e.lockRef.current],(e.shards||[]).map(yL),!0).filter(Boolean);return H.forEach(function(X){return X.classList.add("allow-interactivity-".concat(m))}),function(){document.body.classList.remove("block-interactivity-".concat(m)),H.forEach(function(X){return X.classList.remove("allow-interactivity-".concat(m))})}}},[e.inert,e.lockRef.current,e.shards]);var o=z.useCallback(function(H,X){if("touches"in H&&H.touches.length===2||H.type==="wheel"&&H.ctrlKey)return!w.current.allowPinchZoom;var Z=Gb(H),W=l.current,q="deltaX"in H?H.deltaX:W[0]-Z[0],oe="deltaY"in H?H.deltaY:W[1]-Z[1],ae,Ne=H.target,Pe=Math.abs(q)>Math.abs(oe)?"h":"v";if("touches"in H&&Pe==="h"&&Ne.type==="range")return!1;var Le=gL(Pe,Ne);if(!Le)return!0;if(Le?ae=Pe:(ae=Pe==="v"?"h":"v",Le=gL(Pe,Ne)),!Le)return!1;if(!d.current&&"changedTouches"in H&&(q||oe)&&(d.current=ae),!ae)return!0;var ct=d.current||ae;return cse(ct,X,H,ct==="h"?q:oe,!0)},[]),E=z.useCallback(function(H){var X=H;if(!(!rg.length||rg[rg.length-1]!==_)){var Z="deltaY"in X?xL(X):Gb(X),W=s.current.filter(function(ae){return ae.name===X.type&&(ae.target===X.target||X.target===ae.shadowParent)&&use(ae.delta,Z)})[0];if(W&&W.should){X.cancelable&&X.preventDefault();return}if(!W){var q=(w.current.shards||[]).map(yL).filter(Boolean).filter(function(ae){return ae.contains(X.target)}),oe=q.length>0?o(X,q[0]):!w.current.noIsolation;oe&&X.cancelable&&X.preventDefault()}}},[]),P=z.useCallback(function(H,X,Z,W){var q={name:H,delta:X,target:Z,should:W,shadowParent:fse(Z)};s.current.push(q),setTimeout(function(){s.current=s.current.filter(function(oe){return oe!==q})},1)},[]),M=z.useCallback(function(H){l.current=Gb(H),d.current=void 0},[]),L=z.useCallback(function(H){P(H.type,xL(H),H.target,o(H,e.lockRef.current))},[]),F=z.useCallback(function(H){P(H.type,Gb(H),H.target,o(H,e.lockRef.current))},[]);z.useEffect(function(){return rg.push(_),e.setCallbacks({onScrollCapture:L,onWheelCapture:L,onTouchMoveCapture:F}),document.addEventListener("wheel",E,ng),document.addEventListener("touchmove",E,ng),document.addEventListener("touchstart",M,ng),function(){rg=rg.filter(function(H){return H!==_}),document.removeEventListener("wheel",E,ng),document.removeEventListener("touchmove",E,ng),document.removeEventListener("touchstart",M,ng)}},[]);var $=e.removeScrollBar,Y=e.inert;return z.createElement(z.Fragment,null,Y?z.createElement(_,{styles:dse(m)}):null,$?z.createElement(sse,{noRelative:e.noRelative,gapMode:e.gapMode}):null)}function fse(e){for(var s=null;e!==null;)e instanceof ShadowRoot&&(s=e.host,e=e.host),e=e.parentNode;return s}const mse=$te(SB,pse);var rS=z.forwardRef(function(e,s){return z.createElement(nS,Kc({},e,{ref:s,sideCar:mse}))});rS.classNames=nS.classNames;var gse=function(e){if(typeof document>"u")return null;var s=Array.isArray(e)?e[0]:e;return s.ownerDocument.body},ig=new WeakMap,Hb=new WeakMap,Wb={},cN=0,CB=function(e){return e&&(e.host||CB(e.parentNode))},xse=function(e,s){return s.map(function(l){if(e.contains(l))return l;var d=CB(l);return d&&e.contains(d)?d:(console.error("aria-hidden",l,"in not contained inside",e,". Doing nothing"),null)}).filter(function(l){return!!l})},yse=function(e,s,l,d){var m=xse(s,Array.isArray(e)?e:[e]);Wb[l]||(Wb[l]=new WeakMap);var _=Wb[l],w=[],o=new Set,E=new Set(m),P=function(L){!L||o.has(L)||(o.add(L),P(L.parentNode))};m.forEach(P);var M=function(L){!L||E.has(L)||Array.prototype.forEach.call(L.children,function(F){if(o.has(F))M(F);else try{var $=F.getAttribute(d),Y=$!==null&&$!=="false",H=(ig.get(F)||0)+1,X=(_.get(F)||0)+1;ig.set(F,H),_.set(F,X),w.push(F),H===1&&Y&&Hb.set(F,!0),X===1&&F.setAttribute(l,"true"),Y||F.setAttribute(d,"true")}catch(Z){console.error("aria-hidden: cannot operate on ",F,Z)}})};return M(s),o.clear(),cN++,function(){w.forEach(function(L){var F=ig.get(L)-1,$=_.get(L)-1;ig.set(L,F),_.set(L,$),F||(Hb.has(L)||L.removeAttribute(d),Hb.delete(L)),$||L.removeAttribute(l)}),cN--,cN||(ig=new WeakMap,ig=new WeakMap,Hb=new WeakMap,Wb={})}},JA=function(e,s,l){l===void 0&&(l="data-aria-hidden");var d=Array.from(Array.isArray(e)?e:[e]),m=gse(e);return m?(d.push.apply(d,Array.from(m.querySelectorAll("[aria-live]"))),yse(d,m,l,"aria-hidden")):function(){return null}},iS="Dialog",[AB,PB]=Xo(iS),[_se,dc]=AB(iS),IB=e=>{const{__scopeDialog:s,children:l,open:d,defaultOpen:m,onOpenChange:_,modal:w=!0}=e,o=z.useRef(null),E=z.useRef(null),[P,M]=Qu({prop:d,defaultProp:m??!1,onChange:_,caller:iS});return n.jsx(_se,{scope:s,triggerRef:o,contentRef:E,contentId:Qc(),titleId:Qc(),descriptionId:Qc(),open:P,onOpenChange:M,onOpenToggle:z.useCallback(()=>M(L=>!L),[M]),modal:w,children:l})};IB.displayName=iS;var MB="DialogTrigger",RB=z.forwardRef((e,s)=>{const{__scopeDialog:l,...d}=e,m=dc(MB,l),_=Gn(s,m.triggerRef);return n.jsx(Ys.button,{type:"button","aria-haspopup":"dialog","aria-expanded":m.open,"aria-controls":m.contentId,"data-state":tP(m.open),...d,ref:_,onClick:bs(e.onClick,m.onOpenToggle)})});RB.displayName=MB;var QA="DialogPortal",[vse,kB]=AB(QA,{forceMount:void 0}),DB=e=>{const{__scopeDialog:s,forceMount:l,children:d,container:m}=e,_=dc(QA,s);return n.jsx(vse,{scope:s,forceMount:l,children:z.Children.map(d,w=>n.jsx(Yo,{present:l||_.open,children:n.jsx(J0,{asChild:!0,container:m,children:w})}))})};DB.displayName=QA;var r2="DialogOverlay",LB=z.forwardRef((e,s)=>{const l=kB(r2,e.__scopeDialog),{forceMount:d=l.forceMount,...m}=e,_=dc(r2,e.__scopeDialog);return _.modal?n.jsx(Yo,{present:d||_.open,children:n.jsx(wse,{...m,ref:s})}):null});LB.displayName=r2;var bse=yf("DialogOverlay.RemoveScroll"),wse=z.forwardRef((e,s)=>{const{__scopeDialog:l,...d}=e,m=dc(r2,l);return n.jsx(rS,{as:bse,allowPinchZoom:!0,shards:[m.contentRef],children:n.jsx(Ys.div,{"data-state":tP(m.open),...d,ref:s,style:{pointerEvents:"auto",...d.style}})})}),wf="DialogContent",zB=z.forwardRef((e,s)=>{const l=kB(wf,e.__scopeDialog),{forceMount:d=l.forceMount,...m}=e,_=dc(wf,e.__scopeDialog);return n.jsx(Yo,{present:d||_.open,children:_.modal?n.jsx(Sse,{...m,ref:s}):n.jsx(jse,{...m,ref:s})})});zB.displayName=wf;var Sse=z.forwardRef((e,s)=>{const l=dc(wf,e.__scopeDialog),d=z.useRef(null),m=Gn(s,l.contentRef,d);return z.useEffect(()=>{const _=d.current;if(_)return JA(_)},[]),n.jsx(OB,{...e,ref:m,trapFocus:l.open,disableOutsidePointerEvents:!0,onCloseAutoFocus:bs(e.onCloseAutoFocus,_=>{var w;_.preventDefault(),(w=l.triggerRef.current)==null||w.focus()}),onPointerDownOutside:bs(e.onPointerDownOutside,_=>{const w=_.detail.originalEvent,o=w.button===0&&w.ctrlKey===!0;(w.button===2||o)&&_.preventDefault()}),onFocusOutside:bs(e.onFocusOutside,_=>_.preventDefault())})}),jse=z.forwardRef((e,s)=>{const l=dc(wf,e.__scopeDialog),d=z.useRef(!1),m=z.useRef(!1);return n.jsx(OB,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,onCloseAutoFocus:_=>{var w,o;(w=e.onCloseAutoFocus)==null||w.call(e,_),_.defaultPrevented||(d.current||(o=l.triggerRef.current)==null||o.focus(),_.preventDefault()),d.current=!1,m.current=!1},onInteractOutside:_=>{var E,P;(E=e.onInteractOutside)==null||E.call(e,_),_.defaultPrevented||(d.current=!0,_.detail.originalEvent.type==="pointerdown"&&(m.current=!0));const w=_.target;((P=l.triggerRef.current)==null?void 0:P.contains(w))&&_.preventDefault(),_.detail.originalEvent.type==="focusin"&&m.current&&_.preventDefault()}})}),OB=z.forwardRef((e,s)=>{const{__scopeDialog:l,trapFocus:d,onOpenAutoFocus:m,onCloseAutoFocus:_,...w}=e,o=dc(wf,l),E=z.useRef(null),P=Gn(s,E);return YA(),n.jsxs(n.Fragment,{children:[n.jsx(sS,{asChild:!0,loop:!0,trapped:d,onMountAutoFocus:m,onUnmountAutoFocus:_,children:n.jsx(gx,{role:"dialog",id:o.contentId,"aria-describedby":o.descriptionId,"aria-labelledby":o.titleId,"data-state":tP(o.open),...w,ref:P,onDismiss:()=>o.onOpenChange(!1)})}),n.jsxs(n.Fragment,{children:[n.jsx(Nse,{titleId:o.titleId}),n.jsx(Cse,{contentRef:E,descriptionId:o.descriptionId})]})]})}),eP="DialogTitle",FB=z.forwardRef((e,s)=>{const{__scopeDialog:l,...d}=e,m=dc(eP,l);return n.jsx(Ys.h2,{id:m.titleId,...d,ref:s})});FB.displayName=eP;var BB="DialogDescription",VB=z.forwardRef((e,s)=>{const{__scopeDialog:l,...d}=e,m=dc(BB,l);return n.jsx(Ys.p,{id:m.descriptionId,...d,ref:s})});VB.displayName=BB;var UB="DialogClose",$B=z.forwardRef((e,s)=>{const{__scopeDialog:l,...d}=e,m=dc(UB,l);return n.jsx(Ys.button,{type:"button",...d,ref:s,onClick:bs(e.onClick,()=>m.onOpenChange(!1))})});$B.displayName=UB;function tP(e){return e?"open":"closed"}var GB="DialogTitleWarning",[Tse,HB]=_K(GB,{contentName:wf,titleName:eP,docsSlug:"dialog"}),Nse=({titleId:e})=>{const s=HB(GB),l=`\`${s.contentName}\` requires a \`${s.titleName}\` for the component to be accessible for screen reader users.

If you want to hide the \`${s.titleName}\`, you can wrap it with our VisuallyHidden component.

For more information, see https://radix-ui.com/primitives/docs/components/${s.docsSlug}`;return z.useEffect(()=>{e&&(document.getElementById(e)||console.error(l))},[l,e]),null},Ese="DialogDescriptionWarning",Cse=({contentRef:e,descriptionId:s})=>{const d=`Warning: Missing \`Description\` or \`aria-describedby={undefined}\` for {${HB(Ese).contentName}}.`;return z.useEffect(()=>{var _;const m=(_=e.current)==null?void 0:_.getAttribute("aria-describedby");s&&m&&(document.getElementById(s)||console.warn(d))},[d,e,s]),null},WB=IB,qB=RB,ZB=DB,sP=LB,nP=zB,rP=FB,iP=VB,oP=$B;const oS=WB,Ase=qB,Pse=ZB,KB=z.forwardRef(({className:e,...s},l)=>n.jsx(sP,{ref:l,className:Ds("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s}));KB.displayName=sP.displayName;const av=z.forwardRef(({className:e,children:s,...l},d)=>n.jsxs(Pse,{children:[n.jsx(KB,{}),n.jsxs(nP,{ref:d,className:Ds("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...l,children:[s,n.jsxs(oP,{className:"absolute right-4 top-4 rounded-sm opacity-70 ring-offset-background transition-opacity hover:opacity-100 focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:pointer-events-none data-[state=open]:bg-accent data-[state=open]:text-muted-foreground",children:[n.jsx(ol,{className:"h-4 w-4"}),n.jsx("span",{className:"sr-only",children:"Close"})]})]})]}));av.displayName=nP.displayName;const lv=({className:e,...s})=>n.jsx("div",{className:Ds("flex flex-col space-y-1.5 text-center sm:text-left",e),...s});lv.displayName="DialogHeader";const cv=z.forwardRef(({className:e,...s},l)=>n.jsx(rP,{ref:l,className:Ds("text-lg font-semibold leading-none tracking-tight",e),...s}));cv.displayName=rP.displayName;const uv=z.forwardRef(({className:e,...s},l)=>n.jsx(iP,{ref:l,className:Ds("text-sm text-muted-foreground",e),...s}));uv.displayName=iP.displayName;const Es=z.forwardRef(({className:e,type:s,...l},d)=>n.jsx("input",{type:s,className:Ds("flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-base ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium file:text-foreground placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 md:text-sm",e),ref:d,...l}));Es.displayName="Input";var Ise="Label",XB=z.forwardRef((e,s)=>n.jsx(Ys.label,{...e,ref:s,onMouseDown:l=>{var m;l.target.closest("button, input, select, textarea")||((m=e.onMouseDown)==null||m.call(e,l),!l.defaultPrevented&&l.detail>1&&l.preventDefault())}}));XB.displayName=Ise;var YB=XB;const Mse=ev("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),ds=z.forwardRef(({className:e,...s},l)=>n.jsx(YB,{ref:l,className:Ds(Mse(),e),...s}));ds.displayName=YB.displayName;const Af=z.forwardRef(({className:e,...s},l)=>n.jsx("textarea",{className:Ds("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",e),ref:l,...s}));Af.displayName="Textarea";function WE(e,[s,l]){return Math.min(l,Math.max(s,e))}var Rse=z.createContext(void 0);function dv(e){const s=z.useContext(Rse);return e||s||"ltr"}function aP(e){const s=z.useRef({value:e,previous:e});return z.useMemo(()=>(s.current.value!==e&&(s.current.previous=s.current.value,s.current.value=e),s.current.previous),[e])}var kse=[" ","Enter","ArrowUp","ArrowDown"],Dse=[" ","Enter"],Sf="Select",[aS,lS,Lse]=G2(Sf),[Tx,Bde]=Xo(Sf,[Lse,_x]),cS=_x(),[zse,$h]=Tx(Sf),[Ose,Fse]=Tx(Sf),JB=e=>{const{__scopeSelect:s,children:l,open:d,defaultOpen:m,onOpenChange:_,value:w,defaultValue:o,onValueChange:E,dir:P,name:M,autoComplete:L,disabled:F,required:$,form:Y}=e,H=cS(s),[X,Z]=z.useState(null),[W,q]=z.useState(null),[oe,ae]=z.useState(!1),Ne=dv(P),[Pe,Le]=Qu({prop:d,defaultProp:m??!1,onChange:_,caller:Sf}),[ct,xt]=Qu({prop:w,defaultProp:o,onChange:E,caller:Sf}),yt=z.useRef(null),Ht=X?Y||!!X.closest("form"):!0,[Dt,wt]=z.useState(new Set),rs=Array.from(Dt).map(Vt=>Vt.props.value).join(";");return n.jsx(YF,{...H,children:n.jsxs(zse,{required:$,scope:s,trigger:X,onTriggerChange:Z,valueNode:W,onValueNodeChange:q,valueNodeHasChildren:oe,onValueNodeHasChildrenChange:ae,contentId:Qc(),value:ct,onValueChange:xt,open:Pe,onOpenChange:Le,dir:Ne,triggerPointerDownPosRef:yt,disabled:F,children:[n.jsx(aS.Provider,{scope:s,children:n.jsx(Ose,{scope:e.__scopeSelect,onNativeOptionAdd:z.useCallback(Vt=>{wt(Bt=>new Set(Bt).add(Vt))},[]),onNativeOptionRemove:z.useCallback(Vt=>{wt(Bt=>{const ze=new Set(Bt);return ze.delete(Vt),ze})},[]),children:l})}),Ht?n.jsxs(w6,{"aria-hidden":!0,required:$,tabIndex:-1,name:M,autoComplete:L,value:ct,onChange:Vt=>xt(Vt.target.value),disabled:F,form:Y,children:[ct===void 0?n.jsx("option",{value:""}):null,Array.from(Dt)]},rs):null]})})};JB.displayName=Sf;var QB="SelectTrigger",e6=z.forwardRef((e,s)=>{const{__scopeSelect:l,disabled:d=!1,...m}=e,_=cS(l),w=$h(QB,l),o=w.disabled||d,E=Gn(s,w.onTriggerChange),P=lS(l),M=z.useRef("touch"),[L,F,$]=j6(H=>{const X=P().filter(q=>!q.disabled),Z=X.find(q=>q.value===w.value),W=T6(X,H,Z);W!==void 0&&w.onValueChange(W.value)}),Y=H=>{o||(w.onOpenChange(!0),$()),H&&(w.triggerPointerDownPosRef.current={x:Math.round(H.pageX),y:Math.round(H.pageY)})};return n.jsx(kA,{asChild:!0,..._,children:n.jsx(Ys.button,{type:"button",role:"combobox","aria-controls":w.contentId,"aria-expanded":w.open,"aria-required":w.required,"aria-autocomplete":"none",dir:w.dir,"data-state":w.open?"open":"closed",disabled:o,"data-disabled":o?"":void 0,"data-placeholder":S6(w.value)?"":void 0,...m,ref:E,onClick:bs(m.onClick,H=>{H.currentTarget.focus(),M.current!=="mouse"&&Y(H)}),onPointerDown:bs(m.onPointerDown,H=>{M.current=H.pointerType;const X=H.target;X.hasPointerCapture(H.pointerId)&&X.releasePointerCapture(H.pointerId),H.button===0&&H.ctrlKey===!1&&H.pointerType==="mouse"&&(Y(H),H.preventDefault())}),onKeyDown:bs(m.onKeyDown,H=>{const X=L.current!=="";!(H.ctrlKey||H.altKey||H.metaKey)&&H.key.length===1&&F(H.key),!(X&&H.key===" ")&&kse.includes(H.key)&&(Y(),H.preventDefault())})})})});e6.displayName=QB;var t6="SelectValue",s6=z.forwardRef((e,s)=>{const{__scopeSelect:l,className:d,style:m,children:_,placeholder:w="",...o}=e,E=$h(t6,l),{onValueNodeHasChildrenChange:P}=E,M=_!==void 0,L=Gn(s,E.onValueNodeChange);return Fi(()=>{P(M)},[P,M]),n.jsx(Ys.span,{...o,ref:L,style:{pointerEvents:"none"},children:S6(E.value)?n.jsx(n.Fragment,{children:w}):_})});s6.displayName=t6;var Bse="SelectIcon",n6=z.forwardRef((e,s)=>{const{__scopeSelect:l,children:d,...m}=e;return n.jsx(Ys.span,{"aria-hidden":!0,...m,ref:s,children:d||""})});n6.displayName=Bse;var Vse="SelectPortal",r6=e=>n.jsx(J0,{asChild:!0,...e});r6.displayName=Vse;var jf="SelectContent",i6=z.forwardRef((e,s)=>{const l=$h(jf,e.__scopeSelect),[d,m]=z.useState();if(Fi(()=>{m(new DocumentFragment)},[]),!l.open){const _=d;return _?Ef.createPortal(n.jsx(o6,{scope:e.__scopeSelect,children:n.jsx(aS.Slot,{scope:e.__scopeSelect,children:n.jsx("div",{children:e.children})})}),_):null}return n.jsx(a6,{...e,ref:s})});i6.displayName=jf;var Zl=10,[o6,Gh]=Tx(jf),Use="SelectContentImpl",$se=yf("SelectContent.RemoveScroll"),a6=z.forwardRef((e,s)=>{const{__scopeSelect:l,position:d="item-aligned",onCloseAutoFocus:m,onEscapeKeyDown:_,onPointerDownOutside:w,side:o,sideOffset:E,align:P,alignOffset:M,arrowPadding:L,collisionBoundary:F,collisionPadding:$,sticky:Y,hideWhenDetached:H,avoidCollisions:X,...Z}=e,W=$h(jf,l),[q,oe]=z.useState(null),[ae,Ne]=z.useState(null),Pe=Gn(s,Xt=>oe(Xt)),[Le,ct]=z.useState(null),[xt,yt]=z.useState(null),Ht=lS(l),[Dt,wt]=z.useState(!1),rs=z.useRef(!1);z.useEffect(()=>{if(q)return JA(q)},[q]),YA();const Vt=z.useCallback(Xt=>{const[It,...Ns]=Ht().map(cn=>cn.ref.current),[ws]=Ns.slice(-1),tn=document.activeElement;for(const cn of Xt)if(cn===tn||(cn==null||cn.scrollIntoView({block:"nearest"}),cn===It&&ae&&(ae.scrollTop=0),cn===ws&&ae&&(ae.scrollTop=ae.scrollHeight),cn==null||cn.focus(),document.activeElement!==tn))return},[Ht,ae]),Bt=z.useCallback(()=>Vt([Le,q]),[Vt,Le,q]);z.useEffect(()=>{Dt&&Bt()},[Dt,Bt]);const{onOpenChange:ze,triggerPointerDownPosRef:Xe}=W;z.useEffect(()=>{if(q){let Xt={x:0,y:0};const It=ws=>{var tn,cn;Xt={x:Math.abs(Math.round(ws.pageX)-(((tn=Xe.current)==null?void 0:tn.x)??0)),y:Math.abs(Math.round(ws.pageY)-(((cn=Xe.current)==null?void 0:cn.y)??0))}},Ns=ws=>{Xt.x<=10&&Xt.y<=10?ws.preventDefault():q.contains(ws.target)||ze(!1),document.removeEventListener("pointermove",It),Xe.current=null};return Xe.current!==null&&(document.addEventListener("pointermove",It),document.addEventListener("pointerup",Ns,{capture:!0,once:!0})),()=>{document.removeEventListener("pointermove",It),document.removeEventListener("pointerup",Ns,{capture:!0})}}},[q,ze,Xe]),z.useEffect(()=>{const Xt=()=>ze(!1);return window.addEventListener("blur",Xt),window.addEventListener("resize",Xt),()=>{window.removeEventListener("blur",Xt),window.removeEventListener("resize",Xt)}},[ze]);const[Ot,nt]=j6(Xt=>{const It=Ht().filter(tn=>!tn.disabled),Ns=It.find(tn=>tn.ref.current===document.activeElement),ws=T6(It,Xt,Ns);ws&&setTimeout(()=>ws.ref.current.focus())}),Mt=z.useCallback((Xt,It,Ns)=>{const ws=!rs.current&&!Ns;(W.value!==void 0&&W.value===It||ws)&&(ct(Xt),ws&&(rs.current=!0))},[W.value]),ss=z.useCallback(()=>q==null?void 0:q.focus(),[q]),Ps=z.useCallback((Xt,It,Ns)=>{const ws=!rs.current&&!Ns;(W.value!==void 0&&W.value===It||ws)&&yt(Xt)},[W.value]),xn=d==="popper"?qE:l6,Ms=xn===qE?{side:o,sideOffset:E,align:P,alignOffset:M,arrowPadding:L,collisionBoundary:F,collisionPadding:$,sticky:Y,hideWhenDetached:H,avoidCollisions:X}:{};return n.jsx(o6,{scope:l,content:q,viewport:ae,onViewportChange:Ne,itemRefCallback:Mt,selectedItem:Le,onItemLeave:ss,itemTextRefCallback:Ps,focusSelectedItem:Bt,selectedItemText:xt,position:d,isPositioned:Dt,searchRef:Ot,children:n.jsx(rS,{as:$se,allowPinchZoom:!0,children:n.jsx(sS,{asChild:!0,trapped:W.open,onMountAutoFocus:Xt=>{Xt.preventDefault()},onUnmountAutoFocus:bs(m,Xt=>{var It;(It=W.trigger)==null||It.focus({preventScroll:!0}),Xt.preventDefault()}),children:n.jsx(gx,{asChild:!0,disableOutsidePointerEvents:!0,onEscapeKeyDown:_,onPointerDownOutside:w,onFocusOutside:Xt=>Xt.preventDefault(),onDismiss:()=>W.onOpenChange(!1),children:n.jsx(xn,{role:"listbox",id:W.contentId,"data-state":W.open?"open":"closed",dir:W.dir,onContextMenu:Xt=>Xt.preventDefault(),...Z,...Ms,onPlaced:()=>wt(!0),ref:Pe,style:{display:"flex",flexDirection:"column",outline:"none",...Z.style},onKeyDown:bs(Z.onKeyDown,Xt=>{const It=Xt.ctrlKey||Xt.altKey||Xt.metaKey;if(Xt.key==="Tab"&&Xt.preventDefault(),!It&&Xt.key.length===1&&nt(Xt.key),["ArrowUp","ArrowDown","Home","End"].includes(Xt.key)){let ws=Ht().filter(tn=>!tn.disabled).map(tn=>tn.ref.current);if(["ArrowUp","End"].includes(Xt.key)&&(ws=ws.slice().reverse()),["ArrowUp","ArrowDown"].includes(Xt.key)){const tn=Xt.target,cn=ws.indexOf(tn);ws=ws.slice(cn+1)}setTimeout(()=>Vt(ws)),Xt.preventDefault()}})})})})})})});a6.displayName=Use;var Gse="SelectItemAlignedPosition",l6=z.forwardRef((e,s)=>{const{__scopeSelect:l,onPlaced:d,...m}=e,_=$h(jf,l),w=Gh(jf,l),[o,E]=z.useState(null),[P,M]=z.useState(null),L=Gn(s,Pe=>M(Pe)),F=lS(l),$=z.useRef(!1),Y=z.useRef(!0),{viewport:H,selectedItem:X,selectedItemText:Z,focusSelectedItem:W}=w,q=z.useCallback(()=>{if(_.trigger&&_.valueNode&&o&&P&&H&&X&&Z){const Pe=_.trigger.getBoundingClientRect(),Le=P.getBoundingClientRect(),ct=_.valueNode.getBoundingClientRect(),xt=Z.getBoundingClientRect();if(_.dir!=="rtl"){const tn=xt.left-Le.left,cn=ct.left-tn,wr=Pe.left-cn,cr=Pe.width+wr,vn=Math.max(cr,Le.width),Js=window.innerWidth-Zl,Rr=WE(cn,[Zl,Math.max(Zl,Js-vn)]);o.style.minWidth=cr+"px",o.style.left=Rr+"px"}else{const tn=Le.right-xt.right,cn=window.innerWidth-ct.right-tn,wr=window.innerWidth-Pe.right-cn,cr=Pe.width+wr,vn=Math.max(cr,Le.width),Js=window.innerWidth-Zl,Rr=WE(cn,[Zl,Math.max(Zl,Js-vn)]);o.style.minWidth=cr+"px",o.style.right=Rr+"px"}const yt=F(),Ht=window.innerHeight-Zl*2,Dt=H.scrollHeight,wt=window.getComputedStyle(P),rs=parseInt(wt.borderTopWidth,10),Vt=parseInt(wt.paddingTop,10),Bt=parseInt(wt.borderBottomWidth,10),ze=parseInt(wt.paddingBottom,10),Xe=rs+Vt+Dt+ze+Bt,Ot=Math.min(X.offsetHeight*5,Xe),nt=window.getComputedStyle(H),Mt=parseInt(nt.paddingTop,10),ss=parseInt(nt.paddingBottom,10),Ps=Pe.top+Pe.height/2-Zl,xn=Ht-Ps,Ms=X.offsetHeight/2,Xt=X.offsetTop+Ms,It=rs+Vt+Xt,Ns=Xe-It;if(It<=Ps){const tn=yt.length>0&&X===yt[yt.length-1].ref.current;o.style.bottom="0px";const cn=P.clientHeight-H.offsetTop-H.offsetHeight,wr=Math.max(xn,Ms+(tn?ss:0)+cn+Bt),cr=It+wr;o.style.height=cr+"px"}else{const tn=yt.length>0&&X===yt[0].ref.current;o.style.top="0px";const wr=Math.max(Ps,rs+H.offsetTop+(tn?Mt:0)+Ms)+Ns;o.style.height=wr+"px",H.scrollTop=It-Ps+H.offsetTop}o.style.margin=`${Zl}px 0`,o.style.minHeight=Ot+"px",o.style.maxHeight=Ht+"px",d==null||d(),requestAnimationFrame(()=>$.current=!0)}},[F,_.trigger,_.valueNode,o,P,H,X,Z,_.dir,d]);Fi(()=>q(),[q]);const[oe,ae]=z.useState();Fi(()=>{P&&ae(window.getComputedStyle(P).zIndex)},[P]);const Ne=z.useCallback(Pe=>{Pe&&Y.current===!0&&(q(),W==null||W(),Y.current=!1)},[q,W]);return n.jsx(Wse,{scope:l,contentWrapper:o,shouldExpandOnScrollRef:$,onScrollButtonChange:Ne,children:n.jsx("div",{ref:E,style:{display:"flex",flexDirection:"column",position:"fixed",zIndex:oe},children:n.jsx(Ys.div,{...m,ref:L,style:{boxSizing:"border-box",maxHeight:"100%",...m.style}})})})});l6.displayName=Gse;var Hse="SelectPopperPosition",qE=z.forwardRef((e,s)=>{const{__scopeSelect:l,align:d="start",collisionPadding:m=Zl,..._}=e,w=cS(l);return n.jsx(DA,{...w,..._,ref:s,align:d,collisionPadding:m,style:{boxSizing:"border-box",..._.style,"--radix-select-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-select-content-available-width":"var(--radix-popper-available-width)","--radix-select-content-available-height":"var(--radix-popper-available-height)","--radix-select-trigger-width":"var(--radix-popper-anchor-width)","--radix-select-trigger-height":"var(--radix-popper-anchor-height)"}})});qE.displayName=Hse;var[Wse,lP]=Tx(jf,{}),ZE="SelectViewport",c6=z.forwardRef((e,s)=>{const{__scopeSelect:l,nonce:d,...m}=e,_=Gh(ZE,l),w=lP(ZE,l),o=Gn(s,_.onViewportChange),E=z.useRef(0);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-select-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-select-viewport]::-webkit-scrollbar{display:none}"},nonce:d}),n.jsx(aS.Slot,{scope:l,children:n.jsx(Ys.div,{"data-radix-select-viewport":"",role:"presentation",...m,ref:o,style:{position:"relative",flex:1,overflow:"hidden auto",...m.style},onScroll:bs(m.onScroll,P=>{const M=P.currentTarget,{contentWrapper:L,shouldExpandOnScrollRef:F}=w;if(F!=null&&F.current&&L){const $=Math.abs(E.current-M.scrollTop);if($>0){const Y=window.innerHeight-Zl*2,H=parseFloat(L.style.minHeight),X=parseFloat(L.style.height),Z=Math.max(H,X);if(Z<Y){const W=Z+$,q=Math.min(Y,W),oe=W-q;L.style.height=q+"px",L.style.bottom==="0px"&&(M.scrollTop=oe>0?oe:0,L.style.justifyContent="flex-end")}}}E.current=M.scrollTop})})})]})});c6.displayName=ZE;var u6="SelectGroup",[qse,Zse]=Tx(u6),Kse=z.forwardRef((e,s)=>{const{__scopeSelect:l,...d}=e,m=Qc();return n.jsx(qse,{scope:l,id:m,children:n.jsx(Ys.div,{role:"group","aria-labelledby":m,...d,ref:s})})});Kse.displayName=u6;var d6="SelectLabel",h6=z.forwardRef((e,s)=>{const{__scopeSelect:l,...d}=e,m=Zse(d6,l);return n.jsx(Ys.div,{id:m.id,...d,ref:s})});h6.displayName=d6;var i2="SelectItem",[Xse,p6]=Tx(i2),f6=z.forwardRef((e,s)=>{const{__scopeSelect:l,value:d,disabled:m=!1,textValue:_,...w}=e,o=$h(i2,l),E=Gh(i2,l),P=o.value===d,[M,L]=z.useState(_??""),[F,$]=z.useState(!1),Y=Gn(s,W=>{var q;return(q=E.itemRefCallback)==null?void 0:q.call(E,W,d,m)}),H=Qc(),X=z.useRef("touch"),Z=()=>{m||(o.onValueChange(d),o.onOpenChange(!1))};if(d==="")throw new Error("A <Select.Item /> must have a value prop that is not an empty string. This is because the Select value can be set to an empty string to clear the selection and show the placeholder.");return n.jsx(Xse,{scope:l,value:d,disabled:m,textId:H,isSelected:P,onItemTextChange:z.useCallback(W=>{L(q=>q||((W==null?void 0:W.textContent)??"").trim())},[]),children:n.jsx(aS.ItemSlot,{scope:l,value:d,disabled:m,textValue:M,children:n.jsx(Ys.div,{role:"option","aria-labelledby":H,"data-highlighted":F?"":void 0,"aria-selected":P&&F,"data-state":P?"checked":"unchecked","aria-disabled":m||void 0,"data-disabled":m?"":void 0,tabIndex:m?void 0:-1,...w,ref:Y,onFocus:bs(w.onFocus,()=>$(!0)),onBlur:bs(w.onBlur,()=>$(!1)),onClick:bs(w.onClick,()=>{X.current!=="mouse"&&Z()}),onPointerUp:bs(w.onPointerUp,()=>{X.current==="mouse"&&Z()}),onPointerDown:bs(w.onPointerDown,W=>{X.current=W.pointerType}),onPointerMove:bs(w.onPointerMove,W=>{var q;X.current=W.pointerType,m?(q=E.onItemLeave)==null||q.call(E):X.current==="mouse"&&W.currentTarget.focus({preventScroll:!0})}),onPointerLeave:bs(w.onPointerLeave,W=>{var q;W.currentTarget===document.activeElement&&((q=E.onItemLeave)==null||q.call(E))}),onKeyDown:bs(w.onKeyDown,W=>{var oe;((oe=E.searchRef)==null?void 0:oe.current)!==""&&W.key===" "||(Dse.includes(W.key)&&Z(),W.key===" "&&W.preventDefault())})})})})});f6.displayName=i2;var W_="SelectItemText",m6=z.forwardRef((e,s)=>{const{__scopeSelect:l,className:d,style:m,..._}=e,w=$h(W_,l),o=Gh(W_,l),E=p6(W_,l),P=Fse(W_,l),[M,L]=z.useState(null),F=Gn(s,Z=>L(Z),E.onItemTextChange,Z=>{var W;return(W=o.itemTextRefCallback)==null?void 0:W.call(o,Z,E.value,E.disabled)}),$=M==null?void 0:M.textContent,Y=z.useMemo(()=>n.jsx("option",{value:E.value,disabled:E.disabled,children:$},E.value),[E.disabled,E.value,$]),{onNativeOptionAdd:H,onNativeOptionRemove:X}=P;return Fi(()=>(H(Y),()=>X(Y)),[H,X,Y]),n.jsxs(n.Fragment,{children:[n.jsx(Ys.span,{id:E.textId,..._,ref:F}),E.isSelected&&w.valueNode&&!w.valueNodeHasChildren?Ef.createPortal(_.children,w.valueNode):null]})});m6.displayName=W_;var g6="SelectItemIndicator",x6=z.forwardRef((e,s)=>{const{__scopeSelect:l,...d}=e;return p6(g6,l).isSelected?n.jsx(Ys.span,{"aria-hidden":!0,...d,ref:s}):null});x6.displayName=g6;var KE="SelectScrollUpButton",y6=z.forwardRef((e,s)=>{const l=Gh(KE,e.__scopeSelect),d=lP(KE,e.__scopeSelect),[m,_]=z.useState(!1),w=Gn(s,d.onScrollButtonChange);return Fi(()=>{if(l.viewport&&l.isPositioned){let o=function(){const P=E.scrollTop>0;_(P)};const E=l.viewport;return o(),E.addEventListener("scroll",o),()=>E.removeEventListener("scroll",o)}},[l.viewport,l.isPositioned]),m?n.jsx(v6,{...e,ref:w,onAutoScroll:()=>{const{viewport:o,selectedItem:E}=l;o&&E&&(o.scrollTop=o.scrollTop-E.offsetHeight)}}):null});y6.displayName=KE;var XE="SelectScrollDownButton",_6=z.forwardRef((e,s)=>{const l=Gh(XE,e.__scopeSelect),d=lP(XE,e.__scopeSelect),[m,_]=z.useState(!1),w=Gn(s,d.onScrollButtonChange);return Fi(()=>{if(l.viewport&&l.isPositioned){let o=function(){const P=E.scrollHeight-E.clientHeight,M=Math.ceil(E.scrollTop)<P;_(M)};const E=l.viewport;return o(),E.addEventListener("scroll",o),()=>E.removeEventListener("scroll",o)}},[l.viewport,l.isPositioned]),m?n.jsx(v6,{...e,ref:w,onAutoScroll:()=>{const{viewport:o,selectedItem:E}=l;o&&E&&(o.scrollTop=o.scrollTop+E.offsetHeight)}}):null});_6.displayName=XE;var v6=z.forwardRef((e,s)=>{const{__scopeSelect:l,onAutoScroll:d,...m}=e,_=Gh("SelectScrollButton",l),w=z.useRef(null),o=lS(l),E=z.useCallback(()=>{w.current!==null&&(window.clearInterval(w.current),w.current=null)},[]);return z.useEffect(()=>()=>E(),[E]),Fi(()=>{var M;const P=o().find(L=>L.ref.current===document.activeElement);(M=P==null?void 0:P.ref.current)==null||M.scrollIntoView({block:"nearest"})},[o]),n.jsx(Ys.div,{"aria-hidden":!0,...m,ref:s,style:{flexShrink:0,...m.style},onPointerDown:bs(m.onPointerDown,()=>{w.current===null&&(w.current=window.setInterval(d,50))}),onPointerMove:bs(m.onPointerMove,()=>{var P;(P=_.onItemLeave)==null||P.call(_),w.current===null&&(w.current=window.setInterval(d,50))}),onPointerLeave:bs(m.onPointerLeave,()=>{E()})})}),Yse="SelectSeparator",b6=z.forwardRef((e,s)=>{const{__scopeSelect:l,...d}=e;return n.jsx(Ys.div,{"aria-hidden":!0,...d,ref:s})});b6.displayName=Yse;var YE="SelectArrow",Jse=z.forwardRef((e,s)=>{const{__scopeSelect:l,...d}=e,m=cS(l),_=$h(YE,l),w=Gh(YE,l);return _.open&&w.position==="popper"?n.jsx(LA,{...m,...d,ref:s}):null});Jse.displayName=YE;var Qse="SelectBubbleInput",w6=z.forwardRef(({__scopeSelect:e,value:s,...l},d)=>{const m=z.useRef(null),_=Gn(d,m),w=aP(s);return z.useEffect(()=>{const o=m.current;if(!o)return;const E=window.HTMLSelectElement.prototype,M=Object.getOwnPropertyDescriptor(E,"value").set;if(w!==s&&M){const L=new Event("change",{bubbles:!0});M.call(o,s),o.dispatchEvent(L)}},[w,s]),n.jsx(Ys.select,{...l,style:{...JF,...l.style},ref:_,defaultValue:s})});w6.displayName=Qse;function S6(e){return e===""||e===void 0}function j6(e){const s=Ci(e),l=z.useRef(""),d=z.useRef(0),m=z.useCallback(w=>{const o=l.current+w;s(o),function E(P){l.current=P,window.clearTimeout(d.current),P!==""&&(d.current=window.setTimeout(()=>E(""),1e3))}(o)},[s]),_=z.useCallback(()=>{l.current="",window.clearTimeout(d.current)},[]);return z.useEffect(()=>()=>window.clearTimeout(d.current),[]),[l,m,_]}function T6(e,s,l){const m=s.length>1&&Array.from(s).every(P=>P===s[0])?s[0]:s,_=l?e.indexOf(l):-1;let w=ene(e,Math.max(_,0));m.length===1&&(w=w.filter(P=>P!==l));const E=w.find(P=>P.textValue.toLowerCase().startsWith(m.toLowerCase()));return E!==l?E:void 0}function ene(e,s){return e.map((l,d)=>e[(s+d)%e.length])}var tne=JB,N6=e6,sne=s6,nne=n6,rne=r6,E6=i6,ine=c6,C6=h6,A6=f6,one=m6,ane=x6,P6=y6,I6=_6,M6=b6;const qn=tne,Zn=sne,Un=z.forwardRef(({className:e,children:s,...l},d)=>n.jsxs(N6,{ref:d,className:Ds("flex h-10 w-full items-center justify-between rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 [&>span]:line-clamp-1",e),...l,children:[s,n.jsx(nne,{asChild:!0,children:n.jsx(W2,{className:"h-4 w-4 opacity-50"})})]}));Un.displayName=N6.displayName;const R6=z.forwardRef(({className:e,...s},l)=>n.jsx(P6,{ref:l,className:Ds("flex cursor-default items-center justify-center py-1",e),...s,children:n.jsx(LJ,{className:"h-4 w-4"})}));R6.displayName=P6.displayName;const k6=z.forwardRef(({className:e,...s},l)=>n.jsx(I6,{ref:l,className:Ds("flex cursor-default items-center justify-center py-1",e),...s,children:n.jsx(W2,{className:"h-4 w-4"})}));k6.displayName=I6.displayName;const $n=z.forwardRef(({className:e,children:s,position:l="popper",...d},m)=>n.jsx(rne,{children:n.jsxs(E6,{ref:m,className:Ds("relative z-50 max-h-96 min-w-[8rem] overflow-hidden rounded-md border bg-popover text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",l==="popper"&&"data-[side=bottom]:translate-y-1 data-[side=left]:-translate-x-1 data-[side=right]:translate-x-1 data-[side=top]:-translate-y-1",e),position:l,...d,children:[n.jsx(R6,{}),n.jsx(ine,{className:Ds("p-1",l==="popper"&&"h-[var(--radix-select-trigger-height)] w-full min-w-[var(--radix-select-trigger-width)]"),children:s}),n.jsx(k6,{})]})}));$n.displayName=E6.displayName;const lne=z.forwardRef(({className:e,...s},l)=>n.jsx(C6,{ref:l,className:Ds("py-1.5 pl-8 pr-2 text-sm font-semibold",e),...s}));lne.displayName=C6.displayName;const it=z.forwardRef(({className:e,children:s,...l},d)=>n.jsxs(A6,{ref:d,className:Ds("relative flex w-full cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...l,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(ane,{children:n.jsx(Eh,{className:"h-4 w-4"})})}),n.jsx(one,{children:s})]}));it.displayName=A6.displayName;const cne=z.forwardRef(({className:e,...s},l)=>n.jsx(M6,{ref:l,className:Ds("-mx-1 my-1 h-px bg-muted",e),...s}));cne.displayName=M6.displayName;var uS="Checkbox",[une,Vde]=Xo(uS),[dne,cP]=une(uS);function hne(e){const{__scopeCheckbox:s,checked:l,children:d,defaultChecked:m,disabled:_,form:w,name:o,onCheckedChange:E,required:P,value:M="on",internal_do_not_use_render:L}=e,[F,$]=Qu({prop:l,defaultProp:m??!1,onChange:E,caller:uS}),[Y,H]=z.useState(null),[X,Z]=z.useState(null),W=z.useRef(!1),q=Y?!!w||!!Y.closest("form"):!0,oe={checked:F,disabled:_,setChecked:$,control:Y,setControl:H,name:o,form:w,value:M,hasConsumerStoppedPropagationRef:W,required:P,defaultChecked:Ch(m)?!1:m,isFormControl:q,bubbleInput:X,setBubbleInput:Z};return n.jsx(dne,{scope:s,...oe,children:pne(L)?L(oe):d})}var D6="CheckboxTrigger",L6=z.forwardRef(({__scopeCheckbox:e,onKeyDown:s,onClick:l,...d},m)=>{const{control:_,value:w,disabled:o,checked:E,required:P,setControl:M,setChecked:L,hasConsumerStoppedPropagationRef:F,isFormControl:$,bubbleInput:Y}=cP(D6,e),H=Gn(m,M),X=z.useRef(E);return z.useEffect(()=>{const Z=_==null?void 0:_.form;if(Z){const W=()=>L(X.current);return Z.addEventListener("reset",W),()=>Z.removeEventListener("reset",W)}},[_,L]),n.jsx(Ys.button,{type:"button",role:"checkbox","aria-checked":Ch(E)?"mixed":E,"aria-required":P,"data-state":V6(E),"data-disabled":o?"":void 0,disabled:o,value:w,...d,ref:H,onKeyDown:bs(s,Z=>{Z.key==="Enter"&&Z.preventDefault()}),onClick:bs(l,Z=>{L(W=>Ch(W)?!0:!W),Y&&$&&(F.current=Z.isPropagationStopped(),F.current||Z.stopPropagation())})})});L6.displayName=D6;var uP=z.forwardRef((e,s)=>{const{__scopeCheckbox:l,name:d,checked:m,defaultChecked:_,required:w,disabled:o,value:E,onCheckedChange:P,form:M,...L}=e;return n.jsx(hne,{__scopeCheckbox:l,checked:m,defaultChecked:_,disabled:o,required:w,onCheckedChange:P,name:d,form:M,value:E,internal_do_not_use_render:({isFormControl:F})=>n.jsxs(n.Fragment,{children:[n.jsx(L6,{...L,ref:s,__scopeCheckbox:l}),F&&n.jsx(B6,{__scopeCheckbox:l})]})})});uP.displayName=uS;var z6="CheckboxIndicator",O6=z.forwardRef((e,s)=>{const{__scopeCheckbox:l,forceMount:d,...m}=e,_=cP(z6,l);return n.jsx(Yo,{present:d||Ch(_.checked)||_.checked===!0,children:n.jsx(Ys.span,{"data-state":V6(_.checked),"data-disabled":_.disabled?"":void 0,...m,ref:s,style:{pointerEvents:"none",...e.style}})})});O6.displayName=z6;var F6="CheckboxBubbleInput",B6=z.forwardRef(({__scopeCheckbox:e,...s},l)=>{const{control:d,hasConsumerStoppedPropagationRef:m,checked:_,defaultChecked:w,required:o,disabled:E,name:P,value:M,form:L,bubbleInput:F,setBubbleInput:$}=cP(F6,e),Y=Gn(l,$),H=aP(_),X=IA(d);z.useEffect(()=>{const W=F;if(!W)return;const q=window.HTMLInputElement.prototype,ae=Object.getOwnPropertyDescriptor(q,"checked").set,Ne=!m.current;if(H!==_&&ae){const Pe=new Event("click",{bubbles:Ne});W.indeterminate=Ch(_),ae.call(W,Ch(_)?!1:_),W.dispatchEvent(Pe)}},[F,H,_,m]);const Z=z.useRef(Ch(_)?!1:_);return n.jsx(Ys.input,{type:"checkbox","aria-hidden":!0,defaultChecked:w??Z.current,required:o,disabled:E,name:P,value:M,form:L,...s,tabIndex:-1,ref:Y,style:{...s.style,...X,position:"absolute",pointerEvents:"none",opacity:0,margin:0,transform:"translateX(-100%)"}})});B6.displayName=F6;function pne(e){return typeof e=="function"}function Ch(e){return e==="indeterminate"}function V6(e){return Ch(e)?"indeterminate":e?"checked":"unchecked"}const sl=z.forwardRef(({className:e,...s},l)=>n.jsx(uP,{ref:l,className:Ds("peer h-4 w-4 shrink-0 rounded-sm border border-primary ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=checked]:text-primary-foreground",e),...s,children:n.jsx(O6,{className:Ds("flex items-center justify-center text-current"),children:n.jsx(Eh,{className:"h-4 w-4"})})}));sl.displayName=uP.displayName;function fne(e,s){return z.useReducer((l,d)=>s[l][d]??l,e)}var dP="ScrollArea",[U6,Ude]=Xo(dP),[mne,Ml]=U6(dP),$6=z.forwardRef((e,s)=>{const{__scopeScrollArea:l,type:d="hover",dir:m,scrollHideDelay:_=600,...w}=e,[o,E]=z.useState(null),[P,M]=z.useState(null),[L,F]=z.useState(null),[$,Y]=z.useState(null),[H,X]=z.useState(null),[Z,W]=z.useState(0),[q,oe]=z.useState(0),[ae,Ne]=z.useState(!1),[Pe,Le]=z.useState(!1),ct=Gn(s,yt=>E(yt)),xt=dv(m);return n.jsx(mne,{scope:l,type:d,dir:xt,scrollHideDelay:_,scrollArea:o,viewport:P,onViewportChange:M,content:L,onContentChange:F,scrollbarX:$,onScrollbarXChange:Y,scrollbarXEnabled:ae,onScrollbarXEnabledChange:Ne,scrollbarY:H,onScrollbarYChange:X,scrollbarYEnabled:Pe,onScrollbarYEnabledChange:Le,onCornerWidthChange:W,onCornerHeightChange:oe,children:n.jsx(Ys.div,{dir:xt,...w,ref:ct,style:{position:"relative","--radix-scroll-area-corner-width":Z+"px","--radix-scroll-area-corner-height":q+"px",...e.style}})})});$6.displayName=dP;var G6="ScrollAreaViewport",H6=z.forwardRef((e,s)=>{const{__scopeScrollArea:l,children:d,nonce:m,..._}=e,w=Ml(G6,l),o=z.useRef(null),E=Gn(s,o,w.onViewportChange);return n.jsxs(n.Fragment,{children:[n.jsx("style",{dangerouslySetInnerHTML:{__html:"[data-radix-scroll-area-viewport]{scrollbar-width:none;-ms-overflow-style:none;-webkit-overflow-scrolling:touch;}[data-radix-scroll-area-viewport]::-webkit-scrollbar{display:none}"},nonce:m}),n.jsx(Ys.div,{"data-radix-scroll-area-viewport":"",..._,ref:E,style:{overflowX:w.scrollbarXEnabled?"scroll":"hidden",overflowY:w.scrollbarYEnabled?"scroll":"hidden",...e.style},children:n.jsx("div",{ref:w.onContentChange,style:{minWidth:"100%",display:"table"},children:d})})]})});H6.displayName=G6;var uu="ScrollAreaScrollbar",hP=z.forwardRef((e,s)=>{const{forceMount:l,...d}=e,m=Ml(uu,e.__scopeScrollArea),{onScrollbarXEnabledChange:_,onScrollbarYEnabledChange:w}=m,o=e.orientation==="horizontal";return z.useEffect(()=>(o?_(!0):w(!0),()=>{o?_(!1):w(!1)}),[o,_,w]),m.type==="hover"?n.jsx(gne,{...d,ref:s,forceMount:l}):m.type==="scroll"?n.jsx(xne,{...d,ref:s,forceMount:l}):m.type==="auto"?n.jsx(W6,{...d,ref:s,forceMount:l}):m.type==="always"?n.jsx(pP,{...d,ref:s}):null});hP.displayName=uu;var gne=z.forwardRef((e,s)=>{const{forceMount:l,...d}=e,m=Ml(uu,e.__scopeScrollArea),[_,w]=z.useState(!1);return z.useEffect(()=>{const o=m.scrollArea;let E=0;if(o){const P=()=>{window.clearTimeout(E),w(!0)},M=()=>{E=window.setTimeout(()=>w(!1),m.scrollHideDelay)};return o.addEventListener("pointerenter",P),o.addEventListener("pointerleave",M),()=>{window.clearTimeout(E),o.removeEventListener("pointerenter",P),o.removeEventListener("pointerleave",M)}}},[m.scrollArea,m.scrollHideDelay]),n.jsx(Yo,{present:l||_,children:n.jsx(W6,{"data-state":_?"visible":"hidden",...d,ref:s})})}),xne=z.forwardRef((e,s)=>{const{forceMount:l,...d}=e,m=Ml(uu,e.__scopeScrollArea),_=e.orientation==="horizontal",w=hS(()=>E("SCROLL_END"),100),[o,E]=fne("hidden",{hidden:{SCROLL:"scrolling"},scrolling:{SCROLL_END:"idle",POINTER_ENTER:"interacting"},interacting:{SCROLL:"interacting",POINTER_LEAVE:"idle"},idle:{HIDE:"hidden",SCROLL:"scrolling",POINTER_ENTER:"interacting"}});return z.useEffect(()=>{if(o==="idle"){const P=window.setTimeout(()=>E("HIDE"),m.scrollHideDelay);return()=>window.clearTimeout(P)}},[o,m.scrollHideDelay,E]),z.useEffect(()=>{const P=m.viewport,M=_?"scrollLeft":"scrollTop";if(P){let L=P[M];const F=()=>{const $=P[M];L!==$&&(E("SCROLL"),w()),L=$};return P.addEventListener("scroll",F),()=>P.removeEventListener("scroll",F)}},[m.viewport,_,E,w]),n.jsx(Yo,{present:l||o!=="hidden",children:n.jsx(pP,{"data-state":o==="hidden"?"hidden":"visible",...d,ref:s,onPointerEnter:bs(e.onPointerEnter,()=>E("POINTER_ENTER")),onPointerLeave:bs(e.onPointerLeave,()=>E("POINTER_LEAVE"))})})}),W6=z.forwardRef((e,s)=>{const l=Ml(uu,e.__scopeScrollArea),{forceMount:d,...m}=e,[_,w]=z.useState(!1),o=e.orientation==="horizontal",E=hS(()=>{if(l.viewport){const P=l.viewport.offsetWidth<l.viewport.scrollWidth,M=l.viewport.offsetHeight<l.viewport.scrollHeight;w(o?P:M)}},10);return ax(l.viewport,E),ax(l.content,E),n.jsx(Yo,{present:d||_,children:n.jsx(pP,{"data-state":_?"visible":"hidden",...m,ref:s})})}),pP=z.forwardRef((e,s)=>{const{orientation:l="vertical",...d}=e,m=Ml(uu,e.__scopeScrollArea),_=z.useRef(null),w=z.useRef(0),[o,E]=z.useState({content:0,viewport:0,scrollbar:{size:0,paddingStart:0,paddingEnd:0}}),P=Y6(o.viewport,o.content),M={...d,sizes:o,onSizesChange:E,hasThumb:P>0&&P<1,onThumbChange:F=>_.current=F,onThumbPointerUp:()=>w.current=0,onThumbPointerDown:F=>w.current=F};function L(F,$){return Sne(F,w.current,o,$)}return l==="horizontal"?n.jsx(yne,{...M,ref:s,onThumbPositionChange:()=>{if(m.viewport&&_.current){const F=m.viewport.scrollLeft,$=_L(F,o,m.dir);_.current.style.transform=`translate3d(${$}px, 0, 0)`}},onWheelScroll:F=>{m.viewport&&(m.viewport.scrollLeft=F)},onDragScroll:F=>{m.viewport&&(m.viewport.scrollLeft=L(F,m.dir))}}):l==="vertical"?n.jsx(_ne,{...M,ref:s,onThumbPositionChange:()=>{if(m.viewport&&_.current){const F=m.viewport.scrollTop,$=_L(F,o);_.current.style.transform=`translate3d(0, ${$}px, 0)`}},onWheelScroll:F=>{m.viewport&&(m.viewport.scrollTop=F)},onDragScroll:F=>{m.viewport&&(m.viewport.scrollTop=L(F))}}):null}),yne=z.forwardRef((e,s)=>{const{sizes:l,onSizesChange:d,...m}=e,_=Ml(uu,e.__scopeScrollArea),[w,o]=z.useState(),E=z.useRef(null),P=Gn(s,E,_.onScrollbarXChange);return z.useEffect(()=>{E.current&&o(getComputedStyle(E.current))},[E]),n.jsx(Z6,{"data-orientation":"horizontal",...m,ref:P,sizes:l,style:{bottom:0,left:_.dir==="rtl"?"var(--radix-scroll-area-corner-width)":0,right:_.dir==="ltr"?"var(--radix-scroll-area-corner-width)":0,"--radix-scroll-area-thumb-width":dS(l)+"px",...e.style},onThumbPointerDown:M=>e.onThumbPointerDown(M.x),onDragScroll:M=>e.onDragScroll(M.x),onWheelScroll:(M,L)=>{if(_.viewport){const F=_.viewport.scrollLeft+M.deltaX;e.onWheelScroll(F),Q6(F,L)&&M.preventDefault()}},onResize:()=>{E.current&&_.viewport&&w&&d({content:_.viewport.scrollWidth,viewport:_.viewport.offsetWidth,scrollbar:{size:E.current.clientWidth,paddingStart:a2(w.paddingLeft),paddingEnd:a2(w.paddingRight)}})}})}),_ne=z.forwardRef((e,s)=>{const{sizes:l,onSizesChange:d,...m}=e,_=Ml(uu,e.__scopeScrollArea),[w,o]=z.useState(),E=z.useRef(null),P=Gn(s,E,_.onScrollbarYChange);return z.useEffect(()=>{E.current&&o(getComputedStyle(E.current))},[E]),n.jsx(Z6,{"data-orientation":"vertical",...m,ref:P,sizes:l,style:{top:0,right:_.dir==="ltr"?0:void 0,left:_.dir==="rtl"?0:void 0,bottom:"var(--radix-scroll-area-corner-height)","--radix-scroll-area-thumb-height":dS(l)+"px",...e.style},onThumbPointerDown:M=>e.onThumbPointerDown(M.y),onDragScroll:M=>e.onDragScroll(M.y),onWheelScroll:(M,L)=>{if(_.viewport){const F=_.viewport.scrollTop+M.deltaY;e.onWheelScroll(F),Q6(F,L)&&M.preventDefault()}},onResize:()=>{E.current&&_.viewport&&w&&d({content:_.viewport.scrollHeight,viewport:_.viewport.offsetHeight,scrollbar:{size:E.current.clientHeight,paddingStart:a2(w.paddingTop),paddingEnd:a2(w.paddingBottom)}})}})}),[vne,q6]=U6(uu),Z6=z.forwardRef((e,s)=>{const{__scopeScrollArea:l,sizes:d,hasThumb:m,onThumbChange:_,onThumbPointerUp:w,onThumbPointerDown:o,onThumbPositionChange:E,onDragScroll:P,onWheelScroll:M,onResize:L,...F}=e,$=Ml(uu,l),[Y,H]=z.useState(null),X=Gn(s,ct=>H(ct)),Z=z.useRef(null),W=z.useRef(""),q=$.viewport,oe=d.content-d.viewport,ae=Ci(M),Ne=Ci(E),Pe=hS(L,10);function Le(ct){if(Z.current){const xt=ct.clientX-Z.current.left,yt=ct.clientY-Z.current.top;P({x:xt,y:yt})}}return z.useEffect(()=>{const ct=xt=>{const yt=xt.target;(Y==null?void 0:Y.contains(yt))&&ae(xt,oe)};return document.addEventListener("wheel",ct,{passive:!1}),()=>document.removeEventListener("wheel",ct,{passive:!1})},[q,Y,oe,ae]),z.useEffect(Ne,[d,Ne]),ax(Y,Pe),ax($.content,Pe),n.jsx(vne,{scope:l,scrollbar:Y,hasThumb:m,onThumbChange:Ci(_),onThumbPointerUp:Ci(w),onThumbPositionChange:Ne,onThumbPointerDown:Ci(o),children:n.jsx(Ys.div,{...F,ref:X,style:{position:"absolute",...F.style},onPointerDown:bs(e.onPointerDown,ct=>{ct.button===0&&(ct.target.setPointerCapture(ct.pointerId),Z.current=Y.getBoundingClientRect(),W.current=document.body.style.webkitUserSelect,document.body.style.webkitUserSelect="none",$.viewport&&($.viewport.style.scrollBehavior="auto"),Le(ct))}),onPointerMove:bs(e.onPointerMove,Le),onPointerUp:bs(e.onPointerUp,ct=>{const xt=ct.target;xt.hasPointerCapture(ct.pointerId)&&xt.releasePointerCapture(ct.pointerId),document.body.style.webkitUserSelect=W.current,$.viewport&&($.viewport.style.scrollBehavior=""),Z.current=null})})})}),o2="ScrollAreaThumb",K6=z.forwardRef((e,s)=>{const{forceMount:l,...d}=e,m=q6(o2,e.__scopeScrollArea);return n.jsx(Yo,{present:l||m.hasThumb,children:n.jsx(bne,{ref:s,...d})})}),bne=z.forwardRef((e,s)=>{const{__scopeScrollArea:l,style:d,...m}=e,_=Ml(o2,l),w=q6(o2,l),{onThumbPositionChange:o}=w,E=Gn(s,L=>w.onThumbChange(L)),P=z.useRef(void 0),M=hS(()=>{P.current&&(P.current(),P.current=void 0)},100);return z.useEffect(()=>{const L=_.viewport;if(L){const F=()=>{if(M(),!P.current){const $=jne(L,o);P.current=$,o()}};return o(),L.addEventListener("scroll",F),()=>L.removeEventListener("scroll",F)}},[_.viewport,M,o]),n.jsx(Ys.div,{"data-state":w.hasThumb?"visible":"hidden",...m,ref:E,style:{width:"var(--radix-scroll-area-thumb-width)",height:"var(--radix-scroll-area-thumb-height)",...d},onPointerDownCapture:bs(e.onPointerDownCapture,L=>{const $=L.target.getBoundingClientRect(),Y=L.clientX-$.left,H=L.clientY-$.top;w.onThumbPointerDown({x:Y,y:H})}),onPointerUp:bs(e.onPointerUp,w.onThumbPointerUp)})});K6.displayName=o2;var fP="ScrollAreaCorner",X6=z.forwardRef((e,s)=>{const l=Ml(fP,e.__scopeScrollArea),d=!!(l.scrollbarX&&l.scrollbarY);return l.type!=="scroll"&&d?n.jsx(wne,{...e,ref:s}):null});X6.displayName=fP;var wne=z.forwardRef((e,s)=>{const{__scopeScrollArea:l,...d}=e,m=Ml(fP,l),[_,w]=z.useState(0),[o,E]=z.useState(0),P=!!(_&&o);return ax(m.scrollbarX,()=>{var L;const M=((L=m.scrollbarX)==null?void 0:L.offsetHeight)||0;m.onCornerHeightChange(M),E(M)}),ax(m.scrollbarY,()=>{var L;const M=((L=m.scrollbarY)==null?void 0:L.offsetWidth)||0;m.onCornerWidthChange(M),w(M)}),P?n.jsx(Ys.div,{...d,ref:s,style:{width:_,height:o,position:"absolute",right:m.dir==="ltr"?0:void 0,left:m.dir==="rtl"?0:void 0,bottom:0,...e.style}}):null});function a2(e){return e?parseInt(e,10):0}function Y6(e,s){const l=e/s;return isNaN(l)?0:l}function dS(e){const s=Y6(e.viewport,e.content),l=e.scrollbar.paddingStart+e.scrollbar.paddingEnd,d=(e.scrollbar.size-l)*s;return Math.max(d,18)}function Sne(e,s,l,d="ltr"){const m=dS(l),_=m/2,w=s||_,o=m-w,E=l.scrollbar.paddingStart+w,P=l.scrollbar.size-l.scrollbar.paddingEnd-o,M=l.content-l.viewport,L=d==="ltr"?[0,M]:[M*-1,0];return J6([E,P],L)(e)}function _L(e,s,l="ltr"){const d=dS(s),m=s.scrollbar.paddingStart+s.scrollbar.paddingEnd,_=s.scrollbar.size-m,w=s.content-s.viewport,o=_-d,E=l==="ltr"?[0,w]:[w*-1,0],P=WE(e,E);return J6([0,w],[0,o])(P)}function J6(e,s){return l=>{if(e[0]===e[1]||s[0]===s[1])return s[0];const d=(s[1]-s[0])/(e[1]-e[0]);return s[0]+d*(l-e[0])}}function Q6(e,s){return e>0&&e<s}var jne=(e,s=()=>{})=>{let l={left:e.scrollLeft,top:e.scrollTop},d=0;return function m(){const _={left:e.scrollLeft,top:e.scrollTop},w=l.left!==_.left,o=l.top!==_.top;(w||o)&&s(),l=_,d=window.requestAnimationFrame(m)}(),()=>window.cancelAnimationFrame(d)};function hS(e,s){const l=Ci(e),d=z.useRef(0);return z.useEffect(()=>()=>window.clearTimeout(d.current),[]),z.useCallback(()=>{window.clearTimeout(d.current),d.current=window.setTimeout(l,s)},[l,s])}function ax(e,s){const l=Ci(s);Fi(()=>{let d=0;if(e){const m=new ResizeObserver(()=>{cancelAnimationFrame(d),d=window.requestAnimationFrame(l)});return m.observe(e),()=>{window.cancelAnimationFrame(d),m.unobserve(e)}}},[e,l])}var eV=$6,Tne=H6,Nne=X6;const kh=z.forwardRef(({className:e,children:s,...l},d)=>n.jsxs(eV,{ref:d,className:Ds("relative overflow-hidden",e),...l,children:[n.jsx(Tne,{className:"h-full w-full rounded-[inherit]",children:s}),n.jsx(tV,{}),n.jsx(Nne,{})]}));kh.displayName=eV.displayName;const tV=z.forwardRef(({className:e,orientation:s="vertical",...l},d)=>n.jsx(hP,{ref:d,orientation:s,className:Ds("flex touch-none select-none transition-colors",s==="vertical"&&"h-full w-2.5 border-l border-l-transparent p-[1px]",s==="horizontal"&&"h-2.5 flex-col border-t border-t-transparent p-[1px]",e),...l,children:n.jsx(K6,{className:"relative flex-1 rounded-full bg-border"})}));tV.displayName=hP.displayName;const Ene=({isOpen:e,onClose:s})=>n.jsx(oS,{open:e,onOpenChange:s,children:n.jsxs(av,{className:"sm:max-w-[700px] max-h-[80vh]",children:[n.jsxs(lv,{children:[n.jsx(cv,{children:"Terms and Conditions"}),n.jsx(uv,{children:"Please read these terms carefully before proceeding with your agent application."})]}),n.jsx(kh,{className:"max-h-[60vh] pr-4",children:n.jsxs("div",{className:"space-y-4 text-sm",children:[n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"1. Acceptance of Terms"}),n.jsx("p",{children:"By submitting an application to become a real estate agent on Keja Yangu Kenya, you agree to be bound by these Terms and Conditions. If you do not agree to these terms, please do not proceed with your application."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"2. Eligibility Requirements"}),n.jsx("p",{children:"To become an agent, you must:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"Be at least 18 years old"}),n.jsx("li",{children:"Hold a valid real estate license in Kenya"}),n.jsx("li",{children:"Provide accurate and complete information in your application"}),n.jsx("li",{children:"Agree to comply with all applicable laws and regulations"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"3. Agent Responsibilities"}),n.jsx("p",{children:"As an agent, you agree to:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"Provide accurate property information"}),n.jsx("li",{children:"Act in the best interests of your clients"}),n.jsx("li",{children:"Maintain professional conduct at all times"}),n.jsx("li",{children:"Comply with all real estate regulations"}),n.jsx("li",{children:"Keep your license current and valid"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"4. Commission and Fees"}),n.jsx("p",{children:"Commission rates and fees will be determined based on the services provided and agreements with clients. All commissions are subject to applicable laws and platform policies."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"5. Termination"}),n.jsx("p",{children:"We reserve the right to terminate your agent status at any time for violations of these terms, unethical behavior, or other reasons deemed necessary for the platform's integrity."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"6. Liability"}),n.jsx("p",{children:"Agents are responsible for their own actions and representations. Keja Yangu Kenya is not liable for any disputes arising from agent-client relationships."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"7. Changes to Terms"}),n.jsx("p",{children:"These terms may be updated periodically. Continued use of the platform as an agent constitutes acceptance of any changes."})]})]})})]})}),Cne=({isOpen:e,onClose:s})=>n.jsx(oS,{open:e,onOpenChange:s,children:n.jsxs(av,{className:"sm:max-w-[700px] max-h-[80vh]",children:[n.jsxs(lv,{children:[n.jsx(cv,{children:"Privacy Policy"}),n.jsx(uv,{children:"Learn how we collect, use, and protect your personal information."})]}),n.jsx(kh,{className:"max-h-[60vh] pr-4",children:n.jsxs("div",{className:"space-y-4 text-sm",children:[n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"1. Information We Collect"}),n.jsx("p",{children:"We collect information you provide directly to us, such as when you create an account, submit an agent application, or contact us for support. This includes:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"Name and contact information"}),n.jsx("li",{children:"Real estate license details"}),n.jsx("li",{children:"Professional experience and qualifications"}),n.jsx("li",{children:"Communication preferences"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"2. How We Use Your Information"}),n.jsx("p",{children:"We use the information we collect to:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"Process your agent application"}),n.jsx("li",{children:"Verify your credentials and qualifications"}),n.jsx("li",{children:"Provide customer support"}),n.jsx("li",{children:"Send important updates and notifications"}),n.jsx("li",{children:"Improve our services and platform"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"3. Information Sharing"}),n.jsx("p",{children:"We do not sell, trade, or otherwise transfer your personal information to third parties except in the following circumstances:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"With your explicit consent"}),n.jsx("li",{children:"To comply with legal obligations"}),n.jsx("li",{children:"To protect our rights and safety"}),n.jsx("li",{children:"With service providers who assist our operations"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"4. Data Security"}),n.jsx("p",{children:"We implement appropriate security measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. However, no method of transmission over the internet is 100% secure."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"5. Data Retention"}),n.jsx("p",{children:"We retain your personal information for as long as necessary to provide our services, comply with legal obligations, resolve disputes, and enforce our agreements."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"6. Your Rights"}),n.jsx("p",{children:"You have the right to:"}),n.jsxs("ul",{className:"list-disc list-inside ml-4 space-y-1",children:[n.jsx("li",{children:"Access and update your personal information"}),n.jsx("li",{children:"Request deletion of your data"}),n.jsx("li",{children:"Opt out of marketing communications"}),n.jsx("li",{children:"Data portability"})]})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"7. Cookies and Tracking"}),n.jsx("p",{children:"We use cookies and similar technologies to enhance your experience, analyze usage, and provide personalized content. You can control cookie settings through your browser."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"8. Changes to This Policy"}),n.jsx("p",{children:"We may update this privacy policy periodically. We will notify you of any material changes by posting the new policy on this page and updating the effective date."})]}),n.jsxs("section",{children:[n.jsx("h3",{className:"font-semibold text-base mb-2",children:"9. Contact Us"}),n.jsx("p",{children:"If you have questions about this privacy policy or our data practices, please contact us at privacy@kejayangukenya.com."})]})]})})]})}),Ane=({isOpen:e,onClose:s})=>{const{user:l,isAuthenticated:d,isLoading:m}=mi(),{toast:_}=Bi(),w=Xr(),[o,E]=z.useState(!1),[P,M]=z.useState(!1),[L,F]=z.useState(!1),[$,Y]=z.useState({company:"",licenseNumber:"",experience:"",specializations:[],bio:"",website:"",phone:(l==null?void 0:l.phoneNumber)||"",agreeToTerms:!1});z.useEffect(()=>{e&&!m&&!d&&(_({title:"Authentication Required",description:"Please sign in to apply for agent status.",variant:"destructive"}),s(),w("/auth/signin"))},[e,d,m,s,w,_]);const H=["Residential Sales","Commercial Properties","Property Management","Real Estate Investment","Land Sales","Luxury Properties","Student Housing"],X=(q,oe)=>{Y(ae=>({...ae,[q]:oe}))},Z=(q,oe)=>{Y(ae=>({...ae,specializations:oe?[...ae.specializations,q]:ae.specializations.filter(Ne=>Ne!==q)}))},W=async q=>{var oe,ae,Ne,Pe;if(q.preventDefault(),!d||!l){_({title:"Authentication Required",description:"Please sign in to apply for agent status.",variant:"destructive"}),s(),w("/auth/signin");return}if(!$.agreeToTerms){_({title:"Terms Required",description:"Please agree to the terms and conditions to continue.",variant:"destructive"});return}E(!0);try{const Le={company:$.company,licenseNumber:$.licenseNumber,experience:parseInt($.experience.replace(/[^0-9]/g,"")),specializations:$.specializations,bio:$.bio,website:$.website,phone:$.phone};await Ni.agents.apply(Le),_({title:"Application Submitted!",description:"Your agent application has been submitted successfully. We'll review it and get back to you soon."}),s(),Y({company:"",licenseNumber:"",experience:"",specializations:[],bio:"",website:"",phone:(l==null?void 0:l.phoneNumber)||"",agreeToTerms:!1})}catch(Le){const ct=((ae=(oe=Le.response)==null?void 0:oe.data)==null?void 0:ae.message)||"There was an error submitting your application. Please try again.";if((Pe=(Ne=Le.response)==null?void 0:Ne.data)!=null&&Pe.errors){const yt=Le.response.data.errors.map(Ht=>Ht.message).join(", ");_({title:"Validation Failed",description:yt,variant:"destructive"})}else _({title:"Submission Failed",description:ct,variant:"destructive"})}finally{E(!1)}};return n.jsxs(oS,{open:e,onOpenChange:s,children:[n.jsxs(av,{className:"w-[95vw] max-w-[600px] max-h-[90vh] overflow-y-auto mx-4",children:[n.jsxs(lv,{children:[n.jsx(cv,{className:"text-lg sm:text-xl",children:"Become a Real Estate Agent"}),n.jsx(uv,{className:"text-sm sm:text-base",children:"Fill out this form to apply for agent status. We'll review your application and get back to you."})]}),n.jsxs("form",{onSubmit:W,className:"space-y-4 sm:space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-3 sm:gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"company",children:"Company Name"}),n.jsx(Es,{id:"company",value:$.company,onChange:q=>X("company",q.target.value),placeholder:"Your real estate company",required:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"licenseNumber",children:"License Number"}),n.jsx(Es,{id:"licenseNumber",value:$.licenseNumber,onChange:q=>X("licenseNumber",q.target.value),placeholder:"Your real estate license number",required:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"experience",children:"Years of Experience"}),n.jsxs(qn,{onValueChange:q=>X("experience",q),children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Select experience level"})}),n.jsxs($n,{children:[n.jsx(it,{value:"0-2",children:"0-2 years"}),n.jsx(it,{value:"3-5",children:"3-5 years"}),n.jsx(it,{value:"6-10",children:"6-10 years"}),n.jsx(it,{value:"10+",children:"10+ years"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"phone",children:"Phone Number"}),n.jsx(Es,{id:"phone",type:"tel",value:$.phone,onChange:q=>X("phone",q.target.value),placeholder:"+254 XXX XXX XXX",required:!0})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"website",children:"Website (Optional)"}),n.jsx(Es,{id:"website",type:"url",value:$.website,onChange:q=>X("website",q.target.value),placeholder:"https://yourwebsite.com"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{children:"Specializations"}),n.jsx("div",{className:"grid grid-cols-1 sm:grid-cols-2 gap-2 sm:gap-3",children:H.map(q=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(sl,{id:q,checked:$.specializations.includes(q),onCheckedChange:oe=>Z(q,oe)}),n.jsx(ds,{htmlFor:q,className:"text-xs sm:text-sm",children:q})]},q))})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"bio",children:"Professional Bio"}),n.jsx(Af,{id:"bio",value:$.bio,onChange:q=>X("bio",q.target.value),placeholder:"Tell us about your experience and why you want to become an agent...",rows:4,required:!0})]}),n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(sl,{id:"agreeToTerms",checked:$.agreeToTerms,onCheckedChange:q=>X("agreeToTerms",q),className:"mt-1"}),n.jsxs(ds,{htmlFor:"agreeToTerms",className:"text-xs sm:text-sm leading-relaxed",children:["I agree to the"," ",n.jsx("button",{type:"button",onClick:()=>M(!0),className:"text-blue-600 hover:underline bg-transparent border-none p-0 cursor-pointer text-xs sm:text-sm",children:"Terms and Conditions"})," ","and"," ",n.jsx("button",{type:"button",onClick:()=>F(!0),className:"text-blue-600 hover:underline bg-transparent border-none p-0 cursor-pointer text-xs sm:text-sm",children:"Privacy Policy"})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row justify-end space-y-2 sm:space-y-0 sm:space-x-4 pt-4",children:[n.jsx(dt,{type:"button",variant:"outline",onClick:s,className:"w-full sm:w-auto",children:"Cancel"}),n.jsx(dt,{type:"submit",disabled:o,className:"w-full sm:w-auto",children:o?n.jsxs(n.Fragment,{children:[n.jsx(e2,{className:"mr-2 h-4 w-4 animate-spin"}),"Submitting Application..."]}):"Submit Application"})]})]})]}),n.jsx(Ene,{isOpen:P,onClose:()=>M(!1)}),n.jsx(Cne,{isOpen:L,onClose:()=>F(!1)})]})};var sV={exports:{}},nV={};/**
 * @license React
 * use-sync-external-store-shim.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var lx=z;function Pne(e,s){return e===s&&(e!==0||1/e===1/s)||e!==e&&s!==s}var Ine=typeof Object.is=="function"?Object.is:Pne,Mne=lx.useState,Rne=lx.useEffect,kne=lx.useLayoutEffect,Dne=lx.useDebugValue;function Lne(e,s){var l=s(),d=Mne({inst:{value:l,getSnapshot:s}}),m=d[0].inst,_=d[1];return kne(function(){m.value=l,m.getSnapshot=s,uN(m)&&_({inst:m})},[e,l,s]),Rne(function(){return uN(m)&&_({inst:m}),e(function(){uN(m)&&_({inst:m})})},[e]),Dne(l),l}function uN(e){var s=e.getSnapshot;e=e.value;try{var l=s();return!Ine(e,l)}catch{return!0}}function zne(e,s){return s()}var One=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?zne:Lne;nV.useSyncExternalStore=lx.useSyncExternalStore!==void 0?lx.useSyncExternalStore:One;sV.exports=nV;var Fne=sV.exports;function Bne(){return Fne.useSyncExternalStore(Vne,()=>!0,()=>!1)}function Vne(){return()=>{}}var mP="Avatar",[Une,$de]=Xo(mP),[$ne,rV]=Une(mP),iV=z.forwardRef((e,s)=>{const{__scopeAvatar:l,...d}=e,[m,_]=z.useState("idle");return n.jsx($ne,{scope:l,imageLoadingStatus:m,onImageLoadingStatusChange:_,children:n.jsx(Ys.span,{...d,ref:s})})});iV.displayName=mP;var oV="AvatarImage",aV=z.forwardRef((e,s)=>{const{__scopeAvatar:l,src:d,onLoadingStatusChange:m=()=>{},..._}=e,w=rV(oV,l),o=Gne(d,_),E=Ci(P=>{m(P),w.onImageLoadingStatusChange(P)});return Fi(()=>{o!=="idle"&&E(o)},[o,E]),o==="loaded"?n.jsx(Ys.img,{..._,ref:s,src:d}):null});aV.displayName=oV;var lV="AvatarFallback",cV=z.forwardRef((e,s)=>{const{__scopeAvatar:l,delayMs:d,...m}=e,_=rV(lV,l),[w,o]=z.useState(d===void 0);return z.useEffect(()=>{if(d!==void 0){const E=window.setTimeout(()=>o(!0),d);return()=>window.clearTimeout(E)}},[d]),w&&_.imageLoadingStatus!=="loaded"?n.jsx(Ys.span,{...m,ref:s}):null});cV.displayName=lV;function vL(e,s){return e?s?(e.src!==s&&(e.src=s),e.complete&&e.naturalWidth>0?"loaded":"loading"):"error":"idle"}function Gne(e,{referrerPolicy:s,crossOrigin:l}){const d=Bne(),m=z.useRef(null),_=d?(m.current||(m.current=new window.Image),m.current):null,[w,o]=z.useState(()=>vL(_,e));return Fi(()=>{o(vL(_,e))},[_,e]),Fi(()=>{const E=L=>()=>{o(L)};if(!_)return;const P=E("loaded"),M=E("error");return _.addEventListener("load",P),_.addEventListener("error",M),s&&(_.referrerPolicy=s),typeof l=="string"&&(_.crossOrigin=l),()=>{_.removeEventListener("load",P),_.removeEventListener("error",M)}},[_,l,s]),w}var uV=iV,dV=aV,hV=cV;const al=z.forwardRef(({className:e,...s},l)=>n.jsx(uV,{ref:l,className:Ds("relative flex h-10 w-10 shrink-0 overflow-hidden rounded-full",e),...s}));al.displayName=uV.displayName;const Il=z.forwardRef(({className:e,...s},l)=>n.jsx(dV,{ref:l,className:Ds("aspect-square h-full w-full",e),...s}));Il.displayName=dV.displayName;const ll=z.forwardRef(({className:e,...s},l)=>n.jsx(hV,{ref:l,className:Ds("flex h-full w-full items-center justify-center rounded-full bg-muted",e),...s}));ll.displayName=hV.displayName;var dN="rovingFocusGroup.onEntryFocus",Hne={bubbles:!1,cancelable:!0},hv="RovingFocusGroup",[JE,pV,Wne]=G2(hv),[qne,pS]=Xo(hv,[Wne]),[Zne,Kne]=qne(hv),fV=z.forwardRef((e,s)=>n.jsx(JE.Provider,{scope:e.__scopeRovingFocusGroup,children:n.jsx(JE.Slot,{scope:e.__scopeRovingFocusGroup,children:n.jsx(Xne,{...e,ref:s})})}));fV.displayName=hv;var Xne=z.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:l,orientation:d,loop:m=!1,dir:_,currentTabStopId:w,defaultCurrentTabStopId:o,onCurrentTabStopIdChange:E,onEntryFocus:P,preventScrollOnEntryFocus:M=!1,...L}=e,F=z.useRef(null),$=Gn(s,F),Y=dv(_),[H,X]=Qu({prop:w,defaultProp:o??null,onChange:E,caller:hv}),[Z,W]=z.useState(!1),q=Ci(P),oe=pV(l),ae=z.useRef(!1),[Ne,Pe]=z.useState(0);return z.useEffect(()=>{const Le=F.current;if(Le)return Le.addEventListener(dN,q),()=>Le.removeEventListener(dN,q)},[q]),n.jsx(Zne,{scope:l,orientation:d,dir:Y,loop:m,currentTabStopId:H,onItemFocus:z.useCallback(Le=>X(Le),[X]),onItemShiftTab:z.useCallback(()=>W(!0),[]),onFocusableItemAdd:z.useCallback(()=>Pe(Le=>Le+1),[]),onFocusableItemRemove:z.useCallback(()=>Pe(Le=>Le-1),[]),children:n.jsx(Ys.div,{tabIndex:Z||Ne===0?-1:0,"data-orientation":d,...L,ref:$,style:{outline:"none",...e.style},onMouseDown:bs(e.onMouseDown,()=>{ae.current=!0}),onFocus:bs(e.onFocus,Le=>{const ct=!ae.current;if(Le.target===Le.currentTarget&&ct&&!Z){const xt=new CustomEvent(dN,Hne);if(Le.currentTarget.dispatchEvent(xt),!xt.defaultPrevented){const yt=oe().filter(Vt=>Vt.focusable),Ht=yt.find(Vt=>Vt.active),Dt=yt.find(Vt=>Vt.id===H),rs=[Ht,Dt,...yt].filter(Boolean).map(Vt=>Vt.ref.current);xV(rs,M)}}ae.current=!1}),onBlur:bs(e.onBlur,()=>W(!1))})})}),mV="RovingFocusGroupItem",gV=z.forwardRef((e,s)=>{const{__scopeRovingFocusGroup:l,focusable:d=!0,active:m=!1,tabStopId:_,children:w,...o}=e,E=Qc(),P=_||E,M=Kne(mV,l),L=M.currentTabStopId===P,F=pV(l),{onFocusableItemAdd:$,onFocusableItemRemove:Y,currentTabStopId:H}=M;return z.useEffect(()=>{if(d)return $(),()=>Y()},[d,$,Y]),n.jsx(JE.ItemSlot,{scope:l,id:P,focusable:d,active:m,children:n.jsx(Ys.span,{tabIndex:L?0:-1,"data-orientation":M.orientation,...o,ref:s,onMouseDown:bs(e.onMouseDown,X=>{d?M.onItemFocus(P):X.preventDefault()}),onFocus:bs(e.onFocus,()=>M.onItemFocus(P)),onKeyDown:bs(e.onKeyDown,X=>{if(X.key==="Tab"&&X.shiftKey){M.onItemShiftTab();return}if(X.target!==X.currentTarget)return;const Z=Qne(X,M.orientation,M.dir);if(Z!==void 0){if(X.metaKey||X.ctrlKey||X.altKey||X.shiftKey)return;X.preventDefault();let q=F().filter(oe=>oe.focusable).map(oe=>oe.ref.current);if(Z==="last")q.reverse();else if(Z==="prev"||Z==="next"){Z==="prev"&&q.reverse();const oe=q.indexOf(X.currentTarget);q=M.loop?ere(q,oe+1):q.slice(oe+1)}setTimeout(()=>xV(q))}}),children:typeof w=="function"?w({isCurrentTabStop:L,hasTabStop:H!=null}):w})})});gV.displayName=mV;var Yne={ArrowLeft:"prev",ArrowUp:"prev",ArrowRight:"next",ArrowDown:"next",PageUp:"first",Home:"first",PageDown:"last",End:"last"};function Jne(e,s){return s!=="rtl"?e:e==="ArrowLeft"?"ArrowRight":e==="ArrowRight"?"ArrowLeft":e}function Qne(e,s,l){const d=Jne(e.key,l);if(!(s==="vertical"&&["ArrowLeft","ArrowRight"].includes(d))&&!(s==="horizontal"&&["ArrowUp","ArrowDown"].includes(d)))return Yne[d]}function xV(e,s=!1){const l=document.activeElement;for(const d of e)if(d===l||(d.focus({preventScroll:s}),document.activeElement!==l))return}function ere(e,s){return e.map((l,d)=>e[(s+d)%e.length])}var yV=fV,_V=gV,QE=["Enter"," "],tre=["ArrowDown","PageUp","Home"],vV=["ArrowUp","PageDown","End"],sre=[...tre,...vV],nre={ltr:[...QE,"ArrowRight"],rtl:[...QE,"ArrowLeft"]},rre={ltr:["ArrowLeft"],rtl:["ArrowRight"]},pv="Menu",[L0,ire,ore]=G2(pv),[Pf,bV]=Xo(pv,[ore,_x,pS]),fS=_x(),wV=pS(),[are,If]=Pf(pv),[lre,fv]=Pf(pv),SV=e=>{const{__scopeMenu:s,open:l=!1,children:d,dir:m,onOpenChange:_,modal:w=!0}=e,o=fS(s),[E,P]=z.useState(null),M=z.useRef(!1),L=Ci(_),F=dv(m);return z.useEffect(()=>{const $=()=>{M.current=!0,document.addEventListener("pointerdown",Y,{capture:!0,once:!0}),document.addEventListener("pointermove",Y,{capture:!0,once:!0})},Y=()=>M.current=!1;return document.addEventListener("keydown",$,{capture:!0}),()=>{document.removeEventListener("keydown",$,{capture:!0}),document.removeEventListener("pointerdown",Y,{capture:!0}),document.removeEventListener("pointermove",Y,{capture:!0})}},[]),n.jsx(YF,{...o,children:n.jsx(are,{scope:s,open:l,onOpenChange:L,content:E,onContentChange:P,children:n.jsx(lre,{scope:s,onClose:z.useCallback(()=>L(!1),[L]),isUsingKeyboardRef:M,dir:F,modal:w,children:d})})})};SV.displayName=pv;var cre="MenuAnchor",gP=z.forwardRef((e,s)=>{const{__scopeMenu:l,...d}=e,m=fS(l);return n.jsx(kA,{...m,...d,ref:s})});gP.displayName=cre;var xP="MenuPortal",[ure,jV]=Pf(xP,{forceMount:void 0}),TV=e=>{const{__scopeMenu:s,forceMount:l,children:d,container:m}=e,_=If(xP,s);return n.jsx(ure,{scope:s,forceMount:l,children:n.jsx(Yo,{present:l||_.open,children:n.jsx(J0,{asChild:!0,container:m,children:d})})})};TV.displayName=xP;var El="MenuContent",[dre,yP]=Pf(El),NV=z.forwardRef((e,s)=>{const l=jV(El,e.__scopeMenu),{forceMount:d=l.forceMount,...m}=e,_=If(El,e.__scopeMenu),w=fv(El,e.__scopeMenu);return n.jsx(L0.Provider,{scope:e.__scopeMenu,children:n.jsx(Yo,{present:d||_.open,children:n.jsx(L0.Slot,{scope:e.__scopeMenu,children:w.modal?n.jsx(hre,{...m,ref:s}):n.jsx(pre,{...m,ref:s})})})})}),hre=z.forwardRef((e,s)=>{const l=If(El,e.__scopeMenu),d=z.useRef(null),m=Gn(s,d);return z.useEffect(()=>{const _=d.current;if(_)return JA(_)},[]),n.jsx(_P,{...e,ref:m,trapFocus:l.open,disableOutsidePointerEvents:l.open,disableOutsideScroll:!0,onFocusOutside:bs(e.onFocusOutside,_=>_.preventDefault(),{checkForDefaultPrevented:!1}),onDismiss:()=>l.onOpenChange(!1)})}),pre=z.forwardRef((e,s)=>{const l=If(El,e.__scopeMenu);return n.jsx(_P,{...e,ref:s,trapFocus:!1,disableOutsidePointerEvents:!1,disableOutsideScroll:!1,onDismiss:()=>l.onOpenChange(!1)})}),fre=yf("MenuContent.ScrollLock"),_P=z.forwardRef((e,s)=>{const{__scopeMenu:l,loop:d=!1,trapFocus:m,onOpenAutoFocus:_,onCloseAutoFocus:w,disableOutsidePointerEvents:o,onEntryFocus:E,onEscapeKeyDown:P,onPointerDownOutside:M,onFocusOutside:L,onInteractOutside:F,onDismiss:$,disableOutsideScroll:Y,...H}=e,X=If(El,l),Z=fv(El,l),W=fS(l),q=wV(l),oe=ire(l),[ae,Ne]=z.useState(null),Pe=z.useRef(null),Le=Gn(s,Pe,X.onContentChange),ct=z.useRef(0),xt=z.useRef(""),yt=z.useRef(0),Ht=z.useRef(null),Dt=z.useRef("right"),wt=z.useRef(0),rs=Y?rS:z.Fragment,Vt=Y?{as:fre,allowPinchZoom:!0}:void 0,Bt=Xe=>{var Xt,It;const Ot=xt.current+Xe,nt=oe().filter(Ns=>!Ns.disabled),Mt=document.activeElement,ss=(Xt=nt.find(Ns=>Ns.ref.current===Mt))==null?void 0:Xt.textValue,Ps=nt.map(Ns=>Ns.textValue),xn=Nre(Ps,Ot,ss),Ms=(It=nt.find(Ns=>Ns.textValue===xn))==null?void 0:It.ref.current;(function Ns(ws){xt.current=ws,window.clearTimeout(ct.current),ws!==""&&(ct.current=window.setTimeout(()=>Ns(""),1e3))})(Ot),Ms&&setTimeout(()=>Ms.focus())};z.useEffect(()=>()=>window.clearTimeout(ct.current),[]),YA();const ze=z.useCallback(Xe=>{var nt,Mt;return Dt.current===((nt=Ht.current)==null?void 0:nt.side)&&Cre(Xe,(Mt=Ht.current)==null?void 0:Mt.area)},[]);return n.jsx(dre,{scope:l,searchRef:xt,onItemEnter:z.useCallback(Xe=>{ze(Xe)&&Xe.preventDefault()},[ze]),onItemLeave:z.useCallback(Xe=>{var Ot;ze(Xe)||((Ot=Pe.current)==null||Ot.focus(),Ne(null))},[ze]),onTriggerLeave:z.useCallback(Xe=>{ze(Xe)&&Xe.preventDefault()},[ze]),pointerGraceTimerRef:yt,onPointerGraceIntentChange:z.useCallback(Xe=>{Ht.current=Xe},[]),children:n.jsx(rs,{...Vt,children:n.jsx(sS,{asChild:!0,trapped:m,onMountAutoFocus:bs(_,Xe=>{var Ot;Xe.preventDefault(),(Ot=Pe.current)==null||Ot.focus({preventScroll:!0})}),onUnmountAutoFocus:w,children:n.jsx(gx,{asChild:!0,disableOutsidePointerEvents:o,onEscapeKeyDown:P,onPointerDownOutside:M,onFocusOutside:L,onInteractOutside:F,onDismiss:$,children:n.jsx(yV,{asChild:!0,...q,dir:Z.dir,orientation:"vertical",loop:d,currentTabStopId:ae,onCurrentTabStopIdChange:Ne,onEntryFocus:bs(E,Xe=>{Z.isUsingKeyboardRef.current||Xe.preventDefault()}),preventScrollOnEntryFocus:!0,children:n.jsx(DA,{role:"menu","aria-orientation":"vertical","data-state":UV(X.open),"data-radix-menu-content":"",dir:Z.dir,...W,...H,ref:Le,style:{outline:"none",...H.style},onKeyDown:bs(H.onKeyDown,Xe=>{const nt=Xe.target.closest("[data-radix-menu-content]")===Xe.currentTarget,Mt=Xe.ctrlKey||Xe.altKey||Xe.metaKey,ss=Xe.key.length===1;nt&&(Xe.key==="Tab"&&Xe.preventDefault(),!Mt&&ss&&Bt(Xe.key));const Ps=Pe.current;if(Xe.target!==Ps||!sre.includes(Xe.key))return;Xe.preventDefault();const Ms=oe().filter(Xt=>!Xt.disabled).map(Xt=>Xt.ref.current);vV.includes(Xe.key)&&Ms.reverse(),jre(Ms)}),onBlur:bs(e.onBlur,Xe=>{Xe.currentTarget.contains(Xe.target)||(window.clearTimeout(ct.current),xt.current="")}),onPointerMove:bs(e.onPointerMove,z0(Xe=>{const Ot=Xe.target,nt=wt.current!==Xe.clientX;if(Xe.currentTarget.contains(Ot)&&nt){const Mt=Xe.clientX>wt.current?"right":"left";Dt.current=Mt,wt.current=Xe.clientX}}))})})})})})})});NV.displayName=El;var mre="MenuGroup",vP=z.forwardRef((e,s)=>{const{__scopeMenu:l,...d}=e;return n.jsx(Ys.div,{role:"group",...d,ref:s})});vP.displayName=mre;var gre="MenuLabel",EV=z.forwardRef((e,s)=>{const{__scopeMenu:l,...d}=e;return n.jsx(Ys.div,{...d,ref:s})});EV.displayName=gre;var l2="MenuItem",bL="menu.itemSelect",mS=z.forwardRef((e,s)=>{const{disabled:l=!1,onSelect:d,...m}=e,_=z.useRef(null),w=fv(l2,e.__scopeMenu),o=yP(l2,e.__scopeMenu),E=Gn(s,_),P=z.useRef(!1),M=()=>{const L=_.current;if(!l&&L){const F=new CustomEvent(bL,{bubbles:!0,cancelable:!0});L.addEventListener(bL,$=>d==null?void 0:d($),{once:!0}),SA(L,F),F.defaultPrevented?P.current=!1:w.onClose()}};return n.jsx(CV,{...m,ref:E,disabled:l,onClick:bs(e.onClick,M),onPointerDown:L=>{var F;(F=e.onPointerDown)==null||F.call(e,L),P.current=!0},onPointerUp:bs(e.onPointerUp,L=>{var F;P.current||(F=L.currentTarget)==null||F.click()}),onKeyDown:bs(e.onKeyDown,L=>{const F=o.searchRef.current!=="";l||F&&L.key===" "||QE.includes(L.key)&&(L.currentTarget.click(),L.preventDefault())})})});mS.displayName=l2;var CV=z.forwardRef((e,s)=>{const{__scopeMenu:l,disabled:d=!1,textValue:m,..._}=e,w=yP(l2,l),o=wV(l),E=z.useRef(null),P=Gn(s,E),[M,L]=z.useState(!1),[F,$]=z.useState("");return z.useEffect(()=>{const Y=E.current;Y&&$((Y.textContent??"").trim())},[_.children]),n.jsx(L0.ItemSlot,{scope:l,disabled:d,textValue:m??F,children:n.jsx(_V,{asChild:!0,...o,focusable:!d,children:n.jsx(Ys.div,{role:"menuitem","data-highlighted":M?"":void 0,"aria-disabled":d||void 0,"data-disabled":d?"":void 0,..._,ref:P,onPointerMove:bs(e.onPointerMove,z0(Y=>{d?w.onItemLeave(Y):(w.onItemEnter(Y),Y.defaultPrevented||Y.currentTarget.focus({preventScroll:!0}))})),onPointerLeave:bs(e.onPointerLeave,z0(Y=>w.onItemLeave(Y))),onFocus:bs(e.onFocus,()=>L(!0)),onBlur:bs(e.onBlur,()=>L(!1))})})})}),xre="MenuCheckboxItem",AV=z.forwardRef((e,s)=>{const{checked:l=!1,onCheckedChange:d,...m}=e;return n.jsx(kV,{scope:e.__scopeMenu,checked:l,children:n.jsx(mS,{role:"menuitemcheckbox","aria-checked":c2(l)?"mixed":l,...m,ref:s,"data-state":wP(l),onSelect:bs(m.onSelect,()=>d==null?void 0:d(c2(l)?!0:!l),{checkForDefaultPrevented:!1})})})});AV.displayName=xre;var PV="MenuRadioGroup",[yre,_re]=Pf(PV,{value:void 0,onValueChange:()=>{}}),IV=z.forwardRef((e,s)=>{const{value:l,onValueChange:d,...m}=e,_=Ci(d);return n.jsx(yre,{scope:e.__scopeMenu,value:l,onValueChange:_,children:n.jsx(vP,{...m,ref:s})})});IV.displayName=PV;var MV="MenuRadioItem",RV=z.forwardRef((e,s)=>{const{value:l,...d}=e,m=_re(MV,e.__scopeMenu),_=l===m.value;return n.jsx(kV,{scope:e.__scopeMenu,checked:_,children:n.jsx(mS,{role:"menuitemradio","aria-checked":_,...d,ref:s,"data-state":wP(_),onSelect:bs(d.onSelect,()=>{var w;return(w=m.onValueChange)==null?void 0:w.call(m,l)},{checkForDefaultPrevented:!1})})})});RV.displayName=MV;var bP="MenuItemIndicator",[kV,vre]=Pf(bP,{checked:!1}),DV=z.forwardRef((e,s)=>{const{__scopeMenu:l,forceMount:d,...m}=e,_=vre(bP,l);return n.jsx(Yo,{present:d||c2(_.checked)||_.checked===!0,children:n.jsx(Ys.span,{...m,ref:s,"data-state":wP(_.checked)})})});DV.displayName=bP;var bre="MenuSeparator",LV=z.forwardRef((e,s)=>{const{__scopeMenu:l,...d}=e;return n.jsx(Ys.div,{role:"separator","aria-orientation":"horizontal",...d,ref:s})});LV.displayName=bre;var wre="MenuArrow",zV=z.forwardRef((e,s)=>{const{__scopeMenu:l,...d}=e,m=fS(l);return n.jsx(LA,{...m,...d,ref:s})});zV.displayName=wre;var Sre="MenuSub",[Gde,OV]=Pf(Sre),q_="MenuSubTrigger",FV=z.forwardRef((e,s)=>{const l=If(q_,e.__scopeMenu),d=fv(q_,e.__scopeMenu),m=OV(q_,e.__scopeMenu),_=yP(q_,e.__scopeMenu),w=z.useRef(null),{pointerGraceTimerRef:o,onPointerGraceIntentChange:E}=_,P={__scopeMenu:e.__scopeMenu},M=z.useCallback(()=>{w.current&&window.clearTimeout(w.current),w.current=null},[]);return z.useEffect(()=>M,[M]),z.useEffect(()=>{const L=o.current;return()=>{window.clearTimeout(L),E(null)}},[o,E]),n.jsx(gP,{asChild:!0,...P,children:n.jsx(CV,{id:m.triggerId,"aria-haspopup":"menu","aria-expanded":l.open,"aria-controls":m.contentId,"data-state":UV(l.open),...e,ref:z2(s,m.onTriggerChange),onClick:L=>{var F;(F=e.onClick)==null||F.call(e,L),!(e.disabled||L.defaultPrevented)&&(L.currentTarget.focus(),l.open||l.onOpenChange(!0))},onPointerMove:bs(e.onPointerMove,z0(L=>{_.onItemEnter(L),!L.defaultPrevented&&!e.disabled&&!l.open&&!w.current&&(_.onPointerGraceIntentChange(null),w.current=window.setTimeout(()=>{l.onOpenChange(!0),M()},100))})),onPointerLeave:bs(e.onPointerLeave,z0(L=>{var $,Y;M();const F=($=l.content)==null?void 0:$.getBoundingClientRect();if(F){const H=(Y=l.content)==null?void 0:Y.dataset.side,X=H==="right",Z=X?-5:5,W=F[X?"left":"right"],q=F[X?"right":"left"];_.onPointerGraceIntentChange({area:[{x:L.clientX+Z,y:L.clientY},{x:W,y:F.top},{x:q,y:F.top},{x:q,y:F.bottom},{x:W,y:F.bottom}],side:H}),window.clearTimeout(o.current),o.current=window.setTimeout(()=>_.onPointerGraceIntentChange(null),300)}else{if(_.onTriggerLeave(L),L.defaultPrevented)return;_.onPointerGraceIntentChange(null)}})),onKeyDown:bs(e.onKeyDown,L=>{var $;const F=_.searchRef.current!=="";e.disabled||F&&L.key===" "||nre[d.dir].includes(L.key)&&(l.onOpenChange(!0),($=l.content)==null||$.focus(),L.preventDefault())})})})});FV.displayName=q_;var BV="MenuSubContent",VV=z.forwardRef((e,s)=>{const l=jV(El,e.__scopeMenu),{forceMount:d=l.forceMount,...m}=e,_=If(El,e.__scopeMenu),w=fv(El,e.__scopeMenu),o=OV(BV,e.__scopeMenu),E=z.useRef(null),P=Gn(s,E);return n.jsx(L0.Provider,{scope:e.__scopeMenu,children:n.jsx(Yo,{present:d||_.open,children:n.jsx(L0.Slot,{scope:e.__scopeMenu,children:n.jsx(_P,{id:o.contentId,"aria-labelledby":o.triggerId,...m,ref:P,align:"start",side:w.dir==="rtl"?"left":"right",disableOutsidePointerEvents:!1,disableOutsideScroll:!1,trapFocus:!1,onOpenAutoFocus:M=>{var L;w.isUsingKeyboardRef.current&&((L=E.current)==null||L.focus()),M.preventDefault()},onCloseAutoFocus:M=>M.preventDefault(),onFocusOutside:bs(e.onFocusOutside,M=>{M.target!==o.trigger&&_.onOpenChange(!1)}),onEscapeKeyDown:bs(e.onEscapeKeyDown,M=>{w.onClose(),M.preventDefault()}),onKeyDown:bs(e.onKeyDown,M=>{var $;const L=M.currentTarget.contains(M.target),F=rre[w.dir].includes(M.key);L&&F&&(_.onOpenChange(!1),($=o.trigger)==null||$.focus(),M.preventDefault())})})})})})});VV.displayName=BV;function UV(e){return e?"open":"closed"}function c2(e){return e==="indeterminate"}function wP(e){return c2(e)?"indeterminate":e?"checked":"unchecked"}function jre(e){const s=document.activeElement;for(const l of e)if(l===s||(l.focus(),document.activeElement!==s))return}function Tre(e,s){return e.map((l,d)=>e[(s+d)%e.length])}function Nre(e,s,l){const m=s.length>1&&Array.from(s).every(P=>P===s[0])?s[0]:s,_=l?e.indexOf(l):-1;let w=Tre(e,Math.max(_,0));m.length===1&&(w=w.filter(P=>P!==l));const E=w.find(P=>P.toLowerCase().startsWith(m.toLowerCase()));return E!==l?E:void 0}function Ere(e,s){const{x:l,y:d}=e;let m=!1;for(let _=0,w=s.length-1;_<s.length;w=_++){const o=s[_],E=s[w],P=o.x,M=o.y,L=E.x,F=E.y;M>d!=F>d&&l<(L-P)*(d-M)/(F-M)+P&&(m=!m)}return m}function Cre(e,s){if(!s)return!1;const l={x:e.clientX,y:e.clientY};return Ere(l,s)}function z0(e){return s=>s.pointerType==="mouse"?e(s):void 0}var Are=SV,Pre=gP,Ire=TV,Mre=NV,Rre=vP,kre=EV,Dre=mS,Lre=AV,zre=IV,Ore=RV,Fre=DV,Bre=LV,Vre=zV,Ure=FV,$re=VV,gS="DropdownMenu",[Gre,Hde]=Xo(gS,[bV]),_a=bV(),[Hre,$V]=Gre(gS),GV=e=>{const{__scopeDropdownMenu:s,children:l,dir:d,open:m,defaultOpen:_,onOpenChange:w,modal:o=!0}=e,E=_a(s),P=z.useRef(null),[M,L]=Qu({prop:m,defaultProp:_??!1,onChange:w,caller:gS});return n.jsx(Hre,{scope:s,triggerId:Qc(),triggerRef:P,contentId:Qc(),open:M,onOpenChange:L,onOpenToggle:z.useCallback(()=>L(F=>!F),[L]),modal:o,children:n.jsx(Are,{...E,open:M,onOpenChange:L,dir:d,modal:o,children:l})})};GV.displayName=gS;var HV="DropdownMenuTrigger",WV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,disabled:d=!1,...m}=e,_=$V(HV,l),w=_a(l);return n.jsx(Pre,{asChild:!0,...w,children:n.jsx(Ys.button,{type:"button",id:_.triggerId,"aria-haspopup":"menu","aria-expanded":_.open,"aria-controls":_.open?_.contentId:void 0,"data-state":_.open?"open":"closed","data-disabled":d?"":void 0,disabled:d,...m,ref:z2(s,_.triggerRef),onPointerDown:bs(e.onPointerDown,o=>{!d&&o.button===0&&o.ctrlKey===!1&&(_.onOpenToggle(),_.open||o.preventDefault())}),onKeyDown:bs(e.onKeyDown,o=>{d||(["Enter"," "].includes(o.key)&&_.onOpenToggle(),o.key==="ArrowDown"&&_.onOpenChange(!0),["Enter"," ","ArrowDown"].includes(o.key)&&o.preventDefault())})})})});WV.displayName=HV;var Wre="DropdownMenuPortal",qV=e=>{const{__scopeDropdownMenu:s,...l}=e,d=_a(s);return n.jsx(Ire,{...d,...l})};qV.displayName=Wre;var ZV="DropdownMenuContent",KV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=$V(ZV,l),_=_a(l),w=z.useRef(!1);return n.jsx(Mre,{id:m.contentId,"aria-labelledby":m.triggerId,..._,...d,ref:s,onCloseAutoFocus:bs(e.onCloseAutoFocus,o=>{var E;w.current||(E=m.triggerRef.current)==null||E.focus(),w.current=!1,o.preventDefault()}),onInteractOutside:bs(e.onInteractOutside,o=>{const E=o.detail.originalEvent,P=E.button===0&&E.ctrlKey===!0,M=E.button===2||P;(!m.modal||M)&&(w.current=!0)}),style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});KV.displayName=ZV;var qre="DropdownMenuGroup",Zre=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Rre,{...m,...d,ref:s})});Zre.displayName=qre;var Kre="DropdownMenuLabel",XV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(kre,{...m,...d,ref:s})});XV.displayName=Kre;var Xre="DropdownMenuItem",YV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Dre,{...m,...d,ref:s})});YV.displayName=Xre;var Yre="DropdownMenuCheckboxItem",JV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Lre,{...m,...d,ref:s})});JV.displayName=Yre;var Jre="DropdownMenuRadioGroup",Qre=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(zre,{...m,...d,ref:s})});Qre.displayName=Jre;var eie="DropdownMenuRadioItem",QV=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Ore,{...m,...d,ref:s})});QV.displayName=eie;var tie="DropdownMenuItemIndicator",eU=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Fre,{...m,...d,ref:s})});eU.displayName=tie;var sie="DropdownMenuSeparator",tU=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Bre,{...m,...d,ref:s})});tU.displayName=sie;var nie="DropdownMenuArrow",rie=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Vre,{...m,...d,ref:s})});rie.displayName=nie;var iie="DropdownMenuSubTrigger",sU=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx(Ure,{...m,...d,ref:s})});sU.displayName=iie;var oie="DropdownMenuSubContent",nU=z.forwardRef((e,s)=>{const{__scopeDropdownMenu:l,...d}=e,m=_a(l);return n.jsx($re,{...m,...d,ref:s,style:{...e.style,"--radix-dropdown-menu-content-transform-origin":"var(--radix-popper-transform-origin)","--radix-dropdown-menu-content-available-width":"var(--radix-popper-available-width)","--radix-dropdown-menu-content-available-height":"var(--radix-popper-available-height)","--radix-dropdown-menu-trigger-width":"var(--radix-popper-anchor-width)","--radix-dropdown-menu-trigger-height":"var(--radix-popper-anchor-height)"}})});nU.displayName=oie;var aie=GV,lie=WV,cie=qV,rU=KV,iU=XV,oU=YV,aU=JV,lU=QV,cU=eU,uU=tU,dU=sU,hU=nU;const Nx=aie,Ex=lie,uie=z.forwardRef(({className:e,inset:s,children:l,...d},m)=>n.jsxs(dU,{ref:m,className:Ds("flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none focus:bg-accent data-[state=open]:bg-accent",s&&"pl-8",e),...d,children:[l,n.jsx(tv,{className:"ml-auto h-4 w-4"})]}));uie.displayName=dU.displayName;const die=z.forwardRef(({className:e,...s},l)=>n.jsx(hU,{ref:l,className:Ds("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-lg data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...s}));die.displayName=hU.displayName;const Mf=z.forwardRef(({className:e,sideOffset:s=4,...l},d)=>n.jsx(cie,{children:n.jsx(rU,{ref:d,sideOffset:s,className:Ds("z-50 min-w-[8rem] overflow-hidden rounded-md border bg-popover p-1 text-popover-foreground shadow-md data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",e),...l})}));Mf.displayName=rU.displayName;const ti=z.forwardRef(({className:e,inset:s,...l},d)=>n.jsx(oU,{ref:d,className:Ds("relative flex cursor-default select-none items-center rounded-sm px-2 py-1.5 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",s&&"pl-8",e),...l}));ti.displayName=oU.displayName;const hie=z.forwardRef(({className:e,children:s,checked:l,...d},m)=>n.jsxs(aU,{ref:m,className:Ds("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),checked:l,...d,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(cU,{children:n.jsx(Eh,{className:"h-4 w-4"})})}),s]}));hie.displayName=aU.displayName;const pie=z.forwardRef(({className:e,children:s,...l},d)=>n.jsxs(lU,{ref:d,className:Ds("relative flex cursor-default select-none items-center rounded-sm py-1.5 pl-8 pr-2 text-sm outline-none transition-colors focus:bg-accent focus:text-accent-foreground data-[disabled]:pointer-events-none data-[disabled]:opacity-50",e),...l,children:[n.jsx("span",{className:"absolute left-2 flex h-3.5 w-3.5 items-center justify-center",children:n.jsx(cU,{children:n.jsx(zJ,{className:"h-2 w-2 fill-current"})})}),s]}));pie.displayName=lU.displayName;const SP=z.forwardRef(({className:e,inset:s,...l},d)=>n.jsx(iU,{ref:d,className:Ds("px-2 py-1.5 text-sm font-semibold",s&&"pl-8",e),...l}));SP.displayName=iU.displayName;const Jp=z.forwardRef(({className:e,...s},l)=>n.jsx(uU,{ref:l,className:Ds("-mx-1 my-1 h-px bg-muted",e),...s}));Jp.displayName=uU.displayName;const fie=ev("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function ls({className:e,variant:s,...l}){return n.jsx("div",{className:Ds(fie({variant:s}),e),...l})}const ot=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{ref:l,className:Ds("rounded-lg border bg-card text-card-foreground shadow-sm",e),...s}));ot.displayName="Card";const Ut=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{ref:l,className:Ds("flex flex-col space-y-1.5 p-6",e),...s}));Ut.displayName="CardHeader";const $t=z.forwardRef(({className:e,...s},l)=>n.jsx("h3",{ref:l,className:Ds("text-2xl font-semibold leading-none tracking-tight",e),...s}));$t.displayName="CardTitle";const Zs=z.forwardRef(({className:e,...s},l)=>n.jsx("p",{ref:l,className:Ds("text-sm text-muted-foreground",e),...s}));Zs.displayName="CardDescription";const at=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{ref:l,className:Ds("p-6 pt-0",e),...s}));at.displayName="CardContent";const mie=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{ref:l,className:Ds("flex items-center p-6 pt-0",e),...s}));mie.displayName="CardFooter";const jP=(e={})=>{const[s,l]=z.useState(""),[d,m]=z.useState(e),[_,w]=z.useState(null),[o,E]=z.useState(!1),[P,M]=z.useState(null),[L,F]=z.useState(""),[$,Y]=z.useState(null),[H,X]=z.useState(!1),{toast:Z}=Bi();z.useEffect(()=>{$&&clearTimeout($);const Le=setTimeout(()=>{F(s)},1e4);return Y(Le),()=>{Le&&clearTimeout(Le)}},[s]);const W=z.useCallback(async()=>{var Le,ct;E(!0),M(null);try{const xt={...d,q:L||void 0,page:1};Object.keys(xt).forEach(Ht=>{xt[Ht]===void 0&&delete xt[Ht]}),console.log("Search params:",xt);const yt=await Ni.search.searchProperties(xt);w(yt.data),yt.data.properties&&yt.data.properties.length>0?Z({title:"Search Results",description:`Found ${yt.data.properties.length} properties matching your criteria.`,variant:"default"}):Z({title:"No Results",description:"No properties found matching your search criteria. Try adjusting your filters.",variant:"default"})}catch(xt){console.error("Search error:",xt);const yt=((ct=(Le=xt.response)==null?void 0:Le.data)==null?void 0:ct.message)||xt.message||"Failed to perform search. Please try again.";M(yt),Z({title:"Search Error",description:yt,variant:"destructive"})}finally{E(!1)}},[L,d,Z]);z.useEffect(()=>{const Le=Object.keys(d).some(ct=>d[ct]!==void 0&&d[ct]!=="");(L||Le&&(L||Object.keys(d).length>1))&&(W(),X(!0))},[L,d,W]);const q=z.useCallback(Le=>{l(Le)},[]),oe=z.useCallback(Le=>{m(ct=>({...ct,...Le}))},[]),ae=z.useCallback(()=>{l(""),F(""),m(e),w(null),M(null)},[e]),Ne=z.useCallback(async()=>{var Le,ct;if(!(!_||_.page>=_.totalPages||o)){E(!0);try{const xt={...d,q:L||void 0,page:_.page+1},yt=await Ni.search.searchProperties(xt);w(Ht=>({...yt.data,properties:[...(Ht==null?void 0:Ht.properties)||[],...yt.data.properties||[]]}))}catch(xt){const yt=((ct=(Le=xt.response)==null?void 0:Le.data)==null?void 0:ct.message)||"Failed to load more results.";Z({title:"Load Error",description:yt,variant:"destructive"})}finally{E(!1)}}},[_,d,L,o,Z]),Pe=z.useCallback(async Le=>{l(Le),F(Le)},[]);return{searchQuery:s,debouncedQuery:L,filters:d,results:_,isLoading:o,error:P,hasInitialized:H,updateSearchQuery:q,updateFilters:oe,performSearch:W,resetSearch:ae,loadMore:Ne,quickSearch:Pe,hasResults:H&&(_==null?void 0:_.properties)&&_.properties.length>0,totalResults:H&&(_==null?void 0:_.total)||0,currentPage:H&&(_==null?void 0:_.page)||1,totalPages:H&&(_==null?void 0:_.totalPages)||0,canLoadMore:H&&_&&_.page<_.totalPages&&!o}},TP=z.createContext({});function NP(e){const s=z.useRef(null);return s.current===null&&(s.current=e()),s.current}const EP=typeof window<"u",pU=EP?z.useLayoutEffect:z.useEffect,xS=z.createContext(null);function CP(e,s){e.indexOf(s)===-1&&e.push(s)}function AP(e,s){const l=e.indexOf(s);l>-1&&e.splice(l,1)}const td=(e,s,l)=>l>s?s:l<e?e:l;let u2=()=>{};const sd={},fU=e=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(e);function mU(e){return typeof e=="object"&&e!==null}const gU=e=>/^0[^.\s]+$/u.test(e);function PP(e){let s;return()=>(s===void 0&&(s=e()),s)}const Cl=e=>e,gie=(e,s)=>l=>s(e(l)),mv=(...e)=>e.reduce(gie),O0=(e,s,l)=>{const d=s-e;return d===0?1:(l-e)/d};class IP{constructor(){this.subscriptions=[]}add(s){return CP(this.subscriptions,s),()=>AP(this.subscriptions,s)}notify(s,l,d){const m=this.subscriptions.length;if(m)if(m===1)this.subscriptions[0](s,l,d);else for(let _=0;_<m;_++){const w=this.subscriptions[_];w&&w(s,l,d)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const nu=e=>e*1e3,ru=e=>e/1e3;function xU(e,s){return s?e*(1e3/s):0}const yU=(e,s,l)=>(((1-3*l+3*s)*e+(3*l-6*s))*e+3*s)*e,xie=1e-7,yie=12;function _ie(e,s,l,d,m){let _,w,o=0;do w=s+(l-s)/2,_=yU(w,d,m)-e,_>0?l=w:s=w;while(Math.abs(_)>xie&&++o<yie);return w}function gv(e,s,l,d){if(e===s&&l===d)return Cl;const m=_=>_ie(_,0,1,e,l);return _=>_===0||_===1?_:yU(m(_),s,d)}const _U=e=>s=>s<=.5?e(2*s)/2:(2-e(2*(1-s)))/2,vU=e=>s=>1-e(1-s),bU=gv(.33,1.53,.69,.99),MP=vU(bU),wU=_U(MP),SU=e=>(e*=2)<1?.5*MP(e):.5*(2-Math.pow(2,-10*(e-1))),RP=e=>1-Math.sin(Math.acos(e)),jU=vU(RP),TU=_U(RP),vie=gv(.42,0,1,1),bie=gv(0,0,.58,1),NU=gv(.42,0,.58,1),wie=e=>Array.isArray(e)&&typeof e[0]!="number",EU=e=>Array.isArray(e)&&typeof e[0]=="number",wL={linear:Cl,easeIn:vie,easeInOut:NU,easeOut:bie,circIn:RP,circInOut:TU,circOut:jU,backIn:MP,backInOut:wU,backOut:bU,anticipate:SU},Sie=e=>typeof e=="string",SL=e=>{if(EU(e)){u2(e.length===4);const[s,l,d,m]=e;return gv(s,l,d,m)}else if(Sie(e))return u2(wL[e]!==void 0),wL[e];return e},qb=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"],jL={value:null,addProjectionMetrics:null};function jie(e,s){let l=new Set,d=new Set,m=!1,_=!1;const w=new WeakSet;let o={delta:0,timestamp:0,isProcessing:!1},E=0;function P(L){w.has(L)&&(M.schedule(L),e()),E++,L(o)}const M={schedule:(L,F=!1,$=!1)=>{const H=$&&m?l:d;return F&&w.add(L),H.has(L)||H.add(L),L},cancel:L=>{d.delete(L),w.delete(L)},process:L=>{if(o=L,m){_=!0;return}m=!0,[l,d]=[d,l],l.forEach(P),s&&jL.value&&jL.value.frameloop[s].push(E),E=0,l.clear(),m=!1,_&&(_=!1,M.process(L))}};return M}const Tie=40;function CU(e,s){let l=!1,d=!0;const m={delta:0,timestamp:0,isProcessing:!1},_=()=>l=!0,w=qb.reduce((q,oe)=>(q[oe]=jie(_,s?oe:void 0),q),{}),{setup:o,read:E,resolveKeyframes:P,preUpdate:M,update:L,preRender:F,render:$,postRender:Y}=w,H=()=>{const q=sd.useManualTiming?m.timestamp:performance.now();l=!1,sd.useManualTiming||(m.delta=d?1e3/60:Math.max(Math.min(q-m.timestamp,Tie),1)),m.timestamp=q,m.isProcessing=!0,o.process(m),E.process(m),P.process(m),M.process(m),L.process(m),F.process(m),$.process(m),Y.process(m),m.isProcessing=!1,l&&s&&(d=!1,e(H))},X=()=>{l=!0,d=!0,m.isProcessing||e(H)};return{schedule:qb.reduce((q,oe)=>{const ae=w[oe];return q[oe]=(Ne,Pe=!1,Le=!1)=>(l||X(),ae.schedule(Ne,Pe,Le)),q},{}),cancel:q=>{for(let oe=0;oe<qb.length;oe++)w[qb[oe]].cancel(q)},state:m,steps:w}}const{schedule:oi,cancel:Dh,state:Mo,steps:hN}=CU(typeof requestAnimationFrame<"u"?requestAnimationFrame:Cl,!0);let xw;function Nie(){xw=void 0}const ka={now:()=>(xw===void 0&&ka.set(Mo.isProcessing||sd.useManualTiming?Mo.timestamp:performance.now()),xw),set:e=>{xw=e,queueMicrotask(Nie)}},AU=e=>s=>typeof s=="string"&&s.startsWith(e),kP=AU("--"),Eie=AU("var(--"),DP=e=>Eie(e)?Cie.test(e.split("/*")[0].trim()):!1,Cie=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Cx={test:e=>typeof e=="number",parse:parseFloat,transform:e=>e},F0={...Cx,transform:e=>td(0,1,e)},Zb={...Cx,default:1},i0=e=>Math.round(e*1e5)/1e5,LP=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function Aie(e){return e==null}const Pie=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,zP=(e,s)=>l=>!!(typeof l=="string"&&Pie.test(l)&&l.startsWith(e)||s&&!Aie(l)&&Object.prototype.hasOwnProperty.call(l,s)),PU=(e,s,l)=>d=>{if(typeof d!="string")return d;const[m,_,w,o]=d.match(LP);return{[e]:parseFloat(m),[s]:parseFloat(_),[l]:parseFloat(w),alpha:o!==void 0?parseFloat(o):1}},Iie=e=>td(0,255,e),pN={...Cx,transform:e=>Math.round(Iie(e))},Qp={test:zP("rgb","red"),parse:PU("red","green","blue"),transform:({red:e,green:s,blue:l,alpha:d=1})=>"rgba("+pN.transform(e)+", "+pN.transform(s)+", "+pN.transform(l)+", "+i0(F0.transform(d))+")"};function Mie(e){let s="",l="",d="",m="";return e.length>5?(s=e.substring(1,3),l=e.substring(3,5),d=e.substring(5,7),m=e.substring(7,9)):(s=e.substring(1,2),l=e.substring(2,3),d=e.substring(3,4),m=e.substring(4,5),s+=s,l+=l,d+=d,m+=m),{red:parseInt(s,16),green:parseInt(l,16),blue:parseInt(d,16),alpha:m?parseInt(m,16)/255:1}}const eC={test:zP("#"),parse:Mie,transform:Qp.transform},xv=e=>({test:s=>typeof s=="string"&&s.endsWith(e)&&s.split(" ").length===1,parse:parseFloat,transform:s=>`${s}${e}`}),rh=xv("deg"),iu=xv("%"),Nn=xv("px"),Rie=xv("vh"),kie=xv("vw"),TL={...iu,parse:e=>iu.parse(e)/100,transform:e=>iu.transform(e*100)},vg={test:zP("hsl","hue"),parse:PU("hue","saturation","lightness"),transform:({hue:e,saturation:s,lightness:l,alpha:d=1})=>"hsla("+Math.round(e)+", "+iu.transform(i0(s))+", "+iu.transform(i0(l))+", "+i0(F0.transform(d))+")"},Wi={test:e=>Qp.test(e)||eC.test(e)||vg.test(e),parse:e=>Qp.test(e)?Qp.parse(e):vg.test(e)?vg.parse(e):eC.parse(e),transform:e=>typeof e=="string"?e:e.hasOwnProperty("red")?Qp.transform(e):vg.transform(e),getAnimatableNone:e=>{const s=Wi.parse(e);return s.alpha=0,Wi.transform(s)}},Die=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function Lie(e){var s,l;return isNaN(e)&&typeof e=="string"&&(((s=e.match(LP))==null?void 0:s.length)||0)+(((l=e.match(Die))==null?void 0:l.length)||0)>0}const IU="number",MU="color",zie="var",Oie="var(",NL="${}",Fie=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function B0(e){const s=e.toString(),l=[],d={color:[],number:[],var:[]},m=[];let _=0;const o=s.replace(Fie,E=>(Wi.test(E)?(d.color.push(_),m.push(MU),l.push(Wi.parse(E))):E.startsWith(Oie)?(d.var.push(_),m.push(zie),l.push(E)):(d.number.push(_),m.push(IU),l.push(parseFloat(E))),++_,NL)).split(NL);return{values:l,split:o,indexes:d,types:m}}function RU(e){return B0(e).values}function kU(e){const{split:s,types:l}=B0(e),d=s.length;return m=>{let _="";for(let w=0;w<d;w++)if(_+=s[w],m[w]!==void 0){const o=l[w];o===IU?_+=i0(m[w]):o===MU?_+=Wi.transform(m[w]):_+=m[w]}return _}}const Bie=e=>typeof e=="number"?0:Wi.test(e)?Wi.getAnimatableNone(e):e;function Vie(e){const s=RU(e);return kU(e)(s.map(Bie))}const Lh={test:Lie,parse:RU,createTransformer:kU,getAnimatableNone:Vie};function fN(e,s,l){return l<0&&(l+=1),l>1&&(l-=1),l<1/6?e+(s-e)*6*l:l<1/2?s:l<2/3?e+(s-e)*(2/3-l)*6:e}function Uie({hue:e,saturation:s,lightness:l,alpha:d}){e/=360,s/=100,l/=100;let m=0,_=0,w=0;if(!s)m=_=w=l;else{const o=l<.5?l*(1+s):l+s-l*s,E=2*l-o;m=fN(E,o,e+1/3),_=fN(E,o,e),w=fN(E,o,e-1/3)}return{red:Math.round(m*255),green:Math.round(_*255),blue:Math.round(w*255),alpha:d}}function d2(e,s){return l=>l>0?s:e}const ui=(e,s,l)=>e+(s-e)*l,mN=(e,s,l)=>{const d=e*e,m=l*(s*s-d)+d;return m<0?0:Math.sqrt(m)},$ie=[eC,Qp,vg],Gie=e=>$ie.find(s=>s.test(e));function EL(e){const s=Gie(e);if(!s)return!1;let l=s.parse(e);return s===vg&&(l=Uie(l)),l}const CL=(e,s)=>{const l=EL(e),d=EL(s);if(!l||!d)return d2(e,s);const m={...l};return _=>(m.red=mN(l.red,d.red,_),m.green=mN(l.green,d.green,_),m.blue=mN(l.blue,d.blue,_),m.alpha=ui(l.alpha,d.alpha,_),Qp.transform(m))},tC=new Set(["none","hidden"]);function Hie(e,s){return tC.has(e)?l=>l<=0?e:s:l=>l>=1?s:e}function Wie(e,s){return l=>ui(e,s,l)}function OP(e){return typeof e=="number"?Wie:typeof e=="string"?DP(e)?d2:Wi.test(e)?CL:Kie:Array.isArray(e)?DU:typeof e=="object"?Wi.test(e)?CL:qie:d2}function DU(e,s){const l=[...e],d=l.length,m=e.map((_,w)=>OP(_)(_,s[w]));return _=>{for(let w=0;w<d;w++)l[w]=m[w](_);return l}}function qie(e,s){const l={...e,...s},d={};for(const m in l)e[m]!==void 0&&s[m]!==void 0&&(d[m]=OP(e[m])(e[m],s[m]));return m=>{for(const _ in d)l[_]=d[_](m);return l}}function Zie(e,s){const l=[],d={color:0,var:0,number:0};for(let m=0;m<s.values.length;m++){const _=s.types[m],w=e.indexes[_][d[_]],o=e.values[w]??0;l[m]=o,d[_]++}return l}const Kie=(e,s)=>{const l=Lh.createTransformer(s),d=B0(e),m=B0(s);return d.indexes.var.length===m.indexes.var.length&&d.indexes.color.length===m.indexes.color.length&&d.indexes.number.length>=m.indexes.number.length?tC.has(e)&&!m.values.length||tC.has(s)&&!d.values.length?Hie(e,s):mv(DU(Zie(d,m),m.values),l):d2(e,s)};function LU(e,s,l){return typeof e=="number"&&typeof s=="number"&&typeof l=="number"?ui(e,s,l):OP(e)(e,s)}const Xie=e=>{const s=({timestamp:l})=>e(l);return{start:(l=!0)=>oi.update(s,l),stop:()=>Dh(s),now:()=>Mo.isProcessing?Mo.timestamp:ka.now()}},zU=(e,s,l=10)=>{let d="";const m=Math.max(Math.round(s/l),2);for(let _=0;_<m;_++)d+=Math.round(e(_/(m-1))*1e4)/1e4+", ";return`linear(${d.substring(0,d.length-2)})`},h2=2e4;function FP(e){let s=0;const l=50;let d=e.next(s);for(;!d.done&&s<h2;)s+=l,d=e.next(s);return s>=h2?1/0:s}function Yie(e,s=100,l){const d=l({...e,keyframes:[0,s]}),m=Math.min(FP(d),h2);return{type:"keyframes",ease:_=>d.next(m*_).value/s,duration:ru(m)}}const Jie=5;function OU(e,s,l){const d=Math.max(s-Jie,0);return xU(l-e(d),s-d)}const ji={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},gN=.001;function Qie({duration:e=ji.duration,bounce:s=ji.bounce,velocity:l=ji.velocity,mass:d=ji.mass}){let m,_,w=1-s;w=td(ji.minDamping,ji.maxDamping,w),e=td(ji.minDuration,ji.maxDuration,ru(e)),w<1?(m=P=>{const M=P*w,L=M*e,F=M-l,$=sC(P,w),Y=Math.exp(-L);return gN-F/$*Y},_=P=>{const L=P*w*e,F=L*l+l,$=Math.pow(w,2)*Math.pow(P,2)*e,Y=Math.exp(-L),H=sC(Math.pow(P,2),w);return(-m(P)+gN>0?-1:1)*((F-$)*Y)/H}):(m=P=>{const M=Math.exp(-P*e),L=(P-l)*e+1;return-gN+M*L},_=P=>{const M=Math.exp(-P*e),L=(l-P)*(e*e);return M*L});const o=5/e,E=toe(m,_,o);if(e=nu(e),isNaN(E))return{stiffness:ji.stiffness,damping:ji.damping,duration:e};{const P=Math.pow(E,2)*d;return{stiffness:P,damping:w*2*Math.sqrt(d*P),duration:e}}}const eoe=12;function toe(e,s,l){let d=l;for(let m=1;m<eoe;m++)d=d-e(d)/s(d);return d}function sC(e,s){return e*Math.sqrt(1-s*s)}const soe=["duration","bounce"],noe=["stiffness","damping","mass"];function AL(e,s){return s.some(l=>e[l]!==void 0)}function roe(e){let s={velocity:ji.velocity,stiffness:ji.stiffness,damping:ji.damping,mass:ji.mass,isResolvedFromDuration:!1,...e};if(!AL(e,noe)&&AL(e,soe))if(e.visualDuration){const l=e.visualDuration,d=2*Math.PI/(l*1.2),m=d*d,_=2*td(.05,1,1-(e.bounce||0))*Math.sqrt(m);s={...s,mass:ji.mass,stiffness:m,damping:_}}else{const l=Qie(e);s={...s,...l,mass:ji.mass},s.isResolvedFromDuration=!0}return s}function p2(e=ji.visualDuration,s=ji.bounce){const l=typeof e!="object"?{visualDuration:e,keyframes:[0,1],bounce:s}:e;let{restSpeed:d,restDelta:m}=l;const _=l.keyframes[0],w=l.keyframes[l.keyframes.length-1],o={done:!1,value:_},{stiffness:E,damping:P,mass:M,duration:L,velocity:F,isResolvedFromDuration:$}=roe({...l,velocity:-ru(l.velocity||0)}),Y=F||0,H=P/(2*Math.sqrt(E*M)),X=w-_,Z=ru(Math.sqrt(E/M)),W=Math.abs(X)<5;d||(d=W?ji.restSpeed.granular:ji.restSpeed.default),m||(m=W?ji.restDelta.granular:ji.restDelta.default);let q;if(H<1){const ae=sC(Z,H);q=Ne=>{const Pe=Math.exp(-H*Z*Ne);return w-Pe*((Y+H*Z*X)/ae*Math.sin(ae*Ne)+X*Math.cos(ae*Ne))}}else if(H===1)q=ae=>w-Math.exp(-Z*ae)*(X+(Y+Z*X)*ae);else{const ae=Z*Math.sqrt(H*H-1);q=Ne=>{const Pe=Math.exp(-H*Z*Ne),Le=Math.min(ae*Ne,300);return w-Pe*((Y+H*Z*X)*Math.sinh(Le)+ae*X*Math.cosh(Le))/ae}}const oe={calculatedDuration:$&&L||null,next:ae=>{const Ne=q(ae);if($)o.done=ae>=L;else{let Pe=ae===0?Y:0;H<1&&(Pe=ae===0?nu(Y):OU(q,ae,Ne));const Le=Math.abs(Pe)<=d,ct=Math.abs(w-Ne)<=m;o.done=Le&&ct}return o.value=o.done?w:Ne,o},toString:()=>{const ae=Math.min(FP(oe),h2),Ne=zU(Pe=>oe.next(ae*Pe).value,ae,30);return ae+"ms "+Ne},toTransition:()=>{}};return oe}p2.applyToOptions=e=>{const s=Yie(e,100,p2);return e.ease=s.ease,e.duration=nu(s.duration),e.type="keyframes",e};function nC({keyframes:e,velocity:s=0,power:l=.8,timeConstant:d=325,bounceDamping:m=10,bounceStiffness:_=500,modifyTarget:w,min:o,max:E,restDelta:P=.5,restSpeed:M}){const L=e[0],F={done:!1,value:L},$=Le=>o!==void 0&&Le<o||E!==void 0&&Le>E,Y=Le=>o===void 0?E:E===void 0||Math.abs(o-Le)<Math.abs(E-Le)?o:E;let H=l*s;const X=L+H,Z=w===void 0?X:w(X);Z!==X&&(H=Z-L);const W=Le=>-H*Math.exp(-Le/d),q=Le=>Z+W(Le),oe=Le=>{const ct=W(Le),xt=q(Le);F.done=Math.abs(ct)<=P,F.value=F.done?Z:xt};let ae,Ne;const Pe=Le=>{$(F.value)&&(ae=Le,Ne=p2({keyframes:[F.value,Y(F.value)],velocity:OU(q,Le,F.value),damping:m,stiffness:_,restDelta:P,restSpeed:M}))};return Pe(0),{calculatedDuration:null,next:Le=>{let ct=!1;return!Ne&&ae===void 0&&(ct=!0,oe(Le),Pe(Le)),ae!==void 0&&Le>=ae?Ne.next(Le-ae):(!ct&&oe(Le),F)}}}function ioe(e,s,l){const d=[],m=l||sd.mix||LU,_=e.length-1;for(let w=0;w<_;w++){let o=m(e[w],e[w+1]);if(s){const E=Array.isArray(s)?s[w]||Cl:s;o=mv(E,o)}d.push(o)}return d}function ooe(e,s,{clamp:l=!0,ease:d,mixer:m}={}){const _=e.length;if(u2(_===s.length),_===1)return()=>s[0];if(_===2&&s[0]===s[1])return()=>s[1];const w=e[0]===e[1];e[0]>e[_-1]&&(e=[...e].reverse(),s=[...s].reverse());const o=ioe(s,d,m),E=o.length,P=M=>{if(w&&M<e[0])return s[0];let L=0;if(E>1)for(;L<e.length-2&&!(M<e[L+1]);L++);const F=O0(e[L],e[L+1],M);return o[L](F)};return l?M=>P(td(e[0],e[_-1],M)):P}function aoe(e,s){const l=e[e.length-1];for(let d=1;d<=s;d++){const m=O0(0,s,d);e.push(ui(l,1,m))}}function loe(e){const s=[0];return aoe(s,e.length-1),s}function coe(e,s){return e.map(l=>l*s)}function uoe(e,s){return e.map(()=>s||NU).splice(0,e.length-1)}function o0({duration:e=300,keyframes:s,times:l,ease:d="easeInOut"}){const m=wie(d)?d.map(SL):SL(d),_={done:!1,value:s[0]},w=coe(l&&l.length===s.length?l:loe(s),e),o=ooe(w,s,{ease:Array.isArray(m)?m:uoe(s,m)});return{calculatedDuration:e,next:E=>(_.value=o(E),_.done=E>=e,_)}}const doe=e=>e!==null;function BP(e,{repeat:s,repeatType:l="loop"},d,m=1){const _=e.filter(doe),o=m<0||s&&l!=="loop"&&s%2===1?0:_.length-1;return!o||d===void 0?_[o]:d}const hoe={decay:nC,inertia:nC,tween:o0,keyframes:o0,spring:p2};function FU(e){typeof e.type=="string"&&(e.type=hoe[e.type])}class VP{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(s=>{this.resolve=s})}notifyFinished(){this.resolve()}then(s,l){return this.finished.then(s,l)}}const poe=e=>e/100;class UP extends VP{constructor(s){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{var d,m;const{motionValue:l}=this.options;l&&l.updatedAt!==ka.now()&&this.tick(ka.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),(m=(d=this.options).onStop)==null||m.call(d))},this.options=s,this.initAnimation(),this.play(),s.autoplay===!1&&this.pause()}initAnimation(){const{options:s}=this;FU(s);const{type:l=o0,repeat:d=0,repeatDelay:m=0,repeatType:_,velocity:w=0}=s;let{keyframes:o}=s;const E=l||o0;E!==o0&&typeof o[0]!="number"&&(this.mixKeyframes=mv(poe,LU(o[0],o[1])),o=[0,100]);const P=E({...s,keyframes:o});_==="mirror"&&(this.mirroredGenerator=E({...s,keyframes:[...o].reverse(),velocity:-w})),P.calculatedDuration===null&&(P.calculatedDuration=FP(P));const{calculatedDuration:M}=P;this.calculatedDuration=M,this.resolvedDuration=M+m,this.totalDuration=this.resolvedDuration*(d+1)-m,this.generator=P}updateTime(s){const l=Math.round(s-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=l}tick(s,l=!1){const{generator:d,totalDuration:m,mixKeyframes:_,mirroredGenerator:w,resolvedDuration:o,calculatedDuration:E}=this;if(this.startTime===null)return d.next(0);const{delay:P=0,keyframes:M,repeat:L,repeatType:F,repeatDelay:$,type:Y,onUpdate:H,finalKeyframe:X}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,s):this.speed<0&&(this.startTime=Math.min(s-m/this.speed,this.startTime)),l?this.currentTime=s:this.updateTime(s);const Z=this.currentTime-P*(this.playbackSpeed>=0?1:-1),W=this.playbackSpeed>=0?Z<0:Z>m;this.currentTime=Math.max(Z,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=m);let q=this.currentTime,oe=d;if(L){const Le=Math.min(this.currentTime,m)/o;let ct=Math.floor(Le),xt=Le%1;!xt&&Le>=1&&(xt=1),xt===1&&ct--,ct=Math.min(ct,L+1),!!(ct%2)&&(F==="reverse"?(xt=1-xt,$&&(xt-=$/o)):F==="mirror"&&(oe=w)),q=td(0,1,xt)*o}const ae=W?{done:!1,value:M[0]}:oe.next(q);_&&(ae.value=_(ae.value));let{done:Ne}=ae;!W&&E!==null&&(Ne=this.playbackSpeed>=0?this.currentTime>=m:this.currentTime<=0);const Pe=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&Ne);return Pe&&Y!==nC&&(ae.value=BP(M,this.options,X,this.speed)),H&&H(ae.value),Pe&&this.finish(),ae}then(s,l){return this.finished.then(s,l)}get duration(){return ru(this.calculatedDuration)}get time(){return ru(this.currentTime)}set time(s){var l;s=nu(s),this.currentTime=s,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=s:this.driver&&(this.startTime=this.driver.now()-s/this.playbackSpeed),(l=this.driver)==null||l.start(!1)}get speed(){return this.playbackSpeed}set speed(s){this.updateTime(ka.now());const l=this.playbackSpeed!==s;this.playbackSpeed=s,l&&(this.time=ru(this.currentTime))}play(){var m,_;if(this.isStopped)return;const{driver:s=Xie,startTime:l}=this.options;this.driver||(this.driver=s(w=>this.tick(w))),(_=(m=this.options).onPlay)==null||_.call(m);const d=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=d):this.holdTime!==null?this.startTime=d-this.holdTime:this.startTime||(this.startTime=l??d),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime(ka.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){var s,l;this.notifyFinished(),this.teardown(),this.state="finished",(l=(s=this.options).onComplete)==null||l.call(s)}cancel(){var s,l;this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),(l=(s=this.options).onCancel)==null||l.call(s)}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(s){return this.startTime=0,this.tick(s,!0)}attachTimeline(s){var l;return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),(l=this.driver)==null||l.stop(),s.observe(this)}}function foe(e){for(let s=1;s<e.length;s++)e[s]??(e[s]=e[s-1])}const ef=e=>e*180/Math.PI,rC=e=>{const s=ef(Math.atan2(e[1],e[0]));return iC(s)},moe={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:e=>(Math.abs(e[0])+Math.abs(e[3]))/2,rotate:rC,rotateZ:rC,skewX:e=>ef(Math.atan(e[1])),skewY:e=>ef(Math.atan(e[2])),skew:e=>(Math.abs(e[1])+Math.abs(e[2]))/2},iC=e=>(e=e%360,e<0&&(e+=360),e),PL=rC,IL=e=>Math.sqrt(e[0]*e[0]+e[1]*e[1]),ML=e=>Math.sqrt(e[4]*e[4]+e[5]*e[5]),goe={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:IL,scaleY:ML,scale:e=>(IL(e)+ML(e))/2,rotateX:e=>iC(ef(Math.atan2(e[6],e[5]))),rotateY:e=>iC(ef(Math.atan2(-e[2],e[0]))),rotateZ:PL,rotate:PL,skewX:e=>ef(Math.atan(e[4])),skewY:e=>ef(Math.atan(e[1])),skew:e=>(Math.abs(e[1])+Math.abs(e[4]))/2};function oC(e){return e.includes("scale")?1:0}function aC(e,s){if(!e||e==="none")return oC(s);const l=e.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let d,m;if(l)d=goe,m=l;else{const o=e.match(/^matrix\(([-\d.e\s,]+)\)$/u);d=moe,m=o}if(!m)return oC(s);const _=d[s],w=m[1].split(",").map(yoe);return typeof _=="function"?_(w):w[_]}const xoe=(e,s)=>{const{transform:l="none"}=getComputedStyle(e);return aC(l,s)};function yoe(e){return parseFloat(e.trim())}const Ax=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],Px=new Set(Ax),RL=e=>e===Cx||e===Nn,_oe=new Set(["x","y","z"]),voe=Ax.filter(e=>!_oe.has(e));function boe(e){const s=[];return voe.forEach(l=>{const d=e.getValue(l);d!==void 0&&(s.push([l,d.get()]),d.set(l.startsWith("scale")?1:0))}),s}const df={width:({x:e},{paddingLeft:s="0",paddingRight:l="0"})=>e.max-e.min-parseFloat(s)-parseFloat(l),height:({y:e},{paddingTop:s="0",paddingBottom:l="0"})=>e.max-e.min-parseFloat(s)-parseFloat(l),top:(e,{top:s})=>parseFloat(s),left:(e,{left:s})=>parseFloat(s),bottom:({y:e},{top:s})=>parseFloat(s)+(e.max-e.min),right:({x:e},{left:s})=>parseFloat(s)+(e.max-e.min),x:(e,{transform:s})=>aC(s,"x"),y:(e,{transform:s})=>aC(s,"y")};df.translateX=df.x;df.translateY=df.y;const hf=new Set;let lC=!1,cC=!1,uC=!1;function BU(){if(cC){const e=Array.from(hf).filter(d=>d.needsMeasurement),s=new Set(e.map(d=>d.element)),l=new Map;s.forEach(d=>{const m=boe(d);m.length&&(l.set(d,m),d.render())}),e.forEach(d=>d.measureInitialState()),s.forEach(d=>{d.render();const m=l.get(d);m&&m.forEach(([_,w])=>{var o;(o=d.getValue(_))==null||o.set(w)})}),e.forEach(d=>d.measureEndState()),e.forEach(d=>{d.suspendedScrollY!==void 0&&window.scrollTo(0,d.suspendedScrollY)})}cC=!1,lC=!1,hf.forEach(e=>e.complete(uC)),hf.clear()}function VU(){hf.forEach(e=>{e.readKeyframes(),e.needsMeasurement&&(cC=!0)})}function woe(){uC=!0,VU(),BU(),uC=!1}class $P{constructor(s,l,d,m,_,w=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...s],this.onComplete=l,this.name=d,this.motionValue=m,this.element=_,this.isAsync=w}scheduleResolve(){this.state="scheduled",this.isAsync?(hf.add(this),lC||(lC=!0,oi.read(VU),oi.resolveKeyframes(BU))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:s,name:l,element:d,motionValue:m}=this;if(s[0]===null){const _=m==null?void 0:m.get(),w=s[s.length-1];if(_!==void 0)s[0]=_;else if(d&&l){const o=d.readValue(l,w);o!=null&&(s[0]=o)}s[0]===void 0&&(s[0]=w),m&&_===void 0&&m.set(s[0])}foe(s)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(s=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,s),hf.delete(this)}cancel(){this.state==="scheduled"&&(hf.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const Soe=e=>e.startsWith("--");function joe(e,s,l){Soe(s)?e.style.setProperty(s,l):e.style[s]=l}const Toe=PP(()=>window.ScrollTimeline!==void 0),Noe={};function Eoe(e,s){const l=PP(e);return()=>Noe[s]??l()}const UU=Eoe(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),Z_=([e,s,l,d])=>`cubic-bezier(${e}, ${s}, ${l}, ${d})`,kL={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:Z_([0,.65,.55,1]),circOut:Z_([.55,0,1,.45]),backIn:Z_([.31,.01,.66,-.59]),backOut:Z_([.33,1.53,.69,.99])};function $U(e,s){if(e)return typeof e=="function"?UU()?zU(e,s):"ease-out":EU(e)?Z_(e):Array.isArray(e)?e.map(l=>$U(l,s)||kL.easeOut):kL[e]}function Coe(e,s,l,{delay:d=0,duration:m=300,repeat:_=0,repeatType:w="loop",ease:o="easeOut",times:E}={},P=void 0){const M={[s]:l};E&&(M.offset=E);const L=$U(o,m);Array.isArray(L)&&(M.easing=L);const F={delay:d,duration:m,easing:Array.isArray(L)?"linear":L,fill:"both",iterations:_+1,direction:w==="reverse"?"alternate":"normal"};return P&&(F.pseudoElement=P),e.animate(M,F)}function GU(e){return typeof e=="function"&&"applyToOptions"in e}function Aoe({type:e,...s}){return GU(e)&&UU()?e.applyToOptions(s):(s.duration??(s.duration=300),s.ease??(s.ease="easeOut"),s)}class Poe extends VP{constructor(s){if(super(),this.finishedTime=null,this.isStopped=!1,!s)return;const{element:l,name:d,keyframes:m,pseudoElement:_,allowFlatten:w=!1,finalKeyframe:o,onComplete:E}=s;this.isPseudoElement=!!_,this.allowFlatten=w,this.options=s,u2(typeof s.type!="string");const P=Aoe(s);this.animation=Coe(l,d,m,P,_),P.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!_){const M=BP(m,this.options,o,this.speed);this.updateMotionValue?this.updateMotionValue(M):joe(l,d,M),this.animation.cancel()}E==null||E(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){var s,l;(l=(s=this.animation).finish)==null||l.call(s)}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:s}=this;s==="idle"||s==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){var s,l;this.isPseudoElement||(l=(s=this.animation).commitStyles)==null||l.call(s)}get duration(){var l,d;const s=((d=(l=this.animation.effect)==null?void 0:l.getComputedTiming)==null?void 0:d.call(l).duration)||0;return ru(Number(s))}get time(){return ru(Number(this.animation.currentTime)||0)}set time(s){this.finishedTime=null,this.animation.currentTime=nu(s)}get speed(){return this.animation.playbackRate}set speed(s){s<0&&(this.finishedTime=null),this.animation.playbackRate=s}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(s){this.animation.startTime=s}attachTimeline({timeline:s,observe:l}){var d;return this.allowFlatten&&((d=this.animation.effect)==null||d.updateTiming({easing:"linear"})),this.animation.onfinish=null,s&&Toe()?(this.animation.timeline=s,Cl):l(this)}}const HU={anticipate:SU,backInOut:wU,circInOut:TU};function Ioe(e){return e in HU}function Moe(e){typeof e.ease=="string"&&Ioe(e.ease)&&(e.ease=HU[e.ease])}const DL=10;class Roe extends Poe{constructor(s){Moe(s),FU(s),super(s),s.startTime&&(this.startTime=s.startTime),this.options=s}updateMotionValue(s){const{motionValue:l,onUpdate:d,onComplete:m,element:_,...w}=this.options;if(!l)return;if(s!==void 0){l.set(s);return}const o=new UP({...w,autoplay:!1}),E=nu(this.finishedTime??this.time);l.setWithVelocity(o.sample(E-DL).value,o.sample(E).value,DL),o.stop()}}const LL=(e,s)=>s==="zIndex"?!1:!!(typeof e=="number"||Array.isArray(e)||typeof e=="string"&&(Lh.test(e)||e==="0")&&!e.startsWith("url("));function koe(e){const s=e[0];if(e.length===1)return!0;for(let l=0;l<e.length;l++)if(e[l]!==s)return!0}function Doe(e,s,l,d){const m=e[0];if(m===null)return!1;if(s==="display"||s==="visibility")return!0;const _=e[e.length-1],w=LL(m,s),o=LL(_,s);return!w||!o?!1:koe(e)||(l==="spring"||GU(l))&&d}function dC(e){e.duration=0,e.type}const Loe=new Set(["opacity","clipPath","filter","transform"]),zoe=PP(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function Ooe(e){var M;const{motionValue:s,name:l,repeatDelay:d,repeatType:m,damping:_,type:w}=e;if(!(((M=s==null?void 0:s.owner)==null?void 0:M.current)instanceof HTMLElement))return!1;const{onUpdate:E,transformTemplate:P}=s.owner.getProps();return zoe()&&l&&Loe.has(l)&&(l!=="transform"||!P)&&!E&&!d&&m!=="mirror"&&_!==0&&w!=="inertia"}const Foe=40;class Boe extends VP{constructor({autoplay:s=!0,delay:l=0,type:d="keyframes",repeat:m=0,repeatDelay:_=0,repeatType:w="loop",keyframes:o,name:E,motionValue:P,element:M,...L}){var Y;super(),this.stop=()=>{var H,X;this._animation&&(this._animation.stop(),(H=this.stopTimeline)==null||H.call(this)),(X=this.keyframeResolver)==null||X.cancel()},this.createdAt=ka.now();const F={autoplay:s,delay:l,type:d,repeat:m,repeatDelay:_,repeatType:w,name:E,motionValue:P,element:M,...L},$=(M==null?void 0:M.KeyframeResolver)||$P;this.keyframeResolver=new $(o,(H,X,Z)=>this.onKeyframesResolved(H,X,F,!Z),E,P,M),(Y=this.keyframeResolver)==null||Y.scheduleResolve()}onKeyframesResolved(s,l,d,m){this.keyframeResolver=void 0;const{name:_,type:w,velocity:o,delay:E,isHandoff:P,onUpdate:M}=d;this.resolvedAt=ka.now(),Doe(s,_,w,o)||((sd.instantAnimations||!E)&&(M==null||M(BP(s,d,l))),s[0]=s[s.length-1],dC(d),d.repeat=0);const F={startTime:m?this.resolvedAt?this.resolvedAt-this.createdAt>Foe?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:l,...d,keyframes:s},$=!P&&Ooe(F)?new Roe({...F,element:F.motionValue.owner.current}):new UP(F);$.finished.then(()=>this.notifyFinished()).catch(Cl),this.pendingTimeline&&(this.stopTimeline=$.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=$}get finished(){return this._animation?this.animation.finished:this._finished}then(s,l){return this.finished.finally(s).then(()=>{})}get animation(){var s;return this._animation||((s=this.keyframeResolver)==null||s.resume(),woe()),this._animation}get duration(){return this.animation.duration}get time(){return this.animation.time}set time(s){this.animation.time=s}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(s){this.animation.speed=s}get startTime(){return this.animation.startTime}attachTimeline(s){return this._animation?this.stopTimeline=this.animation.attachTimeline(s):this.pendingTimeline=s,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){var s;this._animation&&this.animation.cancel(),(s=this.keyframeResolver)==null||s.cancel()}}const Voe=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Uoe(e){const s=Voe.exec(e);if(!s)return[,];const[,l,d,m]=s;return[`--${l??d}`,m]}function WU(e,s,l=1){const[d,m]=Uoe(e);if(!d)return;const _=window.getComputedStyle(s).getPropertyValue(d);if(_){const w=_.trim();return fU(w)?parseFloat(w):w}return DP(m)?WU(m,s,l+1):m}function GP(e,s){return(e==null?void 0:e[s])??(e==null?void 0:e.default)??e}const qU=new Set(["width","height","top","left","right","bottom",...Ax]),$oe={test:e=>e==="auto",parse:e=>e},ZU=e=>s=>s.test(e),KU=[Cx,Nn,iu,rh,kie,Rie,$oe],zL=e=>KU.find(ZU(e));function Goe(e){return typeof e=="number"?e===0:e!==null?e==="none"||e==="0"||gU(e):!0}const Hoe=new Set(["brightness","contrast","saturate","opacity"]);function Woe(e){const[s,l]=e.slice(0,-1).split("(");if(s==="drop-shadow")return e;const[d]=l.match(LP)||[];if(!d)return e;const m=l.replace(d,"");let _=Hoe.has(s)?1:0;return d!==l&&(_*=100),s+"("+_+m+")"}const qoe=/\b([a-z-]*)\(.*?\)/gu,hC={...Lh,getAnimatableNone:e=>{const s=e.match(qoe);return s?s.map(Woe).join(" "):e}},OL={...Cx,transform:Math.round},Zoe={rotate:rh,rotateX:rh,rotateY:rh,rotateZ:rh,scale:Zb,scaleX:Zb,scaleY:Zb,scaleZ:Zb,skew:rh,skewX:rh,skewY:rh,distance:Nn,translateX:Nn,translateY:Nn,translateZ:Nn,x:Nn,y:Nn,z:Nn,perspective:Nn,transformPerspective:Nn,opacity:F0,originX:TL,originY:TL,originZ:Nn},HP={borderWidth:Nn,borderTopWidth:Nn,borderRightWidth:Nn,borderBottomWidth:Nn,borderLeftWidth:Nn,borderRadius:Nn,radius:Nn,borderTopLeftRadius:Nn,borderTopRightRadius:Nn,borderBottomRightRadius:Nn,borderBottomLeftRadius:Nn,width:Nn,maxWidth:Nn,height:Nn,maxHeight:Nn,top:Nn,right:Nn,bottom:Nn,left:Nn,padding:Nn,paddingTop:Nn,paddingRight:Nn,paddingBottom:Nn,paddingLeft:Nn,margin:Nn,marginTop:Nn,marginRight:Nn,marginBottom:Nn,marginLeft:Nn,backgroundPositionX:Nn,backgroundPositionY:Nn,...Zoe,zIndex:OL,fillOpacity:F0,strokeOpacity:F0,numOctaves:OL},Koe={...HP,color:Wi,backgroundColor:Wi,outlineColor:Wi,fill:Wi,stroke:Wi,borderColor:Wi,borderTopColor:Wi,borderRightColor:Wi,borderBottomColor:Wi,borderLeftColor:Wi,filter:hC,WebkitFilter:hC},XU=e=>Koe[e];function YU(e,s){let l=XU(e);return l!==hC&&(l=Lh),l.getAnimatableNone?l.getAnimatableNone(s):void 0}const Xoe=new Set(["auto","none","0"]);function Yoe(e,s,l){let d=0,m;for(;d<e.length&&!m;){const _=e[d];typeof _=="string"&&!Xoe.has(_)&&B0(_).values.length&&(m=e[d]),d++}if(m&&l)for(const _ of s)e[_]=YU(l,m)}class Joe extends $P{constructor(s,l,d,m,_){super(s,l,d,m,_,!0)}readKeyframes(){const{unresolvedKeyframes:s,element:l,name:d}=this;if(!l||!l.current)return;super.readKeyframes();for(let E=0;E<s.length;E++){let P=s[E];if(typeof P=="string"&&(P=P.trim(),DP(P))){const M=WU(P,l.current);M!==void 0&&(s[E]=M),E===s.length-1&&(this.finalKeyframe=P)}}if(this.resolveNoneKeyframes(),!qU.has(d)||s.length!==2)return;const[m,_]=s,w=zL(m),o=zL(_);if(w!==o)if(RL(w)&&RL(o))for(let E=0;E<s.length;E++){const P=s[E];typeof P=="string"&&(s[E]=parseFloat(P))}else df[d]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:s,name:l}=this,d=[];for(let m=0;m<s.length;m++)(s[m]===null||Goe(s[m]))&&d.push(m);d.length&&Yoe(s,d,l)}measureInitialState(){const{element:s,unresolvedKeyframes:l,name:d}=this;if(!s||!s.current)return;d==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=df[d](s.measureViewportBox(),window.getComputedStyle(s.current)),l[0]=this.measuredOrigin;const m=l[l.length-1];m!==void 0&&s.getValue(d,m).jump(m,!1)}measureEndState(){var o;const{element:s,name:l,unresolvedKeyframes:d}=this;if(!s||!s.current)return;const m=s.getValue(l);m&&m.jump(this.measuredOrigin,!1);const _=d.length-1,w=d[_];d[_]=df[l](s.measureViewportBox(),window.getComputedStyle(s.current)),w!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=w),(o=this.removedTransforms)!=null&&o.length&&this.removedTransforms.forEach(([E,P])=>{s.getValue(E).set(P)}),this.resolveNoneKeyframes()}}function Qoe(e,s,l){if(e instanceof EventTarget)return[e];if(typeof e=="string"){const m=document.querySelectorAll(e);return m?Array.from(m):[]}return Array.from(e)}const JU=(e,s)=>s&&typeof e=="number"?s.transform(e):e;function QU(e){return mU(e)&&"offsetHeight"in e}const FL=30,eae=e=>!isNaN(parseFloat(e));class tae{constructor(s,l={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=d=>{var _;const m=ka.now();if(this.updatedAt!==m&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(d),this.current!==this.prev&&((_=this.events.change)==null||_.notify(this.current),this.dependents))for(const w of this.dependents)w.dirty()},this.hasAnimated=!1,this.setCurrent(s),this.owner=l.owner}setCurrent(s){this.current=s,this.updatedAt=ka.now(),this.canTrackVelocity===null&&s!==void 0&&(this.canTrackVelocity=eae(this.current))}setPrevFrameValue(s=this.current){this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt}onChange(s){return this.on("change",s)}on(s,l){this.events[s]||(this.events[s]=new IP);const d=this.events[s].add(l);return s==="change"?()=>{d(),oi.read(()=>{this.events.change.getSize()||this.stop()})}:d}clearListeners(){for(const s in this.events)this.events[s].clear()}attach(s,l){this.passiveEffect=s,this.stopPassiveEffect=l}set(s){this.passiveEffect?this.passiveEffect(s,this.updateAndNotify):this.updateAndNotify(s)}setWithVelocity(s,l,d){this.set(l),this.prev=void 0,this.prevFrameValue=s,this.prevUpdatedAt=this.updatedAt-d}jump(s,l=!0){this.updateAndNotify(s),this.prev=s,this.prevUpdatedAt=this.prevFrameValue=void 0,l&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){var s;(s=this.events.change)==null||s.notify(this.current)}addDependent(s){this.dependents||(this.dependents=new Set),this.dependents.add(s)}removeDependent(s){this.dependents&&this.dependents.delete(s)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const s=ka.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||s-this.updatedAt>FL)return 0;const l=Math.min(this.updatedAt-this.prevUpdatedAt,FL);return xU(parseFloat(this.current)-parseFloat(this.prevFrameValue),l)}start(s){return this.stop(),new Promise(l=>{this.hasAnimated=!0,this.animation=s(l),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){var s,l;(s=this.dependents)==null||s.clear(),(l=this.events.destroy)==null||l.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function cx(e,s){return new tae(e,s)}const{schedule:WP,cancel:Wde}=CU(queueMicrotask,!1),Kl={x:!1,y:!1};function e8(){return Kl.x||Kl.y}function sae(e){return e==="x"||e==="y"?Kl[e]?null:(Kl[e]=!0,()=>{Kl[e]=!1}):Kl.x||Kl.y?null:(Kl.x=Kl.y=!0,()=>{Kl.x=Kl.y=!1})}function t8(e,s){const l=Qoe(e),d=new AbortController,m={passive:!0,...s,signal:d.signal};return[l,m,()=>d.abort()]}function BL(e){return!(e.pointerType==="touch"||e8())}function nae(e,s,l={}){const[d,m,_]=t8(e,l),w=o=>{if(!BL(o))return;const{target:E}=o,P=s(E,o);if(typeof P!="function"||!E)return;const M=L=>{BL(L)&&(P(L),E.removeEventListener("pointerleave",M))};E.addEventListener("pointerleave",M,m)};return d.forEach(o=>{o.addEventListener("pointerenter",w,m)}),_}const s8=(e,s)=>s?e===s?!0:s8(e,s.parentElement):!1,qP=e=>e.pointerType==="mouse"?typeof e.button!="number"||e.button<=0:e.isPrimary!==!1,rae=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function iae(e){return rae.has(e.tagName)||e.tabIndex!==-1}const yw=new WeakSet;function VL(e){return s=>{s.key==="Enter"&&e(s)}}function xN(e,s){e.dispatchEvent(new PointerEvent("pointer"+s,{isPrimary:!0,bubbles:!0}))}const oae=(e,s)=>{const l=e.currentTarget;if(!l)return;const d=VL(()=>{if(yw.has(l))return;xN(l,"down");const m=VL(()=>{xN(l,"up")}),_=()=>xN(l,"cancel");l.addEventListener("keyup",m,s),l.addEventListener("blur",_,s)});l.addEventListener("keydown",d,s),l.addEventListener("blur",()=>l.removeEventListener("keydown",d),s)};function UL(e){return qP(e)&&!e8()}function aae(e,s,l={}){const[d,m,_]=t8(e,l),w=o=>{const E=o.currentTarget;if(!UL(o))return;yw.add(E);const P=s(E,o),M=($,Y)=>{window.removeEventListener("pointerup",L),window.removeEventListener("pointercancel",F),yw.has(E)&&yw.delete(E),UL($)&&typeof P=="function"&&P($,{success:Y})},L=$=>{M($,E===window||E===document||l.useGlobalTarget||s8(E,$.target))},F=$=>{M($,!1)};window.addEventListener("pointerup",L,m),window.addEventListener("pointercancel",F,m)};return d.forEach(o=>{(l.useGlobalTarget?window:o).addEventListener("pointerdown",w,m),QU(o)&&(o.addEventListener("focus",P=>oae(P,m)),!iae(o)&&!o.hasAttribute("tabindex")&&(o.tabIndex=0))}),_}function n8(e){return mU(e)&&"ownerSVGElement"in e}function lae(e){return n8(e)&&e.tagName==="svg"}const qo=e=>!!(e&&e.getVelocity),cae=[...KU,Wi,Lh],uae=e=>cae.find(ZU(e)),ZP=z.createContext({transformPagePoint:e=>e,isStatic:!1,reducedMotion:"never"});class dae extends z.Component{getSnapshotBeforeUpdate(s){const l=this.props.childRef.current;if(l&&s.isPresent&&!this.props.isPresent){const d=l.offsetParent,m=QU(d)&&d.offsetWidth||0,_=this.props.sizeRef.current;_.height=l.offsetHeight||0,_.width=l.offsetWidth||0,_.top=l.offsetTop,_.left=l.offsetLeft,_.right=m-_.width-_.left}return null}componentDidUpdate(){}render(){return this.props.children}}function hae({children:e,isPresent:s,anchorX:l,root:d}){const m=z.useId(),_=z.useRef(null),w=z.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:o}=z.useContext(ZP);return z.useInsertionEffect(()=>{const{width:E,height:P,top:M,left:L,right:F}=w.current;if(s||!_.current||!E||!P)return;const $=l==="left"?`left: ${L}`:`right: ${F}`;_.current.dataset.motionPopId=m;const Y=document.createElement("style");o&&(Y.nonce=o);const H=d??document.head;return H.appendChild(Y),Y.sheet&&Y.sheet.insertRule(`
          [data-motion-pop-id="${m}"] {
            position: absolute !important;
            width: ${E}px !important;
            height: ${P}px !important;
            ${$}px !important;
            top: ${M}px !important;
          }
        `),()=>{H.contains(Y)&&H.removeChild(Y)}},[s]),n.jsx(dae,{isPresent:s,childRef:_,sizeRef:w,children:z.cloneElement(e,{ref:_})})}const pae=({children:e,initial:s,isPresent:l,onExitComplete:d,custom:m,presenceAffectsLayout:_,mode:w,anchorX:o,root:E})=>{const P=NP(fae),M=z.useId();let L=!0,F=z.useMemo(()=>(L=!1,{id:M,initial:s,isPresent:l,custom:m,onExitComplete:$=>{P.set($,!0);for(const Y of P.values())if(!Y)return;d&&d()},register:$=>(P.set($,!1),()=>P.delete($))}),[l,P,d]);return _&&L&&(F={...F}),z.useMemo(()=>{P.forEach(($,Y)=>P.set(Y,!1))},[l]),z.useEffect(()=>{!l&&!P.size&&d&&d()},[l]),w==="popLayout"&&(e=n.jsx(hae,{isPresent:l,anchorX:o,root:E,children:e})),n.jsx(xS.Provider,{value:F,children:e})};function fae(){return new Map}function r8(e=!0){const s=z.useContext(xS);if(s===null)return[!0,null];const{isPresent:l,onExitComplete:d,register:m}=s,_=z.useId();z.useEffect(()=>{if(e)return m(_)},[e]);const w=z.useCallback(()=>e&&d&&d(_),[_,d,e]);return!l&&d?[!1,w]:[!0]}const Kb=e=>e.key||"";function $L(e){const s=[];return z.Children.forEach(e,l=>{z.isValidElement(l)&&s.push(l)}),s}const KP=({children:e,custom:s,initial:l=!0,onExitComplete:d,presenceAffectsLayout:m=!0,mode:_="sync",propagate:w=!1,anchorX:o="left",root:E})=>{const[P,M]=r8(w),L=z.useMemo(()=>$L(e),[e]),F=w&&!P?[]:L.map(Kb),$=z.useRef(!0),Y=z.useRef(L),H=NP(()=>new Map),[X,Z]=z.useState(L),[W,q]=z.useState(L);pU(()=>{$.current=!1,Y.current=L;for(let Ne=0;Ne<W.length;Ne++){const Pe=Kb(W[Ne]);F.includes(Pe)?H.delete(Pe):H.get(Pe)!==!0&&H.set(Pe,!1)}},[W,F.length,F.join("-")]);const oe=[];if(L!==X){let Ne=[...L];for(let Pe=0;Pe<W.length;Pe++){const Le=W[Pe],ct=Kb(Le);F.includes(ct)||(Ne.splice(Pe,0,Le),oe.push(Le))}return _==="wait"&&oe.length&&(Ne=oe),q($L(Ne)),Z(L),null}const{forceRender:ae}=z.useContext(TP);return n.jsx(n.Fragment,{children:W.map(Ne=>{const Pe=Kb(Ne),Le=w&&!P?!1:L===W||F.includes(Pe),ct=()=>{if(H.has(Pe))H.set(Pe,!0);else return;let xt=!0;H.forEach(yt=>{yt||(xt=!1)}),xt&&(ae==null||ae(),q(Y.current),w&&(M==null||M()),d&&d())};return n.jsx(pae,{isPresent:Le,initial:!$.current||l?void 0:!1,custom:s,presenceAffectsLayout:m,mode:_,root:E,onExitComplete:Le?void 0:ct,anchorX:o,children:Ne},Pe)})})},i8=z.createContext({strict:!1}),GL={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},ux={};for(const e in GL)ux[e]={isEnabled:s=>GL[e].some(l=>!!s[l])};function mae(e){for(const s in e)ux[s]={...ux[s],...e[s]}}const gae=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function f2(e){return e.startsWith("while")||e.startsWith("drag")&&e!=="draggable"||e.startsWith("layout")||e.startsWith("onTap")||e.startsWith("onPan")||e.startsWith("onLayout")||gae.has(e)}let o8=e=>!f2(e);function xae(e){typeof e=="function"&&(o8=s=>s.startsWith("on")?!f2(s):e(s))}try{xae(require("@emotion/is-prop-valid").default)}catch{}function yae(e,s,l){const d={};for(const m in e)m==="values"&&typeof e.values=="object"||(o8(m)||l===!0&&f2(m)||!s&&!f2(m)||e.draggable&&m.startsWith("onDrag"))&&(d[m]=e[m]);return d}const yS=z.createContext({});function _S(e){return e!==null&&typeof e=="object"&&typeof e.start=="function"}function V0(e){return typeof e=="string"||Array.isArray(e)}const XP=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],YP=["initial",...XP];function vS(e){return _S(e.animate)||YP.some(s=>V0(e[s]))}function a8(e){return!!(vS(e)||e.variants)}function _ae(e,s){if(vS(e)){const{initial:l,animate:d}=e;return{initial:l===!1||V0(l)?l:void 0,animate:V0(d)?d:void 0}}return e.inherit!==!1?s:{}}function vae(e){const{initial:s,animate:l}=_ae(e,z.useContext(yS));return z.useMemo(()=>({initial:s,animate:l}),[HL(s),HL(l)])}function HL(e){return Array.isArray(e)?e.join(" "):e}const U0={};function bae(e){for(const s in e)U0[s]=e[s],kP(s)&&(U0[s].isCSSVariable=!0)}function l8(e,{layout:s,layoutId:l}){return Px.has(e)||e.startsWith("origin")||(s||l!==void 0)&&(!!U0[e]||e==="opacity")}const wae={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},Sae=Ax.length;function jae(e,s,l){let d="",m=!0;for(let _=0;_<Sae;_++){const w=Ax[_],o=e[w];if(o===void 0)continue;let E=!0;if(typeof o=="number"?E=o===(w.startsWith("scale")?1:0):E=parseFloat(o)===0,!E||l){const P=JU(o,HP[w]);if(!E){m=!1;const M=wae[w]||w;d+=`${M}(${P}) `}l&&(s[w]=P)}}return d=d.trim(),l?d=l(s,m?"":d):m&&(d="none"),d}function JP(e,s,l){const{style:d,vars:m,transformOrigin:_}=e;let w=!1,o=!1;for(const E in s){const P=s[E];if(Px.has(E)){w=!0;continue}else if(kP(E)){m[E]=P;continue}else{const M=JU(P,HP[E]);E.startsWith("origin")?(o=!0,_[E]=M):d[E]=M}}if(s.transform||(w||l?d.transform=jae(s,e.transform,l):d.transform&&(d.transform="none")),o){const{originX:E="50%",originY:P="50%",originZ:M=0}=_;d.transformOrigin=`${E} ${P} ${M}`}}const QP=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function c8(e,s,l){for(const d in s)!qo(s[d])&&!l8(d,l)&&(e[d]=s[d])}function Tae({transformTemplate:e},s){return z.useMemo(()=>{const l=QP();return JP(l,s,e),Object.assign({},l.vars,l.style)},[s])}function Nae(e,s){const l=e.style||{},d={};return c8(d,l,e),Object.assign(d,Tae(e,s)),d}function Eae(e,s){const l={},d=Nae(e,s);return e.drag&&e.dragListener!==!1&&(l.draggable=!1,d.userSelect=d.WebkitUserSelect=d.WebkitTouchCallout="none",d.touchAction=e.drag===!0?"none":`pan-${e.drag==="x"?"y":"x"}`),e.tabIndex===void 0&&(e.onTap||e.onTapStart||e.whileTap)&&(l.tabIndex=0),l.style=d,l}const Cae={offset:"stroke-dashoffset",array:"stroke-dasharray"},Aae={offset:"strokeDashoffset",array:"strokeDasharray"};function Pae(e,s,l=1,d=0,m=!0){e.pathLength=1;const _=m?Cae:Aae;e[_.offset]=Nn.transform(-d);const w=Nn.transform(s),o=Nn.transform(l);e[_.array]=`${w} ${o}`}function u8(e,{attrX:s,attrY:l,attrScale:d,pathLength:m,pathSpacing:_=1,pathOffset:w=0,...o},E,P,M){if(JP(e,o,P),E){e.style.viewBox&&(e.attrs.viewBox=e.style.viewBox);return}e.attrs=e.style,e.style={};const{attrs:L,style:F}=e;L.transform&&(F.transform=L.transform,delete L.transform),(F.transform||L.transformOrigin)&&(F.transformOrigin=L.transformOrigin??"50% 50%",delete L.transformOrigin),F.transform&&(F.transformBox=(M==null?void 0:M.transformBox)??"fill-box",delete L.transformBox),s!==void 0&&(L.x=s),l!==void 0&&(L.y=l),d!==void 0&&(L.scale=d),m!==void 0&&Pae(L,m,_,w,!1)}const d8=()=>({...QP(),attrs:{}}),h8=e=>typeof e=="string"&&e.toLowerCase()==="svg";function Iae(e,s,l,d){const m=z.useMemo(()=>{const _=d8();return u8(_,s,h8(d),e.transformTemplate,e.style),{..._.attrs,style:{..._.style}}},[s]);if(e.style){const _={};c8(_,e.style,e),m.style={..._,...m.style}}return m}const Mae=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function eI(e){return typeof e!="string"||e.includes("-")?!1:!!(Mae.indexOf(e)>-1||/[A-Z]/u.test(e))}function Rae(e,s,l,{latestValues:d},m,_=!1){const o=(eI(e)?Iae:Eae)(s,d,m,e),E=yae(s,typeof e=="string",_),P=e!==z.Fragment?{...E,...o,ref:l}:{},{children:M}=s,L=z.useMemo(()=>qo(M)?M.get():M,[M]);return z.createElement(e,{...P,children:L})}function WL(e){const s=[{},{}];return e==null||e.values.forEach((l,d)=>{s[0][d]=l.get(),s[1][d]=l.getVelocity()}),s}function tI(e,s,l,d){if(typeof s=="function"){const[m,_]=WL(d);s=s(l!==void 0?l:e.custom,m,_)}if(typeof s=="string"&&(s=e.variants&&e.variants[s]),typeof s=="function"){const[m,_]=WL(d);s=s(l!==void 0?l:e.custom,m,_)}return s}function _w(e){return qo(e)?e.get():e}function kae({scrapeMotionValuesFromProps:e,createRenderState:s},l,d,m){return{latestValues:Dae(l,d,m,e),renderState:s()}}function Dae(e,s,l,d){const m={},_=d(e,{});for(const F in _)m[F]=_w(_[F]);let{initial:w,animate:o}=e;const E=vS(e),P=a8(e);s&&P&&!E&&e.inherit!==!1&&(w===void 0&&(w=s.initial),o===void 0&&(o=s.animate));let M=l?l.initial===!1:!1;M=M||w===!1;const L=M?o:w;if(L&&typeof L!="boolean"&&!_S(L)){const F=Array.isArray(L)?L:[L];for(let $=0;$<F.length;$++){const Y=tI(e,F[$]);if(Y){const{transitionEnd:H,transition:X,...Z}=Y;for(const W in Z){let q=Z[W];if(Array.isArray(q)){const oe=M?q.length-1:0;q=q[oe]}q!==null&&(m[W]=q)}for(const W in H)m[W]=H[W]}}}return m}const p8=e=>(s,l)=>{const d=z.useContext(yS),m=z.useContext(xS),_=()=>kae(e,s,d,m);return l?_():NP(_)};function sI(e,s,l){var _;const{style:d}=e,m={};for(const w in d)(qo(d[w])||s.style&&qo(s.style[w])||l8(w,e)||((_=l==null?void 0:l.getValue(w))==null?void 0:_.liveStyle)!==void 0)&&(m[w]=d[w]);return m}const Lae=p8({scrapeMotionValuesFromProps:sI,createRenderState:QP});function f8(e,s,l){const d=sI(e,s,l);for(const m in e)if(qo(e[m])||qo(s[m])){const _=Ax.indexOf(m)!==-1?"attr"+m.charAt(0).toUpperCase()+m.substring(1):m;d[_]=e[m]}return d}const zae=p8({scrapeMotionValuesFromProps:f8,createRenderState:d8}),Oae=Symbol.for("motionComponentSymbol");function bg(e){return e&&typeof e=="object"&&Object.prototype.hasOwnProperty.call(e,"current")}function Fae(e,s,l){return z.useCallback(d=>{d&&e.onMount&&e.onMount(d),s&&(d?s.mount(d):s.unmount()),l&&(typeof l=="function"?l(d):bg(l)&&(l.current=d))},[s])}const nI=e=>e.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),Bae="framerAppearId",m8="data-"+nI(Bae),g8=z.createContext({});function Vae(e,s,l,d,m){var H,X;const{visualElement:_}=z.useContext(yS),w=z.useContext(i8),o=z.useContext(xS),E=z.useContext(ZP).reducedMotion,P=z.useRef(null);d=d||w.renderer,!P.current&&d&&(P.current=d(e,{visualState:s,parent:_,props:l,presenceContext:o,blockInitialAnimation:o?o.initial===!1:!1,reducedMotionConfig:E}));const M=P.current,L=z.useContext(g8);M&&!M.projection&&m&&(M.type==="html"||M.type==="svg")&&Uae(P.current,l,m,L);const F=z.useRef(!1);z.useInsertionEffect(()=>{M&&F.current&&M.update(l,o)});const $=l[m8],Y=z.useRef(!!$&&!((H=window.MotionHandoffIsComplete)!=null&&H.call(window,$))&&((X=window.MotionHasOptimisedAnimation)==null?void 0:X.call(window,$)));return pU(()=>{M&&(F.current=!0,window.MotionIsMounted=!0,M.updateFeatures(),M.scheduleRenderMicrotask(),Y.current&&M.animationState&&M.animationState.animateChanges())}),z.useEffect(()=>{M&&(!Y.current&&M.animationState&&M.animationState.animateChanges(),Y.current&&(queueMicrotask(()=>{var Z;(Z=window.MotionHandoffMarkAsComplete)==null||Z.call(window,$)}),Y.current=!1),M.enteringChildren=void 0)}),M}function Uae(e,s,l,d){const{layoutId:m,layout:_,drag:w,dragConstraints:o,layoutScroll:E,layoutRoot:P,layoutCrossfade:M}=s;e.projection=new l(e.latestValues,s["data-framer-portal-id"]?void 0:x8(e.parent)),e.projection.setOptions({layoutId:m,layout:_,alwaysMeasureLayout:!!w||o&&bg(o),visualElement:e,animationType:typeof _=="string"?_:"both",initialPromotionConfig:d,crossfade:M,layoutScroll:E,layoutRoot:P})}function x8(e){if(e)return e.options.allowProjection!==!1?e.projection:x8(e.parent)}function yN(e,{forwardMotionProps:s=!1}={},l,d){l&&mae(l);const m=eI(e)?zae:Lae;function _(o,E){let P;const M={...z.useContext(ZP),...o,layoutId:$ae(o)},{isStatic:L}=M,F=vae(o),$=m(o,L);if(!L&&EP){Gae();const Y=Hae(M);P=Y.MeasureLayout,F.visualElement=Vae(e,$,M,d,Y.ProjectionNode)}return n.jsxs(yS.Provider,{value:F,children:[P&&F.visualElement?n.jsx(P,{visualElement:F.visualElement,...M}):null,Rae(e,o,Fae($,F.visualElement,E),$,L,s)]})}_.displayName=`motion.${typeof e=="string"?e:`create(${e.displayName??e.name??""})`}`;const w=z.forwardRef(_);return w[Oae]=e,w}function $ae({layoutId:e}){const s=z.useContext(TP).id;return s&&e!==void 0?s+"-"+e:e}function Gae(e,s){z.useContext(i8).strict}function Hae(e){const{drag:s,layout:l}=ux;if(!s&&!l)return{};const d={...s,...l};return{MeasureLayout:s!=null&&s.isEnabled(e)||l!=null&&l.isEnabled(e)?d.MeasureLayout:void 0,ProjectionNode:d.ProjectionNode}}function Wae(e,s){if(typeof Proxy>"u")return yN;const l=new Map,d=(_,w)=>yN(_,w,e,s),m=(_,w)=>d(_,w);return new Proxy(m,{get:(_,w)=>w==="create"?d:(l.has(w)||l.set(w,yN(w,void 0,e,s)),l.get(w))})}function y8({top:e,left:s,right:l,bottom:d}){return{x:{min:s,max:l},y:{min:e,max:d}}}function qae({x:e,y:s}){return{top:s.min,right:e.max,bottom:s.max,left:e.min}}function Zae(e,s){if(!s)return e;const l=s({x:e.left,y:e.top}),d=s({x:e.right,y:e.bottom});return{top:l.y,left:l.x,bottom:d.y,right:d.x}}function _N(e){return e===void 0||e===1}function pC({scale:e,scaleX:s,scaleY:l}){return!_N(e)||!_N(s)||!_N(l)}function qp(e){return pC(e)||_8(e)||e.z||e.rotate||e.rotateX||e.rotateY||e.skewX||e.skewY}function _8(e){return qL(e.x)||qL(e.y)}function qL(e){return e&&e!=="0%"}function m2(e,s,l){const d=e-l,m=s*d;return l+m}function ZL(e,s,l,d,m){return m!==void 0&&(e=m2(e,m,d)),m2(e,l,d)+s}function fC(e,s=0,l=1,d,m){e.min=ZL(e.min,s,l,d,m),e.max=ZL(e.max,s,l,d,m)}function v8(e,{x:s,y:l}){fC(e.x,s.translate,s.scale,s.originPoint),fC(e.y,l.translate,l.scale,l.originPoint)}const KL=.999999999999,XL=1.0000000000001;function Kae(e,s,l,d=!1){const m=l.length;if(!m)return;s.x=s.y=1;let _,w;for(let o=0;o<m;o++){_=l[o],w=_.projectionDelta;const{visualElement:E}=_.options;E&&E.props.style&&E.props.style.display==="contents"||(d&&_.options.layoutScroll&&_.scroll&&_!==_.root&&Sg(e,{x:-_.scroll.offset.x,y:-_.scroll.offset.y}),w&&(s.x*=w.x.scale,s.y*=w.y.scale,v8(e,w)),d&&qp(_.latestValues)&&Sg(e,_.latestValues))}s.x<XL&&s.x>KL&&(s.x=1),s.y<XL&&s.y>KL&&(s.y=1)}function wg(e,s){e.min=e.min+s,e.max=e.max+s}function YL(e,s,l,d,m=.5){const _=ui(e.min,e.max,m);fC(e,s,l,_,d)}function Sg(e,s){YL(e.x,s.x,s.scaleX,s.scale,s.originX),YL(e.y,s.y,s.scaleY,s.scale,s.originY)}function b8(e,s){return y8(Zae(e.getBoundingClientRect(),s))}function Xae(e,s,l){const d=b8(e,l),{scroll:m}=s;return m&&(wg(d.x,m.offset.x),wg(d.y,m.offset.y)),d}const JL=()=>({translate:0,scale:1,origin:0,originPoint:0}),jg=()=>({x:JL(),y:JL()}),QL=()=>({min:0,max:0}),Ri=()=>({x:QL(),y:QL()}),mC={current:null},w8={current:!1};function Yae(){if(w8.current=!0,!!EP)if(window.matchMedia){const e=window.matchMedia("(prefers-reduced-motion)"),s=()=>mC.current=e.matches;e.addEventListener("change",s),s()}else mC.current=!1}const Jae=new WeakMap;function Qae(e,s,l){for(const d in s){const m=s[d],_=l[d];if(qo(m))e.addValue(d,m);else if(qo(_))e.addValue(d,cx(m,{owner:e}));else if(_!==m)if(e.hasValue(d)){const w=e.getValue(d);w.liveStyle===!0?w.jump(m):w.hasAnimated||w.set(m)}else{const w=e.getStaticValue(d);e.addValue(d,cx(w!==void 0?w:m,{owner:e}))}}for(const d in l)s[d]===void 0&&e.removeValue(d);return s}const e4=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class ele{scrapeMotionValuesFromProps(s,l,d){return{}}constructor({parent:s,props:l,presenceContext:d,reducedMotionConfig:m,blockInitialAnimation:_,visualState:w},o={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=$P,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const F=ka.now();this.renderScheduledAt<F&&(this.renderScheduledAt=F,oi.render(this.render,!1,!0))};const{latestValues:E,renderState:P}=w;this.latestValues=E,this.baseTarget={...E},this.initialValues=l.initial?{...E}:{},this.renderState=P,this.parent=s,this.props=l,this.presenceContext=d,this.depth=s?s.depth+1:0,this.reducedMotionConfig=m,this.options=o,this.blockInitialAnimation=!!_,this.isControllingVariants=vS(l),this.isVariantNode=a8(l),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(s&&s.current);const{willChange:M,...L}=this.scrapeMotionValuesFromProps(l,{},this);for(const F in L){const $=L[F];E[F]!==void 0&&qo($)&&$.set(E[F])}}mount(s){var l;this.current=s,Jae.set(s,this),this.projection&&!this.projection.instance&&this.projection.mount(s),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((d,m)=>this.bindToMotionValue(m,d)),w8.current||Yae(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:mC.current,(l=this.parent)==null||l.addChild(this),this.update(this.props,this.presenceContext)}unmount(){var s;this.projection&&this.projection.unmount(),Dh(this.notifyUpdate),Dh(this.render),this.valueSubscriptions.forEach(l=>l()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),(s=this.parent)==null||s.removeChild(this);for(const l in this.events)this.events[l].clear();for(const l in this.features){const d=this.features[l];d&&(d.unmount(),d.isMounted=!1)}this.current=null}addChild(s){this.children.add(s),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(s)}removeChild(s){this.children.delete(s),this.enteringChildren&&this.enteringChildren.delete(s)}bindToMotionValue(s,l){this.valueSubscriptions.has(s)&&this.valueSubscriptions.get(s)();const d=Px.has(s);d&&this.onBindTransform&&this.onBindTransform();const m=l.on("change",w=>{this.latestValues[s]=w,this.props.onUpdate&&oi.preRender(this.notifyUpdate),d&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let _;window.MotionCheckAppearSync&&(_=window.MotionCheckAppearSync(this,s,l)),this.valueSubscriptions.set(s,()=>{m(),_&&_(),l.owner&&l.stop()})}sortNodePosition(s){return!this.current||!this.sortInstanceNodePosition||this.type!==s.type?0:this.sortInstanceNodePosition(this.current,s.current)}updateFeatures(){let s="animation";for(s in ux){const l=ux[s];if(!l)continue;const{isEnabled:d,Feature:m}=l;if(!this.features[s]&&m&&d(this.props)&&(this.features[s]=new m(this)),this.features[s]){const _=this.features[s];_.isMounted?_.update():(_.mount(),_.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):Ri()}getStaticValue(s){return this.latestValues[s]}setStaticValue(s,l){this.latestValues[s]=l}update(s,l){(s.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=s,this.prevPresenceContext=this.presenceContext,this.presenceContext=l;for(let d=0;d<e4.length;d++){const m=e4[d];this.propEventSubscriptions[m]&&(this.propEventSubscriptions[m](),delete this.propEventSubscriptions[m]);const _="on"+m,w=s[_];w&&(this.propEventSubscriptions[m]=this.on(m,w))}this.prevMotionValues=Qae(this,this.scrapeMotionValuesFromProps(s,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(s){return this.props.variants?this.props.variants[s]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(s){const l=this.getClosestVariantNode();if(l)return l.variantChildren&&l.variantChildren.add(s),()=>l.variantChildren.delete(s)}addValue(s,l){const d=this.values.get(s);l!==d&&(d&&this.removeValue(s),this.bindToMotionValue(s,l),this.values.set(s,l),this.latestValues[s]=l.get())}removeValue(s){this.values.delete(s);const l=this.valueSubscriptions.get(s);l&&(l(),this.valueSubscriptions.delete(s)),delete this.latestValues[s],this.removeValueFromRenderState(s,this.renderState)}hasValue(s){return this.values.has(s)}getValue(s,l){if(this.props.values&&this.props.values[s])return this.props.values[s];let d=this.values.get(s);return d===void 0&&l!==void 0&&(d=cx(l===null?void 0:l,{owner:this}),this.addValue(s,d)),d}readValue(s,l){let d=this.latestValues[s]!==void 0||!this.current?this.latestValues[s]:this.getBaseTargetFromProps(this.props,s)??this.readValueFromInstance(this.current,s,this.options);return d!=null&&(typeof d=="string"&&(fU(d)||gU(d))?d=parseFloat(d):!uae(d)&&Lh.test(l)&&(d=YU(s,l)),this.setBaseTarget(s,qo(d)?d.get():d)),qo(d)?d.get():d}setBaseTarget(s,l){this.baseTarget[s]=l}getBaseTarget(s){var _;const{initial:l}=this.props;let d;if(typeof l=="string"||typeof l=="object"){const w=tI(this.props,l,(_=this.presenceContext)==null?void 0:_.custom);w&&(d=w[s])}if(l&&d!==void 0)return d;const m=this.getBaseTargetFromProps(this.props,s);return m!==void 0&&!qo(m)?m:this.initialValues[s]!==void 0&&d===void 0?void 0:this.baseTarget[s]}on(s,l){return this.events[s]||(this.events[s]=new IP),this.events[s].add(l)}notify(s,...l){this.events[s]&&this.events[s].notify(...l)}scheduleRenderMicrotask(){WP.render(this.render)}}class S8 extends ele{constructor(){super(...arguments),this.KeyframeResolver=Joe}sortInstanceNodePosition(s,l){return s.compareDocumentPosition(l)&2?1:-1}getBaseTargetFromProps(s,l){return s.style?s.style[l]:void 0}removeValueFromRenderState(s,{vars:l,style:d}){delete l[s],delete d[s]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:s}=this.props;qo(s)&&(this.childSubscription=s.on("change",l=>{this.current&&(this.current.textContent=`${l}`)}))}}function j8(e,{style:s,vars:l},d,m){const _=e.style;let w;for(w in s)_[w]=s[w];m==null||m.applyProjectionStyles(_,d);for(w in l)_.setProperty(w,l[w])}function tle(e){return window.getComputedStyle(e)}class sle extends S8{constructor(){super(...arguments),this.type="html",this.renderInstance=j8}readValueFromInstance(s,l){var d;if(Px.has(l))return(d=this.projection)!=null&&d.isProjecting?oC(l):xoe(s,l);{const m=tle(s),_=(kP(l)?m.getPropertyValue(l):m[l])||0;return typeof _=="string"?_.trim():_}}measureInstanceViewportBox(s,{transformPagePoint:l}){return b8(s,l)}build(s,l,d){JP(s,l,d.transformTemplate)}scrapeMotionValuesFromProps(s,l,d){return sI(s,l,d)}}const T8=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function nle(e,s,l,d){j8(e,s,void 0,d);for(const m in s.attrs)e.setAttribute(T8.has(m)?m:nI(m),s.attrs[m])}class rle extends S8{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=Ri}getBaseTargetFromProps(s,l){return s[l]}readValueFromInstance(s,l){if(Px.has(l)){const d=XU(l);return d&&d.default||0}return l=T8.has(l)?l:nI(l),s.getAttribute(l)}scrapeMotionValuesFromProps(s,l,d){return f8(s,l,d)}build(s,l,d){u8(s,l,this.isSVGTag,d.transformTemplate,d.style)}renderInstance(s,l,d,m){nle(s,l,d,m)}mount(s){this.isSVGTag=h8(s.tagName),super.mount(s)}}const ile=(e,s)=>eI(e)?new rle(s):new sle(s,{allowProjection:e!==z.Fragment});function zg(e,s,l){const d=e.getProps();return tI(d,s,l!==void 0?l:d.custom,e)}const gC=e=>Array.isArray(e);function ole(e,s,l){e.hasValue(s)?e.getValue(s).set(l):e.addValue(s,cx(l))}function ale(e){return gC(e)?e[e.length-1]||0:e}function lle(e,s){const l=zg(e,s);let{transitionEnd:d={},transition:m={},..._}=l||{};_={..._,...d};for(const w in _){const o=ale(_[w]);ole(e,w,o)}}function cle(e){return!!(qo(e)&&e.add)}function xC(e,s){const l=e.getValue("willChange");if(cle(l))return l.add(s);if(!l&&sd.WillChange){const d=new sd.WillChange("auto");e.addValue("willChange",d),d.add(s)}}function N8(e){return e.props[m8]}const ule=e=>e!==null;function dle(e,{repeat:s,repeatType:l="loop"},d){const m=e.filter(ule),_=s&&l!=="loop"&&s%2===1?0:m.length-1;return!_||d===void 0?m[_]:d}const hle={type:"spring",stiffness:500,damping:25,restSpeed:10},ple=e=>({type:"spring",stiffness:550,damping:e===0?2*Math.sqrt(550):30,restSpeed:10}),fle={type:"keyframes",duration:.8},mle={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},gle=(e,{keyframes:s})=>s.length>2?fle:Px.has(e)?e.startsWith("scale")?ple(s[1]):hle:mle;function xle({when:e,delay:s,delayChildren:l,staggerChildren:d,staggerDirection:m,repeat:_,repeatType:w,repeatDelay:o,from:E,elapsed:P,...M}){return!!Object.keys(M).length}const rI=(e,s,l,d={},m,_)=>w=>{const o=GP(d,e)||{},E=o.delay||d.delay||0;let{elapsed:P=0}=d;P=P-nu(E);const M={keyframes:Array.isArray(l)?l:[null,l],ease:"easeOut",velocity:s.getVelocity(),...o,delay:-P,onUpdate:F=>{s.set(F),o.onUpdate&&o.onUpdate(F)},onComplete:()=>{w(),o.onComplete&&o.onComplete()},name:e,motionValue:s,element:_?void 0:m};xle(o)||Object.assign(M,gle(e,M)),M.duration&&(M.duration=nu(M.duration)),M.repeatDelay&&(M.repeatDelay=nu(M.repeatDelay)),M.from!==void 0&&(M.keyframes[0]=M.from);let L=!1;if((M.type===!1||M.duration===0&&!M.repeatDelay)&&(dC(M),M.delay===0&&(L=!0)),(sd.instantAnimations||sd.skipAnimations)&&(L=!0,dC(M),M.delay=0),M.allowFlatten=!o.type&&!o.ease,L&&!_&&s.get()!==void 0){const F=dle(M.keyframes,o);if(F!==void 0){oi.update(()=>{M.onUpdate(F),M.onComplete()});return}}return o.isSync?new UP(M):new Boe(M)};function yle({protectedKeys:e,needsAnimating:s},l){const d=e.hasOwnProperty(l)&&s[l]!==!0;return s[l]=!1,d}function E8(e,s,{delay:l=0,transitionOverride:d,type:m}={}){let{transition:_=e.getDefaultTransition(),transitionEnd:w,...o}=s;d&&(_=d);const E=[],P=m&&e.animationState&&e.animationState.getState()[m];for(const M in o){const L=e.getValue(M,e.latestValues[M]??null),F=o[M];if(F===void 0||P&&yle(P,M))continue;const $={delay:l,...GP(_||{},M)},Y=L.get();if(Y!==void 0&&!L.isAnimating&&!Array.isArray(F)&&F===Y&&!$.velocity)continue;let H=!1;if(window.MotionHandoffAnimation){const Z=N8(e);if(Z){const W=window.MotionHandoffAnimation(Z,M,oi);W!==null&&($.startTime=W,H=!0)}}xC(e,M),L.start(rI(M,L,F,e.shouldReduceMotion&&qU.has(M)?{type:!1}:$,e,H));const X=L.animation;X&&E.push(X)}return w&&Promise.all(E).then(()=>{oi.update(()=>{w&&lle(e,w)})}),E}function C8(e,s,l,d=0,m=1){const _=Array.from(e).sort((P,M)=>P.sortNodePosition(M)).indexOf(s),w=e.size,o=(w-1)*d;return typeof l=="function"?l(_,w):m===1?_*d:o-_*d}function yC(e,s,l={}){var E;const d=zg(e,s,l.type==="exit"?(E=e.presenceContext)==null?void 0:E.custom:void 0);let{transition:m=e.getDefaultTransition()||{}}=d||{};l.transitionOverride&&(m=l.transitionOverride);const _=d?()=>Promise.all(E8(e,d,l)):()=>Promise.resolve(),w=e.variantChildren&&e.variantChildren.size?(P=0)=>{const{delayChildren:M=0,staggerChildren:L,staggerDirection:F}=m;return _le(e,s,P,M,L,F,l)}:()=>Promise.resolve(),{when:o}=m;if(o){const[P,M]=o==="beforeChildren"?[_,w]:[w,_];return P().then(()=>M())}else return Promise.all([_(),w(l.delay)])}function _le(e,s,l=0,d=0,m=0,_=1,w){const o=[];for(const E of e.variantChildren)E.notify("AnimationStart",s),o.push(yC(E,s,{...w,delay:l+(typeof d=="function"?0:d)+C8(e.variantChildren,E,d,m,_)}).then(()=>E.notify("AnimationComplete",s)));return Promise.all(o)}function vle(e,s,l={}){e.notify("AnimationStart",s);let d;if(Array.isArray(s)){const m=s.map(_=>yC(e,_,l));d=Promise.all(m)}else if(typeof s=="string")d=yC(e,s,l);else{const m=typeof s=="function"?zg(e,s,l.custom):s;d=Promise.all(E8(e,m,l))}return d.then(()=>{e.notify("AnimationComplete",s)})}function A8(e,s){if(!Array.isArray(s))return!1;const l=s.length;if(l!==e.length)return!1;for(let d=0;d<l;d++)if(s[d]!==e[d])return!1;return!0}const ble=YP.length;function P8(e){if(!e)return;if(!e.isControllingVariants){const l=e.parent?P8(e.parent)||{}:{};return e.props.initial!==void 0&&(l.initial=e.props.initial),l}const s={};for(let l=0;l<ble;l++){const d=YP[l],m=e.props[d];(V0(m)||m===!1)&&(s[d]=m)}return s}const wle=[...XP].reverse(),Sle=XP.length;function jle(e){return s=>Promise.all(s.map(({animation:l,options:d})=>vle(e,l,d)))}function Tle(e){let s=jle(e),l=t4(),d=!0;const m=E=>(P,M)=>{var F;const L=zg(e,M,E==="exit"?(F=e.presenceContext)==null?void 0:F.custom:void 0);if(L){const{transition:$,transitionEnd:Y,...H}=L;P={...P,...H,...Y}}return P};function _(E){s=E(e)}function w(E){const{props:P}=e,M=P8(e.parent)||{},L=[],F=new Set;let $={},Y=1/0;for(let X=0;X<Sle;X++){const Z=wle[X],W=l[Z],q=P[Z]!==void 0?P[Z]:M[Z],oe=V0(q),ae=Z===E?W.isActive:null;ae===!1&&(Y=X);let Ne=q===M[Z]&&q!==P[Z]&&oe;if(Ne&&d&&e.manuallyAnimateOnMount&&(Ne=!1),W.protectedKeys={...$},!W.isActive&&ae===null||!q&&!W.prevProp||_S(q)||typeof q=="boolean")continue;const Pe=Nle(W.prevProp,q);let Le=Pe||Z===E&&W.isActive&&!Ne&&oe||X>Y&&oe,ct=!1;const xt=Array.isArray(q)?q:[q];let yt=xt.reduce(m(Z),{});ae===!1&&(yt={});const{prevResolvedValues:Ht={}}=W,Dt={...Ht,...yt},wt=Bt=>{Le=!0,F.has(Bt)&&(ct=!0,F.delete(Bt)),W.needsAnimating[Bt]=!0;const ze=e.getValue(Bt);ze&&(ze.liveStyle=!1)};for(const Bt in Dt){const ze=yt[Bt],Xe=Ht[Bt];if($.hasOwnProperty(Bt))continue;let Ot=!1;gC(ze)&&gC(Xe)?Ot=!A8(ze,Xe):Ot=ze!==Xe,Ot?ze!=null?wt(Bt):F.add(Bt):ze!==void 0&&F.has(Bt)?wt(Bt):W.protectedKeys[Bt]=!0}W.prevProp=q,W.prevResolvedValues=yt,W.isActive&&($={...$,...yt}),d&&e.blockInitialAnimation&&(Le=!1);const rs=Ne&&Pe;Le&&(!rs||ct)&&L.push(...xt.map(Bt=>{const ze={type:Z};if(typeof Bt=="string"&&d&&!rs&&e.manuallyAnimateOnMount&&e.parent){const{parent:Xe}=e,Ot=zg(Xe,Bt);if(Xe.enteringChildren&&Ot){const{delayChildren:nt}=Ot.transition||{};ze.delay=C8(Xe.enteringChildren,e,nt)}}return{animation:Bt,options:ze}}))}if(F.size){const X={};if(typeof P.initial!="boolean"){const Z=zg(e,Array.isArray(P.initial)?P.initial[0]:P.initial);Z&&Z.transition&&(X.transition=Z.transition)}F.forEach(Z=>{const W=e.getBaseTarget(Z),q=e.getValue(Z);q&&(q.liveStyle=!0),X[Z]=W??null}),L.push({animation:X})}let H=!!L.length;return d&&(P.initial===!1||P.initial===P.animate)&&!e.manuallyAnimateOnMount&&(H=!1),d=!1,H?s(L):Promise.resolve()}function o(E,P){var L;if(l[E].isActive===P)return Promise.resolve();(L=e.variantChildren)==null||L.forEach(F=>{var $;return($=F.animationState)==null?void 0:$.setActive(E,P)}),l[E].isActive=P;const M=w(E);for(const F in l)l[F].protectedKeys={};return M}return{animateChanges:w,setActive:o,setAnimateFunction:_,getState:()=>l,reset:()=>{l=t4(),d=!0}}}function Nle(e,s){return typeof s=="string"?s!==e:Array.isArray(s)?!A8(s,e):!1}function $p(e=!1){return{isActive:e,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function t4(){return{animate:$p(!0),whileInView:$p(),whileHover:$p(),whileTap:$p(),whileDrag:$p(),whileFocus:$p(),exit:$p()}}class Hh{constructor(s){this.isMounted=!1,this.node=s}update(){}}class Ele extends Hh{constructor(s){super(s),s.animationState||(s.animationState=Tle(s))}updateAnimationControlsSubscription(){const{animate:s}=this.node.getProps();_S(s)&&(this.unmountControls=s.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:s}=this.node.getProps(),{animate:l}=this.node.prevProps||{};s!==l&&this.updateAnimationControlsSubscription()}unmount(){var s;this.node.animationState.reset(),(s=this.unmountControls)==null||s.call(this)}}let Cle=0;class Ale extends Hh{constructor(){super(...arguments),this.id=Cle++}update(){if(!this.node.presenceContext)return;const{isPresent:s,onExitComplete:l}=this.node.presenceContext,{isPresent:d}=this.node.prevPresenceContext||{};if(!this.node.animationState||s===d)return;const m=this.node.animationState.setActive("exit",!s);l&&!s&&m.then(()=>{l(this.id)})}mount(){const{register:s,onExitComplete:l}=this.node.presenceContext||{};l&&l(this.id),s&&(this.unmount=s(this.id))}unmount(){}}const Ple={animation:{Feature:Ele},exit:{Feature:Ale}};function $0(e,s,l,d={passive:!0}){return e.addEventListener(s,l,d),()=>e.removeEventListener(s,l)}function yv(e){return{point:{x:e.pageX,y:e.pageY}}}const Ile=e=>s=>qP(s)&&e(s,yv(s));function a0(e,s,l,d){return $0(e,s,Ile(l),d)}const I8=1e-4,Mle=1-I8,Rle=1+I8,M8=.01,kle=0-M8,Dle=0+M8;function ma(e){return e.max-e.min}function Lle(e,s,l){return Math.abs(e-s)<=l}function s4(e,s,l,d=.5){e.origin=d,e.originPoint=ui(s.min,s.max,e.origin),e.scale=ma(l)/ma(s),e.translate=ui(l.min,l.max,e.origin)-e.originPoint,(e.scale>=Mle&&e.scale<=Rle||isNaN(e.scale))&&(e.scale=1),(e.translate>=kle&&e.translate<=Dle||isNaN(e.translate))&&(e.translate=0)}function l0(e,s,l,d){s4(e.x,s.x,l.x,d?d.originX:void 0),s4(e.y,s.y,l.y,d?d.originY:void 0)}function n4(e,s,l){e.min=l.min+s.min,e.max=e.min+ma(s)}function zle(e,s,l){n4(e.x,s.x,l.x),n4(e.y,s.y,l.y)}function r4(e,s,l){e.min=s.min-l.min,e.max=e.min+ma(s)}function c0(e,s,l){r4(e.x,s.x,l.x),r4(e.y,s.y,l.y)}function bl(e){return[e("x"),e("y")]}const R8=({current:e})=>e?e.ownerDocument.defaultView:null,i4=(e,s)=>Math.abs(e-s);function Ole(e,s){const l=i4(e.x,s.x),d=i4(e.y,s.y);return Math.sqrt(l**2+d**2)}class k8{constructor(s,l,{transformPagePoint:d,contextWindow:m=window,dragSnapToOrigin:_=!1,distanceThreshold:w=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const F=bN(this.lastMoveEventInfo,this.history),$=this.startEvent!==null,Y=Ole(F.offset,{x:0,y:0})>=this.distanceThreshold;if(!$&&!Y)return;const{point:H}=F,{timestamp:X}=Mo;this.history.push({...H,timestamp:X});const{onStart:Z,onMove:W}=this.handlers;$||(Z&&Z(this.lastMoveEvent,F),this.startEvent=this.lastMoveEvent),W&&W(this.lastMoveEvent,F)},this.handlePointerMove=(F,$)=>{this.lastMoveEvent=F,this.lastMoveEventInfo=vN($,this.transformPagePoint),oi.update(this.updatePoint,!0)},this.handlePointerUp=(F,$)=>{this.end();const{onEnd:Y,onSessionEnd:H,resumeAnimation:X}=this.handlers;if(this.dragSnapToOrigin&&X&&X(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const Z=bN(F.type==="pointercancel"?this.lastMoveEventInfo:vN($,this.transformPagePoint),this.history);this.startEvent&&Y&&Y(F,Z),H&&H(F,Z)},!qP(s))return;this.dragSnapToOrigin=_,this.handlers=l,this.transformPagePoint=d,this.distanceThreshold=w,this.contextWindow=m||window;const o=yv(s),E=vN(o,this.transformPagePoint),{point:P}=E,{timestamp:M}=Mo;this.history=[{...P,timestamp:M}];const{onSessionStart:L}=l;L&&L(s,bN(E,this.history)),this.removeListeners=mv(a0(this.contextWindow,"pointermove",this.handlePointerMove),a0(this.contextWindow,"pointerup",this.handlePointerUp),a0(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(s){this.handlers=s}end(){this.removeListeners&&this.removeListeners(),Dh(this.updatePoint)}}function vN(e,s){return s?{point:s(e.point)}:e}function o4(e,s){return{x:e.x-s.x,y:e.y-s.y}}function bN({point:e},s){return{point:e,delta:o4(e,D8(s)),offset:o4(e,Fle(s)),velocity:Ble(s,.1)}}function Fle(e){return e[0]}function D8(e){return e[e.length-1]}function Ble(e,s){if(e.length<2)return{x:0,y:0};let l=e.length-1,d=null;const m=D8(e);for(;l>=0&&(d=e[l],!(m.timestamp-d.timestamp>nu(s)));)l--;if(!d)return{x:0,y:0};const _=ru(m.timestamp-d.timestamp);if(_===0)return{x:0,y:0};const w={x:(m.x-d.x)/_,y:(m.y-d.y)/_};return w.x===1/0&&(w.x=0),w.y===1/0&&(w.y=0),w}function Vle(e,{min:s,max:l},d){return s!==void 0&&e<s?e=d?ui(s,e,d.min):Math.max(e,s):l!==void 0&&e>l&&(e=d?ui(l,e,d.max):Math.min(e,l)),e}function a4(e,s,l){return{min:s!==void 0?e.min+s:void 0,max:l!==void 0?e.max+l-(e.max-e.min):void 0}}function Ule(e,{top:s,left:l,bottom:d,right:m}){return{x:a4(e.x,l,m),y:a4(e.y,s,d)}}function l4(e,s){let l=s.min-e.min,d=s.max-e.max;return s.max-s.min<e.max-e.min&&([l,d]=[d,l]),{min:l,max:d}}function $le(e,s){return{x:l4(e.x,s.x),y:l4(e.y,s.y)}}function Gle(e,s){let l=.5;const d=ma(e),m=ma(s);return m>d?l=O0(s.min,s.max-d,e.min):d>m&&(l=O0(e.min,e.max-m,s.min)),td(0,1,l)}function Hle(e,s){const l={};return s.min!==void 0&&(l.min=s.min-e.min),s.max!==void 0&&(l.max=s.max-e.min),l}const _C=.35;function Wle(e=_C){return e===!1?e=0:e===!0&&(e=_C),{x:c4(e,"left","right"),y:c4(e,"top","bottom")}}function c4(e,s,l){return{min:u4(e,s),max:u4(e,l)}}function u4(e,s){return typeof e=="number"?e:e[s]||0}const qle=new WeakMap;class Zle{constructor(s){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=Ri(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=s}start(s,{snapToCursor:l=!1,distanceThreshold:d}={}){const{presenceContext:m}=this.visualElement;if(m&&m.isPresent===!1)return;const _=L=>{const{dragSnapToOrigin:F}=this.getProps();F?this.pauseAnimation():this.stopAnimation(),l&&this.snapToCursor(yv(L).point)},w=(L,F)=>{const{drag:$,dragPropagation:Y,onDragStart:H}=this.getProps();if($&&!Y&&(this.openDragLock&&this.openDragLock(),this.openDragLock=sae($),!this.openDragLock))return;this.latestPointerEvent=L,this.latestPanInfo=F,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),bl(Z=>{let W=this.getAxisMotionValue(Z).get()||0;if(iu.test(W)){const{projection:q}=this.visualElement;if(q&&q.layout){const oe=q.layout.layoutBox[Z];oe&&(W=ma(oe)*(parseFloat(W)/100))}}this.originPoint[Z]=W}),H&&oi.postRender(()=>H(L,F)),xC(this.visualElement,"transform");const{animationState:X}=this.visualElement;X&&X.setActive("whileDrag",!0)},o=(L,F)=>{this.latestPointerEvent=L,this.latestPanInfo=F;const{dragPropagation:$,dragDirectionLock:Y,onDirectionLock:H,onDrag:X}=this.getProps();if(!$&&!this.openDragLock)return;const{offset:Z}=F;if(Y&&this.currentDirection===null){this.currentDirection=Kle(Z),this.currentDirection!==null&&H&&H(this.currentDirection);return}this.updateAxis("x",F.point,Z),this.updateAxis("y",F.point,Z),this.visualElement.render(),X&&X(L,F)},E=(L,F)=>{this.latestPointerEvent=L,this.latestPanInfo=F,this.stop(L,F),this.latestPointerEvent=null,this.latestPanInfo=null},P=()=>bl(L=>{var F;return this.getAnimationState(L)==="paused"&&((F=this.getAxisMotionValue(L).animation)==null?void 0:F.play())}),{dragSnapToOrigin:M}=this.getProps();this.panSession=new k8(s,{onSessionStart:_,onStart:w,onMove:o,onSessionEnd:E,resumeAnimation:P},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:M,distanceThreshold:d,contextWindow:R8(this.visualElement)})}stop(s,l){const d=s||this.latestPointerEvent,m=l||this.latestPanInfo,_=this.isDragging;if(this.cancel(),!_||!m||!d)return;const{velocity:w}=m;this.startAnimation(w);const{onDragEnd:o}=this.getProps();o&&oi.postRender(()=>o(d,m))}cancel(){this.isDragging=!1;const{projection:s,animationState:l}=this.visualElement;s&&(s.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:d}=this.getProps();!d&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),l&&l.setActive("whileDrag",!1)}updateAxis(s,l,d){const{drag:m}=this.getProps();if(!d||!Xb(s,m,this.currentDirection))return;const _=this.getAxisMotionValue(s);let w=this.originPoint[s]+d[s];this.constraints&&this.constraints[s]&&(w=Vle(w,this.constraints[s],this.elastic[s])),_.set(w)}resolveConstraints(){var _;const{dragConstraints:s,dragElastic:l}=this.getProps(),d=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):(_=this.visualElement.projection)==null?void 0:_.layout,m=this.constraints;s&&bg(s)?this.constraints||(this.constraints=this.resolveRefConstraints()):s&&d?this.constraints=Ule(d.layoutBox,s):this.constraints=!1,this.elastic=Wle(l),m!==this.constraints&&d&&this.constraints&&!this.hasMutatedConstraints&&bl(w=>{this.constraints!==!1&&this.getAxisMotionValue(w)&&(this.constraints[w]=Hle(d.layoutBox[w],this.constraints[w]))})}resolveRefConstraints(){const{dragConstraints:s,onMeasureDragConstraints:l}=this.getProps();if(!s||!bg(s))return!1;const d=s.current,{projection:m}=this.visualElement;if(!m||!m.layout)return!1;const _=Xae(d,m.root,this.visualElement.getTransformPagePoint());let w=$le(m.layout.layoutBox,_);if(l){const o=l(qae(w));this.hasMutatedConstraints=!!o,o&&(w=y8(o))}return w}startAnimation(s){const{drag:l,dragMomentum:d,dragElastic:m,dragTransition:_,dragSnapToOrigin:w,onDragTransitionEnd:o}=this.getProps(),E=this.constraints||{},P=bl(M=>{if(!Xb(M,l,this.currentDirection))return;let L=E&&E[M]||{};w&&(L={min:0,max:0});const F=m?200:1e6,$=m?40:1e7,Y={type:"inertia",velocity:d?s[M]:0,bounceStiffness:F,bounceDamping:$,timeConstant:750,restDelta:1,restSpeed:10,..._,...L};return this.startAxisValueAnimation(M,Y)});return Promise.all(P).then(o)}startAxisValueAnimation(s,l){const d=this.getAxisMotionValue(s);return xC(this.visualElement,s),d.start(rI(s,d,0,l,this.visualElement,!1))}stopAnimation(){bl(s=>this.getAxisMotionValue(s).stop())}pauseAnimation(){bl(s=>{var l;return(l=this.getAxisMotionValue(s).animation)==null?void 0:l.pause()})}getAnimationState(s){var l;return(l=this.getAxisMotionValue(s).animation)==null?void 0:l.state}getAxisMotionValue(s){const l=`_drag${s.toUpperCase()}`,d=this.visualElement.getProps(),m=d[l];return m||this.visualElement.getValue(s,(d.initial?d.initial[s]:void 0)||0)}snapToCursor(s){bl(l=>{const{drag:d}=this.getProps();if(!Xb(l,d,this.currentDirection))return;const{projection:m}=this.visualElement,_=this.getAxisMotionValue(l);if(m&&m.layout){const{min:w,max:o}=m.layout.layoutBox[l];_.set(s[l]-ui(w,o,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:s,dragConstraints:l}=this.getProps(),{projection:d}=this.visualElement;if(!bg(l)||!d||!this.constraints)return;this.stopAnimation();const m={x:0,y:0};bl(w=>{const o=this.getAxisMotionValue(w);if(o&&this.constraints!==!1){const E=o.get();m[w]=Gle({min:E,max:E},this.constraints[w])}});const{transformTemplate:_}=this.visualElement.getProps();this.visualElement.current.style.transform=_?_({},""):"none",d.root&&d.root.updateScroll(),d.updateLayout(),this.resolveConstraints(),bl(w=>{if(!Xb(w,s,null))return;const o=this.getAxisMotionValue(w),{min:E,max:P}=this.constraints[w];o.set(ui(E,P,m[w]))})}addListeners(){if(!this.visualElement.current)return;qle.set(this.visualElement,this);const s=this.visualElement.current,l=a0(s,"pointerdown",E=>{const{drag:P,dragListener:M=!0}=this.getProps();P&&M&&this.start(E)}),d=()=>{const{dragConstraints:E}=this.getProps();bg(E)&&E.current&&(this.constraints=this.resolveRefConstraints())},{projection:m}=this.visualElement,_=m.addEventListener("measure",d);m&&!m.layout&&(m.root&&m.root.updateScroll(),m.updateLayout()),oi.read(d);const w=$0(window,"resize",()=>this.scalePositionWithinConstraints()),o=m.addEventListener("didUpdate",({delta:E,hasLayoutChanged:P})=>{this.isDragging&&P&&(bl(M=>{const L=this.getAxisMotionValue(M);L&&(this.originPoint[M]+=E[M].translate,L.set(L.get()+E[M].translate))}),this.visualElement.render())});return()=>{w(),l(),_(),o&&o()}}getProps(){const s=this.visualElement.getProps(),{drag:l=!1,dragDirectionLock:d=!1,dragPropagation:m=!1,dragConstraints:_=!1,dragElastic:w=_C,dragMomentum:o=!0}=s;return{...s,drag:l,dragDirectionLock:d,dragPropagation:m,dragConstraints:_,dragElastic:w,dragMomentum:o}}}function Xb(e,s,l){return(s===!0||s===e)&&(l===null||l===e)}function Kle(e,s=10){let l=null;return Math.abs(e.y)>s?l="y":Math.abs(e.x)>s&&(l="x"),l}class Xle extends Hh{constructor(s){super(s),this.removeGroupControls=Cl,this.removeListeners=Cl,this.controls=new Zle(s)}mount(){const{dragControls:s}=this.node.getProps();s&&(this.removeGroupControls=s.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Cl}unmount(){this.removeGroupControls(),this.removeListeners()}}const d4=e=>(s,l)=>{e&&oi.postRender(()=>e(s,l))};class Yle extends Hh{constructor(){super(...arguments),this.removePointerDownListener=Cl}onPointerDown(s){this.session=new k8(s,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:R8(this.node)})}createPanHandlers(){const{onPanSessionStart:s,onPanStart:l,onPan:d,onPanEnd:m}=this.node.getProps();return{onSessionStart:d4(s),onStart:d4(l),onMove:d,onEnd:(_,w)=>{delete this.session,m&&oi.postRender(()=>m(_,w))}}}mount(){this.removePointerDownListener=a0(this.node.current,"pointerdown",s=>this.onPointerDown(s))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const vw={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function h4(e,s){return s.max===s.min?0:e/(s.max-s.min)*100}const V_={correct:(e,s)=>{if(!s.target)return e;if(typeof e=="string")if(Nn.test(e))e=parseFloat(e);else return e;const l=h4(e,s.target.x),d=h4(e,s.target.y);return`${l}% ${d}%`}},Jle={correct:(e,{treeScale:s,projectionDelta:l})=>{const d=e,m=Lh.parse(e);if(m.length>5)return d;const _=Lh.createTransformer(e),w=typeof m[0]!="number"?1:0,o=l.x.scale*s.x,E=l.y.scale*s.y;m[0+w]/=o,m[1+w]/=E;const P=ui(o,E,.5);return typeof m[2+w]=="number"&&(m[2+w]/=P),typeof m[3+w]=="number"&&(m[3+w]/=P),_(m)}};let wN=!1;class Qle extends z.Component{componentDidMount(){const{visualElement:s,layoutGroup:l,switchLayoutGroup:d,layoutId:m}=this.props,{projection:_}=s;bae(ece),_&&(l.group&&l.group.add(_),d&&d.register&&m&&d.register(_),wN&&_.root.didUpdate(),_.addEventListener("animationComplete",()=>{this.safeToRemove()}),_.setOptions({..._.options,onExitComplete:()=>this.safeToRemove()})),vw.hasEverUpdated=!0}getSnapshotBeforeUpdate(s){const{layoutDependency:l,visualElement:d,drag:m,isPresent:_}=this.props,{projection:w}=d;return w&&(w.isPresent=_,wN=!0,m||s.layoutDependency!==l||l===void 0||s.isPresent!==_?w.willUpdate():this.safeToRemove(),s.isPresent!==_&&(_?w.promote():w.relegate()||oi.postRender(()=>{const o=w.getStack();(!o||!o.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:s}=this.props.visualElement;s&&(s.root.didUpdate(),WP.postRender(()=>{!s.currentAnimation&&s.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:s,layoutGroup:l,switchLayoutGroup:d}=this.props,{projection:m}=s;wN=!0,m&&(m.scheduleCheckAfterUnmount(),l&&l.group&&l.group.remove(m),d&&d.deregister&&d.deregister(m))}safeToRemove(){const{safeToRemove:s}=this.props;s&&s()}render(){return null}}function L8(e){const[s,l]=r8(),d=z.useContext(TP);return n.jsx(Qle,{...e,layoutGroup:d,switchLayoutGroup:z.useContext(g8),isPresent:s,safeToRemove:l})}const ece={borderRadius:{...V_,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:V_,borderTopRightRadius:V_,borderBottomLeftRadius:V_,borderBottomRightRadius:V_,boxShadow:Jle};function tce(e,s,l){const d=qo(e)?e:cx(e);return d.start(rI("",d,s,l)),d.animation}const sce=(e,s)=>e.depth-s.depth;class nce{constructor(){this.children=[],this.isDirty=!1}add(s){CP(this.children,s),this.isDirty=!0}remove(s){AP(this.children,s),this.isDirty=!0}forEach(s){this.isDirty&&this.children.sort(sce),this.isDirty=!1,this.children.forEach(s)}}function rce(e,s){const l=ka.now(),d=({timestamp:m})=>{const _=m-l;_>=s&&(Dh(d),e(_-s))};return oi.setup(d,!0),()=>Dh(d)}const z8=["TopLeft","TopRight","BottomLeft","BottomRight"],ice=z8.length,p4=e=>typeof e=="string"?parseFloat(e):e,f4=e=>typeof e=="number"||Nn.test(e);function oce(e,s,l,d,m,_){m?(e.opacity=ui(0,l.opacity??1,ace(d)),e.opacityExit=ui(s.opacity??1,0,lce(d))):_&&(e.opacity=ui(s.opacity??1,l.opacity??1,d));for(let w=0;w<ice;w++){const o=`border${z8[w]}Radius`;let E=m4(s,o),P=m4(l,o);if(E===void 0&&P===void 0)continue;E||(E=0),P||(P=0),E===0||P===0||f4(E)===f4(P)?(e[o]=Math.max(ui(p4(E),p4(P),d),0),(iu.test(P)||iu.test(E))&&(e[o]+="%")):e[o]=P}(s.rotate||l.rotate)&&(e.rotate=ui(s.rotate||0,l.rotate||0,d))}function m4(e,s){return e[s]!==void 0?e[s]:e.borderRadius}const ace=O8(0,.5,jU),lce=O8(.5,.95,Cl);function O8(e,s,l){return d=>d<e?0:d>s?1:l(O0(e,s,d))}function g4(e,s){e.min=s.min,e.max=s.max}function vl(e,s){g4(e.x,s.x),g4(e.y,s.y)}function x4(e,s){e.translate=s.translate,e.scale=s.scale,e.originPoint=s.originPoint,e.origin=s.origin}function y4(e,s,l,d,m){return e-=s,e=m2(e,1/l,d),m!==void 0&&(e=m2(e,1/m,d)),e}function cce(e,s=0,l=1,d=.5,m,_=e,w=e){if(iu.test(s)&&(s=parseFloat(s),s=ui(w.min,w.max,s/100)-w.min),typeof s!="number")return;let o=ui(_.min,_.max,d);e===_&&(o-=s),e.min=y4(e.min,s,l,o,m),e.max=y4(e.max,s,l,o,m)}function _4(e,s,[l,d,m],_,w){cce(e,s[l],s[d],s[m],s.scale,_,w)}const uce=["x","scaleX","originX"],dce=["y","scaleY","originY"];function v4(e,s,l,d){_4(e.x,s,uce,l?l.x:void 0,d?d.x:void 0),_4(e.y,s,dce,l?l.y:void 0,d?d.y:void 0)}function b4(e){return e.translate===0&&e.scale===1}function F8(e){return b4(e.x)&&b4(e.y)}function w4(e,s){return e.min===s.min&&e.max===s.max}function hce(e,s){return w4(e.x,s.x)&&w4(e.y,s.y)}function S4(e,s){return Math.round(e.min)===Math.round(s.min)&&Math.round(e.max)===Math.round(s.max)}function B8(e,s){return S4(e.x,s.x)&&S4(e.y,s.y)}function j4(e){return ma(e.x)/ma(e.y)}function T4(e,s){return e.translate===s.translate&&e.scale===s.scale&&e.originPoint===s.originPoint}class pce{constructor(){this.members=[]}add(s){CP(this.members,s),s.scheduleRender()}remove(s){if(AP(this.members,s),s===this.prevLead&&(this.prevLead=void 0),s===this.lead){const l=this.members[this.members.length-1];l&&this.promote(l)}}relegate(s){const l=this.members.findIndex(m=>s===m);if(l===0)return!1;let d;for(let m=l;m>=0;m--){const _=this.members[m];if(_.isPresent!==!1){d=_;break}}return d?(this.promote(d),!0):!1}promote(s,l){const d=this.lead;if(s!==d&&(this.prevLead=d,this.lead=s,s.show(),d)){d.instance&&d.scheduleRender(),s.scheduleRender(),s.resumeFrom=d,l&&(s.resumeFrom.preserveOpacity=!0),d.snapshot&&(s.snapshot=d.snapshot,s.snapshot.latestValues=d.animationValues||d.latestValues),s.root&&s.root.isUpdating&&(s.isLayoutDirty=!0);const{crossfade:m}=s.options;m===!1&&d.hide()}}exitAnimationComplete(){this.members.forEach(s=>{const{options:l,resumingFrom:d}=s;l.onExitComplete&&l.onExitComplete(),d&&d.options.onExitComplete&&d.options.onExitComplete()})}scheduleRender(){this.members.forEach(s=>{s.instance&&s.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function fce(e,s,l){let d="";const m=e.x.translate/s.x,_=e.y.translate/s.y,w=(l==null?void 0:l.z)||0;if((m||_||w)&&(d=`translate3d(${m}px, ${_}px, ${w}px) `),(s.x!==1||s.y!==1)&&(d+=`scale(${1/s.x}, ${1/s.y}) `),l){const{transformPerspective:P,rotate:M,rotateX:L,rotateY:F,skewX:$,skewY:Y}=l;P&&(d=`perspective(${P}px) ${d}`),M&&(d+=`rotate(${M}deg) `),L&&(d+=`rotateX(${L}deg) `),F&&(d+=`rotateY(${F}deg) `),$&&(d+=`skewX(${$}deg) `),Y&&(d+=`skewY(${Y}deg) `)}const o=e.x.scale*s.x,E=e.y.scale*s.y;return(o!==1||E!==1)&&(d+=`scale(${o}, ${E})`),d||"none"}const SN=["","X","Y","Z"],mce=1e3;let gce=0;function jN(e,s,l,d){const{latestValues:m}=s;m[e]&&(l[e]=m[e],s.setStaticValue(e,0),d&&(d[e]=0))}function V8(e){if(e.hasCheckedOptimisedAppear=!0,e.root===e)return;const{visualElement:s}=e.options;if(!s)return;const l=N8(s);if(window.MotionHasOptimisedAnimation(l,"transform")){const{layout:m,layoutId:_}=e.options;window.MotionCancelOptimisedAnimation(l,"transform",oi,!(m||_))}const{parent:d}=e;d&&!d.hasCheckedOptimisedAppear&&V8(d)}function U8({attachResizeListener:e,defaultParent:s,measureScroll:l,checkIsScrollRoot:d,resetTransform:m}){return class{constructor(w={},o=s==null?void 0:s()){this.id=gce++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(_ce),this.nodes.forEach(Sce),this.nodes.forEach(jce),this.nodes.forEach(vce)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=w,this.root=o?o.root||o:this,this.path=o?[...o.path,o]:[],this.parent=o,this.depth=o?o.depth+1:0;for(let E=0;E<this.path.length;E++)this.path[E].shouldResetTransform=!0;this.root===this&&(this.nodes=new nce)}addEventListener(w,o){return this.eventHandlers.has(w)||this.eventHandlers.set(w,new IP),this.eventHandlers.get(w).add(o)}notifyListeners(w,...o){const E=this.eventHandlers.get(w);E&&E.notify(...o)}hasListeners(w){return this.eventHandlers.has(w)}mount(w){if(this.instance)return;this.isSVG=n8(w)&&!lae(w),this.instance=w;const{layoutId:o,layout:E,visualElement:P}=this.options;if(P&&!P.current&&P.mount(w),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(E||o)&&(this.isLayoutDirty=!0),e){let M,L=0;const F=()=>this.root.updateBlockedByResize=!1;oi.read(()=>{L=window.innerWidth}),e(w,()=>{const $=window.innerWidth;$!==L&&(L=$,this.root.updateBlockedByResize=!0,M&&M(),M=rce(F,250),vw.hasAnimatedSinceResize&&(vw.hasAnimatedSinceResize=!1,this.nodes.forEach(C4)))})}o&&this.root.registerSharedNode(o,this),this.options.animate!==!1&&P&&(o||E)&&this.addEventListener("didUpdate",({delta:M,hasLayoutChanged:L,hasRelativeLayoutChanged:F,layout:$})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const Y=this.options.transition||P.getDefaultTransition()||Ace,{onLayoutAnimationStart:H,onLayoutAnimationComplete:X}=P.getProps(),Z=!this.targetLayout||!B8(this.targetLayout,$),W=!L&&F;if(this.options.layoutRoot||this.resumeFrom||W||L&&(Z||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const q={...GP(Y,"layout"),onPlay:H,onComplete:X};(P.shouldReduceMotion||this.options.layoutRoot)&&(q.delay=0,q.type=!1),this.startAnimation(q),this.setAnimationOrigin(M,W)}else L||C4(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=$})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const w=this.getStack();w&&w.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),Dh(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(Tce),this.animationId++)}getTransformTemplate(){const{visualElement:w}=this.options;return w&&w.getProps().transformTemplate}willUpdate(w=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&V8(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let M=0;M<this.path.length;M++){const L=this.path[M];L.shouldResetTransform=!0,L.updateScroll("snapshot"),L.options.layoutRoot&&L.willUpdate(!1)}const{layoutId:o,layout:E}=this.options;if(o===void 0&&!E)return;const P=this.getTransformTemplate();this.prevTransformTemplateValue=P?P(this.latestValues,""):void 0,this.updateSnapshot(),w&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(N4);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(E4);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(wce),this.nodes.forEach(xce),this.nodes.forEach(yce)):this.nodes.forEach(E4),this.clearAllSnapshots();const o=ka.now();Mo.delta=td(0,1e3/60,o-Mo.timestamp),Mo.timestamp=o,Mo.isProcessing=!0,hN.update.process(Mo),hN.preRender.process(Mo),hN.render.process(Mo),Mo.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,WP.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(bce),this.sharedNodes.forEach(Nce)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,oi.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){oi.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ma(this.snapshot.measuredBox.x)&&!ma(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let E=0;E<this.path.length;E++)this.path[E].updateScroll();const w=this.layout;this.layout=this.measure(!1),this.layoutCorrected=Ri(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:o}=this.options;o&&o.notify("LayoutMeasure",this.layout.layoutBox,w?w.layoutBox:void 0)}updateScroll(w="measure"){let o=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===w&&(o=!1),o&&this.instance){const E=d(this.instance);this.scroll={animationId:this.root.animationId,phase:w,isRoot:E,offset:l(this.instance),wasRoot:this.scroll?this.scroll.isRoot:E}}}resetTransform(){if(!m)return;const w=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,o=this.projectionDelta&&!F8(this.projectionDelta),E=this.getTransformTemplate(),P=E?E(this.latestValues,""):void 0,M=P!==this.prevTransformTemplateValue;w&&this.instance&&(o||qp(this.latestValues)||M)&&(m(this.instance,P),this.shouldResetTransform=!1,this.scheduleRender())}measure(w=!0){const o=this.measurePageBox();let E=this.removeElementScroll(o);return w&&(E=this.removeTransform(E)),Pce(E),{animationId:this.root.animationId,measuredBox:o,layoutBox:E,latestValues:{},source:this.id}}measurePageBox(){var P;const{visualElement:w}=this.options;if(!w)return Ri();const o=w.measureViewportBox();if(!(((P=this.scroll)==null?void 0:P.wasRoot)||this.path.some(Ice))){const{scroll:M}=this.root;M&&(wg(o.x,M.offset.x),wg(o.y,M.offset.y))}return o}removeElementScroll(w){var E;const o=Ri();if(vl(o,w),(E=this.scroll)!=null&&E.wasRoot)return o;for(let P=0;P<this.path.length;P++){const M=this.path[P],{scroll:L,options:F}=M;M!==this.root&&L&&F.layoutScroll&&(L.wasRoot&&vl(o,w),wg(o.x,L.offset.x),wg(o.y,L.offset.y))}return o}applyTransform(w,o=!1){const E=Ri();vl(E,w);for(let P=0;P<this.path.length;P++){const M=this.path[P];!o&&M.options.layoutScroll&&M.scroll&&M!==M.root&&Sg(E,{x:-M.scroll.offset.x,y:-M.scroll.offset.y}),qp(M.latestValues)&&Sg(E,M.latestValues)}return qp(this.latestValues)&&Sg(E,this.latestValues),E}removeTransform(w){const o=Ri();vl(o,w);for(let E=0;E<this.path.length;E++){const P=this.path[E];if(!P.instance||!qp(P.latestValues))continue;pC(P.latestValues)&&P.updateSnapshot();const M=Ri(),L=P.measurePageBox();vl(M,L),v4(o,P.latestValues,P.snapshot?P.snapshot.layoutBox:void 0,M)}return qp(this.latestValues)&&v4(o,this.latestValues),o}setTargetDelta(w){this.targetDelta=w,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(w){this.options={...this.options,...w,crossfade:w.crossfade!==void 0?w.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==Mo.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(w=!1){var F;const o=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=o.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=o.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=o.isSharedProjectionDirty);const E=!!this.resumingFrom||this!==o;if(!(w||E&&this.isSharedProjectionDirty||this.isProjectionDirty||(F=this.parent)!=null&&F.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:M,layoutId:L}=this.options;if(!(!this.layout||!(M||L))){if(this.resolvedRelativeTargetAt=Mo.timestamp,!this.targetDelta&&!this.relativeTarget){const $=this.getClosestProjectingParent();$&&$.layout&&this.animationProgress!==1?(this.relativeParent=$,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ri(),this.relativeTargetOrigin=Ri(),c0(this.relativeTargetOrigin,this.layout.layoutBox,$.layout.layoutBox),vl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=Ri(),this.targetWithTransforms=Ri()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),zle(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):vl(this.target,this.layout.layoutBox),v8(this.target,this.targetDelta)):vl(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const $=this.getClosestProjectingParent();$&&!!$.resumingFrom==!!this.resumingFrom&&!$.options.layoutScroll&&$.target&&this.animationProgress!==1?(this.relativeParent=$,this.forceRelativeParentToResolveTarget(),this.relativeTarget=Ri(),this.relativeTargetOrigin=Ri(),c0(this.relativeTargetOrigin,this.target,$.target),vl(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||pC(this.parent.latestValues)||_8(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){var Y;const w=this.getLead(),o=!!this.resumingFrom||this!==w;let E=!0;if((this.isProjectionDirty||(Y=this.parent)!=null&&Y.isProjectionDirty)&&(E=!1),o&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(E=!1),this.resolvedRelativeTargetAt===Mo.timestamp&&(E=!1),E)return;const{layout:P,layoutId:M}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(P||M))return;vl(this.layoutCorrected,this.layout.layoutBox);const L=this.treeScale.x,F=this.treeScale.y;Kae(this.layoutCorrected,this.treeScale,this.path,o),w.layout&&!w.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(w.target=w.layout.layoutBox,w.targetWithTransforms=Ri());const{target:$}=w;if(!$){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(x4(this.prevProjectionDelta.x,this.projectionDelta.x),x4(this.prevProjectionDelta.y,this.projectionDelta.y)),l0(this.projectionDelta,this.layoutCorrected,$,this.latestValues),(this.treeScale.x!==L||this.treeScale.y!==F||!T4(this.projectionDelta.x,this.prevProjectionDelta.x)||!T4(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",$))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(w=!0){var o;if((o=this.options.visualElement)==null||o.scheduleRender(),w){const E=this.getStack();E&&E.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=jg(),this.projectionDelta=jg(),this.projectionDeltaWithTransform=jg()}setAnimationOrigin(w,o=!1){const E=this.snapshot,P=E?E.latestValues:{},M={...this.latestValues},L=jg();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!o;const F=Ri(),$=E?E.source:void 0,Y=this.layout?this.layout.source:void 0,H=$!==Y,X=this.getStack(),Z=!X||X.members.length<=1,W=!!(H&&!Z&&this.options.crossfade===!0&&!this.path.some(Cce));this.animationProgress=0;let q;this.mixTargetDelta=oe=>{const ae=oe/1e3;A4(L.x,w.x,ae),A4(L.y,w.y,ae),this.setTargetDelta(L),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(c0(F,this.layout.layoutBox,this.relativeParent.layout.layoutBox),Ece(this.relativeTarget,this.relativeTargetOrigin,F,ae),q&&hce(this.relativeTarget,q)&&(this.isProjectionDirty=!1),q||(q=Ri()),vl(q,this.relativeTarget)),H&&(this.animationValues=M,oce(M,P,this.latestValues,ae,W,Z)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=ae},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(w){var o,E,P;this.notifyListeners("animationStart"),(o=this.currentAnimation)==null||o.stop(),(P=(E=this.resumingFrom)==null?void 0:E.currentAnimation)==null||P.stop(),this.pendingAnimation&&(Dh(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=oi.update(()=>{vw.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=cx(0)),this.currentAnimation=tce(this.motionValue,[0,1e3],{...w,velocity:0,isSync:!0,onUpdate:M=>{this.mixTargetDelta(M),w.onUpdate&&w.onUpdate(M)},onStop:()=>{},onComplete:()=>{w.onComplete&&w.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const w=this.getStack();w&&w.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(mce),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const w=this.getLead();let{targetWithTransforms:o,target:E,layout:P,latestValues:M}=w;if(!(!o||!E||!P)){if(this!==w&&this.layout&&P&&$8(this.options.animationType,this.layout.layoutBox,P.layoutBox)){E=this.target||Ri();const L=ma(this.layout.layoutBox.x);E.x.min=w.target.x.min,E.x.max=E.x.min+L;const F=ma(this.layout.layoutBox.y);E.y.min=w.target.y.min,E.y.max=E.y.min+F}vl(o,E),Sg(o,M),l0(this.projectionDeltaWithTransform,this.layoutCorrected,o,M)}}registerSharedNode(w,o){this.sharedNodes.has(w)||this.sharedNodes.set(w,new pce),this.sharedNodes.get(w).add(o);const P=o.options.initialPromotionConfig;o.promote({transition:P?P.transition:void 0,preserveFollowOpacity:P&&P.shouldPreserveFollowOpacity?P.shouldPreserveFollowOpacity(o):void 0})}isLead(){const w=this.getStack();return w?w.lead===this:!0}getLead(){var o;const{layoutId:w}=this.options;return w?((o=this.getStack())==null?void 0:o.lead)||this:this}getPrevLead(){var o;const{layoutId:w}=this.options;return w?(o=this.getStack())==null?void 0:o.prevLead:void 0}getStack(){const{layoutId:w}=this.options;if(w)return this.root.sharedNodes.get(w)}promote({needsReset:w,transition:o,preserveFollowOpacity:E}={}){const P=this.getStack();P&&P.promote(this,E),w&&(this.projectionDelta=void 0,this.needsReset=!0),o&&this.setOptions({transition:o})}relegate(){const w=this.getStack();return w?w.relegate(this):!1}resetSkewAndRotation(){const{visualElement:w}=this.options;if(!w)return;let o=!1;const{latestValues:E}=w;if((E.z||E.rotate||E.rotateX||E.rotateY||E.rotateZ||E.skewX||E.skewY)&&(o=!0),!o)return;const P={};E.z&&jN("z",w,P,this.animationValues);for(let M=0;M<SN.length;M++)jN(`rotate${SN[M]}`,w,P,this.animationValues),jN(`skew${SN[M]}`,w,P,this.animationValues);w.render();for(const M in P)w.setStaticValue(M,P[M]),this.animationValues&&(this.animationValues[M]=P[M]);w.scheduleRender()}applyProjectionStyles(w,o){if(!this.instance||this.isSVG)return;if(!this.isVisible){w.visibility="hidden";return}const E=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,w.visibility="",w.opacity="",w.pointerEvents=_w(o==null?void 0:o.pointerEvents)||"",w.transform=E?E(this.latestValues,""):"none";return}const P=this.getLead();if(!this.projectionDelta||!this.layout||!P.target){this.options.layoutId&&(w.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,w.pointerEvents=_w(o==null?void 0:o.pointerEvents)||""),this.hasProjected&&!qp(this.latestValues)&&(w.transform=E?E({},""):"none",this.hasProjected=!1);return}w.visibility="";const M=P.animationValues||P.latestValues;this.applyTransformsToTarget();let L=fce(this.projectionDeltaWithTransform,this.treeScale,M);E&&(L=E(M,L)),w.transform=L;const{x:F,y:$}=this.projectionDelta;w.transformOrigin=`${F.origin*100}% ${$.origin*100}% 0`,P.animationValues?w.opacity=P===this?M.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:M.opacityExit:w.opacity=P===this?M.opacity!==void 0?M.opacity:"":M.opacityExit!==void 0?M.opacityExit:0;for(const Y in U0){if(M[Y]===void 0)continue;const{correct:H,applyTo:X,isCSSVariable:Z}=U0[Y],W=L==="none"?M[Y]:H(M[Y],P);if(X){const q=X.length;for(let oe=0;oe<q;oe++)w[X[oe]]=W}else Z?this.options.visualElement.renderState.vars[Y]=W:w[Y]=W}this.options.layoutId&&(w.pointerEvents=P===this?_w(o==null?void 0:o.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(w=>{var o;return(o=w.currentAnimation)==null?void 0:o.stop()}),this.root.nodes.forEach(N4),this.root.sharedNodes.clear()}}}function xce(e){e.updateLayout()}function yce(e){var l;const s=((l=e.resumeFrom)==null?void 0:l.snapshot)||e.snapshot;if(e.isLead()&&e.layout&&s&&e.hasListeners("didUpdate")){const{layoutBox:d,measuredBox:m}=e.layout,{animationType:_}=e.options,w=s.source!==e.layout.source;_==="size"?bl(L=>{const F=w?s.measuredBox[L]:s.layoutBox[L],$=ma(F);F.min=d[L].min,F.max=F.min+$}):$8(_,s.layoutBox,d)&&bl(L=>{const F=w?s.measuredBox[L]:s.layoutBox[L],$=ma(d[L]);F.max=F.min+$,e.relativeTarget&&!e.currentAnimation&&(e.isProjectionDirty=!0,e.relativeTarget[L].max=e.relativeTarget[L].min+$)});const o=jg();l0(o,d,s.layoutBox);const E=jg();w?l0(E,e.applyTransform(m,!0),s.measuredBox):l0(E,d,s.layoutBox);const P=!F8(o);let M=!1;if(!e.resumeFrom){const L=e.getClosestProjectingParent();if(L&&!L.resumeFrom){const{snapshot:F,layout:$}=L;if(F&&$){const Y=Ri();c0(Y,s.layoutBox,F.layoutBox);const H=Ri();c0(H,d,$.layoutBox),B8(Y,H)||(M=!0),L.options.layoutRoot&&(e.relativeTarget=H,e.relativeTargetOrigin=Y,e.relativeParent=L)}}}e.notifyListeners("didUpdate",{layout:d,snapshot:s,delta:E,layoutDelta:o,hasLayoutChanged:P,hasRelativeLayoutChanged:M})}else if(e.isLead()){const{onExitComplete:d}=e.options;d&&d()}e.options.transition=void 0}function _ce(e){e.parent&&(e.isProjecting()||(e.isProjectionDirty=e.parent.isProjectionDirty),e.isSharedProjectionDirty||(e.isSharedProjectionDirty=!!(e.isProjectionDirty||e.parent.isProjectionDirty||e.parent.isSharedProjectionDirty)),e.isTransformDirty||(e.isTransformDirty=e.parent.isTransformDirty))}function vce(e){e.isProjectionDirty=e.isSharedProjectionDirty=e.isTransformDirty=!1}function bce(e){e.clearSnapshot()}function N4(e){e.clearMeasurements()}function E4(e){e.isLayoutDirty=!1}function wce(e){const{visualElement:s}=e.options;s&&s.getProps().onBeforeLayoutMeasure&&s.notify("BeforeLayoutMeasure"),e.resetTransform()}function C4(e){e.finishAnimation(),e.targetDelta=e.relativeTarget=e.target=void 0,e.isProjectionDirty=!0}function Sce(e){e.resolveTargetDelta()}function jce(e){e.calcProjection()}function Tce(e){e.resetSkewAndRotation()}function Nce(e){e.removeLeadSnapshot()}function A4(e,s,l){e.translate=ui(s.translate,0,l),e.scale=ui(s.scale,1,l),e.origin=s.origin,e.originPoint=s.originPoint}function P4(e,s,l,d){e.min=ui(s.min,l.min,d),e.max=ui(s.max,l.max,d)}function Ece(e,s,l,d){P4(e.x,s.x,l.x,d),P4(e.y,s.y,l.y,d)}function Cce(e){return e.animationValues&&e.animationValues.opacityExit!==void 0}const Ace={duration:.45,ease:[.4,0,.1,1]},I4=e=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(e),M4=I4("applewebkit/")&&!I4("chrome/")?Math.round:Cl;function R4(e){e.min=M4(e.min),e.max=M4(e.max)}function Pce(e){R4(e.x),R4(e.y)}function $8(e,s,l){return e==="position"||e==="preserve-aspect"&&!Lle(j4(s),j4(l),.2)}function Ice(e){var s;return e!==e.root&&((s=e.scroll)==null?void 0:s.wasRoot)}const Mce=U8({attachResizeListener:(e,s)=>$0(e,"resize",s),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),TN={current:void 0},G8=U8({measureScroll:e=>({x:e.scrollLeft,y:e.scrollTop}),defaultParent:()=>{if(!TN.current){const e=new Mce({});e.mount(window),e.setOptions({layoutScroll:!0}),TN.current=e}return TN.current},resetTransform:(e,s)=>{e.style.transform=s!==void 0?s:"none"},checkIsScrollRoot:e=>window.getComputedStyle(e).position==="fixed"}),Rce={pan:{Feature:Yle},drag:{Feature:Xle,ProjectionNode:G8,MeasureLayout:L8}};function k4(e,s,l){const{props:d}=e;e.animationState&&d.whileHover&&e.animationState.setActive("whileHover",l==="Start");const m="onHover"+l,_=d[m];_&&oi.postRender(()=>_(s,yv(s)))}class kce extends Hh{mount(){const{current:s}=this.node;s&&(this.unmount=nae(s,(l,d)=>(k4(this.node,d,"Start"),m=>k4(this.node,m,"End"))))}unmount(){}}class Dce extends Hh{constructor(){super(...arguments),this.isActive=!1}onFocus(){let s=!1;try{s=this.node.current.matches(":focus-visible")}catch{s=!0}!s||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=mv($0(this.node.current,"focus",()=>this.onFocus()),$0(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function D4(e,s,l){const{props:d}=e;if(e.current instanceof HTMLButtonElement&&e.current.disabled)return;e.animationState&&d.whileTap&&e.animationState.setActive("whileTap",l==="Start");const m="onTap"+(l==="End"?"":l),_=d[m];_&&oi.postRender(()=>_(s,yv(s)))}class Lce extends Hh{mount(){const{current:s}=this.node;s&&(this.unmount=aae(s,(l,d)=>(D4(this.node,d,"Start"),(m,{success:_})=>D4(this.node,m,_?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const vC=new WeakMap,NN=new WeakMap,zce=e=>{const s=vC.get(e.target);s&&s(e)},Oce=e=>{e.forEach(zce)};function Fce({root:e,...s}){const l=e||document;NN.has(l)||NN.set(l,{});const d=NN.get(l),m=JSON.stringify(s);return d[m]||(d[m]=new IntersectionObserver(Oce,{root:e,...s})),d[m]}function Bce(e,s,l){const d=Fce(s);return vC.set(e,l),d.observe(e),()=>{vC.delete(e),d.unobserve(e)}}const Vce={some:0,all:1};class Uce extends Hh{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:s={}}=this.node.getProps(),{root:l,margin:d,amount:m="some",once:_}=s,w={root:l?l.current:void 0,rootMargin:d,threshold:typeof m=="number"?m:Vce[m]},o=E=>{const{isIntersecting:P}=E;if(this.isInView===P||(this.isInView=P,_&&!P&&this.hasEnteredView))return;P&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",P);const{onViewportEnter:M,onViewportLeave:L}=this.node.getProps(),F=P?M:L;F&&F(E)};return Bce(this.node.current,w,o)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:s,prevProps:l}=this.node;["amount","margin","root"].some($ce(s,l))&&this.startObserver()}unmount(){}}function $ce({viewport:e={}},{viewport:s={}}={}){return l=>e[l]!==s[l]}const Gce={inView:{Feature:Uce},tap:{Feature:Lce},focus:{Feature:Dce},hover:{Feature:kce}},Hce={layout:{ProjectionNode:G8,MeasureLayout:L8}},Wce={...Ple,...Gce,...Rce,...Hce},ci=Wae(Wce,ile),qce=({isOpen:e,onClose:s})=>{const[l,d]=z.useState("");z.useState(!1);const[m,_]=z.useState([]),[w,o]=z.useState([]),[E,P]=z.useState([]),M=z.useRef(null),L=Xr();jP({listingType:"SALE"}),z.useEffect(()=>{const q=JSON.parse(localStorage.getItem("recentSearches")||"[]");o(q.slice(0,5))},[]),z.useEffect(()=>{P(["Nairobi apartments","Karen houses","Westlands commercial","Mombasa beachfront","Kiambu land"])},[]),z.useEffect(()=>{e&&M.current&&M.current.focus()},[e]);const F=q=>{d(q),q.trim().length>2?$(q):_([])},$=q=>{const oe=q.toLowerCase(),ae=[];(oe.includes("house")||oe.includes("home"))&&ae.push({id:"house",type:"property",title:"Houses",subtitle:"Search for houses",icon:n.jsx(bo,{className:"h-4 w-4"}),action:()=>L(`/buy?propertyType=HOUSE&q=${q}`)}),(oe.includes("apartment")||oe.includes("flat"))&&ae.push({id:"apartment",type:"property",title:"Apartments",subtitle:"Search for apartments",icon:n.jsx(Ya,{className:"h-4 w-4"}),action:()=>L(`/buy?propertyType=APARTMENT&q=${q}`)}),(oe.includes("nairobi")||oe.includes("westlands")||oe.includes("karen"))&&ae.push({id:"nairobi",type:"location",title:"Nairobi",subtitle:"Properties in Nairobi",icon:n.jsx(Ai,{className:"h-4 w-4"}),action:()=>L(`/buy?city=Nairobi&q=${q}`)}),(oe.includes("mombasa")||oe.includes("diani")||oe.includes("nyali"))&&ae.push({id:"mombasa",type:"location",title:"Mombasa",subtitle:"Properties in Mombasa",icon:n.jsx(Ai,{className:"h-4 w-4"}),action:()=>L(`/buy?city=Mombasa&q=${q}`)}),ae.length===0&&ae.push({id:"generic",type:"property",title:`Search for "${q}"`,subtitle:"Search all properties",icon:n.jsx(Li,{className:"h-4 w-4"}),action:()=>L(`/buy?q=${q}`)}),_(ae)},Y=q=>{const oe=q||l;if(oe.trim()){const ae=[oe,...w.filter(Ne=>Ne!==oe)].slice(0,5);o(ae),localStorage.setItem("recentSearches",JSON.stringify(ae)),L(`/buy?q=${encodeURIComponent(oe)}`),s()}},H=q=>{q.key==="Enter"?Y():q.key==="Escape"&&s()},X=q=>{q.action(),s()},Z=q=>{Y(q)},W=q=>{Y(q)};return e?n.jsx(KP,{children:n.jsx(ci.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},className:"fixed inset-0 z-50 bg-black/50 backdrop-blur-sm",onClick:s,children:n.jsx(ci.div,{initial:{scale:.95,opacity:0},animate:{scale:1,opacity:1},exit:{scale:.95,opacity:0},transition:{type:"spring",duration:.3},className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 w-full max-w-2xl mx-4",onClick:q=>q.stopPropagation(),children:n.jsx(ot,{className:"shadow-2xl border-0",children:n.jsxs(at,{className:"p-0",children:[n.jsxs("div",{className:"relative p-4 border-b",children:[n.jsx(Li,{className:"absolute left-6 top-1/2 transform -translate-y-1/2 h-5 w-5 text-muted-foreground"}),n.jsx(Es,{ref:M,placeholder:"Search properties, locations, agents...",value:l,onChange:q=>F(q.target.value),onKeyDown:H,className:"pl-12 pr-12 h-12 text-lg border-0 focus-visible:ring-0 focus-visible:ring-offset-0"}),n.jsx(dt,{variant:"ghost",size:"icon",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-8 w-8",onClick:s,children:n.jsx(ol,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"max-h-96 overflow-y-auto",children:[m.length>0&&n.jsxs("div",{className:"p-4 border-b",children:[n.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Suggestions"}),n.jsx("div",{className:"space-y-2",children:m.map(q=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>X(q),children:[n.jsx("div",{className:"text-muted-foreground",children:q.icon}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"font-medium",children:q.title}),n.jsx("p",{className:"text-sm text-muted-foreground",children:q.subtitle})]})]},q.id))})]}),w.length>0&&n.jsxs("div",{className:"p-4 border-b",children:[n.jsxs("h3",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center",children:[n.jsx(Ko,{className:"h-4 w-4 mr-2"}),"Recent Searches"]}),n.jsx("div",{className:"space-y-2",children:w.map((q,oe)=>n.jsxs("div",{className:"flex items-center space-x-3 p-3 rounded-lg hover:bg-accent cursor-pointer transition-colors",onClick:()=>Z(q),children:[n.jsx(Li,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{className:"flex-1",children:q})]},oe))})]}),n.jsxs("div",{className:"p-4 flex justify-center",children:[n.jsxs("h3",{className:"text-sm font-medium text-muted-foreground mb-3 flex items-center",children:[n.jsx(Ei,{className:"h-4 w-4 mr-2"}),"Trending Searches"]}),n.jsx("div",{className:"flex flex-wrap gap-2",children:E.map((q,oe)=>n.jsx(ls,{variant:"secondary",className:"cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>W(q),children:q},oe))})]}),n.jsxs("div",{className:"p-4 border-t bg-muted/30",children:[n.jsx("h3",{className:"text-sm font-medium text-muted-foreground mb-3",children:"Quick Actions"}),n.jsxs("div",{className:"grid grid-cols-2 gap-3",children:[n.jsxs(dt,{variant:"outline",className:"justify-start",onClick:()=>{L("/buy"),s()},children:[n.jsx(bo,{className:"h-4 w-4 mr-2"}),"Browse Properties"]}),n.jsxs(dt,{variant:"outline",className:"justify-start",onClick:()=>{L("/agents"),s()},children:[n.jsx(Ya,{className:"h-4 w-4 mr-2"}),"Find Agents"]})]})]})]})]})})})})}):null};class Zce{constructor(){yb(this,"notifications",[]);yb(this,"listeners",[]);yb(this,"unreadCount",0);this.loadMockNotifications()}loadMockNotifications(){this.notifications=[{id:"1",type:"message",category:"urgent",title:"New Message from Agent",message:"Sarah Kamau sent you a message about the property in Karen. She's available for a viewing this weekend.",timestamp:new Date(Date.now()-5*60*1e3),isRead:!1,isArchived:!1,isPinned:!0,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-001",agentId:"agent-001",location:"Karen, Nairobi"}},{id:"2",type:"property",category:"important",title:"Property View Update",message:"Your property in Westlands received 15 new views today and 3 new inquiries.",timestamp:new Date(Date.now()-30*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-002",location:"Westlands, Nairobi",views:15,inquiries:3}},{id:"3",type:"payment",category:"normal",title:"Payment Received",message:"KES 2,500 has been credited to your account for property views this month.",timestamp:new Date(Date.now()-2*60*60*1e3),isRead:!0,isArchived:!1,isPinned:!1,metadata:{amount:2500,currency:"KES"}},{id:"4",type:"system",category:"low",title:"Welcome to KejaYangu",message:"Your account has been successfully created. Start exploring properties and earning rewards!",timestamp:new Date(Date.now()-24*60*60*1e3),isRead:!0,isArchived:!1,isPinned:!1},{id:"5",type:"inquiry",category:"urgent",title:"New Property Inquiry",message:"John Doe is interested in your 3-bedroom apartment in Kilimani. Contact them within 24 hours.",timestamp:new Date(Date.now()-1*60*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-003",location:"Kilimani, Nairobi",contact:"john@example.com"}},{id:"6",type:"reminder",category:"important",title:"Property Viewing Reminder",message:"You have a property viewing scheduled for tomorrow at 2:00 PM in Westlands.",timestamp:new Date(Date.now()-4*60*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,metadata:{propertyId:"prop-004",location:"Westlands, Nairobi",scheduledTime:"2024-01-16T14:00:00Z"}}],this.updateUnreadCount(),this.notifyListeners()}getNotifications(){return[...this.notifications]}getUnreadCount(){return this.unreadCount}addNotification(s){const l={...s,id:Date.now().toString(),timestamp:new Date,isRead:!1,isArchived:!1,isPinned:!1};return this.notifications.unshift(l),this.updateUnreadCount(),this.notifyListeners(),_g({title:s.title,description:s.message,variant:s.category==="urgent"?"destructive":"default"}),l.id}markAsRead(s){const l=this.notifications.find(d=>d.id===s);l&&!l.isRead&&(l.isRead=!0,this.updateUnreadCount(),this.notifyListeners())}markAllAsRead(){let s=!1;this.notifications.forEach(l=>{l.isRead||(l.isRead=!0,s=!0)}),s&&(this.updateUnreadCount(),this.notifyListeners())}togglePin(s){const l=this.notifications.find(d=>d.id===s);l&&(l.isPinned=!l.isPinned,this.notifyListeners())}archiveNotification(s){const l=this.notifications.find(d=>d.id===s);l&&!l.isArchived&&(l.isArchived=!0,this.updateUnreadCount(),this.notifyListeners())}deleteNotification(s){const l=this.notifications.findIndex(d=>d.id===s);l!==-1&&(this.notifications[l].isRead||this.unreadCount--,this.notifications.splice(l,1),this.notifyListeners())}bulkAction(s,l){switch(l){case"read":s.forEach(d=>this.markAsRead(d));break;case"archive":s.forEach(d=>this.archiveNotification(d));break;case"delete":s.forEach(d=>this.deleteNotification(d));break}}updateUnreadCount(){this.unreadCount=this.notifications.filter(s=>!s.isRead&&!s.isArchived).length}subscribe(s){return this.listeners.push(s),s(this.notifications),()=>{const l=this.listeners.indexOf(s);l!==-1&&this.listeners.splice(l,1)}}notifyListeners(){this.listeners.forEach(s=>s([...this.notifications]))}startRealTimeSimulation(){setInterval(()=>{if(Math.random()<.1){const s=["message","property","payment","inquiry"],l=["urgent","important","normal"];this.addNotification({type:s[Math.floor(Math.random()*s.length)],category:l[Math.floor(Math.random()*l.length)],title:"New Activity",message:"You have new activity on your account. Check it out!",metadata:{}})}},3e4)}stopRealTimeSimulation(){}}const og=new Zce;og.startRealTimeSimulation();const Kce=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!1),[m,_]=z.useState(0);z.useEffect(()=>og.subscribe($=>{s($),_(og.getUnreadCount())}),[]);const w=F=>{og.markAsRead(F)},o=()=>{og.markAllAsRead()},E=F=>{og.deleteNotification(F)},P=F=>{switch(F){case"message":return n.jsx(tl,{className:"h-4 w-4 text-blue-500"});case"property":return n.jsx(bo,{className:"h-4 w-4 text-green-500"});case"payment":return n.jsx(hi,{className:"h-4 w-4 text-yellow-500"});case"system":return n.jsx(Qw,{className:"h-4 w-4 text-purple-500"});case"inquiry":return n.jsx(lu,{className:"h-4 w-4 text-orange-500"});case"reminder":return n.jsx(Ko,{className:"h-4 w-4 text-indigo-500"});default:return n.jsx(rl,{className:"h-4 w-4 text-gray-500"})}},M=F=>{const Y=new Date().getTime()-F.getTime(),H=Math.floor(Y/(1e3*60)),X=Math.floor(Y/(1e3*60*60)),Z=Math.floor(Y/(1e3*60*60*24));return H<1?"Just now":H<60?`${H}m ago`:X<24?`${X}h ago`:Z<7?`${Z}d ago`:F.toLocaleDateString()},L=F=>{F.isRead||w(F.id),F.action&&F.action(),d(!1)};return n.jsxs(Nx,{open:l,onOpenChange:d,children:[n.jsx(Ex,{asChild:!0,children:n.jsxs(dt,{variant:"ghost",size:"icon",className:"relative",children:[n.jsx(au,{className:"h-5 w-5"}),m>0&&n.jsx(ls,{className:"absolute -top-1 -right-1 h-5 w-5 p-0 flex items-center justify-center bg-red-500 text-white text-xs",children:m>9?"9+":m})]})}),n.jsxs(Mf,{className:"w-80 mt-2",align:"end",sideOffset:8,onCloseAutoFocus:F=>F.preventDefault(),children:[n.jsxs(SP,{className:"flex items-center justify-between p-4",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold",children:"Notifications"}),n.jsxs("p",{className:"text-sm text-muted-foreground",children:[m," unread ",m===1?"message":"messages"]})]}),m>0&&n.jsx(dt,{variant:"ghost",size:"sm",onClick:o,className:"text-xs",children:"Mark all read"})]}),n.jsx(Jp,{}),n.jsx(kh,{className:"h-80",children:n.jsx("div",{className:"p-2",children:e.length===0?n.jsxs("div",{className:"text-center py-8 text-muted-foreground",children:[n.jsx(au,{className:"h-12 w-12 mx-auto mb-2 opacity-50"}),n.jsx("p",{children:"No notifications yet"}),n.jsx("p",{className:"text-xs",children:"We'll notify you when something important happens"})]}):n.jsx("div",{className:"space-y-2",children:e.map(F=>n.jsx(ci.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`p-3 rounded-lg cursor-pointer transition-all duration-200 ${F.isRead?"bg-muted/50 hover:bg-muted":"bg-blue-50 hover:bg-blue-100 border-l-2 border-blue-500"}`,onClick:()=>L(F),children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"flex-shrink-0",children:F.avatar?n.jsxs(al,{className:"h-8 w-8",children:[n.jsx(Il,{src:F.avatar}),n.jsx(ll,{className:"text-xs",children:P(F.type)})]}):n.jsx("div",{className:"h-8 w-8 rounded-full bg-muted flex items-center justify-center",children:P(F.type)})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-start justify-between",children:[n.jsx("p",{className:`text-sm font-medium ${F.isRead?"text-muted-foreground":"text-foreground"}`,children:F.title}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(dt,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:$=>{$.stopPropagation(),w(F.id)},children:n.jsx(Eh,{className:"h-3 w-3"})}),n.jsx(dt,{variant:"ghost",size:"icon",className:"h-6 w-6",onClick:$=>{$.stopPropagation(),E(F.id)},children:n.jsx(ol,{className:"h-3 w-3"})})]})]}),n.jsx("p",{className:`text-sm mt-1 ${F.isRead?"text-muted-foreground":"text-foreground"}`,children:F.message}),n.jsx("p",{className:"text-xs text-muted-foreground mt-2",children:M(F.timestamp)})]})]})},F.id))})})}),e.length>0&&n.jsxs(n.Fragment,{children:[n.jsx(Jp,{}),n.jsx("div",{className:"p-2",children:n.jsx(dt,{variant:"outline",className:"w-full",onClick:()=>{console.log("Navigate to notifications page"),d(!1)},children:"View All Notifications"})})]})]})]})},zi=()=>{const[e,s]=z.useState(!1),[l,d]=z.useState(!1),[m,_]=z.useState(!1),w=Xr(),{user:o,isAuthenticated:E,logout:P}=mi(),{toast:M}=Bi();z.useEffect(()=>{const X=Z=>{(Z.ctrlKey||Z.metaKey)&&Z.key==="k"&&(Z.preventDefault(),_(!0))};return document.addEventListener("keydown",X),()=>document.removeEventListener("keydown",X)},[]);const L=()=>{w("/auth/signin")},F=()=>{w("/auth/register")},$=async()=>{try{await P(),M({title:"Signed out successfully",description:"You have been signed out of your account.",variant:"default"}),w("/")}catch{M({title:"Sign out failed",description:"There was an error signing you out. Please try again.",variant:"destructive"})}},Y=()=>{if(!o)return"U";const{firstName:X,lastName:Z}=o;return`${(X==null?void 0:X.charAt(0))||""}${(Z==null?void 0:Z.charAt(0))||""}`.toUpperCase()||"U"},H=()=>{if(!o)return"User";const{firstName:X,lastName:Z}=o;return`${X||""} ${Z||""}`.trim()||"User"};return n.jsxs("header",{className:"sticky top-0 z-50 w-full border-b bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60",children:[n.jsxs("div",{className:"container mx-auto px-4",children:[n.jsxs("div",{className:"flex h-16 items-center justify-between",children:[n.jsxs(_r,{to:"/",className:"flex items-center space-x-2",children:[n.jsx(bo,{className:"h-8 w-8 text-primary"}),n.jsxs("div",{className:"hidden sm:block",children:[n.jsx("h1",{className:"text-2xl font-bold text-gradient-primary",children:"KejaYangu"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Space That Suits You"})]})]}),n.jsxs("nav",{className:"hidden md:flex items-center space-x-6",children:[n.jsx(_r,{to:"/buy",className:"text-foreground hover:text-primary transition-colors",children:"Buy"}),n.jsx(_r,{to:"/rent",className:"text-foreground hover:text-primary transition-colors",children:"Rent"}),(o==null?void 0:o.role)==="AGENT"?n.jsx(_r,{to:"/agent",className:"text-foreground hover:text-primary transition-colors",children:"Sell"}):(o==null?void 0:o.role)==="ADMIN"?null:n.jsx("button",{onClick:()=>{const X=new CustomEvent("openBecomeAgentModal");window.dispatchEvent(X)},className:"text-foreground hover:text-primary transition-colors",children:"Sell"}),n.jsx(_r,{to:"/agents",className:"text-foreground hover:text-primary transition-colors",children:"Agents"})]}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx(Kce,{}),n.jsx(dt,{variant:"ghost",size:"icon",onClick:()=>_(!0),children:n.jsx(Li,{className:"h-5 w-5"})}),E?n.jsxs(Nx,{open:l,onOpenChange:d,children:[n.jsx(Ex,{asChild:!0,children:n.jsxs(dt,{variant:"ghost",className:"relative h-10 w-10 rounded-full p-0 hover:bg-accent transition-all duration-200",children:[n.jsxs(al,{className:"h-10 w-10",children:[n.jsx(Il,{src:o==null?void 0:o.profilePicture,alt:H()}),n.jsx(ll,{className:"bg-primary text-primary-foreground font-semibold",children:Y()})]}),n.jsx(W2,{className:"absolute -bottom-1 -right-1 h-4 w-4 bg-background rounded-full"})]})}),n.jsxs(Mf,{className:"w-56 mt-2",align:"end",sideOffset:8,children:[n.jsx(SP,{className:"font-normal",children:n.jsxs("div",{className:"flex flex-col space-y-1",children:[n.jsx("p",{className:"text-sm font-medium leading-none",children:H()}),n.jsx("p",{className:"text-xs leading-none text-muted-foreground",children:o==null?void 0:o.email})]})}),n.jsx(Jp,{}),n.jsxs(ti,{onClick:()=>{w("/profile"),d(!1)},className:"cursor-pointer",children:[n.jsx(lu,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Profile"})]}),n.jsxs(ti,{onClick:()=>{w("/account"),d(!1)},className:"cursor-pointer",children:[n.jsx(rx,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Account & Settings"})]}),(o==null?void 0:o.role)==="AGENT"&&n.jsxs(ti,{onClick:()=>{w("/agent"),d(!1)},className:"cursor-pointer",children:[n.jsx(Ya,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Agent Dashboard"})]}),(o==null?void 0:o.role)==="ADMIN"&&n.jsxs(ti,{onClick:()=>{w("/system-admin"),d(!1)},className:"cursor-pointer",children:[n.jsx(Ya,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Admin Dashboard"})]}),n.jsxs(ti,{onClick:()=>{w("/favorites"),d(!1)},className:"cursor-pointer",children:[n.jsx(su,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Favorites"})]}),n.jsxs(ti,{onClick:()=>{w("/messages"),d(!1)},className:"cursor-pointer",children:[n.jsx(tl,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Messages"})]}),n.jsxs(ti,{onClick:()=>{w("/notifications"),d(!1)},className:"cursor-pointer",children:[n.jsx(au,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Notifications"})]}),(o==null?void 0:o.role)==="AGENT"&&n.jsxs(n.Fragment,{children:[n.jsx(Jp,{}),n.jsxs(ti,{onClick:()=>{w("/agent/properties"),d(!1)},className:"cursor-pointer",children:[n.jsx(Ya,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"My Properties"})]}),n.jsxs(ti,{onClick:()=>{w("/agent/finance"),d(!1)},className:"cursor-pointer",children:[n.jsx(hi,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Finance"})]})]}),(o==null?void 0:o.role)==="CONTENT_CREATOR"&&n.jsxs(n.Fragment,{children:[n.jsx(Jp,{}),n.jsxs(ti,{onClick:()=>{w("/content-creator-dashboard"),d(!1)},className:"cursor-pointer",children:[n.jsx(hi,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Creator Dashboard"})]})]}),n.jsx(Jp,{}),n.jsxs(ti,{onClick:$,className:"cursor-pointer text-red-600 focus:text-red-600 focus:bg-red-50",children:[n.jsx(LE,{className:"mr-2 h-4 w-4"}),n.jsx("span",{children:"Sign out"})]})]})]}):n.jsxs("div",{className:"hidden sm:flex items-center space-x-2",children:[n.jsx(dt,{variant:"outline",onClick:L,children:"Sign In"}),n.jsx(dt,{variant:"default",onClick:F,children:"Sign Up"})]}),n.jsx(dt,{variant:"ghost",size:"icon",className:"md:hidden",onClick:()=>s(!e),children:e?n.jsx(ol,{className:"h-5 w-5"}):n.jsx(YJ,{className:"h-5 w-5"})})]})]}),e&&n.jsx("div",{className:"md:hidden border-t py-4",children:n.jsxs("nav",{className:"flex flex-col space-y-3",children:[n.jsx(_r,{to:"/buy",className:"text-foreground hover:text-primary transition-colors",children:"Buy"}),n.jsx(_r,{to:"/rent",className:"text-foreground hover:text-primary transition-colors",children:"Rent"}),(o==null?void 0:o.role)==="AGENT"?n.jsx(_r,{to:"/agent",className:"text-foreground hover:text-primary transition-colors",children:"Sell"}):(o==null?void 0:o.role)==="ADMIN"?null:n.jsx("button",{onClick:()=>{const X=new CustomEvent("openBecomeAgentModal");window.dispatchEvent(X)},className:"text-foreground hover:text-primary transition-colors",children:"Sell"}),n.jsx(_r,{to:"/agents",className:"text-foreground hover:text-primary transition-colors",children:"Agents"}),E?n.jsxs("div",{className:"space-y-2 mt-4 pt-4 border-t",children:[n.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-muted rounded-lg",children:[n.jsxs(al,{className:"h-10 w-10",children:[n.jsx(Il,{src:o==null?void 0:o.profilePicture,alt:H()}),n.jsx(ll,{className:"bg-primary text-primary-foreground font-semibold",children:Y()})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium text-foreground truncate",children:H()}),n.jsx("p",{className:"text-xs text-muted-foreground truncate",children:o==null?void 0:o.email})]})]}),n.jsxs(_r,{to:"/profile",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(lu,{className:"h-4 w-4"}),n.jsx("span",{children:"Profile"})]}),n.jsxs(_r,{to:"/account",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(rx,{className:"h-4 w-4"}),n.jsx("span",{children:"Account & Settings"})]}),n.jsxs(_r,{to:"/dashboard",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(Ya,{className:"h-4 w-4"}),n.jsx("span",{children:"Dashboard"})]}),n.jsxs(_r,{to:"/favorites",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(su,{className:"h-4 w-4"}),n.jsx("span",{children:"Favorites"})]}),n.jsxs(_r,{to:"/messages",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(tl,{className:"h-4 w-4"}),n.jsx("span",{children:"Messages"})]}),n.jsxs(_r,{to:"/notifications",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(au,{className:"h-4 w-4"}),n.jsx("span",{children:"Notifications"})]}),(o==null?void 0:o.role)==="AGENT"&&n.jsxs(_r,{to:"/agent-dashboard",className:"flex items-center space-x-2 p-2 rounded-lg hover:bg-accent transition-colors",onClick:()=>s(!1),children:[n.jsx(Ya,{className:"h-4 w-4"}),n.jsx("span",{children:"Agent Dashboard"})]}),n.jsxs(dt,{variant:"outline",className:"w-full text-red-600 border-red-200 hover:bg-red-50",onClick:()=>{$(),s(!1)},children:[n.jsx(LE,{className:"mr-2 h-4 w-4"}),"Sign out"]})]}):n.jsxs("div",{className:"space-y-2 mt-2",children:[n.jsx(dt,{variant:"outline",className:"w-full",onClick:L,children:"Sign In"}),n.jsx(dt,{variant:"default",className:"w-full",onClick:F,children:"Sign Up"})]})]})})]}),n.jsx(qce,{isOpen:m,onClose:()=>_(!1)})]})};var bS="Tabs",[Xce,Zde]=Xo(bS,[pS]),H8=pS(),[Yce,iI]=Xce(bS),W8=z.forwardRef((e,s)=>{const{__scopeTabs:l,value:d,onValueChange:m,defaultValue:_,orientation:w="horizontal",dir:o,activationMode:E="automatic",...P}=e,M=dv(o),[L,F]=Qu({prop:d,onChange:m,defaultProp:_??"",caller:bS});return n.jsx(Yce,{scope:l,baseId:Qc(),value:L,onValueChange:F,orientation:w,dir:M,activationMode:E,children:n.jsx(Ys.div,{dir:M,"data-orientation":w,...P,ref:s})})});W8.displayName=bS;var q8="TabsList",Z8=z.forwardRef((e,s)=>{const{__scopeTabs:l,loop:d=!0,...m}=e,_=iI(q8,l),w=H8(l);return n.jsx(yV,{asChild:!0,...w,orientation:_.orientation,dir:_.dir,loop:d,children:n.jsx(Ys.div,{role:"tablist","aria-orientation":_.orientation,...m,ref:s})})});Z8.displayName=q8;var K8="TabsTrigger",X8=z.forwardRef((e,s)=>{const{__scopeTabs:l,value:d,disabled:m=!1,..._}=e,w=iI(K8,l),o=H8(l),E=Q8(w.baseId,d),P=e$(w.baseId,d),M=d===w.value;return n.jsx(_V,{asChild:!0,...o,focusable:!m,active:M,children:n.jsx(Ys.button,{type:"button",role:"tab","aria-selected":M,"aria-controls":P,"data-state":M?"active":"inactive","data-disabled":m?"":void 0,disabled:m,id:E,..._,ref:s,onMouseDown:bs(e.onMouseDown,L=>{!m&&L.button===0&&L.ctrlKey===!1?w.onValueChange(d):L.preventDefault()}),onKeyDown:bs(e.onKeyDown,L=>{[" ","Enter"].includes(L.key)&&w.onValueChange(d)}),onFocus:bs(e.onFocus,()=>{const L=w.activationMode!=="manual";!M&&!m&&L&&w.onValueChange(d)})})})});X8.displayName=K8;var Y8="TabsContent",J8=z.forwardRef((e,s)=>{const{__scopeTabs:l,value:d,forceMount:m,children:_,...w}=e,o=iI(Y8,l),E=Q8(o.baseId,d),P=e$(o.baseId,d),M=d===o.value,L=z.useRef(M);return z.useEffect(()=>{const F=requestAnimationFrame(()=>L.current=!1);return()=>cancelAnimationFrame(F)},[]),n.jsx(Yo,{present:m||M,children:({present:F})=>n.jsx(Ys.div,{"data-state":M?"active":"inactive","data-orientation":o.orientation,role:"tabpanel","aria-labelledby":E,hidden:!F,id:P,tabIndex:0,...w,ref:s,style:{...e.style,animationDuration:L.current?"0s":void 0},children:F&&_})})});J8.displayName=Y8;function Q8(e,s){return`${e}-trigger-${s}`}function e$(e,s){return`${e}-content-${s}`}var Jce=W8,t$=Z8,s$=X8,n$=J8;const Ix=Jce,Rf=z.forwardRef(({className:e,...s},l)=>n.jsx(t$,{ref:l,className:Ds("inline-flex h-10 items-center justify-center rounded-md bg-muted p-1 text-muted-foreground",e),...s}));Rf.displayName=t$.displayName;const io=z.forwardRef(({className:e,...s},l)=>n.jsx(s$,{ref:l,className:Ds("inline-flex items-center justify-center whitespace-nowrap rounded-sm px-3 py-1.5 text-sm font-medium ring-offset-background transition-all focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 data-[state=active]:bg-background data-[state=active]:text-foreground data-[state=active]:shadow-sm",e),...s}));io.displayName=s$.displayName;const oo=z.forwardRef(({className:e,...s},l)=>n.jsx(n$,{ref:l,className:Ds("mt-2 ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",e),...s}));oo.displayName=n$.displayName;const Qce="/assets/hero-kenya-real-estate-CERSR3Uh.jpg",eue=()=>{const[e,s]=z.useState(""),[l,d]=z.useState(""),[m,_]=z.useState(""),[w,o]=z.useState(""),[E,P]=z.useState(""),[M,L]=z.useState(""),[F,$]=z.useState(""),[Y,H]=z.useState("buy"),X=Xr(),Z=()=>{const q=new URLSearchParams;e&&q.append("search",e),l&&q.append("propertyType",l),m&&q.append("location",m),w&&q.append("priceRange",w),E&&q.append("bedrooms",E),M&&q.append("bathrooms",M),F&&q.append("area",F);const oe=q.toString(),ae=`/${Y}${oe?`?${oe}`:""}`;X(ae)},W=()=>{s(""),d(""),_(""),o(""),P(""),L(""),$("")};return n.jsxs("section",{className:"relative min-h-[80vh] flex flex-col overflow-hidden",children:[n.jsx("div",{className:"absolute inset-0 bg-cover bg-center bg-no-repeat",style:{backgroundImage:`url(${Qce})`}}),n.jsx("div",{className:"absolute inset-0 hero-gradient opacity-90"}),n.jsx("div",{className:"relative z-10 flex-1 flex items-center justify-center md:mt-20 lg:mt-44 mt-14",children:n.jsx("div",{className:"w-full max-w-7xl mx-auto px-4 text-center",children:n.jsxs("div",{className:"animate-fade-in-up",children:[n.jsxs("h1",{className:"text-4xl md:text-6xl lg:text-7xl font-bold text-white mb-6",children:["Find Your Perfect",n.jsx("span",{className:"block text-gradient-luxury",children:"Space That Suits You"})]}),n.jsx("p",{className:"text-xl md:text-2xl text-white/90 mb-12 max-w-3xl mx-auto",children:"Discover exceptional properties across Kenya with KejaYangu. From Nairobi penthouses to Mombasa beachfront homes."})]})})}),n.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-4 pb-8",children:n.jsx("div",{className:"animate-slide-up bg-white/95 backdrop-blur-sm rounded-2xl p-6 md:p-8 shadow-[var(--shadow-elegant)] max-w-6xl mx-auto",children:n.jsxs(Ix,{value:Y,onValueChange:H,className:"w-full",children:[n.jsxs(Rf,{className:"grid w-full grid-cols-3 mb-6",children:[n.jsxs(io,{value:"buy",className:"flex items-center gap-2",children:[n.jsx(bo,{className:"h-4 w-4"}),"Buy"]}),n.jsxs(io,{value:"rent",className:"flex items-center gap-2",children:[n.jsx(UA,{className:"h-4 w-4"}),"Rent"]}),n.jsxs(io,{value:"sell",className:"flex items-center gap-2",children:[n.jsx(Ai,{className:"h-4 w-4"}),"Sell"]})]}),n.jsx(oo,{value:"buy",className:"space-y-0",children:n.jsx(EN,{searchQuery:e,setSearchQuery:s,propertyType:l,setPropertyType:d,location:m,setLocation:_,priceRange:w,setPriceRange:o,bedrooms:E,setBedrooms:P,bathrooms:M,setBathrooms:L,area:F,setArea:$,onSearch:Z,onReset:W,priceType:"sale"})}),n.jsx(oo,{value:"rent",className:"space-y-0",children:n.jsx(EN,{searchQuery:e,setSearchQuery:s,propertyType:l,setPropertyType:d,location:m,setLocation:_,priceRange:w,setPriceRange:o,bedrooms:E,setBedrooms:P,bathrooms:M,setBathrooms:L,area:F,setArea:$,onSearch:Z,onReset:W,priceType:"rent"})}),n.jsx(oo,{value:"sell",className:"space-y-0",children:n.jsx(EN,{searchQuery:e,setSearchQuery:s,propertyType:l,setPropertyType:d,location:m,setLocation:_,priceRange:w,setPriceRange:o,bedrooms:E,setBedrooms:P,bathrooms:M,setBathrooms:L,area:F,setArea:$,onSearch:Z,onReset:W,priceType:"sale"})})]})})}),n.jsx("div",{className:"relative z-10 w-full max-w-7xl mx-auto px-4 pb-16",children:n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-6 max-w-4xl mx-auto",children:[{label:"Properties",value:"10,000+"},{label:"Cities",value:"50+"},{label:"Happy Clients",value:"25,000+"},{label:"Expert Agents",value:"500+"}].map((q,oe)=>n.jsxs("div",{className:"text-center animate-fade-in-up",style:{animationDelay:`${oe*.1}s`},children:[n.jsx("div",{className:"text-3xl md:text-4xl font-bold text-white mb-2",children:q.value}),n.jsx("div",{className:"text-white/80",children:q.label})]},oe))})})]})},EN=({searchQuery:e,setSearchQuery:s,propertyType:l,setPropertyType:d,location:m,setLocation:_,priceRange:w,setPriceRange:o,bedrooms:E,setBedrooms:P,bathrooms:M,setBathrooms:L,area:F,setArea:$,onSearch:Y,onReset:H,priceType:X})=>{const Z=()=>X==="rent"?[{value:"20k-50k",label:"KSh 20K - 50K/month"},{value:"50k-80k",label:"KSh 50K - 80K/month"},{value:"80k-120k",label:"KSh 80K - 120K/month"},{value:"120k+",label:"KSh 120K+/month"}]:[{value:"5m-15m",label:"KSh 5M - 15M"},{value:"15m-25m",label:"KSh 15M - 25M"},{value:"25m-50m",label:"KSh 25M - 50M"},{value:"50m+",label:"KSh 50M+"}];return n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search by city, neighborhood, or property name...",value:e,onChange:W=>s(W.target.value),className:"h-12 text-lg pl-10"})]})}),n.jsxs(qn,{value:l,onValueChange:d,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Property Type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"apartment",children:"Apartment"}),n.jsx(it,{value:"house",children:"House"}),n.jsx(it,{value:"villa",children:"Villa"}),n.jsx(it,{value:"townhouse",children:"Townhouse"}),n.jsx(it,{value:"duplex",children:"Duplex"}),n.jsx(it,{value:"penthouse",children:"Penthouse"}),n.jsx(it,{value:"land",children:"Land"}),n.jsx(it,{value:"commercial",children:"Commercial"}),n.jsx(it,{value:"student-hostel",children:"Student Hostel"}),n.jsx(it,{value:"industrial",children:"Industrial"}),n.jsx(it,{value:"beach-house",children:"Beach House"}),n.jsx(it,{value:"serviced",children:"Serviced"})]})]}),n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Location"})}),n.jsxs($n,{children:[n.jsx(it,{value:"nairobi",children:"Nairobi"}),n.jsx(it,{value:"mombasa",children:"Mombasa"}),n.jsx(it,{value:"kisumu",children:"Kisumu"}),n.jsx(it,{value:"nakuru",children:"Nakuru"}),n.jsx(it,{value:"eldoret",children:"Eldoret"}),n.jsx(it,{value:"malindi",children:"Malindi"}),n.jsx(it,{value:"diani",children:"Diani"}),n.jsx(it,{value:"naivasha",children:"Naivasha"})]})]}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Price Range"})}),n.jsx($n,{children:Z().map(W=>n.jsx(it,{value:W.value,children:W.label},W.value))})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-5 gap-4",children:[n.jsxs(qn,{value:E,onValueChange:P,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Bedrooms"})}),n.jsxs($n,{children:[n.jsx(it,{value:"1",children:"1+ Bedrooms"}),n.jsx(it,{value:"2",children:"2+ Bedrooms"}),n.jsx(it,{value:"3",children:"3+ Bedrooms"}),n.jsx(it,{value:"4",children:"4+ Bedrooms"}),n.jsx(it,{value:"5",children:"5+ Bedrooms"})]})]}),n.jsxs(qn,{value:M,onValueChange:L,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Bathrooms"})}),n.jsxs($n,{children:[n.jsx(it,{value:"1",children:"1+ Bathrooms"}),n.jsx(it,{value:"2",children:"2+ Bathrooms"}),n.jsx(it,{value:"3",children:"3+ Bathrooms"}),n.jsx(it,{value:"4",children:"4+ Bathrooms"}),n.jsx(it,{value:"5",children:"5+ Bathrooms"})]})]}),n.jsxs(qn,{value:F,onValueChange:$,children:[n.jsx(Un,{className:"h-12",children:n.jsx(Zn,{placeholder:"Area (m)"})}),n.jsxs($n,{children:[n.jsx(it,{value:"50",children:"50+ m"}),n.jsx(it,{value:"100",children:"100+ m"}),n.jsx(it,{value:"200",children:"200+ m"}),n.jsx(it,{value:"300",children:"300+ m"}),n.jsx(it,{value:"500",children:"500+ m"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(dt,{className:"h-12 bg-primary hover:bg-primary/90 flex-1",onClick:Y,children:[n.jsx(Li,{className:"h-5 w-5 mr-2"}),"Search Properties"]}),n.jsx(dt,{variant:"outline",onClick:H,className:"h-12 px-3",title:"Reset all filters",children:n.jsx($A,{className:"h-4 w-4"})})]})]})]})},oI=({property:e,isOpen:s,onClose:l})=>{const[d,m]=z.useState(!1),[_,w]=z.useState(0),{showSuccess:o}=Z5();if(!s||!e)return null;const E=[e.image,e.image,e.image,e.image],P={description:"This stunning property offers the perfect blend of luxury and comfort. Located in one of the most sought-after neighborhoods, it features modern amenities, spacious rooms, and beautiful finishes throughout. The open-concept design creates an ideal space for both entertaining and daily living.",features:["Modern kitchen with granite countertops","Hardwood floors throughout","Central air conditioning","Security system","Garden/balcony","Parking space","Storage room","Built-in wardrobes"],amenities:["Swimming pool","Gym","24/7 security","Children's playground","BBQ area","Visitor parking","Garden maintenance","Cleaning services"],specifications:{yearBuilt:"2020",parking:"2 spaces",propertyType:e.isLuxury?"Luxury Villa":"Modern Apartment",condition:"Excellent",furnishing:"Semi-furnished",petPolicy:"Allowed",smoking:"Not allowed",maintenanceFee:e.priceType==="rent"?"15,000":"25,000",propertyTax:"18,000",insurance:"12,000",utilities:"8,000",internet:"3,500",water:"2,500",electricity:"4,500"},financials:{downPayment:e.priceType==="sale"?"2,500,000":"180,000",monthlyPayment:e.priceType==="sale"?"125,000":"180,000",interestRate:"12.5%",loanTerm:"25 years",closingCosts:"450,000",appraisalFee:"25,000",inspectionFee:"15,000"},neighborhood:{crimeRate:"Low",walkScore:"85",transitScore:"78",schoolRating:"9.2",averageAge:"32",familyFriendly:"Yes",nightlife:"Moderate",shopping:"Excellent"},nearbyPlaces:[{name:"Westlands Mall",distance:"0.5 km",icon:rQ,rating:4.5},{name:"Aga Khan Hospital",distance:"1.2 km",icon:HJ,rating:4.8},{name:"Braeburn School",distance:"0.8 km",icon:O5,rating:4.7},{name:"Central Park",distance:"0.3 km",icon:lQ,rating:4.6},{name:"Westlands Station",distance:"1.5 km",icon:aQ,rating:4.4},{name:"Jomo Kenyatta Airport",distance:"25 km",icon:eQ,rating:4.3}],coordinates:{lat:-1.2921,lng:36.8219,address:"Westlands, Nairobi, Kenya"}},M=()=>{m(!d),d||o("Added to favorites","Property saved to your wishlist")},L=F=>{w(F)};return n.jsx("div",{className:"fixed inset-0 z-50 flex items-center justify-center p-4 bg-black/50 backdrop-blur-sm",children:n.jsxs("div",{className:"bg-background rounded-2xl max-w-7xl w-full max-h-[90vh] overflow-y-auto",children:[n.jsx("div",{className:"sticky top-0 bg-background/95 backdrop-blur-sm border-b p-6 rounded-t-2xl",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsx(ls,{variant:e.priceType==="rent"?"secondary":"default",children:e.priceType==="rent"?"For Rent":"For Sale"}),e.isFeatured&&n.jsx(ls,{className:"bg-secondary text-secondary-foreground",children:"Featured"}),e.isLuxury&&n.jsx(ls,{className:"luxury-gradient text-luxury-foreground",children:"Luxury"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(dt,{variant:"ghost",size:"icon",onClick:M,className:d?"text-red-500":"",children:n.jsx(su,{className:`h-5 w-5 ${d?"fill-current":""}`})}),n.jsx(dt,{variant:"ghost",size:"icon",children:n.jsx(F5,{className:"h-5 w-5"})}),n.jsx(dt,{variant:"ghost",size:"icon",onClick:l,children:n.jsx(ol,{className:"h-5 w-5"})})]})]})}),n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8 mb-12",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"aspect-[4/3] rounded-xl overflow-hidden",children:n.jsx("img",{src:E[_],alt:e.title,className:"w-full h-full object-cover"})}),n.jsx("div",{className:"grid grid-cols-4 gap-2",children:E.map((F,$)=>n.jsx("button",{onClick:()=>L($),className:`aspect-square rounded-lg overflow-hidden border-2 transition-all ${_===$?"border-primary":"border-border hover:border-primary/50"}`,children:n.jsx("img",{src:F,alt:`${e.title} ${$+1}`,className:"w-full h-full object-cover"})},$))}),n.jsxs("div",{className:"flex gap-3",children:[n.jsxs(dt,{className:"flex-1 bg-primary hover:bg-primary/90",children:[n.jsx(Uh,{className:"h-4 w-4 mr-2"}),"Contact Agent"]}),n.jsxs(dt,{variant:"outline",className:"flex-1",children:[n.jsx(bx,{className:"h-4 w-4 mr-2"}),"Schedule Viewing"]})]})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-card-foreground mb-2",children:e.title}),n.jsxs("div",{className:"flex items-center gap-2 text-muted-foreground mb-4",children:[n.jsx(Ai,{className:"h-4 w-4"}),n.jsx("span",{children:e.location})]}),n.jsxs("div",{className:"text-3xl font-bold text-primary",children:["KSh ",e.price,e.priceType==="rent"&&n.jsx("span",{className:"text-lg text-muted-foreground",children:"/month"})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-4",children:[n.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[n.jsx(nx,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),n.jsx("div",{className:"text-lg font-semibold",children:e.bedrooms}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Bedrooms"})]}),n.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[n.jsx(sx,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),n.jsx("div",{className:"text-lg font-semibold",children:e.bathrooms}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Bathrooms"})]}),n.jsxs("div",{className:"text-center p-4 bg-muted/30 rounded-lg",children:[n.jsx(ix,{className:"h-6 w-6 mx-auto mb-2 text-primary"}),n.jsx("div",{className:"text-lg font-semibold",children:e.area}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"m"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(lc,{className:"h-5 w-5 fill-yellow-400 text-yellow-400"}),n.jsx("span",{className:"font-semibold",children:e.rating})]}),n.jsx("span",{className:"text-muted-foreground",children:" Excellent rating"})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsxs("div",{className:"text-center p-3 bg-success/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-success",children:P.neighborhood.walkScore}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Walk Score"})]}),n.jsxs("div",{className:"text-center p-3 bg-secondary/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-secondary",children:P.neighborhood.transitScore}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Transit Score"})]}),n.jsxs("div",{className:"text-center p-3 bg-warning/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-warning",children:P.neighborhood.schoolRating}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"School Rating"})]})]})]}),n.jsxs(Ix,{defaultValue:"overview",className:"w-full",children:[n.jsx(Rf,{className:"grid w-full grid-cols-1",children:n.jsx(io,{value:"overview",children:"Overview"})}),n.jsxs(oo,{value:"overview",className:"space-y-4 mt-4",children:[n.jsx("p",{className:"text-muted-foreground leading-relaxed",children:P.description}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Year Built:"}),n.jsx("span",{className:"font-medium",children:P.specifications.yearBuilt})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Property Type:"}),n.jsx("span",{className:"font-medium",children:P.specifications.propertyType})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Condition:"}),n.jsx("span",{className:"font-medium",children:P.specifications.condition})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Furnishing:"}),n.jsx("span",{className:"font-medium",children:P.specifications.furnishing})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Parking:"}),n.jsx("span",{className:"font-medium",children:P.specifications.parking})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Pet Policy:"}),n.jsx("span",{className:"font-medium",children:P.specifications.petPolicy})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Smoking:"}),n.jsx("span",{className:"font-medium",children:P.specifications.smoking})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Maintenance Fee:"}),n.jsxs("span",{className:"font-medium",children:["KSh ",P.specifications.maintenanceFee]})]})]})]})]})]})]})]}),n.jsxs("div",{className:"space-y-8",children:[n.jsx(ot,{className:"border-0 bg-muted/30",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[n.jsx(hi,{className:"h-5 w-5 text-primary"}),"Financial Summary"]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:["KSh ",P.financials.downPayment]}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Down Payment"})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsxs("div",{className:"text-2xl font-bold text-primary mb-1",children:["KSh ",P.financials.monthlyPayment]}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Monthly Payment"})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:P.financials.interestRate}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Interest Rate"})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-primary mb-1",children:P.financials.loanTerm}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Loan Term"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-muted/30",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("h3",{className:"text-xl font-semibold mb-4 flex items-center gap-2",children:[n.jsx(Ai,{className:"h-5 w-5 text-primary"}),"Property Location & Map"]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"aspect-square bg-muted rounded-lg border-2 border-dashed border-muted-foreground/30 flex items-center justify-center relative",children:[n.jsxs("div",{className:"text-center text-muted-foreground",children:[n.jsx(Ai,{className:"h-8 w-8 mx-auto mb-2 text-primary"}),n.jsx("p",{className:"text-sm",children:"Map Component"}),n.jsxs("p",{className:"text-xs",children:["Lat: ",P.coordinates.lat]}),n.jsxs("p",{className:"text-xs",children:["Lng: ",P.coordinates.lng]})]}),n.jsx("div",{className:"absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2",children:n.jsx("div",{className:"w-4 h-4 bg-primary rounded-full border-2 border-white shadow-lg animate-pulse"})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:"Address"}),n.jsx("p",{className:"text-muted-foreground",children:P.coordinates.address})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:"Coordinates"}),n.jsxs("div",{className:"grid grid-cols-2 gap-2 text-sm",children:[n.jsxs("div",{children:["Latitude: ",P.coordinates.lat]}),n.jsxs("div",{children:["Longitude: ",P.coordinates.lng]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:"Neighborhood Scores"}),n.jsxs("div",{className:"grid grid-cols-3 gap-3",children:[n.jsxs("div",{className:"text-center p-3 bg-success/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-success",children:P.neighborhood.walkScore}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Walk Score"})]}),n.jsxs("div",{className:"text-center p-3 bg-secondary/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-secondary",children:P.neighborhood.transitScore}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Transit Score"})]}),n.jsxs("div",{className:"text-center p-3 bg-warning/10 rounded-lg",children:[n.jsx("div",{className:"text-lg font-bold text-warning",children:P.neighborhood.schoolRating}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"School Rating"})]})]})]})]})]})]})}),n.jsx(ot,{className:"border-0 bg-muted/30",children:n.jsxs(at,{className:"p-6",children:[n.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Nearby Places & Amenities"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:P.nearbyPlaces.map((F,$)=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-background/50 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:n.jsx(F.icon,{className:"h-5 w-5 text-primary"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:F.name}),n.jsx("div",{className:"text-sm text-muted-foreground",children:F.distance})]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(lc,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),n.jsx("span",{className:"text-sm font-medium",children:F.rating})]})]},$))})]})}),n.jsx(ot,{className:"border-0 bg-muted/30",children:n.jsxs(at,{className:"p-6",children:[n.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Neighborhood Insights"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Crime Rate"}),n.jsx(ls,{variant:"outline",className:"text-sm",children:P.neighborhood.crimeRate})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Family Friendly"}),n.jsx(ls,{variant:"outline",className:"text-sm",children:P.neighborhood.familyFriendly})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Average Age"}),n.jsx("div",{className:"text-2xl font-bold text-primary",children:P.neighborhood.averageAge})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Shopping"}),n.jsx(ls,{variant:"outline",className:"text-sm",children:P.neighborhood.shopping})]})]})]})}),n.jsx(ot,{className:"border-0 bg-muted/30",children:n.jsxs(at,{className:"p-6",children:[n.jsx("h3",{className:"text-xl font-semibold mb-4",children:"Additional Costs & Utilities"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Property Tax"}),n.jsxs("div",{className:"text-2xl font-bold text-primary",children:["KSh ",P.specifications.propertyTax]})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Insurance"}),n.jsxs("div",{className:"text-2xl font-bold text-primary",children:["KSh ",P.specifications.insurance]})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Utilities"}),n.jsxs("div",{className:"text-2xl font-bold text-primary",children:["KSh ",P.specifications.utilities]})]}),n.jsxs("div",{className:"text-center p-4 bg-background/50 rounded-lg",children:[n.jsx("div",{className:"text-lg font-semibold mb-1",children:"Internet"}),n.jsxs("div",{className:"text-2xl font-bold text-primary",children:["KSh ",P.specifications.internet]})]})]})]})})]})]})]})})},aI=({id:e,title:s,location:l,price:d,priceType:m,image:_,bedrooms:w,bathrooms:o,area:E,rating:P,isLuxury:M=!1,isFeatured:L=!1,isVerified:F=!1,isPaid:$=!1})=>{const[Y,H]=z.useState(!1),[X,Z]=z.useState(!1),W=Xr(),{showSuccess:q}=Z5(),oe=()=>{W(`/property/${e}`)},ae=Le=>{Le.stopPropagation(),H(!Y),Y||q("Added to favorites","Property saved to your wishlist")},Ne=Le=>{Le.stopPropagation(),Z(!0)},Pe={id:e,title:s,location:l,price:d,priceType:m,image:_,bedrooms:w,bathrooms:o,area:E,rating:P,isLuxury:M,isFeatured:L,isVerified:F,isPaid:$};return n.jsxs(n.Fragment,{children:[n.jsxs(ot,{className:"property-card group cursor-pointer animate-property-hover",onClick:oe,children:[n.jsxs("div",{className:"relative overflow-hidden",children:[n.jsxs("div",{className:"aspect-[4/3] relative",children:[n.jsx("img",{src:_,alt:s,className:"w-full h-full object-cover transition-transform duration-500 group-hover:scale-110",loading:"lazy"}),n.jsx("div",{className:"property-overlay absolute inset-0 opacity-0 group-hover:opacity-100 transition-opacity duration-300"})]}),n.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[L&&n.jsx(ls,{className:"bg-secondary text-secondary-foreground",children:"Featured"}),M&&n.jsx(ls,{className:"luxury-gradient text-luxury-foreground",children:"Luxury"}),F&&n.jsx(ls,{className:"bg-green-500 text-green-50",children:"Verified"}),$&&n.jsx(ls,{className:"bg-blue-500 text-blue-50",children:"Paid"})]}),n.jsx(dt,{variant:"ghost",size:"icon",className:`absolute top-4 right-4 bg-white/80 backdrop-blur-sm hover:bg-white ${Y?"text-red-500":"text-gray-600"}`,onClick:ae,children:n.jsx(su,{className:`h-5 w-5 ${Y?"fill-current":""}`})}),n.jsx("div",{className:"absolute inset-x-4 bottom-4 opacity-0 group-hover:opacity-100 transition-all duration-300 transform translate-y-4 group-hover:translate-y-0",children:n.jsx(dt,{className:"w-full bg-white text-primary hover:bg-white/90",onClick:Ne,children:"Quick View"})})]}),n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsxs("div",{className:"text-2xl font-bold text-primary",children:["KSh ",d,m==="rent"&&n.jsx("span",{className:"text-sm text-muted-foreground",children:"/month"})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(lc,{className:"h-4 w-4 fill-yellow-400 text-yellow-400"}),n.jsx("span",{className:"text-sm font-medium",children:P})]})]}),n.jsx("h3",{className:"text-lg font-semibold text-card-foreground mb-2 line-clamp-1",children:s}),n.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground mb-4",children:[n.jsx(Ai,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm",children:l})]}),n.jsxs("div",{className:"flex items-center justify-between text-sm text-muted-foreground",children:[n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(nx,{className:"h-4 w-4"}),n.jsxs("span",{children:[w," bed"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(sx,{className:"h-4 w-4"}),n.jsxs("span",{children:[o," bath"]})]}),n.jsxs("div",{className:"flex items-center gap-1",children:[n.jsx(ix,{className:"h-4 w-4"}),n.jsxs("span",{children:[E," m"]})]})]})]})]}),n.jsx(oI,{property:Pe,isOpen:X,onClose:()=>Z(!1)})]})},Tg="/assets/property-1-CA9NUXqO.jpg",L4="/assets/property-2-BKkOuKi-.jpg",z4="/assets/property-3-BOudpPWW.jpg",tue=()=>{const e=[{id:"1",title:"Luxury Villa with Ocean Views",location:"Nyali, Mombasa",price:"25,000,000",priceType:"sale",image:L4,bedrooms:4,bathrooms:3,area:350,rating:4.8,isLuxury:!0,isFeatured:!0},{id:"2",title:"Modern Apartment in Westlands",location:"Westlands, Nairobi",price:"180,000",priceType:"rent",image:Tg,bedrooms:3,bathrooms:2,area:120,rating:4.6,isFeatured:!0},{id:"3",title:"Traditional Villa in Kisumu",location:"Milimani, Kisumu",price:"8,500,000",priceType:"sale",image:z4,bedrooms:5,bathrooms:4,area:280,rating:4.7},{id:"4",title:"Penthouse with City Views",location:"Upper Hill, Nairobi",price:"320,000",priceType:"rent",image:Tg,bedrooms:4,bathrooms:3,area:200,rating:4.9,isLuxury:!0},{id:"5",title:"Beachfront Apartment",location:"Diani, Mombasa",price:"15,000,000",priceType:"sale",image:L4,bedrooms:2,bathrooms:2,area:90,rating:4.5},{id:"6",title:"Family Home with Garden",location:"Karen, Nairobi",price:"220,000",priceType:"rent",image:z4,bedrooms:4,bathrooms:3,area:180,rating:4.4}];return n.jsx("section",{className:"py-16 bg-muted/30",children:n.jsxs("div",{className:"container mx-auto px-4",children:[n.jsxs("div",{className:"text-center mb-12",children:[n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gradient-primary mb-4",children:"Featured Properties"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Discover handpicked properties that match your lifestyle and budget"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8",children:e.map((s,l)=>n.jsx("div",{className:"animate-fade-in-up",style:{animationDelay:`${l*.1}s`},children:n.jsx(aI,{...s,isVerified:Math.random()<.7,isPaid:Math.random()<.6})},s.id))}),n.jsx("div",{className:"text-center mt-12",children:n.jsx("button",{className:"bg-primary text-primary-foreground px-8 py-3 rounded-lg hover:bg-primary-glow transition-colors font-medium",children:"View All Properties"})})]})})},sue=()=>{var P;const[e,s]=z.useState("nairobi"),[l,d]=z.useState("all"),m={nairobi:{averagePrice:"12,500,000",priceChange:"+8.5%",priceTrend:"up",daysOnMarket:45,daysChange:"-12%",propertiesSold:1250,soldChange:"+15%",pricePerSqFt:"85,000",sqFtChange:"+6.2%"},mombasa:{averagePrice:"8,200,000",priceChange:"+12.3%",priceTrend:"up",daysOnMarket:38,daysChange:"-8%",propertiesSold:890,soldChange:"+22%",pricePerSqFt:"72,000",sqFtChange:"+9.1%"},kisumu:{averagePrice:"5,800,000",priceChange:"+5.7%",priceTrend:"up",daysOnMarket:52,daysChange:"-5%",propertiesSold:650,soldChange:"+8%",pricePerSqFt:"48,000",sqFtChange:"+4.3%"}},_=[{value:"all",label:"All Properties"},{value:"apartment",label:"Apartments"},{value:"house",label:"Houses"},{value:"villa",label:"Villas"},{value:"land",label:"Land"}],w=[{value:"nairobi",label:"Nairobi"},{value:"mombasa",label:"Mombasa"},{value:"kisumu",label:"Kisumu"}],o=m[e],E=[{month:"Jan",price:11.2},{month:"Feb",price:11.5},{month:"Mar",price:11.8},{month:"Apr",price:12.1},{month:"May",price:12.3},{month:"Jun",price:12.5}];return n.jsx("section",{className:"py-20 bg-gradient-to-br from-muted/30 via-background to-muted/20",children:n.jsxs("div",{className:"container mx-auto px-4",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full mb-4",children:[n.jsx(vf,{className:"h-5 w-5"}),n.jsx("span",{className:"text-sm font-medium",children:"Market Intelligence"})]}),n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gradient-primary mb-4",children:"Real Estate Market Trends"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Stay informed with the latest market data, price trends, and investment opportunities across Kenya"})]}),n.jsxs("div",{className:"flex flex-col md:flex-row gap-4 mb-12 justify-center items-center",children:[n.jsxs(qn,{value:e,onValueChange:s,children:[n.jsx(Un,{className:"w-48",children:n.jsx(Zn,{placeholder:"Select City"})}),n.jsx($n,{children:w.map(M=>n.jsx(it,{value:M.value,children:M.label},M.value))})]}),n.jsxs(qn,{value:l,onValueChange:d,children:[n.jsx(Un,{className:"w-48",children:n.jsx(Zn,{placeholder:"Property Type"})}),n.jsx($n,{children:_.map(M=>n.jsx(it,{value:M.value,children:M.label},M.value))})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:[n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"p-2 bg-primary/10 rounded-lg",children:n.jsx(hi,{className:"h-6 w-6 text-primary"})}),n.jsxs(ls,{variant:o.priceTrend==="up"?"default":"destructive",className:"flex items-center gap-1",children:[o.priceTrend==="up"?n.jsx(Ei,{className:"h-3 w-3"}):n.jsx(zE,{className:"h-3 w-3"}),o.priceChange]})]}),n.jsx("h3",{className:"text-2xl font-bold text-card-foreground mb-1",children:o.averagePrice}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Average Property Price"})]})}),n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"p-2 bg-secondary/10 rounded-lg",children:n.jsx(bo,{className:"h-6 w-6 text-secondary"})}),n.jsxs(ls,{variant:o.daysChange.includes("-")?"default":"destructive",className:"flex items-center gap-1",children:[o.daysChange.includes("-")?n.jsx(zE,{className:"h-3 w-3"}):n.jsx(Ei,{className:"h-3 w-3"}),o.daysChange]})]}),n.jsx("h3",{className:"text-2xl font-bold text-card-foreground mb-1",children:o.daysOnMarket}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Days on Market"})]})}),n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"p-2 bg-success/10 rounded-lg",children:n.jsx(Ei,{className:"h-6 w-6 text-success"})}),n.jsxs(ls,{variant:"default",className:"flex items-center gap-1",children:[n.jsx(Ei,{className:"h-3 w-3"}),o.soldChange]})]}),n.jsx("h3",{className:"text-2xl font-bold text-card-foreground mb-1",children:o.propertiesSold.toLocaleString()}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Properties Sold (YTD)"})]})}),n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center justify-between mb-4",children:[n.jsx("div",{className:"p-2 bg-warning/10 rounded-lg",children:n.jsx(Ai,{className:"h-6 w-6 text-warning"})}),n.jsxs(ls,{variant:"default",className:"flex items-center gap-1",children:[n.jsx(Ei,{className:"h-3 w-3"}),o.sqFtChange]})]}),n.jsx("h3",{className:"text-2xl font-bold text-card-foreground mb-1",children:o.pricePerSqFt}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Price per Sq Ft"})]})})]}),n.jsxs(Ix,{defaultValue:"trends",className:"w-full",children:[n.jsxs(Rf,{className:"grid w-full grid-cols-3 mb-8",children:[n.jsx(io,{value:"trends",children:"Price Trends"}),n.jsx(io,{value:"comparison",children:"Market Comparison"}),n.jsx(io,{value:"forecast",children:"Investment Outlook"})]}),n.jsx(oo,{value:"trends",className:"space-y-6",children:n.jsxs(ot,{className:"border-0 bg-card/50 backdrop-blur-sm",children:[n.jsx(Ut,{children:n.jsxs($t,{className:"flex items-center gap-2",children:[n.jsx(Ei,{className:"h-5 w-5 text-primary"}),"Price Trends -"," ",(P=w.find(M=>M.value===e))==null?void 0:P.label]})}),n.jsxs(at,{children:[n.jsx("div",{className:"h-64 flex items-end justify-center gap-2",children:E.map((M,L)=>n.jsxs("div",{className:"flex flex-col items-center",children:[n.jsx("div",{className:"w-8 bg-gradient-to-t from-primary to-primary/60 rounded-t-sm transition-all duration-300 hover:from-primary/80 hover:to-primary/40",style:{height:`${M.price/15*200}px`}}),n.jsx("span",{className:"text-xs text-muted-foreground mt-2",children:M.month})]},L))}),n.jsx("div",{className:"text-center mt-4",children:n.jsx("p",{className:"text-sm text-muted-foreground",children:"Average price trend over the last 6 months (in millions KES)"})})]})]})}),n.jsx(oo,{value:"comparison",className:"space-y-6",children:n.jsxs(ot,{className:"border-0 bg-card/50 backdrop-blur-sm",children:[n.jsx(Ut,{children:n.jsx($t,{children:"Market Performance Comparison"})}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:Object.entries(m).map(([M,L])=>n.jsxs("div",{className:"flex items-center justify-between p-4 bg-muted/30 rounded-lg",children:[n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx("div",{className:"w-3 h-3 rounded-full bg-primary"}),n.jsx("span",{className:"font-medium capitalize",children:M})]}),n.jsxs("div",{className:"flex items-center gap-6",children:[n.jsxs("span",{className:"text-sm text-muted-foreground",children:["Avg: ",L.averagePrice]}),n.jsx(ls,{variant:L.priceTrend==="up"?"default":"destructive",className:"text-xs",children:L.priceChange})]})]},M))})})]})}),n.jsx(oo,{value:"forecast",className:"space-y-6",children:n.jsxs(ot,{className:"border-0 bg-card/50 backdrop-blur-sm",children:[n.jsx(Ut,{children:n.jsx($t,{children:"Investment Outlook"})}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"p-4 bg-success/10 rounded-lg border border-success/20",children:[n.jsx("h4",{className:"font-semibold text-success mb-2",children:"High Growth Potential"}),n.jsx("p",{className:"text-sm text-success/80",children:e==="nairobi"?"Westlands and Upper Hill show strong appreciation trends":e==="mombasa"?"Nyali and Diani continue to attract luxury buyers":"Milimani and Lolwe areas are emerging as investment hotspots"})]}),n.jsxs("div",{className:"p-4 bg-warning/10 rounded-lg border border-warning/20",children:[n.jsx("h4",{className:"font-semibold text-warning mb-2",children:"Market Insights"}),n.jsx("p",{className:"text-sm text-warning/80",children:"Property values expected to increase by 8-12% in the next 12 months based on current trends and development projects."})]})]})})]})})]}),n.jsx("div",{className:"mt-16 text-center",children:n.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-8 md:p-12",children:[n.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-card-foreground mb-4",children:"Ready to Make Informed Investment Decisions?"}),n.jsx("p",{className:"text-muted-foreground text-lg mb-8 max-w-2xl mx-auto",children:"Get detailed market reports, property valuations, and expert insights to maximize your real estate investments"}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n.jsx("button",{className:"px-8 py-3 bg-primary text-primary-foreground rounded-lg hover:bg-primary/90 transition-colors font-medium",children:"Download Market Report"}),n.jsx("button",{className:"px-8 py-3 border border-primary text-primary rounded-lg hover:bg-primary/10 transition-colors font-medium",children:"Schedule Consultation"})]})]})})]})})},nue=()=>{const e=[{icon:Li,title:"Advanced Search",description:"Find properties with precision using our intelligent search filters and location-based discovery."},{icon:Ai,title:"Interactive Maps",description:"Explore neighborhoods with our detailed maps powered by real-time data and satellite imagery."},{icon:ac,title:"Verified Listings",description:"All properties are verified by our team to ensure authenticity and accurate information."},{icon:sv,title:"Direct Communication",description:"Connect instantly with property owners and agents through our integrated chat system."},{icon:Ei,title:"Market Insights",description:"Get real-time market trends and property valuations to make informed decisions."},{icon:_o,title:"Expert Agents",description:"Work with certified real estate professionals who know the Kenyan market inside out."},{icon:lc,title:"Premium Service",description:"Experience white-glove service with personalized property recommendations and tours."},{icon:Ko,title:"24/7 Support",description:"Our customer support team is available round the clock to assist with your needs."}];return n.jsx("section",{className:"py-20 bg-background",children:n.jsxs("div",{className:"container mx-auto px-4",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gradient-primary mb-4",children:"Why Choose KejaYangu?"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"We're revolutionizing the Kenyan real estate market with cutting-edge technology and unmatched service quality."})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:e.map((s,l)=>n.jsx(ot,{className:"group hover:shadow-[var(--shadow-elegant)] transition-all duration-300 animate-fade-in-up border-0 bg-card/50 backdrop-blur-sm",style:{animationDelay:`${l*.1}s`},children:n.jsxs(at,{className:"p-6 text-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center group-hover:bg-primary/20 transition-colors",children:n.jsx(s.icon,{className:"h-8 w-8 text-primary"})}),n.jsx("h3",{className:"text-lg font-semibold mb-2 text-card-foreground",children:s.title}),n.jsx("p",{className:"text-muted-foreground text-sm leading-relaxed",children:s.description})]})},l))}),n.jsx("div",{className:"mt-16 text-center",children:n.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-accent/10 rounded-2xl p-8 md:p-12",children:[n.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-card-foreground mb-4",children:"Ready to Find Your Dream Property?"}),n.jsx("p",{className:"text-muted-foreground text-lg mb-8 max-w-2xl mx-auto",children:"Join thousands of satisfied customers who found their perfect space with KejaYangu"}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n.jsx("button",{className:"bg-primary text-primary-foreground px-8 py-3 rounded-lg hover:bg-primary-glow transition-colors font-medium",children:"Start Searching"}),n.jsx("button",{className:"border-2 border-primary text-primary px-8 py-3 rounded-lg hover:bg-primary hover:text-primary-foreground transition-colors font-medium",children:"List Your Property"})]})]})})]})})},rue=()=>{const[e,s]=z.useState(0),l=[{question:"How do I verify that a property listing is authentic and up-to-date?",answer:"All properties on KejaYangu undergo a rigorous verification process. Our team personally inspects each listing, verifies ownership documents, and ensures all information is current. We also use advanced technology to detect and remove duplicate or fraudulent listings. Additionally, you can contact our support team to request additional verification for any property you're interested in."},{question:"What are the typical fees and commissions when buying or renting through KejaYangu?",answer:"KejaYangu operates on a transparent fee structure. For buyers, there are no platform fees - you only pay standard legal and transfer costs. For renters, we charge a one-time service fee equivalent to one month's rent. Sellers pay a competitive commission of 2-3% depending on the property value. All fees are clearly displayed before any transaction, with no hidden charges."},{question:"How can I schedule property viewings and what safety measures are in place?",answer:"You can schedule viewings directly through our platform by clicking the 'Schedule Viewing' button on any property listing. We offer both in-person and virtual tours. For safety, all our agents are verified and background-checked. We also provide a secure meeting system with real-time location sharing and emergency contacts. Virtual tours are available 24/7, while in-person viewings are scheduled during business hours with advance notice."},{question:"What financing options and mortgage assistance do you provide?",answer:"KejaYangu partners with leading Kenyan banks and financial institutions to offer competitive mortgage rates starting from 12.5% APR. We provide a mortgage calculator tool, pre-approval assistance, and dedicated mortgage advisors. Our platform also supports various financing options including developer financing, rent-to-own schemes, and government housing programs like Boma Yangu. We'll guide you through the entire application process."},{question:"How do you handle property disputes and what's your refund policy?",answer:"We have a comprehensive dispute resolution system. If there's a discrepancy between listing details and actual property conditions, we offer a 7-day satisfaction guarantee with full refund of any fees paid. For legal disputes, we provide access to our network of real estate lawyers and mediation services. All transactions are protected by our escrow service, and we maintain detailed records of all communications and agreements for transparency."}],d=m=>{s(e===m?null:m)};return n.jsx("section",{className:"py-20 bg-gradient-to-br from-background via-muted/20 to-background",children:n.jsxs("div",{className:"container mx-auto px-4",children:[n.jsxs("div",{className:"text-center mb-16",children:[n.jsxs("div",{className:"inline-flex items-center gap-2 bg-primary/10 text-primary px-4 py-2 rounded-full mb-4",children:[n.jsx(Vb,{className:"h-5 w-5"}),n.jsx("span",{className:"text-sm font-medium",children:"Frequently Asked Questions"})]}),n.jsx("h2",{className:"text-3xl md:text-4xl font-bold text-gradient-primary mb-4",children:"Got Questions? We've Got Answers"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Find answers to the most common questions about buying, selling, and renting properties through KejaYangu"})]}),n.jsx("div",{className:"max-w-4xl mx-auto space-y-4",children:l.map((m,_)=>n.jsx(ot,{className:`border-0 transition-all duration-300 ${e===_?"bg-card shadow-[var(--shadow-elegant)]":"bg-card/50 backdrop-blur-sm hover:bg-card/70"}`,children:n.jsxs(at,{className:"p-0",children:[n.jsxs(dt,{variant:"ghost",className:`w-full h-auto p-6 text-left justify-between hover:bg-transparent ${e===_?"text-primary":"text-card-foreground"}`,onClick:()=>d(_),children:[n.jsx("h3",{className:"text-lg font-semibold pr-4",children:m.question}),n.jsx(W2,{className:`h-5 w-5 transition-transform duration-300 ${e===_?"rotate-180":""}`})]}),e===_&&n.jsx("div",{className:"px-6 pb-6 animate-in slide-in-from-top-2 duration-300",children:n.jsx("div",{className:"border-t border-border/50 pt-4",children:n.jsx("p",{className:"text-muted-foreground leading-relaxed",children:m.answer})})})]})},_))}),n.jsx("div",{className:"mt-16 text-center",children:n.jsxs("div",{className:"bg-gradient-to-r from-primary/10 to-secondary/10 rounded-2xl p-8 md:p-12 max-w-3xl mx-auto",children:[n.jsx("h3",{className:"text-2xl md:text-3xl font-bold text-card-foreground mb-4",children:"Still Have Questions?"}),n.jsx("p",{className:"text-muted-foreground text-lg mb-8",children:"Our customer support team is here to help you with any specific questions about properties, transactions, or our services."}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[n.jsx(dt,{className:"px-8 py-3 bg-primary hover:bg-primary/90 transition-colors",children:"Contact Support"}),n.jsx(dt,{variant:"outline",className:"px-8 py-3",children:"Live Chat"})]})]})}),n.jsxs("div",{className:"mt-16 grid grid-cols-1 md:grid-cols-3 gap-6 max-w-4xl mx-auto",children:[n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6 text-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-primary/10 rounded-full flex items-center justify-center",children:n.jsx(Vb,{className:"h-8 w-8 text-primary"})}),n.jsx("h4",{className:"font-semibold mb-2",children:"Help Center"}),n.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Comprehensive guides and tutorials"}),n.jsx(dt,{variant:"ghost",className:"text-primary hover:text-primary/80",children:"Browse Articles "})]})}),n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6 text-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-secondary/10 rounded-full flex items-center justify-center",children:n.jsx(Vb,{className:"h-8 w-8 text-secondary"})}),n.jsx("h4",{className:"font-semibold mb-2",children:"Video Tutorials"}),n.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Step-by-step video guides"}),n.jsx(dt,{variant:"ghost",className:"text-secondary hover:text-secondary/80",children:"Watch Videos "})]})}),n.jsx(ot,{className:"border-0 bg-card/50 backdrop-blur-sm hover:shadow-[var(--shadow-elegant)] transition-all duration-300",children:n.jsxs(at,{className:"p-6 text-center",children:[n.jsx("div",{className:"w-16 h-16 mx-auto mb-4 bg-success/10 rounded-full flex items-center justify-center",children:n.jsx(Vb,{className:"h-8 w-8 text-success"})}),n.jsx("h4",{className:"font-semibold mb-2",children:"Community Forum"}),n.jsx("p",{className:"text-sm text-muted-foreground mb-4",children:"Connect with other users"}),n.jsx(dt,{variant:"ghost",className:"text-success hover:text-success/80",children:"Join Discussion "})]})})]})]})})},Oi=()=>n.jsx("footer",{className:"bg-card border-t",children:n.jsxs("div",{className:"container mx-auto px-4 py-12",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs(_r,{to:"/",className:"flex items-center space-x-2",children:[n.jsx(bo,{className:"h-8 w-8 text-primary"}),n.jsxs("div",{children:[n.jsx("h1",{className:"text-xl font-bold text-gradient-primary",children:"KejaYangu"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Space That Suits You"})]})]}),n.jsx("p",{className:"text-muted-foreground",children:"Kenya's leading real estate platform connecting buyers, sellers, and renters with their perfect properties."}),n.jsxs("div",{className:"flex space-x-4",children:[n.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:n.jsx($J,{className:"h-5 w-5"})}),n.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:n.jsx(cQ,{className:"h-5 w-5"})}),n.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:n.jsx(WJ,{className:"h-5 w-5"})}),n.jsx("a",{href:"#",className:"text-muted-foreground hover:text-primary transition-colors",children:n.jsx(KJ,{className:"h-5 w-5"})})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-card-foreground mb-4",children:"Quick Links"}),n.jsxs("ul",{className:"space-y-2",children:[n.jsx("li",{children:n.jsx(_r,{to:"/buy",className:"text-muted-foreground hover:text-primary transition-colors",children:"Buy Properties"})}),n.jsx("li",{children:n.jsx(_r,{to:"/rent",className:"text-muted-foreground hover:text-primary transition-colors",children:"Rent Properties"})}),n.jsx("li",{children:n.jsx(_r,{to:"/sell",className:"text-muted-foreground hover:text-primary transition-colors",children:"Sell Property"})}),n.jsx("li",{children:n.jsx(_r,{to:"/agents",className:"text-muted-foreground hover:text-primary transition-colors",children:"Find Agents"})}),n.jsx("li",{children:n.jsx(_r,{to:"/mortgage",className:"text-muted-foreground hover:text-primary transition-colors",children:"Mortgage Calculator"})})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-card-foreground mb-4",children:"Support"}),n.jsxs("ul",{className:"space-y-2",children:[n.jsx("li",{children:n.jsx(_r,{to:"/help",className:"text-muted-foreground hover:text-primary transition-colors",children:"Help Center"})}),n.jsx("li",{children:n.jsx(_r,{to:"/contact",className:"text-muted-foreground hover:text-primary transition-colors",children:"Contact Us"})}),n.jsx("li",{children:n.jsx(_r,{to:"/privacy",className:"text-muted-foreground hover:text-primary transition-colors",children:"Privacy Policy"})}),n.jsx("li",{children:n.jsx(_r,{to:"/terms",className:"text-muted-foreground hover:text-primary transition-colors",children:"Terms of Service"})}),n.jsx("li",{children:n.jsx(_r,{to:"/sitemap",className:"text-muted-foreground hover:text-primary transition-colors",children:"Sitemap"})})]})]}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-card-foreground mb-4",children:"Contact"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(Ai,{className:"h-5 w-5 text-primary mt-0.5"}),n.jsx("div",{children:n.jsxs("p",{className:"text-muted-foreground text-sm",children:["Westlands Towers, 14th Floor",n.jsx("br",{}),"Nairobi, Kenya"]})})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(Uh,{className:"h-5 w-5 text-primary"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:"+254 700 123 456"})]}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(il,{className:"h-5 w-5 text-primary"}),n.jsx("p",{className:"text-muted-foreground text-sm",children:"info@kejayangu.com"})]})]})]})]}),n.jsx("div",{className:"border-t mt-8 pt-8 text-center",children:n.jsx("p",{className:"text-muted-foreground text-sm",children:" 2024 KejaYangu. All rights reserved. Made with  in Kenya."})})]})}),iue=()=>n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{children:[n.jsx(eue,{}),n.jsx(tue,{}),n.jsx(sue,{}),n.jsx(nue,{}),n.jsx(rue,{})]}),n.jsx(Oi,{})]});var r$={exports:{}};(function(e,s){(function(l,d){e.exports=d()})(w9,function(){var l,d,m;function _(o,E){if(!l)l=E;else if(!d)d=E;else{var P="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+l+")(sharedChunk); ("+d+")(sharedChunk); self.onerror = null;",M={};l(M),m=E(M),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(m.workerUrl=window.URL.createObjectURL(new Blob([P],{type:"text/javascript"})))}}_(["exports"],function(o){var E=1e-6,P=typeof Float32Array<"u"?Float32Array:Array;function M(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=i*g-h*u;return x?(a[0]=g*(x=1/x),a[1]=-u*x,a[2]=-h*x,a[3]=i*x,a):null}function L(){var a=new P(9);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[5]=0,a[6]=0,a[7]=0),a[0]=1,a[4]=1,a[8]=1,a}function F(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=t[4],b=t[5],j=t[6],T=t[7],A=t[8];return a[0]=x*A-b*T,a[1]=h*T-u*A,a[2]=u*b-h*x,a[3]=b*j-g*A,a[4]=i*A-h*j,a[5]=h*g-i*b,a[6]=g*T-x*j,a[7]=u*j-i*T,a[8]=i*x-u*g,a}function $(a,t,i){var u=t[0],h=t[1],g=t[2],x=t[3],b=t[4],j=t[5],T=t[6],A=t[7],I=t[8],R=i[0],B=i[1],V=i[2],K=i[3],Q=i[4],re=i[5],ue=i[6],ce=i[7],he=i[8];return a[0]=R*u+B*x+V*T,a[1]=R*h+B*b+V*A,a[2]=R*g+B*j+V*I,a[3]=K*u+Q*x+re*T,a[4]=K*h+Q*b+re*A,a[5]=K*g+Q*j+re*I,a[6]=ue*u+ce*x+he*T,a[7]=ue*h+ce*b+he*A,a[8]=ue*g+ce*j+he*I,a}function Y(){var a=new P(16);return P!=Float32Array&&(a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=0,a[12]=0,a[13]=0,a[14]=0),a[0]=1,a[5]=1,a[10]=1,a[15]=1,a}function H(a){return a[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function X(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=t[4],b=t[5],j=t[6],T=t[7],A=t[8],I=t[9],R=t[10],B=t[11],V=t[12],K=t[13],Q=t[14],re=t[15],ue=i*b-u*x,ce=i*j-h*x,he=i*T-g*x,Ee=u*j-h*b,we=u*T-g*b,je=h*T-g*j,Me=A*K-I*V,ke=A*Q-R*V,Qe=A*re-B*V,Fe=I*Q-R*K,st=I*re-B*K,Tt=R*re-B*Q,lt=ue*Tt-ce*st+he*Fe+Ee*Qe-we*ke+je*Me;return lt?(a[0]=(b*Tt-j*st+T*Fe)*(lt=1/lt),a[1]=(h*st-u*Tt-g*Fe)*lt,a[2]=(K*je-Q*we+re*Ee)*lt,a[3]=(R*we-I*je-B*Ee)*lt,a[4]=(j*Qe-x*Tt-T*ke)*lt,a[5]=(i*Tt-h*Qe+g*ke)*lt,a[6]=(Q*he-V*je-re*ce)*lt,a[7]=(A*je-R*he+B*ce)*lt,a[8]=(x*st-b*Qe+T*Me)*lt,a[9]=(u*Qe-i*st-g*Me)*lt,a[10]=(V*we-K*he+re*ue)*lt,a[11]=(I*he-A*we-B*ue)*lt,a[12]=(b*ke-x*Fe-j*Me)*lt,a[13]=(i*Fe-u*ke+h*Me)*lt,a[14]=(K*ce-V*Ee-Q*ue)*lt,a[15]=(A*Ee-I*ce+R*ue)*lt,a):null}function Z(a,t,i){var u=t[0],h=t[1],g=t[2],x=t[3],b=t[4],j=t[5],T=t[6],A=t[7],I=t[8],R=t[9],B=t[10],V=t[11],K=t[12],Q=t[13],re=t[14],ue=t[15],ce=i[0],he=i[1],Ee=i[2],we=i[3];return a[0]=ce*u+he*b+Ee*I+we*K,a[1]=ce*h+he*j+Ee*R+we*Q,a[2]=ce*g+he*T+Ee*B+we*re,a[3]=ce*x+he*A+Ee*V+we*ue,a[4]=(ce=i[4])*u+(he=i[5])*b+(Ee=i[6])*I+(we=i[7])*K,a[5]=ce*h+he*j+Ee*R+we*Q,a[6]=ce*g+he*T+Ee*B+we*re,a[7]=ce*x+he*A+Ee*V+we*ue,a[8]=(ce=i[8])*u+(he=i[9])*b+(Ee=i[10])*I+(we=i[11])*K,a[9]=ce*h+he*j+Ee*R+we*Q,a[10]=ce*g+he*T+Ee*B+we*re,a[11]=ce*x+he*A+Ee*V+we*ue,a[12]=(ce=i[12])*u+(he=i[13])*b+(Ee=i[14])*I+(we=i[15])*K,a[13]=ce*h+he*j+Ee*R+we*Q,a[14]=ce*g+he*T+Ee*B+we*re,a[15]=ce*x+he*A+Ee*V+we*ue,a}function W(a,t,i){var u,h,g,x,b,j,T,A,I,R,B,V,K=i[0],Q=i[1],re=i[2];return t===a?(a[12]=t[0]*K+t[4]*Q+t[8]*re+t[12],a[13]=t[1]*K+t[5]*Q+t[9]*re+t[13],a[14]=t[2]*K+t[6]*Q+t[10]*re+t[14],a[15]=t[3]*K+t[7]*Q+t[11]*re+t[15]):(h=t[1],g=t[2],x=t[3],b=t[4],j=t[5],T=t[6],A=t[7],I=t[8],R=t[9],B=t[10],V=t[11],a[0]=u=t[0],a[1]=h,a[2]=g,a[3]=x,a[4]=b,a[5]=j,a[6]=T,a[7]=A,a[8]=I,a[9]=R,a[10]=B,a[11]=V,a[12]=u*K+b*Q+I*re+t[12],a[13]=h*K+j*Q+R*re+t[13],a[14]=g*K+T*Q+B*re+t[14],a[15]=x*K+A*Q+V*re+t[15]),a}function q(a,t,i){var u=i[0],h=i[1],g=i[2];return a[0]=t[0]*u,a[1]=t[1]*u,a[2]=t[2]*u,a[3]=t[3]*u,a[4]=t[4]*h,a[5]=t[5]*h,a[6]=t[6]*h,a[7]=t[7]*h,a[8]=t[8]*g,a[9]=t[9]*g,a[10]=t[10]*g,a[11]=t[11]*g,a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15],a}function oe(a,t,i){var u=Math.sin(i),h=Math.cos(i),g=t[4],x=t[5],b=t[6],j=t[7],T=t[8],A=t[9],I=t[10],R=t[11];return t!==a&&(a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[3],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[4]=g*h+T*u,a[5]=x*h+A*u,a[6]=b*h+I*u,a[7]=j*h+R*u,a[8]=T*h-g*u,a[9]=A*h-x*u,a[10]=I*h-b*u,a[11]=R*h-j*u,a}function ae(a,t,i){var u=Math.sin(i),h=Math.cos(i),g=t[0],x=t[1],b=t[2],j=t[3],T=t[8],A=t[9],I=t[10],R=t[11];return t!==a&&(a[4]=t[4],a[5]=t[5],a[6]=t[6],a[7]=t[7],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*h-T*u,a[1]=x*h-A*u,a[2]=b*h-I*u,a[3]=j*h-R*u,a[8]=g*u+T*h,a[9]=x*u+A*h,a[10]=b*u+I*h,a[11]=j*u+R*h,a}function Ne(a,t,i){var u=Math.sin(i),h=Math.cos(i),g=t[0],x=t[1],b=t[2],j=t[3],T=t[4],A=t[5],I=t[6],R=t[7];return t!==a&&(a[8]=t[8],a[9]=t[9],a[10]=t[10],a[11]=t[11],a[12]=t[12],a[13]=t[13],a[14]=t[14],a[15]=t[15]),a[0]=g*h+T*u,a[1]=x*h+A*u,a[2]=b*h+I*u,a[3]=j*h+R*u,a[4]=T*h-g*u,a[5]=A*h-x*u,a[6]=I*h-b*u,a[7]=R*h-j*u,a}function Pe(a,t){return a[0]=t[0],a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=t[1],a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=t[2],a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}function Le(a,t,i){var u,h,g,x=i[0],b=i[1],j=i[2],T=Math.hypot(x,b,j);return T<E?null:(x*=T=1/T,b*=T,j*=T,u=Math.sin(t),h=Math.cos(t),a[0]=x*x*(g=1-h)+h,a[1]=b*x*g+j*u,a[2]=j*x*g-b*u,a[3]=0,a[4]=x*b*g-j*u,a[5]=b*b*g+h,a[6]=j*b*g+x*u,a[7]=0,a[8]=x*j*g+b*u,a[9]=b*j*g-x*u,a[10]=j*j*g+h,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a)}function ct(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=i+i,b=u+u,j=h+h,T=i*x,A=u*x,I=u*b,R=h*x,B=h*b,V=h*j,K=g*x,Q=g*b,re=g*j;return a[0]=1-I-V,a[1]=A+re,a[2]=R-Q,a[3]=0,a[4]=A-re,a[5]=1-T-V,a[6]=B+K,a[7]=0,a[8]=R+Q,a[9]=B-K,a[10]=1-T-I,a[11]=0,a[12]=0,a[13]=0,a[14]=0,a[15]=1,a}Math.hypot||(Math.hypot=function(){for(var a=0,t=arguments.length;t--;)a+=arguments[t]*arguments[t];return Math.sqrt(a)});var xt=Z;function yt(){var a=new P(3);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a}function Ht(a){var t=new P(3);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t}function Dt(a){return Math.hypot(a[0],a[1],a[2])}function wt(a,t,i){var u=new P(3);return u[0]=a,u[1]=t,u[2]=i,u}function rs(a,t,i,u){return a[0]=t,a[1]=i,a[2]=u,a}function Vt(a,t,i){return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a[2]=t[2]+i[2],a}function Bt(a,t,i){return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a[2]=t[2]-i[2],a}function ze(a,t,i){return a[0]=t[0]*i[0],a[1]=t[1]*i[1],a[2]=t[2]*i[2],a}function Xe(a,t,i){return a[0]=Math.min(t[0],i[0]),a[1]=Math.min(t[1],i[1]),a[2]=Math.min(t[2],i[2]),a}function Ot(a,t,i){return a[0]=Math.max(t[0],i[0]),a[1]=Math.max(t[1],i[1]),a[2]=Math.max(t[2],i[2]),a}function nt(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a}function Mt(a,t,i,u){return a[0]=t[0]+i[0]*u,a[1]=t[1]+i[1]*u,a[2]=t[2]+i[2]*u,a}function ss(a,t){var i=t[0]-a[0],u=t[1]-a[1],h=t[2]-a[2];return i*i+u*u+h*h}function Ps(a){var t=a[0],i=a[1],u=a[2];return t*t+i*i+u*u}function xn(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a}function Ms(a,t){var i=t[0],u=t[1],h=t[2],g=i*i+u*u+h*h;return g>0&&(g=1/Math.sqrt(g)),a[0]=t[0]*g,a[1]=t[1]*g,a[2]=t[2]*g,a}function Xt(a,t){return a[0]*t[0]+a[1]*t[1]+a[2]*t[2]}function It(a,t,i){var u=t[0],h=t[1],g=t[2],x=i[0],b=i[1],j=i[2];return a[0]=h*j-g*b,a[1]=g*x-u*j,a[2]=u*b-h*x,a}function Ns(a,t,i,u){var h=t[0],g=t[1],x=t[2];return a[0]=h+u*(i[0]-h),a[1]=g+u*(i[1]-g),a[2]=x+u*(i[2]-x),a}function ws(a,t,i){var u=t[0],h=t[1],g=t[2],x=i[3]*u+i[7]*h+i[11]*g+i[15];return a[0]=(i[0]*u+i[4]*h+i[8]*g+i[12])/(x=x||1),a[1]=(i[1]*u+i[5]*h+i[9]*g+i[13])/x,a[2]=(i[2]*u+i[6]*h+i[10]*g+i[14])/x,a}function tn(a,t,i){var u=t[0],h=t[1],g=t[2];return a[0]=u*i[0]+h*i[3]+g*i[6],a[1]=u*i[1]+h*i[4]+g*i[7],a[2]=u*i[2]+h*i[5]+g*i[8],a}function cn(a,t,i){var u=i[0],h=i[1],g=i[2],x=t[0],b=t[1],j=t[2],T=h*j-g*b,A=g*x-u*j,I=u*b-h*x,R=h*I-g*A,B=g*T-u*I,V=u*A-h*T,K=2*i[3];return A*=K,I*=K,B*=2,V*=2,a[0]=x+(T*=K)+(R*=2),a[1]=b+A+B,a[2]=j+I+V,a}function wr(a){return a[0]=0,a[1]=0,a[2]=0,a}function cr(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]}var vn=Bt,Js=ze,Rr=Dt;function Jo(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0,a[3]=0),a}function ao(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a[2]=t[2]*i,a[3]=t[3]*i,a}function lo(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=i*i+u*u+h*h+g*g;return x>0&&(x=1/Math.sqrt(x)),a[0]=i*x,a[1]=u*x,a[2]=h*x,a[3]=g*x,a}function gi(a,t,i){var u=t[0],h=t[1],g=t[2],x=t[3];return a[0]=i[0]*u+i[4]*h+i[8]*g+i[12]*x,a[1]=i[1]*u+i[5]*h+i[9]*g+i[13]*x,a[2]=i[2]*u+i[6]*h+i[10]*g+i[14]*x,a[3]=i[3]*u+i[7]*h+i[11]*g+i[15]*x,a}function va(){var a=new P(4);return P!=Float32Array&&(a[0]=0,a[1]=0,a[2]=0),a[3]=1,a}function Ki(a){return a[0]=0,a[1]=0,a[2]=0,a[3]=1,a}function Rl(a,t,i){i*=.5;var u=t[0],h=t[1],g=t[2],x=t[3],b=Math.sin(i),j=Math.cos(i);return a[0]=u*j+x*b,a[1]=h*j+g*b,a[2]=g*j-h*b,a[3]=x*j-u*b,a}function hc(a,t,i){i*=.5;var u=t[0],h=t[1],g=t[2],x=t[3],b=Math.sin(i),j=Math.cos(i);return a[0]=u*j-g*b,a[1]=h*j+x*b,a[2]=g*j+u*b,a[3]=x*j-h*b,a}yt(),Jo();var kr,xi,du,Ba=lo,Va=(kr=yt(),xi=wt(1,0,0),du=wt(0,1,0),function(a,t,i){var u=Xt(t,i);return u<-.999999?(It(kr,xi,t),Rr(kr)<1e-6&&It(kr,du,t),Ms(kr,kr),function(h,g,x){x*=.5;var b=Math.sin(x);h[0]=b*g[0],h[1]=b*g[1],h[2]=b*g[2],h[3]=Math.cos(x)}(a,kr,Math.PI),a):u>.999999?(a[0]=0,a[1]=0,a[2]=0,a[3]=1,a):(It(kr,t,i),a[0]=kr[0],a[1]=kr[1],a[2]=kr[2],a[3]=1+u,Ba(a,a))});function Pi(){var a=new P(2);return P!=Float32Array&&(a[0]=0,a[1]=0),a}function co(a,t){var i=new P(2);return i[0]=a,i[1]=t,i}function ba(a,t,i){return a[0]=t[0]+i[0],a[1]=t[1]+i[1],a}function uo(a,t,i){return a[0]=t[0]-i[0],a[1]=t[1]-i[1],a}function Ua(a,t,i){return a[0]=t[0]*i,a[1]=t[1]*i,a}function So(a){return Math.hypot(a[0],a[1])}function pc(a,t){var i=t[0],u=t[1],h=i*i+u*u;return h>0&&(h=1/Math.sqrt(h)),a[0]=t[0]*h,a[1]=t[1]*h,a}function sr(a,t){return a[0]*t[0]+a[1]*t[1]}va(),va(),L();var fc,mc,jo=uo;function kl(a){return a&&a.__esModule&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a}Pi();var wa=function(){if(mc)return fc;function a(t,i,u,h){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*i,this.by=3*(h-i)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=i,this.p2x=u,this.p2y=h}return mc=1,fc=a,a.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,i){if(i===void 0&&(i=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,h=0;h<8;h++){var g=this.sampleCurveX(u)-t;if(Math.abs(g)<i)return u;var x=this.sampleCurveDerivativeX(u);if(Math.abs(x)<1e-6)break;u-=g/x}var b=0,j=1;for(u=t,h=0;h<20&&(g=this.sampleCurveX(u),!(Math.abs(g-t)<i));h++)t>g?b=u:j=u,u=.5*(j-b)+b;return u},solve:function(t,i){return this.sampleCurveY(this.solveCurveX(t,i))}},fc}(),gc=kl(wa);function et(a,t){this.x=a,this.y=t}function er(a,t){if(Array.isArray(a)){if(!Array.isArray(t)||a.length!==t.length)return!1;for(let i=0;i<a.length;i++)if(!er(a[i],t[i]))return!1;return!0}if(typeof a=="object"&&a!==null&&t!==null){if(typeof t!="object"||Object.keys(a).length!==Object.keys(t).length)return!1;for(const i in a)if(!er(a[i],t[i]))return!1;return!0}return a===t}et.prototype={clone(){return new et(this.x,this.y)},add(a){return this.clone()._add(a)},sub(a){return this.clone()._sub(a)},multByPoint(a){return this.clone()._multByPoint(a)},divByPoint(a){return this.clone()._divByPoint(a)},mult(a){return this.clone()._mult(a)},div(a){return this.clone()._div(a)},rotate(a){return this.clone()._rotate(a)},rotateAround(a,t){return this.clone()._rotateAround(a,t)},matMult(a){return this.clone()._matMult(a)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(a){return this.x===a.x&&this.y===a.y},dist(a){return Math.sqrt(this.distSqr(a))},distSqr(a){const t=a.x-this.x,i=a.y-this.y;return t*t+i*i},angle(){return Math.atan2(this.y,this.x)},angleTo(a){return Math.atan2(this.y-a.y,this.x-a.x)},angleWith(a){return this.angleWithSep(a.x,a.y)},angleWithSep(a,t){return Math.atan2(this.x*t-this.y*a,this.x*a+this.y*t)},_matMult(a){const t=a[2]*this.x+a[3]*this.y;return this.x=a[0]*this.x+a[1]*this.y,this.y=t,this},_add(a){return this.x+=a.x,this.y+=a.y,this},_sub(a){return this.x-=a.x,this.y-=a.y,this},_mult(a){return this.x*=a,this.y*=a,this},_div(a){return this.x/=a,this.y/=a,this},_multByPoint(a){return this.x*=a.x,this.y*=a.y,this},_divByPoint(a){return this.x/=a.x,this.y/=a.y,this},_unit(){return this._div(this.mag()),this},_perp(){const a=this.y;return this.y=this.x,this.x=-a,this},_rotate(a){const t=Math.cos(a),i=Math.sin(a),u=i*this.x+t*this.y;return this.x=t*this.x-i*this.y,this.y=u,this},_rotateAround(a,t){const i=Math.cos(a),u=Math.sin(a),h=t.y+u*(this.x-t.x)+i*(this.y-t.y);return this.x=t.x+i*(this.x-t.x)-u*(this.y-t.y),this.y=h,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:et},et.convert=function(a){if(a instanceof et)return a;if(Array.isArray(a))return new et(+a[0],+a[1]);if(a.x!==void 0&&a.y!==void 0)return new et(+a.x,+a.y);throw new Error("Expected [x, y] or {x, y} point format")};const Dr=Math.PI/180,Xi=180/Math.PI;function Ks(a){return a*Dr}function Be(a){return a*Xi}const ne=[[0,0],[1,0],[1,1],[0,1]];function ie(a){if(a<=0)return 0;if(a>=1)return 1;const t=a*a,i=t*a;return 4*(a<.5?i:3*(a-t)+i-.75)}function fe(a,t,i,u){const h=new gc(a,t,i,u);return function(g){return h.solve(g)}}const Ce=fe(.25,.1,.25,1);function xe(a,t,i){return Math.min(i,Math.max(t,a))}function Re(a,t,i){return(i=xe((i-a)/(t-a),0,1))*i*(3-2*i)}function qe(a,t,i){const u=i-t,h=((a-t)%u+u)%u+t;return h===t?i:h}function De(a,t,i){if(!a.length)return i(null,[]);let u=a.length;const h=new Array(a.length);let g=null;a.forEach((x,b)=>{t(x,(j,T)=>{j&&(g=j),h[b]=T,--u==0&&i(g,h)})})}function He(a,...t){for(const i of t)for(const u in i)a[u]=i[u];return a}let Et=1;function ut(){return Et++}function hs(a){return a<=1?1:Math.pow(2,Math.ceil(Math.log(a)/Math.LN2))}function Ts(a,t){a.forEach(i=>{t[i]&&(t[i]=t[i].bind(t))})}function Is(a,t,i){const u={};for(const h in a)u[h]=t.call(this,a[h],h,a);return u}function sn(a,t,i){const u={};for(const h in a)t.call(this,a[h],h,a)&&(u[h]=a[h]);return u}function Hs(a){return Array.isArray(a)?a.map(Hs):typeof a=="object"&&a?Is(a,Hs):a}function nn(a,t){for(let i=0;i<a.length;i++)if(t.indexOf(a[i])>=0)return!0;return!1}const Kn={};function rn(a){Kn[a]||(typeof console<"u"&&console.warn(a),Kn[a]=!0)}function Ar(a,t,i){return(i.y-a.y)*(t.x-a.x)>(t.y-a.y)*(i.x-a.x)}function Yr(a){let t=0;for(let i,u,h=0,g=a.length,x=g-1;h<g;x=h++)i=a[h],u=a[x],t+=(u.x-i.x)*(i.y+u.y);return t}function $r([a,t,i]){const u=Ks(t+90),h=Ks(i);return{x:a*Math.cos(u)*Math.sin(h),y:a*Math.sin(u)*Math.sin(h),z:a*Math.cos(h),azimuthal:t,polar:i}}function Ln(a){return(typeof self<"u"||a!==void 0)&&typeof WorkerGlobalScope<"u"&&(a!==void 0?a:self)instanceof WorkerGlobalScope}function bn(a){const t={};if(a.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,(i,u,h,g)=>{const x=h||g;return t[u]=!x||x.toLowerCase(),""}),t["max-age"]){const i=parseInt(t["max-age"],10);isNaN(i)?delete t["max-age"]:t["max-age"]=i}return t}let Nr=null;function vr(a,t){return[a[4*t],a[4*t+1],a[4*t+2],a[4*t+3]]}function fr(a,t,i,u){for(;t<i;){const h=t+i>>1;a[h]<u?t=h+1:i=h}return t}function yi(a,t,i,u){for(;t<i;){const h=t+i>>1;a[h]<=u?t=h+1:i=h}return t}function To(a){return a>0?1/(1.001-a):1+a}function Yi(a){return a>0?1-1/(1.001-a):-a}function Wh(a,t,i){return(a-t.min)*(i.max-i.min)/(t.max-t.min)+i.min}const Ii={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Ii.API_URL)return null;try{const a=new URL(Ii.API_URL);return a.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":a.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.1.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function xc(a){return Ii.API_URL_REGEX.test(a)}function zf(a){return Ii.API_SPRITE_REGEX.test(a)}let qh,Zh,Of,Ff,hu,Kh;function Bf(){return qh==null&&(qh=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),qh}const $a={now:()=>Ff!==void 0?Ff:performance.now(),setNow(a){Ff=a},restoreNow(){Ff=void 0},frame(a){const t=requestAnimationFrame(a);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(a,t=0){const{width:i,height:u}=a;hu||(hu=document.createElement("canvas"));const h=hu.getContext("2d",{willReadFrequently:!0});if(!h)throw new Error("failed to create canvas 2d context");return(i>hu.width||u>hu.height)&&(hu.width=i,hu.height=u),h.clearRect(-t,-t,i+2*t,u+2*t),h.drawImage(a,0,0,i,u),h.getImageData(-t,-t,i+2*t,u+2*t)},resolveURL:a=>(Zh||(Zh=document.createElement("a")),Zh.href=a,Zh.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Of==null&&(Of=window.matchMedia("(prefers-reduced-motion: reduce)")),Of.matches)},hasCanvasFingerprintNoise(){if(Kh!==void 0)return Kh;if(!Bf())return Kh=!1,!1;const a=new OffscreenCanvas(85,1),t=a.getContext("2d",{willReadFrequently:!0});let i=0;for(let h=0;h<a.width;++h)t.fillStyle=`rgba(${i++},${i++},${i++}, 255)`,t.fillRect(h,0,1,1);const u=t.getImageData(0,0,a.width,a.height);i=0;for(let h=0;h<u.data.length;++h)if(h%4!=3&&i++!==u.data[h])return Kh=!0,!0;return Kh=!1,!1}};function Qo(a,t){const i=a.indexOf("?");if(i<0)return`${a}?${new URLSearchParams(t).toString()}`;const u=new URLSearchParams(a.slice(i));for(const h in t)u.set(h,t[h]);return`${a.slice(0,i)}?${u.toString()}`}function Sa(a,t={persistentParams:[]}){const i=a.indexOf("?");if(i<0)return a;const u=new URLSearchParams,h=new URLSearchParams(a.slice(i));for(const x of t.persistentParams){const b=h.get(x);b&&u.set(x,b)}const g=u.toString();return`${a.slice(0,i)}${g.length>0?`?${g}`:""}`}const Dl="mapbox-tiles";let Ga=500,Ll=50;const Xh=["language","worldview","jobid"];let hl,Yh;function pu(){try{return caches}catch{}}function ad(){const a=pu();a&&hl==null&&(hl=a.open(Dl))}let Mx=1/0;const Rx={supported:!1,testSupport:function(a){!Jh&&fu&&(ld?vv(a):No=a)}};let No,fu,Jh=!1,ld=!1;const _v=typeof self<"u"?self:{};function vv(a){const t=a.createTexture();a.bindTexture(a.TEXTURE_2D,t);try{if(a.texImage2D(a.TEXTURE_2D,0,a.RGBA,a.RGBA,a.UNSIGNED_BYTE,fu),a.isContextLost())return;Rx.supported=!0}catch{}a.deleteTexture(t),Jh=!0}_v.document&&(fu=_v.document.createElement("img"),fu.onload=function(){No&&vv(No),No=null,ld=!0},fu.onerror=function(){Jh=!0,No=null},fu.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Qh={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Qh);class hn extends Error{constructor(t,i,u){i===401&&xc(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=i,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const Vf=Ln()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,cd=function(a,t){if(!(/^file:/.test(i=a.url)||/^file:/.test(Vf())&&!/^\w+:/.test(i))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return function(u,h){const g=new AbortController,x=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:Vf(),referrerPolicy:u.referrerPolicy,signal:g.signal});let b=!1,j=!1;const T=(A=x.url).indexOf("sku=")>0&&xc(A);var A;u.type==="json"&&x.headers.set("Accept","application/json");const I=(B,V,K)=>{if(j)return;if(B&&B.message!=="SecurityError"&&rn(B.toString()),V&&K)return R(V);const Q=Date.now();fetch(x).then(re=>{if(re.ok){const ue=T?re.clone():null;return R(re,ue,Q)}return h(new hn(re.statusText,re.status,u.url))}).catch(re=>{re.name!=="AbortError"&&h(new Error(`${re.message} ${u.url}`))})},R=(B,V,K)=>{(u.type==="arrayBuffer"?B.arrayBuffer():u.type==="json"?B.json():B.text()).then(Q=>{j||(V&&K&&function(re,ue,ce){if(ad(),hl==null)return;const he=bn(ue.headers.get("Cache-Control")||"");if(he["no-store"])return;const Ee={status:ue.status,statusText:ue.statusText,headers:new Headers};ue.headers.forEach((Me,ke)=>Ee.headers.set(ke,Me)),he["max-age"]&&Ee.headers.set("Expires",new Date(ce+1e3*he["max-age"]).toUTCString());const we=Ee.headers.get("Expires");if(!we||new Date(we).getTime()-ce<42e4)return;let je=Sa(re.url,{persistentParams:Xh});if(ue.status===206){const Me=re.headers.get("Range");if(!Me)return;Ee.status=200,je=Qo(je,{range:Me})}(function(Me,ke){if(Yh===void 0)try{new Response(new ReadableStream),Yh=!0}catch{Yh=!1}Yh?ke(Me.body):Me.blob().then(ke).catch(Qe=>rn(Qe.message))})(ue,Me=>{const ke=new Response((Qe=ue.status)!==200&&Qe!==404&&[101,103,204,205,304].includes(Qe)?null:Me,Ee);var Qe;ad(),hl!=null&&hl.then(Fe=>Fe.put(je,ke)).catch(Fe=>rn(Fe.message))})}(x,V,K),b=!0,h(null,Q,B.headers.get("Cache-Control"),B.headers.get("Expires")))}).catch(Q=>{j||h(new Error(Q.message))})};return T?function(B,V){if(ad(),hl==null)return V(null);hl.then(K=>{let Q=Sa(B.url,{persistentParams:Xh});const re=B.headers.get("Range");re&&(Q=Qo(Q,{range:re})),K.match(Q).then(ue=>{const ce=function(he){if(!he)return!1;const Ee=new Date(he.headers.get("Expires")||0),we=bn(he.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!we["no-cache"]}(ue);K.delete(Q).catch(V),ce&&K.put(Q,ue.clone()).catch(V),V(null,ue,ce)}).catch(V)}).catch(V)}(x,I):I(null,null),{cancel:()=>{j=!0,b||g.abort()}}}(a,t);if(Ln(self)&&self.worker.actor)return self.worker.actor.send("getResource",a,t,void 0,!0)}var i;return function(u,h){const g=new XMLHttpRequest;g.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(g.responseType="arraybuffer");for(const x in u.headers)g.setRequestHeader(x,u.headers[x]);return u.type==="json"&&(g.responseType="text",g.setRequestHeader("Accept","application/json")),g.withCredentials=u.credentials==="include",g.onerror=()=>{h(new Error(g.statusText))},g.onload=()=>{if((g.status>=200&&g.status<300||g.status===0)&&g.response!==null){let x=g.response;if(u.type==="json")try{x=JSON.parse(g.response)}catch(b){return h(b)}h(null,x,g.getResponseHeader("Cache-Control"),g.getResponseHeader("Expires"))}else h(new hn(g.statusText,g.status,u.url))},g.send(u.body),{cancel:()=>g.abort()}}(a,t)},ep=function(a,t){return cd(He(a,{type:"arrayBuffer"}),t)};function jS(a){const t=document.createElement("a");return t.href=a,t.protocol===location.protocol&&t.host===location.host}const tp="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let mu,yc;mu=[],yc=0;const sp=function(a,t){if(Rx.supported&&(a.headers||(a.headers={}),a.headers.accept="image/webp,*/*"),yc>=Ii.MAX_PARALLEL_IMAGE_REQUESTS){const g={requestParameters:a,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return mu.push(g),g}yc++;let i=!1;const u=()=>{if(!i)for(i=!0,yc--;mu.length&&yc<Ii.MAX_PARALLEL_IMAGE_REQUESTS;){const g=mu.shift(),{requestParameters:x,callback:b,cancelled:j}=g;j||(g.cancel=sp(x,b).cancel)}},h=ep(a,(g,x,b,j)=>{u(),g?t(g):x&&(self.createImageBitmap?function(T,A){const I=new Blob([new Uint8Array(T)],{type:"image/png"});createImageBitmap(I).then(R=>{A(null,R)}).catch(R=>{A(new Error(`Could not load image because of ${R.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))})}(x,(T,A)=>t(T,A,b,j)):function(T,A){const I=new Image;I.onload=()=>{A(null,I),URL.revokeObjectURL(I.src),I.onload=null,requestAnimationFrame(()=>{I.src=tp})},I.onerror=()=>A(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const R=new Blob([new Uint8Array(T)],{type:"image/png"});I.src=T.byteLength?URL.createObjectURL(R):tp}(x,(T,A)=>t(T,A,b,j)))});return{cancel:()=>{h.cancel(),u()}}};var bv,Uf,wv,ud={exports:{}},gu={exports:{}},Sv={exports:{}},np=function(){if(wv)return ud.exports;wv=1;var a=(bv||(bv=1,gu.exports=function(i,u){var h,g,x,b,j,T,A,I;for(g=i.length-(h=3&i.length),x=u,j=3432918353,T=461845907,I=0;I<g;)A=255&i.charCodeAt(I)|(255&i.charCodeAt(++I))<<8|(255&i.charCodeAt(++I))<<16|(255&i.charCodeAt(++I))<<24,++I,x=27492+(65535&(b=5*(65535&(x=(x^=A=(65535&(A=(A=(65535&A)*j+(((A>>>16)*j&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295)<<13|x>>>19))+((5*(x>>>16)&65535)<<16)&4294967295))+((58964+(b>>>16)&65535)<<16);switch(A=0,h){case 3:A^=(255&i.charCodeAt(I+2))<<16;case 2:A^=(255&i.charCodeAt(I+1))<<8;case 1:x^=A=(65535&(A=(A=(65535&(A^=255&i.charCodeAt(I)))*j+(((A>>>16)*j&65535)<<16)&4294967295)<<15|A>>>17))*T+(((A>>>16)*T&65535)<<16)&4294967295}return x^=i.length,x=2246822507*(65535&(x^=x>>>16))+((2246822507*(x>>>16)&65535)<<16)&4294967295,x=3266489909*(65535&(x^=x>>>13))+((3266489909*(x>>>16)&65535)<<16)&4294967295,(x^=x>>>16)>>>0}),gu.exports),t=(Uf||(Uf=1,Sv.exports=function(i,u){for(var h,g=i.length,x=u^g,b=0;g>=4;)h=1540483477*(65535&(h=255&i.charCodeAt(b)|(255&i.charCodeAt(++b))<<8|(255&i.charCodeAt(++b))<<16|(255&i.charCodeAt(++b))<<24))+((1540483477*(h>>>16)&65535)<<16),x=1540483477*(65535&x)+((1540483477*(x>>>16)&65535)<<16)^(h=1540483477*(65535&(h^=h>>>24))+((1540483477*(h>>>16)&65535)<<16)),g-=4,++b;switch(g){case 3:x^=(255&i.charCodeAt(b+2))<<16;case 2:x^=(255&i.charCodeAt(b+1))<<8;case 1:x=1540483477*(65535&(x^=255&i.charCodeAt(b)))+((1540483477*(x>>>16)&65535)<<16)}return x=1540483477*(65535&(x^=x>>>13))+((1540483477*(x>>>16)&65535)<<16),(x^=x>>>15)>>>0}),Sv.exports);return ud.exports=a,ud.exports.murmur3=a,ud.exports.murmur2=t,ud.exports}(),dd=kl(np);class zl{constructor(t,...i){He(this,i[0]||{}),this.type=t}}class ea extends zl{constructor(t,i={}){super("error",He({error:t},i))}}function kx(a,t,i){i[a]&&i[a].indexOf(t)!==-1||(i[a]=i[a]||[],i[a].push(t))}function Dx(a,t,i){if(i&&i[a]){const u=i[a].indexOf(t);u!==-1&&i[a].splice(u,1)}}class xu{on(t,i){return this._listeners=this._listeners||{},kx(t,i,this._listeners),this}off(t,i){return Dx(t,i,this._listeners),Dx(t,i,this._oneTimeListeners),this}once(t,i){return i?(this._oneTimeListeners=this._oneTimeListeners||{},kx(t,i,this._oneTimeListeners),this):new Promise(u=>{this.once(t,u)})}fire(t,i){const u=typeof t=="string"?new zl(t,i):t,h=u.type;if(this.listens(h)){u.target=this;const g=this._listeners&&this._listeners[h]?this._listeners[h].slice():[];for(const j of g)j.call(this,u);const x=this._oneTimeListeners&&this._oneTimeListeners[h]?this._oneTimeListeners[h].slice():[];for(const j of x)Dx(h,j,this._oneTimeListeners),j.call(this,u);const b=this._eventedParent;b&&(He(u,typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData),b.fire(u))}else u instanceof ea&&console.error(u.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,i){return this._eventedParent=t,this._eventedParentData=i,this}}class Do{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new Do(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[i,u]=t.split("");return new Do({name:i,iconsetId:u})}static isEqual(t,i){return t.name===i.name&&t.iconsetId===i.iconsetId}toString(){return Do.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var Lx,$f={},zx=function(){if(Lx)return $f;Lx=1;var a={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(g){return(g=Math.round(g))<0?0:g>255?255:g}function i(g){return t(g[g.length-1]==="%"?parseFloat(g)/100*255:parseInt(g))}function u(g){return(x=g[g.length-1]==="%"?parseFloat(g)/100:parseFloat(g))<0?0:x>1?1:x;var x}function h(g,x,b){return b<0?b+=1:b>1&&(b-=1),6*b<1?g+(x-g)*b*6:2*b<1?x:3*b<2?g+(x-g)*(2/3-b)*6:g}try{$f.parseCSSColor=function(g){var x,b=g.replace(/ /g,"").toLowerCase();if(b in a)return a[b].slice();if(b[0]==="#")return b.length===4?(x=parseInt(b.substr(1),16))>=0&&x<=4095?[(3840&x)>>4|(3840&x)>>8,240&x|(240&x)>>4,15&x|(15&x)<<4,1]:null:b.length===7&&(x=parseInt(b.substr(1),16))>=0&&x<=16777215?[(16711680&x)>>16,(65280&x)>>8,255&x,1]:null;var j=b.indexOf("("),T=b.indexOf(")");if(j!==-1&&T+1===b.length){var A=b.substr(0,j),I=b.substr(j+1,T-(j+1)).split(","),R=1;switch(A){case"rgba":if(I.length!==4)return null;R=u(I.pop());case"rgb":return I.length!==3?null:[i(I[0]),i(I[1]),i(I[2]),R];case"hsla":if(I.length!==4)return null;R=u(I.pop());case"hsl":if(I.length!==3)return null;var B=(parseFloat(I[0])%360+360)%360/360,V=u(I[1]),K=u(I[2]),Q=K<=.5?K*(V+1):K+V-K*V,re=2*K-Q;return[t(255*h(re,Q,B+1/3)),t(255*h(re,Q,B)),t(255*h(re,Q,B-1/3)),R];default:return null}}return null}}catch{}return $f}();class En{constructor(t,i,u,h=1){this.r=t,this.g=i,this.b=u,this.a=h}static parse(t){if(!t)return;if(t instanceof En)return t;if(typeof t!="string")return;const i=zx.parseCSSColor(t);return i?new En(i[0]/255,i[1]/255,i[2]/255,i[3]):void 0}toString(){const[t,i,u,h]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*i)},${Math.round(255*u)},${h})`}toNonPremultipliedRenderColor(t){const{r:i,g:u,b:h,a:g}=this;return new hd(t,i,u,h,g)}toPremultipliedRenderColor(t){const{r:i,g:u,b:h,a:g}=this;return new jv(t,i*g,u*g,h*g,g)}clone(){return new En(this.r,this.g,this.b,this.a)}}class rp{constructor(t,i,u,h,g,x=!1){if(this.premultiplied=!1,this.premultiplied=x,t){const b=t.image.height,j=b*b;this.premultiplied?(i=g===0?0:i/g*(b-1),u=g===0?0:u/g*(b-1),h=g===0?0:h/g*(b-1)):(i*=b-1,u*=b-1,h*=b-1);const T=Math.floor(i),A=Math.floor(u),I=Math.floor(h),R=Math.ceil(i),B=Math.ceil(u),V=Math.ceil(h),K=i-T,Q=u-A,re=h-I,ue=t.image.data,ce=4*(T+A*j+I*b),he=4*(T+A*j+V*b),Ee=4*(T+B*j+I*b),we=4*(T+B*j+V*b),je=4*(R+A*j+I*b),Me=4*(R+A*j+V*b),ke=4*(R+B*j+I*b),Qe=4*(R+B*j+V*b);if(ce<0||Qe>=ue.length)throw new Error("out of range");this.r=fs(fs(fs(ue[ce],ue[he],re),fs(ue[Ee],ue[we],re),Q),fs(fs(ue[je],ue[Me],re),fs(ue[ke],ue[Qe],re),Q),K)/255*(this.premultiplied?g:1),this.g=fs(fs(fs(ue[ce+1],ue[he+1],re),fs(ue[Ee+1],ue[we+1],re),Q),fs(fs(ue[je+1],ue[Me+1],re),fs(ue[ke+1],ue[Qe+1],re),Q),K)/255*(this.premultiplied?g:1),this.b=fs(fs(fs(ue[ce+2],ue[he+2],re),fs(ue[Ee+2],ue[we+2],re),Q),fs(fs(ue[je+2],ue[Me+2],re),fs(ue[ke+2],ue[Qe+2],re),Q),K)/255*(this.premultiplied?g:1),this.a=g}else this.r=i,this.g=u,this.b=h,this.a=g}toArray(){const{r:t,g:i,b:u,a:h}=this;return[255*t,255*i,255*u,h]}toHslaArray(){let{r:t,g:i,b:u,a:h}=this;if(this.premultiplied){if(h===0)return[0,0,0,0];t/=h,i/=h,u/=h}const g=Math.min(Math.max(t,0),1),x=Math.min(Math.max(i,0),1),b=Math.min(Math.max(u,0),1),j=Math.min(g,x,b),T=Math.max(g,x,b),A=(j+T)/2;if(j===T)return[0,0,100*A,h];const I=T-j,R=A>.5?I/(2-T-j):I/(T+j);let B=0;return T===g?B=(x-b)/I+(x<b?6:0):T===x?B=(b-g)/I+2:T===b&&(B=(g-x)/I+4),B*=60,[Math.min(Math.max(B,0),360),Math.min(Math.max(100*R,0),100),Math.min(Math.max(100*A,0),100),h]}toArray01(){const{r:t,g:i,b:u,a:h}=this;return[t,i,u,h]}toArray01Scaled(t){const{r:i,g:u,b:h}=this;return[i*t,u*t,h*t]}toArray01Linear(){const{r:t,g:i,b:u,a:h}=this;return[Math.pow(t,2.2),Math.pow(i,2.2),Math.pow(u,2.2),h]}}class hd extends rp{constructor(t,i,u,h,g){super(t,i,u,h,g,!1)}}class jv extends rp{constructor(t,i,u,h,g){super(t,i,u,h,g,!0)}}function fs(a,t,i){return a*(1-i)+t*i}function Tv(a,t,i){return a.map((u,h)=>fs(u,t[h],i))}En.black=new En(0,0,0,1),En.white=new En(1,1,1,1),En.transparent=new En(0,0,0,0),En.red=new En(1,0,0,1),En.blue=new En(0,0,1,1);var ip=Object.freeze({__proto__:null,array:Tv,color:function(a,t,i){return new En(fs(a.r,t.r,i),fs(a.g,t.g,i),fs(a.b,t.b,i),fs(a.a,t.a,i))},number:fs});function yu(a,...t){for(const i of t)for(const u in i)a[u]=i[u];return a}class ta extends Error{constructor(t,i){super(i),this.message=i,this.key=t}}class Ox{constructor(t,i=[]){this.parent=t,this.bindings={};for(const[u,h]of i)this.bindings[u]=h}concat(t){return new Ox(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const pd={kind:"null"},cs={kind:"number"},jn={kind:"string"},Tn={kind:"boolean"},Lo={kind:"color"},Ol={kind:"object"},Cn={kind:"value"},Gf={kind:"collator"},op={kind:"formatted"},ap={kind:"resolvedImage"};function Ji(a,t){return{kind:"array",itemType:a,N:t}}function Gr(a){if(a.kind==="array"){const t=Gr(a.itemType);return typeof a.N=="number"?`array<${t}, ${a.N}>`:a.itemType.kind==="value"?"array":`array<${t}>`}return a.kind}const TS=[pd,cs,jn,Tn,Lo,op,Ol,Ji(Cn),ap];function fd(a,t){if(t.kind==="error")return null;if(a.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!fd(a.itemType,t.itemType))&&(typeof a.N!="number"||a.N===t.N))return null}else{if(a.kind===t.kind)return null;if(a.kind==="value"){for(const i of TS)if(!fd(i,t))return null}}return`Expected ${Gr(a)} but found ${Gr(t)} instead.`}function _c(a,t){return t.some(i=>i.kind===a.kind)}function lp(a,t){return t.some(i=>i==="null"?a===null:i==="array"?Array.isArray(a):i==="object"?a&&!Array.isArray(a)&&typeof a=="object":i===typeof a)}function Hf(a,t){return a.kind==="array"&&t.kind==="array"?a.N===t.N&&Hf(a.itemType,t.itemType):a.kind===t.kind}class cp{constructor(t,i,u){this.sensitivity=t?i?"variant":"case":i?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,i){return this.collator.compare(t,i)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class Wf{constructor(t,i,u,h,g){this.text=t.normalize?t.normalize():t,this.image=i,this.scale=u,this.fontStack=h,this.textColor=g}}class ho{constructor(t){this.sections=t}static fromString(t){return new ho([new Wf(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some(t=>t.text.length!==0||!!t.image&&t.image.hasPrimary())}static factory(t){return t instanceof ho?t:ho.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map(t=>t.text).join("")}serialize(){const t=["format"];for(const i of this.sections){if(i.image){const h=i.image.getPrimary().id.toString();t.push(["image",h]);continue}t.push(i.text);const u={};i.fontStack&&(u["text-font"]=["literal",i.fontStack.split(",")]),i.scale&&(u["font-scale"]=i.scale),i.textColor&&(u["text-color"]=["rgba"].concat(i.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(u)}return t}}class Fl{constructor(t,i={}){if(this.id=Do.from(t),this.options=Object.assign({},i),i.transform){const{a:u,b:h,c:g,d:x,e:b,f:j}=i.transform;this.options.transform=new DOMMatrix([u,h,g,x,b,j])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:t,b:i,c:u,d:h,e:g,f:x}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:t,b:i,c:u,d:h,e:g,f:x}})}static parse(t){let i,u,h,g;try{({name:i,iconsetId:u,params:h,transform:g}=JSON.parse(t)||{})}catch{return null}if(!i)return null;const{a:x,b,c:j,d:T,e:A,f:I}=g||{};return new Fl({name:i,iconsetId:u},{params:h,transform:new DOMMatrix([x,b,j,T,A,I])})}scaleSelf(t,i){return this.options.transform.scaleSelf(t,i),this}}class Eo{constructor(t,i,u,h,g=!1){this.primaryId=Do.from(t),this.primaryOptions=i,u&&(this.secondaryId=Do.from(u)),this.secondaryOptions=h,this.available=g}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Fl(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Fl(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?Eo.build({name:t}):t}static build(t,i,u,h){return!t||typeof t=="object"&&!("name"in t)?null:new Eo(t,u,i,h)}}function _u(a,t,i,u){return typeof a=="number"&&a>=0&&a<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof i=="number"&&i>=0&&i<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[a,t,i,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[a,t,i,u]:[a,t,i]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Fs(a){if(a===null||typeof a=="string"||typeof a=="boolean"||typeof a=="number"||a instanceof En||a instanceof cp||a instanceof ho||a instanceof Eo)return!0;if(Array.isArray(a)){for(const t of a)if(!Fs(t))return!1;return!0}if(typeof a=="object"){for(const t in a)if(!Fs(a[t]))return!1;return!0}return!1}function Kt(a){if(a===null)return pd;if(typeof a=="string")return jn;if(typeof a=="boolean")return Tn;if(typeof a=="number")return cs;if(a instanceof En)return Lo;if(a instanceof cp)return Gf;if(a instanceof ho)return op;if(a instanceof Eo)return ap;if(Array.isArray(a)){const t=a.length;let i;for(const u of a){const h=Kt(u);if(i){if(i===h)continue;i=Cn;break}i=h}return Ji(i||Cn,t)}return Ol}function ja(a){const t=typeof a;return a===null?"":t==="string"||t==="number"||t==="boolean"?String(a):a instanceof ho||a instanceof Eo||a instanceof En?a.toString():JSON.stringify(a)}class Ss{constructor(t,i){this.type=t,this.value=i}static parse(t,i){if(t.length!==2)return i.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Fs(t[1]))return i.error("invalid value");const u=t[1];let h=Kt(u);const g=i.expectedType;return h.kind!=="array"||h.N!==0||!g||g.kind!=="array"||typeof g.N=="number"&&g.N!==0||(h=g),new Ss(h,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof En?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof ho?this.value.serialize():this.value}}class Vr{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const up={string:jn,number:cs,boolean:Tn,object:Ol};class gs{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");let u,h=1;const g=t[0];if(g==="array"){let b,j;if(t.length>2){const T=t[1];if(typeof T!="string"||!(T in up)||T==="object")return i.error('The item type argument of "array" must be one of string, number, boolean',1);b=up[T],h++}else b=Cn;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return i.error('The length argument to "array" must be a positive integer literal',2);j=t[2],h++}u=Ji(b,j)}else u=up[g];const x=[];for(;h<t.length;h++){const b=i.parse(t[h],h,Cn);if(!b)return null;x.push(b)}return new gs(u,x)}evaluate(t){for(let i=0;i<this.args.length;i++){const u=this.args[i].evaluate(t);if(!fd(this.type,Kt(u)))return u;if(i===this.args.length-1)throw new Vr(`The expression ${JSON.stringify(this.args[i].serialize())} evaluated to ${Gr(Kt(u))} but was expected to be of type ${Gr(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=this.type,i=[t.kind];if(t.kind==="array"){const u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){i.push(u.kind);const h=t.N;(typeof h=="number"||this.args.length>1)&&i.push(h)}}return i.concat(this.args.map(u=>u.serialize()))}}class md{constructor(t){this.type=op,this.sections=t}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return i.error("First argument must be an image or text section.");const h=[];let g=!1;for(let x=1;x<=t.length-1;++x){const b=t[x];if(g&&typeof b=="object"&&!Array.isArray(b)){g=!1;let j=null;if(b["font-scale"]&&(j=i.parseObjectValue(b["font-scale"],x,"font-scale",cs),!j))return null;let T=null;if(b["text-font"]&&(T=i.parseObjectValue(b["text-font"],x,"text-font",Ji(jn)),!T))return null;let A=null;if(b["text-color"]&&(A=i.parseObjectValue(b["text-color"],x,"text-color",Lo),!A))return null;const I=h[h.length-1];I.scale=j,I.font=T,I.textColor=A}else{const j=i.parse(t[x],x,Cn);if(!j)return null;const T=j.type.kind;if(T!=="string"&&T!=="value"&&T!=="null"&&T!=="resolvedImage")return i.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");g=!0,h.push({content:j,scale:null,font:null,textColor:null})}}return new md(h)}evaluate(t){return new ho(this.sections.map(i=>{const u=i.content.evaluate(t);return Hf(Kt(u),ap)?new Wf("",u,null,null,null):new Wf(ja(u),null,i.scale?i.scale.evaluate(t):null,i.font?i.font.evaluate(t).join(","):null,i.textColor?i.textColor.evaluate(t):null)}))}eachChild(t){for(const i of this.sections)t(i.content),i.scale&&t(i.scale),i.font&&t(i.font),i.textColor&&t(i.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const i of this.sections){t.push(i.content.serialize());const u={};i.scale&&(u["font-scale"]=i.scale.serialize()),i.font&&(u["text-font"]=i.font.serialize()),i.textColor&&(u["text-color"]=i.textColor.serialize()),t.push(u)}return t}}class gd{constructor(t,i,u,h){this._imageWarnHistory={},this.type=ap,this.namePrimary=t,this.nameSecondary=i,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),h&&(this.paramsSecondary=h.params,this.iconsetIdSecondary=h.iconset?h.iconset.id:void 0)}static parse(t,i){if(t.length<2)return i.error("Expected two or more arguments.");let u=1;const h=[];function g(){if(u<t.length){const b=i.parse(t[u],u++,jn);return b?(h.push({image:b,options:{}}),!0):(i.error(h.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function x(){if(u<t.length){const j=t[u];if((b=j)===null||typeof b!="object"||Array.isArray(b))return!0;const T=j.params,A=j.iconset,I=i.concat(u);if(!T&&!A)return u++,!0;if(T){if(typeof T!="object"||T.constructor!==Object)return I.error('Image options "params" should be an object'),!1;const R={},B=I.concat(void 0,"params");for(const V in T){if(!V)return B.error("Image parameter name should be non-empty"),!1;const K=B.concat(void 0,V).parse(T[V],void 0,Lo,void 0,{typeAnnotation:"coerce"});if(!K)return!1;R[V]=K}h[h.length-1].options.params=R}if(A){if(typeof A!="object"||A.constructor!==Object)return I.error('Image options "iconset" should be an object'),!1;if(!A.id)return I.error('Image options "iconset" should have an "id" property'),!1;h[h.length-1].options.iconset=A}return u++,!0}var b;return!0}for(let b=0;b<2;b++)if(!g()||!x())return;return new gd(h[0].image,h[1]?h[1].image:void 0,h[0].options,h[1]?h[1].options:void 0)}evaluateParams(t,i){const u={};if(i){for(const h in i)if(i[h])try{u[h]=i[h].evaluate(t)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(t){const i={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,h=Eo.build(i,u,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(h&&t.availableImages){const g=h.getPrimary().id;if(h.available=t.availableImages.some(x=>Do.isEqual(x,g)),h.available){const x=h.getSecondary()?h.getSecondary().id:null;x&&(h.available=t.availableImages.some(b=>Do.isEqual(b,x)))}}return h}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const i in this.paramsPrimary)this.paramsPrimary[i]&&t(this.paramsPrimary[i]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const i in this.paramsSecondary)this.paramsSecondary[i]&&t(this.paramsSecondary[i])}outputDefined(){return!1}serializeOptions(t,i){const u={};if(i&&(u.iconset={id:i}),t){u.params={};for(const h in t)t[h]&&(u.params[h]=t[h].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const i=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);i&&t.push(i)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const i=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);i&&t.push(i)}return t}}function vc(a){return a instanceof Number?"number":a instanceof String?"string":a instanceof Boolean?"boolean":Array.isArray(a)?"array":a===null?"null":typeof a}const Nv={"to-boolean":Tn,"to-color":Lo,"to-number":cs,"to-string":jn};class Ta{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expected at least one argument.");const u=t[0],h=[];let g=pd;if(u==="to-array"){if(!Array.isArray(t[1]))return null;const x=t[1].length;if(i.expectedType){if(i.expectedType.kind!=="array")return i.error(`Expected ${i.expectedType.kind} but found array.`);g=Ji(i.expectedType.itemType,x)}else{if(!(x>0&&Fs(t[1][0])))return null;g=Ji(Kt(t[1][0]),x)}for(let b=0;b<x;b++){const j=t[1][b];let T;if(vc(j)==="array")T=i.parse(j,void 0,g.itemType);else{const A=vc(j);if(A!==g.itemType.kind)return i.error(`Expected ${g.itemType.kind} but found ${A}.`);T=i.registry.literal.parse(["literal",j===void 0?null:j],i)}if(!T)return null;h.push(T)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return i.error("Expected one argument.");g=Nv[u];for(let x=1;x<t.length;x++){const b=i.parse(t[x],x,Cn);if(!b)return null;h.push(b)}}return new Ta(g,h)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let i,u;for(const h of this.args){if(i=h.evaluate(t),u=null,i instanceof En)return i;if(typeof i=="string"){const g=t.parseColor(i);if(g)return g}else if(Array.isArray(i)&&(u=i.length<3||i.length>4?`Invalid rbga value ${JSON.stringify(i)}: expected an array containing either three or four numeric values.`:_u(i[0],i[1],i[2],i[3]),!u))return new En(i[0]/255,i[1]/255,i[2]/255,i[3])}throw new Vr(u||`Could not parse color from value '${typeof i=="string"?i:String(JSON.stringify(i))}'`)}if(this.type.kind==="number"){let i=null;for(const u of this.args){if(i=u.evaluate(t),i===null)return 0;const h=Number(i);if(!isNaN(h))return h}throw new Vr(`Could not convert ${JSON.stringify(i)} to number.`)}return this.type.kind==="formatted"?ho.fromString(ja(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?Eo.build(ja(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map(i=>i.evaluate(t)):ja(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){if(this.type.kind==="formatted")return new md([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new gd(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild(i=>{t.push(i.serialize())}),t}}const po=["Unknown","Point","LineString","Polygon"];class dp{constructor(t,i){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=i}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?po[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,i=this.featureDistanceData.scale,{x:u,y:h}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*i-t[0])+this.featureDistanceData.bearing[1]*(h*i-t[1])}return 0}parseColor(t){let i=this._parseColorCache[t];return i||(i=this._parseColorCache[t]=En.parse(t)),i}getConfig(t){return this.options?this.options.get(t):null}}class _i{constructor(t,i,u,h,g){this.name=t,this.type=i,this._evaluate=u,this.args=h,this._overloadIndex=g}evaluate(t){if(!this._evaluate){const i=_i.definitions[this.name];this._evaluate=Array.isArray(i)?i[2]:i.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map(t=>t.serialize()))}static parse(t,i){const u=t[0],h=_i.definitions[u];if(!h)return i.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const g=Array.isArray(h)?h[0]:h.type,x=Array.isArray(h)?[[h[1],h[2]]]:h.overloads,b=[];let j=null,T=-1;for(const[A,I]of x){if(Array.isArray(A)&&A.length!==t.length-1)continue;b.push(A),T++,j=new im(i.registry,i.path,null,i.scope,void 0,i._scope,i.options);const R=[];let B=!1;for(let V=1;V<t.length;V++){const K=t[V],Q=Array.isArray(A)?A[V-1]:A.type,re=j.parse(K,1+R.length,Q);if(!re){B=!0;break}R.push(re)}if(!B)if(Array.isArray(A)&&A.length!==R.length)j.error(`Expected ${A.length} arguments, but found ${R.length} instead.`);else{for(let V=0;V<R.length;V++){const K=Array.isArray(A)?A[V]:A.type,Q=R[V];j.concat(V+1).checkSubtype(K,Q.type)}if(j.errors.length===0)return new _i(u,g,I,R,T)}}if(b.length===1)i.errors.push(...j.errors);else{const A=(b.length?b:x.map(([R])=>R)).map(Fx).join(" | "),I=[];for(let R=1;R<t.length;R++){const B=i.parse(t[R],1+I.length);if(!B)return null;I.push(Gr(B.type))}i.error(`Expected arguments of type ${A}, but found (${I.join(", ")}) instead.`)}return null}static register(t,i){_i.definitions=i;for(const u in i)t[u]=_i}}function Fx(a){return Array.isArray(a)?`(${a.map(Gr).join(", ")})`:`(${Gr(a.type)}...)`}class pl{constructor(t,i,u){this.type=Gf,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=i}static parse(t,i){if(t.length!==2)return i.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return i.error("Collator options argument must be an object.");const h=u["case-sensitive"]===void 0?i.parse(!1,1,Tn):i.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Tn);if(!h)return null;const g=u["diacritic-sensitive"]===void 0?i.parse(!1,1,Tn):i.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Tn);if(!g)return null;let x=null;return u.locale&&(x=i.parseObjectValue(u.locale,1,"locale",jn),!x)?null:new pl(h,g,x)}evaluate(t){return new cp(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Qi(a,t,i=0,u=a.length-1,h=NS){for(;u>i;){if(u-i>600){const j=u-i+1,T=t-i+1,A=Math.log(j),I=.5*Math.exp(2*A/3),R=.5*Math.sqrt(A*I*(j-I)/j)*(T-j/2<0?-1:1);Qi(a,t,Math.max(i,Math.floor(t-T*I/j+R)),Math.min(u,Math.floor(t+(j-T)*I/j+R)),h)}const g=a[t];let x=i,b=u;for(hp(a,i,t),h(a[u],g)>0&&hp(a,i,u);x<b;){for(hp(a,x,b),x++,b--;h(a[x],g)<0;)x++;for(;h(a[b],g)>0;)b--}h(a[i],g)===0?hp(a,i,b):(b++,hp(a,b,u)),b<=t&&(i=b+1),t<=b&&(u=b-1)}}function hp(a,t,i){const u=a[t];a[t]=a[i],a[i]=u}function NS(a,t){return a<t?-1:a>t?1:0}function ES(a){let t=0;for(let i,u,h=0,g=a.length,x=g-1;h<g;x=h++)i=a[h],u=a[x],t+=(u.x-i.x)*(i.y+u.y);return t}function bc(a,t){a[0]=Math.min(a[0],t[0]),a[1]=Math.min(a[1],t[1]),a[2]=Math.max(a[2],t[0]),a[3]=Math.max(a[3],t[1])}function xd(a,t){return!(a[0]<=t[0]||a[2]>=t[2]||a[1]<=t[1]||a[3]>=t[3])}function vu(a,t,i){const u=a[0]-t[0],h=a[1]-t[1],g=a[0]-i[0],x=a[1]-i[1];return u*x-g*h==0&&u*g<=0&&h*x<=0}function yd(a,t,i=!1){let u=!1;for(let b=0,j=t.length;b<j;b++){const T=t[b];for(let A=0,I=T.length,R=I-1;A<I;R=A++){const B=T[R],V=T[A];if(vu(a,B,V))return i;(g=B)[1]>(h=a)[1]!=(x=V)[1]>h[1]&&h[0]<(x[0]-g[0])*(h[1]-g[1])/(x[1]-g[1])+g[0]&&(u=!u)}}var h,g,x;return u}function Ev(a,t,i,u){const h=u[0]-i[0],g=u[1]-i[1],x=(a[0]-i[0])*g-h*(a[1]-i[1]),b=(t[0]-i[0])*g-h*(t[1]-i[1]);return x>0&&b<0||x<0&&b>0}function qf(a,t,i,u){return(h=[u[0]-i[0],u[1]-i[1]])[0]*(g=[t[0]-a[0],t[1]-a[1]])[1]-h[1]*g[0]!=0&&!(!Ev(a,t,i,u)||!Ev(i,u,a,t));var h,g}function Bx(a){const t=new et(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),i=new et(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of a[0])t.x>u.x&&(t.x=u.x),t.y>u.y&&(t.y=u.y),i.x<u.x&&(i.x=u.x),i.y<u.y&&(i.y=u.y);return{min:t,max:i}}const wc=8192;function CS(a,t){const i=(180+a[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a[1]*Math.PI/360)))/360,h=Math.pow(2,t.z);return[Math.round(i*h*wc),Math.round(u*h*wc)]}function Cv(a,t){for(let i=0;i<t.length;i++)if(yd(a,t[i]))return!0;return!1}function AS(a,t,i){for(const u of i)for(let h=0,g=u.length,x=g-1;h<g;x=h++)if(qf(a,t,u[x],u[h]))return!0;return!1}function Av(a,t){for(let i=0;i<a.length;++i)if(!yd(a[i],t))return!1;for(let i=0;i<a.length-1;++i)if(AS(a[i],a[i+1],t))return!1;return!0}function Pv(a,t){for(let i=0;i<t.length;i++)if(Av(a,t[i]))return!0;return!1}function Vx(a,t,i){const u=[];for(let h=0;h<a.length;h++){const g=[];for(let x=0;x<a[h].length;x++){const b=CS(a[h][x],i);bc(t,b),g.push(b)}u.push(g)}return u}function Sc(a,t,i){const u=[];for(let h=0;h<a.length;h++){const g=Vx(a[h],t,i);u.push(g)}return u}function Iv(a,t,i,u){if(a[0]<i[0]||a[0]>i[2]){const h=.5*u;let g=a[0]-i[0]>h?-u:i[0]-a[0]>h?u:0;g===0&&(g=a[0]-i[2]>h?-u:i[2]-a[0]>h?u:0),a[0]+=g}bc(t,a)}function Mv(a,t,i,u){const h=Math.pow(2,u.z)*wc,g=[u.x*wc,u.y*wc],x=[];if(!a)return x;for(const b of a)for(const j of b){const T=[j.x+g[0],j.y+g[1]];Iv(T,t,i,h),x.push(T)}return x}function Zf(a,t,i,u){const h=Math.pow(2,u.z)*wc,g=[u.x*wc,u.y*wc],x=[];if(!a)return x;for(const j of a){const T=[];for(const A of j){const I=[A.x+g[0],A.y+g[1]];bc(t,I),T.push(I)}x.push(T)}if(t[2]-t[0]<=h/2){(b=t)[0]=b[1]=1/0,b[2]=b[3]=-1/0;for(const j of x)for(const T of j)Iv(T,t,i,h)}var b;return x}class jc{constructor(t,i){this.type=Tn,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Fs(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let h=0;h<u.features.length;++h){const g=u.features[h].geometry.type;if(g==="Polygon"||g==="MultiPolygon")return new jc(u,u.features[h].geometry)}else if(u.type==="Feature"){const h=u.geometry.type;if(h==="Polygon"||h==="MultiPolygon")return new jc(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new jc(u,u)}return i.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return function(i,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=i.canonicalID();if(!x)return!1;if(u.type==="Polygon"){const b=Vx(u.coordinates,g,x),j=Mv(i.geometry(),h,g,x);if(!xd(h,g))return!1;for(const T of j)if(!yd(T,b))return!1}if(u.type==="MultiPolygon"){const b=Sc(u.coordinates,g,x),j=Mv(i.geometry(),h,g,x);if(!xd(h,g))return!1;for(const T of j)if(!Cv(T,b))return!1}return!0}(t,this.geometries);if(t.geometryType()==="LineString")return function(i,u){const h=[1/0,1/0,-1/0,-1/0],g=[1/0,1/0,-1/0,-1/0],x=i.canonicalID();if(!x)return!1;if(u.type==="Polygon"){const b=Vx(u.coordinates,g,x),j=Zf(i.geometry(),h,g,x);if(!xd(h,g))return!1;for(const T of j)if(!Av(T,b))return!1}if(u.type==="MultiPolygon"){const b=Sc(u.coordinates,g,x),j=Zf(i.geometry(),h,g,x);if(!xd(h,g))return!1;for(const T of j)if(!Pv(T,b))return!1}return!0}(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const pp={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Na=1/298.257223563,Ux=Na*(2-Na),_d=Math.PI/180;class vd{static fromTile(t,i,u){const h=Math.PI*(1-2*(t+.5)/Math.pow(2,i)),g=Math.atan(.5*(Math.exp(h)-Math.exp(-h)))/_d;return new vd(g,u)}static get units(){return pp}constructor(t,i){if(t===void 0)throw new Error("No latitude given.");if(i&&!pp[i])throw new Error(`Unknown unit ${i}. Use one of: ${Object.keys(pp).join(", ")}`);const u=6378.137*_d*(i?pp[i]:1),h=Math.cos(t*_d),g=1/(1-Ux*(1-h*h)),x=Math.sqrt(g);this.kx=u*x*h,this.ky=u*x*g*(1-Ux)}distance(t,i){const u=sa(t[0]-i[0])*this.kx,h=(t[1]-i[1])*this.ky;return Math.sqrt(u*u+h*h)}bearing(t,i){const u=sa(i[0]-t[0])*this.kx;return Math.atan2(u,(i[1]-t[1])*this.ky)/_d}destination(t,i,u){const h=u*_d;return this.offset(t,Math.sin(h)*i,Math.cos(h)*i)}offset(t,i,u){return[t[0]+i/this.kx,t[1]+u/this.ky]}lineDistance(t){let i=0;for(let u=0;u<t.length-1;u++)i+=this.distance(t[u],t[u+1]);return i}area(t){let i=0;for(let u=0;u<t.length;u++){const h=t[u];for(let g=0,x=h.length,b=x-1;g<x;b=g++)i+=sa(h[g][0]-h[b][0])*(h[g][1]+h[b][1])*(u?-1:1)}return Math.abs(i)/2*this.kx*this.ky}along(t,i){let u=0;if(i<=0)return t[0];for(let h=0;h<t.length-1;h++){const g=t[h],x=t[h+1],b=this.distance(g,x);if(u+=b,u>i)return Kf(g,x,(i-(u-b))/b)}return t[t.length-1]}pointToSegmentDistance(t,i,u){let[h,g]=i,x=sa(u[0]-h)*this.kx,b=(u[1]-g)*this.ky;if(x!==0||b!==0){const j=(sa(t[0]-h)*this.kx*x+(t[1]-g)*this.ky*b)/(x*x+b*b);j>1?(h=u[0],g=u[1]):j>0&&(h+=x/this.kx*j,g+=b/this.ky*j)}return x=sa(t[0]-h)*this.kx,b=(t[1]-g)*this.ky,Math.sqrt(x*x+b*b)}pointOnLine(t,i){let u=1/0,h=t[0][0],g=t[0][1],x=0,b=0;for(let j=0;j<t.length-1;j++){let T=t[j][0],A=t[j][1],I=sa(t[j+1][0]-T)*this.kx,R=(t[j+1][1]-A)*this.ky,B=0;I===0&&R===0||(B=(sa(i[0]-T)*this.kx*I+(i[1]-A)*this.ky*R)/(I*I+R*R),B>1?(T=t[j+1][0],A=t[j+1][1]):B>0&&(T+=I/this.kx*B,A+=R/this.ky*B)),I=sa(i[0]-T)*this.kx,R=(i[1]-A)*this.ky;const V=I*I+R*R;V<u&&(u=V,h=T,g=A,x=j,b=B)}return{point:[h,g],index:x,t:Math.max(0,Math.min(1,b))}}lineSlice(t,i,u){let h=this.pointOnLine(u,t),g=this.pointOnLine(u,i);if(h.index>g.index||h.index===g.index&&h.t>g.t){const T=h;h=g,g=T}const x=[h.point],b=h.index+1,j=g.index;!$x(u[b],x[0])&&b<=j&&x.push(u[b]);for(let T=b+1;T<=j;T++)x.push(u[T]);return $x(u[j],g.point)||x.push(g.point),x}lineSliceAlong(t,i,u){let h=0;const g=[];for(let x=0;x<u.length-1;x++){const b=u[x],j=u[x+1],T=this.distance(b,j);if(h+=T,h>t&&g.length===0&&g.push(Kf(b,j,(t-(h-T))/T)),h>=i)return g.push(Kf(b,j,(i-(h-T))/T)),g;h>t&&g.push(j)}return g}bufferPoint(t,i){const u=i/this.ky,h=i/this.kx;return[t[0]-h,t[1]-u,t[0]+h,t[1]+u]}bufferBBox(t,i){const u=i/this.ky,h=i/this.kx;return[t[0]-h,t[1]-u,t[2]+h,t[3]+u]}insideBBox(t,i){return sa(t[0]-i[0])>=0&&sa(t[0]-i[2])<=0&&t[1]>=i[1]&&t[1]<=i[3]}}function $x(a,t){return a[0]===t[0]&&a[1]===t[1]}function Kf(a,t,i){const u=sa(t[0]-a[0]);return[a[0]+u*i,a[1]+(t[1]-a[1])*i]}function sa(a){for(;a<-180;)a+=360;for(;a>180;)a-=360;return a}class Xf{constructor(t=[],i=(u,h)=>u<h?-1:u>h?1:0){if(this.data=t,this.length=this.data.length,this.compare=i,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],i=this.data.pop();return--this.length>0&&(this.data[0]=i,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:i,compare:u}=this,h=i[t];for(;t>0;){const g=t-1>>1,x=i[g];if(u(h,x)>=0)break;i[t]=x,t=g}i[t]=h}_down(t){const{data:i,compare:u}=this,h=this.length>>1,g=i[t];for(;t<h;){let x=1+(t<<1);const b=x+1;if(b<this.length&&u(i[b],i[x])<0&&(x=b),u(i[x],g)>=0)break;i[t]=i[x],t=x}i[t]=g}}var Rt=8192;function Gx(a,t){return t.dist-a.dist}const Yf=100,Jf=50;function fp(a){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==a.length)return!1;for(let i=0;i<t.length;i++)if(t[i]!==a[i])return!1;return!0}function bu(a){return a[1]-a[0]+1}function Ea(a,t){const i=a[1]>=a[0]&&a[1]<t;return i||console.warn("Distance Expression: Index is out of range"),i}function Qf(a,t){if(a[0]>a[1])return[null,null];const i=bu(a);if(t){if(i===2)return[a,null];const u=Math.floor(i/2);return[[a[0],a[0]+u],[a[0]+u,a[1]]]}{if(i===1)return[a,null];const u=Math.floor(i/2)-1;return[[a[0],a[0]+u],[a[0]+u+1,a[1]]]}}function Tc(a,t){const i=[1/0,1/0,-1/0,-1/0];if(!Ea(t,a.length))return i;for(let u=t[0];u<=t[1];++u)bc(i,a[u]);return i}function mp(a){const t=[1/0,1/0,-1/0,-1/0];for(let i=0;i<a.length;++i)for(let u=0;u<a[i].length;++u)bc(t,a[i][u]);return t}function Ha(a,t,i){if(fp(a)||fp(t))return NaN;let u=0,h=0;return a[2]<t[0]&&(u=t[0]-a[2]),a[0]>t[2]&&(u=a[0]-t[2]),a[1]>t[3]&&(h=a[1]-t[3]),a[3]<t[1]&&(h=t[1]-a[3]),i.distance([0,0],[u,h])}function an(a){return 360*a-180}function PS(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function Hx(a,t){const i=Math.pow(2,t.z),u=(a.y/Rt+t.y)/i;return[an((a.x/Rt+t.x)/i),PS(u)]}function IS(a,t){const i=[];for(let u=0;u<a.length;++u)i.push(Hx(a[u],t));return i}function Wx(a,t,i){const u=i.pointOnLine(t,a).point;return i.distance(a,u)}function Rv(a,t,i,u,h){const g=i.slice(u[0],u[1]+1);let x=1/0;for(let b=t[0];b<=t[1];++b)if((x=Math.min(x,Wx(a[b],g,h)))===0)return 0;return x}function pr(a,t,i,u,h){const g=Math.min(h.pointToSegmentDistance(a,i,u),h.pointToSegmentDistance(t,i,u)),x=Math.min(h.pointToSegmentDistance(i,a,t),h.pointToSegmentDistance(u,a,t));return Math.min(g,x)}function MS(a,t,i,u,h){if(!Ea(t,a.length)||!Ea(u,i.length))return NaN;let g=1/0;for(let x=t[0];x<t[1];++x)for(let b=u[0];b<u[1];++b){if(qf(a[x],a[x+1],i[b],i[b+1]))return 0;g=Math.min(g,pr(a[x],a[x+1],i[b],i[b+1],h))}return g}function RS(a,t,i,u,h){if(!Ea(t,a.length)||!Ea(u,i.length))return NaN;let g=1/0;for(let x=t[0];x<=t[1];++x)for(let b=u[0];b<=u[1];++b)if((g=Math.min(g,h.distance(a[x],i[b])))===0)return g;return g}function kS(a,t,i){if(yd(a,t,!0))return 0;let u=1/0;for(const h of t){const g=h.length;if(g<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(h[0]!==h[g-1]&&(u=Math.min(u,i.pointToSegmentDistance(a,h[g-1],h[0])))===0||(u=Math.min(u,Wx(a,h,i)))===0)return u}return u}function DS(a,t,i,u){if(!Ea(t,a.length))return NaN;for(let g=t[0];g<=t[1];++g)if(yd(a[g],i,!0))return 0;let h=1/0;for(let g=t[0];g<t[1];++g)for(const x of i)for(let b=0,j=x.length,T=j-1;b<j;T=b++){if(qf(a[g],a[g+1],x[T],x[b]))return 0;h=Math.min(h,pr(a[g],a[g+1],x[T],x[b],u))}return h}function kv(a,t){for(const i of a)for(let u=0;u<=i.length-1;++u)if(yd(i[u],t,!0))return!0;return!1}function LS(a,t,i,u=1/0){const h=mp(a),g=mp(t);if(u!==1/0&&Ha(h,g,i)>=u)return u;if(xd(h,g)){if(kv(a,t))return 0}else if(kv(t,a))return 0;let x=u;for(const b of a)for(let j=0,T=b.length,A=T-1;j<T;A=j++)for(const I of t)for(let R=0,B=I.length,V=B-1;R<B;V=R++){if(qf(b[A],b[j],I[V],I[R]))return 0;x=Math.min(x,pr(b[A],b[j],I[V],I[R],i))}return x}function em(a,t,i,u,h,g,x){if(g===null||x===null)return;const b=Ha(Tc(u,g),Tc(h,x),i);b<t&&a.push({dist:b,range1:g,range2:x})}function zS(a,t,i,u,h=1/0){let g=Math.min(u.distance(a[0],i[0][0]),h);if(g===0)return g;const x=new Xf([{dist:0,range1:[0,a.length-1],range2:[0,0]}],Gx),b=t?Jf:Yf,j=mp(i);for(;x.length;){const T=x.pop();if(T.dist>=g)continue;const A=T.range1;if(bu(A)<=b){if(!Ea(A,a.length))return NaN;if(t){const I=DS(a,A,i,u);if((g=Math.min(g,I))===0)return g}else for(let I=A[0];I<=A[1];++I){const R=kS(a[I],i,u);if((g=Math.min(g,R))===0)return g}}else{const I=Qf(A,t);if(I[0]!==null){const R=Ha(Tc(a,I[0]),j,u);R<g&&x.push({dist:R,range1:I[0],range2:[0,0]})}if(I[1]!==null){const R=Ha(Tc(a,I[1]),j,u);R<g&&x.push({dist:R,range1:I[1],range2:[0,0]})}}}return g}function Dv(a,t,i,u,h,g=1/0){let x=Math.min(g,h.distance(a[0],i[0]));if(x===0)return x;const b=new Xf([{dist:0,range1:[0,a.length-1],range2:[0,i.length-1]}],Gx),j=t?Jf:Yf,T=u?Jf:Yf;for(;b.length;){const A=b.pop();if(A.dist>=x)continue;const I=A.range1,R=A.range2;if(bu(I)<=j&&bu(R)<=T){if(!Ea(I,a.length)||!Ea(R,i.length))return NaN;if(t&&u?x=Math.min(x,MS(a,I,i,R,h)):t||u?t&&!u?x=Math.min(x,Rv(i,R,a,I,h)):!t&&u&&(x=Math.min(x,Rv(a,I,i,R,h))):x=Math.min(x,RS(a,I,i,R,h)),x===0)return x}else{const B=Qf(I,t),V=Qf(R,u);em(b,x,h,a,i,B[0],V[0]),em(b,x,h,a,i,B[0],V[1]),em(b,x,h,a,i,B[1],V[0]),em(b,x,h,a,i,B[1],V[1])}}return x}function qx(a,t,i,u,h=1/0){let g=h;const x=Tc(a,[0,a.length-1]);for(const b of i)if(!(g!==1/0&&Ha(x,Tc(b,[0,b.length-1]),u)>=g)&&(g=Math.min(g,Dv(a,t,b,!0,u,g)),g===0))return g;return g}function tm(a,t,i,u,h=1/0){let g=h;const x=Tc(a,[0,a.length-1]);for(const b of i){if(g!==1/0&&Ha(x,mp(b),u)>=g)continue;const j=zS(a,t,b,u,g);if(isNaN(j))return j;if((g=Math.min(g,j))===0)return g}return g}function Zx(a){return a==="Point"||a==="MultiPoint"||a==="LineString"||a==="MultiLineString"||a==="Polygon"||a==="MultiPolygon"}class wu{constructor(t,i){this.type=cs,this.geojson=t,this.geometries=i}static parse(t,i){if(t.length!==2)return i.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Fs(t[1])){const u=t[1];if(u.type==="FeatureCollection"){for(let h=0;h<u.features.length;++h)if(Zx(u.features[h].geometry.type))return new wu(u,u.features[h].geometry)}else if(u.type==="Feature"){if(Zx(u.geometry.type))return new wu(u,u.geometry)}else if(Zx(u.type))return new wu(u,u)}return i.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const i=t.geometry(),u=t.canonicalID();if(i!=null&&u!=null){if(t.geometryType()==="Point")return function(h,g,x){const b=[];for(const T of h)for(const A of T)b.push(Hx(A,g));const j=new vd(b[0][1],"meters");return x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString"?Dv(b,!1,x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",j):x.type==="MultiLineString"?qx(b,!1,x.coordinates,j):x.type==="Polygon"||x.type==="MultiPolygon"?tm(b,!1,x.type==="Polygon"?[x.coordinates]:x.coordinates,j):null}(i,u,this.geometries);if(t.geometryType()==="LineString")return function(h,g,x){const b=[];for(const T of h){const A=[];for(const I of T)A.push(Hx(I,g));b.push(A)}const j=new vd(b[0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return qx(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",b,j);if(x.type==="MultiLineString"){let T=1/0;for(let A=0;A<x.coordinates.length;A++){const I=qx(x.coordinates[A],!0,b,j,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}if(x.type==="Polygon"||x.type==="MultiPolygon"){let T=1/0;for(let A=0;A<b.length;A++){const I=tm(b[A],!0,x.type==="Polygon"?[x.coordinates]:x.coordinates,j,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return null}(i,u,this.geometries);if(t.geometryType()==="Polygon")return function(h,g,x){const b=[];for(const T of function(A,I){const R=A.length;if(R<=1)return[A];const B=[];let V,K;for(let Q=0;Q<R;Q++){const re=ES(A[Q]);re!==0&&(A[Q].area=Math.abs(re),K===void 0&&(K=re<0),K===re<0?(V&&B.push(V),V=[A[Q]]):V.push(A[Q]))}return V&&B.push(V),B}(h)){const A=[];for(let I=0;I<T.length;++I)A.push(IS(T[I],g));b.push(A)}const j=new vd(b[0][0][0][1],"meters");if(x.type==="Point"||x.type==="MultiPoint"||x.type==="LineString")return tm(x.type==="Point"?[x.coordinates]:x.coordinates,x.type==="LineString",b,j);if(x.type==="MultiLineString"){let T=1/0;for(let A=0;A<x.coordinates.length;A++){const I=tm(x.coordinates[A],!0,b,j,T);if(isNaN(I))return I;if((T=Math.min(T,I))===0)return T}return T}return x.type==="Polygon"||x.type==="MultiPolygon"?function(T,A,I){let R=1/0;for(const B of T)for(const V of A){const K=LS(B,V,I,R);if(isNaN(K))return K;if((R=Math.min(R,K))===0)return R}return R}(x.type==="Polygon"?[x.coordinates]:x.coordinates,b,j):null}(i,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function bd(a){if(a instanceof _i&&(a.name==="get"&&a.args.length===1||a.name==="feature-state"||a.name==="has"&&a.args.length===1||a.name==="properties"||a.name==="geometry-type"||a.name==="id"||/^filter-/.test(a.name))||a instanceof jc||a instanceof wu)return!1;if(a instanceof Sd)return a.featureConstant;let t=!0;return a.eachChild(i=>{t&&!bd(i)&&(t=!1)}),t}function sm(a){if(a instanceof _i&&a.name==="feature-state")return!1;let t=!0;return a.eachChild(i=>{t&&!sm(i)&&(t=!1)}),t}function nm(a){if(a instanceof Sd)return new Set([a.key]);let t=new Set;return a.eachChild(i=>{t=new Set([...t,...nm(i)])}),t}function wd(a,t){if(a instanceof _i&&t.indexOf(a.name)>=0)return!1;let i=!0;return a.eachChild(u=>{i&&!wd(u,t)&&(i=!1)}),i}function Lv(a,t,i){return[a,t,i].filter(Boolean).join("")}function Kx(a,t){switch(a){case"string":return ja(t);case"number":return+t;case"boolean":return!!t;case"color":return En.parse(t);case"formatted":return ho.fromString(ja(t));case"resolvedImage":return Eo.build(ja(t))}return t}function zv(a,t,i,u){return u!==void 0&&(a=u*Math.round(a/u)),t!==void 0&&a<t&&(a=t),i!==void 0&&a>i&&(a=i),a}class Sd{constructor(t,i,u,h=!1){this.type=t,this.key=i,this.scope=u,this.featureConstant=h}static parse(t,i){let u=i.expectedType;if(u==null&&(u=Cn),t.length<2||t.length>3)return i.error("Invalid number of arguments for 'config' expression.");const h=i.parse(t[1],1);if(!(h instanceof Ss))return i.error("Key name of 'config' expression must be a string literal.");let g,x=!0;const b=ja(h.value);if(t.length>=3){const j=i.parse(t[2],2);if(!(j instanceof Ss))return i.error("Scope of 'config' expression must be a string literal.");g=ja(j.value)}if(i.options){const j=Lv(b,g,i._scope),T=i.options.get(j);T&&(x=bd(T.value||T.default))}return new Sd(u,b,g,x)}evaluate(t){const i=Lv(this.key,this.scope,t.scope),u=t.getConfig(i);if(!u)return null;const{type:h,value:g,values:x,minValue:b,maxValue:j,stepValue:T}=u,A=u.default.evaluate(t);let I=A;if(g){const R=t.scope;t.scope=(R||"").split("").slice(1).join(""),I=g.evaluate(t),t.scope=R}return h&&(I=Kx(h,I)),I===void 0||b===void 0&&j===void 0&&T===void 0||(typeof I=="number"?I=zv(I,b,j,T):Array.isArray(I)&&(I=I.map(R=>typeof R=="number"?zv(R,b,j,T):R))),g!==void 0&&I!==void 0&&x&&!x.includes(I)&&(I=A,h&&(I=Kx(h,I))),(h&&h!==this.type||I!==void 0&&!Hf(Kt(I),this.type))&&(I=Kx(this.type.kind,I)),I}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class rm{constructor(t,i){this.type=i.type,this.name=t,this.boundExpression=i}static parse(t,i){if(t.length!==2||typeof t[1]!="string")return i.error("'var' expression requires exactly one string literal argument.");const u=t[1];return i.scope.has(u)?new rm(u,i.scope.get(u)):i.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class im{constructor(t,i=[],u,h=new Ox,g=[],x,b){this.registry=t,this.path=i,this.key=i.map(j=>typeof j=="string"?`['${j}']`:`[${j}]`).join(""),this.scope=h,this.errors=g,this.expectedType=u,this._scope=x,this.options=b}parse(t,i,u,h,g={}){return i||u?this.concat(i,null,u,h)._parse(t,g):this._parse(t,g)}parseObjectValue(t,i,u,h,g,x={}){return this.concat(i,u,h,g)._parse(t,x)}_parse(t,i){function u(h,g,x){return x==="assert"?new gs(g,[h]):x==="coerce"?new Ta(g,[h]):h}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const h=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(h){let g=h.parse(t,this);if(!g)return null;if(this.expectedType){const x=this.expectedType,b=g.type;if(x.kind!=="string"&&x.kind!=="number"&&x.kind!=="boolean"&&x.kind!=="object"&&x.kind!=="array"||b.kind!=="value")if(x.kind!=="color"&&x.kind!=="formatted"&&x.kind!=="resolvedImage"||b.kind!=="value"&&b.kind!=="string"){if(this.checkSubtype(x,b))return null}else g=u(g,x,i.typeAnnotation||"coerce");else g=u(g,x,i.typeAnnotation||"assert")}if(!(g instanceof Ss)&&g.type.kind!=="resolvedImage"&&Xx(g)){const x=new dp(this._scope,this.options);try{g=new Ss(g.type,g.evaluate(x))}catch(b){return this.error(b.message),null}}return g}return Ta.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,i,u,h){let g=typeof t=="number"?this.path.concat(t):this.path;g=typeof i=="string"?g.concat(i):g;const x=h?this.scope.concat(h):this.scope;return new im(this.registry,g,u||null,x,this.errors,this._scope,this.options)}error(t,...i){const u=`${this.key}${i.map(h=>`[${h}]`).join("")}`;this.errors.push(new ta(u,t))}checkSubtype(t,i){const u=fd(t,i);return u&&this.error(u),u}}function Xx(a){if(a instanceof rm)return Xx(a.boundExpression);if(a instanceof _i&&a.name==="error"||a instanceof pl||a instanceof jc||a instanceof wu||a instanceof Sd)return!1;const t=a instanceof Ta||a instanceof gs;let i=!0;return a.eachChild(u=>{i=t?i&&Xx(u):i&&u instanceof Ss}),!!i&&bd(a)&&wd(a,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function om(a,t){const i=a.length-1;let u,h,g=0,x=i,b=0;for(;g<=x;)if(b=Math.floor((g+x)/2),u=a[b],h=a[b+1],u<=t){if(b===i||t<h)return b;g=b+1}else{if(!(u>t))throw new Vr("Input is not a number.");x=b-1}return 0}class gp{constructor(t,i,u){this.type=t,this.input=i,this.labels=[],this.outputs=[];for(const[h,g]of u)this.labels.push(h),this.outputs.push(g)}static parse(t,i){if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return i.error("Expected an even number of arguments.");const u=i.parse(t[1],1,cs);if(!u)return null;const h=[];let g=null;i.expectedType&&i.expectedType.kind!=="value"&&(g=i.expectedType);for(let x=1;x<t.length;x+=2){const b=x===1?-1/0:t[x],j=t[x+1],T=x,A=x+1;if(typeof b!="number")return i.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',T);if(h.length&&h[h.length-1][0]>=b)return i.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',T);const I=i.parse(j,A,g);if(!I)return null;g=g||I.type,h.push([b,I])}return new gp(g,u,h)}evaluate(t){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return u[0].evaluate(t);const g=i.length;return h>=i[g-1]?u[g-1].evaluate(t):u[om(i,h)].evaluate(t)}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){const t=["step",this.input.serialize()];for(let i=0;i<this.labels.length;i++)i>0&&t.push(this.labels[i]),t.push(this.outputs[i].serialize());return t}}const Ov=.95047,Fv=1.08883,Bv=4/29,jd=6/29,Vv=3*jd*jd,Yx=jd*jd*jd,OS=Math.PI/180,Uv=180/Math.PI;function Jx(a){return a>Yx?Math.pow(a,1/3):a/Vv+Bv}function Qx(a){return a>jd?a*a*a:Vv*(a-Bv)}function ey(a){return 255*(a<=.0031308?12.92*a:1.055*Math.pow(a,1/2.4)-.055)}function am(a){return(a/=255)<=.04045?a/12.92:Math.pow((a+.055)/1.055,2.4)}function ty(a){const t=am(a.r),i=am(a.g),u=am(a.b),h=Jx((.4124564*t+.3575761*i+.1804375*u)/Ov),g=Jx((.2126729*t+.7151522*i+.072175*u)/1);return{l:116*g-16,a:500*(h-g),b:200*(g-Jx((.0193339*t+.119192*i+.9503041*u)/Fv)),alpha:a.a}}function Su(a){let t=(a.l+16)/116,i=isNaN(a.a)?t:t+a.a/500,u=isNaN(a.b)?t:t-a.b/200;return t=1*Qx(t),i=Ov*Qx(i),u=Fv*Qx(u),new En(ey(3.2404542*i-1.5371385*t-.4985314*u),ey(-.969266*i+1.8760108*t+.041556*u),ey(.0556434*i-.2040259*t+1.0572252*u),a.alpha)}function $v(a,t,i){const u=t-a;return a+i*(u>180||u<-180?u-360*Math.round(u/360):u)}const Td={forward:ty,reverse:Su,interpolate:function(a,t,i){return{l:fs(a.l,t.l,i),a:fs(a.a,t.a,i),b:fs(a.b,t.b,i),alpha:fs(a.alpha,t.alpha,i)}}},xp={forward:function(a){const{l:t,a:i,b:u}=ty(a),h=Math.atan2(u,i)*Uv;return{h:h<0?h+360:h,c:Math.sqrt(i*i+u*u),l:t,alpha:a.a}},reverse:function(a){const t=a.h*OS,i=a.c;return Su({l:a.l,a:Math.cos(t)*i,b:Math.sin(t)*i,alpha:a.alpha})},interpolate:function(a,t,i){return{h:$v(a.h,t.h,i),c:fs(a.c,t.c,i),l:fs(a.l,t.l,i),alpha:fs(a.alpha,t.alpha,i)}}};var lm=Object.freeze({__proto__:null,hcl:xp,lab:Td});class Co{constructor(t,i,u,h,g){this.type=t,this.operator=i,this.interpolation=u,this.input=h,this.labels=[],this.outputs=[];for(const[x,b]of g)this.labels.push(x),this.outputs.push(b)}static interpolationFactor(t,i,u,h){let g=0;if(t.name==="exponential")g=sy(i,t.base,u,h);else if(t.name==="linear")g=sy(i,1,u,h);else if(t.name==="cubic-bezier"){const x=t.controlPoints;g=new gc(x[0],x[1],x[2],x[3]).solve(sy(i,1,u,h))}return g}static parse(t,i){let[u,h,g,...x]=t;if(!Array.isArray(h)||h.length===0)return i.error("Expected an interpolation type expression.",1);if(h[0]==="linear")h={name:"linear"};else if(h[0]==="exponential"){const T=h[1];if(typeof T!="number")return i.error("Exponential interpolation requires a numeric base.",1,1);h={name:"exponential",base:T}}else{if(h[0]!=="cubic-bezier")return i.error(`Unknown interpolation type ${String(h[0])}`,1,0);{const T=h.slice(1);if(T.length!==4||T.some(A=>typeof A!="number"||A<0||A>1))return i.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);h={name:"cubic-bezier",controlPoints:T}}}if(t.length-1<4)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return i.error("Expected an even number of arguments.");if(g=i.parse(g,2,cs),!g)return null;const b=[];let j=null;u==="interpolate-hcl"||u==="interpolate-lab"?j=Lo:i.expectedType&&i.expectedType.kind!=="value"&&(j=i.expectedType);for(let T=0;T<x.length;T+=2){const A=x[T],I=x[T+1],R=T+3,B=T+4;if(typeof A!="number")return i.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(b.length&&b[b.length-1][0]>=A)return i.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',R);const V=i.parse(I,B,j);if(!V)return null;j=j||V.type,b.push([A,V])}return j.kind==="number"||j.kind==="color"||j.kind==="array"&&j.itemType.kind==="number"&&typeof j.N=="number"?new Co(j,u,h,g,b):i.error(`Type ${Gr(j)} is not interpolatable.`)}evaluate(t){const i=this.labels,u=this.outputs;if(i.length===1)return u[0].evaluate(t);const h=this.input.evaluate(t);if(h<=i[0])return u[0].evaluate(t);const g=i.length;if(h>=i[g-1])return u[g-1].evaluate(t);const x=om(i,h),b=Co.interpolationFactor(this.interpolation,h,i[x],i[x+1]),j=u[x].evaluate(t),T=u[x+1].evaluate(t);return this.operator==="interpolate"?ip[this.type.kind.toLowerCase()](j,T,b):this.operator==="interpolate-hcl"?xp.reverse(xp.interpolate(xp.forward(j),xp.forward(T),b)):Td.reverse(Td.interpolate(Td.forward(j),Td.forward(T),b))}eachChild(t){t(this.input);for(const i of this.outputs)t(i)}outputDefined(){return this.outputs.every(t=>t.outputDefined())}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const i=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)i.push(this.labels[u],this.outputs[u].serialize());return i}}function sy(a,t,i,u){const h=u-i,g=a-i;return h===0?0:t===1?g/h:(Math.pow(t,g)-1)/(Math.pow(t,h)-1)}class cm{constructor(t,i){this.type=t,this.args=i}static parse(t,i){if(t.length<2)return i.error("Expectected at least one argument.");let u=null;const h=i.expectedType;h&&h.kind!=="value"&&(u=h);const g=[];for(const b of t.slice(1)){const j=i.parse(b,1+g.length,u,void 0,{typeAnnotation:"omit"});if(!j)return null;u=u||j.type,g.push(j)}const x=h&&g.some(b=>fd(h,b.type));return new cm(x?Cn:u,g)}evaluate(t){let i,u=null,h=0;for(const g of this.args){if(h++,u=g.evaluate(t),u&&u instanceof Eo&&!u.available&&(i||(i=u),u=null,h===this.args.length))return i;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every(t=>t.outputDefined())}serialize(){const t=["coalesce"];return this.eachChild(i=>{t.push(i.serialize())}),t}}class yp{constructor(t,i){this.type=i.type,this.bindings=[].concat(t),this.result=i}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const i of this.bindings)t(i[1]);t(this.result)}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let g=1;g<t.length-1;g+=2){const x=t[g];if(typeof x!="string")return i.error(`Expected string, but found ${typeof x} instead.`,g);if(/[^a-zA-Z0-9_]/.test(x))return i.error("Variable names must contain only alphanumeric characters or '_'.",g);const b=i.parse(t[g+1],g+1);if(!b)return null;u.push([x,b])}const h=i.parse(t[t.length-1],t.length-1,i.expectedType,u);return h?new yp(u,h):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[i,u]of this.bindings)t.push(i,u.serialize());return t.push(this.result.serialize()),t}}class um{constructor(t,i,u){this.type=t,this.index=i,this.input=u}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,cs),h=i.parse(t[2],2,Ji(i.expectedType||Cn));return u&&h?new um(h.type.itemType,u,h):null}evaluate(t){const i=this.index.evaluate(t),u=this.input.evaluate(t);if(i<0)throw new Vr(`Array index out of bounds: ${i} < 0.`);if(i>=u.length)throw new Vr(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i!==Math.floor(i))throw new Vr(`Array index must be an integer, but found ${i} instead. Use at-interpolated to retrieve interpolated result with a fractional index.`);return u[i]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ny{constructor(t,i,u){this.type=t,this.index=i,this.input=u}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,cs),h=i.parse(t[2],2,Ji(i.expectedType||Cn));return u&&h?new ny(h.type.itemType,u,h):null}evaluate(t){const i=this.index.evaluate(t),u=this.input.evaluate(t);if(i<0)throw new Vr(`Array index out of bounds: ${i} < 0.`);if(i>u.length-1)throw new Vr(`Array index out of bounds: ${i} > ${u.length-1}.`);if(i===Math.floor(i))return u[i];const h=Math.floor(i),g=Math.ceil(i),x=u[h],b=u[g];if(typeof x!="number"||typeof b!="number")throw new Vr(`Cannot interpolate between non-number values at index ${i}.`);const j=i-h;return x*(1-j)+b*j}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class ry{constructor(t,i){this.type=Tn,this.needle=t,this.haystack=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,Cn),h=i.parse(t[2],2,Cn);return u&&h?_c(u.type,[Tn,jn,cs,pd,Cn])?new ry(u,h):i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(u.type)} instead`):null}evaluate(t){const i=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!lp(i,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(Kt(i))} instead.`);if(!lp(u,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${Gr(Kt(u))} instead.`);return u.indexOf(i)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class dm{constructor(t,i,u){this.type=cs,this.needle=t,this.haystack=i,this.fromIndex=u}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,Cn),h=i.parse(t[2],2,Cn);if(!u||!h)return null;if(!_c(u.type,[Tn,jn,cs,pd,Cn]))return i.error(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(u.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,cs);return g?new dm(u,h,g):null}return new dm(u,h)}evaluate(t){const i=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!lp(i,["boolean","string","number","null"]))throw new Vr(`Expected first argument to be of type boolean, string, number or null, but found ${Gr(Kt(i))} instead.`);if(!lp(u,["string","array"]))throw new Vr(`Expected second argument to be of type array or string, but found ${Gr(Kt(u))} instead.`);if(this.fromIndex){const h=this.fromIndex.evaluate(t);return u.indexOf(i,h)}return u.indexOf(i)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class hm{constructor(t,i,u,h,g,x){this.inputType=t,this.type=i,this.input=u,this.cases=h,this.outputs=g,this.otherwise=x}static parse(t,i){if(t.length<5)return i.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return i.error("Expected an even number of arguments.");let u,h;i.expectedType&&i.expectedType.kind!=="value"&&(h=i.expectedType);const g={},x=[];for(let T=2;T<t.length-1;T+=2){let A=t[T];const I=t[T+1];Array.isArray(A)||(A=[A]);const R=i.concat(T);if(A.length===0)return R.error("Expected at least one branch label.");for(const V of A){if(typeof V!="number"&&typeof V!="string")return R.error("Branch labels must be numbers or strings.");if(typeof V=="number"&&Math.abs(V)>Number.MAX_SAFE_INTEGER)return R.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof V=="number"&&Math.floor(V)!==V)return R.error("Numeric branch labels must be integer values.");if(u){if(R.checkSubtype(u,Kt(V)))return null}else u=Kt(V);if(g[String(V)]!==void 0)return R.error("Branch labels must be unique.");g[String(V)]=x.length}const B=i.parse(I,T,h);if(!B)return null;h=h||B.type,x.push(B)}const b=i.parse(t[1],1,Cn);if(!b)return null;const j=i.parse(t[t.length-1],t.length-1,h);return j?b.type.kind!=="value"&&i.concat(1).checkSubtype(u,b.type)?null:new hm(u,h,b,g,x,j):null}evaluate(t){const i=this.input.evaluate(t);return(Hf(Kt(i),this.inputType)&&this.outputs[this.cases[i]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every(t=>t.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],i=Object.keys(this.cases).sort(),u=[],h={};for(const x of i){const b=h[this.cases[x]];b===void 0?(h[this.cases[x]]=u.length,u.push([this.cases[x],[x]])):u[b][1].push(x)}const g=x=>this.inputType.kind==="number"?Number(x):x;for(const[x,b]of u)t.push(b.length===1?g(b[0]):b.map(g)),t.push(this.outputs[x].serialize());return t.push(this.otherwise.serialize()),t}}class pm{constructor(t,i,u){this.type=t,this.branches=i,this.otherwise=u}static parse(t,i){if(t.length<4)return i.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return i.error("Expected an odd number of arguments.");let u;i.expectedType&&i.expectedType.kind!=="value"&&(u=i.expectedType);const h=[];for(let x=1;x<t.length-1;x+=2){const b=i.parse(t[x],x,Tn);if(!b)return null;const j=i.parse(t[x+1],x+1,u);if(!j)return null;h.push([b,j]),u=u||j.type}const g=i.parse(t[t.length-1],t.length-1,u);return g?new pm(u,h,g):null}evaluate(t){for(const[i,u]of this.branches)if(i.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[i,u]of this.branches)t(i),t(u);t(this.otherwise)}outputDefined(){return this.branches.every(([t,i])=>i.outputDefined())&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild(i=>{t.push(i.serialize())}),t}}class ju{constructor(t,i,u,h){this.type=t,this.input=i,this.beginIndex=u,this.endIndex=h}static parse(t,i){if(t.length<=2||t.length>=5)return i.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,Cn),h=i.parse(t[2],2,cs);if(!u||!h)return null;if(!_c(u.type,[Ji(Cn),jn,Cn]))return i.error(`Expected first argument to be of type array or string, but found ${Gr(u.type)} instead`);if(t.length===4){const g=i.parse(t[3],3,cs);return g?new ju(u.type,u,h,g):null}return new ju(u.type,u,h)}evaluate(t){const i=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!lp(i,["string","array"]))throw new Vr(`Expected first argument to be of type array or string, but found ${Gr(Kt(i))} instead.`);if(this.endIndex){const h=this.endIndex.evaluate(t);return i.slice(u,h)}return i.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class iy{constructor(t,i){this.type=Ji(jn),this.str=t,this.delimiter=i}static parse(t,i){if(t.length!==3)return i.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=i.parse(t[1],1,jn),h=i.parse(t[2],2,jn);return u&&h?new iy(u,h):void 0}evaluate(t){const i=this.str.evaluate(t),u=this.delimiter.evaluate(t);return i.split(u)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function oy(a,t){return a==="=="||a==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function Gv(a,t,i,u){return u.compare(t,i)===0}function Nd(a,t,i){const u=a!=="=="&&a!=="!=";return class i${constructor(g,x,b){this.type=Tn,this.lhs=g,this.rhs=x,this.collator=b,this.hasUntypedArgument=g.type.kind==="value"||x.type.kind==="value"}static parse(g,x){if(g.length!==3&&g.length!==4)return x.error("Expected two or three arguments.");const b=g[0];let j=x.parse(g[1],1,Cn);if(!j)return null;if(!oy(b,j.type))return x.concat(1).error(`"${b}" comparisons are not supported for type '${Gr(j.type)}'.`);let T=x.parse(g[2],2,Cn);if(!T)return null;if(!oy(b,T.type))return x.concat(2).error(`"${b}" comparisons are not supported for type '${Gr(T.type)}'.`);if(j.type.kind!==T.type.kind&&j.type.kind!=="value"&&T.type.kind!=="value")return x.error(`Cannot compare types '${Gr(j.type)}' and '${Gr(T.type)}'.`);u&&(j.type.kind==="value"&&T.type.kind!=="value"?j=new gs(T.type,[j]):j.type.kind!=="value"&&T.type.kind==="value"&&(T=new gs(j.type,[T])));let A=null;if(g.length===4){if(j.type.kind!=="string"&&T.type.kind!=="string"&&j.type.kind!=="value"&&T.type.kind!=="value")return x.error("Cannot use collator to compare non-string types.");if(A=x.parse(g[3],3,Gf),!A)return null}return new i$(j,T,A)}evaluate(g){const x=this.lhs.evaluate(g),b=this.rhs.evaluate(g);if(u&&this.hasUntypedArgument){const j=Kt(x),T=Kt(b);if(j.kind!==T.kind||j.kind!=="string"&&j.kind!=="number")throw new Vr(`Expected arguments for "${a}" to be (string, string) or (number, number), but found (${j.kind}, ${T.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const j=Kt(x),T=Kt(b);if(j.kind!=="string"||T.kind!=="string")return t(g,x,b)}return this.collator?i(g,x,b,this.collator.evaluate(g)):t(g,x,b)}eachChild(g){g(this.lhs),g(this.rhs),this.collator&&g(this.collator)}outputDefined(){return!0}serialize(){const g=[a];return this.eachChild(x=>{g.push(x.serialize())}),g}}}const Hv=Nd("==",function(a,t,i){return t===i},Gv),Wv=Nd("!=",function(a,t,i){return t!==i},function(a,t,i,u){return!Gv(0,t,i,u)}),FS=Nd("<",function(a,t,i){return t<i},function(a,t,i,u){return u.compare(t,i)<0}),BS=Nd(">",function(a,t,i){return t>i},function(a,t,i,u){return u.compare(t,i)>0}),VS=Nd("<=",function(a,t,i){return t<=i},function(a,t,i,u){return u.compare(t,i)<=0}),fm=Nd(">=",function(a,t,i){return t>=i},function(a,t,i,u){return u.compare(t,i)>=0});class ay{constructor(t,i,u,h,g,x){this.type=jn,this.number=t,this.locale=i,this.currency=u,this.unit=h,this.minFractionDigits=g,this.maxFractionDigits=x}static parse(t,i){if(t.length!==3)return i.error("Expected two arguments.");const u=i.parse(t[1],1,cs);if(!u)return null;const h=t[2];if(typeof h!="object"||Array.isArray(h))return i.error("NumberFormat options argument must be an object.");let g=null;if(h.locale&&(g=i.parseObjectValue(h.locale,2,"locale",jn),!g))return null;let x=null;if(h.currency&&(x=i.parseObjectValue(h.currency,2,"currency",jn),!x))return null;let b=null;if(h.unit&&(b=i.parseObjectValue(h.unit,2,"unit",jn),!b))return null;let j=null;if(h["min-fraction-digits"]&&(j=i.parseObjectValue(h["min-fraction-digits"],2,"min-fraction-digits",cs),!j))return null;let T=null;return h["max-fraction-digits"]&&(T=i.parseObjectValue(h["max-fraction-digits"],2,"max-fraction-digits",cs),!T)?null:new ay(u,g,x,b,j,T)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class ly{constructor(t){this.type=cs,this.input=t}static parse(t,i){if(t.length!==2)return i.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=i.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?i.error(`Expected argument of type string or array, but found ${Gr(u.type)} instead.`):new ly(u):null}evaluate(t){const i=this.input.evaluate(t);if(typeof i=="string"||Array.isArray(i))return i.length;throw new Vr(`Expected value to be of type string or array, but found ${Gr(Kt(i))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild(i=>{t.push(i.serialize())}),t}}function qv(a){return function(){a=1831565813+(a|=0)|0;let t=Math.imul(a^a>>>15,1|a);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const Ed={"==":Hv,"!=":Wv,">":BS,"<":FS,">=":fm,"<=":VS,array:gs,at:um,"at-interpolated":ny,boolean:gs,case:pm,coalesce:cm,collator:pl,format:md,image:gd,in:ry,"index-of":dm,interpolate:Co,"interpolate-hcl":Co,"interpolate-lab":Co,length:ly,let:yp,literal:Ss,match:hm,number:gs,"number-format":ay,object:gs,slice:ju,step:gp,string:gs,"to-boolean":Ta,"to-color":Ta,"to-number":Ta,"to-string":Ta,var:rm,within:jc,distance:wu,config:Sd,split:iy};function cy(a,[t,i,u,h]){t=t.evaluate(a),i=i.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,x=_u(t,i,u,g);if(x)throw new Vr(x);return new En(t/255,i/255,u/255,g)}function Zv(a,[t,i,u,h]){t=t.evaluate(a),i=i.evaluate(a),u=u.evaluate(a);const g=h?h.evaluate(a):1,x=function(T,A,I,R){return typeof T=="number"&&T>=0&&T<=360?typeof A=="number"&&A>=0&&A<=100&&typeof I=="number"&&I>=0&&I<=100?R===void 0||typeof R=="number"&&R>=0&&R<=1?null:`Invalid hsla value [${[T,A,I,R].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof R=="number"?[T,A,I,R]:[T,A,I]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof R=="number"?[T,A,I,R]:[T,A,I]).join(", ")}]: 'h' must be between 0 and 360.`}(t,i,u,g);if(x)throw new Vr(x);const b=`hsla(${t}, ${i}%, ${u}%, ${g})`,j=En.parse(b);if(!j)throw new Vr(`Failed to parse HSLA color: ${b}`);return j}function Kv(a,t){return a in t}function mm(a,t){const i=t[a];return i===void 0?null:i}function Nc(a){return{type:a}}function uy(a){return{result:"success",value:a}}function Ec(a){return{result:"error",value:a}}function Cc(a,t){return!!a&&!!a.parameters&&a.parameters.indexOf(t)>-1}function gm(a){return a["property-type"]==="data-driven"}function Xv(a){return Cc(a.expression,"measure-light")}function Yv(a){return Cc(a.expression,"zoom")}function xm(a){return!!a.expression&&a.expression.interpolated}function ym(a){return typeof a=="object"&&a!==null&&!Array.isArray(a)}function Jv(a){return a}function dy(a,t){const i=t.type==="color",u=a.stops&&typeof a.stops[0][0]=="object",h=u||!(u||a.property!==void 0),g=a.type||(xm(t)?"exponential":"interval");if(i&&((a=yu({},a)).stops&&(a.stops=a.stops.map(T=>[T[0],En.parse(T[1])])),a.default=En.parse(a.default?a.default:t.default)),a.colorSpace&&a.colorSpace!=="rgb"&&!lm[a.colorSpace])throw new Error(`Unknown color space: ${a.colorSpace}`);let x,b,j;if(g==="exponential")x=e1;else if(g==="interval")x=Qv;else if(g==="categorical"){x=hy,b=Object.create(null);for(const T of a.stops)b[T[0]]=T[1];j=typeof a.stops[0][0]}else{if(g!=="identity")throw new Error(`Unknown function type "${g}"`);x=Ac}if(u){const T={},A=[];for(let B=0;B<a.stops.length;B++){const V=a.stops[B],K=V[0].zoom;T[K]===void 0&&(T[K]={zoom:K,type:a.type,property:a.property,default:a.default,stops:[]},A.push(K)),T[K].stops.push([V[0].value,V[1]])}const I=[];for(const B of A)I.push([T[B].zoom,dy(T[B],t)]);const R={name:"linear"};return{kind:"composite",interpolationType:R,interpolationFactor:Co.interpolationFactor.bind(void 0,R),zoomStops:I.map(B=>B[0]),evaluate:({zoom:B},V)=>e1({stops:I,base:a.base},t,B).evaluate(B,V)}}if(h){const T=g==="exponential"?{name:"exponential",base:a.base!==void 0?a.base:1}:null;return{kind:"camera",interpolationType:T,interpolationFactor:Co.interpolationFactor.bind(void 0,T),zoomStops:a.stops.map(A=>A[0]),evaluate:({zoom:A})=>x(a,t,A,b,j)}}return{kind:"source",evaluate(T,A){const I=A&&A.properties?A.properties[a.property]:void 0;return I===void 0?Tu(a.default,t.default):x(a,t,I,b,j)}}}function Tu(a,t,i){return a!==void 0?a:t!==void 0?t:i!==void 0?i:void 0}function hy(a,t,i,u,h){return Tu(typeof i===h?u[i]:void 0,a.default,t.default)}function Qv(a,t,i){if(vc(i)!=="number")return Tu(a.default,t.default);const u=a.stops.length;if(u===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[u-1][0])return a.stops[u-1][1];const h=om(a.stops.map(g=>g[0]),i);return a.stops[h][1]}function e1(a,t,i){const u=a.base!==void 0?a.base:1;if(vc(i)!=="number")return Tu(a.default,t.default);const h=a.stops.length;if(h===1||i<=a.stops[0][0])return a.stops[0][1];if(i>=a.stops[h-1][0])return a.stops[h-1][1];const g=om(a.stops.map(A=>A[0]),i),x=function(A,I,R,B){const V=B-R,K=A-R;return V===0?0:I===1?K/V:(Math.pow(I,K)-1)/(Math.pow(I,V)-1)}(i,u,a.stops[g][0],a.stops[g+1][0]),b=a.stops[g][1],j=a.stops[g+1][1];let T=ip[t.type]||Jv;if(a.colorSpace&&a.colorSpace!=="rgb"){const A=lm[a.colorSpace];T=(I,R)=>A.reverse(A.interpolate(A.forward(I),A.forward(R),x))}return typeof b.evaluate=="function"?{evaluate(...A){const I=b.evaluate.apply(void 0,A),R=j.evaluate.apply(void 0,A);if(I!==void 0&&R!==void 0)return T(I,R,x)}}:T(b,j,x)}function Ac(a,t,i){return t.type==="color"?i=En.parse(i):t.type==="formatted"?i=ho.fromString(i.toString()):t.type==="resolvedImage"?i=Eo.build(i.toString()):vc(i)===t.type||t.type==="enum"&&t.values[i]||(i=void 0),Tu(i,a.default,t.default)}_i.register(Ed,{error:[{kind:"error"},[jn],(a,[t])=>{throw new Vr(t.evaluate(a))}],typeof:[jn,[Cn],(a,[t])=>Gr(Kt(t.evaluate(a)))],"to-rgba":[Ji(cs,4),[Lo],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ji(cs,4),[Lo],(a,[t])=>t.evaluate(a).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[Lo,[cs,cs,cs],cy],rgba:[Lo,[cs,cs,cs,cs],cy],hsl:[Lo,[cs,cs,cs],Zv],hsla:[Lo,[cs,cs,cs,cs],Zv],has:{type:Tn,overloads:[[[jn],(a,[t])=>Kv(t.evaluate(a),a.properties())],[[jn,Ol],(a,[t,i])=>Kv(t.evaluate(a),i.evaluate(a))]]},get:{type:Cn,overloads:[[[jn],(a,[t])=>mm(t.evaluate(a),a.properties())],[[jn,Ol],(a,[t,i])=>mm(t.evaluate(a),i.evaluate(a))]]},"feature-state":[Cn,[jn],(a,[t])=>mm(t.evaluate(a),a.featureState||{})],properties:[Ol,[],a=>a.properties()],"geometry-type":[jn,[],a=>a.geometryType()],worldview:[jn,[],a=>a.globals.worldview||""],id:[Cn,[],a=>a.id()],zoom:[cs,[],a=>a.globals.zoom],pitch:[cs,[],a=>a.globals.pitch||0],"distance-from-center":[cs,[],a=>a.distanceFromCenter()],"measure-light":[cs,[jn],(a,[t])=>a.measureLight(t.evaluate(a))],"heatmap-density":[cs,[],a=>a.globals.heatmapDensity||0],"line-progress":[cs,[],a=>a.globals.lineProgress||0],"raster-value":[cs,[],a=>a.globals.rasterValue||0],"raster-particle-speed":[cs,[],a=>a.globals.rasterParticleSpeed||0],"sky-radial-progress":[cs,[],a=>a.globals.skyRadialProgress||0],accumulated:[Cn,[],a=>a.globals.accumulated===void 0?null:a.globals.accumulated],"+":[cs,Nc(cs),(a,t)=>{let i=0;for(const u of t)i+=u.evaluate(a);return i}],"*":[cs,Nc(cs),(a,t)=>{let i=1;for(const u of t)i*=u.evaluate(a);return i}],"-":{type:cs,overloads:[[[cs,cs],(a,[t,i])=>t.evaluate(a)-i.evaluate(a)],[[cs],(a,[t])=>-t.evaluate(a)]]},"/":[cs,[cs,cs],(a,[t,i])=>t.evaluate(a)/i.evaluate(a)],"%":[cs,[cs,cs],(a,[t,i])=>t.evaluate(a)%i.evaluate(a)],ln2:[cs,[],()=>Math.LN2],pi:[cs,[],()=>Math.PI],e:[cs,[],()=>Math.E],"^":[cs,[cs,cs],(a,[t,i])=>Math.pow(t.evaluate(a),i.evaluate(a))],sqrt:[cs,[cs],(a,[t])=>Math.sqrt(t.evaluate(a))],log10:[cs,[cs],(a,[t])=>Math.log(t.evaluate(a))/Math.LN10],ln:[cs,[cs],(a,[t])=>Math.log(t.evaluate(a))],log2:[cs,[cs],(a,[t])=>Math.log(t.evaluate(a))/Math.LN2],sin:[cs,[cs],(a,[t])=>Math.sin(t.evaluate(a))],cos:[cs,[cs],(a,[t])=>Math.cos(t.evaluate(a))],tan:[cs,[cs],(a,[t])=>Math.tan(t.evaluate(a))],asin:[cs,[cs],(a,[t])=>Math.asin(t.evaluate(a))],acos:[cs,[cs],(a,[t])=>Math.acos(t.evaluate(a))],atan:[cs,[cs],(a,[t])=>Math.atan(t.evaluate(a))],min:[cs,Nc(cs),(a,t)=>Math.min(...t.map(i=>i.evaluate(a)))],max:[cs,Nc(cs),(a,t)=>Math.max(...t.map(i=>i.evaluate(a)))],abs:[cs,[cs],(a,[t])=>Math.abs(t.evaluate(a))],round:[cs,[cs],(a,[t])=>{const i=t.evaluate(a);return i<0?-Math.round(-i):Math.round(i)}],floor:[cs,[cs],(a,[t])=>Math.floor(t.evaluate(a))],ceil:[cs,[cs],(a,[t])=>Math.ceil(t.evaluate(a))],"filter-==":[Tn,[jn,Cn],(a,[t,i])=>a.properties()[t.value]===i.value],"filter-id-==":[Tn,[Cn],(a,[t])=>a.id()===t.value],"filter-type-==":[Tn,[jn],(a,[t])=>a.geometryType()===t.value],"filter-<":[Tn,[jn,Cn],(a,[t,i])=>{const u=a.properties()[t.value],h=i.value;return typeof u==typeof h&&u<h}],"filter-id-<":[Tn,[Cn],(a,[t])=>{const i=a.id(),u=t.value;return typeof i==typeof u&&i<u}],"filter->":[Tn,[jn,Cn],(a,[t,i])=>{const u=a.properties()[t.value],h=i.value;return typeof u==typeof h&&u>h}],"filter-id->":[Tn,[Cn],(a,[t])=>{const i=a.id(),u=t.value;return typeof i==typeof u&&i>u}],"filter-<=":[Tn,[jn,Cn],(a,[t,i])=>{const u=a.properties()[t.value],h=i.value;return typeof u==typeof h&&u<=h}],"filter-id-<=":[Tn,[Cn],(a,[t])=>{const i=a.id(),u=t.value;return typeof i==typeof u&&i<=u}],"filter->=":[Tn,[jn,Cn],(a,[t,i])=>{const u=a.properties()[t.value],h=i.value;return typeof u==typeof h&&u>=h}],"filter-id->=":[Tn,[Cn],(a,[t])=>{const i=a.id(),u=t.value;return typeof i==typeof u&&i>=u}],"filter-has":[Tn,[Cn],(a,[t])=>t.value in a.properties()],"filter-has-id":[Tn,[],a=>a.id()!==null&&a.id()!==void 0],"filter-type-in":[Tn,[Ji(jn)],(a,[t])=>t.value.indexOf(a.geometryType())>=0],"filter-id-in":[Tn,[Ji(Cn)],(a,[t])=>t.value.indexOf(a.id())>=0],"filter-in-small":[Tn,[jn,Ji(Cn)],(a,[t,i])=>i.value.indexOf(a.properties()[t.value])>=0],"filter-in-large":[Tn,[jn,Ji(Cn)],(a,[t,i])=>function(u,h,g,x){for(;g<=x;){const b=g+x>>1;if(h[b]===u)return!0;h[b]>u?x=b-1:g=b+1}return!1}(a.properties()[t.value],i.value,0,i.value.length-1)],all:{type:Tn,overloads:[[[Tn,Tn],(a,[t,i])=>t.evaluate(a)&&i.evaluate(a)],[Nc(Tn),(a,t)=>{for(const i of t)if(!i.evaluate(a))return!1;return!0}]]},any:{type:Tn,overloads:[[[Tn,Tn],(a,[t,i])=>t.evaluate(a)||i.evaluate(a)],[Nc(Tn),(a,t)=>{for(const i of t)if(i.evaluate(a))return!0;return!1}]]},"!":[Tn,[Tn],(a,[t])=>!t.evaluate(a)],"is-supported-script":[Tn,[jn],(a,[t])=>{const i=a.globals&&a.globals.isSupportedScript;return!i||i(t.evaluate(a))}],upcase:[jn,[jn],(a,[t])=>t.evaluate(a).toUpperCase()],downcase:[jn,[jn],(a,[t])=>t.evaluate(a).toLowerCase()],concat:[jn,Nc(Cn),(a,t)=>t.map(i=>ja(i.evaluate(a))).join("")],"resolved-locale":[jn,[Gf],(a,[t])=>t.evaluate(a).resolvedLocale()],random:[cs,[cs,cs,Cn],(a,t)=>{const[i,u,h]=t.map(x=>x.evaluate(a));if(i>u||i===u)return i;let g;if(typeof h=="string")g=function(x){let b=0;if(x.length===0)return b;for(let j=0;j<x.length;j++)b=(b<<5)-b+x.charCodeAt(j),b|=0;return b}(h);else{if(typeof h!="number")throw new Vr(`Invalid seed input: ${h}`);g=h}return i+qv(g)()*(u-i)}]});class py{constructor(t,i,u,h){this.expression=t,this._warningHistory={},this._evaluator=new dp(u,h),this._defaultValue=i?function(g){return g.type==="color"&&(ym(g.default)||Array.isArray(g.default))?new En(0,0,0,0):g.type==="color"?En.parse(g.default)||null:g.default===void 0?null:g.default}(i):null,this._enumValues=i&&i.type==="enum"?i.values:null,this.configDependencies=nm(t)}evaluateWithoutErrorHandling(t,i,u,h,g,x,b,j){return this._evaluator.globals=t,this._evaluator.feature=i,this._evaluator.featureState=u,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=j||null,this.expression.evaluate(this._evaluator)}evaluate(t,i,u,h,g,x,b,j){this._evaluator.globals=t,this._evaluator.feature=i||null,this._evaluator.featureState=u||null,this._evaluator.canonical=h||null,this._evaluator.availableImages=g||null,this._evaluator.formattedSection=x||null,this._evaluator.featureTileCoord=b||null,this._evaluator.featureDistanceData=j||null;try{const T=this.expression.evaluate(this._evaluator);if(T==null||typeof T=="number"&&T!=T)return this._defaultValue;if(this._enumValues&&!(T in this._enumValues))throw new Vr(`Expected value to be one of ${Object.keys(this._enumValues).map(A=>JSON.stringify(A)).join(", ")}, but found ${JSON.stringify(T)} instead.`);return T}catch(T){return this._warningHistory[T.message]||(this._warningHistory[T.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${T.message}`)),this._defaultValue}}}function fy(a){return Array.isArray(a)&&a.length>0&&typeof a[0]=="string"&&a[0]in Ed}function Nu(a,t,i,u){const h=new im(Ed,[],t?function(x){const b={color:Lo,string:jn,number:cs,enum:jn,boolean:Tn,formatted:op,resolvedImage:ap};return x.type==="array"?Ji(b[x.value]||Cn,x.length):b[x.type]}(t):void 0,void 0,void 0,i,u),g=h.parse(a,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return g?uy(new py(g,t,i,u)):Ec(h.errors)}class _m{constructor(t,i,u,h){this.kind=t,this._styleExpression=i,this.isLightConstant=u,this.isLineProgressConstant=h,this.isStateDependent=t!=="constant"&&!sm(i.expression),this.configDependencies=nm(i.expression)}evaluateWithoutErrorHandling(t,i,u,h,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,i,u,h,g,x)}evaluate(t,i,u,h,g,x){return this._styleExpression.evaluate(t,i,u,h,g,x)}}class Pc{constructor(t,i,u,h,g,x){this.kind=t,this.zoomStops=u,this._styleExpression=i,this.isStateDependent=t!=="camera"&&!sm(i.expression),this.isLightConstant=g,this.isLineProgressConstant=x,this.configDependencies=nm(i.expression),this.interpolationType=h}evaluateWithoutErrorHandling(t,i,u,h,g,x){return this._styleExpression.evaluateWithoutErrorHandling(t,i,u,h,g,x)}evaluate(t,i,u,h,g,x){return this._styleExpression.evaluate(t,i,u,h,g,x)}interpolationFactor(t,i,u){return this.interpolationType?Co.interpolationFactor(this.interpolationType,t,i,u):0}}function my(a,t,i,u){if((a=Nu(a,t,i,u)).result==="error")return a;const h=a.value.expression,g=bd(h);if(!g&&!gm(t))return Ec([new ta("","data expressions not supported")]);const x=wd(h,["zoom","pitch","distance-from-center"]);if(!x&&!Yv(t))return Ec([new ta("","zoom expressions not supported")]);const b=wd(h,["measure-light"]);if(!b&&!Xv(t))return Ec([new ta("","measure-light expression not supported")]);const j=wd(h,["line-progress"]);if(!j&&!function(I){return Cc(I.expression,"line-progress")}(t))return Ec([new ta("","line-progress expression not supported")]);const T=t.expression&&t.expression.relaxZoomRestriction,A=_p(h);return A||x||T?A instanceof ta?Ec([A]):A instanceof Co&&!xm(t)?Ec([new ta("",'"interpolate" expressions cannot be used with this property')]):uy(A?new Pc(g&&j?"camera":"composite",a.value,A.labels,A instanceof Co?A.interpolation:void 0,b,j):new _m(g&&j?"constant":"source",a.value,b,j)):Ec([new ta("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Eu{constructor(t,i){this._parameters=t,this._specification=i,yu(this,dy(this._parameters,this._specification))}static deserialize(t){return new Eu(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function _p(a){let t=null;if(a instanceof yp)t=_p(a.result);else if(a instanceof cm){for(const i of a.args)if(t=_p(i),t)break}else(a instanceof gp||a instanceof Co)&&a.input instanceof _i&&a.input.name==="zoom"&&(t=a);return t instanceof ta||a.eachChild(i=>{const u=_p(i);u instanceof ta?t=u:t&&u&&t!==u&&(t=new ta("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))}),t}var gy,t1,xy=function(){if(t1)return gy;t1=1,gy=t;var a=3;function t(i,u,h){var g=this.cells=[];if(i instanceof ArrayBuffer){this.arrayBuffer=i;var x=new Int32Array(this.arrayBuffer);i=x[0],this.d=(u=x[1])+2*(h=x[2]);for(var b=0;b<this.d*this.d;b++){var j=x[a+b],T=x[a+b+1];g.push(j===T?null:x.subarray(j,T))}var A=x[a+g.length+1];this.keys=x.subarray(x[a+g.length],A),this.bboxes=x.subarray(A),this.insert=this._insertReadonly}else{this.d=u+2*h;for(var I=0;I<this.d*this.d;I++)g.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=i,this.padding=h,this.scale=u/i,this.uid=0;var R=h/u*i;this.min=-R,this.max=i+R}return t.prototype.insert=function(i,u,h,g,x){this._forEachCell(u,h,g,x,this._insertCell,this.uid++),this.keys.push(i),this.bboxes.push(u),this.bboxes.push(h),this.bboxes.push(g),this.bboxes.push(x)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(i,u,h,g,x,b){this.cells[x].push(b)},t.prototype.query=function(i,u,h,g,x){var b=this.min,j=this.max;if(i<=b&&u<=b&&j<=h&&j<=g&&!x)return Array.prototype.slice.call(this.keys);var T=[];return this._forEachCell(i,u,h,g,this._queryCell,T,{},x),T},t.prototype._queryCell=function(i,u,h,g,x,b,j,T){var A=this.cells[x];if(A!==null)for(var I=this.keys,R=this.bboxes,B=0;B<A.length;B++){var V=A[B];if(j[V]===void 0){var K=4*V;(T?T(R[K+0],R[K+1],R[K+2],R[K+3]):i<=R[K+2]&&u<=R[K+3]&&h>=R[K+0]&&g>=R[K+1])?(j[V]=!0,b.push(I[V])):j[V]=!1}}},t.prototype._forEachCell=function(i,u,h,g,x,b,j,T){for(var A=this._convertToCellCoord(i),I=this._convertToCellCoord(u),R=this._convertToCellCoord(h),B=this._convertToCellCoord(g),V=A;V<=R;V++)for(var K=I;K<=B;K++){var Q=this.d*K+V;if((!T||T(this._convertFromCellCoord(V),this._convertFromCellCoord(K),this._convertFromCellCoord(V+1),this._convertFromCellCoord(K+1)))&&x.call(this,i,u,h,g,Q,b,j,T))return}},t.prototype._convertFromCellCoord=function(i){return(i-this.padding)/this.scale},t.prototype._convertToCellCoord=function(i){return Math.max(0,Math.min(this.d-1,Math.floor(i*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var i=this.cells,u=a+this.cells.length+1+1,h=0,g=0;g<this.cells.length;g++)h+=this.cells[g].length;var x=new Int32Array(u+h+this.keys.length+this.bboxes.length);x[0]=this.extent,x[1]=this.n,x[2]=this.padding;for(var b=u,j=0;j<i.length;j++){var T=i[j];x[a+j]=b,x.set(T,b),b+=T.length}return x[a+i.length]=b,x.set(this.keys,b),x[a+i.length+1]=b+=this.keys.length,x.set(this.bboxes,b),b+=this.bboxes.length,x.buffer},gy}(),Ic=kl(xy);const vp={};function Yt(a,t,i={}){Object.defineProperty(a,"_classRegistryKey",{value:t,writable:!1}),vp[t]={klass:a,omit:i.omit||[]}}Yt(Object,"Object"),Ic.serialize=function(a,t){const i=a.toArrayBuffer();return t&&t.add(i),{buffer:i}},Ic.deserialize=function(a){return new Ic(a.buffer)},Object.defineProperty(Ic,"name",{value:"Grid"}),Yt(Ic,"Grid"),delete et.prototype.constructor,typeof DOMMatrix<"u"&&Yt(DOMMatrix,"DOMMatrix"),Yt(En,"Color"),Yt(Error,"Error"),Yt(ho,"Formatted"),Yt(Wf,"FormattedSection"),Yt(hn,"AJAXError"),Yt(Eo,"ResolvedImage"),Yt(Eu,"StylePropertyFunction"),Yt(py,"StyleExpression",{omit:["_evaluator"]}),Yt(Do,"ImageId"),Yt(Fl,"ImageVariant"),Yt(Pc,"ZoomDependentExpression"),Yt(_m,"ZoomConstantExpression"),Yt(_i,"CompoundExpression",{omit:["_evaluate"]});for(const a in Ed)vp[Ed[a]._classRegistryKey]||Yt(Ed[a],`Expression${a}`);function vm(a){return a&&typeof ArrayBuffer<"u"&&(a instanceof ArrayBuffer||a.constructor&&a.constructor.name==="ArrayBuffer")}function bp(a){return self.ImageBitmap&&a instanceof ImageBitmap}function Bl(a,t){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp)return a;if(vm(a)||bp(a))return t&&t.add(a),a;if(ArrayBuffer.isView(a))return t&&t.add(a.buffer),a;if(a instanceof ImageData)return t&&t.add(a.data.buffer),a;if(Array.isArray(a)){const i=[];for(const u of a)i.push(Bl(u,t));return i}if(a instanceof Map){const i={$name:"Map",entries:[]};for(const[u,h]of a.entries())i.entries.push(Bl(u),Bl(h,t));return i}if(a instanceof Set){const i={$name:"Set"};let u=0;for(const h of a.values())i[++u]=Bl(h);return i}if(a instanceof DOMMatrix){const i={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const h of u)i[h]=a[h];return i}if(typeof a=="bigint")return{$name:"BigInt",value:a.toString()};if(typeof a=="object"){const i=a.constructor,u=i._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${i.name}".`);const h=i.serialize?i.serialize(a,t):{};if(!i.serialize){for(const g in a)a.hasOwnProperty(g)&&(vp[u].omit.indexOf(g)>=0||(h[g]=Bl(a[g],t)));a instanceof Error&&(h.message=a.message)}if(h.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(h.$name=u),h}throw new Error("can't serialize object of type "+typeof a)}function Ao(a){if(a==null||typeof a=="boolean"||typeof a=="number"||typeof a=="string"||a instanceof Boolean||a instanceof Number||a instanceof String||a instanceof Date||a instanceof RegExp||vm(a)||bp(a)||ArrayBuffer.isView(a)||a instanceof ImageData)return a;if(Array.isArray(a))return a.map(Ao);if(typeof a=="object"){const t=a.$name||"Object";if(t==="Map"){const h=a.entries||[],g=new Map;for(let x=0;x<h.length;x+=2)g.set(Ao(h[x]),Ao(h[x+1]));return g}if(t==="Set"){const h=new Set;for(const g of Object.keys(a))g!=="$name"&&h.add(Ao(a[g]));return h}if(t==="DOMMatrix"){let h;return h=a.is2D?[a.a,a.b,a.c,a.d,a.e,a.f]:[a.m11,a.m12,a.m13,a.m14,a.m21,a.m22,a.m23,a.m24,a.m31,a.m32,a.m33,a.m34,a.m41,a.m42,a.m43,a.m44],new DOMMatrix(h)}if(t==="BigInt")return BigInt(a.value);const{klass:i}=vp[t];if(!i)throw new Error(`Can't deserialize unregistered class "${t}".`);if(i.deserialize)return i.deserialize(a);const u=Object.create(i.prototype);for(const h of Object.keys(a))h!=="$name"&&(u[h]=Ao(a[h]));return u}throw new Error("can't deserialize object of type "+typeof a)}const ys={"Latin-1 Supplement":a=>a>=128&&a<=255,Arabic:a=>a>=1536&&a<=1791,"Arabic Supplement":a=>a>=1872&&a<=1919,"Arabic Extended-A":a=>a>=2208&&a<=2303,"Hangul Jamo":a=>a>=4352&&a<=4607,"Unified Canadian Aboriginal Syllabics":a=>a>=5120&&a<=5759,Khmer:a=>a>=6016&&a<=6143,"Unified Canadian Aboriginal Syllabics Extended":a=>a>=6320&&a<=6399,"General Punctuation":a=>a>=8192&&a<=8303,"Letterlike Symbols":a=>a>=8448&&a<=8527,"Number Forms":a=>a>=8528&&a<=8591,"Miscellaneous Technical":a=>a>=8960&&a<=9215,"Control Pictures":a=>a>=9216&&a<=9279,"Optical Character Recognition":a=>a>=9280&&a<=9311,"Enclosed Alphanumerics":a=>a>=9312&&a<=9471,"Geometric Shapes":a=>a>=9632&&a<=9727,"Miscellaneous Symbols":a=>a>=9728&&a<=9983,"Miscellaneous Symbols and Arrows":a=>a>=11008&&a<=11263,"CJK Radicals Supplement":a=>a>=11904&&a<=12031,"Kangxi Radicals":a=>a>=12032&&a<=12255,"Ideographic Description Characters":a=>a>=12272&&a<=12287,"CJK Symbols and Punctuation":a=>a>=12288&&a<=12351,Hiragana:a=>a>=12352&&a<=12447,Katakana:a=>a>=12448&&a<=12543,Bopomofo:a=>a>=12544&&a<=12591,"Hangul Compatibility Jamo":a=>a>=12592&&a<=12687,Kanbun:a=>a>=12688&&a<=12703,"Bopomofo Extended":a=>a>=12704&&a<=12735,"CJK Strokes":a=>a>=12736&&a<=12783,"Katakana Phonetic Extensions":a=>a>=12784&&a<=12799,"Enclosed CJK Letters and Months":a=>a>=12800&&a<=13055,"CJK Compatibility":a=>a>=13056&&a<=13311,"CJK Unified Ideographs Extension A":a=>a>=13312&&a<=19903,"Yijing Hexagram Symbols":a=>a>=19904&&a<=19967,"CJK Unified Ideographs":a=>a>=19968&&a<=40959,"Yi Syllables":a=>a>=40960&&a<=42127,"Yi Radicals":a=>a>=42128&&a<=42191,"Hangul Jamo Extended-A":a=>a>=43360&&a<=43391,"Hangul Syllables":a=>a>=44032&&a<=55215,"Hangul Jamo Extended-B":a=>a>=55216&&a<=55295,"Private Use Area":a=>a>=57344&&a<=63743,"CJK Compatibility Ideographs":a=>a>=63744&&a<=64255,"Arabic Presentation Forms-A":a=>a>=64336&&a<=65023,"Vertical Forms":a=>a>=65040&&a<=65055,"CJK Compatibility Forms":a=>a>=65072&&a<=65103,"Small Form Variants":a=>a>=65104&&a<=65135,"Arabic Presentation Forms-B":a=>a>=65136&&a<=65279,"Halfwidth and Fullwidth Forms":a=>a>=65280&&a<=65519,Osage:a=>a>=66736&&a<=66815,"CJK Unified Ideographs Extension B":a=>a>=131072&&a<=173791};function yy(a){for(const t of a)if(bm(t.charCodeAt(0)))return!0;return!1}function US(a){for(const t of a)if(!$S(t.charCodeAt(0)))return!1;return!0}function $S(a){return!(ys.Arabic(a)||ys["Arabic Supplement"](a)||ys["Arabic Extended-A"](a)||ys["Arabic Presentation Forms-A"](a)||ys["Arabic Presentation Forms-B"](a))}function bm(a){return!(a!==746&&a!==747&&(a<4352||!(ys["Bopomofo Extended"](a)||ys.Bopomofo(a)||ys["CJK Compatibility Forms"](a)&&!(a>=65097&&a<=65103)||ys["CJK Compatibility Ideographs"](a)||ys["CJK Compatibility"](a)||ys["CJK Radicals Supplement"](a)||ys["CJK Strokes"](a)||!(!ys["CJK Symbols and Punctuation"](a)||a>=12296&&a<=12305||a>=12308&&a<=12319||a===12336)||ys["CJK Unified Ideographs Extension A"](a)||ys["CJK Unified Ideographs"](a)||ys["Enclosed CJK Letters and Months"](a)||ys["Hangul Compatibility Jamo"](a)||ys["Hangul Jamo Extended-A"](a)||ys["Hangul Jamo Extended-B"](a)||ys["Hangul Jamo"](a)||ys["Hangul Syllables"](a)||ys.Hiragana(a)||ys["Ideographic Description Characters"](a)||ys.Kanbun(a)||ys["Kangxi Radicals"](a)||ys["Katakana Phonetic Extensions"](a)||ys.Katakana(a)&&a!==12540||!(!ys["Halfwidth and Fullwidth Forms"](a)||a===65288||a===65289||a===65293||a>=65306&&a<=65310||a===65339||a===65341||a===65343||a>=65371&&a<=65503||a===65507||a>=65512&&a<=65519)||!(!ys["Small Form Variants"](a)||a>=65112&&a<=65118||a>=65123&&a<=65126)||ys["Unified Canadian Aboriginal Syllabics"](a)||ys["Unified Canadian Aboriginal Syllabics Extended"](a)||ys["Vertical Forms"](a)||ys["Yijing Hexagram Symbols"](a)||ys["Yi Syllables"](a)||ys["Yi Radicals"](a))))}function wm(a){return!(bm(a)||function(t){return!!(ys["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||ys["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||ys["Letterlike Symbols"](t)||ys["Number Forms"](t)||ys["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||ys["Control Pictures"](t)&&t!==9251||ys["Optical Character Recognition"](t)||ys["Enclosed Alphanumerics"](t)||ys["Geometric Shapes"](t)||ys["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||ys["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||ys["CJK Symbols and Punctuation"](t)||ys.Katakana(t)||ys["Private Use Area"](t)||ys["CJK Compatibility Forms"](t)||ys["Small Form Variants"](t)||ys["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)}(a))}function s1(a){return ys.Arabic(a)||ys["Arabic Supplement"](a)||ys["Arabic Extended-A"](a)||ys["Arabic Presentation Forms-A"](a)||ys["Arabic Presentation Forms-B"](a)}function Sm(a){return a>=1424&&a<=2303||ys["Arabic Presentation Forms-A"](a)||ys["Arabic Presentation Forms-B"](a)}function GS(a,t){return!(!t&&Sm(a)||a>=2304&&a<=3583||a>=3840&&a<=4255||ys.Khmer(a))}function HS(a){for(const t of a)if(Sm(t.charCodeAt(0)))return!0;return!1}const zo={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let _y=null,fo=zo.unavailable,Mc=null;const n1=function(a){a&&typeof a=="string"&&a.indexOf("NetworkError")>-1&&(fo=zo.error),_y&&_y(a)};function vy(){by.fire(new zl("pluginStateChange",{pluginStatus:fo,pluginURL:Mc}))}const by=new xu,wy=function(){return fo},r1=function(){if(fo!==zo.deferred||!Mc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");fo=zo.loading,vy(),Mc&&ep({url:Mc},a=>{a?n1(a):(fo=zo.loaded,vy())})},fl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>fo===zo.loaded||fl.applyArabicShaping!=null,isLoading:()=>fo===zo.loading,setState(a){fo=a.pluginStatus,Mc=a.pluginURL},isParsing:()=>fo===zo.parsing,isParsed:()=>fo===zo.parsed,getPluginURL:()=>Mc};class Mn{constructor(t,i){this.zoom=t,i?(this.now=i.now,this.fadeDuration=i.fadeDuration,this.transition=i.transition,this.pitch=i.pitch,this.brightness=i.brightness,this.worldview=i.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return function(i,u){for(const h of i)if(!GS(h.charCodeAt(0),u))return!1;return!0}(t,fl.isLoaded())}}class wp{constructor(t,i,u,h){this.property=t,this.value=i,this.expression=function(g,x,b,j){if(ym(g))return new Eu(g,x);if(fy(g)||Array.isArray(g)&&g.length>0){const T=my(g,x,b,j);if(T.result==="error")throw new Error(T.value.map(A=>`${A.key}: ${A.message}`).join(", "));return T.value}{let T=g;return typeof g=="string"&&x.type==="color"&&(T=En.parse(g)),{kind:"constant",configDependencies:new Set,evaluate:()=>T}}}(i===void 0?t.specification.default:i,t.specification,u,h)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,i,u){return this.property.possiblyEvaluate(this,t,i,u)}}class jm{constructor(t,i,u){this.property=t,this.value=new wp(t,void 0,i,u)}transitioned(t,i){return new i1(this.property,this.value,i,He({},t.transition,this.transition),t.now)}untransitioned(){return new i1(this.property,this.value,null,{},0)}}class Sp{constructor(t,i,u){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(t){return Hs(this._values[t].value.value)}setValue(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new jm(this._values[t].property,this._scope,this._options)),this._values[t].value=new wp(this._values[t].property,i===null?void 0:Hs(i),this._scope,this._options),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,i){i&&(this._options=i);const u=this._properties.properties;if(t)for(const h in t){const g=t[h];if(h.endsWith("-transition")){const x=h.slice(0,-11);u[x]&&this.setTransition(x,g)}else u.hasOwnProperty(h)&&this.setValue(h,g)}}getTransition(t){return Hs(this._values[t].transition)}setTransition(t,i){this._values.hasOwnProperty(t)||(this._values[t]=new jm(this._values[t].property)),this._values[t].transition=Hs(i)||void 0}serialize(){const t={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(t[i]=u);const h=this.getTransition(i);h!==void 0&&(t[`${i}-transition`]=h)}return t}transitioned(t,i){const u=new o1(this._properties);for(const h of Object.keys(this._values))u._values[h]=this._values[h].transitioned(t,i._values[h]);return u}untransitioned(){const t=new o1(this._properties);for(const i of Object.keys(this._values))t._values[i]=this._values[i].untransitioned();return t}}class i1{constructor(t,i,u,h,g){const x=h.delay||0,b=h.duration||0;g=g||0,this.property=t,this.value=i,this.begin=g+x,this.end=this.begin+b,t.specification.transition&&(h.delay||h.duration)&&(this.prior=u)}possiblyEvaluate(t,i,u){const h=t.now||0,g=this.value.possiblyEvaluate(t,i,u),x=this.prior;if(x){if(h>this.end)return this.prior=null,g;if(this.value.isDataDriven())return this.prior=null,g;if(h<this.begin)return x.possiblyEvaluate(t,i,u);{const b=(h-this.begin)/(this.end-this.begin);return this.property.interpolate(x.possiblyEvaluate(t,i,u),g,ie(b))}}return g}}class o1{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,i,u){const h=new Wa(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,u);return h}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Rc{constructor(t,i,u){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=i,this._options=u,this.configDependencies=new Set}getValue(t){return Hs(this._values[t].value)}setValue(t,i){this._values[t]=new wp(this._values[t].property,i===null?void 0:Hs(i),this._scope,this._options),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const i of Object.keys(this._values)){const u=this.getValue(i);u!==void 0&&(t[i]=u)}return t}possiblyEvaluate(t,i,u){const h=new Wa(this._properties);for(const g of Object.keys(this._values))h._values[g]=this._values[g].possiblyEvaluate(t,i,u);return h}}class Cu{constructor(t,i,u){this.property=t,this.value=i,this.parameters=u}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,i,u,h){return this.property.evaluate(this.value,this.parameters,t,i,u,h)}}class Wa{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class Nt{constructor(t){this.specification=t}possiblyEvaluate(t,i){return t.expression.evaluate(i)}interpolate(t,i,u){const h=ip[this.specification.type];return h?h(t,i,u):t}}class Gt{constructor(t,i){this.specification=t,this.overrides=i}possiblyEvaluate(t,i,u,h){return new Cu(this,t.expression.kind==="constant"||t.expression.kind==="camera"?{kind:"constant",value:t.expression.evaluate(i,null,{},u,h)}:t.expression,i)}interpolate(t,i,u){if(t.value.kind!=="constant"||i.value.kind!=="constant")return t;if(t.value.value===void 0||i.value.value===void 0)return new Cu(this,{kind:"constant",value:void 0},t.parameters);const h=ip[this.specification.type];return h?new Cu(this,{kind:"constant",value:h(t.value.value,i.value.value,u)},t.parameters):t}evaluate(t,i,u,h,g,x){return t.kind==="constant"?t.value:t.evaluate(i,u,h,g,x)}}class Cd{constructor(t){this.specification=t}possiblyEvaluate(t,i,u,h){return!!t.expression.evaluate(i,null,{},u,h)}interpolate(){return!1}}class Er{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const i=new Mn(0,{});for(const u in t){const h=t[u];h.specification.overridable&&this.overridableProperties.push(u);const g=this.defaultPropertyValues[u]=new wp(h,void 0),x=this.defaultTransitionablePropertyValues[u]=new jm(h);this.defaultTransitioningPropertyValues[u]=x.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=g.possiblyEvaluate(i)}}}Yt(Gt,"DataDrivenProperty"),Yt(Nt,"DataConstantProperty"),Yt(Cd,"ColorRampProperty");var Oe=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"expression"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function a1(a){return a instanceof Number||a instanceof String||a instanceof Boolean?a.valueOf():a}function jp(a){if(Array.isArray(a))return a.map(jp);if(a instanceof Object&&!(a instanceof Number||a instanceof String||a instanceof Boolean)){const t={};for(const i in a)t[i]=jp(a[i]);return t}return a1(a)}function Tp(a){if(a===!0||a===!1)return!0;if(!Array.isArray(a)||a.length===0)return!1;switch(a[0]){case"has":return a.length>=2&&a[1]!=="$id"&&a[1]!=="$type";case"in":return a.length>=3&&(typeof a[1]!="string"||Array.isArray(a[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return a.length!==3||Array.isArray(a[1])||Array.isArray(a[2]);case"any":case"all":for(const t of a.slice(1))if(!Tp(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function Ad(a,t="",i=null,u="fill"){if(a==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};Tp(a)||(a=Nm(a));const h=a;let g=!0;try{g=function(A){if(!Pd(A))return A;let I=jp(A);return Tm(I),I=Sy(I),I}(h)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(h,null,2)}
        `)}let x=null,b=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){b=Oe[`filter_${u}`];const A=Nu(g,b,t,i);if(A.result==="error")throw new Error(A.value.map(I=>`${I.key}: ${I.message}`).join(", "));x=(I,R,B)=>A.value.evaluate(I,R,{},B)}let j=null,T=null;if(g!==h){const A=Nu(h,b,t,i);if(A.result==="error")throw new Error(A.value.map(I=>`${I.key}: ${I.message}`).join(", "));j=(I,R,B,V,K)=>A.value.evaluate(I,R,{},B,void 0,void 0,V,K),T=!bd(A.value.expression)}return{filter:x,dynamicFilter:j||void 0,needGeometry:jy(g),needFeature:!!T}}function Sy(a){if(!Array.isArray(a))return a;const t=function(i){if(ml.has(i[0])){for(let u=1;u<i.length;u++)if(Pd(i[u]))return!0}return i}(a);return t===!0?t:t.map(i=>Sy(i))}function Tm(a){let t=!1;const i=[];if(a[0]==="case"){for(let u=1;u<a.length-1;u+=2)t=t||Pd(a[u]),i.push(a[u+1]);i.push(a[a.length-1])}else if(a[0]==="match"){t=t||Pd(a[1]);for(let u=2;u<a.length-1;u+=2)i.push(a[u+1]);i.push(a[a.length-1])}else if(a[0]==="step"){t=t||Pd(a[1]);for(let u=1;u<a.length-1;u+=2)i.push(a[u+1])}t&&(a.length=0,a.push("any",...i));for(let u=1;u<a.length;u++)Tm(a[u])}function Pd(a){if(!Array.isArray(a))return!1;if((t=a[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let i=1;i<a.length;i++)if(Pd(a[i]))return!0;return!1}const ml=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function WS(a,t){return a<t?-1:a>t?1:0}function jy(a){if(!Array.isArray(a))return!1;if(a[0]==="within"||a[0]==="distance")return!0;for(let t=1;t<a.length;t++)if(jy(a[t]))return!0;return!1}function Nm(a){if(!a)return!0;const t=a[0];return a.length<=1?t!=="any":t==="=="?Ty(a[1],a[2],"=="):t==="!="?Em(Ty(a[1],a[2],"==")):t==="<"||t===">"||t==="<="||t===">="?Ty(a[1],a[2],t):t==="any"?(i=a.slice(1),["any"].concat(i.map(Nm))):t==="all"?["all"].concat(a.slice(1).map(Nm)):t==="none"?["all"].concat(a.slice(1).map(Nm).map(Em)):t==="in"?l1(a[1],a.slice(2)):t==="!in"?Em(l1(a[1],a.slice(2))):t==="has"?c1(a[1]):t!=="!has"||Em(c1(a[1]));var i}function Ty(a,t,i){switch(a){case"$type":return[`filter-type-${i}`,t];case"$id":return[`filter-id-${i}`,t];default:return[`filter-${i}`,a,t]}}function l1(a,t){if(t.length===0)return!1;switch(a){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some(i=>typeof i!=typeof t[0])?["filter-in-large",a,["literal",t.sort(WS)]]:["filter-in-small",a,["literal",t]]}}function c1(a){switch(a){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",a]}}function Em(a){return["!",a]}const Np="";function Id(a,t){return t?`${a}${Np}${t}`:a}const u1="-transition",qS=new Set(["fill","line","background","hillshade","raster"]);class eo extends xu{constructor(t,i,u,h,g){if(super(),this.id=t.id,this.fqid=Id(this.id,u),this.type=t.type,this.scope=u,this.lut=h,this.options=g,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const x=Nu(this.filter,Oe[`filter_${t.type}`]);x.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...x.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),i.layout&&(this._unevaluatedLayout=new Rc(i.layout,this.scope,g),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),i.paint){this._transitionablePaint=new Sp(i.paint,this.scope,g);for(const x in t.paint)this.setPaintProperty(x,t.paint[x]);for(const x in t.layout)this.setLayoutProperty(x,t.layout[x]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new Wa(i.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&qS.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,i){if(this.type==="custom"&&t==="visibility")return void(this.visibility=i);const u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(u1)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,i){const u=this._transitionablePaint,h=u._properties.properties;if(t.endsWith(u1)){const I=t.slice(0,-11);return h[I]&&u.setTransition(I,i||void 0),!1}if(!h[t])return!1;const g=u._values[t],x=g.value.isDataDriven(),b=g.value;u.setValue(t,i),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const j=u._values[t].value,T=j.isDataDriven(),A=t.endsWith("pattern")||t==="line-dasharray";return T||x||A||this._handleOverridablePaintPropertyUpdate(t,b,j)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,i,u){return null}_handleOverridablePaintPropertyUpdate(t,i,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,i){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,i)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,i)}serialize(){return sn({id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()},(t,i)=>!(t===void 0||i==="layout"&&!Object.keys(t).length||i==="paint"&&!Object.keys(t).length))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const i=this.paint.get(t);if(i instanceof Cu&&gm(i.property.specification)&&(i.value.kind==="source"||i.value.kind==="composite")&&i.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=Ad(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}queryRadius(t){}queryIntersectsFeature(t,i,u,h,g,x,b,j,T){}}const ZS={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ep{constructor(t,i){this._structArray=t,this._pos1=i*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class or{constructor(){this.capacity=-1,this.resize(0)}static serialize(t,i){return t._trim(),i&&i.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const i=Object.create(this.prototype);return i.arrayBuffer=t.arrayBuffer,i.length=t.length,i.capacity=t.arrayBuffer.byteLength/i.bytesPerElement,i._refreshViews(),i}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const i=this.uint8;this._refreshViews(),i&&this.uint8.set(i)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ln(a,t=1){let i=0,u=0;return{members:a.map(h=>{const g=ZS[h.type].BYTES_PER_ELEMENT,x=i=Ny(i,Math.max(t,g)),b=h.components||1;return u=Math.max(u,g),i+=g*b,{name:h.name,type:h.type,components:b,offset:x}}),size:Ny(i,Math.max(u,t)),alignment:t}}function Ny(a,t){return Math.ceil(a/t)*t}class Po extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i){const u=this.length;return this.resize(u+1),this.emplace(u,t,i)}emplace(t,i,u){const h=2*t;return this.int16[h+0]=i,this.int16[h+1]=u,t}}Po.prototype.bytesPerElement=4,Yt(Po,"StructArrayLayout2i4");class Md extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,u)}emplace(t,i,u,h){const g=3*t;return this.int16[g+0]=i,this.int16[g+1]=u,this.int16[g+2]=h,t}}Md.prototype.bytesPerElement=6,Yt(Md,"StructArrayLayout3i6");class Rd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,u,h)}emplace(t,i,u,h,g){const x=4*t;return this.int16[x+0]=i,this.int16[x+1]=u,this.int16[x+2]=h,this.int16[x+3]=g,t}}Rd.prototype.bytesPerElement=8,Yt(Rd,"StructArrayLayout4i8");class Au extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.float32[1*t+0]=i,t}}Au.prototype.bytesPerElement=4,Yt(Au,"StructArrayLayout1f4");class Ey extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,u)}emplace(t,i,u,h){const g=4*t,x=2*t;return this.int16[g+0]=i,this.int16[g+1]=u,this.float32[x+1]=h,t}}Ey.prototype.bytesPerElement=8,Yt(Ey,"StructArrayLayout2i1f8");class Cy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,u)}emplace(t,i,u,h){const g=4*t;return this.int16[g+0]=i,this.int16[g+1]=u,this.int16[g+2]=h,t}}Cy.prototype.bytesPerElement=8,Yt(Cy,"StructArrayLayout3i8");class Cm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,u,h,g)}emplace(t,i,u,h,g,x){const b=5*t;return this.int16[b+0]=i,this.int16[b+1]=u,this.int16[b+2]=h,this.int16[b+3]=g,this.int16[b+4]=x,t}}Cm.prototype.bytesPerElement=10,Yt(Cm,"StructArrayLayout5i10");class Am extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,t,i,u,h,g,x,b)}emplace(t,i,u,h,g,x,b,j){const T=6*t,A=12*t,I=3*t;return this.int16[T+0]=i,this.int16[T+1]=u,this.uint8[A+4]=h,this.uint8[A+5]=g,this.uint8[A+6]=x,this.uint8[A+7]=b,this.float32[I+2]=j,t}}Am.prototype.bytesPerElement=12,Yt(Am,"StructArrayLayout2i4ub1f12");class na extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,u)}emplace(t,i,u,h){const g=3*t;return this.float32[g+0]=i,this.float32[g+1]=u,this.float32[g+2]=h,t}}na.prototype.bytesPerElement=12,Yt(na,"StructArrayLayout3f12");class kc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,u,h,g)}emplace(t,i,u,h,g,x){const b=6*t,j=3*t;return this.uint16[b+0]=i,this.uint16[b+1]=u,this.uint16[b+2]=h,this.uint16[b+3]=g,this.float32[j+2]=x,t}}kc.prototype.bytesPerElement=12,Yt(kc,"StructArrayLayout4ui1f12");class kd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,u,h)}emplace(t,i,u,h,g){const x=4*t;return this.uint16[x+0]=i,this.uint16[x+1]=u,this.uint16[x+2]=h,this.uint16[x+3]=g,t}}kd.prototype.bytesPerElement=8,Yt(kd,"StructArrayLayout4ui8");class Pm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,u,h,g,x)}emplace(t,i,u,h,g,x,b){const j=6*t;return this.int16[j+0]=i,this.int16[j+1]=u,this.int16[j+2]=h,this.int16[j+3]=g,this.int16[j+4]=x,this.int16[j+5]=b,t}}Pm.prototype.bytesPerElement=12,Yt(Pm,"StructArrayLayout6i12");class Im extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I,R){const B=this.length;return this.resize(B+1),this.emplace(B,t,i,u,h,g,x,b,j,T,A,I,R)}emplace(t,i,u,h,g,x,b,j,T,A,I,R,B){const V=12*t;return this.int16[V+0]=i,this.int16[V+1]=u,this.int16[V+2]=h,this.int16[V+3]=g,this.uint16[V+4]=x,this.uint16[V+5]=b,this.uint16[V+6]=j,this.uint16[V+7]=T,this.int16[V+8]=A,this.int16[V+9]=I,this.int16[V+10]=R,this.int16[V+11]=B,t}}Im.prototype.bytesPerElement=24,Yt(Im,"StructArrayLayout4i4ui4i24");class Dd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,u,h,g,x)}emplace(t,i,u,h,g,x,b){const j=10*t,T=5*t;return this.int16[j+0]=i,this.int16[j+1]=u,this.int16[j+2]=h,this.float32[T+2]=g,this.float32[T+3]=x,this.float32[T+4]=b,t}}Dd.prototype.bytesPerElement=20,Yt(Dd,"StructArrayLayout3i3f20");class Dc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,u,h)}emplace(t,i,u,h,g){const x=4*t;return this.float32[x+0]=i,this.float32[x+1]=u,this.float32[x+2]=h,this.float32[x+3]=g,t}}Dc.prototype.bytesPerElement=16,Yt(Dc,"StructArrayLayout4f16");class Ay extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint32[1*t+0]=i,t}}Ay.prototype.bytesPerElement=4,Yt(Ay,"StructArrayLayout1ul4");class gl extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i){const u=this.length;return this.resize(u+1),this.emplace(u,t,i)}emplace(t,i,u){const h=2*t;return this.uint16[h+0]=i,this.uint16[h+1]=u,t}}gl.prototype.bytesPerElement=4,Yt(gl,"StructArrayLayout2ui4");class Py extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I,R,B){const V=this.length;return this.resize(V+1),this.emplace(V,t,i,u,h,g,x,b,j,T,A,I,R,B)}emplace(t,i,u,h,g,x,b,j,T,A,I,R,B,V){const K=20*t,Q=10*t;return this.int16[K+0]=i,this.int16[K+1]=u,this.int16[K+2]=h,this.int16[K+3]=g,this.int16[K+4]=x,this.float32[Q+3]=b,this.float32[Q+4]=j,this.float32[Q+5]=T,this.float32[Q+6]=A,this.int16[K+14]=I,this.uint32[Q+8]=R,this.uint16[K+18]=B,this.uint16[K+19]=V,t}}Py.prototype.bytesPerElement=40,Yt(Py,"StructArrayLayout5i4f1i1ul2ui40");class Mm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,t,i,u,h,g,x,b)}emplace(t,i,u,h,g,x,b,j){const T=8*t;return this.int16[T+0]=i,this.int16[T+1]=u,this.int16[T+2]=h,this.int16[T+4]=g,this.int16[T+5]=x,this.int16[T+6]=b,this.int16[T+7]=j,t}}Mm.prototype.bytesPerElement=16,Yt(Mm,"StructArrayLayout3i2i2i16");class Ld extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,u,h,g)}emplace(t,i,u,h,g,x){const b=4*t,j=8*t;return this.float32[b+0]=i,this.float32[b+1]=u,this.float32[b+2]=h,this.int16[j+6]=g,this.int16[j+7]=x,t}}Ld.prototype.bytesPerElement=16,Yt(Ld,"StructArrayLayout2f1f2i16");class zd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,u,h,g,x)}emplace(t,i,u,h,g,x,b){const j=20*t,T=5*t;return this.uint8[j+0]=i,this.uint8[j+1]=u,this.float32[T+1]=h,this.float32[T+2]=g,this.float32[T+3]=x,this.float32[T+4]=b,t}}zd.prototype.bytesPerElement=20,Yt(zd,"StructArrayLayout2ub4f20");class ur extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,u){const h=this.length;return this.resize(h+1),this.emplace(h,t,i,u)}emplace(t,i,u,h){const g=3*t;return this.uint16[g+0]=i,this.uint16[g+1]=u,this.uint16[g+2]=h,t}}ur.prototype.bytesPerElement=6,Yt(ur,"StructArrayLayout3ui6");class Od extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee){const we=this.length;return this.resize(we+1),this.emplace(we,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee)}emplace(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee,we){const je=30*t,Me=15*t,ke=60*t;return this.int16[je+0]=i,this.int16[je+1]=u,this.int16[je+2]=h,this.float32[Me+2]=g,this.float32[Me+3]=x,this.uint16[je+8]=b,this.uint16[je+9]=j,this.uint32[Me+5]=T,this.uint32[Me+6]=A,this.uint32[Me+7]=I,this.uint16[je+16]=R,this.uint16[je+17]=B,this.uint16[je+18]=V,this.float32[Me+10]=K,this.float32[Me+11]=Q,this.uint8[ke+48]=re,this.uint8[ke+49]=ue,this.uint8[ke+50]=ce,this.uint32[Me+13]=he,this.int16[je+28]=Ee,this.uint8[ke+58]=we,t}}Od.prototype.bytesPerElement=60,Yt(Od,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Iy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee,we,je,Me,ke,Qe,Fe,st,Tt,lt,gt,St,Ye){const _t=this.length;return this.resize(_t+1),this.emplace(_t,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee,we,je,Me,ke,Qe,Fe,st,Tt,lt,gt,St,Ye)}emplace(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce,he,Ee,we,je,Me,ke,Qe,Fe,st,Tt,lt,gt,St,Ye,_t){const Ve=20*t,Je=40*t,Ct=80*t;return this.float32[Ve+0]=i,this.float32[Ve+1]=u,this.int16[Je+4]=h,this.int16[Je+5]=g,this.int16[Je+6]=x,this.int16[Je+7]=b,this.int16[Je+8]=j,this.int16[Je+9]=T,this.int16[Je+10]=A,this.int16[Je+11]=I,this.int16[Je+12]=R,this.uint16[Je+13]=B,this.uint16[Je+14]=V,this.uint16[Je+15]=K,this.uint16[Je+16]=Q,this.uint16[Je+17]=re,this.uint16[Je+18]=ue,this.uint16[Je+19]=ce,this.uint16[Je+20]=he,this.uint16[Je+21]=Ee,this.uint16[Je+22]=we,this.uint16[Je+23]=je,this.uint16[Je+24]=Me,this.uint16[Je+25]=ke,this.uint16[Je+26]=Qe,this.uint16[Je+27]=Fe,this.uint32[Ve+14]=st,this.float32[Ve+15]=Tt,this.float32[Ve+16]=lt,this.float32[Ve+17]=gt,this.float32[Ve+18]=St,this.uint8[Ct+76]=Ye,this.uint16[Je+39]=_t,t}}Iy.prototype.bytesPerElement=80,Yt(Iy,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class My extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x){const b=this.length;return this.resize(b+1),this.emplace(b,t,i,u,h,g,x)}emplace(t,i,u,h,g,x,b){const j=6*t;return this.float32[j+0]=i,this.float32[j+1]=u,this.float32[j+2]=h,this.float32[j+3]=g,this.float32[j+4]=x,this.float32[j+5]=b,t}}My.prototype.bytesPerElement=24,Yt(My,"StructArrayLayout6f24");class Pu extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g){const x=this.length;return this.resize(x+1),this.emplace(x,t,i,u,h,g)}emplace(t,i,u,h,g,x){const b=5*t;return this.float32[b+0]=i,this.float32[b+1]=u,this.float32[b+2]=h,this.float32[b+3]=g,this.float32[b+4]=x,t}}Pu.prototype.bytesPerElement=20,Yt(Pu,"StructArrayLayout5f20");class Ry extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,t,i,u,h,g,x,b)}emplace(t,i,u,h,g,x,b,j){const T=7*t;return this.float32[T+0]=i,this.float32[T+1]=u,this.float32[T+2]=h,this.float32[T+3]=g,this.float32[T+4]=x,this.float32[T+5]=b,this.float32[T+6]=j,t}}Ry.prototype.bytesPerElement=28,Yt(Ry,"StructArrayLayout7f28");class Cp extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I){const R=this.length;return this.resize(R+1),this.emplace(R,t,i,u,h,g,x,b,j,T,A,I)}emplace(t,i,u,h,g,x,b,j,T,A,I,R){const B=11*t;return this.float32[B+0]=i,this.float32[B+1]=u,this.float32[B+2]=h,this.float32[B+3]=g,this.float32[B+4]=x,this.float32[B+5]=b,this.float32[B+6]=j,this.float32[B+7]=T,this.float32[B+8]=A,this.float32[B+9]=I,this.float32[B+10]=R,t}}Cp.prototype.bytesPerElement=44,Yt(Cp,"StructArrayLayout11f44");class ky extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T){const A=this.length;return this.resize(A+1),this.emplace(A,t,i,u,h,g,x,b,j,T)}emplace(t,i,u,h,g,x,b,j,T,A){const I=9*t;return this.float32[I+0]=i,this.float32[I+1]=u,this.float32[I+2]=h,this.float32[I+3]=g,this.float32[I+4]=x,this.float32[I+5]=b,this.float32[I+6]=j,this.float32[I+7]=T,this.float32[I+8]=A,t}}ky.prototype.bytesPerElement=36,Yt(ky,"StructArrayLayout9f36");class Lc extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i){const u=this.length;return this.resize(u+1),this.emplace(u,t,i)}emplace(t,i,u){const h=2*t;return this.float32[h+0]=i,this.float32[h+1]=u,t}}Lc.prototype.bytesPerElement=8,Yt(Lc,"StructArrayLayout2f8");class Dy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,i,u,h){const g=this.length;return this.resize(g+1),this.emplace(g,t,i,u,h)}emplace(t,i,u,h,g){const x=6*t;return this.uint32[3*t+0]=i,this.uint16[x+2]=u,this.uint16[x+3]=h,this.uint16[x+4]=g,t}}Dy.prototype.bytesPerElement=12,Yt(Dy,"StructArrayLayout1ul3ui12");class Ly extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint16[1*t+0]=i,t}}Ly.prototype.bytesPerElement=2,Yt(Ly,"StructArrayLayout1ui2");class Rm extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q){const re=this.length;return this.resize(re+1),this.emplace(re,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q)}emplace(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re){const ue=16*t;return this.float32[ue+0]=i,this.float32[ue+1]=u,this.float32[ue+2]=h,this.float32[ue+3]=g,this.float32[ue+4]=x,this.float32[ue+5]=b,this.float32[ue+6]=j,this.float32[ue+7]=T,this.float32[ue+8]=A,this.float32[ue+9]=I,this.float32[ue+10]=R,this.float32[ue+11]=B,this.float32[ue+12]=V,this.float32[ue+13]=K,this.float32[ue+14]=Q,this.float32[ue+15]=re,t}}Rm.prototype.bytesPerElement=64,Yt(Rm,"StructArrayLayout16f64");class Fd extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,i,u,h,g,x,b){const j=this.length;return this.resize(j+1),this.emplace(j,t,i,u,h,g,x,b)}emplace(t,i,u,h,g,x,b,j){const T=10*t,A=5*t;return this.uint16[T+0]=i,this.uint16[T+1]=u,this.uint16[T+2]=h,this.uint16[T+3]=g,this.float32[A+2]=x,this.float32[A+3]=b,this.float32[A+4]=j,t}}Fd.prototype.bytesPerElement=20,Yt(Fd,"StructArrayLayout4ui3f20");class zy extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.int16[1*t+0]=i,t}}zy.prototype.bytesPerElement=2,Yt(zy,"StructArrayLayout1i2");class km extends or{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const i=this.length;return this.resize(i+1),this.emplace(i,t)}emplace(t,i){return this.uint8[1*t+0]=i,t}}km.prototype.bytesPerElement=1,Yt(km,"StructArrayLayout1ub1");class Oy extends Ep{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}Oy.prototype.size=40;class d1 extends Py{get(t){return new Oy(this,t)}}Yt(d1,"CollisionBoxArray");class Dm extends Ep{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Dm.prototype.size=60;class Ap extends Od{get(t){return new Dm(this,t)}}Yt(Ap,"PlacedSymbolArray");class Fy extends Ep{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}Fy.prototype.size=80;class h1 extends Iy{get(t){return new Fy(this,t)}}Yt(h1,"SymbolInstanceArray");class By extends Au{getoffsetX(t){return this.float32[1*t+0]}}Yt(By,"GlyphOffsetArray");class p1 extends Po{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}Yt(p1,"SymbolLineVertexArray");class Lm extends Ep{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Lm.prototype.size=12;class f1 extends Dy{get(t){return new Lm(this,t)}}Yt(f1,"FeatureIndexArray");class m1 extends gl{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}Yt(m1,"FillExtrusionCentroidArray");class g1 extends Ep{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}g1.prototype.size=6;class x1 extends Md{get(t){return new g1(this,t)}}Yt(x1,"FillExtrusionWallArray");const y1=ln([{name:"a_pos",components:2,type:"Int16"}],4),KS=ln([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),XS=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class mr{constructor(t=[]){this.segments=t}_prepareSegment(t,i,u,h){let g=this.segments[this.segments.length-1];return t>mr.MAX_VERTEX_ARRAY_LENGTH&&rn(`Max vertices per segment is ${mr.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!g||g.vertexLength+t>mr.MAX_VERTEX_ARRAY_LENGTH||g.sortKey!==h)&&(g={vertexOffset:i,primitiveOffset:u,vertexLength:0,primitiveLength:0},h!==void 0&&(g.sortKey=h),this.segments.push(g)),g}prepareSegment(t,i,u,h){return this._prepareSegment(t,i.length,u.length,h)}get(){return this.segments}destroy(){for(const t of this.segments)for(const i in t.vaos)t.vaos[i].destroy()}static simpleSegment(t,i,u,h){return new mr([{vertexOffset:t,primitiveOffset:i,vertexLength:u,primitiveLength:h,vaos:{},sortKey:0}])}}function _1(a,t){return 256*(a=xe(Math.floor(a),0,255))+xe(Math.floor(t),0,255)}mr.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,Yt(mr,"SegmentVector");const YS=ln([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Vy=ln([{name:"a_pattern_b",components:4,type:"Uint16"}]),JS=ln([{name:"a_dash",components:4,type:"Uint16"}]);class Pp{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,i,u,h){this.ids.push(Ip(t)),this.positions.push(i,u,h)}eachPosition(t,i){const u=Ip(t);let h=0,g=this.ids.length-1;for(;h<g;){const x=h+g>>1;this.ids[x]>=u?g=x:h=x+1}for(;this.ids[h]===u;)i(this.positions[3*h],this.positions[3*h+1],this.positions[3*h+2]),h++}static serialize(t,i){const u=new Float64Array(t.ids),h=new Uint32Array(t.positions);return Uy(u,h,0,u.length-1),i&&(i.add(u.buffer),i.add(h.buffer)),{ids:u,positions:h}}static deserialize(t){const i=new Pp;let u;i.ids=t.ids,i.positions=t.positions;for(const h of i.ids)h!==u&&i.uniqueIds.push(h),u=h;return i.indexed=!0,i}}function Ip(a){const t=+a;return!isNaN(t)&&Number.MIN_SAFE_INTEGER<=t&&t<=Number.MAX_SAFE_INTEGER?t:dd(String(a))}function Uy(a,t,i,u){for(;i<u;){const h=a[i+u>>1];let g=i-1,x=u+1;for(;;){do g++;while(a[g]<h);do x--;while(a[x]>h);if(g>=x)break;zm(a,g,x),zm(t,3*g,3*x),zm(t,3*g+1,3*x+1),zm(t,3*g+2,3*x+2)}x-i<u-x?(Uy(a,t,i,x),i=x+1):(Uy(a,t,x+1,u),u=x)}}function zm(a,t,i){const u=a[t];a[t]=a[i],a[i]=u}Yt(Pp,"FeaturePositionMap");class Ca{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,i){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,i),this.initialized=!0),!!this.location}set(t,i,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Om extends Ca{constructor(t){super(t),this.current=0}set(t,i,u){this.fetchUniformLocation(t,i)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class zr extends Ca{constructor(t){super(t),this.current=0}set(t,i,u){this.fetchUniformLocation(t,i)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class xl extends Ca{constructor(t){super(t),this.current=[0,0]}set(t,i,u){this.fetchUniformLocation(t,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class Bd extends Ca{constructor(t){super(t),this.current=[0,0,0]}set(t,i,u){this.fetchUniformLocation(t,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class Mp extends Ca{constructor(t){super(t),this.current=[0,0,0,0]}set(t,i,u){this.fetchUniformLocation(t,i)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class $y extends Ca{constructor(t){super(t),this.current=En.transparent.toPremultipliedRenderColor(null)}set(t,i,u){this.fetchUniformLocation(t,i)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const v1=new Float32Array(16);class Rp extends Ca{constructor(t){super(t),this.current=v1}set(t,i,u){if(this.fetchUniformLocation(t,i)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let h=1;h<16;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const QS=new Float32Array(9),b1=new Float32Array(4);class Gy extends Ca{constructor(t){super(t),this.current=b1}set(t,i,u){if(this.fetchUniformLocation(t,i)){for(let h=0;h<4;h++)if(u[h]!==this.current[h]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function Hy(a){return[_1(255*a.r,255*a.g),_1(255*a.b,255*a.a)]}class kp{constructor(t,i,u,h){this.value=t,this.uniformNames=i.map(g=>`u_${g}`),this.type=u,this.context=h}setUniform(t,i,u,h,g){const x=h.constantOr(this.value);i.set(t,g,x instanceof En?x.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.value==="none"?null:this.context.lut):x)}getBinding(t,i){return this.type==="color"?new $y(t):new zr(t)}}class Vd{constructor(t,i){this.uniformNames=i.map(u=>`u_${u}`),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,i){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=i?i.tl.concat(i.br):this.pattern}setUniform(t,i,u,h,g){let x=null;g!=="u_pattern"&&g!=="u_dash"||(x=this.pattern),g==="u_pattern_b"&&(x=this.patternTransition),g==="u_pixel_ratio"&&(x=this.pixelRatio),x&&i.set(t,g,x)}getBinding(t,i){return i==="u_pattern"||i==="u_pattern_b"||i==="u_dash"?new Mp(t):new zr(t)}}class Vl{constructor(t,i,u,h){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=i.map(g=>({name:`a_${g}`,type:"Float32",components:u==="color"?2:1,offset:0})),this.paintVertexArray=new h}populatePaintArray(t,i,u,h,g,x,b,j){const T=this.paintVertexArray.length,A=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Mn(0,{brightness:x,worldview:j}),i,{},g,h,b):this.expression.kind==="constant"&&this.expression.value,I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Mn(0,{brightness:x,worldview:j}),i,{},g,h,b):this.lutExpression.value)==="none";this.paintVertexArray.resize(t),this._setPaintValue(T,t,A,I?null:this.context.lut)}updatePaintArray(t,i,u,h,g,x,b,j){const T=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:b,worldview:j},u,h,void 0,g):this.expression.kind==="constant"&&this.expression.value,A=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Mn(0,{brightness:b,worldview:j}),u,h,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(t,i,T,A?null:this.context.lut)}_setPaintValue(t,i,u,h){if(this.type==="color"){const g=Hy(u.toPremultipliedRenderColor(h));for(let x=t;x<i;x++)this.paintVertexArray.emplace(x,g[0],g[1])}else{for(let g=t;g<i;g++)this.paintVertexArray.emplace(g,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class Aa{constructor(t,i,u,h,g,x){this.expression=t,this.uniformNames=i.map(b=>`u_${b}_t`),this.type=u,this.useIntegerZoom=h,this.context=g,this.maxValue=0,this.paintVertexAttributes=i.map(b=>({name:`a_${b}`,type:"Float32",components:u==="color"?4:2,offset:0})),this.paintVertexArray=new x}populatePaintArray(t,i,u,h,g,x,b,j){const T=this.expression.evaluate(new Mn(this.context.zoom,{brightness:x,worldview:j}),i,{},g,h,b),A=this.expression.evaluate(new Mn(this.context.zoom+1,{brightness:x,worldview:j}),i,{},g,h,b),I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Mn(0,{brightness:x,worldview:j}),i,{},g,h,b):this.lutExpression.value)==="none",R=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(R,t,T,A,I?null:this.context.lut)}updatePaintArray(t,i,u,h,g,x,b,j){const T=this.expression.evaluate({zoom:this.context.zoom,brightness:b,worldview:j},u,h,void 0,g),A=this.expression.evaluate({zoom:this.context.zoom+1,brightness:b,worldview:j},u,h,void 0,g),I=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Mn(0,{brightness:b,worldview:j}),u,h,void 0,g):this.lutExpression.value)==="none";this._setPaintValue(t,i,T,A,I?null:this.context.lut)}_setPaintValue(t,i,u,h,g){if(this.type==="color"){const x=Hy(u.toPremultipliedRenderColor(g)),b=Hy(u.toPremultipliedRenderColor(g));for(let j=t;j<i;j++)this.paintVertexArray.emplace(j,x[0],x[1],b[0],b[1])}else{for(let x=t;x<i;x++)this.paintVertexArray.emplace(x,u,h);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(h))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,i,u,h,g){const x=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,b=xe(this.expression.interpolationFactor(x,this.context.zoom,this.context.zoom+1),0,1);i.set(t,g,b)}getBinding(t,i){return new zr(t)}}class ra{constructor(t,i,u,h,g){this.expression=t,this.layerId=g,this.paintVertexAttributes=(u==="array"?JS:YS).members;for(let x=0;x<i.length;++x);this.paintVertexArray=new h,this.paintTransitionVertexArray=new kd}populatePaintArray(t,i,u,h){const g=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(g,t,i.patterns&&i.patterns[this.layerId],u)}updatePaintArray(t,i,u,h,g,x,b){this._setPaintValues(t,i,u.patterns&&u.patterns[this.layerId],x)}_setPaintValues(t,i,u,h){if(!h||!u)return;const g=h[u[0]],x=h[u[1]];if(g){if(g){const{tl:b,br:j,pixelRatio:T}=g;for(let A=t;A<i;A++)this.paintVertexArray.emplace(A,b[0],b[1],j[0],j[1],T)}if(x){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:b,br:j}=x;for(let T=t;T<i;T++)this.paintTransitionVertexArray.emplace(T,b[0],b[1],j[0],j[1])}}}upload(t){const i=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,i)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,Vy.members,i))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class mo{constructor(t,i,u=()=>!0){this.binders={},this._buffers=[],this.context=i;const h=[];for(const g in t.paint._values){const x=t.paint.get(g);if(g.endsWith("-use-theme")||!u(g)||!(x instanceof Cu&&gm(x.property.specification)))continue;const b=tj(g,t.type),j=x.value,T=x.property.specification.type,A=!!x.property.useIntegerZoom,I=g==="line-dasharray"||g.endsWith("pattern"),R=t.paint.get(`${g}-use-theme`),B=g==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||R&&R.value.kind!=="constant";if(j.kind!=="constant"||B)if(j.kind==="source"||B||I){const V=w1(g,T,"source");this.binders[g]=I?new ra(j,b,T,V,t.id):new Vl(j,b,T,V),h.push(`/a_${g}`)}else{const V=w1(g,T,"composite");this.binders[g]=new Aa(j,b,T,A,i,V),h.push(`/z_${g}`)}else this.binders[g]=I?new Vd(j.value,b):new kp(j.value,b,T,i),h.push(`/u_${g}`);R&&(this.binders[g].lutExpression=R.value)}this.cacheKey=h.sort().join("")}getMaxValue(t){const i=this.binders[t];return i instanceof Vl||i instanceof Aa?i.maxValue:0}populatePaintArrays(t,i,u,h,g,x,b,j){for(const T in this.binders){const A=this.binders[T];A.context=this.context,(A instanceof Vl||A instanceof Aa||A instanceof ra)&&A.populatePaintArray(t,i,u,h,g,x,b,j)}}setConstantPatternPositions(t,i){for(const u in this.binders){const h=this.binders[u];h instanceof Vd&&h.setConstantPatternPositions(t,i)}}getPatternTransitionVertexBuffer(t){const i=this.binders[t];return i instanceof ra?i.paintTransitionVertexBuffer:null}updatePaintArrays(t,i,u,h,g,x,b,j,T,A){let I=!1;const R=Object.keys(t),B=R.length!==0&&!j,V=B?R:i.uniqueIds;this.context.lut=g.lut;for(const K in this.binders){const Q=this.binders[K];if(Q.context=this.context,(Q instanceof Vl||Q instanceof Aa||Q instanceof ra)&&Q.expression&&Q.expression.kind&&Q.expression.kind!=="constant"&&(Q.expression.isStateDependent===!0||Q.expression.isLightConstant===!1)){const re=g.paint.get(K);Q.expression=re.value;for(const ue of V){const ce=t[ue.toString()];i.eachPosition(ue,(he,Ee,we)=>{const je=h.feature(he);Q.updatePaintArray(Ee,we,je,ce,x,b,T,A)})}if(!B)for(const ue of u.uniqueIds){const ce=t[ue.toString()];u.eachPosition(ue,(he,Ee,we)=>{const je=h.feature(he);Q.updatePaintArray(Ee,we,je,ce,x,b,T,A)})}I=!0}}return I}defines(){const t=[];for(const i in this.binders){const u=this.binders[i];(u instanceof kp||u instanceof Vd)&&t.push(...u.uniformNames.map(h=>`#define HAS_UNIFORM_${h}`))}return t}getBinderAttributes(){const t=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof Vl||u instanceof Aa||u instanceof ra)for(let h=0;h<u.paintVertexAttributes.length;h++)t.push(u.paintVertexAttributes[h].name);if(u instanceof ra)for(let h=0;h<Vy.members.length;h++)t.push(Vy.members[h].name)}return t}getBinderUniforms(){const t=[];for(const i in this.binders){const u=this.binders[i];if(u instanceof kp||u instanceof Vd||u instanceof Aa)for(const h of u.uniformNames)t.push(h)}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const i=[];for(const u in this.binders){const h=this.binders[u];if(h instanceof kp||h instanceof Vd||h instanceof Aa)for(const g of h.uniformNames)i.push({name:g,property:u,binding:h.getBinding(t,g)})}return i}setUniforms(t,i,u,h,g){for(const{name:x,property:b,binding:j}of u)this.binders[b].setUniform(t,j,g,h.get(b),x)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const i=this.binders[t];(i instanceof Vl||i instanceof Aa||i instanceof ra)&&i.paintVertexBuffer&&this._buffers.push(i.paintVertexBuffer),i instanceof ra&&i.paintTransitionVertexBuffer&&this._buffers.push(i.paintTransitionVertexBuffer)}}upload(t){for(const i in this.binders){const u=this.binders[i];(u instanceof Vl||u instanceof Aa||u instanceof ra)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const i=this.binders[t];(i instanceof Vl||i instanceof Aa||i instanceof ra)&&i.destroy()}}}class ia{constructor(t,i,u=()=>!0){this.programConfigurations={};for(const h of t)this.programConfigurations[h.id]=new mo(h,i,u);this.needsUpload=!1,this._featureMap=new Pp,this._featureMapWithoutIds=new Pp,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,i,u,h,g,x,b,j,T){for(const A in this.programConfigurations)this.programConfigurations[A].populatePaintArrays(t,i,h,g,x,b,j,T);i.id!==void 0?this._featureMap.add(i.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,i,u,h,g,x,b,j){for(const T of u)this.needsUpload=this.programConfigurations[T.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,i,T,h,g,x,b||0,j)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const i in this.programConfigurations)this.programConfigurations[i].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const ej={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function tj(a,t){return ej[a]||[a.replace(`${t}-`,"").replace(/-/g,"_")]}const sj={"line-pattern":{source:kc,composite:kc},"fill-pattern":{source:kc,composite:kc},"fill-extrusion-pattern":{source:kc,composite:kc},"line-dasharray":{source:kd,composite:kd}},nj={color:{source:Lc,composite:Dc},number:{source:Au,composite:Lc}};function w1(a,t,i){const u=sj[a];return u&&u[i]||nj[t][i]}Yt(kp,"ConstantBinder"),Yt(Vd,"PatternConstantBinder"),Yt(Vl,"SourceExpressionBinder"),Yt(ra,"PatternCompositeBinder"),Yt(Aa,"CompositeExpressionBinder"),Yt(mo,"ProgramConfiguration",{omit:["_buffers"]}),Yt(ia,"ProgramConfigurationSet");const to=Rt/Math.PI/2,S1=5,p=6,r=16383,c=64,f=[c,32,16],y=-to,v=to;function S(a,t,i,u=to){return i=Ks(i),[a*Math.sin(i)*u,-t*u,a*Math.cos(i)*u]}function N(a,t,i){return S(Math.cos(Ks(a)),Math.sin(Ks(a)),t,i)}const C=63710088e-1,k=2*Math.PI*C;class D{constructor(t,i){if(isNaN(t)||isNaN(i))throw new Error(`Invalid LngLat object: (${t}, ${i})`);if(this.lng=+t,this.lat=+i,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new D(qe(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const i=Math.PI/180,u=this.lat*i,h=t.lat*i,g=Math.sin(u)*Math.sin(h)+Math.cos(u)*Math.cos(h)*Math.cos((t.lng-this.lng)*i);return C*Math.acos(Math.min(g,1))}toBounds(t=0){const i=360*t/40075017,u=i/Math.cos(Math.PI/180*this.lat);return new U({lng:this.lng-u,lat:this.lat-i},{lng:this.lng+u,lat:this.lat+i})}toEcef(t){return N(this.lat,this.lng,to+t*to/C)}static convert(t){if(t instanceof D)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new D(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new D(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class U{constructor(t,i){if(t)if(i)this.setSouthWest(t).setNorthEast(i);else if(t.length===4){const u=t;this.setSouthWest([u[0],u[1]]).setNorthEast([u[2],u[3]])}else{const u=t;this.setSouthWest(u[0]).setNorthEast(u[1])}}setNorthEast(t){return this._ne=t instanceof D?new D(t.lng,t.lat):D.convert(t),this}setSouthWest(t){return this._sw=t instanceof D?new D(t.lng,t.lat):D.convert(t),this}extend(t){const i=this._sw,u=this._ne;let h,g;if(t instanceof D)h=t,g=t;else{if(!(t instanceof U))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(U.convert(t)):this.extend(D.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(D.convert(t)):this;if(h=t._sw,g=t._ne,!h||!g)return this}return i||u?(i.lng=Math.min(h.lng,i.lng),i.lat=Math.min(h.lat,i.lat),u.lng=Math.max(g.lng,u.lng),u.lat=Math.max(g.lat,u.lat)):(this._sw=new D(h.lng,h.lat),this._ne=new D(g.lng,g.lat)),this}getCenter(){return new D((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new D(this.getWest(),this.getNorth())}getSouthEast(){return new D(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:i,lat:u}=D.convert(t);let h=this._sw.lng<=i&&i<=this._ne.lng;return this._sw.lng>this._ne.lng&&(h=this._sw.lng>=i&&i>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&h}static convert(t){if(t)return t instanceof U?t:new U(t)}}const O=0,G=25.5;function ee(a){return k*Math.cos(a*Math.PI/180)}function J(a){return(180+a)/360}function se(a){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+a*Math.PI/360)))/360}function te(a,t){return a/ee(t)}function le(a){return 360*a-180}function de(a){return 360/Math.PI*Math.atan(Math.exp((180-360*a)*Math.PI/180))-90}function pe(a,t){return a*ee(de(t))}const ye=85.051129;function Se(a){return Math.cos(Ks(xe(a,-ye,ye)))}function Te(a,t){const i=xe(t,O,G),u=Math.pow(2,i);return Se(a)*k/(512*u)}function _e(a){return 1/Math.cos(a*Math.PI/180)}function ve(a,t=0){const i=Math.exp(Math.PI*(1-(a.y+t/Rt)/(1<<a.z)*2));return 80150034*i/(i*i+1)/Rt/(1<<a.z)}class be{constructor(t,i,u=0){this.x=+t,this.y=+i,this.z=+u}static fromLngLat(t,i=0){const u=D.convert(t);return new be(J(u.lng),se(u.lat),te(i,u.lat))}toLngLat(){return new D(le(this.x),de(this.y))}toAltitude(){return pe(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/k*_e(de(this.y))}}function Ue(a,t,i,u,h,g,x,b,j){const T=(t+u)/2,A=(i+h)/2,I=new et(T,A);b(I),function(R,B,V,K,Q,re){const ue=V-Q,ce=K-re;return Math.abs((K-B)*ue-(V-R)*ce)/Math.hypot(ue,ce)}(I.x,I.y,g.x,g.y,x.x,x.y)>=j?(Ue(a,t,i,T,A,g,I,b,j),Ue(a,T,A,u,h,I,x,b,j)):a.push(x)}function Ie(a,t,i){let u=a[0],h=u.x,g=u.y;t(u);const x=[u];for(let b=1;b<a.length;b++){const j=a[b],{x:T,y:A}=j;t(j),Ue(x,h,g,T,A,u,j,t,i),h=T,g=A,u=j}return x}function tt(a,t,i,u){if(u(t,i)){const h=t.add(i)._mult(.5);tt(a,t,h,u),tt(a,h,i,u)}else a.push(i)}function We(a,t){let i=a[0];const u=[i];for(let h=1;h<a.length;h++){const g=a[h];tt(u,i,g,t),i=g}return u}const rt=Math.pow(2,14)-1,jt=-rt-1;function $e(a,t){const i=Math.round(a.x*t),u=Math.round(a.y*t);return a.x=xe(i,jt,rt),a.y=xe(u,jt,rt),(i<a.x||i>a.x+1||u<a.y||u>a.y+1)&&rn("Geometry exceeds allowed extent, reduce your vector tile buffer size"),a}function Ae(a,t,i){const u=a.loadGeometry(),h=a.extent,g=Rt/h;if(t&&i&&i.projection.isReprojectedInTileSpace){const x=1<<t.z,{scale:b,x:j,y:T,projection:A}=i,I=R=>{const B=le((t.x+R.x/h)/x),V=de((t.y+R.y/h)/x),K=A.project(B,V);R.x=(K.x*b-j)*h,R.y=(K.y*b-T)*h};for(let R=0;R<u.length;R++)if(a.type!==1)u[R]=Ie(u[R],I,1);else{const B=[];for(const V of u[R])V.x<0||V.x>=h||V.y<0||V.y>=h||(I(V),B.push(V));u[R]=B}}for(const x of u)for(const b of x)$e(b,g);return u}function Ke(a,t){return{type:a.type,id:a.id,properties:a.properties,geometry:t?Ae(a):[]}}class Ge{constructor(t,i,u,h,g){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=h,this._values=g,t.readFields(ht,this,i)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos,u=[];let h,g=1,x=0,b=0,j=0;for(;t.pos<i;){if(x<=0){const T=t.readVarint();g=7&T,x=T>>3}if(x--,g===1||g===2)b+=t.readSVarint(),j+=t.readSVarint(),g===1&&(h&&u.push(h),h=[]),h&&h.push(new et(b,j));else{if(g!==7)throw new Error(`unknown command ${g}`);h&&h.push(h[0].clone())}}return h&&u.push(h),u}bbox(){const t=this._pbf;t.pos=this._geometry;const i=t.readVarint()+t.pos;let u=1,h=0,g=0,x=0,b=1/0,j=-1/0,T=1/0,A=-1/0;for(;t.pos<i;){if(h<=0){const I=t.readVarint();u=7&I,h=I>>3}if(h--,u===1||u===2)g+=t.readSVarint(),x+=t.readSVarint(),g<b&&(b=g),g>j&&(j=g),x<T&&(T=x),x>A&&(A=x);else if(u!==7)throw new Error(`unknown command ${u}`)}return[b,T,j,A]}toGeoJSON(t,i,u){const h=this.extent*Math.pow(2,u),g=this.extent*t,x=this.extent*i,b=this.loadGeometry();function j(R){return[360*(R.x+g)/h-180,360/Math.PI*Math.atan(Math.exp((1-2*(R.y+x)/h)*Math.PI))-90]}function T(R){return R.map(j)}let A;if(this.type===1){const R=[];for(const V of b)R.push(V[0]);const B=T(R);A=R.length===1?{type:"Point",coordinates:B[0]}:{type:"MultiPoint",coordinates:B}}else if(this.type===2){const R=b.map(T);A=R.length===1?{type:"LineString",coordinates:R[0]}:{type:"MultiLineString",coordinates:R}}else{if(this.type!==3)throw new Error("unknown feature type");{const R=function(V){const K=V.length;if(K<=1)return[V];const Q=[];let re,ue;for(let ce=0;ce<K;ce++){const he=pt(V[ce]);he!==0&&(ue===void 0&&(ue=he<0),ue===he<0?(re&&Q.push(re),re=[V[ce]]):re&&re.push(V[ce]))}return re&&Q.push(re),Q}(b),B=[];for(const V of R)B.push(V.map(T));A=B.length===1?{type:"Polygon",coordinates:B[0]}:{type:"MultiPolygon",coordinates:B}}}const I={type:"Feature",geometry:A,properties:this.properties};return this.id!=null&&(I.id=this.id),I}}function ht(a,t,i){a===1?t.id=i.readVarint():a===2?function(u,h){const g=u.readVarint()+u.pos;for(;u.pos<g;){const x=h._keys[u.readVarint()],b=h._values[u.readVarint()];h.properties[x]=b}}(i,t):a===3?t.type=i.readVarint():a===4&&(t._geometry=i.pos)}function pt(a){let t=0;for(let i,u,h=0,g=a.length,x=g-1;h<g;x=h++)i=a[h],u=a[x],t+=(u.x-i.x)*(i.y+u.y);return t}Ge.types=["Unknown","Point","LineString","Polygon"];class mt{constructor(t,i){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Pt,this,i),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const i=this._pbf.readVarint()+this._pbf.pos;return new Ge(this._pbf,i,this.extent,this._keys,this._values)}}function Pt(a,t,i){a===15?t.version=i.readVarint():a===1?t.name=i.readString():a===5?t.extent=i.readVarint():a===2?t._features.push(i.pos):a===3?t._keys.push(i.readString()):a===4&&t._values.push(function(u){let h=null;const g=u.readVarint()+u.pos;for(;u.pos<g;){const x=u.readVarint()>>3;h=x===1?u.readString():x===2?u.readFloat():x===3?u.readDouble():x===4?u.readVarint64():x===5?u.readVarint():x===6?u.readSVarint():x===7?u.readBoolean():null}if(h==null)throw new Error("unknown feature value");return h}(i))}class ns{constructor(t,i){this.layers=t.readFields(us,{},i)}}function us(a,t,i){if(a===3){const u=new mt(i,i.readVarint()+i.pos);u.length&&(t[u.name]=u)}}const Wt="3d_elevation_id",as="level";class is{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,i){return this._valid&&t(i(this._geometry)),this}require(t,i,u){return this.get(t,!0,i,u)}optional(t,i,u){return this.get(t,!1,i,u)}success(){return this._valid}get(t,i,u,h){const g=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&g!==void 0&&!Number.isNaN(g)?u(h?h(g):g):i&&(this._valid=!1),this}}class Cs{constructor(t,i){this.featureFunc=t,this.vertexFunc=i}parseFeature(t,i,u){return this.featureFunc(t,i,u)}parseVertex(t,i,u){return this.vertexFunc(t,i,u)}}const Ls=new Cs((a,t,i)=>a.reset(t).require(Wt,u=>{i.id=u}).optional("fixed_height_relative",u=>{i.constantHeight=u},pn.decodeRelativeHeight).geometry(u=>{i.bounds=u},Bx).success(),(a,t,i)=>a.reset(t).require(Wt,u=>{i.id=u}).require("elevation_idx",u=>{i.idx=u}).require("extent",u=>{i.extent=u}).require("height_relative",u=>{i.height=u},pn.decodeRelativeHeight).geometry(u=>{i.position=u},pn.getPoint).success()),Ws=new Cs((a,t,i)=>a.reset(t).require(Wt,u=>{i.id=u}).optional("fixed_height",u=>{i.constantHeight=u},pn.decodeMetricHeight).geometry(u=>{i.bounds=u},Bx).success(),(a,t,i)=>a.reset(t).require(Wt,u=>{i.id=u}).require("elevation_idx",u=>{i.idx=u}).require("extent",u=>{i.extent=u}).require("height",u=>{i.height=u},pn.decodeMetricHeight).geometry(u=>{i.position=u},pn.getPoint).success());class pn{static getPoint(t){return co(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static parse(t){const i=[],u=[],h=t.length,g=new is;for(let b=0;b<h;b++){const j=t.feature(b),T=j.properties.version,A=(x=T)?x==="1.0.1"?Ws:void 0:Ls;if(A===void 0){rn(`Unknown elevation feature version number ${T||"(unknown)"}`);continue}const I=j.properties.hasOwnProperty("type")?j.properties.type:void 0;if(I){if(Ge.types[j.type]==="Point"&&I==="curve_point"){const R={};A.parseVertex(g,j,R)&&i.push(R)}else if(Ge.types[j.type]==="Polygon"&&I==="curve_meta"){const R={};A.parseFeature(g,j,R)&&u.push(R)}}}var x;return{vertices:i,features:u}}}class Rs{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,u){const h=sr(i,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,!0}}class fn{constructor(t,i){this.pos=t,this.dir=i}intersectsPlane(t,i,u){const h=Xt(i,this.dir);if(Math.abs(h)<1e-6)return!1;const g=((t[0]-this.pos[0])*i[0]+(t[1]-this.pos[1])*i[1]+(t[2]-this.pos[2])*i[2])/h;return u[0]=this.pos[0]+this.dir[0]*g,u[1]=this.pos[1]+this.dir[1]*g,u[2]=this.pos[2]+this.dir[2]*g,!0}closestPointOnSphere(t,i,u){if(function(B,V){var K=B[0],Q=B[1],re=B[2],ue=V[0],ce=V[1],he=V[2];return Math.abs(K-ue)<=E*Math.max(1,Math.abs(K),Math.abs(ue))&&Math.abs(Q-ce)<=E*Math.max(1,Math.abs(Q),Math.abs(ce))&&Math.abs(re-he)<=E*Math.max(1,Math.abs(re),Math.abs(he))}(this.pos,t)||i===0)return u[0]=u[1]=u[2]=0,!1;const[h,g,x]=this.dir,b=this.pos[0]-t[0],j=this.pos[1]-t[1],T=this.pos[2]-t[2],A=h*h+g*g+x*x,I=2*(b*h+j*g+T*x),R=I*I-4*A*(b*b+j*j+T*T-i*i);if(R<0){const B=Math.max(-I/2,0),V=b+h*B,K=j+g*B,Q=T+x*B,re=Math.hypot(V,K,Q);return u[0]=V*i/re,u[1]=K*i/re,u[2]=Q*i/re,!1}{const B=(-I-Math.sqrt(R))/(2*A);if(B<0){const V=Math.hypot(b,j,T);return u[0]=b*i/V,u[1]=j*i/V,u[2]=T*i/V,!1}return u[0]=b+h*B,u[1]=j+g*B,u[2]=T+x*B,!0}}}class yn{constructor(t,i,u,h,g){this.TL=t,this.TR=i,this.BR=u,this.BL=h,this.horizon=g}static fromInvProjectionMatrix(t,i,u){const h=[-1,1,1],g=[1,1,1],x=[1,-1,1],b=[-1,-1,1],j=ws(h,h,t),T=ws(g,g,t),A=ws(x,x,t),I=ws(b,b,t);return new yn(j,T,A,I,i/u)}}function Hn(a,t,i){let u=1/0,h=-1/0;const g=[];for(const x of a){vn(g,x,t);const b=Xt(g,i);u=Math.min(u,b),h=Math.max(h,b)}return[u,h]}function $s(a,t){let i=!0;for(let u=0;u<a.planes.length;u++){const h=a.planes[u];let g=0;for(let x=0;x<t.length;x++)g+=Xt(h,t[x])+h[3]>=0;if(g===0)return 0;g!==t.length&&(i=!1)}return i?2:1}function mn(a,t){for(const i of a.projections){const u=Hn(t,a.points[0],i.axis);if(i.projection[1]<u[0]||i.projection[0]>u[1])return 0}return 1}function gn(a,t){let i=0;const u=[0,0,0,0];for(let x=0;x<a.length;x++)u[0]=a[x][0],u[1]=a[x][1],u[2]=a[x][2],u[3]=1,(h=u)[0]*(g=t)[0]+h[1]*g[1]+h[2]*g[2]+h[3]*g[3]>=0&&i++;var h,g;return i}class wn{constructor(t,i){this.points=t||new Array(8).fill([0,0,0]),this.planes=i||new Array(6).fill([0,0,0,0]),this.bounds=qs.fromPoints(this.points),this.projections=[],this.frustumEdges=[vn([],this.points[2],this.points[3]),vn([],this.points[0],this.points[3]),vn([],this.points[4],this.points[0]),vn([],this.points[5],this.points[1]),vn([],this.points[6],this.points[2]),vn([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const h=[0,-u[2],u[1]],g=[u[2],0,-u[0]];this.projections.push({axis:h,projection:Hn(this.points,this.points[0],h)}),this.projections.push({axis:g,projection:Hn(this.points,this.points[0],g)})}}static fromInvProjectionMatrix(t,i,u,h){const g=Math.pow(2,u),x=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map(T=>{const A=gi([],T,t),I=1/A[3]/i*g;return(R=A)[0]=(B=A)[0]*(V=[I,I,h?1/A[3]:I,I])[0],R[1]=B[1]*V[1],R[2]=B[2]*V[2],R[3]=B[3]*V[3],R;var R,B,V}),b=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map(T=>{const A=Ms([],It([],vn([],x[T[0]],x[T[1]]),vn([],x[T[2]],x[T[1]]))),I=-Xt(A,x[T[1]]);return A.concat(I)}),j=[];for(let T=0;T<x.length;T++)j.push([x[T][0],x[T][1],x[T][2]]);return new wn(j,b)}intersectsPrecise(t,i,u){for(let h=0;h<i.length;h++)if(!gn(t,i[h]))return 0;for(let h=0;h<this.planes.length;h++)if(!gn(t,this.planes[h]))return 0;for(const h of u)for(const g of this.frustumEdges){const x=It([],h,g),b=Dt(x);if(b===0)continue;nt(x,x,1/b);const j=Hn(this.points,this.points[0],x),T=Hn(t,this.points[0],x);if(j[0]>T[1]||T[0]>j[1])return 0}return 1}containsPoint(t){for(const i of this.planes){const u=i[3];if(Xt([i[0],i[1],i[2]],t)+u<0)return!1}return!0}}class qs{static fromPoints(t){const i=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const h of t)Xe(i,i,h),Ot(u,u,h);return new qs(i,u)}static fromTileIdAndHeight(t,i,u){const h=1<<t.canonical.z,g=t.canonical.x,x=t.canonical.y;return new qs([g/h,x/h,i],[(g+1)/h,(x+1)/h,u])}static applyTransform(t,i){const u=t.getCorners();for(let h=0;h<u.length;++h)ws(u[h],u[h],i);return qs.fromPoints(u)}static applyTransformFast(t,i){const u=[i[12],i[13],i[14]],h=[...u];for(let g=0;g<3;g++)for(let x=0;x<3;x++){const b=i[4*x+g],j=b*t.min[x],T=b*t.max[x];u[g]+=Math.min(j,T),h[g]+=Math.max(j,T)}return new qs(u,h)}static projectAabbCorners(t,i){const u=t.getCorners();for(let h=0;h<u.length;++h)ws(u[h],u[h],i);return u}constructor(t,i){this.min=t,this.max=i,this.center=nt([],Vt([],this.min,this.max),.5)}quadrant(t){const i=[t%2==0,t<2],u=Ht(this.min),h=Ht(this.max);for(let g=0;g<i.length;g++)u[g]=i[g]?this.min[g]:this.center[g],h[g]=i[g]?this.center[g]:this.max[g];return h[2]=this.max[2],new qs(u,h)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,i=this.max;return[[t[0],t[1],t[2]],[i[0],t[1],t[2]],[i[0],i[1],t[2]],[t[0],i[1],t[2]],[t[0],t[1],i[2]],[i[0],t[1],i[2]],[i[0],i[1],i[2]],[t[0],i[1],i[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?$s(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?$s(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,i){return i||this.intersects(t)?mn(t,this.getCorners()):0}intersectsPreciseFlat(t,i){return i||this.intersectsFlat(t)?mn(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let i=0;i<3;++i)if(this.min[i]>t.max[i]||t.min[i]>this.max[i])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t.min[i]),this.max[i]=Math.max(this.max[i],t.max[i])}encapsulatePoint(t){for(let i=0;i<3;i++)this.min[i]=Math.min(this.min[i],t[i]),this.max[i]=Math.max(this.max[i],t[i])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}Yt(qs,"Aabb");class Pn{constructor(t,i){this.feature=t,this.metersToTile=i,this.index=0}get(){const t=this.feature.vertices[this.index],i=this.feature.vertexProps[this.index].dir,u=i[1],h=-i[0],g=(t.extent+1)*this.metersToTile;return[new et(Math.trunc(t.position[0]+u*g),Math.trunc(t.position[1]+h*g)),new et(Math.trunc(t.position[0]-u*g),Math.trunc(t.position[1]-h*g))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class _n{constructor(t,i,u,h,g,x){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this.id=t,this.heightRange={min:u,max:u},this.safeArea=i,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||h.length!==0)){this.vertices=h,this.edges=g,this.edges=this.edges.filter(b=>{return b.a<this.vertices.length&&b.b<this.vertices.length&&!((j=this.vertices[b.a].position)[0]===(T=this.vertices[b.b].position)[0]&&j[1]===T[1]);var j,T}),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const b of this.vertices)this.vertexProps.push({dir:co(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,b.height),this.heightRange.max=Math.max(this.heightRange.max,b.height);for(const b of this.edges){const j=this.vertices[b.a].position,T=this.vertices[b.b].position,A=uo(Pi(),T,j),I=So(A),R=Ua(Pi(),A,1/I);this.edgeProps.push({vec:A,dir:R,len:I});const B=this.vertexProps[b.a].dir,V=this.vertexProps[b.b].dir;ba(B,B,R),ba(V,V,R)}for(const b of this.vertexProps)b.dir[0]===0&&b.dir[1]===0||pc(b.dir,b.dir);this.tessellate(x)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const i=this.getClosestEdge(t);if(i==null)return 0;const[u,h]=i;return fs(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,h)}computeSlopeNormal(t,i){const u=this.getClosestEdge(t);if(!u)return wt(0,0,1);const h=u[0],g=this.edges[h],x=this.edgeProps[h].vec,b=wt(x[0],x[1],(this.vertices[g.b].height-this.vertices[g.a].height)*i),j=wt(b[1],-b[0],0);It(j,j,b);const T=Dt(j);return T>0?nt(j,j,1/T):wt(0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let i=0,u=Number.POSITIVE_INFINITY,h=0;const g=co(t.x,t.y);for(let x=0;x<this.edges.length;x++){const b=this.edges[x],j=this.edgeProps[x].dir,T=new Rs(g,this.edgeProps[x].dir),A=this.vertices[b.a].position,I=this.vertices[b.b].position,R=Pi(),B=Pi(),V=T.intersectsPlane(A,this.vertexProps[b.a].dir,R),K=T.intersectsPlane(I,this.vertexProps[b.b].dir,B);if(!V||!K)continue;const Q=uo(Pi(),B,R),re=uo(Pi(),g,R),ue=sr(Q,Q),ce=ue>0?sr(re,Q)/ue:0,he=xe(ce,0,1),Ee=Math.abs((ce-he)*this.edgeProps[x].len),we=uo(Pi(),g,A),je=Ee+Math.abs(sr(we,co(j[1],-j[0])));je<u&&(i=x,u=je,h=he)}return[i,h]}tessellate(t){for(let i=this.edges.length-1;i>=0;--i){const u=this.edges[i].a,h=this.edges[i].b,{position:g,height:x,extent:b}=this.vertices[u],{position:j,height:T,extent:A}=this.vertices[h],I=this.vertexProps[u].dir,R=this.vertexProps[h].dir,B=wt(g[0]/t,g[1]/t,x),V=wt(j[0]/t,j[1]/t,T),K=wt(I[1],-I[0],0);nt(K,K,b);const Q=wt(R[1],-R[0],0);if(nt(Q,Q,A),this.distSqLines(wt(B[0]+.5*K[0],B[1]+.5*K[1],B[2]+.5*K[2]),wt(V[0]-.5*Q[0],V[1]-.5*Q[1],V[2]-.5*Q[2]),wt(B[0]-.5*K[0],B[1]-.5*K[1],B[2]-.5*K[2]),wt(V[0]+.5*Q[0],V[1]+.5*Q[1],V[2]+.5*Q[2]))<=.0025000000000000005)continue;const re=this.vertices.length,ue=ba(Pi(),g,j);this.vertices.push({position:Ua(ue,ue,.5),height:.5*(x+T),extent:.5*(b+A)});const ce=ba(Pi(),I,R);this.vertexProps.push({dir:pc(ce,ce)}),this.edges.splice(i,1),this.edgeProps.splice(i,1),this.edges.push({a:u,b:re}),this.edges.push({a:re,b:h});const he=uo(Pi(),this.vertices[re].position,g),Ee=So(he),we={vec:he,dir:Ua(Pi(),he,1/Ee),len:Ee};this.edgeProps.push(we),this.edgeProps.push(we)}}distSqLines(t,i,u,h){const g=Bt(yt(),i,t),x=Bt(yt(),h,u),b=Bt(yt(),t,u),j=Xt(g,g),T=Xt(g,x),A=Xt(g,b),I=Xt(x,x),R=Xt(x,b),B=j*I-T*T;if(B===0){const Q=Xt(b,x)/Xt(x,x);return ss(Ns(yt(),u,h,Q),t)}const V=(T*R-A*I)/B,K=(j*R-T*A)/B;return ss(Ns(yt(),t,i,V),Ns(yt(),u,h,K))}}class gr{static parseFrom(t,i){const u=pn.parse(t);if(!u)return[];let{vertices:h,features:g}=u;const x=1/ve(i);g.sort((A,I)=>A.id-I.id),h.sort((A,I)=>A.id-I.id||A.idx-I.idx),h=h.filter((A,I,R)=>I===R.findIndex(B=>B.id===A.id&&B.idx===A.idx));const b=new Array;let j=0;const T=h.length;for(const A of g){if(A.constantHeight){b.push(new _n(A.id,A.bounds,A.constantHeight));continue}for(;j!==T&&h[j].id<A.id;)j++;if(j===T||h[j].id!==A.id)continue;const I=new Array,R=new Array,B=j;for(;j!==T&&h[j].id===A.id;){const V=h[j];if(I.push({position:V.position,height:V.height,extent:V.extent}),j!==B&&h[j-1].idx===V.idx-1){const K=j-B;R.push({a:K-1,b:K})}j++}b.push(new _n(A.id,A.bounds,void 0,I,R,x))}return b}static getElevationFeature(t,i){if(!i)return;const u=+t.properties[Wt];return Number.isNaN(u)?void 0:i.find(h=>h.id===u)}}class dn{constructor(t,i){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(i)||(this.zScale=Math.pow(2,i.z-t.z),this.xOffset=(t.x*this.zScale-i.x)*Rt,this.yOffset=(t.y*this.zScale-i.y)*Rt)}constantElevation(t,i){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,i)}pointElevation(t,i,u){const h=this.constantElevation(i,u);return h??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(i.pointElevation(t),u))}computeBiasedHeight(t,i){return i<=0?t:t+i*Re(0,i,t>=0?t:Math.abs(.5*t))}}Yt(_n,"ElevationFeature");class Sn{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new Po,this.indexArray=new ur,this.segments=new mr,this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Au),this.worldview=t.worldview}updateFootprints(t,i){}populate(t,i,u,h){const g=this.layers[0],x=[];let b=null;g.type==="circle"&&(b=g.layout.get("circle-sort-key"));for(const{feature:T,id:A,index:I,sourceLayerIndex:R}of t){const B=this.layers[0]._featureFilter.needGeometry,V=Ke(T,B);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),V,u))continue;const K=b?b.evaluate(V,{},u):void 0,Q={id:A,properties:T.properties,type:T.type,sourceLayerIndex:R,index:I,geometry:B?V.geometry:Ae(T,u,h),patterns:{},sortKey:K};x.push(Q)}b&&x.sort((T,A)=>T.sortKey-A.sortKey);let j=null;h.projection.name==="globe"&&(this.globeExtVertexArray=new Pm,j=h.projection);for(const T of x){const{geometry:A,index:I,sourceLayerIndex:R}=T,B=t[I].feature;this.addFeature(T,A,I,i.availableImages,u,j,i.brightness,i.elevationFeatures),i.featureIndex.insert(B,A,I,R,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,i,u,h,g,x,b){this.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,y1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,XS.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,KS.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,i,u,h,g,x,b,j){let T;this.elevationMode!=="none"&&(T=gr.getElevationFeature(t,j));for(const A of i)for(const I of A){const R=I.x,B=I.y;if(R<0||R>=Rt||B<0||B>=Rt)continue;if(x){const Q=x.projectTilePoint(R,B,g),re=x.upVector(g,R,B);this.addGlobeExtVertex(Q,re),this.addGlobeExtVertex(Q,re),this.addGlobeExtVertex(Q,re),this.addGlobeExtVertex(Q,re)}const V=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),K=V.vertexLength;if(this.addCircleVertex(R,B,-1,-1),this.addCircleVertex(R,B,1,-1),this.addCircleVertex(R,B,1,1),this.addCircleVertex(R,B,-1,1),this.elevationMode!=="none"){const Q=T?T.pointElevation(new et(R,B)):0;this.hasElevation=this.hasElevation||Q!==0;for(let re=0;re<4;re++)this.elevatedLayoutVertexArray.emplaceBack(Q)}this.indexArray.emplaceBack(K,K+1,K+2),this.indexArray.emplaceBack(K,K+2,K+3),V.vertexLength+=4,V.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},h,g,b,void 0,this.worldview)}addCircleVertex(t,i,u,h){this.layoutVertexArray.emplaceBack(2*t+(u+1)/2,2*i+(h+1)/2)}addGlobeExtVertex(t,i){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}}function zn(a,t){for(let i=0;i<a.length;i++)if(Ui(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(Ui(a,t[i]))return!0;return!!vi(a,t)}function Or(a,t,i){return!!Ui(a,t)||!!Vi(t,a,i)}function Lr(a,t){if(a.length===1)return Pa(t,a[0]);for(let i=0;i<t.length;i++){const u=t[i];for(let h=0;h<u.length;h++)if(Ui(a,u[h]))return!0}for(let i=0;i<a.length;i++)if(Pa(t,a[i]))return!0;for(let i=0;i<t.length;i++)if(vi(a,t[i]))return!0;return!1}function Br(a,t,i){if(a.length>1){if(vi(a,t))return!0;for(let u=0;u<t.length;u++)if(Vi(t[u],a,i))return!0}for(let u=0;u<a.length;u++)if(Vi(a[u],t,i))return!0;return!1}function vi(a,t){if(a.length===0||t.length===0)return!1;for(let i=0;i<a.length-1;i++){const u=a[i],h=a[i+1];for(let g=0;g<t.length-1;g++)if(qa(u,h,t[g],t[g+1]))return!0}return!1}function qa(a,t,i,u){return Ar(a,i,u)!==Ar(t,i,u)&&Ar(a,t,i)!==Ar(a,t,u)}function go(a,t,i){return(a.x-i.x)*(t.y-i.y)-(a.y-i.y)*(t.x-i.x)}function Oo(a,t,i,u){const h=go(a,t,u),g=go(a,t,i);if(Math.sign(h)===Math.sign(g))return;const x=go(i,u,a),b=x+g-h;return Math.sign(x)!==Math.sign(b)?[x/(x-b),g/(g-h)]:void 0}function Vi(a,t,i){const u=i*i;if(t.length===1)return a.distSqr(t[0])<u;for(let h=1;h<t.length;h++)if(oa(a,t[h-1],t[h])<u)return!0;return!1}function oa(a,t,i){const u=t.distSqr(i);if(u===0)return a.distSqr(t);const h=((a.x-t.x)*(i.x-t.x)+(a.y-t.y)*(i.y-t.y))/u;return a.distSqr(h<0?t:h>1?i:i.sub(t)._mult(h)._add(t))}function Pa(a,t){let i,u,h,g=!1;for(let x=0;x<a.length;x++){i=a[x];for(let b=0,j=i.length-1;b<i.length;j=b++)u=i[b],h=i[j],u.y>t.y!=h.y>t.y&&t.x<(h.x-u.x)*(t.y-u.y)/(h.y-u.y)+u.x&&(g=!g)}return g}function Ui(a,t){let i=!1;for(let u=0,h=a.length-1;u<a.length;h=u++){const g=a[u],x=a[h];g.y>t.y!=x.y>t.y&&t.x<(x.x-g.x)*(t.y-g.y)/(x.y-g.y)+g.x&&(i=!i)}return i}function Pr(a,t,i,u,h){for(const x of a)if(t<=x.x&&i<=x.y&&u>=x.x&&h>=x.y)return!0;const g=[new et(t,i),new et(t,h),new et(u,h),new et(u,i)];if(a.length>2){for(const x of g)if(Ui(a,x))return!0}for(let x=0;x<a.length-1;x++)if(Sr(a[x],a[x+1],g))return!0;return!1}function Sr(a,t,i){const u=i[0],h=i[2];if(a.x<u.x&&t.x<u.x||a.x>h.x&&t.x>h.x||a.y<u.y&&t.y<u.y||a.y>h.y&&t.y>h.y)return!1;const g=Ar(a,t,i[0]);return g!==Ar(a,t,i[1])||g!==Ar(a,t,i[2])||g!==Ar(a,t,i[3])}function Xn(a,t,i,u,h,g){let x=t.y-a.y,b=a.x-t.x;if(g=g||0){const j=x*x+b*b;if(j===0)return!0;const T=Math.sqrt(j);x/=T,b/=T}return!((i.x-a.x)*x+(i.y-a.y)*b-g<0||(u.x-a.x)*x+(u.y-a.y)*b-g<0||(h.x-a.x)*x+(h.y-a.y)*b-g<0)}function Hr(a,t,i,u,h,g,x){return!(Xn(a,t,u,h,g,x)||Xn(t,i,u,h,g,x)||Xn(i,a,u,h,g,x)||Xn(u,h,a,t,i,x)||Xn(h,g,a,t,i,x)||Xn(g,u,a,t,i,x))}function bi(a,t,i){const u=t.paint.get(a).value;return u.kind==="constant"?u.value:i.programConfigurations.get(t.id).getMaxValue(a)}function Ir(a){return Math.sqrt(a[0]*a[0]+a[1]*a[1])}function aa(a,t,i,u,h){if(!t[0]&&!t[1])return a;const g=et.convert(t)._mult(h);i==="viewport"&&g._rotate(-u);const x=[];for(let b=0;b<a.length;b++)x.push(a[b].sub(g));return x}function Iu(a,t,i,u){const h=et.convert(a)._mult(u);return t==="viewport"&&h._rotate(-i),h}let zc,Ud;function $d(a,t,i){var u=2*Math.PI*6378137/256/Math.pow(2,i);return[a*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}Yt(Sn,"CircleBucket",{omit:["layers"]});class la{constructor(t,i,u){this.z=t,this.x=i,this.y=u,this.key=ca(0,t,t,i,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const i=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>i&&t.y===this.y>>i}url(t,i){const u=function(g,x,b){var j=$d(256*g,256*(x=Math.pow(2,b)-x-1),b),T=$d(256*(g+1),256*(x+1),b);return j[0]+","+j[1]+","+T[0]+","+T[1]}(this.x,this.y,this.z),h=function(g,x,b){let j,T="";for(let A=g;A>0;A--)j=1<<A-1,T+=(x&j?1:0)+(b&j?2:0);return T}(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(i==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",h).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class yl{constructor(t,i){this.wrap=t,this.canonical=i,this.key=ca(t,i.z,i.z,i.x,i.y)}}class Wr{constructor(t,i,u,h,g){this.overscaledZ=t,this.wrap=i,this.canonical=new la(u,+h,+g),this.key=i===0&&t===u?this.canonical.key:ca(i,t,u,h,g)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const i=this.canonical.z-t;return t>this.canonical.z?new Wr(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new Wr(t,this.wrap,t,this.canonical.x>>i,this.canonical.y>>i)}calculateScaledKey(t,i=!0){if(this.overscaledZ===t&&i)return this.key;if(t>this.canonical.z)return ca(this.wrap*+i,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return ca(this.wrap*+i,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const i=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>i&&t.canonical.y===this.canonical.y>>i}children(t){if(this.overscaledZ>=t)return[new Wr(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const i=this.canonical.z+1,u=2*this.canonical.x,h=2*this.canonical.y;return[new Wr(i,this.wrap,i,u,h),new Wr(i,this.wrap,i,u+1,h),new Wr(i,this.wrap,i,u,h+1),new Wr(i,this.wrap,i,u+1,h+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new Wr(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new Wr(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new yl(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function ca(a,t,i,u,h){const g=1<<Math.min(i,22);let x=g*(h%g)+u%g;return a&&i<22&&(x+=g*g*((a<0?-2*a-1:2*a)%(1<<2*(22-i)))),16*(32*x+i)+(t-i)}const Mu=[a=>{let t=a.canonical.x-1,i=a.wrap;return t<0&&(t=(1<<a.canonical.z)-1,i--),new Wr(a.overscaledZ,i,a.canonical.z,t,a.canonical.y)},a=>{let t=a.canonical.x+1,i=a.wrap;return t===1<<a.canonical.z&&(t=0,i++),new Wr(a.overscaledZ,i,a.canonical.z,t,a.canonical.y)},a=>new Wr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,(a.canonical.y===0?1<<a.canonical.z:a.canonical.y)-1),a=>new Wr(a.overscaledZ,a.wrap,a.canonical.z,a.canonical.x,a.canonical.y===(1<<a.canonical.z)-1?0:a.canonical.y+1)];Yt(la,"CanonicalTileID"),Yt(Wr,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const W$=ln([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:j1}=W$,q$=ln([{name:"a_pos_3",components:3,type:"Int16"}]);var uI=ln([{name:"a_pos",type:"Int16",components:2}]);function T1(a){return a*to/C}const Z$=[new qs([y,y,y],[v,v,v]),new qs([y,y,y],[0,0,v]),new qs([0,y,y],[v,0,v]),new qs([y,0,y],[0,v,v]),new qs([0,0,y],[v,v,v])];function dI(a,t,i,u=!0){const h=nt([],a._camera.position,a.worldSize),g=[t,i,1,1];gi(g,g,a.pixelMatrixInverse),ao(g,g,1/g[3]);const x=Ms([],vn([],g,h)),b=a.globeMatrix,j=[b[12],b[13],b[14]],T=vn([],j,h),A=Dt(T),I=Ms([],T),R=a.worldSize/(2*Math.PI),B=Xt(I,x),V=Math.asin(R/A);if(V<Math.acos(B)){if(!u)return null;const Qe=[],Fe=[];nt(Qe,x,A/B),Ms(Fe,vn(Fe,Qe,T)),Ms(x,Vt(x,T,nt(x,Fe,Math.tan(V)*A)))}const K=[];new fn(h,x).closestPointOnSphere(j,R,K);const Q=Ms([],vr(b,0)),re=Ms([],vr(b,1)),ue=Ms([],vr(b,2)),ce=Xt(Q,K),he=Xt(re,K),Ee=Xt(ue,K),we=Be(Math.asin(-he/R));let je=Be(Math.atan2(ce,Ee));je=a.center.lng+function(Qe,Fe){const st=(Fe-Qe+180)%360-180;return st<-180?st+360:st}(a.center.lng,je);const Me=J(je),ke=xe(se(we),0,1);return new be(Me,ke)}class K${constructor(t,i,u){this.a=vn([],t,u),this.b=vn([],i,u),this.center=u;const h=Ms([],this.a),g=Ms([],this.b);this.angle=Math.acos(Xt(h,g))}}function rj(a,t){if(a.angle===0)return null;let i;return i=a.a[t]===0?1/a.angle*.5*Math.PI:1/a.angle*Math.atan(a.b[t]/a.a[t]/Math.sin(a.angle)-1/Math.tan(a.angle)),i<0||i>1?null:function(u,h,g,x){const b=Math.sin(g);return u*(Math.sin((1-x)*g)/b)+h*(Math.sin(x*g)/b)}(a.a[t],a.b[t],a.angle,xe(i,0,1))+a.center[t]}function Oc(a){if(a.z<=1)return Z$[a.z+2*a.y+a.x];const t=ij(N1(a));return qs.fromPoints(t)}function Ru(a,t,i){return nt(a,a,1-i),Mt(a,a,t,i)}function hI(a,t,i){for(const u of a)ws(u,u,t),nt(u,u,i)}function pI(a,t,i,u){const h=t/a.worldSize,g=a.globeMatrix;if(i.z<=1){const ke=Oc(i).getCorners();return hI(ke,g,h),qs.fromPoints(ke)}const x=N1(i,u),b=ij(x,to+T1(a._tileCoverLift));hI(b,g,h);const j=Number.MAX_VALUE,T=[-j,-j,-j],A=[j,j,j];if(x.contains(a.center)){for(const Fe of b)Xe(A,A,Fe),Ot(T,T,Fe);T[2]=0;const ke=a.point,Qe=[ke.x*h,ke.y*h,0];return Xe(A,A,Qe),Ot(T,T,Qe),new qs(A,T)}if(a._tileCoverLift>0){for(const ke of b)Xe(A,A,ke),Ot(T,T,ke);return new qs(A,T)}const I=[g[12]*h,g[13]*h,g[14]*h],R=x.getCenter(),B=xe(a.center.lat,-ye,ye),V=xe(R.lat,-ye,ye),K=J(a.center.lng),Q=se(B);let re=K-J(R.lng);const ue=Q-se(V);re>.5?re-=1:re<-.5&&(re+=1);let ce=0;Math.abs(re)>Math.abs(ue)?ce=re>=0?1:3:(ce=ue>=0?0:2,Mt(I,I,[g[4]*h,g[5]*h,g[6]*h],-Math.sin(Ks(ue>=0?x.getSouth():x.getNorth()))*to));const he=b[ce],Ee=b[(ce+1)%4],we=new K$(he,Ee,I),je=[rj(we,0)||he[0],rj(we,1)||he[1],rj(we,2)||he[2]],Me=Gd(a.zoom);if(Me>0){const ke=function({x:Fe,y:st,z:Tt},lt,gt,St,Ye){const _t=1/(1<<Tt);let Ve=Fe*_t,Je=Ve+_t,Ct=st*_t,vt=Ct+_t,os=0;const Jt=(Ve+Je)/2-St;return Jt>.5?os=-1:Jt<-.5&&(os=1),Ve=((Ve+os)*lt-(St*=lt))*gt+St,Je=((Je+os)*lt-St)*gt+St,Ct=(Ct*lt-(Ye*=lt))*gt+Ye,vt=(vt*lt-Ye)*gt+Ye,[[Ve,vt,0],[Je,vt,0],[Je,Ct,0],[Ve,Ct,0]]}(i,t,a._pixelsPerMercatorPixel,K,Q);for(let Fe=0;Fe<b.length;Fe++)Ru(b[Fe],ke[Fe],Me);const Qe=Vt([],ke[ce],ke[(ce+1)%4]);nt(Qe,Qe,.5),Ru(je,Qe,Me)}for(const ke of b)Xe(A,A,ke),Ot(T,T,ke);return A[2]=Math.min(he[2],Ee[2]),Xe(A,A,je),Ot(T,T,je),new qs(A,T)}function N1({x:a,y:t,z:i},u=!1){const h=1/(1<<i),g=new D(le(a*h),t===(1<<i)-1&&u?-90:de((t+1)*h)),x=new D(le((a+1)*h),t===0&&u?90:de(t*h));return new U(g,x)}function ij(a,t=to){const i=Ks(a.getNorth()),u=Ks(a.getSouth()),h=Math.cos(i),g=Math.cos(u),x=Math.sin(i),b=Math.sin(u),j=a.getWest(),T=a.getEast();return[S(g,b,j,t),S(g,b,T,t),S(h,x,T,t),S(h,x,j,t)]}function Wy(a,t,i,u){const h=1<<i.z,g=(a/Rt+i.x)/h;return N(de((t/Rt+i.y)/h),le(g),u)}function E1({min:a,max:t}){return r/Math.max(t[0]-a[0],t[1]-a[1],t[2]-a[2])}const fI=new Float64Array(16);function C1(a){const t=E1(a),i=Pe(fI,[t,t,t]);return W(i,i,xn([],a.min))}function oj(a){const t=(u=a.min,(i=fI)[0]=1,i[1]=0,i[2]=0,i[3]=0,i[4]=0,i[5]=1,i[6]=0,i[7]=0,i[8]=0,i[9]=0,i[10]=1,i[11]=0,i[12]=u[0],i[13]=u[1],i[14]=u[2],i[15]=1,i);var i,u;const h=1/E1(a);return q(t,t,[h,h,h])}function aj(a){const t=Rt/(2*Math.PI);return a/(2*Math.PI)/t}function mI(a,t){return Rt/(512*Math.pow(2,a))*E1(Oc(t))}function gI(a,t,i,u,h){const g=aj(i),x=[a,t,-i/(2*Math.PI)],b=H(new Float64Array(16));return W(b,b,x),q(b,b,[g,g,g]),oe(b,b,Ks(-h)),ae(b,b,Ks(-u)),b}function Gd(a){return Re(S1,p,a)}function xI(a,t){const i=N(t.lat,t.lng),u=function(V){const K=N(V._center.lat,V._center.lng);let Q=It([],wt(0,1,0),K);const re=Le([],-V.angle,K);Q=ws(Q,Q,re),Le(re,-V._pitch,Q);const ue=Ms([],K);return nt(ue,ue,T1(V.cameraToCenterDistance/V.pixelsPerMeter)),ws(ue,ue,re),Vt([],K,ue)}(a);return x=(h=Bt([],u,i))[0],b=h[1],j=h[2],T=(g=i)[0],A=g[1],I=g[2],B=(R=Math.sqrt(x*x+b*b+j*j)*Math.sqrt(T*T+A*A+I*I))&&Xt(h,g)/R,Math.acos(Math.min(Math.max(B,-1),1));var h,g,x,b,j,T,A,I,R,B}function lj(a,t){return xI(a,t)>Math.PI/2*1.01}const yI=Ks(85),X$=Math.cos(yI),Y$=Math.sin(yI),J$=Y(),_I=a=>{const t=[];return a.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),a.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function vI(a,t,i,u,h,g,x,b,j){if(g&&a.queryGeometry.isAboveHorizon)return!1;g&&(j*=a.pixelToTileUnitsFactor);const T=a.tileID.canonical,A=i.projection.upVectorScale(T,i.center.lat,i.worldSize).metersToTile;for(const I of t)for(const R of I){const B=R.add(b),V=h&&i.elevation?i.elevation.exaggeration()*h.getElevationAt(B.x,B.y,!0):0,K=i.projection.projectTilePoint(B.x,B.y,T);if(V>0){const ce=i.projection.upVector(T,B.x,B.y);K.x+=ce[0]*A*V,K.y+=ce[1]*A*V,K.z+=ce[2]*A*V}const Q=g?B:Q$(K.x,K.y,K.z,u),re=g?a.tilespaceRays.map(ce=>tG(ce,V)):a.queryGeometry.screenGeometry,ue=gi([],[K.x,K.y,K.z,1],u);if(!x&&g?j*=ue[3]/i.cameraToCenterDistance:x&&!g&&(j*=i.cameraToCenterDistance/ue[3]),g){const ce=de((R.y/Rt+T.y)/(1<<T.z));j/=i.projection.pixelsPerMeter(ce,1)/te(1,ce)}if(Or(re,Q,j))return!0}return!1}function Q$(a,t,i,u){const h=gi([],[a,t,i,1],u);return new et(h[0]/h[3],h[1]/h[3])}const bI=wt(0,0,0),eG=wt(0,0,1);function tG(a,t){const i=yt();return bI[2]=t,a.intersectsPlane(bI,eG,i),new et(i[0],i[1])}class wI extends Sn{}let SI,jI,TI,NI;function EI(a,{width:t,height:i},u,h){if(h){if(h instanceof Uint8ClampedArray)h=new Uint8Array(h.buffer);else if(h.length!==t*i*u)throw new RangeError("mismatched image size")}else h=new Uint8Array(t*i*u);return a.width=t,a.height=i,a.data=h,a}function CI(a,t,i){const{width:u,height:h}=t;u===a.width&&h===a.height||(cj(a,t,{x:0,y:0},{x:0,y:0},{width:Math.min(a.width,u),height:Math.min(a.height,h)},i,null),a.width=u,a.height=h,a.data=t.data)}function cj(a,t,i,u,h,g,x,b){if(h.width===0||h.height===0)return t;if(h.width>a.width||h.height>a.height||i.x>a.width-h.width||i.y>a.height-h.height)throw new RangeError("out of range source coordinates for image copy");if(h.width>t.width||h.height>t.height||u.x>t.width-h.width||u.y>t.height-h.height)throw new RangeError("out of range destination coordinates for image copy");const j=a.data,T=t.data,A=g===4&&b;for(let I=0;I<h.height;I++){const R=((i.y+I)*a.width+i.x)*g,B=((u.y+I)*t.width+u.x)*g;if(A)for(let V=0;V<h.width;V++){const K=R+V*g+3,Q=B+V*g;T[Q+0]=255,T[Q+1]=255,T[Q+2]=255,T[Q+3]=j[K]}else if(x)for(let V=0;V<h.width;V++){const K=R+V*g,Q=B+V*g,re=new En(j[K+0]/255,j[K+1]/255,j[K+2]/255,j[K+3]).toNonPremultipliedRenderColor(x).toArray();T[Q+0]=re[0],T[Q+1]=re[1],T[Q+2]=re[2],T[Q+3]=re[3]}else for(let V=0;V<h.width*g;V++)T[B+V]=j[R+V]}return t}Yt(wI,"HeatmapBucket",{omit:["layers"]});class Hd{constructor(t,i){EI(this,t,1,i)}resize(t){CI(this,new Hd(t),1)}clone(){return new Hd({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,u,h,g){cj(t,i,u,h,g,1,null)}}class $i{constructor(t,i){EI(this,t,4,i)}resize(t){CI(this,new $i(t),4)}replace(t,i){i?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new $i({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,i,u,h,g,x,b){cj(t,i,u,h,g,4,x,b)}}class AI{constructor(t,i){this.width=t.width,this.height=t.height,this.data=i instanceof Uint8Array?new Float32Array(i.buffer):i}}function qy(a){const t={},i=a.resolution||256,u=a.clips?a.clips.length:1,h=a.image||new $i({width:i,height:u}),g=(x,b,j)=>{t[a.evaluationKey]=j;const T=a.expression.evaluate(t),A=T?T.toNonPremultipliedRenderColor(null):null;A&&(h.data[x+b+0]=Math.floor(255*A.r),h.data[x+b+1]=Math.floor(255*A.g),h.data[x+b+2]=Math.floor(255*A.b),h.data[x+b+3]=Math.floor(255*A.a))};if(a.clips)for(let x=0,b=0;x<u;++x,b+=4*i)for(let j=0,T=0;j<i;j++,T+=4){const A=j/(i-1),{start:I,end:R}=a.clips[x];g(b,T,I*(1-A)+R*A)}else for(let x=0,b=0;x<i;x++,b+=4)g(0,b,x/(i-1));return h}Yt(Hd,"AlphaImage"),Yt($i,"RGBAImage");const sG=ln([{name:"a_pos",components:2,type:"Int16"}],4),nG=ln([{name:"a_road_z_offset",components:1,type:"Float32"}],4),rG=ln([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),iG=ln([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Fm(a,t,i=2){const u=t&&t.length,h=u?t[0]*i:a.length;let g=PI(a,0,h,i,!0);const x=[];if(!g||g.next===g.prev)return x;let b,j,T;if(u&&(g=function(A,I,R,B){const V=[];for(let K=0,Q=I.length;K<Q;K++){const re=PI(A,I[K]*B,K<Q-1?I[K+1]*B:A.length,B,!1);re===re.next&&(re.steiner=!0),V.push(pG(re))}V.sort(uG);for(let K=0;K<V.length;K++)R=dG(V[K],R);return R}(a,t,g,i)),a.length>80*i){b=a[0],j=a[1];let A=b,I=j;for(let R=i;R<h;R+=i){const B=a[R],V=a[R+1];B<b&&(b=B),V<j&&(j=V),B>A&&(A=B),V>I&&(I=V)}T=Math.max(A-b,I-j),T=T!==0?32767/T:0}return Zy(g,x,i,b,j,T,0),x}function PI(a,t,i,u,h){let g;if(h===function(x,b,j,T){let A=0;for(let I=b,R=j-T;I<j;I+=T)A+=(x[R]-x[I])*(x[I+1]+x[R+1]),R=I;return A}(a,t,i,u)>0)for(let x=t;x<i;x+=u)g=kI(x/u|0,a[x],a[x+1],g);else for(let x=i-u;x>=t;x-=u)g=kI(x/u|0,a[x],a[x+1],g);return g&&Bm(g,g.next)&&(Yy(g),g=g.next),g}function Dp(a,t){if(!a)return a;t||(t=a);let i,u=a;do if(i=!1,u.steiner||!Bm(u,u.next)&&ai(u.prev,u,u.next)!==0)u=u.next;else{if(Yy(u),u=t=u.prev,u===u.next)break;i=!0}while(i||u!==t);return t}function Zy(a,t,i,u,h,g,x){if(!a)return;!x&&g&&function(j,T,A,I){let R=j;do R.z===0&&(R.z=uj(R.x,R.y,T,A,I)),R.prevZ=R.prev,R.nextZ=R.next,R=R.next;while(R!==j);R.prevZ.nextZ=null,R.prevZ=null,function(B){let V,K=1;do{let Q,re=B;B=null;let ue=null;for(V=0;re;){V++;let ce=re,he=0;for(let we=0;we<K&&(he++,ce=ce.nextZ,ce);we++);let Ee=K;for(;he>0||Ee>0&&ce;)he!==0&&(Ee===0||!ce||re.z<=ce.z)?(Q=re,re=re.nextZ,he--):(Q=ce,ce=ce.nextZ,Ee--),ue?ue.nextZ=Q:B=Q,Q.prevZ=ue,ue=Q;re=ce}ue.nextZ=null,K*=2}while(V>1)}(R)}(a,u,h,g);let b=a;for(;a.prev!==a.next;){const j=a.prev,T=a.next;if(g?aG(a,u,h,g):oG(a))t.push(j.i,a.i,T.i),Yy(a),a=T.next,b=T.next;else if((a=T)===b){x?x===1?Zy(a=lG(Dp(a),t),t,i,u,h,g,2):x===2&&cG(a,t,i,u,h,g):Zy(Dp(a),t,i,u,h,g,1);break}}}function oG(a){const t=a.prev,i=a,u=a.next;if(ai(t,i,u)>=0)return!1;const h=t.x,g=i.x,x=u.x,b=t.y,j=i.y,T=u.y,A=Math.min(h,g,x),I=Math.min(b,j,T),R=Math.max(h,g,x),B=Math.max(b,j,T);let V=u.next;for(;V!==t;){if(V.x>=A&&V.x<=R&&V.y>=I&&V.y<=B&&Ky(h,b,g,j,x,T,V.x,V.y)&&ai(V.prev,V,V.next)>=0)return!1;V=V.next}return!0}function aG(a,t,i,u){const h=a.prev,g=a,x=a.next;if(ai(h,g,x)>=0)return!1;const b=h.x,j=g.x,T=x.x,A=h.y,I=g.y,R=x.y,B=Math.min(b,j,T),V=Math.min(A,I,R),K=Math.max(b,j,T),Q=Math.max(A,I,R),re=uj(B,V,t,i,u),ue=uj(K,Q,t,i,u);let ce=a.prevZ,he=a.nextZ;for(;ce&&ce.z>=re&&he&&he.z<=ue;){if(ce.x>=B&&ce.x<=K&&ce.y>=V&&ce.y<=Q&&ce!==h&&ce!==x&&Ky(b,A,j,I,T,R,ce.x,ce.y)&&ai(ce.prev,ce,ce.next)>=0||(ce=ce.prevZ,he.x>=B&&he.x<=K&&he.y>=V&&he.y<=Q&&he!==h&&he!==x&&Ky(b,A,j,I,T,R,he.x,he.y)&&ai(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;ce&&ce.z>=re;){if(ce.x>=B&&ce.x<=K&&ce.y>=V&&ce.y<=Q&&ce!==h&&ce!==x&&Ky(b,A,j,I,T,R,ce.x,ce.y)&&ai(ce.prev,ce,ce.next)>=0)return!1;ce=ce.prevZ}for(;he&&he.z<=ue;){if(he.x>=B&&he.x<=K&&he.y>=V&&he.y<=Q&&he!==h&&he!==x&&Ky(b,A,j,I,T,R,he.x,he.y)&&ai(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function lG(a,t){let i=a;do{const u=i.prev,h=i.next.next;!Bm(u,h)&&MI(u,i,i.next,h)&&Xy(u,h)&&Xy(h,u)&&(t.push(u.i,i.i,h.i),Yy(i),Yy(i.next),i=a=h),i=i.next}while(i!==a);return Dp(i)}function cG(a,t,i,u,h,g){let x=a;do{let b=x.next.next;for(;b!==x.prev;){if(x.i!==b.i&&fG(x,b)){let j=RI(x,b);return x=Dp(x,x.next),j=Dp(j,j.next),Zy(x,t,i,u,h,g,0),void Zy(j,t,i,u,h,g,0)}b=b.next}x=x.next}while(x!==a)}function uG(a,t){let i=a.x-t.x;return i===0&&(i=a.y-t.y,i===0)&&(i=(a.next.y-a.y)/(a.next.x-a.x)-(t.next.y-t.y)/(t.next.x-t.x)),i}function dG(a,t){const i=function(h,g){let x=g;const b=h.x,j=h.y;let T,A=-1/0;if(Bm(h,x))return x;do{if(Bm(h,x.next))return x.next;if(j<=x.y&&j>=x.next.y&&x.next.y!==x.y){const K=x.x+(j-x.y)*(x.next.x-x.x)/(x.next.y-x.y);if(K<=b&&K>A&&(A=K,T=x.x<x.next.x?x:x.next,K===b))return T}x=x.next}while(x!==g);if(!T)return null;const I=T,R=T.x,B=T.y;let V=1/0;x=T;do{if(b>=x.x&&x.x>=R&&b!==x.x&&II(j<B?b:A,j,R,B,j<B?A:b,j,x.x,x.y)){const K=Math.abs(j-x.y)/(b-x.x);Xy(x,h)&&(K<V||K===V&&(x.x>T.x||x.x===T.x&&hG(T,x)))&&(T=x,V=K)}x=x.next}while(x!==I);return T}(a,t);if(!i)return t;const u=RI(i,a);return Dp(u,u.next),Dp(i,i.next)}function hG(a,t){return ai(a.prev,a,t.prev)<0&&ai(t.next,a,a.next)<0}function uj(a,t,i,u,h){return(a=1431655765&((a=858993459&((a=252645135&((a=16711935&((a=(a-i)*h|0)|a<<8))|a<<4))|a<<2))|a<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*h|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function pG(a){let t=a,i=a;do(t.x<i.x||t.x===i.x&&t.y<i.y)&&(i=t),t=t.next;while(t!==a);return i}function II(a,t,i,u,h,g,x,b){return(h-x)*(t-b)>=(a-x)*(g-b)&&(a-x)*(u-b)>=(i-x)*(t-b)&&(i-x)*(g-b)>=(h-x)*(u-b)}function Ky(a,t,i,u,h,g,x,b){return!(a===x&&t===b)&&II(a,t,i,u,h,g,x,b)}function fG(a,t){return a.next.i!==t.i&&a.prev.i!==t.i&&!function(i,u){let h=i;do{if(h.i!==i.i&&h.next.i!==i.i&&h.i!==u.i&&h.next.i!==u.i&&MI(h,h.next,i,u))return!0;h=h.next}while(h!==i);return!1}(a,t)&&(Xy(a,t)&&Xy(t,a)&&function(i,u){let h=i,g=!1;const x=(i.x+u.x)/2,b=(i.y+u.y)/2;do h.y>b!=h.next.y>b&&h.next.y!==h.y&&x<(h.next.x-h.x)*(b-h.y)/(h.next.y-h.y)+h.x&&(g=!g),h=h.next;while(h!==i);return g}(a,t)&&(ai(a.prev,a,t.prev)||ai(a,t.prev,t))||Bm(a,t)&&ai(a.prev,a,a.next)>0&&ai(t.prev,t,t.next)>0)}function ai(a,t,i){return(t.y-a.y)*(i.x-t.x)-(t.x-a.x)*(i.y-t.y)}function Bm(a,t){return a.x===t.x&&a.y===t.y}function MI(a,t,i,u){const h=P1(ai(a,t,i)),g=P1(ai(a,t,u)),x=P1(ai(i,u,a)),b=P1(ai(i,u,t));return h!==g&&x!==b||!(h!==0||!A1(a,i,t))||!(g!==0||!A1(a,u,t))||!(x!==0||!A1(i,a,u))||!(b!==0||!A1(i,t,u))}function A1(a,t,i){return t.x<=Math.max(a.x,i.x)&&t.x>=Math.min(a.x,i.x)&&t.y<=Math.max(a.y,i.y)&&t.y>=Math.min(a.y,i.y)}function P1(a){return a>0?1:a<0?-1:0}function Xy(a,t){return ai(a.prev,a,a.next)<0?ai(a,t,a.next)>=0&&ai(a,a.prev,t)>=0:ai(a,t,a.prev)<0||ai(a,a.next,t)<0}function RI(a,t){const i=dj(a.i,a.x,a.y),u=dj(t.i,t.x,t.y),h=a.next,g=t.prev;return a.next=t,t.prev=a,i.next=h,h.prev=i,u.next=i,i.prev=u,g.next=u,u.prev=g,u}function kI(a,t,i,u){const h=dj(a,t,i);return u?(h.next=u.next,h.prev=u,u.next.prev=h,u.next=h):(h.prev=h,h.next=h),h}function Yy(a){a.next.prev=a.prev,a.prev.next=a.next,a.prevZ&&(a.prevZ.nextZ=a.nextZ),a.nextZ&&(a.nextZ.prevZ=a.prevZ)}function dj(a,t,i){return{i:a,x:t,y:i,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Jy(a,t){const i=a.length;if(i<=1)return[a];const u=[];let h,g;for(let x=0;x<i;x++){const b=Yr(a[x]);b!==0&&(a[x].area=Math.abs(b),g===void 0&&(g=b<0),g===b<0?(h&&u.push(h),h=[a[x]]):h.push(a[x]))}if(h&&u.push(h),t>1)for(let x=0;x<u.length;x++)u[x].length<=t||(Qi(u[x],t,1,u[x].length-1,mG),u[x]=u[x].slice(0,t));return u}function mG(a,t){return t.area-a.area}function DI(a,t,i=1){if(!a)return null;const u=typeof a=="string"?Eo.from(a).getPrimary():a.getPrimary(),h=typeof a=="string"?null:a.getSecondary();for(const g of[u,h]){if(!g)continue;const x=g.id.toString();t.has(x)||t.set(x,[]),g.scaleSelf(i),t.get(x).push(g)}return{primary:u.toString(),secondary:h?h.toString():null}}function hj(a,t,i,u){const h=u.patternDependencies;let g=!1;for(const x of t){const b=x.paint.get(`${a}-pattern`);b.isConstant()||(g=!0),DI(b.constantOr(null),h,i)&&(g=!0)}return g}function pj(a,t,i,u,h,g){const x=g.patternDependencies;for(const b of t){const j=b.paint.get(`${a}-pattern`).value;if(j.kind!=="constant"){let T=j.evaluate({zoom:u},i,{},g.availableImages);T=T&&T.name?T.name:T;const A=DI(T,x,h);if(!A)continue;const{primary:I,secondary:R}=A;I&&(i.patterns[b.id]=[I,R].filter(Boolean))}}return i}class LI{constructor(){this.polygons=new Map}add(t,...i){this.polygons.has(t)?this.polygons.get(t).push(...i):this.polygons.set(t,i)}merge(t){for(const[i,u]of t.polygons)this.add(i,...u)}}class Lp{constructor(){this.portals=[]}static evaluate(t){if(t.length===0)return new Lp;let i=[];for(const T of t)i.push(...T.portals);if(i.length===0)return new Lp;const u=(T,A)=>T<=0&&A<=0||T>=Rt&&A>=Rt;for(const T of i){const A=T.va,I=T.vb;(u(A.x,I.x)||u(A.y,I.y))&&(T.type="border")}const h=i.filter(T=>T.type!=="unevaluated"),g=i.filter(T=>T.type==="unevaluated");if(g.length===0)return new Lp;g.sort((T,A)=>T.hash===A.hash?T.isTunnel===A.isTunnel?0:T.isTunnel?-1:1:T.hash<A.hash?1:-1),i=h.concat(g);let x=h.length,b=x,j=x;do if(b++,b===i.length||i[x].hash!==i[b].hash){if(b-x==2){j<x&&(i[j]=i[x],i[x]=null);const T=i[j],A=i[b-1];T.type=T.isTunnel!==A.isTunnel?"tunnel":"polygon",T.connection={a:T.connection.a,b:A.connection.a},j++}x=b}while(x!==i.length);return i.splice(j),i.sort((T,A)=>T.hash<A.hash?1:-1),{portals:i}}}Yt(Lp,"ElevationPortalGraph"),Yt(LI,"ElevationPolygons");class gG{constructor(t,i,u){this.outPositions=t,this.outNormals=i,this.outIndices=u,this.vertexLookup=new Map,this.buffer=new ArrayBuffer(4),this.view=new DataView(this.buffer)}addVertex(t,i,u){let h=t[2];u!=null&&(h*=u);const g=this.getVec3Bits(t)<<96n|this.getVec3Bits(i),x=this.vertexLookup.get(g);if(x!=null)return x;const b=this.outPositions.length;this.vertexLookup.set(g,b);const j=Math.trunc(16384*i[0]),T=Math.trunc(16384*i[1]),A=Math.trunc(16384*i[2]);return this.outPositions.emplaceBack(t[0],t[1],h),this.outNormals.emplaceBack(j,T,A),b}addTriangle(t,i,u){this.outIndices.emplaceBack(t,i,u)}addTriangles(t,i,u){if(t.length===0)return;const h=u.length===1,g=yt(),x=yt();for(let b=0;b<t.length;b+=3){const j=i[t[b+0]],T=i[t[b+1]],A=i[t[b+2]],I=h?u[0]:u[t[b+1]],R=h?u[0]:u[t[b+2]];rs(g,j.x,j.y,h?u[0]:u[t[b+0]]);const B=this.addVertex(g,x);rs(g,T.x,T.y,I);const V=this.addVertex(g,x);rs(g,A.x,A.y,R);const K=this.addVertex(g,x);this.outIndices.emplaceBack(B,V,K)}}addQuad(t,i,u,h,g,x){const b=this.addVertex(t,g,x),j=this.addVertex(i,g,x),T=this.addVertex(u,g,x),A=this.addVertex(h,g,x);this.addTriangle(b,j,T),this.addTriangle(T,A,b)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}getBits(t){return this.view.setFloat32(0,t),BigInt(this.view.getUint32(0))}getVec3Bits(t){return this.getBits(t[0])<<64n|this.getBits(t[1])<<32n|this.getBits(t[2])}}class ua{constructor(t,i,u,h){this.unevaluatedPortals=new Lp,this.portalPolygons=new LI,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new Ey,this.vertexNormals=new Cy,this.indexArray=new ur,this.tileToMeters=ve(t),this.bridgeProgramConfigurations=new ia(i,{zoom:u,lut:h},g=>g!=="fill-tunnel-structure-color"),this.tunnelProgramConfigurations=new ia(i,{zoom:u,lut:h},g=>g!=="fill-bridge-guard-rail-color")}addVertices(t,i){const u=this.unevalVertices.length;for(let h=0;h<t.length;h++)this.unevalVertices.push(t[h]),this.unevalHeights.push(i[h]);return u}addTriangles(t,i,u){const h=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const g of t)h.push(g+i)}addRenderableRing(t,i,u,h,g,x){const b=[new et(g.min.x,g.min.y),new et(g.max.x,g.min.y),new et(g.max.x,g.max.y),new et(g.min.x,g.max.y)];for(let j=0;j<u-1;j++){const T=i+j,A=T+1,I=this.unevalVertices[T],R=this.unevalVertices[A];if(!(I.x>=g.min.x&&I.x<=g.max.x&&I.y>=g.min.y&&I.y<=g.max.y||R.x>=g.min.x&&R.x<=g.max.x&&R.y>=g.min.y&&R.y<=g.max.y||Sr(I,R,b))||this.isOnBorder(I.x,R.x)||this.isOnBorder(I.y,R.y))continue;const B=ua.computeEdgeHash(this.unevalVertices[T],this.unevalVertices[A]);let V,K=this.vertexHashLookup.get(ua.computePosHash(I));K!=null?V=K.next:(K=this.vertexHashLookup.get(ua.computePosHash(R)),V=K!=null?K.prev:B),this.unevalEdges.push({polygonIdx:t,a:T,b:A,hash:B,portalHash:V,isTunnel:h,type:"unevaluated",featureInfo:x})}}addPortalCandidates(t,i,u,h,g){if(i.length===0)return;this.portalPolygons.add(t,{geometry:i,zLevel:g});const x=i[0];this.vertexHashLookup.clear();let b=ua.computeEdgeHash(x[x.length-2],x[x.length-1]);for(let j=0;j<x.length-1;j++){const T=x[j+0],A=x[j+1],I=co(A.x-T.x,A.y-T.y),R=So(I);if(R===0)continue;let B="unevaluated";const V=h.pointElevation(T),K=h.pointElevation(A);Math.abs(V)<.01&&Math.abs(K)<.01?B="entrance":(this.isOnBorder(T.x,A.x)||this.isOnBorder(T.y,A.y))&&(B="border");const Q=ua.computeEdgeHash(T,A);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:T,vb:A,vab:I,length:R,hash:Q,isTunnel:u,type:B});const re=ua.computePosHash(T);this.vertexHashLookup.set(re,{prev:b,next:Q}),b=Q}}construct(t){if(this.unevalVertices.length===0)return;const i=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=R=>{R.primitiveLength=this.indexArray.length-R.primitiveOffset},h=new gG(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const g=i(),x=i(),b=i(),j=(R,B)=>{R.sort((K,Q)=>K.type===B&&Q.type!==B?-1:K.type!==B&&Q.type===B?1:0);const V=R.findIndex(K=>K.type!==B);return V>=0?V:R.length};let T=0;this.unevalEdges.length>0&&(T=j(this.unevalEdges,"none"),this.constructBridgeStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},this.tileToMeters)),u(b);const A=i(),I=i();if(this.unevalEdges.length>0){const R=this.unevalEdges.splice(T),B=j(R,"tunnel")+T;this.unevalEdges.push(...R),this.constructTunnelStructures(h,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:T},{min:T,max:B})}u(A),h.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(I),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(x),h.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(g),this.maskSegments=mr.simpleSegment(0,I.primitiveOffset,0,I.primitiveLength),this.depthSegments=mr.simpleSegment(0,x.primitiveOffset,0,x.primitiveLength),this.renderableBridgeSegments=mr.simpleSegment(0,b.primitiveOffset,0,b.primitiveLength),this.renderableTunnelSegments=mr.simpleSegment(0,A.primitiveOffset,0,A.primitiveLength),this.shadowCasterSegments=mr.simpleSegment(0,g.primitiveOffset,0,g.primitiveLength)}update(t,i,u,h,g,x,b,j){this.bridgeProgramConfigurations.updatePaintArrays(t,i,g,u,h,x,b,j),this.tunnelProgramConfigurations.updatePaintArrays(t,i,g,u,h,x,b,j)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,rG.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,iG.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,i,u,h,g){const x=(b,j)=>{for(let T=0;T<j.length-1;T++){const A=j[T].featureIndex,I=j[T+1].vertexStart,R=t.feature(A);b.populatePaintArrays(I,R,A,{},u,i,h,void 0,g)}};x(this.bridgeProgramConfigurations,this.bridgeFeatureSections),x(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,i,u,h,g){const x=new Map;for(let b=h;b<g;b++){const j=u[b],T=j.a,A=j.b,I=ua.computePosHash(t[T]),R=ua.computePosHash(t[A]);let B=x.get(I);B||(B={},x.set(I,B));let V=x.get(R);V||(V={},x.set(R,V)),i[T]<=0&&i[A]<=0||(B.to=A,V.from=T)}return x}isTerminalVertex(t,i){const u=ua.computePosHash(this.unevalVertices[t]),h=i.get(u);return!h||!h.from||!h.to}constructBridgeStructures(t,i,u,h,g,x){t.clearVertexLookup();const b=this.computeVertexConnections(i,u,h,g.min,g.max),j=1/x,T=.5*j,A=(gt,St)=>rs(gt,i[St].x,i[St].y,u[St]*j),I=yt(),R=yt(),B=yt(),V=yt(),K=yt(),Q=(gt,St)=>{const Ye=b.get(ua.computePosHash(i[St])),_t=Ye.from,Ve=Ye.to;if(!_t||!Ve)return;A(I,_t),A(R,St),A(B,Ve),wr(V),cr(I,R)||(vn(K,R,I),Ms(V,K)),cr(B,R)||(vn(K,B,R),Vt(V,V,Ms(K,K)));const Je=Rr(V);return Je>0?nt(gt,V,1/Je):void 0};let re=Number.POSITIVE_INFINITY;this.sortSubarray(h,g.min,g.max,(gt,St)=>gt.featureInfo.featureIndex-St.featureInfo.featureIndex);const ue=yt(),ce=yt(),he=yt(),Ee=yt(),we=yt(),je=yt(),Me=yt(),ke=yt(),Qe=yt(),Fe=[yt(),yt(),yt(),yt()],st=[yt(),yt(),yt(),yt()],Tt=[{coord:new et(0,0),height:0},{coord:new et(0,0),height:0}],lt=(gt,St)=>gt>St;for(let gt=g.min;gt<g.max;gt++){const St=h[gt];if(!St.featureInfo.guardRailEnabled||!this.prepareEdgePoints(Tt,i,u,St,lt))continue;const[Ye,_t]=Tt;if(rs(ue,Ye.coord.x,Ye.coord.y,j*Ye.height),rs(ce,_t.coord.x,_t.coord.y,j*_t.height),cr(ue,ce))continue;vn(he,ce,ue),Ms(he,he);const Ve=Q(ke,St.a)||he,Je=Q(Qe,St.b)||he;rs(Ee,Ve[1],-Ve[0],0),Ms(Ee,Ee),rs(we,Je[1],-Je[0],0),Ms(we,we),It(ke,Ee,Ve),Ms(je,ke),It(ke,we,Je),Ms(Me,ke),Vt(Fe[0],ue,nt(ke,vn(ke,Ee,je),T)),Vt(Fe[1],ue,nt(ke,Vt(ke,Ee,je),T)),Vt(Fe[2],ue,nt(ke,je,T)),Fe[3]=ue,Vt(st[0],ce,nt(ke,vn(ke,we,Me),T)),Vt(st[1],ce,nt(ke,Vt(ke,we,Me),T)),Vt(st[2],ce,nt(ke,Me,T)),st[3]=ce,re=this.addFeatureSection(St.featureInfo.featureIndex,re,this.bridgeFeatureSections,t);const Ct=t.addVertex(Fe[0],Ee,x),vt=t.addVertex(Fe[1],Ee,x),os=t.addVertex(st[0],we,x),Jt=t.addVertex(st[1],we,x);t.addTriangle(Ct,vt,os),t.addTriangle(vt,Jt,os);const ft=t.addVertex(Fe[1],je,x),bt=t.addVertex(Fe[2],je,x),ts=t.addVertex(st[1],Me,x),qt=t.addVertex(st[2],Me,x);t.addTriangle(ft,bt,ts),t.addTriangle(bt,qt,ts),xn(Ee,Ee),xn(we,we);const kt=t.addVertex(Fe[2],Ee,x),Zt=t.addVertex(Fe[3],Ee,x),xs=t.addVertex(st[2],we,x),As=t.addVertex(st[3],we,x);t.addTriangle(kt,Zt,xs),t.addTriangle(Zt,As,xs);const zs=this.isTerminalVertex(St.a,b),ks=this.isTerminalVertex(St.b,b);Ye.height<.01&&zs&&t.addQuad(Fe[3],Fe[2],Fe[1],Fe[0],xn(Ve,Ve),x),_t.height<.01&&ks&&t.addQuad(st[0],st[1],st[2],st[3],Je,x)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,i,u,h,g,x){t.clearVertexLookup();let b=Number.POSITIVE_INFINITY;const j=(re,ue)=>re.featureInfo.featureIndex-ue.featureInfo.featureIndex;this.sortSubarray(h,g.min,g.max,j),this.sortSubarray(h,x.min,x.max,j);const T=re=>Ms(re,re),A=[{coord:new et(0,0),height:0},{coord:new et(0,0),height:0}],I=(re,ue)=>re<ue,R=yt(),B=yt(),V=yt(),K=yt(),Q=yt();for(let re=g.min;re<g.max;re++){if(!this.prepareEdgePoints(A,i,u,h[re],I))continue;const[ue,ce]=A,he=T(rs(Q,-(ce.coord.y-ue.coord.y),ce.coord.x-ue.coord.x,0));b=this.addFeatureSection(h[re].featureInfo.featureIndex,b,this.tunnelFeatureSections,t),t.addQuad(rs(R,ue.coord.x,ue.coord.y,ue.height),rs(B,ce.coord.x,ce.coord.y,ce.height),rs(V,ce.coord.x,ce.coord.y,h[re].isTunnel?-.1:0),rs(K,ue.coord.x,ue.coord.y,h[re].isTunnel?-.1:0),he)}for(let re=x.min;re<x.max;re++){const ue=h[re];ue.isTunnel&&([ue.a,ue.b]=[ue.b,ue.a]);const ce=i[ue.a],he=i[ue.b],Ee=T(rs(Q,-(he.y-ce.y),he.x-ce.x,0));b=this.addFeatureSection(ue.featureInfo.featureIndex,b,this.tunnelFeatureSections,t),t.addQuad(rs(R,he.x,he.y,0),rs(B,ce.x,ce.y,0),rs(V,ce.x,ce.y,u[ue.a]+4),rs(K,he.x,he.y,u[ue.b]+4),Ee),t.addQuad(rs(R,ce.x,ce.y,0),rs(B,he.x,he.y,0),rs(V,he.x,he.y,u[ue.b]+4),rs(K,ce.x,ce.y,u[ue.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,i,u,h){t.coord.x=i,t.coord.y=u,t.height=h}prepareEdgePoints(t,i,u,h,g){let x=i[h.a].x,b=i[h.a].y,j=i[h.b].x,T=i[h.b].y,A=u[h.a],I=u[h.b];const R=g(A,0),B=g(I,0);if(R&&B)return this.setElevatedPoint(t[0],x,b,A),this.setElevatedPoint(t[1],j,T,I),!0;if(!R&&!B)return!1;if(R){if(!B){const V=I/(I-A);j=fs(j,x,V),T=fs(T,b,V),I=fs(I,A,V)}}else{const V=A/(A-I);x=fs(x,j,V),b=fs(b,T,V),A=fs(A,I,V)}return this.setElevatedPoint(t[0],x,b,A),this.setElevatedPoint(t[1],j,T,I),!0}prepareEdges(t,i){if(i.length===0)return;i.sort((b,j)=>b.hash===j.hash?j.polygonIdx-b.polygonIdx:j.hash>b.hash?1:-1);let u=0,h=0,g=0,x=i[u].polygonIdx;do h++,(h===i.length||i[u].hash!==i[h].hash)&&((h-u==1||i[h-1].polygonIdx!==x)&&(g<u&&(i[g]=i[u],i[u]=null),i[g].type="none",g++),u=h,u!==i.length&&(x=i[u].polygonIdx));while(u!==i.length);if(i.splice(g),i.length!==0&&t.length!==0){i.sort((T,A)=>T.portalHash<A.portalHash?1:-1);let b=0,j=0;for(;b!==i.length&&j!==t.length;){const T=i[b],A=t[j];T.portalHash>A.hash?b++:A.hash>T.portalHash?j++:(T.type=A.type,b++)}}}isOnBorder(t,i){return t<=0&&i<=0||t>=Rt&&i>=Rt}addFeatureSection(t,i,u,h){return t!==i&&(i=t,u.push({featureIndex:t,vertexStart:h.getVertexCount()}),h.clearVertexLookup()),i}sortSubarray(t,i,u,h){const g=t.slice(i,u);g.sort(h),t.splice(i,g.length,...g)}static computeEdgeHash(t,i){return(t.y===i.y&&t.x>i.x||t.y>i.y)&&([t,i]=[i,t]),BigInt(ua.computePosHash(t))<<32n|BigInt(ua.computePosHash(i))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var zI,OI={exports:{}},FI=(zI||(zI=1,function(a,t){(function(i){function u(me,ge){return me>ge?1:me<ge?-1:0}var h=function(me,ge){me===void 0&&(me=u),ge===void 0&&(ge=!1),this._compare=me,this._root=null,this._size=0,this._noDuplicates=!!ge},g={size:{configurable:!0}};function x(me,ge,Ze,At,Ft){var zt=Ft-At;if(zt>0){var es=At+Math.floor(zt/2),js={key:ge[es],data:Ze[es],parent:me};return js.left=x(js,ge,Ze,At,es),js.right=x(js,ge,Ze,es+1,Ft),js}return null}function b(me,ge,Ze,At,Ft){if(!(Ze>=At)){for(var zt=me[Ze+At>>1],es=Ze-1,js=At+1;;){do es++;while(Ft(me[es],zt)<0);do js--;while(Ft(me[js],zt)>0);if(es>=js)break;var Qs=me[es];me[es]=me[js],me[js]=Qs,Qs=ge[es],ge[es]=ge[js],ge[js]=Qs}b(me,ge,Ze,js,Ft),b(me,ge,js+1,At,Ft)}}h.prototype.rotateLeft=function(me){var ge=me.right;ge&&(me.right=ge.left,ge.left&&(ge.left.parent=me),ge.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.left=me),me.parent=ge},h.prototype.rotateRight=function(me){var ge=me.left;ge&&(me.left=ge.right,ge.right&&(ge.right.parent=me),ge.parent=me.parent),me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.right=me),me.parent=ge},h.prototype._splay=function(me){for(;me.parent;){var ge=me.parent;ge.parent?ge.left===me&&ge.parent.left===ge?(this.rotateRight(ge.parent),this.rotateRight(ge)):ge.right===me&&ge.parent.right===ge?(this.rotateLeft(ge.parent),this.rotateLeft(ge)):ge.left===me&&ge.parent.right===ge?(this.rotateRight(ge),this.rotateLeft(ge)):(this.rotateLeft(ge),this.rotateRight(ge)):ge.left===me?this.rotateRight(ge):this.rotateLeft(ge)}},h.prototype.splay=function(me){for(var ge,Ze,At,Ft,zt;me.parent;)(Ze=(ge=me.parent).parent)&&Ze.parent?((At=Ze.parent).left===Ze?At.left=me:At.right=me,me.parent=At):(me.parent=null,this._root=me),Ft=me.left,zt=me.right,me===ge.left?(Ze&&(Ze.left===ge?(ge.right?(Ze.left=ge.right,Ze.left.parent=Ze):Ze.left=null,ge.right=Ze,Ze.parent=ge):(Ft?(Ze.right=Ft,Ft.parent=Ze):Ze.right=null,me.left=Ze,Ze.parent=me)),zt?(ge.left=zt,zt.parent=ge):ge.left=null,me.right=ge,ge.parent=me):(Ze&&(Ze.right===ge?(ge.left?(Ze.right=ge.left,Ze.right.parent=Ze):Ze.right=null,ge.left=Ze,Ze.parent=ge):(zt?(Ze.left=zt,zt.parent=Ze):Ze.left=null,me.right=Ze,Ze.parent=me)),Ft?(ge.right=Ft,Ft.parent=ge):ge.right=null,me.left=ge,ge.parent=me)},h.prototype.replace=function(me,ge){me.parent?me===me.parent.left?me.parent.left=ge:me.parent.right=ge:this._root=ge,ge&&(ge.parent=me.parent)},h.prototype.minNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.left;)me=me.left;return me},h.prototype.maxNode=function(me){if(me===void 0&&(me=this._root),me)for(;me.right;)me=me.right;return me},h.prototype.insert=function(me,ge){var Ze=this._root,At=null,Ft=this._compare;if(this._noDuplicates)for(;Ze;){if(At=Ze,Ft(Ze.key,me)===0)return;Ze=Ft(Ze.key,me)<0?Ze.right:Ze.left}else for(;Ze;)At=Ze,Ze=Ft(Ze.key,me)<0?Ze.right:Ze.left;return Ze={key:me,data:ge,left:null,right:null,parent:At},At?Ft(At.key,Ze.key)<0?At.right=Ze:At.left=Ze:this._root=Ze,this.splay(Ze),this._size++,Ze},h.prototype.find=function(me){for(var ge=this._root,Ze=this._compare;ge;){var At=Ze(ge.key,me);if(At<0)ge=ge.right;else{if(!(At>0))return ge;ge=ge.left}}return null},h.prototype.contains=function(me){for(var ge=this._root,Ze=this._compare;ge;){var At=Ze(me,ge.key);if(At===0)return!0;ge=At<0?ge.left:ge.right}return!1},h.prototype.remove=function(me){var ge=this.find(me);if(!ge)return!1;if(this.splay(ge),ge.left)if(ge.right){var Ze=this.minNode(ge.right);Ze.parent!==ge&&(this.replace(Ze,Ze.right),Ze.right=ge.right,Ze.right.parent=Ze),this.replace(ge,Ze),Ze.left=ge.left,Ze.left.parent=Ze}else this.replace(ge,ge.left);else this.replace(ge,ge.right);return this._size--,!0},h.prototype.removeNode=function(me){if(!me)return!1;if(this.splay(me),me.left)if(me.right){var ge=this.minNode(me.right);ge.parent!==me&&(this.replace(ge,ge.right),ge.right=me.right,ge.right.parent=ge),this.replace(me,ge),ge.left=me.left,ge.left.parent=ge}else this.replace(me,me.left);else this.replace(me,me.right);return this._size--,!0},h.prototype.erase=function(me){var ge=this.find(me);if(ge){this.splay(ge);var Ze=ge.left,At=ge.right,Ft=null;Ze&&(Ze.parent=null,Ft=this.maxNode(Ze),this.splay(Ft),this._root=Ft),At&&(Ze?Ft.right=At:this._root=At,At.parent=Ft),this._size--}},h.prototype.pop=function(){var me=this._root,ge=null;if(me){for(;me.left;)me=me.left;ge={key:me.key,data:me.data},this.remove(me.key)}return ge},h.prototype.next=function(me){var ge=me;if(ge)if(ge.right)for(ge=ge.right;ge&&ge.left;)ge=ge.left;else for(ge=me.parent;ge&&ge.right===me;)me=ge,ge=ge.parent;return ge},h.prototype.prev=function(me){var ge=me;if(ge)if(ge.left)for(ge=ge.left;ge&&ge.right;)ge=ge.right;else for(ge=me.parent;ge&&ge.left===me;)me=ge,ge=ge.parent;return ge},h.prototype.forEach=function(me){for(var ge=this._root,Ze=[],At=!1,Ft=0;!At;)ge?(Ze.push(ge),ge=ge.left):Ze.length>0?(me(ge=Ze.pop(),Ft++),ge=ge.right):At=!0;return this},h.prototype.range=function(me,ge,Ze,At){for(var Ft=[],zt=this._compare,es=this._root;Ft.length!==0||es;)if(es)Ft.push(es),es=es.left;else{if(zt((es=Ft.pop()).key,ge)>0)break;if(zt(es.key,me)>=0&&Ze.call(At,es))return this;es=es.right}return this},h.prototype.keys=function(){for(var me=this._root,ge=[],Ze=[],At=!1;!At;)me?(ge.push(me),me=me.left):ge.length>0?(me=ge.pop(),Ze.push(me.key),me=me.right):At=!0;return Ze},h.prototype.values=function(){for(var me=this._root,ge=[],Ze=[],At=!1;!At;)me?(ge.push(me),me=me.left):ge.length>0?(me=ge.pop(),Ze.push(me.data),me=me.right):At=!0;return Ze},h.prototype.at=function(me){for(var ge=this._root,Ze=[],At=!1,Ft=0;!At;)if(ge)Ze.push(ge),ge=ge.left;else if(Ze.length>0){if(ge=Ze.pop(),Ft===me)return ge;Ft++,ge=ge.right}else At=!0;return null},h.prototype.load=function(me,ge,Ze){if(me===void 0&&(me=[]),ge===void 0&&(ge=[]),Ze===void 0&&(Ze=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var At=me.length;return Ze&&b(me,ge,0,At-1,this._compare),this._root=x(null,me,ge,0,At),this._size=At,this},h.prototype.min=function(){var me=this.minNode(this._root);return me?me.key:null},h.prototype.max=function(){var me=this.maxNode(this._root);return me?me.key:null},h.prototype.isEmpty=function(){return this._root===null},g.size.get=function(){return this._size},h.createTree=function(me,ge,Ze,At,Ft){return new h(Ze,Ft).load(me,ge,At)},Object.defineProperties(h.prototype,g);var j=0,T=1,A=2,I=3,R=0,B=1,V=2,K=3;function Q(me,ge,Ze){ge===null?(me.inOut=!1,me.otherInOut=!0):(me.isSubject===ge.isSubject?(me.inOut=!ge.inOut,me.otherInOut=ge.otherInOut):(me.inOut=!ge.otherInOut,me.otherInOut=ge.isVertical()?!ge.inOut:ge.inOut),ge&&(me.prevInResult=!re(ge,Ze)||ge.isVertical()?ge.prevInResult:ge));var At=re(me,Ze);me.resultTransition=At?function(Ft,zt){var es,js=!Ft.inOut,Qs=!Ft.otherInOut;switch(zt){case R:es=js&&Qs;break;case B:es=js||Qs;break;case K:es=js^Qs;break;case V:es=Ft.isSubject?js&&!Qs:Qs&&!js}return es?1:-1}(me,Ze):0}function re(me,ge){switch(me.type){case j:switch(ge){case R:return!me.otherInOut;case B:return me.otherInOut;case V:return me.isSubject&&me.otherInOut||!me.isSubject&&!me.otherInOut;case K:return!0}break;case A:return ge===R||ge===B;case I:return ge===V;case T:return!1}return!1}var ue=function(me,ge,Ze,At,Ft){this.left=ge,this.point=me,this.otherEvent=Ze,this.isSubject=At,this.type=Ft||j,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},ce={inResult:{configurable:!0}};function he(me,ge){return me[0]===ge[0]&&me[1]===ge[1]}ue.prototype.isBelow=function(me){var ge=this.point,Ze=this.otherEvent.point;return this.left?(ge[0]-me[0])*(Ze[1]-me[1])-(Ze[0]-me[0])*(ge[1]-me[1])>0:(Ze[0]-me[0])*(ge[1]-me[1])-(ge[0]-me[0])*(Ze[1]-me[1])>0},ue.prototype.isAbove=function(me){return!this.isBelow(me)},ue.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},ce.inResult.get=function(){return this.resultTransition!==0},ue.prototype.clone=function(){var me=new ue(this.point,this.left,this.otherEvent,this.isSubject,this.type);return me.contourId=this.contourId,me.resultTransition=this.resultTransition,me.prevInResult=this.prevInResult,me.isExteriorRing=this.isExteriorRing,me.inOut=this.inOut,me.otherInOut=this.otherInOut,me},Object.defineProperties(ue.prototype,ce);var Ee=11102230246251565e-32,we=134217729,je=(3+8*Ee)*Ee;function Me(me,ge,Ze,At,Ft){var zt,es,js,Qs,en=ge[0],Bs=At[0],Rn=0,br=0;Bs>en==Bs>-en?(zt=en,en=ge[++Rn]):(zt=Bs,Bs=At[++br]);var Os=0;if(Rn<me&&br<Ze)for(Bs>en==Bs>-en?(js=zt-((es=en+zt)-en),en=ge[++Rn]):(js=zt-((es=Bs+zt)-Bs),Bs=At[++br]),zt=es,js!==0&&(Ft[Os++]=js);Rn<me&&br<Ze;)Bs>en==Bs>-en?(js=zt-((es=zt+en)-(Qs=es-zt))+(en-Qs),en=ge[++Rn]):(js=zt-((es=zt+Bs)-(Qs=es-zt))+(Bs-Qs),Bs=At[++br]),zt=es,js!==0&&(Ft[Os++]=js);for(;Rn<me;)js=zt-((es=zt+en)-(Qs=es-zt))+(en-Qs),en=ge[++Rn],zt=es,js!==0&&(Ft[Os++]=js);for(;br<Ze;)js=zt-((es=zt+Bs)-(Qs=es-zt))+(Bs-Qs),Bs=At[++br],zt=es,js!==0&&(Ft[Os++]=js);return zt===0&&Os!==0||(Ft[Os++]=zt),Os}function ke(me){return new Float64Array(me)}var Qe=33306690738754716e-32,Fe=22204460492503146e-32,st=11093356479670487e-47,Tt=ke(4),lt=ke(8),gt=ke(12),St=ke(16),Ye=ke(4);function _t(me,ge,Ze){var At=function(Ft,zt,es,js,Qs,en){var Bs=(zt-en)*(es-Qs),Rn=(Ft-Qs)*(js-en),br=Bs-Rn;if(Bs===0||Rn===0||Bs>0!=Rn>0)return br;var Os=Math.abs(Bs+Rn);return Math.abs(br)>=Qe*Os?br:-function(ar,Yn,An,xr,rr,Jn,tr){var In,Vs,kn,yr,_s,un,ir,jr,lr,qr,On,Ur,Fo,Gi,Mi,Bo,Vc,Zr,ni=ar-rr,Hi=An-rr,xo=Yn-Jn,so=xr-Jn;Tt[0]=(Mi=(jr=ni-(ir=(un=we*ni)-(un-ni)))*(qr=so-(lr=(un=we*so)-(un-so)))-((Gi=ni*so)-ir*lr-jr*lr-ir*qr))-((On=Mi-(Vc=(jr=xo-(ir=(un=we*xo)-(un-xo)))*(qr=Hi-(lr=(un=we*Hi)-(un-Hi)))-((Bo=xo*Hi)-ir*lr-jr*lr-ir*qr)))+(_s=Mi-On))+(_s-Vc),Tt[1]=(Fo=Gi-((Ur=Gi+On)-(_s=Ur-Gi))+(On-_s))-((On=Fo-Bo)+(_s=Fo-On))+(_s-Bo),Tt[2]=Ur-((Zr=Ur+On)-(_s=Zr-Ur))+(On-_s),Tt[3]=Zr;var Jd=function(kde,Yk){for(var Jk=Yk[0],yT=1;yT<4;yT++)Jk+=Yk[yT];return Jk}(0,Tt),A_=Fe*tr;if(Jd>=A_||-Jd>=A_||(In=ar-(ni+(_s=ar-ni))+(_s-rr),kn=An-(Hi+(_s=An-Hi))+(_s-rr),Vs=Yn-(xo+(_s=Yn-xo))+(_s-Jn),yr=xr-(so+(_s=xr-so))+(_s-Jn),In===0&&Vs===0&&kn===0&&yr===0)||(A_=st*tr+je*Math.abs(Jd),(Jd+=ni*yr+so*In-(xo*kn+Hi*Vs))>=A_||-Jd>=A_))return Jd;Ye[0]=(Mi=(jr=In-(ir=(un=we*In)-(un-In)))*(qr=so-(lr=(un=we*so)-(un-so)))-((Gi=In*so)-ir*lr-jr*lr-ir*qr))-((On=Mi-(Vc=(jr=Vs-(ir=(un=we*Vs)-(un-Vs)))*(qr=Hi-(lr=(un=we*Hi)-(un-Hi)))-((Bo=Vs*Hi)-ir*lr-jr*lr-ir*qr)))+(_s=Mi-On))+(_s-Vc),Ye[1]=(Fo=Gi-((Ur=Gi+On)-(_s=Ur-Gi))+(On-_s))-((On=Fo-Bo)+(_s=Fo-On))+(_s-Bo),Ye[2]=Ur-((Zr=Ur+On)-(_s=Zr-Ur))+(On-_s),Ye[3]=Zr;var g9=Me(4,Tt,4,Ye,lt);Ye[0]=(Mi=(jr=ni-(ir=(un=we*ni)-(un-ni)))*(qr=yr-(lr=(un=we*yr)-(un-yr)))-((Gi=ni*yr)-ir*lr-jr*lr-ir*qr))-((On=Mi-(Vc=(jr=xo-(ir=(un=we*xo)-(un-xo)))*(qr=kn-(lr=(un=we*kn)-(un-kn)))-((Bo=xo*kn)-ir*lr-jr*lr-ir*qr)))+(_s=Mi-On))+(_s-Vc),Ye[1]=(Fo=Gi-((Ur=Gi+On)-(_s=Ur-Gi))+(On-_s))-((On=Fo-Bo)+(_s=Fo-On))+(_s-Bo),Ye[2]=Ur-((Zr=Ur+On)-(_s=Zr-Ur))+(On-_s),Ye[3]=Zr;var x9=Me(g9,lt,4,Ye,gt);Ye[0]=(Mi=(jr=In-(ir=(un=we*In)-(un-In)))*(qr=yr-(lr=(un=we*yr)-(un-yr)))-((Gi=In*yr)-ir*lr-jr*lr-ir*qr))-((On=Mi-(Vc=(jr=Vs-(ir=(un=we*Vs)-(un-Vs)))*(qr=kn-(lr=(un=we*kn)-(un-kn)))-((Bo=Vs*kn)-ir*lr-jr*lr-ir*qr)))+(_s=Mi-On))+(_s-Vc),Ye[1]=(Fo=Gi-((Ur=Gi+On)-(_s=Ur-Gi))+(On-_s))-((On=Fo-Bo)+(_s=Fo-On))+(_s-Bo),Ye[2]=Ur-((Zr=Ur+On)-(_s=Zr-Ur))+(On-_s),Ye[3]=Zr;var y9=Me(x9,gt,4,Ye,St);return St[y9-1]}(Ft,zt,es,js,Qs,en,Os)}(me[0],me[1],ge[0],ge[1],Ze[0],Ze[1]);return At>0?-1:At<0?1:0}function Ve(me,ge){var Ze=me.point,At=ge.point;return Ze[0]>At[0]?1:Ze[0]<At[0]?-1:Ze[1]!==At[1]?Ze[1]>At[1]?1:-1:function(Ft,zt,es,js){return Ft.left!==zt.left?Ft.left?1:-1:_t(es,Ft.otherEvent.point,zt.otherEvent.point)!==0?Ft.isBelow(zt.otherEvent.point)?-1:1:!Ft.isSubject&&zt.isSubject?1:-1}(me,ge,Ze)}function Je(me,ge,Ze){var At=new ue(ge,!1,me,me.isSubject),Ft=new ue(ge,!0,me.otherEvent,me.isSubject);return he(me.point,me.otherEvent.point)&&console.warn("what is that, a collapsed segment?",me),At.contourId=Ft.contourId=me.contourId,Ve(Ft,me.otherEvent)>0&&(me.otherEvent.left=!0,Ft.left=!1),me.otherEvent.otherEvent=Ft,me.otherEvent=At,Ze.push(Ft),Ze.push(At),Ze}function Ct(me,ge){return me[0]*ge[1]-me[1]*ge[0]}function vt(me,ge){return me[0]*ge[0]+me[1]*ge[1]}function os(me,ge,Ze){var At=function(Qs,en,Bs,Rn,br){var Os=[en[0]-Qs[0],en[1]-Qs[1]],ar=[Rn[0]-Bs[0],Rn[1]-Bs[1]];function Yn(un,ir,jr){return[un[0]+ir*jr[0],un[1]+ir*jr[1]]}var An=[Bs[0]-Qs[0],Bs[1]-Qs[1]],xr=Ct(Os,ar),rr=xr*xr,Jn=vt(Os,Os);if(rr>0){var tr=Ct(An,ar)/xr;if(tr<0||tr>1)return null;var In=Ct(An,Os)/xr;return In<0||In>1?null:tr===0||tr===1?[Yn(Qs,tr,Os)]:In===0||In===1?[Yn(Bs,In,ar)]:[Yn(Qs,tr,Os)]}if((rr=(xr=Ct(An,Os))*xr)>0)return null;var Vs=vt(Os,An)/Jn,kn=Vs+vt(Os,ar)/Jn,yr=Math.min(Vs,kn),_s=Math.max(Vs,kn);return yr<=1&&_s>=0?yr===1?[Yn(Qs,yr>0?yr:0,Os)]:_s===0?[Yn(Qs,_s<1?_s:1,Os)]:[Yn(Qs,yr>0?yr:0,Os),Yn(Qs,_s<1?_s:1,Os)]:null}(me.point,me.otherEvent.point,ge.point,ge.otherEvent.point),Ft=At?At.length:0;if(Ft===0||Ft===1&&(he(me.point,ge.point)||he(me.otherEvent.point,ge.otherEvent.point))||Ft===2&&me.isSubject===ge.isSubject)return 0;if(Ft===1)return he(me.point,At[0])||he(me.otherEvent.point,At[0])||Je(me,At[0],Ze),he(ge.point,At[0])||he(ge.otherEvent.point,At[0])||Je(ge,At[0],Ze),1;var zt=[],es=!1,js=!1;return he(me.point,ge.point)?es=!0:Ve(me,ge)===1?zt.push(ge,me):zt.push(me,ge),he(me.otherEvent.point,ge.otherEvent.point)?js=!0:Ve(me.otherEvent,ge.otherEvent)===1?zt.push(ge.otherEvent,me.otherEvent):zt.push(me.otherEvent,ge.otherEvent),es&&js||es?(ge.type=T,me.type=ge.inOut===me.inOut?A:I,es&&!js&&Je(zt[1].otherEvent,zt[0].point,Ze),2):js?(Je(zt[0],zt[1].point,Ze),3):zt[0]!==zt[3].otherEvent?(Je(zt[0],zt[1].point,Ze),Je(zt[1],zt[2].point,Ze),3):(Je(zt[0],zt[1].point,Ze),Je(zt[3].otherEvent,zt[2].point,Ze),3)}function Jt(me,ge){if(me===ge)return 0;if(_t(me.point,me.otherEvent.point,ge.point)!==0||_t(me.point,me.otherEvent.point,ge.otherEvent.point)!==0)return he(me.point,ge.point)?me.isBelow(ge.otherEvent.point)?-1:1:me.point[0]===ge.point[0]?me.point[1]<ge.point[1]?-1:1:Ve(me,ge)===1?ge.isAbove(me.point)?-1:1:me.isBelow(ge.point)?-1:1;if(me.isSubject!==ge.isSubject)return me.isSubject?-1:1;var Ze=me.point,At=ge.point;return Ze[0]===At[0]&&Ze[1]===At[1]?(Ze=me.otherEvent.point)[0]===(At=ge.otherEvent.point)[0]&&Ze[1]===At[1]?0:me.contourId>ge.contourId?1:-1:Ve(me,ge)===1?1:-1}var ft=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function bt(me,ge,Ze,At){var Ft,zt=me+1,es=ge[me].point,js=ge.length;for(zt<js&&(Ft=ge[zt].point);zt<js&&Ft[0]===es[0]&&Ft[1]===es[1];){if(!Ze[zt])return zt;++zt<js&&(Ft=ge[zt].point)}for(zt=me-1;Ze[zt]&&zt>At;)zt--;return zt}ft.prototype.isExterior=function(){return this.holeOf==null};var ts=kt,qt=kt;function kt(me,ge){if(!(this instanceof kt))return new kt(me,ge);if(this.data=me||[],this.length=this.data.length,this.compare=ge||Zt,this.length>0)for(var Ze=(this.length>>1)-1;Ze>=0;Ze--)this._down(Ze)}function Zt(me,ge){return me<ge?-1:me>ge?1:0}kt.prototype={push:function(me){this.data.push(me),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var me=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),me}},peek:function(){return this.data[0]},_up:function(me){for(var ge=this.data,Ze=this.compare,At=ge[me];me>0;){var Ft=me-1>>1,zt=ge[Ft];if(Ze(At,zt)>=0)break;ge[me]=zt,me=Ft}ge[me]=At},_down:function(me){for(var ge=this.data,Ze=this.compare,At=this.length>>1,Ft=ge[me];me<At;){var zt=1+(me<<1),es=zt+1,js=ge[zt];if(es<this.length&&Ze(ge[es],js)<0&&(zt=es,js=ge[es]),Ze(js,Ft)>=0)break;ge[me]=js,me=zt}ge[me]=Ft}},ts.default=qt;var xs=Math.max,As=Math.min,zs=0;function ks(me,ge,Ze,At,Ft,zt){var es,js,Qs,en,Bs,Rn;for(es=0,js=me.length-1;es<js;es++)if(en=me[es+1],Bs=new ue(Qs=me[es],!1,void 0,ge),Rn=new ue(en,!1,Bs,ge),Bs.otherEvent=Rn,Qs[0]!==en[0]||Qs[1]!==en[1]){Bs.contourId=Rn.contourId=Ze,zt||(Bs.isExteriorRing=!1,Rn.isExteriorRing=!1),Ve(Bs,Rn)>0?Rn.left=!0:Bs.left=!0;var br=Qs[0],Os=Qs[1];Ft[0]=As(Ft[0],br),Ft[1]=As(Ft[1],Os),Ft[2]=xs(Ft[2],br),Ft[3]=xs(Ft[3],Os),At.push(Bs),At.push(Rn)}}var on=[];function Gs(me,ge,Ze){typeof me[0][0][0]=="number"&&(me=[me]),typeof ge[0][0][0]=="number"&&(ge=[ge]);var At=function(Os,ar,Yn){var An=null;return Os.length*ar.length==0&&(Yn===R?An=on:Yn===V?An=Os:Yn!==B&&Yn!==K||(An=Os.length===0?ar:Os)),An}(me,ge,Ze);if(At)return At===on?null:At;var Ft=[1/0,1/0,-1/0,-1/0],zt=[1/0,1/0,-1/0,-1/0],es=function(Os,ar,Yn,An,xr){var rr,Jn,tr,In,Vs,kn,yr=new ts(null,Ve);for(tr=0,In=Os.length;tr<In;tr++)for(Vs=0,kn=(rr=Os[tr]).length;Vs<kn;Vs++)(Jn=Vs===0)&&zs++,ks(rr[Vs],!0,zs,yr,Yn,Jn);for(tr=0,In=ar.length;tr<In;tr++)for(Vs=0,kn=(rr=ar[tr]).length;Vs<kn;Vs++)Jn=Vs===0,xr===V&&(Jn=!1),Jn&&zs++,ks(rr[Vs],!1,zs,yr,An,Jn);return yr}(me,ge,Ft,zt,Ze);if(At=function(Os,ar,Yn,An,xr){var rr=null;return(Yn[0]>An[2]||An[0]>Yn[2]||Yn[1]>An[3]||An[1]>Yn[3])&&(xr===R?rr=on:xr===V?rr=Os:xr!==B&&xr!==K||(rr=Os.concat(ar))),rr}(me,ge,Ft,zt,Ze))return At===on?null:At;for(var js=function(Os){var ar,Yn,An=function(tr){var In,Vs,kn,yr,_s=[];for(Vs=0,kn=tr.length;Vs<kn;Vs++)((In=tr[Vs]).left&&In.inResult||!In.left&&In.otherEvent.inResult)&&_s.push(In);for(var un=!1;!un;)for(un=!0,Vs=0,kn=_s.length;Vs<kn;Vs++)Vs+1<kn&&Ve(_s[Vs],_s[Vs+1])===1&&(yr=_s[Vs],_s[Vs]=_s[Vs+1],_s[Vs+1]=yr,un=!1);for(Vs=0,kn=_s.length;Vs<kn;Vs++)(In=_s[Vs]).otherPos=Vs;for(Vs=0,kn=_s.length;Vs<kn;Vs++)(In=_s[Vs]).left||(yr=In.otherPos,In.otherPos=In.otherEvent.otherPos,In.otherEvent.otherPos=yr);return _s}(Os),xr={},rr=[],Jn=function(){if(!xr[ar]){var tr=rr.length,In=function(_s,un,ir){var jr=new ft;if(_s.prevInResult!=null){var lr=_s.prevInResult,qr=lr.outputContourId;if(lr.resultTransition>0){var On=un[qr];if(On.holeOf!=null){var Ur=On.holeOf;un[Ur].holeIds.push(ir),jr.holeOf=Ur,jr.depth=un[qr].depth}else un[qr].holeIds.push(ir),jr.holeOf=qr,jr.depth=un[qr].depth+1}else jr.holeOf=null,jr.depth=un[qr].depth}else jr.holeOf=null,jr.depth=0;return jr}(An[ar],rr,tr),Vs=function(_s){xr[_s]=!0,_s<An.length&&An[_s]&&(An[_s].outputContourId=tr)},kn=ar,yr=ar;for(In.points.push(An[ar].point);Vs(kn),Vs(kn=An[kn].otherPos),In.points.push(An[kn].point),!((kn=bt(kn,An,xr,yr))==yr||kn>=An.length)&&An[kn];);rr.push(In)}};for(ar=0,Yn=An.length;ar<Yn;ar++)Jn();return rr}(function(Os,ar,Yn,An,xr,rr){for(var Jn,tr,In,Vs=new h(Jt),kn=[],yr=Math.min(An[2],xr[2]);Os.length!==0;){var _s=Os.pop();if(kn.push(_s),rr===R&&_s.point[0]>yr||rr===V&&_s.point[0]>An[2])break;if(_s.left){tr=Jn=Vs.insert(_s),Jn=Jn!==(In=Vs.minNode())?Vs.prev(Jn):null,tr=Vs.next(tr);var un=Jn?Jn.key:null;if(Q(_s,un,rr),tr&&os(_s,tr.key,Os)===2&&(Q(_s,un,rr),Q(tr.key,_s,rr)),Jn&&os(Jn.key,_s,Os)===2){var ir=Jn;Q(un,(ir=ir!==In?Vs.prev(ir):null)?ir.key:null,rr),Q(_s,un,rr)}}else tr=Jn=Vs.find(_s=_s.otherEvent),Jn&&tr&&(Jn=Jn!==In?Vs.prev(Jn):null,tr=Vs.next(tr),Vs.remove(_s),tr&&Jn&&os(Jn.key,tr.key,Os))}return kn}(es,0,0,Ft,zt,Ze)),Qs=[],en=0;en<js.length;en++){var Bs=js[en];if(Bs.isExterior()){for(var Rn=[Bs.points],br=0;br<Bs.holeIds.length;br++)Rn.push(js[Bs.holeIds[br]].points);Qs.push(Rn)}}return Qs}var nr={UNION:B,DIFFERENCE:V,INTERSECTION:R,XOR:K};i.diff=function(me,ge){return Gs(me,ge,V)},i.intersection=function(me,ge){return Gs(me,ge,R)},i.operations=nr,i.union=function(me,ge){return Gs(me,ge,B)},i.xor=function(me,ge){return Gs(me,ge,K)},Object.defineProperty(i,"__esModule",{value:!0})})(t)}(0,OI.exports)),OI.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function I1(a,t,i,u){const h=[],g=u===0?(x,b,j,T,A,I)=>{x.push(new et(I,j+(I-b)/(T-b)*(A-j)))}:(x,b,j,T,A,I)=>{x.push(new et(b+(I-j)/(A-j)*(T-b),I))};for(const x of a){const b=[];for(const j of x){if(j.length<=2)continue;const T=[];for(let R=0;R<j.length-1;R++){const B=j[R].x,V=j[R].y,K=j[R+1].x,Q=j[R+1].y,re=u===0?B:V,ue=u===0?K:Q;re<t?ue>t&&g(T,B,V,K,Q,t):re>i?ue<i&&g(T,B,V,K,Q,i):T.push(j[R]),ue<t&&re>=t&&g(T,B,V,K,Q,t),ue>i&&re<=i&&g(T,B,V,K,Q,i)}let A=j[j.length-1];const I=u===0?A.x:A.y;I>=t&&I<=i&&T.push(A),T.length&&(A=T[T.length-1],T[0].x===A.x&&T[0].y===A.y||T.push(T[0]),b.push(T))}b.length&&h.push(b)}return h}function xG(a,t){const i=fj(a),u=fj([t]),h=FI.intersection(i,u);return h==null?[]:BI(h)}function yG(a,t){let u=fj(a,65536);for(;t.valid();t.next()){const[h,g]=t.get(),x=h.x*65536,b=h.y*65536,j=g.x*65536,T=g.y*65536,A=j-x,I=T-b,R=Math.hypot(A,I),B=Math.trunc(I/R*3),V=-Math.trunc(A/R*3);u=FI.diff(u,[[[x,b],[j,T],[j+B,T+V],[x+B,b+V],[x,b]]])}return BI(u,1/65536)}function fj(a,t=1){return[a.map(i=>i.map(u=>[u.x*t,u.y*t]))]}function BI(a,t=1){return a.map(i=>i.map((u,h)=>{const g=u.map(x=>new et(x[0]*t,x[1]*t).round());return h>0&&g.reverse(),g}))}class mj{constructor(t,i){this.layoutVertexArray=new Po,this.indexArray=new ur,this.lineIndexArray=new gl,this.triangleSegments=new mr,this.lineSegments=new mr,this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,i&&(this.elevatedLayoutVertexArray=new Au)}update(t,i,u,h,g,x,b,j){this.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,j)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,sG.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,nG.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,i,u,h,g,x,b){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,i,u,h,g,x,void 0,b)}}class gj{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new mj(t,!1),this.elevationBufferData=new mj(t,!0),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview}updateFootprints(t,i){}populate(t,i,u,h){this.hasPattern=hj("fill",this.layers,this.pixelRatio,i);const g=this.layers[0].layout.get("fill-sort-key"),x=[];for(const{feature:b,id:j,index:T,sourceLayerIndex:A}of t){const I=this.layers[0]._featureFilter.needGeometry,R=Ke(b,I);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),R,u))continue;const B=g?g.evaluate(R,{},u,i.availableImages):void 0,V={id:j,properties:b.properties,type:b.type,sourceLayerIndex:A,index:T,geometry:I?R.geometry:Ae(b,u,h),patterns:{},sortKey:B};x.push(V)}g&&x.sort((b,j)=>b.sortKey-j.sortKey);for(const b of x){const{geometry:j,index:T,sourceLayerIndex:A}=b;if(this.hasPattern){const I=pj("fill",this.layers,b,this.zoom,this.pixelRatio,i);this.patternFeatures.push(I)}else this.addFeature(b,j,T,u,{},i.availableImages,i.brightness,i.elevationFeatures);i.featureIndex.insert(t[T].feature,j,T,A,this.index)}}update(t,i,u,h,g,x,b){this.bufferData.update(t,i,u,h,g,x,b,this.worldview),this.elevationBufferData.update(t,i,u,h,g,x,b,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,i,u,h,g,x,b,this.worldview)}addFeatures(t,i,u,h,g,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,i,u,h,x,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,i,u,h,g,x=[],b,j){const T=Jy(i,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,T,h,u,j):this.addGeometry(T,this.bufferData),this.bufferData.populatePaintArrays(t,u,g,x,h,b,this.worldview),this.elevationBufferData.populatePaintArrays(t,u,g,x,h,b,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,i,u,h,g){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(i,u,h,g,this.worldview))}addElevatedRoadFeature(t,i,u,h,g){const x=new Array,b=gr.getElevationFeature(t,g);if(!b)return void this.addGeometry(i,this.bufferData);{const T=this.clipPolygonsToTile(i,1);T.length>0&&x.push({polygons:T,elevationFeature:b,elevationTileID:u})}const j={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},u),featureIndex:h};for(const T of x)if(T.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new ua(T.elevationTileID,this.layers,this.zoom,this.lut));const I=T.elevationFeature.isTunnel();let R=0;t.properties.hasOwnProperty(as)&&(R=+t.properties[as]);for(const B of T.polygons)this.elevatedStructures.addPortalCandidates(T.elevationFeature.id,B,I,T.elevationFeature,R)}T.elevationFeature.constantHeight==null&&(T.polygons=this.prepareElevatedPolygons(T.polygons,T.elevationFeature,T.elevationTileID));const A=new dn(u,T.elevationTileID);this.addElevatedGeometry(T.polygons,A,T.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,h,j)}}addElevatedGeometry(t,i,u,h,g,x){const b={elevation:u,elevationSampler:i,bias:h,index:g,featureInfo:x},[j,T]=this.addGeometry(t,this.elevationBufferData,b);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:j,max:T}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,j),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,T))}addGeometry(t,i,u){let h=Number.POSITIVE_INFINITY,g=Number.NEGATIVE_INFINITY,x=null;u&&(x=u.elevationSampler.constantElevation(u.elevation,u.bias),x!=null&&(h=x,g=x));const b=(j,T,A)=>{if(u!=null)if(T.push(j),x!=null)i.elevatedLayoutVertexArray.emplaceBack(x),A.push(x);else{const I=u.elevationSampler.pointElevation(j,u.elevation,u.bias);i.elevatedLayoutVertexArray.emplaceBack(I),A.push(I),h=Math.min(h,I),g=Math.max(g,I)}};for(const j of t){let T=0;for(const ce of j)T+=ce.length;const A=i.triangleSegments.prepareSegment(T,i.layoutVertexArray,i.indexArray),I=A.vertexLength,R=[],B=[],V=[],K=[],Q=[],re=i.layoutVertexArray.length;for(const ce of j){if(ce.length===0)continue;ce!==j[0]&&B.push(R.length/2);const he=i.lineSegments.prepareSegment(ce.length,i.layoutVertexArray,i.lineIndexArray),Ee=he.vertexLength;u&&Q.push(i.layoutVertexArray.length-re),b(ce[0],V,K),i.layoutVertexArray.emplaceBack(ce[0].x,ce[0].y),i.lineIndexArray.emplaceBack(Ee+ce.length-1,Ee),R.push(ce[0].x),R.push(ce[0].y);for(let we=1;we<ce.length;we++)b(ce[we],V,K),i.layoutVertexArray.emplaceBack(ce[we].x,ce[we].y),i.lineIndexArray.emplaceBack(Ee+we-1,Ee+we),R.push(ce[we].x),R.push(ce[we].y);he.vertexLength+=ce.length,he.primitiveLength+=ce.length}const ue=Fm(R,B);for(let ce=0;ce<ue.length;ce+=3)i.indexArray.emplaceBack(I+ue[ce],I+ue[ce+1],I+ue[ce+2]);if(ue.length>0&&u&&this.elevationMode==="hd-road-base"){const ce=u.elevation.isTunnel(),he=u.elevation.safeArea,Ee=this.elevatedStructures.addVertices(V,K);this.elevatedStructures.addTriangles(ue,Ee,ce);const we=Q.length;if(we>0){for(let je=0;je<we-1;je++)this.elevatedStructures.addRenderableRing(u.index,Q[je]+Ee,Q[je+1]-Q[je],ce,he,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,Q[we-1]+Ee,V.length-Q[we-1],ce,he,u.featureInfo)}}A.vertexLength+=T,A.primitiveLength+=ue.length/3}return[h,g]}prepareElevatedPolygons(t,i,u){const h=1/ve(u),g=[];for(const x of t){const b=yG(x,new Pn(i,h));g.push(...b)}return g}clipPolygonsToTile(t,i){const u=-i,h=-i,g=Rt+i,x=Rt+i;let b=0;const j=[],T=[];for(;b<t.length;b++){const R=t[b],B=Bx(R);(B.min.x>=u&&B.max.x<=g&&B.min.y>=h&&B.max.y<=x?j:T).push(R)}if(j.length===t.length)return t;const A=[new et(u,h),new et(g,h),new et(g,x),new et(u,x),new et(u,h)],I=j;for(const R of T)I.push(...xG(R,A));return I}}let VI,UI,$I,GI;Yt(gj,"FillBucket",{omit:["layers","patternFeatures"]}),Yt(mj,"FillBufferData"),Yt(ua,"ElevatedStructures");class M1{constructor(t,i,u,h){if(this.triangleCount=i.length/3,this.min=new et(0,0),this.max=new et(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[g,x]=[t[0].clone(),t[0].clone()];for(let I=1;I<t.length;++I){const R=t[I];g.x=Math.min(g.x,R.x),g.y=Math.min(g.y,R.y),x.x=Math.max(x.x,R.x),x.y=Math.max(x.y,R.y)}if(h){const I=Math.ceil(Math.max(x.x-g.x,x.y-g.y)/h);u=Math.max(u,I)}if(u===0)return;this.min=g,this.max=x;const b=this.max.sub(this.min);b.x=Math.max(b.x,1),b.y=Math.max(b.y,1);const j=Math.max(b.x,b.y)/u;this.cellsX=Math.max(1,Math.ceil(b.x/j)),this.cellsY=Math.max(1,Math.ceil(b.y/j)),this.xScale=1/j,this.yScale=1/j;const T=[];for(let I=0;I<this.triangleCount;I++){const R=t[i[3*I+0]].sub(this.min),B=t[i[3*I+1]].sub(this.min),V=t[i[3*I+2]].sub(this.min),K=Fc(Math.floor(Math.min(R.x,B.x,V.x)),this.xScale,this.cellsX),Q=Fc(Math.floor(Math.max(R.x,B.x,V.x)),this.xScale,this.cellsX),re=Fc(Math.floor(Math.min(R.y,B.y,V.y)),this.yScale,this.cellsY),ue=Fc(Math.floor(Math.max(R.y,B.y,V.y)),this.yScale,this.cellsY),ce=new et(0,0),he=new et(0,0),Ee=new et(0,0),we=new et(0,0);for(let je=re;je<=ue;++je){ce.y=he.y=je*j,Ee.y=we.y=(je+1)*j;for(let Me=K;Me<=Q;++Me)ce.x=Ee.x=Me*j,he.x=we.x=(Me+1)*j,(Hr(R,B,V,ce,he,we)||Hr(R,B,V,ce,we,Ee))&&T.push({cellIdx:je*this.cellsX+Me,triIdx:I})}}if(T.length===0)return;T.sort((I,R)=>I.cellIdx-R.cellIdx||I.triIdx-R.triIdx);let A=0;for(;A<T.length;){const I=T[A].cellIdx,R={start:this.payload.length,len:0};for(;A<T.length&&T[A].cellIdx===I;)++R.len,this.payload.push(T[A++].triIdx);this.cells[I]=R}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,i){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const u=Fc(t.x-this.min.x,this.xScale,this.cellsX),h=Fc(t.y-this.min.y,this.yScale,this.cellsY),g=this.cells[h*this.cellsX+u];if(g){this._lazyInitLookup();for(let x=0;x<g.len;x++){const b=this.payload[g.start+x],j=Math.floor(b/8),T=1<<b%8;if(!(this.lookup[j]&T)&&(this.lookup[j]|=T,i.push(b),i.length===this.triangleCount))return}}}query(t,i,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>i.x||t.y>this.max.y||this.min.y>i.y)return;this._lazyInitLookup();const h=Fc(t.x-this.min.x,this.xScale,this.cellsX),g=Fc(i.x-this.min.x,this.xScale,this.cellsX),x=Fc(t.y-this.min.y,this.yScale,this.cellsY),b=Fc(i.y-this.min.y,this.yScale,this.cellsY);for(let j=x;j<=b;j++)for(let T=h;T<=g;T++){const A=this.cells[j*this.cellsX+T];if(A)for(let I=0;I<A.len;I++){const R=this.payload[A.start+I],B=Math.floor(R/8),V=1<<R%8;if(!(this.lookup[B]&V)&&(this.lookup[B]|=V,u.push(R),u.length===this.triangleCount))return}}}}function Fc(a,t,i){return Math.max(0,Math.min(i-1,Math.floor(a*t)))}Yt(M1,"TriangleGridIndex");class HI{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.footprints=[],this.worldview=t.worldview}updateFootprints(t,i){for(const u of this.footprints)i.push({footprint:u,id:t})}populate(t,i,u,h){const g=[];for(const{feature:x,id:b,index:j,sourceLayerIndex:T}of t){const A=this.layers[0]._featureFilter.needGeometry,I=Ke(x,A);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),I,u))continue;const R={id:b,properties:x.properties,type:x.type,sourceLayerIndex:T,index:j,geometry:A?I.geometry:Ae(x,u,h),patterns:{}};g.push(R)}for(const x of g){const{geometry:b,index:j,sourceLayerIndex:T}=x;this.addFeature(x,b,j,u,{},i.availableImages,i.brightness),i.featureIndex.insert(t[j].feature,b,j,T,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,i,u,h,g,x,b){}destroy(){}addFeature(t,i,u,h,g,x=[],b){for(const j of Jy(i,2)){const T=[],A=[],I=[],R=new et(1/0,1/0),B=new et(-1/0,-1/0);for(const Q of j)if(Q.length!==0){Q!==j[0]&&I.push(A.length/2);for(let re=0;re<Q.length;re++)A.push(Q[re].x),A.push(Q[re].y),T.push(Q[re]),R.x=Math.min(R.x,Q[re].x),R.y=Math.min(R.y,Q[re].y),B.x=Math.max(B.x,Q[re].x),B.y=Math.max(B.y,Q[re].y)}const V=Fm(A,I),K=new M1(T,V,8,256);this.footprints.push({vertices:T,indices:V,grid:K,min:R,max:B})}}}Yt(HI,"ClipBucket",{omit:["layers"]});const _G=ln([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),vG=ln([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),bG=ln([{name:"a_centroid_pos",components:2,type:"Uint16"}]),wG=ln([{name:"a_join_normal_inside",components:3,type:"Int16"}]),SG=ln([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),jG=ln([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:TG}=_G,Qy=Number.MAX_SAFE_INTEGER,WI=Qy-1;function qI(a,t,i,u){return a.order<t||a.order===Qy||!(a.clipMask&i)||function(h,g){return g.length!==0&&g.find(x=>x===h)===void 0}(u,a.clipScope)}function R1(a,t){return a.x-t.x||a.y-t.y}function ZI(a,t){return R1(a.min,t.min)===0&&R1(a.max,t.max)===0}function xj(a,t){return!(a.min.x>t.max.x||a.max.x<t.min.x||a.min.y>t.max.y||a.max.y<t.min.y)}function k1(a,t){if(a.length!==t.length)return!1;for(let i=0;i<a.length;i++)if(a[i].sourceId!==t[i].sourceId||!ZI(a[i],t[i])||a[i].order!==t[i].order||a[i].clipMask!==t[i].clipMask||!er(a[i].clipScope,t[i].clipScope))return!1;return!0}function KI(a,t,i){const u=1/Rt,h=1/(1<<i.canonical.z),g=(t.x*u+i.canonical.x)*h+i.wrap,x=(t.y*u+i.canonical.y)*h;return{min:new et((a.x*u+i.canonical.x)*h+i.wrap,(a.y*u+i.canonical.y)*h),max:new et(g,x)}}function NG(a,t,i){const u=1<<i.canonical.z,h=((t.x-i.wrap)*u-i.canonical.x)*Rt,g=(t.y*u-i.canonical.y)*Rt;return{min:new et(((a.x-i.wrap)*u-i.canonical.x)*Rt,(a.y*u-i.canonical.y)*Rt),max:new et(h,g)}}function yj(a,t,i,u,h,g,x){const b=a.indices,j=a.vertices,T=[];for(let A=u;A<u+h;A+=3){const I=t[i[A+0]+g],R=t[i[A+1]+g],B=t[i[A+2]+g],V=Math.min(I.x,R.x,B.x),K=Math.max(I.x,R.x,B.x),Q=Math.min(I.y,R.y,B.y),re=Math.max(I.y,R.y,B.y);T.length=0,a.grid.query(new et(V,Q),new et(K,re),T);for(let ue=0;ue<T.length;ue++){const ce=T[ue];if(Hr(j[b[3*ce+0]],j[b[3*ce+1]],j[b[3*ce+2]],I,R,B,x))return!0}}return!1}function XI(a,t,i,u){if(!a||!i)return!1;let h=a.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(i.vertices.length<a.vertices.length)return XI(i,u,a,t);const g=t.canonical,x=u.canonical,b=Math.pow(2,x.z-g.z);h=a.vertices.map(j=>new et((j.x+g.x*Rt)*b-x.x*Rt,(j.y+g.y*Rt)*b-x.y*Rt))}return yj(i,h,a.indices,0,a.indices.length,0,0)}function YI(a,t,i,u){const h=Math.pow(2,u.z-i.z);return new et((a+i.x*Rt)*h-u.x*Rt,(t+i.y*Rt)*h-u.y*Rt)}function _j(a,t){const i=[];t.grid.queryPoint(a,i);const u=t.indices,h=t.vertices;for(let g=0;g<i.length;g++){const x=i[g];if(Ui([h[u[3*x+0]],h[u[3*x+1]],h[u[3*x+2]]],a))return!0}return!1}const vj=[new et(0,0),new et(Rt,0),new et(Rt,Rt),new et(0,Rt)];function JI(a,t){const i=[];let u=[];if(!t||a.length<2)return[a];if(a.length===2)return Sr(a[0],a[1],vj)?[a]:[];for(let h=0;h<a.length+2;h++){const g=a[h%a.length],x=a[(h+1)%a.length],b=Sr(h===0?a[a.length-1]:a[(h-1)%a.length],g,vj),j=Sr(g,x,vj),T=b||j;T&&u.push(g),T&&j||u.length>0&&(u.length>1&&i.push(u),u=[])}return u.length>1&&i.push(u),i}const bj=Ge.types,EG=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],CG=["fill-extrusion-flood-light-ground-radius"],AG=Math.pow(2,13),PG=Math.pow(2,15)-1,QI=new et(0,1),Wd=2147483648;function e_(a,t,i,u,h,g,x,b){a.emplaceBack((t<<1)+x,(i<<1)+g,(Math.floor(u*AG)<<1)+h,Math.round(b))}function t_(a,t,i){a.emplaceBack(t.x*Rt,t.y*Rt,i?1:0)}function D1(a,t,i,u,h,g){a.emplaceBack(t.x,t.y,(i.x<<1)+u,(i.y<<1)+h,g)}function s_(a,t,i){a.emplaceBack(t.x,t.y,t.z,i[0]*16384,i[1]*16384,i[2]*16384)}class eM{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class tM{constructor(){this.centroidXY=new et(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new et(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new et(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new et(this.max.x-this.min.x,this.max.y-this.min.y)}}class sM{constructor(){this.acc=new et(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,i){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=i.x,t.min.y=t.max.y=i.y)}appendEdge(t,i,u){this.accCount++,this.acc._add(i);let h=!!this.borders;i.x<t.min.x?(t.min.x=i.x,h=!0):i.x>t.max.x&&(t.max.x=i.x,h=!0),i.y<t.min.y?(t.min.y=i.y,h=!0):i.y>t.max.y&&(t.max.y=i.y,h=!0),((i.x===0||i.x===Rt)&&i.x===u.x)!=((i.y===0||i.y===Rt)&&i.y===u.y)&&this.processBorderOverlap(i,u),h&&this.checkBorderIntersection(i,u)}checkBorderIntersection(t,i){i.x<0!=t.x<0&&this.addBorderIntersection(0,fs(i.y,t.y,(0-i.x)/(t.x-i.x))),i.x>Rt!=t.x>Rt&&this.addBorderIntersection(1,fs(i.y,t.y,(Rt-i.x)/(t.x-i.x))),i.y<0!=t.y<0&&this.addBorderIntersection(2,fs(i.x,t.x,(0-i.y)/(t.y-i.y))),i.y>Rt!=t.y>Rt&&this.addBorderIntersection(3,fs(i.x,t.x,(Rt-i.y)/(t.y-i.y)))}addBorderIntersection(t,i){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];i<u[0]&&(u[0]=i),i>u[1]&&(u[1]=i)}processBorderOverlap(t,i){if(t.x===i.x){if(t.y===i.y)return;const u=t.x===0?0:1;this.addBorderIntersection(u,i.y),this.addBorderIntersection(u,t.y)}else{const u=t.y===0?2:3;this.addBorderIntersection(u,i.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new et(0,0):new et(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce((t,i)=>t+ +(i[0]!==Number.MAX_VALUE),0):0}}function nM(a,t){const i=a.add(t)._unit(),u=xe(a.x*i.x+a.y*i.y,-1,1);var h,g,x;return h=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(h)))/4*PG*((g=a).x*(x=t).y-g.y*x.x<0?-1:1)}const IG=[a=>a.x<0,a=>a.x>Rt,a=>a.y<0,a=>a.y>Rt];function MG(a,t,i,u){const h=[4];if(u===0)return h;i._mult(u);const g=a.sub(i),x=t.sub(i),b=[a,t,g,x];for(let j=0;j<4;j++)for(const T of b)if(IG[j](T)){h.push(j);break}return h}class wj{constructor(t){this.vertexArray=new Cm,this.indexArray=new ur,this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut},i=>CG.includes(i)),this._segments=new mr,this.hiddenByLandmarkVertexArray=new km,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new mr}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,i,u,h=!1){const g=t.length;if(g>2){let x=Math.max(0,this._segments.get().length-1);const b=this._segments._prepareSegment(4*g,this.vertexArray.length,2*this._segmentToGroundQuads[x].length);let j;x!==this._segments.get().length-1&&(x++,this._segmentToGroundQuads[x]=[],this._segmentToRegionTriCounts[x]=[0,0,0,0,0]);{const T=t[0],A=t[1];j=nM(T.sub(t[g-1])._perp()._unit(),A.sub(T)._perp()._unit())}for(let T=0;T<g;T++){const A=T===g-1?0:T+1,I=t[T],R=t[A],B=t[A===g-1?0:A+1],V=R.sub(I)._perp()._unit(),K=nM(V,B.sub(R)._perp()._unit()),Q=j,re=K;if(Sj(I,R,i)||h&&oM(I,i)&&oM(R,i)){j=K;continue}const ue=b.vertexLength;D1(this.vertexArray,I,R,1,1,Q),D1(this.vertexArray,I,R,1,0,Q),D1(this.vertexArray,I,R,0,1,re),D1(this.vertexArray,I,R,0,0,re),b.vertexLength+=4;const ce=MG(I,R,V,u);for(const he of ce)this._segmentToGroundQuads[x].push({id:ue,region:he}),this._segmentToRegionTriCounts[x][he]+=2,b.primitiveLength+=2;j=K}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),i=t.length;for(let u=0;u<i;u++)this._segmentToGroundQuads[u].sort((h,g)=>h.region-g.region);for(let u=0;u<i;u++){const h=this._segmentToGroundQuads[u],g=t[u],x=this._segmentToRegionTriCounts[u];x.reduce((j,T)=>j+T,0);let b=0;for(let j=0;j<=4;j++){const T=x[j];if(T!==0){let A=this.regionSegments[j];A||(A=this.regionSegments[j]=new mr);const I={vertexOffset:g.vertexOffset,primitiveOffset:g.primitiveOffset+b,vertexLength:g.vertexLength,primitiveLength:T};A.get().push(I)}b+=T}for(let j=0;j<h.length;j++){const T=h[j].id;this.indexArray.emplaceBack(T,T+1,T+3),this.indexArray.emplaceBack(T,T+3,T+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,i,u,h,g,x,b){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,i,u,h,g,x,void 0,b)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,vG.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,i,u,h,g,x,b,j){this.hasData()&&this.programConfigurations.updatePaintArrays(t,i,u,h,g,x,b,j)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&Wd))}updateHiddenByLandmarkRange(t,i,u){if(!this.hasData())return;const h=i+t;if(i!==0){for(let g=t;g<h;++g)this.hiddenByLandmarkVertexArray.emplace(g,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,SG.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const i=this.regionSegments[t];i&&i.destroy()}}}}class L1{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new ur,this.footprintVertices=new Po,this.footprintSegments=[],this.layoutVertexArray=new Rd,this.centroidVertexArray=new m1,this.wallVertexArray=new x1,this.indexArray=new ur,this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut},i=>EG.includes(i)),this.segments=new mr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.groundEffect=new wj(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview}updateFootprints(t,i){}populate(t,i,u,h){this.features=[],this.hasPattern=hj("fill-extrusion",this.layers,this.pixelRatio,i),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=ve(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:g,id:x,index:b,sourceLayerIndex:j}of t){const T=this.layers[0]._featureFilter.needGeometry,A=Ke(g,T);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),A,u))continue;const I={id:x,sourceLayerIndex:j,index:b,geometry:T?A.geometry:Ae(g,u,h),properties:g.properties,type:g.type,patterns:{}},R=this.layoutVertexArray.length,B=bj[I.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:g.id,feature:pj("fill-extrusion",this.layers,I,this.zoom,this.pixelRatio,i)});else if(this.wallMode)for(const V of I.geometry)for(const K of JI(V,B))this.addFeature(g.id,I,[K],b,u,{},i.availableImages,h,i.brightness);else this.addFeature(g.id,I,I.geometry,b,u,{},i.availableImages,h,i.brightness);i.featureIndex.insert(g,I.geometry,b,j,this.index,R)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,i,u,h,g,x){for(const{featureId:b,feature:j}of this.features){const T=bj[j.type]==="Polygon",{geometry:A}=j;if(this.wallMode)for(const I of A)for(const R of JI(I,T))this.addFeature(b,j,[R],j.index,i,u,h,g,x);else this.addFeature(b,j,A,j.index,i,u,h,g,x)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,i,u,h,g,x,b){this.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,this.worldview),this.groundEffect.update(t,i,g,u,h,x,b,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,TG),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,wG.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,jG.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,bG.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,i,u,h,g,x,b,j,T){const A=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(i,{})/this.tileToMeter,I=[new et(0,0),new et(Rt,Rt)],R=j.projection,B=R.name==="globe",V=this.wallMode||bj[i.type]==="Polygon",K=new sM;K.centroidDataIndex=this.centroidData.length;const Q=new tM;Q.buildingId=t,i.properties&&i.properties.hasOwnProperty("building_id")&&(Q.buildingId=i.properties.building_id);const re=this.layers[0].paint.get("fill-extrusion-base").evaluate(i,{},g)<=0,ue=this.layers[0].paint.get("fill-extrusion-height").evaluate(i,{},g);let ce;if(Q.height=ue,Q.vertexArrayOffset=this.layoutVertexArray.length,Q.groundVertexArrayOffset=this.groundEffect.vertexArray.length,B&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new Pm),this.wallMode){if(B)return void rn("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;ce=function(Fe){const st=Fe[0].x===Fe[Fe.length-1].x&&Fe[0].y===Fe[Fe.length-1].y;(function(bt){let ts=0;const qt=bt.length;for(let kt=0;kt<qt;kt++)ts+=(bt[(kt+1)%qt].x-bt[kt].x)*(bt[(kt+1)%qt].y+bt[kt].y);return ts>=0})(Fe)||(Fe=Fe.reverse());const lt={geometry:[],joinNormals:[],indices:[]},gt=[],St=[],Ye=[];let _t=Fe.length;for(;_t>=2&&Fe[_t-1].equals(Fe[_t-2]);)_t--;if(_t<(st?3:2))return lt;let Ve,Je,Ct,vt,os,Jt=0;for(;Jt<_t-1&&Fe[Jt].equals(Fe[Jt+1]);)Jt++;st&&(Ve=Fe[_t-2],os=Fe[Jt].sub(Ve)._unit()._perp());for(let bt=Jt;bt<_t;bt++){if(Ct=bt===_t-1?st?Fe[Jt+1]:void 0:Fe[bt+1],Ct&&Fe[bt].equals(Ct))continue;os&&(vt=os),Ve&&(Je=Ve),Ve=Fe[bt],os=Ct?Ct.sub(Ve)._unit()._perp():vt,vt=vt||os;let ts=vt.add(os);ts.x===0&&ts.y===0||ts._unit();const qt=ts.x*os.x+ts.y*os.y,kt=qt!==0?1/qt:1/0,Zt=vt.x*os.y-vt.y*os.x>0;let xs="miter";const As=2;xs==="miter"&&kt>As&&(xs="bevel"),xs==="bevel"&&(kt>100&&(xs="flipbevel"),kt<As&&(xs="miter"));const zs=(ks,on,Gs,nr)=>{const me=new et(ks.x,ks.y),ge=new et(ks.x,ks.y);me.x+=on.x*nr,me.y+=on.y*nr,ge.x-=on.x*Math.max(Gs,1),ge.y-=on.y*Math.max(Gs,1),Ye.push(on),gt.push(me),St.push(ge)};if(xs==="miter")ts._mult(kt),zs(Ve,ts,0,0);else if(xs==="flipbevel")ts=os.mult(-1),zs(Ve,ts,0,0),zs(Ve,ts.mult(-1),0,0);else{const ks=-Math.sqrt(kt*kt-1),on=Zt?ks:0,Gs=Zt?0:ks;Je&&zs(Ve,vt,on,Gs),Ct&&zs(Ve,os,on,Gs)}}lt.geometry=[...gt,...St.reverse(),gt[0]],lt.joinNormals=[...Ye,...Ye.reverse(),Ye[Ye.length-1]];const ft=lt.geometry.length-1;for(let bt=0;bt<ft/2;bt++)if(bt+1<ft/2){let ts=bt,qt=bt+1,kt=ft-1-bt,Zt=ft-2-bt;ts=ts===0?ft-1:ts-1,qt=qt===0?ft-1:qt-1,kt=kt===0?ft-1:kt-1,Zt=Zt===0?ft-1:Zt-1,lt.indices.push(kt),lt.indices.push(qt),lt.indices.push(ts),lt.indices.push(kt),lt.indices.push(Zt),lt.indices.push(qt)}return lt}(u[0]),u=[ce.geometry]}const he=(Fe,st)=>Fe<(st.length-1)/2||Fe===st.length-1,Ee=this.wallMode?[u]:Jy(u,500);for(let Fe=Ee.length-1;Fe>=0;Fe--){const st=Ee[Fe];(st.length===0||(we=st[0]).every(Tt=>Tt.x<=0)||we.every(Tt=>Tt.x>=Rt)||we.every(Tt=>Tt.y<=0)||we.every(Tt=>Tt.y>=Rt))&&Ee.splice(Fe,1)}var we;let je;if(B)je=uM(Ee,I,g);else{je=[];for(const Fe of Ee)je.push({polygon:Fe,bounds:I})}const Me=V?this.edgeRadius:0,ke=Me>0&&this.zoom<17,Qe=(Fe,st)=>{if(Fe.length===0)return!1;const Tt=Fe[Fe.length-1];return st.x===Tt.x&&st.y===Tt.y};for(const{polygon:Fe,bounds:st}of je){let Tt=0,lt=0;for(const _t of Fe)V&&!_t[0].equals(_t[_t.length-1])&&_t.push(_t[0]),lt+=V?_t.length-1:_t.length;const gt=this.segments.prepareSegment((V?5:4)*lt,this.layoutVertexArray,this.indexArray);Q.footprintSegIdx<0&&(Q.footprintSegIdx=this.footprintSegments.length),Q.polygonSegIdx<0&&(Q.polygonSegIdx=this.polygonSegments.length);const St={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},Ye=new eM;if(Ye.vertexOffset=this.footprintVertices.length,Ye.indexOffset=3*this.footprintIndices.length,Ye.ringIndices=[],V){const _t=[],Ve=[];Tt=gt.vertexLength;for(let Ct=0;Ct<Fe.length;Ct++){const vt=Fe[Ct];vt.length&&Ct!==0&&Ve.push(_t.length/2);const os=[];let Jt,ft;Jt=vt[1].sub(vt[0])._perp()._unit(),Ye.ringIndices.push(vt.length-1);for(let bt=1;bt<vt.length;bt++){const ts=vt[bt],qt=vt[bt===vt.length-1?1:bt+1],kt=ts.clone();if(Me){ft=qt.sub(ts)._perp()._unit();const Zt=Jt.add(ft)._unit(),xs=Me*Math.min(4,1/(Jt.x*Zt.x+Jt.y*Zt.y));kt.x+=xs*Zt.x,kt.y+=xs*Zt.y,kt.x=Math.round(kt.x),kt.y=Math.round(kt.y),Jt=ft}if(!re||Me!==0&&!ke||Qe(os,kt)||os.push(kt),e_(this.layoutVertexArray,kt.x,kt.y,0,0,1,1,0),this.wallMode){const Zt=he(bt,vt);t_(this.wallVertexArray,ce.joinNormals[bt],!Zt)}gt.vertexLength++,this.footprintVertices.emplaceBack(ts.x,ts.y),_t.push(ts.x,ts.y),B&&s_(this.layoutVertexExtArray,R.projectTilePoint(kt.x,kt.y,g),R.upVector(g,kt.x,kt.y))}re&&(Me===0||ke)&&(os.length!==0&&Qe(os,os[0])&&os.pop(),this.groundEffect.addData(os,st,A))}const Je=this.wallMode?ce.indices:Fm(_t,Ve);for(let Ct=0;Ct<Je.length;Ct+=3)this.footprintIndices.emplaceBack(Ye.vertexOffset+Je[Ct+0],Ye.vertexOffset+Je[Ct+1],Ye.vertexOffset+Je[Ct+2]),this.indexArray.emplaceBack(Tt+Je[Ct],Tt+Je[Ct+2],Tt+Je[Ct+1]),gt.primitiveLength++;Ye.indexCount+=Je.length,Ye.vertexCount+=this.footprintVertices.length-Ye.vertexOffset}for(let _t=0;_t<Fe.length;_t++){const Ve=Fe[_t];K.startRing(Q,Ve[0]);let Je=Ve.length>4&&aM(Ve[Ve.length-2],Ve[0],Ve[1]),Ct=Me?RG(Ve[Ve.length-2],Ve[0],Ve[1],Me):0;const vt=[];let os,Jt,ft;Jt=Ve[1].sub(Ve[0])._perp()._unit();let bt=!0;for(let ts=1,qt=0;ts<Ve.length;ts++){let kt=Ve[ts-1],Zt=Ve[ts];const xs=Ve[ts===Ve.length-1?1:ts+1];if(K.appendEdge(Q,Zt,kt),Sj(Zt,kt,st)){Me&&(Jt=xs.sub(Zt)._perp()._unit(),bt=!bt);continue}const As=Zt.sub(kt)._perp(),zs=As.x/(Math.abs(As.x)+Math.abs(As.y)),ks=As.y>0?1:0,on=kt.dist(Zt);if(qt+on>32768&&(qt=0),Me){ft=xs.sub(Zt)._perp()._unit();let ge=iM(kt,Zt,xs,rM(Jt,ft),Me);isNaN(ge)&&(ge=0);const Ze=Zt.sub(kt)._unit();kt=kt.add(Ze.mult(Ct))._round(),Zt=Zt.add(Ze.mult(-ge))._round(),Ct=ge,Jt=ft,re&&this.zoom>=17&&(Qe(vt,kt)||vt.push(kt),Qe(vt,Zt)||vt.push(Zt))}const Gs=gt.vertexLength,nr=Ve.length>4&&aM(kt,Zt,xs);let me=lM(qt,Je,bt);if(e_(this.layoutVertexArray,kt.x,kt.y,zs,ks,0,0,me),e_(this.layoutVertexArray,kt.x,kt.y,zs,ks,0,1,me),this.wallMode){const ge=he(ts-1,Ve),Ze=ce.joinNormals[ts-1];t_(this.wallVertexArray,Ze,ge),t_(this.wallVertexArray,Ze,ge)}if(qt+=on,me=lM(qt,nr,!bt),Je=nr,e_(this.layoutVertexArray,Zt.x,Zt.y,zs,ks,0,0,me),e_(this.layoutVertexArray,Zt.x,Zt.y,zs,ks,0,1,me),this.wallMode){const ge=he(ts,Ve),Ze=ce.joinNormals[ts];t_(this.wallVertexArray,Ze,ge),t_(this.wallVertexArray,Ze,ge)}if(gt.vertexLength+=4,this.indexArray.emplaceBack(Gs+0,Gs+1,Gs+2),this.indexArray.emplaceBack(Gs+1,Gs+3,Gs+2),gt.primitiveLength+=2,Me){const ge=Tt+(ts===1?Ve.length-2:ts-2),Ze=ts===1?Tt:ge+1;if(this.indexArray.emplaceBack(Gs+1,ge,Gs+3),this.indexArray.emplaceBack(ge,Ze,Gs+3),gt.primitiveLength+=2,os===void 0&&(os=Gs),!Sj(xs,Ve[ts],st)){const At=ts===Ve.length-1?os:gt.vertexLength;this.indexArray.emplaceBack(Gs+2,Gs+3,At),this.indexArray.emplaceBack(Gs+3,At+1,At),this.indexArray.emplaceBack(Gs+3,Ze,At+1),gt.primitiveLength+=3}bt=!bt}if(B){const ge=this.layoutVertexExtArray,Ze=R.projectTilePoint(kt.x,kt.y,g),At=R.projectTilePoint(Zt.x,Zt.y,g),Ft=R.upVector(g,kt.x,kt.y),zt=R.upVector(g,Zt.x,Zt.y);s_(ge,Ze,Ft),s_(ge,Ze,Ft),s_(ge,At,zt),s_(ge,At,zt)}}V&&(Tt+=Ve.length-1),re&&Me&&this.zoom>=17&&(vt.length!==0&&Qe(vt,vt[0])&&vt.pop(),this.groundEffect.addData(vt,st,A,Me>0))}this.footprintSegments.push(Ye),St.triangleCount=this.indexArray.length-St.triangleArrayOffset,this.polygonSegments.push(St),++Q.footprintSegLen,++Q.polygonSegLen}if(Q.vertexCount=this.layoutVertexArray.length-Q.vertexArrayOffset,Q.groundVertexCount=this.groundEffect.vertexArray.length-Q.groundVertexArrayOffset,Q.vertexCount!==0){if(Q.centroidXY=K.borders?QI:this.encodeCentroid(K,Q),this.centroidData.push(Q),K.borders){this.featuresOnBorder.push(K);const Fe=this.featuresOnBorder.length-1;for(let st=0;st<K.borders.length;st++)K.borders[st][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[st].push(Fe)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,i,h,x,b,g,T,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(i,h,x,b,g,T,this.worldview),this.maxHeight=Math.max(this.maxHeight,ue)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort((i,u)=>this.featuresOnBorder[i].borders[t][0]-this.featuresOnBorder[u].borders[t][0])}splitToSubtiles(){const t=[];for(let b=0;b<this.centroidData.length;b++){const j=this.centroidData[b],T=+(j.min.y+j.max.y>Rt),A=2*T+(+(j.min.x+j.max.x>Rt)^T);for(let I=0;I<j.polygonSegLen;I++){const R=j.polygonSegIdx+I;t.push({centroidIdx:b,subtile:A,polygonSegmentIdx:R,triangleSegmentIdx:this.polygonSegments[R].triangleSegIdx})}}const i=new ur;t.sort((b,j)=>b.triangleSegmentIdx===j.triangleSegmentIdx?b.subtile-j.subtile:b.triangleSegmentIdx-j.triangleSegmentIdx);let u=0,h=0,g=0;for(const b of t){if(b.triangleSegmentIdx!==u)break;g++}const x=t.length;for(;h!==t.length;){u=t[h].triangleSegmentIdx;let b=0,j=h,T=h;for(let A=j;A<g&&t[A].subtile===b;A++)T++;for(;j!==g;){const A=t[j];b=A.subtile;const I=this.centroidData[A.centroidIdx].min.clone(),R=this.centroidData[A.centroidIdx].max.clone(),B={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:i.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let V=j;V<T;V++){const K=t[V],Q=this.polygonSegments[K.polygonSegmentIdx],re=this.centroidData[K.centroidIdx].min,ue=this.centroidData[K.centroidIdx].max,ce=this.indexArray.uint16;for(let he=Q.triangleArrayOffset;he<Q.triangleArrayOffset+Q.triangleCount;he++)i.emplaceBack(ce[3*he],ce[3*he+1],ce[3*he+2]);B.primitiveLength+=Q.triangleCount,I.x=Math.min(I.x,re.x),I.y=Math.min(I.y,re.y),R.x=Math.max(R.x,ue.x),R.y=Math.max(R.y,ue.y)}B.primitiveLength>0&&this.triangleSubSegments.push({segment:B,min:I,max:R}),j=T;for(let V=j;V<g&&t[V].subtile===t[j].subtile;V++)T++}h=g;for(let A=h;A<x&&t[A].triangleSegmentIdx===t[h].triangleSegmentIdx;A++)g++}i._trim(),this.indexArray=i}getVisibleSegments(t,i,u){const h=new mr;if(this.wallMode){for(const K of this.triangleSubSegments)h.segments.push(K.segment);return h}let g=0,x=0;const b=1<<t.canonical.z;if(i){const K=i.getMinMaxForTile(t);K&&(g=K.min,x=K.max)}x+=this.maxHeight;const j=t.toUnwrapped();let T;const A=[j.canonical.x/b+j.wrap,j.canonical.y/b],I=[(j.canonical.x+1)/b+j.wrap,(j.canonical.y+1)/b],R=(K,Q,re)=>[K[0]*(1-re[0])+Q[0]*re[0],K[1]*(1-re[1])+Q[1]*re[1]],B=[],V=[];for(const K of this.triangleSubSegments){B[0]=K.min.x/Rt,B[1]=K.min.y/Rt,V[0]=K.max.x/Rt,V[1]=K.max.y/Rt;const Q=R(A,I,B),re=R(A,I,V);if(new qs([Q[0],Q[1],g],[re[0],re[1],x]).intersectsPrecise(u)===0){T&&(h.segments.push(T),T=void 0);continue}const ue=K.segment;T&&T.vertexOffset!==ue.vertexOffset&&(h.segments.push(T),T=void 0),T?(T.vertexLength+=ue.vertexLength,T.primitiveLength+=ue.primitiveLength):T={vertexOffset:ue.vertexOffset,primitiveLength:ue.primitiveLength,vertexLength:ue.vertexLength,primitiveOffset:ue.primitiveOffset,sortKey:void 0,vaos:{}}}return T&&h.segments.push(T),h}encodeCentroid(t,i){const u=t.centroid(),h=i.span(),g=Math.min(7,Math.round(h.x*this.tileToMeter/10)),x=Math.min(7,Math.round(h.y*this.tileToMeter/10));return new et(xe(u.x,1,Rt-1)<<3|g,xe(u.y,1,Rt-1)<<3|x)}encodeBorderCentroid(t){if(!t.borders)return new et(0,0);const i=t.borders,u=Number.MAX_VALUE;if(i[0][0]!==u||i[1][0]!==u){const h=i[0][0]!==u?0:1;return new et(6|(i[0][0]!==u?0:65528),(i[h][0]+i[h][1])/2<<3|6)}{const h=i[2][0]!==u?2:3;return new et((i[h][0]+i[h][1])/2<<3|6,6|(i[2][0]!==u?0:65528))}}showCentroid(t){const i=this.centroidData[t.centroidDataIndex];i.flags&=2147483647,i.centroidXY.x=0,i.centroidXY.y=0,this.writeCentroidToBuffer(i)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const i=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,h=t.flags&Wd?QI:t.centroidXY,g=this.centroidVertexArray.geta_centroid_pos0(i);if(this.centroidVertexArray.geta_centroid_pos1(i)!==h.y||g!==h.x){for(let x=i;x<u;++x)this.centroidVertexArray.emplace(x,h.x,h.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(t.toUnwrapped());if(k1(this.activeReplacements,h))return;if(this.activeReplacements=h,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const x of this.centroidData)x.flags&=2147483647;const g=[];for(const x of this.activeReplacements){if(x.order<u)continue;const b=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-t.canonical.z));if(x.footprint.buildingId){const j=x.footprint.buildingId;for(const T of this.centroidData)T.buildingId===j&&(T.flags|=Wd)}else for(const j of this.centroidData)if(!(j.flags&Wd||x.min.x>j.max.x||j.min.x>x.max.x||x.min.y>j.max.y||j.min.y>x.max.y))for(let T=0;T<j.footprintSegLen;T++){const A=this.footprintSegments[j.footprintSegIdx+T];if(g.length=0,kG(this.footprintVertices,A.vertexOffset,A.vertexCount,x.footprintTileId.canonical,t.canonical,g),yj(x.footprint,g,this.footprintIndices.uint16,A.indexOffset,A.indexCount,-A.vertexOffset,-b)){j.flags|=Wd;break}}}for(const x of this.centroidData)this.writeCentroidToBuffer(x);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,i,u){let h=!1;for(let g=0;g<u.footprintSegLen;g++){const x=this.footprintSegments[u.footprintSegIdx+g];let b=0;for(const j of x.ringIndices){for(let T=b,A=j+b-1;T<j+b;A=T++){const I=this.footprintVertices.int16[2*(T+x.vertexOffset)+0],R=this.footprintVertices.int16[2*(T+x.vertexOffset)+1],B=this.footprintVertices.int16[2*(A+x.vertexOffset)+1];R>i!=B>i&&t<(this.footprintVertices.int16[2*(A+x.vertexOffset)+0]-I)*(i-R)/(B-R)+I&&(h=!h)}b=j}}return h}getHeightAtTileCoord(t,i){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(t+Rt)*Rt+(i+Rt);if(this.partLookup.hasOwnProperty(g)){const x=this.partLookup[g];return x?{height:x.height,hidden:!!(x.flags&Wd)}:void 0}for(const x of this.centroidData)t>x.max.x||x.min.x>t||i>x.max.y||x.min.y>i||x.height<=u||this.footprintContainsPoint(t,i,x)&&(u=x.height,this.partLookup[g]=x,h=!!(x.flags&Wd));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.partLookup[g]=void 0}}function rM(a,t){const i=a.add(t)._unit();return a.x*i.x+a.y*i.y}function RG(a,t,i,u){const h=t.sub(a)._perp()._unit(),g=i.sub(t)._perp()._unit();return iM(a,t,i,rM(h,g),u)}function iM(a,t,i,u,h){const g=Math.sqrt(1-u*u);return Math.min(a.dist(t)/3,t.dist(i)/3,h*g/u)}function Sj(a,t,i){return a.x<i[0].x&&t.x<i[0].x||a.x>i[1].x&&t.x>i[1].x||a.y<i[0].y&&t.y<i[0].y||a.y>i[1].y&&t.y>i[1].y}function oM(a,t){return a.x<t[0].x||a.x>t[1].x||a.y<t[0].y||a.y>t[1].y}function aM(a,t,i){if(a.x<0||a.x>=Rt||t.x<0||t.x>=Rt||i.x<0||i.x>=Rt)return!1;const u=i.sub(t),h=u.perp(),g=a.sub(t);return(u.x*g.x+u.y*g.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(g.x*g.x+g.y*g.y))>-.866&&h.x*g.x+h.y*g.y<0}function lM(a,t,i){const u=t?2|a:-3&a;return i?1|u:-2&u}function cM(){const a=Math.PI/32,t=Math.tan(a),i=C;return i*Math.sqrt(1+2*t*t)-i}function uM(a,t,i){const u=1<<i.z,h=le(i.x/u),g=le((i.x+1)/u),x=de(i.y/u),b=de((i.y+1)/u);return function(j,T,A,I,R=0,B){const V=[];if(!j.length||!A||!I)return V;const K=(we,je)=>{for(const Me of we)V.push({polygon:Me,bounds:je})},Q=Math.ceil(Math.log2(A)),re=Math.ceil(Math.log2(I)),ue=Q-re,ce=[];for(let we=0;we<Math.abs(ue);we++)ce.push(ue>0?0:1);for(let we=0;we<Math.min(Q,re);we++)ce.push(0),ce.push(1);let he=j;if(he=I1(he,T[0].y-R,T[1].y+R,1),he=I1(he,T[0].x-R,T[1].x+R,0),!he.length)return V;const Ee=[];for(ce.length?Ee.push({polygons:he,bounds:T,depth:0}):K(he,T);Ee.length;){const we=Ee.pop(),je=we.depth,Me=ce[je],ke=we.bounds[0],Qe=we.bounds[1],Fe=Me===0?ke.x:ke.y,st=Me===0?Qe.x:Qe.y,Tt=B?B(Me,Fe,st):.5*(Fe+st),lt=I1(we.polygons,Fe-R,Tt+R,Me),gt=I1(we.polygons,Tt-R,st+R,Me);if(lt.length){const St=[ke,new et(Me===0?Tt:Qe.x,Me===1?Tt:Qe.y)];ce.length>je+1?Ee.push({polygons:lt,bounds:St,depth:je+1}):K(lt,St)}if(gt.length){const St=[new et(Me===0?Tt:ke.x,Me===1?Tt:ke.y),Qe];ce.length>je+1?Ee.push({polygons:gt,bounds:St,depth:je+1}):K(gt,St)}}return V}(a,t,Math.ceil((g-h)/11.25),Math.ceil((x-b)/11.25),1,(j,T,A)=>{if(j===0)return .5*(T+A);{const I=de((i.y+T/Rt)/u);return(se(.5*(de((i.y+A/Rt)/u)+I))*u-i.y)*Rt}})}function kG(a,t,i,u,h,g){const x=Math.pow(2,u.z-h.z);for(let b=0;b<i;b++){let j=a.int16[2*(b+t)+0],T=a.int16[2*(b+t)+1];j=(j+h.x*Rt)*x-u.x*Rt,T=(T+h.y*Rt)*x-u.y*Rt,g.push(new et(j,T))}}let dM,hM;Yt(L1,"FillExtrusionBucket",{omit:["layers","features"]}),Yt(tM,"PartData"),Yt(eM,"FootprintSegment"),Yt(sM,"BorderCentroidData"),Yt(wj,"GroundEffect");class zp extends et{constructor(t,i,u){super(t,i),this.z=u}}class pM extends zp{constructor(t,i,u,h){super(t,i,u),this.w=h}}function fM(a,t,i,u){const h=i==="x"?"y":"x",g=(u-a[i])/(t[i]-a[i]);a[h]=Math.round(a[h]+(t[h]-a[h])*g),a[i]=u,a.hasOwnProperty("z")&&(a.z=fs(a.z,t.z,g)),a.hasOwnProperty("w")&&(a.w=fs(a.w,t.w,g))}function mM(a,t,i,u){const h=i,g=u;for(const x of["x","y"]){let b=a,j=t;b[x]>=j[x]&&(b=t,j=a),b[x]<h&&j[x]>h&&fM(b,j,x,h),b[x]<g&&j[x]>g&&fM(j,b,x,g)}}function z1(a,t,i,u,h,g){const x=[];for(let b=0;b<a.length;b++){const j=a[b];let T;const A=x.length;let I=0;for(let R=0;R<j.length-1;R++){let B=j[R],V=j[R+1],K=0;const Q=I;let re,ue;g&&(K=Math.hypot(V.x-B.x,V.y-B.y),I+=K,re=B,ue=V),B.x<t&&V.x<t||(B.x<t?B=new et(t,B.y+(t-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x<t&&(V=new et(t,B.y+(t-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y<i&&V.y<i||(B.y<i?B=new et(B.x+(i-B.y)/(V.y-B.y)*(V.x-B.x),i)._round():V.y<i&&(V=new et(B.x+(i-B.y)/(V.y-B.y)*(V.x-B.x),i)._round()),B.x>=u&&V.x>=u||(B.x>=u?B=new et(u,B.y+(u-B.x)/(V.x-B.x)*(V.y-B.y))._round():V.x>=u&&(V=new et(u,B.y+(u-B.x)/(V.x-B.x)*(V.y-B.y))._round()),B.y>=h&&V.y>=h||(B.y>=h?B=new et(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round():V.y>=h&&(V=new et(B.x+(h-B.y)/(V.y-B.y)*(V.x-B.x),h)._round()),T&&B.equals(T[T.length-1])||(T=[B],x.push(T),g&&g.push({progress:{min:Q+gM(re,ue,B)*K,max:1},parentIndex:b,prevPoint:re,nextPoint:ue})),T.push(V),g&&(g[g.length-1].progress.max=Q+gM(re,ue,V)*K,g[g.length-1].nextPoint=ue)))))}if(g&&I>0)for(let R=A;R<x.length;R++)g[R].progress.min/=I,g[R].progress.max/=I}return x}function DG(a,t,i,u,h){if(a.length<2)return void u.push(a);const g=[];for(;t.valid();){const[T,A]=t.get();for(let I=0;I<a.length-1;I++){const R=a[I],B=a[I+1],V=Oo(R,B,T,A);if(V){const[K]=V,Q=new et(fs(R.x,B.x,K),fs(R.y,B.y,K));g.push({t:I+K,distance:0,point:Q})}}t.next()}if(g.length===0)return void u.push(a);g.sort((T,A)=>T.t-A.t);let x=0,b=0,j=[];for(u.push(j);x!==a.length;){if(b===g.length){for(;x!==a.length;)j.length!==0&&j[j.length-1].equals(a[x])||j.push(a[x]),x++;break}g[b].t<=x?(j.length!==0&&j[j.length-1].equals(g[b].point)||j.push(g[b].point),Math.trunc(g[b].t),b++):(j.length!==0&&j[j.length-1].equals(a[x])||j.push(a[x]),x++)}}function gM(a,t,i){return a.x!==t.x?(i.x-a.x)/(t.x-a.x):a.y!==t.y?(i.y-a.y)/(t.y-a.y):0}function n_(a,t){return a.x*t.x+a.y*t.y}function xM(a,t){if(a.length===1){let i=0;const u=t[i++];let h;for(;!h||u.equals(h);)if(h=t[i++],!h)return 1/0;for(;i<t.length;i++){const g=t[i],x=a[0],b=h.sub(u),j=g.sub(u),T=x.sub(u),A=n_(b,b),I=n_(b,j),R=n_(j,j),B=n_(T,b),V=n_(T,j),K=A*R-I*I,Q=(R*B-I*V)/K,re=(A*V-I*B)/K,ue=u.z*(1-Q-re)+h.z*Q+g.z*re;if(isFinite(ue))return ue}return 1/0}{let i=1/0;for(const u of t)i=Math.min(i,u.z);return i}}function yM(a,t,i,u,h,g,x,b){const j=x*h.getElevationAt(a,t,!0,!0),T=g[0]!==0,A=T?g[1]===0?x*(g[0]/7-450):x*function(I,R,B){const V=Math.floor(R[0]/8),K=Math.floor(R[1]/8),Q=10*(R[0]-8*V),re=10*(R[1]-8*K),ue=I.getElevationAt(V,K,!0,!0),ce=I.getMeterToDEM(B),he=Math.floor(.5*(Q*ce-1)),Ee=Math.floor(.5*(re*ce-1)),we=I.tileCoordToPixel(V,K),je=2*he+1,Me=2*Ee+1,ke=function(gt,St,Ye,_t,Ve){return[gt.getElevationAtPixel(St,Ye,!0),gt.getElevationAtPixel(St+Ve,Ye,!0),gt.getElevationAtPixel(St,Ye+Ve,!0),gt.getElevationAtPixel(St+_t,Ye+Ve,!0)]}(I,we.x-he,we.y-Ee,je,Me),Qe=Math.abs(ke[0]-ke[1]),Fe=Math.abs(ke[2]-ke[3]),st=Math.abs(ke[0]-ke[2])+Math.abs(ke[1]-ke[3]),Tt=Math.min(.25,.5*ce*(Qe+Fe)/je),lt=Math.min(.25,.5*ce*st/Me);return ue+Math.max(Tt*Q,lt*re)}(h,g,b):j;return{base:j+(i===0?-1:i),top:T?Math.max(A+u,j+i+2):j+u}}class LG{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout(()=>{this._triggered=!1,this._callback()},0))}remove(){this._channel=void 0,this._callback=()=>{}}}class zG{constructor(){this.tasks={},this.taskQueue=[],Ts(["process"],this),this.invoker=new LG(this.process),this.nextId=0}add(t,i){const u=this.nextId++,h=function({type:g,isSymbolTile:x,zoom:b}){return b=b||0,g==="message"?0:g!=="maybePrepare"||x?g!=="parseTile"||x?g==="parseTile"&&x?300-b:g==="maybePrepare"&&x?400-b:500:200-b:100-b}(i);if(h===0){try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:i,priority:h,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter(u=>!!this.tasks[u]),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const i=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!i)return;i.fn()}finally{}}pick(){let t=null,i=1/0;for(let h=0;h<this.taskQueue.length;h++){const g=this.tasks[this.taskQueue[h]];g.priority<i&&(i=g.priority,t=h)}if(t===null)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class _M{constructor(t,i,u){this.target=t,this.parent=i,this.mapId=u,this.callbacks={},this.cancelCallbacks={},Ts(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new zG}send(t,i,u,h,g=!1,x){const b=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=x,this.callbacks[b]=u);const j=new Set;return this.target.postMessage({id:b,type:t,hasCallback:!!u,targetMapId:h,mustQueue:g,sourceMapId:this.mapId,data:Bl(i,j)},j),{cancel:()=>{u&&delete this.callbacks[b],this.target.postMessage({id:b,type:"<cancel>",targetMapId:h,sourceMapId:this.mapId})}}}receive(t){const i=t.data;if(!i)return;const u=i.id;if(u&&(!i.targetMapId||this.mapId===i.targetMapId))if(i.type==="<cancel>"){const h=this.cancelCallbacks[u];delete this.cancelCallbacks[u],h&&h.cancel()}else if(i.mustQueue||Ln(self)){const h=this.callbacks[u],g=this.scheduler.add(()=>this.processTask(u,i),h&&h.metadata||{type:"message"});g&&(this.cancelCallbacks[u]=g)}else this.processTask(u,i)}processTask(t,i){if(delete this.cancelCallbacks[t],i.type==="<response>"){const u=this.callbacks[t];delete this.callbacks[t],u&&(i.error?u(Ao(i.error)):u(null,Ao(i.data)))}else{const u=new Set,h=i.hasCallback?(x,b)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:x?Bl(x):null,data:Bl(b,u)},u)}:()=>{},g=Ao(i.data);if(this.parent[i.type])this.parent[i.type](i.sourceMapId,g,h);else if(this.parent.getWorkerSource){const x=i.type.split("."),{source:b,scope:j}=g;this.parent.getWorkerSource(i.sourceMapId,x[0],b,j)[x[1]](g,h)}else h(new Error(`Could not find function ${i.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var r_={workerUrl:"",workerClass:null,workerParams:void 0};const jj="mapboxgl_preloaded_worker_pool";class Op{constructor(){this.active={}}acquire(t,i=Op.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<i;)this.workers.push(r_.workerClass!=null?new r_.workerClass:new self.Worker(r_.workerUrl,r_.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach(i=>{i.terminate()}),this.workers=null)}isPreloaded(){return!!this.active[jj]}numActive(){return Object.keys(this.active).length}}Op.workerCount=2;class Vm{constructor(t,i,u="Worker",h=Op.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=ut();const g=this.workerPool.acquire(this.id,h);for(let x=0;x<g.length;x++){const b=new Vm.Actor(g[x],i,this.id);b.name=`${u} ${x}`,this.actors.push(b)}this.ready=!1,this.broadcast("checkIfReady",null,()=>{this.ready=!0})}broadcast(t,i,u){De(this.actors,(h,g)=>{h.send(t,i,g)},u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach(t=>{t.remove()}),this.actors=[],this.workerPool.release(this.id)}}let i_,Tj;function O1(){return i_||(i_=new Op),i_}Vm.Actor=_M;class OG{constructor(t){this.module=t}createIntArray(t){const i=new Int32Array(t),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heap32.set(i,u/i.BYTES_PER_ELEMENT),u}createFloatArray(t){const i=new Float32Array(t),u=this.module.malloc(i.length*i.BYTES_PER_ELEMENT);return this.module.heapF32.set(i,u/i.BYTES_PER_ELEMENT),u}createStringBuffer(t){const i=this.module.malloc(t.length+1);for(let u=0;u<t.length;++u)this.module.heapU8[i+u]=t.charCodeAt(u);return this.module.heapU8[i+t.length]=0,i}readStringBuffer(t){let i="";for(;this.module.heapU8[t]!==0;)i+=String.fromCharCode(this.module.heapU8[t]),++t;return i}setStyle(t){const i=t.entranceColorRgb,u=t.facadeGlazingColorRgb,h=t.roofColorRgb,g=t.wallColorRgb,x=t.normalScale;this.module.setStyle(i[0],i[1],i[2],u[0],u[1],u[2],h[0],h[1],h[2],g[0],g[1],g[2],x[0],x[1],x[2],t.tileToMeters)}setAOOptions(t,i){this.module.setAOOptions(t?1:0,i)}setMetricOptions(t,i){this.module.setMetricOptions(t?1:0,i)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,i){this.module.setFacadeOptions(t,i?1:0)}setFauxFacadeOptions(t,i,u){this.module.setFauxFacadeOptions(t?1:0,i?1:0,u)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,i){for(const b of t){const j=this.createStringBuffer(b.roofType),T=[0],A=[];for(const B of b.coordinates)if(Array.isArray(B)){for(const V of B)A.push(V.x),A.push(V.y);T.push(A.length)}const I=this.createIntArray(T),R=this.createFloatArray(A);this.module.addFeature(b.id,b.sourceId,b.minHeight,b.height,j,b.roofType.length,R,I,T.length-1),this.module.free(j),this.module.free(I),this.module.free(R)}for(const b of i){let j;j=b.entrances?JSON.parse(b.entrances):[];const T=this.createFloatArray(j),A=[];for(const R of b.coordinates)A.push(R.x),A.push(R.y);const I=this.createFloatArray(A);this.module.addFacade(b.sourceId,b.crossPerc,b.distanceToRoad,T,j.length,I,A.length),this.module.free(T),this.module.free(I)}if(!this.module.generateMesh()){const b=this.module.getLastError();return this.readStringBuffer(b)}const u=this.module.getMeshCount(),h=new Array(u);for(let b=0;b<u;b++){const j=this.module.getPositionsPtr(b),T=this.module.getPositionsLength(b),A=new Float32Array(this.module.heapF32.buffer,j,T),I=this.module.getNormalsPtr(b),R=this.module.getNormalsLength(b),B=new Float32Array(this.module.heapF32.buffer,I,R),V=this.module.getColorsPtr(b),K=this.module.getColorsLength(b),Q=new Uint8Array(this.module.heapU8.buffer,V,K),re=this.module.getAOPtr(b),ue=this.module.getAOLength(b),ce=new Float32Array(this.module.heapF32.buffer,re,ue),he=this.module.getUVPtr(b),Ee=this.module.getUVLength(b),we=new Float32Array(this.module.heapF32.buffer,he,Ee),je=this.module.getFauxFacadePtr(b),Me=this.module.getFauxFacadeLength(b),ke=new Uint8Array(this.module.heapU8.buffer,je,Me),Qe=this.module.getIndicesPtr(b),Fe=this.module.getIndicesLength(b),st=new Int32Array(this.module.heap32.buffer,Qe,Fe),Tt=this.module.getBuildingPart(b),lt=this.readStringBuffer(Tt);h[b]={positions:A,normals:B,colors:Q,ao:ce,uv:we,isFauxFacade:ke,indices:st,buildingPart:lt}}const g=this.module.getRingCount(),x=[];for(let b=0;b<g;b++){const j=this.module.getRingPtr(b),T=this.module.getRingLength(b),A=new Float32Array(this.module.heapF32.buffer,j,T);x.push(A)}return{meshes:h,modifiedPolygonRings:x}}}let o_,Nj,Ul,Um,Ej,$m=null,Gm=null,vM=null,F1=null;function bM(){return Ln(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Nj||Ii.DRACO_URL}function wM(){if(Ln(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(Um)return Um;const a=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return Um=WebAssembly.validate(a)?Ii.MESHOPT_SIMD_URL:Ii.MESHOPT_URL,Um}function FG(){return F1}const B1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},BG={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},a_={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function SM(a,t,i){const u=i.json.bufferViews.length,h=i.buffers.length;t.bufferView=u,i.json.bufferViews[u]={buffer:h,byteLength:a.byteLength},i.buffers[h]=a}const Cj="KHR_draco_mesh_compression";function VG(a,t){const i=a.extensions&&a.extensions[Cj];if(!i)return;const u=new Ul.Decoder,h=EM(t,i.bufferView),g=new Ul.Mesh;if(!u.DecodeArrayToMesh(h,h.byteLength,g))throw new Error("Failed to decode Draco mesh");const x=t.json.accessors[a.indices],b=B1[x.componentType],j=x.count*b.BYTES_PER_ELEMENT,T=Ul._malloc(j);b===Uint16Array?u.GetTrianglesUInt16Array(g,j,T):u.GetTrianglesUInt32Array(g,j,T),SM(Ul.memory.buffer.slice(T,T+j),x,t),Ul._free(T);for(const A of Object.keys(i.attributes)){const I=u.GetAttributeByUniqueId(g,i.attributes[A]),R=t.json.accessors[a.attributes[A]],B=BG[R.componentType],V=R.count*a_[R.type]*B1[R.componentType].BYTES_PER_ELEMENT,K=Ul._malloc(V);u.GetAttributeDataArrayForAllPoints(g,I,Ul[B],V,K),SM(Ul.memory.buffer.slice(K,K+V),R,t),Ul._free(K)}u.destroy(),g.destroy(),delete a.extensions[Cj]}const V1="EXT_meshopt_compression";function UG(a,t){if(!a.extensions||!a.extensions[V1])return;const i=a.extensions[V1],u=new Uint8Array(t.buffers[i.buffer],i.byteOffset||0,i.byteLength||0),h=new Uint8Array(i.count*i.byteStride);Ej.decodeGltfBuffer(h,i.count,i.byteStride,u,i.mode,i.filter),a.buffer=t.buffers.length,a.byteOffset=0,t.buffers[a.buffer]=h.buffer,delete a.extensions[V1]}const jM=1179937895,TM=new TextDecoder("utf8");function NM(a,t){return new URL(a,t).href}function $G(a,t,i,u){return fetch(NM(a.uri,u)).then(h=>h.arrayBuffer()).then(h=>{t.buffers[i]=h})}function EM(a,t){const i=a.json.bufferViews[t];return new Uint8Array(a.buffers[i.buffer],i.byteOffset||0,i.byteLength)}function GG(a,t,i,u){if(a.uri){const h=NM(a.uri,u);return fetch(h).then(g=>g.blob()).then(g=>createImageBitmap(g)).then(g=>{t.images[i]=g})}if(a.bufferView!==void 0){const h=EM(t,a.bufferView),g=new Blob([h],{type:a.mimeType});return createImageBitmap(g).then(x=>{t.images[i]=x})}}function CM(a,t=0,i){const u={json:null,images:[],buffers:[]};if(new Uint32Array(a,t,1)[0]===jM){const A=new Uint32Array(a,t);let I=2;const R=(A[I++]>>2)-3,B=A[I++]>>2;if(I++,u.json=JSON.parse(TM.decode(A.subarray(I,I+B))),I+=B,I<R){const V=A[I++];I++;const K=t+(I<<2);u.buffers[0]=a.slice(K,K+V)}}else u.json=JSON.parse(TM.decode(new Uint8Array(a,t)));const{buffers:h,images:g,meshes:x,extensionsUsed:b,bufferViews:j}=u.json;let T=Promise.resolve();if(h){const A=[];for(let I=0;I<h.length;I++){const R=h[I];R.uri?A.push($G(R,u,I,i)):u.buffers[I]||(u.buffers[I]=null)}T=Promise.all(A)}return T.then(()=>{const A=[],I=b&&b.includes(Cj),R=b&&b.includes(V1);if(I&&A.push(function(){if(!Ul)return o_??(o_=function(B){let V,K=null;function Q(){V=new Uint8Array(K.buffer)}function re(){throw new Error("Unexpected Draco error.")}const ue={a:{a:re,d:function(ce,he,Ee){return V.copyWithin(ce,he,he+Ee)},c:function(ce){const he=V.length,Ee=Math.max(ce>>>0,Math.ceil(1.2*he)),we=Math.ceil((Ee-he)/65536);try{return K.grow(we),Q(),!0}catch{return!1}},b:re}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(B,ue):B.then(ce=>ce.arrayBuffer()).then(ce=>WebAssembly.instantiate(ce,ue))).then(ce=>{const{Rb:he,Qb:Ee,P:we,T:je,X:Me,Ja:ke,La:Qe,Qa:Fe,Va:st,Wa:Tt,eb:lt,jb:gt,f:St,e:Ye,yb:_t,zb:Ve,Ab:Je,Bb:Ct,Db:vt,Gb:os}=ce.instance.exports;K=Ye;const Jt=(()=>{let ft=0,bt=0,ts=0,qt=0;return kt=>{ts&&(he(qt),he(ft),bt+=ts,ts=ft=0),ft||(bt+=128,ft=Ee(bt));const Zt=kt.length+7&-8;let xs=ft;Zt>=bt&&(ts=Zt,xs=qt=Ee(Zt));for(let As=0;As<kt.length;As++)V[xs+As]=kt[As];return xs}})();return Q(),St(),{memory:Ye,_free:he,_malloc:Ee,Mesh:class{constructor(){this.ptr=we()}destroy(){je(this.ptr)}},Decoder:class{constructor(){this.ptr=ke()}destroy(){gt(this.ptr)}DecodeArrayToMesh(ft,bt,ts){const qt=Jt(ft),kt=Qe(this.ptr,qt,bt,ts.ptr);return!!Me(kt)}GetAttributeByUniqueId(ft,bt){return{ptr:Fe(this.ptr,ft.ptr,bt)}}GetTrianglesUInt16Array(ft,bt,ts){st(this.ptr,ft.ptr,bt,ts)}GetTrianglesUInt32Array(ft,bt,ts){Tt(this.ptr,ft.ptr,bt,ts)}GetAttributeDataArrayForAllPoints(ft,bt,ts,qt,kt){lt(this.ptr,ft.ptr,bt.ptr,ts,qt,kt)}},DT_INT8:_t(),DT_UINT8:Ve(),DT_INT16:Je(),DT_UINT16:Ct(),DT_UINT32:vt(),DT_FLOAT32:os()}})}(fetch(bM())),o_.then(B=>{Ul=B,o_=void 0}))}()),R&&A.push(function(){if(Ej)return;const B=function(V){let K;const Q=WebAssembly.instantiateStreaming(V,{}).then(ce=>{K=ce.instance,K.exports.__wasm_call_ctors()}),re={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},ue={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:Q,supported:!0,decodeGltfBuffer(ce,he,Ee,we,je,Me){(function(ke,Qe,Fe,st,Tt,lt,gt){const St=ke.exports.sbrk,Ye=st+3&-4,_t=St(Ye*Tt),Ve=St(lt.length),Je=new Uint8Array(ke.exports.memory.buffer);Je.set(lt,Ve);const Ct=Qe(_t,st,Tt,Ve,lt.length);if(Ct===0&&gt&&gt(_t,Ye,Tt),Fe.set(Je.subarray(_t,_t+st*Tt)),St(_t-St(0)),Ct!==0)throw new Error(`Malformed buffer data: ${Ct}`)})(K,K.exports[ue[je]],ce,he,Ee,we,K.exports[re[Me]])}}}(fetch(wM()));return B.ready.then(()=>{Ej=B})}()),g)for(let B=0;B<g.length;B++)A.push(GG(g[B],u,B,i));return(A.length?Promise.all(A):Promise.resolve()).then(()=>{if(I&&x)for(const{primitives:B}of x)for(const V of B)VG(V,u);if(R&&x&&j)for(const B of j)UG(B,u);return u})})}function Aj(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function Pj(a){switch(a){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class Ij{constructor(t,i,u,h){this.context=t,this.format=u,this.useMipmap=h&&h.useMipmap,this.texture=t.gl.createTexture(),this.update(i,{premultiply:h&&h.premultiply})}update(t,i){const u=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,h=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:g}=this,{gl:x}=g,{x:b,y:j}=i&&i.position?i.position:{x:0,y:0},T=b+u,A=j+h;!this.size||this.size[0]===T&&this.size[1]===A||(x.bindTexture(x.TEXTURE_2D,null),x.deleteTexture(this.texture),this.texture=x.createTexture(),this.size=null),x.bindTexture(x.TEXTURE_2D,this.texture),g.pixelStoreUnpackFlipY.set(!1),g.pixelStoreUnpack.set(1),g.pixelStoreUnpackPremultiplyAlpha.set(this.format===x.RGBA8&&(!i||i.premultiply!==!1));const I=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&T>0&&A>0){const R=this.useMipmap?Math.floor(Math.log2(Math.max(T,A)))+1:1;x.texStorage2D(x.TEXTURE_2D,R,this.format,T,A),this.size=[T,A]}if(this.size)if(I)x.texSubImage2D(x.TEXTURE_2D,0,b,j,Aj(this.format),Pj(this.format),t);else{const R=t.data;R&&x.texSubImage2D(x.TEXTURE_2D,0,b,j,u,h,Aj(this.format),Pj(this.format),R)}this.useMipmap&&x.generateMipmap(x.TEXTURE_2D)}bind(t,i,u=!1){const{context:h}=this,{gl:g}=h;g.bindTexture(g.TEXTURE_2D,this.texture),t!==this.minFilter&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MAG_FILTER,t),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===g.NEAREST?g.NEAREST_MIPMAP_NEAREST:g.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),i!==this.wrapS&&(g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_S,i),g.texParameteri(g.TEXTURE_2D,g.TEXTURE_WRAP_T,i),this.wrapS=i)}bindExtraParam(t,i,u,h,g){const{context:x}=this,{gl:b}=x;b.bindTexture(b.TEXTURE_2D,this.texture),i!==this.magFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MAG_FILTER,i),this.magFilter=i),t!==this.minFilter&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_MIN_FILTER,this.useMipmap?t===b.NEAREST?b.NEAREST_MIPMAP_NEAREST:b.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_S,u),this.wrapS=u),h!==this.wrapT&&(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_WRAP_T,h),this.wrapT=h),g!==this.compareMode&&(g?(b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.COMPARE_REF_TO_TEXTURE),b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_FUNC,g)):b.texParameteri(b.TEXTURE_2D,b.TEXTURE_COMPARE_MODE,b.NONE),this.compareMode=g)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class l_{constructor(t,i){this.context=t,this.texture=i}bind(t,i){const{context:u}=this,{gl:h}=u;h.bindTexture(h.TEXTURE_2D,this.texture),t!==this.minFilter&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MAG_FILTER,t),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_MIN_FILTER,t),this.minFilter=t),i!==this.wrapS&&(h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_S,i),h.texParameteri(h.TEXTURE_2D,h.TEXTURE_WRAP_T,i),this.wrapS=i)}}const HG=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),WG=ln([{name:"a_color_3f",components:3,type:"Float32"}]),qG=ln([{name:"a_color_4f",components:4,type:"Float32"}]),ZG=ln([{name:"a_uv_2f",components:2,type:"Float32"}]),KG=ln([{name:"a_normal_3f",components:3,type:"Float32"}]),XG=ln([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),YG=ln([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function AM(a,t){const i=U1(a.projection,a.zoom,a.width,a.height),u=function(g,x,b,j,T){const A=new D(b.lng-180*qd,b.lat),I=new D(b.lng+180*qd,b.lat),R=g.project(A.lng,A.lat),B=g.project(I.lng,I.lat),V=-Math.atan2(B.y-R.y,B.x-R.x),K=be.fromLngLat(b);K.y=xe(K.y,-1+qd,1-qd);const Q=K.toLngLat(),re=g.project(Q.lng,Q.lat),ue=be.fromLngLat(Q);ue.x+=qd;const ce=ue.toLngLat(),he=g.project(ce.lng,ce.lat),Ee=IM(he.x-re.x,he.y-re.y,V),we=be.fromLngLat(Q);we.y+=qd;const je=we.toLngLat(),Me=g.project(je.lng,je.lat),ke=IM(Me.x-re.x,Me.y-re.y,V),Qe=Math.abs(Ee.x)/Math.abs(ke.y),Fe=H([]);Ne(Fe,Fe,-V*(1-(T?0:j)));const st=H([]);return q(st,st,[1,1-(1-Qe)*j,1]),st[4]=-ke.x/ke.y*j,Ne(st,st,V),Z(st,Fe,st),st}(a.projection,0,a.center,i,t),h=PM(a);return q(u,u,[h,h,1]),u}function PM(a){const t=a.projection,i=U1(a.projection,a.zoom,a.width,a.height),u=Mj(t,a.center),h=Mj(t,D.convert(t.center));return Math.pow(2,u*i+(1-i)*h)}function U1(a,t,i,u,h=1/0){const g=a.range;if(!g)return 0;const x=Math.min(h,Math.max(i,u)),b=Math.log(x/1024)/Math.LN2;return Re(g[0]+b,g[1]+b,t)}const qd=1/4e4;function Mj(a,t){const i=xe(t.lat,-ye,ye),u=new D(t.lng-180*qd,i),h=new D(t.lng+180*qd,i),g=a.project(u.lng,i),x=a.project(h.lng,i),b=be.fromLngLat(u),j=be.fromLngLat(h),T=x.x-g.x,A=x.y-g.y,I=j.x-b.x,R=j.y-b.y,B=Math.sqrt((I*I+R*R)/(T*T+A*A));return Math.log(B)/Math.LN2}function IM(a,t,i){const u=Math.cos(i),h=Math.sin(i);return{x:a*u-t*h,y:a*h+t*u}}function MM(a,t,i){H(a),Ne(a,a,Ks(t[2])),oe(a,a,Ks(t[0])),ae(a,a,Ks(t[1])),q(a,a,i),Z(a,a,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function $1(a,t,i,u,h,g,x,b){const j=[i[0]-t[0],i[1]-t[1],0],T=[u[0]-t[0],u[1]-t[1],0];if(Dt(j)<1e-12||Dt(T)<1e-12)return Ki(a);const A=It([],j,T);Ms(A,A),Bt(T,u,t),j[2]=(g-h)*b,T[2]=(x-h)*b;const I=j;return It(I,j,T),Ms(I,I),Va(a,A,I)}function Rj(a,t,i=!1){const u=Gd(t.zoom),h=function(g,x,b){const j=x.worldSize,T=[g[12],g[13],g[14]],A=de(T[1]/j),I=le(T[0]/j),R=H([]),B=te(1,A)*j,V=te(1,0)*j*Te(A,x.zoom),K=1/aj(j);let Q=V*K;if(b){const he=U1(x.projection,x.zoom,x.width,x.height,1024);Q=K*x.projection.pixelSpaceConversion(x.center.lat,j,he)}const re=N(A,I);Vt(re,re,nt([],Ms([],re),B*Q*T[2]));const ue=function(he){const Ee=[he[0],he[1],he[2]];let we=[0,1,0];const je=It([],we,Ee);return It(we,Ee,je),Ps(we)===0&&(we=[0,1,0],It(je,Ee,we)),Ms(je,je),Ms(we,we),Ms(Ee,Ee),[je[0],je[1],je[2],0,we[0],we[1],we[2],0,Ee[0],Ee[1],Ee[2],0,he[0],he[1],he[2],1]}(re);q(R,R,[Q,Q,Q*B]),W(R,R,[-T[0],-T[1],-T[2]]);const ce=Z([],x.globeMatrix,ue);return Z(ce,ce,R),Z(ce,ce,g),ce}(a,t,i);if(u>0){const g=function(x,b){const j=b.worldSize,T=te(1,0)*j*Te(b.center.lat,b.zoom)/aj(j),A=te(1,b.center.lat)*j,I=H([]);return ae(I,I,Ks(b.center.lng)),oe(I,I,Ks(b.center.lat)),W(I,I,[0,0,to]),q(I,I,[T,T,T*A]),W(I,I,[b.point.x-.5*j,b.point.y-.5*j,0]),Z(I,I,x),Z(I,b.globeMatrix,I)}(a,t);return function(x,b,j){const T=(V,K,Q)=>{const re=Dt(V),ue=Dt(K),ce=Ru(V,K,Q);return nt(ce,ce,1/Dt(ce)*fs(re,ue,Q))},A=T([x[0],x[1],x[2]],[b[0],b[1],b[2]],j),I=T([x[4],x[5],x[6]],[b[4],b[5],b[6]],j),R=T([x[8],x[9],x[10]],[b[8],b[9],b[10]],j),B=Ru([x[12],x[13],x[14]],[b[12],b[13],b[14]],j);return[A[0],A[1],A[2],0,I[0],I[1],I[2],0,R[0],R[1],R[2],0,B[0],B[1],B[2],1]}(h,g,u)}return h}function RM(a,t,i,u){const h=qs.projectAabbCorners(u,i);let g=Number.MAX_VALUE,x=-1;for(let T=0;T<h.length;++T){const A=h[T];A[0]=(.5*A[0]+.5)*t.width,A[1]=(.5-.5*A[1])*t.height,A[2]<g&&(x=T,g=A[2])}const b=T=>new et(h[T][0],h[T][1]);let j;switch(x){case 0:case 6:j=[b(1),b(5),b(4),b(7),b(3),b(2),b(1)];break;case 1:case 7:j=[b(0),b(4),b(5),b(6),b(2),b(3),b(0)];break;case 3:case 5:j=[b(1),b(0),b(4),b(7),b(6),b(2),b(1)];break;default:j=[b(1),b(5),b(6),b(7),b(3),b(0),b(1)]}if(zn(a,j))return g}const Fp=64,Hm={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function kM(a,t,i,u,h,g,x,b,j,T=!1){const A=i.zoom,I=i.project(u),R=Te(u.lat,A),B=1/R;H(a),W(a,a,[I.x+x[0]*B,I.y+x[1]*B,x[2]]);let V=1,K=1;const Q=i.worldSize;if(T){if(i.projection.name==="mercator"){let he=0;i.elevation&&(he=i.elevation.getAtPointOrZero(new be(I.x/Q,I.y/Q),0));const Ee=gi([],[I.x,I.y,he,1],i.projMatrix)[3]/i.cameraToCenterDistance;V=Ee,K=Ee*Te(i.center.lat,A)}else if(i.projection.name==="globe"){const he=Rj(a,i),Ee=[0,0,0,1];gi(Ee,Ee,Z([],i.projMatrix,he));const we=Ee[3]/i.cameraToCenterDistance,je=Gd(A),Me=i.projection.pixelsPerMeter(u.lat,Q)*Te(u.lat,A),ke=i.projection.pixelsPerMeter(i.center.lat,Q)*Te(i.center.lat,A);V=we/fs(Me,Se(i.center.lat),je),K=we*R/Me,V*=ke,K*=ke}}else V=B;q(a,a,[V,V,K]);const re=[...a],ue=t.orientation,ce=[];if(MM(ce,[ue[0]+h[0],ue[1]+h[1],ue[2]+h[2]],g),Z(a,re,ce),b&&i.elevation){let he=0;const Ee=[];if(j&&i.elevation){he=function(je,Me,ke,Qe,Fe){const st=Me.elevation;if(!st)return 0;const Tt=qs.projectAabbCorners(ke,Qe),lt=te(1,Fe.lat)*Me.worldSize,gt=function(bt,ts){const qt=[0,0,1],kt=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const Zt of kt){const xs=bt[Zt.corners[0]],As=bt[Zt.corners[1]],zs=bt[Zt.corners[2]],ks=[As[0]-xs[0],As[1]-xs[1],ts*(As[2]-xs[2])],on=It(ks,ks,[zs[0]-xs[0],zs[1]-xs[1],ts*(zs[2]-xs[2])]);Ms(on,on),Zt.dotProductWithUp=Xt(on,qt)}return kt.sort((Zt,xs)=>Zt.dotProductWithUp-xs.dotProductWithUp),kt[0].corners}(Tt,lt),St=Tt[gt[0]],Ye=Tt[gt[1]],_t=Tt[gt[2]],Ve=Tt[gt[3]],Je=st.getAtPointOrZero(new be(St[0]/Me.worldSize,St[1]/Me.worldSize),0),Ct=st.getAtPointOrZero(new be(Ye[0]/Me.worldSize,Ye[1]/Me.worldSize),0),vt=st.getAtPointOrZero(new be(_t[0]/Me.worldSize,_t[1]/Me.worldSize),0),os=st.getAtPointOrZero(new be(Ve[0]/Me.worldSize,Ve[1]/Me.worldSize),0),Jt=(Je+os)/2,ft=(Ct+vt)/2;return Jt>ft?Ct<vt?$1(je,Ye,Ve,St,Ct,os,Je,lt):$1(je,_t,St,Ve,vt,Je,os,lt):Je<os?$1(je,St,Ye,_t,Je,Ct,vt,lt):$1(je,Ve,_t,Ye,os,vt,Ct,lt),Math.max(Jt,ft)}(Ee,i,t.aabb,a,u);const we=Z([],ct([],Ee),ce);Z(a,re,we)}else he=i.elevation.getAtPointOrZero(new be(I.x/Q,I.y/Q),0);he!==0&&(a[14]+=he)}}function c_(a,t,i=!1){a.uploaded||(a.gfxTexture=new Ij(t,a.image,i?t.gl.R8:t.gl.RGBA8,{useMipmap:a.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),a.uploaded=!0,a.image=null)}function JG(a,t,i){a.indexBuffer=t.createIndexBuffer(a.indexArray,!1,!0),a.vertexBuffer=t.createVertexBuffer(a.vertexArray,HG.members,!1,!0),a.normalArray&&(a.normalBuffer=t.createVertexBuffer(a.normalArray,KG.members,!1,!0)),a.texcoordArray&&(a.texcoordBuffer=t.createVertexBuffer(a.texcoordArray,ZG.members,!1,!0)),a.colorArray&&(a.colorBuffer=t.createVertexBuffer(a.colorArray,(a.colorArray.bytesPerElement===12?WG:qG).members,!1,!0)),a.featureArray&&(a.pbrBuffer=t.createVertexBuffer(a.featureArray,YG.members,!0)),a.segments=mr.simpleSegment(0,0,a.vertexArray.length,a.indexArray.length);const u=a.material;u.pbrMetallicRoughness.baseColorTexture&&c_(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&c_(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&c_(u.normalTexture,t),u.occlusionTexture&&c_(u.occlusionTexture,t,i),u.emissionTexture&&c_(u.emissionTexture,t)}function kj(a,t,i){if(a.meshes)for(const u of a.meshes)JG(u,t,i);if(a.children)for(const u of a.children)kj(u,t,i)}function G1(a){if(a.meshes)for(const t of a.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(a.children)for(const t of a.children)G1(t)}function Dj(a){if(a.meshes)for(const i of a.meshes)i.vertexBuffer&&(i.vertexBuffer.destroy(),i.indexBuffer.destroy(),i.normalBuffer&&i.normalBuffer.destroy(),i.texcoordBuffer&&i.texcoordBuffer.destroy(),i.colorBuffer&&i.colorBuffer.destroy(),i.pbrBuffer&&i.pbrBuffer.destroy(),i.segments.destroy(),i.material&&((t=i.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(a.children)for(const i of a.children)Dj(i)}function Bp(a,t){const i=a.json.bufferViews[t.bufferView],u=B1[t.componentType];return new u(a.buffers[i.buffer],(t.byteOffset||0)+(i.byteOffset||0),t.count*(i.byteStride&&i.byteStride!==a_[t.type]*u.BYTES_PER_ELEMENT?i.byteStride/u.BYTES_PER_ELEMENT:a_[t.type]))}function Lj(a,t,i,u){const h=B1[t.componentType],g=function(A){switch(A){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}}(h),x=a.json.bufferViews[t.bufferView],b=x.byteStride?x.byteStride/h.BYTES_PER_ELEMENT:a_[t.type],j=i.float32,T=j.length/i.capacity;for(let A=0,I=0;A<t.count*b;A+=b,I+=T)for(let R=0;R<T;R++)j[I+R]=u[A+R]*g;i._trim()}function QG(a,t,i){const u=a.indices,h=a.attributes,g={};g.indexArray=new ur;const x=t.json.accessors[u],b=x.count/3;g.indexArray.reserve(b);const j=Bp(t,x);for(let R=0;R<b;R++)g.indexArray.emplaceBack(j[3*R],j[3*R+1],j[3*R+2]);g.indexArray._trim(),g.vertexArray=new na;const T=t.json.accessors[h.POSITION];g.vertexArray.reserve(T.count);const A=Bp(t,T);for(let R=0;R<T.count;R++)g.vertexArray.emplaceBack(A[3*R],A[3*R+1],A[3*R+2]);if(g.vertexArray._trim(),g.aabb=new qs(T.min,T.max),g.centroid=function(R,B){const V=[0,0,0],K=R.length;if(K>0){for(let Q=0;Q<K;Q++){const re=3*R[Q];V[0]+=B[re],V[1]+=B[re+1],V[2]+=B[re+2]}V[0]/=K,V[1]/=K,V[2]/=K}return V}(j,A),h.COLOR_0!==void 0){const R=t.json.accessors[h.COLOR_0],B=a_[R.type],V=Bp(t,R);g.colorArray=B===3?new na:new Dc,g.colorArray.resize(R.count),Lj(t,R,g.colorArray,V)}if(h.NORMAL!==void 0){g.normalArray=new na;const R=t.json.accessors[h.NORMAL];g.normalArray.resize(R.count);const B=Bp(t,R);Lj(t,R,g.normalArray,B)}if(h.TEXCOORD_0!==void 0&&i.length>0){g.texcoordArray=new Lc;const R=t.json.accessors[h.TEXCOORD_0];g.texcoordArray.resize(R.count);const B=Bp(t,R);Lj(t,R,g.texcoordArray,B)}if(h._FEATURE_ID_RGBA4444!==void 0){const R=t.json.accessors[h._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(g.featureData=Bp(t,R))}h._FEATURE_RGBA4444!==void 0&&(g.featureData=new Uint32Array(Bp(t,t.json.accessors[h._FEATURE_RGBA4444]).buffer));const I=a.material;return g.material=function(R,B){const{emissiveFactor:V=[0,0,0],alphaMode:K="OPAQUE",alphaCutoff:Q=.5,normalTexture:re,occlusionTexture:ue,emissiveTexture:ce,doubleSided:he}=R,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:we=1,roughnessFactor:je=1,baseColorTexture:Me,metallicRoughnessTexture:ke}=R.pbrMetallicRoughness||{},Qe=ue?B[ue.index]:void 0;if(ue&&ue.extensions&&ue.extensions.KHR_texture_transform&&Qe){const Fe=ue.extensions.KHR_texture_transform;Qe.offsetScale=[Fe.offset[0],Fe.offset[1],Fe.scale[0],Fe.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new En(...Ee),metallicFactor:we,roughnessFactor:je,baseColorTexture:Me?B[Me.index]:void 0,metallicRoughnessTexture:ke?B[ke.index]:void 0},doubleSided:he,emissiveFactor:new En(...V),alphaMode:K,alphaCutoff:Q,normalTexture:re?B[re.index]:void 0,occlusionTexture:Qe,emissionTexture:ce?B[ce.index]:void 0,defined:R.defined===void 0}}(I!==void 0?t.json.materials[I]:{defined:!1},i),g}function DM(a,t,i){const{matrix:u,rotation:h,translation:g,scale:x,mesh:b,extras:j,children:T}=a,A={};if(A.matrix=u||function(I,R,B,V){var K=R[0],Q=R[1],re=R[2],ue=R[3],ce=K+K,he=Q+Q,Ee=re+re,we=K*ce,je=K*he,Me=K*Ee,ke=Q*he,Qe=Q*Ee,Fe=re*Ee,st=ue*ce,Tt=ue*he,lt=ue*Ee,gt=V[0],St=V[1],Ye=V[2];return I[0]=(1-(ke+Fe))*gt,I[1]=(je+lt)*gt,I[2]=(Me-Tt)*gt,I[3]=0,I[4]=(je-lt)*St,I[5]=(1-(we+Fe))*St,I[6]=(Qe+st)*St,I[7]=0,I[8]=(Me+Tt)*Ye,I[9]=(Qe-st)*Ye,I[10]=(1-(we+ke))*Ye,I[11]=0,I[12]=B[0],I[13]=B[1],I[14]=B[2],I[15]=1,I}([],h||[0,0,0,1],g||[0,0,0],x||[1,1,1]),b!==void 0){A.meshes=i[b];const I=A.anchor=[0,0];for(const R of A.meshes){const{min:B,max:V}=R.aabb;I[0]+=B[0]+V[0],I[1]+=B[1]+V[1]}I[0]=Math.floor(I[0]/A.meshes.length/2),I[1]=Math.floor(I[1]/A.meshes.length/2)}if(j&&(j.id&&(A.id=j.id),j.lights&&(A.lights=function(I){if(!I.length)return[];const R=function(re){const ue=atob(re),ce=new Uint8Array(ue.length);for(let he=0;he<ue.length;he++)ce[he]=ue.codePointAt(he);return ce}(I),B=[],V=R.length/24,K=new Uint16Array(R.buffer),Q=new Float32Array(R.buffer);for(let re=0;re<V;re++){const ue=K[2*re*6]/30,ce=K[2*re*6+1]/30,he=K[2*re*6+10]/100,Ee=Q[6*re+1],we=Q[6*re+2],je=Q[6*re+3],Me=Q[6*re+4],ke=je-Ee,Qe=Me-we,Fe=Math.hypot(ke,Qe);B.push({pos:[Ee+.5*ke,we+.5*Qe,ce],normal:[Qe/Fe,-ke/Fe,0],width:Fe,height:ue,depth:he,points:[Ee,we,je,Me]})}return B}(j.lights))),T){const I=[];for(const R of T)I.push(DM(t.json.nodes[R],t,i));A.children=I}return A}function e7(a){if(a.vertices.length===0||a.indices.length===0)return null;const t=new M1(a.vertices,a.indices,8,256),[i,u]=[t.min.clone(),t.max.clone()];return{vertices:a.vertices,indices:a.indices,grid:t,min:i,max:u}}function t7(a){if(!a.extras||!a.extras.ground)return null;const t=a.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const i=t[0];if(!i||!Array.isArray(i)||i.length===0)return null;const u=[];for(const x of i){if(!Array.isArray(x)||x.length!==2)continue;const b=x[0],j=x[1];typeof b=="number"&&typeof j=="number"&&u.push(new et(b,j))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let h=0;for(let x=0;x<u.length;x++){const b=u[x],j=u[(x+1)%u.length],T=u[(x+2)%u.length];h+=(b.x-j.x)*(T.y-j.y)-(T.x-j.x)*(b.y-j.y)}h>0&&u.reverse();const g=Fm(u.flatMap(x=>[x.x,x.y]),[]);return g.length===0?null:{vertices:u,indices:g}}function s7(a,t){const i=[],u=[];let h=0;const g=[];for(const x of a){h=i.length;const b=x.vertexArray.float32,j=x.indexArray.uint16;for(let T=0;T<x.vertexArray.length;T++)g[0]=b[3*T+0],g[1]=b[3*T+1],g[2]=b[3*T+2],ws(g,g,t),i.push(new et(g[0],g[1]));for(let T=0;T<3*x.indexArray.length;T++)u.push(j[T]+h)}if(u.length%3!=0)return null;for(let x=0;x<u.length;x+=3){const b=i[u[x+0]],j=i[u[x+1]],T=i[u[x+2]];(b.x-j.x)*(T.y-j.y)-(T.x-j.x)*(b.y-j.y)>0&&([u[x+1],u[x+2]]=[u[x+2],u[x+1]])}return{vertices:i,indices:u}}function LM(a){const t=function(j,T){const A=[],I=WebGL2RenderingContext;if(j.json.textures)for(const R of j.json.textures){const B={magFilter:I.LINEAR,minFilter:I.NEAREST,wrapS:I.REPEAT,wrapT:I.REPEAT};R.sampler!==void 0&&Object.assign(B,j.json.samplers[R.sampler]),A.push({image:T[R.source],sampler:B,uploaded:!1})}return A}(a,a.images),i=function(j,T){const A=[];for(const I of j.json.meshes){const R=[];for(const B of I.primitives)R.push(QG(B,j,T));A.push(R)}return A}(a,t),{scenes:u,scene:h,nodes:g}=a.json,x=u?u[h||0].nodes:g,b=[];for(const j of x)b.push(DM(g[j],a,i));return function(j,T,A){const I={},R=new Set;for(let B=0;B<j.length;B++){const V=A[T[B]];if(!V.extras)continue;const K=V.extras["mapbox:footprint:version"],Q=V.extras["mapbox:footprint:id"];(K||Q)&&R.add(B),K==="1.0.0"&&Q&&(I[Q]=B)}for(let B=0;B<j.length;B++){if(R.has(B))continue;const V=j[B],K=A[T[B]];if(!K.extras)continue;let Q=null;V.id in I&&(Q=s7(j[I[V.id]].meshes,V.matrix)),Q||(Q=t7(K)),Q&&(V.footprint=e7(Q))}if(R.size>0){const B=Array.from(R.values()).sort((V,K)=>V-K);for(let V=B.length-1;V>=0;V--)j.splice(B[V],1)}}(b,x,a.json.nodes),b}function n7(a){a.heightmap=new Float32Array(4096),a.heightmap.fill(-1);const t=a.vertexArray.float32,i=a.aabb.min[0]-1,u=a.aabb.min[1]-1,h=Fp/(a.aabb.max[0]-i+2),g=Fp/(a.aabb.max[1]-u+2);for(let x=0;x<t.length;x+=3){const b=t[x+2],j=(t[x+0]-i)*h|0,T=(t[x+1]-u)*g|0;b>a.heightmap[T*Fp+j]&&(a.heightmap[T*Fp+j]=b)}}function zM(a,t,i,u,h){i.reserve(i.length+4*a.length),u.reserve(u.length+10*a.length),h.reserve(h.length+10*a.length);let g=u.length;for(const x of a){const b=Math.min(10,Math.max(4,1.3*x.height))*t,j=[-x.normal[1],x.normal[0],0],T=Math.min(.29,.1*x.width/x.depth),A=x.width-2*x.depth*t*(T+.01),I=Mt([],x.pos,j,A/2),R=Mt([],x.pos,j,-A/2),B=[I[0],I[1],I[2]+x.height],V=[R[0],R[1],R[2]+x.height],K=Mt([],x.normal,j,T);nt(K,K,b);const Q=Mt([],x.normal,j,-T);nt(Q,Q,b),Vt(K,I,K),Vt(Q,R,Q),I[2]+=.1,R[2]+=.1,u.emplaceBack(K[0],K[1],K[2]),u.emplaceBack(Q[0],Q[1],Q[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(V[0],V[1],V[2]),u.emplaceBack(I[0],I[1],I[2]),u.emplaceBack(R[0],R[1],R[2]),u.emplaceBack(K[0],K[1],K[2]),u.emplaceBack(Q[0],Q[1],Q[2]);const re=A/b/2;h.emplaceBack(-re-T,-1,re,.8),h.emplaceBack(re+T,-1,re,.8),h.emplaceBack(-re,0,re,1.3),h.emplaceBack(re,0,re,1.3),h.emplaceBack(re+T,-.8,re,.7),h.emplaceBack(re+T,-.8,re,.7),h.emplaceBack(0,0,re,1.3),h.emplaceBack(0,0,re,1.3),h.emplaceBack(re+T,-1.2,re,.8),h.emplaceBack(re+T,-1.2,re,.8),i.emplaceBack(6+g,4+g,8+g),i.emplaceBack(7+g,9+g,5+g),i.emplaceBack(0+g,1+g,2+g),i.emplaceBack(1+g,3+g,2+g),g+=10}}function r7(a,t){const i={};i.indexArray=new ur,i.vertexArray=new na,i.colorArray=new Dc,zM(a,t,i.indexArray,i.vertexArray,i.colorArray);const u={defined:!0};u.emissiveFactor=En.black;const h={};return h.baseColorFactor=En.white,u.pbrMetallicRoughness=h,i.material=u,i.aabb=new qs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),i}const OM=ln([{name:"a_pos_3f",components:3,type:"Float32"}]),i7=ln([{name:"a_normal_3",components:3,type:"Int16"}]),FM=ln([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),o7=ln([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),BM=Ge.types,zj=32767;function a7(a,t){const i=Rt+t;for(const u of a)for(const h of u)if(h.x<-t||h.x>i||h.y<-t||h.y>i)return!1;return!0}class VM{constructor(t){this.layoutAOArray=[],this.indexArrayForConflationUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.layoutVertexArray=new na,this.layoutNormalArray=new Md,this.layoutColorArray=new gl,this.indexArray=new ur,this.indexArrayForConflation=new ur,this.entranceBloom={layoutVertexArray:new na,layoutVertexBuffer:null,layoutAttenuationArray:new Dc,layoutAttenuationBuffer:null,layoutColorArray:new gl,layoutColorBuffer:null,indexArray:new ur,indexArrayForConflation:new ur,indexBuffer:null,segmentsBucket:new mr},this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut}),this.segmentsBucket=new mr,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.projection=t.projection,this.groundEffect=new wj(t)}get segments(){return this.segmentsBucket}get bloomGeometry(){return this.entranceBloom}updateFootprints(t,i){for(const u of this.footprints)i.push({footprint:u,id:t})}prepare(){return function(){if(F1!=null||vM!=null)return null;if(Gm!=null)return Gm;const t=fetch(Ii.BUILDING_GEN_URL);return Gm=function(i){let u,h,g,x;function b(){u=new Uint8Array(x.buffer),h=new Int32Array(x.buffer),g=new Float32Array(x.buffer)}function j(){throw new Error("Unexpected BuildingGen error.")}const T=()=>{},A={a:{a:j,f:function(I){const R=u.length,B=Math.max(I>>>0,Math.ceil(1.2*R)),V=Math.ceil((B-R)/65536);try{return x.grow(V),b(),!0}catch{return!1}},g:j,b:T,c:T,d:T,e:T}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(i,A):i.then(I=>I.arrayBuffer()).then(I=>WebAssembly.instantiate(I,A))).then(I=>{const R=I.instance.exports;return(0,R.g)(),x=R.f,b(),new OG({setStyle:R.h,setAOOptions:R.i,setMetricOptions:R.j,setStructuralOptions:R.k,setFacadeOptions:R.l,setFauxFacadeOptions:R.m,setFacadeClassifierOptions:R.n,addFeature:R.o,addFacade:R.p,generateMesh:R.q,getLastError:R.r,getMeshCount:R.s,getPositionsPtr:R.t,getPositionsLength:R.u,getNormalsPtr:R.v,getNormalsLength:R.w,getColorsPtr:R.x,getColorsLength:R.y,getAOPtr:R.z,getAOLength:R.A,getUVPtr:R.B,getUVLength:R.C,getFauxFacadePtr:R.D,getFauxFacadeLength:R.E,getIndicesPtr:R.F,getIndicesLength:R.G,getBuildingPart:R.H,getRingCount:R.I,getRingPtr:R.J,getRingLength:R.K,free:R.L,malloc:R.M,heapU8:u,heap32:h,heapF32:g})})}(t).then(i=>(Gm=null,F1=i,F1)).catch(i=>{rn("Could not load building-gen"),Gm=null,vM=i}),Gm}()}populate(t,i,u,h){const g=FG();if(!g)return;const x=ve(u);this.tileToMeter=x,this.brightness=i.brightness,g.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,x],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:x,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),g.setAOOptions(!1,.3),g.setMetricOptions(!1,16),g.setStructuralOptions(!0),g.setFacadeOptions(4,!0),g.setFauxFacadeOptions(!1,!1,1),g.setFacadeClassifierOptions(3);const b=new Map;for(const{feature:j}of t){if(BM[j.type]!=="LineString")continue;const T=this.layers[0]._featureFilter.needGeometry,A=Ke(j,T);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),A,u))continue;const I=T?A.geometry:Ae(j,u,h),R=[];for(const Q of I)for(const re of Q)R.push({x:re.x,y:re.y});const B={coordinates:R,crossPerc:j.properties.cross_perc,distanceToRoad:j.properties.distance_to_road,entrances:j.properties.entrances,sourceId:0},V=j.properties.source_id;let K=b.get(V);K||(K=[],b.set(V,K)),K.push(B)}this.maxHeight=0;for(const{feature:j,index:T}of t){if(BM[j.type]==="LineString")continue;const A=this.layers[0]._featureFilter.needGeometry,I=Ke(j,A);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom),I,u))continue;const R=A?I.geometry:Ae(j,u,h),B=Jy(R,500);if(!a7(R,163))continue;const V=this.layers[0],K=V.layout.get("building-base").evaluate(j,{},u),Q=V.layout.get("building-height").evaluate(j,{},u),re=V.layout.get("building-roof-shape").evaluate(j,{},u),ue=V.paint.get("building-ambient-occlusion-intensity"),ce=V.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(re==="flat")continue;const he=j.properties.source_id;let Ee;Ee=b.has(he)?b.get(he):[];const we=[],je=new et(1/0,1/0),Me=new et(-1/0,-1/0);for(const ft of B)if(ft.length>0){const bt=[];for(const ts of ft){const qt=[];for(let kt=ts.length-1;kt>=0;kt--){const Zt=ts[kt];qt.push({x:Zt.x,y:Zt.y}),je.x=Math.min(je.x,Zt.x),je.y=Math.min(je.y,Zt.y),Me.x=Math.max(Me.x,Zt.x),Me.y=Math.max(Me.y,Zt.y)}bt.push(qt)}we.push({id:j.id,height:Q,minHeight:K,sourceId:0,roofType:re,coordinates:bt})}const ke=g.generateMesh(we,Ee);if(typeof ke=="string"||ke.meshes.length===0||ke.modifiedPolygonRings.length===0)continue;let Qe=0;for(const ft of ke.meshes)Qe+=ft.positions.length/3;const Fe=this.segmentsBucket.prepareSegment(Qe,this.layoutVertexArray,this.indexArray),st=[];let Tt=null,lt=0,gt=-1;const St=this.indexArray.length;let Ye=0;for(const ft of ke.meshes){const bt=this.layoutVertexArray.length;if(ft.buildingPart==="entrance"){const qt=new Array;for(let As=0;As<ft.indices.length;As+=12){const zs=ft.positions[As+0],ks=ft.positions[As+1],on=ft.positions[As+3],Gs=ft.positions[As+4],nr=ft.positions[As+2],me=ft.positions[As+8]-nr,ge=1,Ze=on-zs,At=Gs-ks,Ft=Math.hypot(Ze,At);qt.push({pos:[zs+.5*Ze,ks+.5*At,nr],normal:[At/Ft,-Ze/Ft,0],width:Ft,height:me,depth:ge,points:[zs,ks,on,Gs]})}const kt=this.entranceBloom.segmentsBucket.prepareSegment(10*qt.length,this.entranceBloom.layoutVertexArray,this.entranceBloom.indexArray),Zt=this.entranceBloom.layoutVertexArray.length;lt=this.entranceBloom.indexArray.length,zM(qt,.5/this.tileToMeter,this.entranceBloom.indexArray,this.entranceBloom.layoutVertexArray,this.entranceBloom.layoutAttenuationArray);const xs=this.entranceBloom.layoutVertexArray.length-Zt;gt=this.entranceBloom.indexArray.length-lt;for(let As=0;As<xs;As++)this.entranceBloom.layoutColorArray.emplaceBack(65535,65535);kt.vertexLength+=xs,kt.primitiveLength+=gt,Tt={part:ft.buildingPart,vertexOffset:Zt,vertexLength:xs}}for(let qt=0;qt<ft.positions.length;qt+=3)Ye=Math.max(Ye,ft.positions[qt+2]),this.layoutVertexArray.emplaceBack(ft.positions[qt],ft.positions[qt+1],ft.positions[qt+2]);for(let qt=0;qt<ft.normals.length;qt+=3)this.layoutNormalArray.emplaceBack(ft.normals[qt+0]*zj,ft.normals[qt+1]*zj,ft.normals[qt+2]*zj);for(let qt=0;qt<ft.ao.length;qt++)this.layoutAOArray.push(ft.ao[qt]);for(let qt=0;qt<ft.colors.length;qt+=3){const kt=1+(ft.ao[qt/3]-1)*ue;this.layoutColorArray.emplaceBack(ft.colors[qt]*kt<<8|ft.colors[qt+1]*kt,ft.colors[qt+2]*kt<<8)}const ts=Fe.vertexLength;for(let qt=0;qt<ft.indices.length;qt+=3)this.indexArray.emplaceBack(ts+ft.indices[qt],ts+ft.indices[qt+1],ts+ft.indices[qt+2]);Fe.vertexLength+=ft.positions.length/3,Fe.primitiveLength+=ft.indices.length/3,(ft.buildingPart==="roof"||ft.buildingPart==="wall"||ft.buildingPart==="facade_glazing"||ft.buildingPart==="entrance")&&st.push({part:ft.buildingPart,vertexOffset:bt,vertexLength:ft.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,Ye),this.buildingFeatures.push({feature:I,segment:Fe,parts:st,buildingBloom:Tt});const _t=this.indexArray.length-St,Ve=[],Je=[],Ct=new et(1/0,1/0),vt=new et(-1/0,-1/0),os=this.groundEffect.vertexArray.length;for(const ft of ke.modifiedPolygonRings){const bt=[],ts=new et(1/0,1/0),qt=new et(-1/0,-1/0);for(let kt=0;kt<ft.length;kt+=2){const Zt=ft.length-kt-2;ts.x=Math.min(ts.x,ft[Zt]),ts.y=Math.min(ts.y,ft[Zt+1]),qt.x=Math.max(qt.x,ft[Zt]),qt.y=Math.max(qt.y,ft[Zt+1]);const xs=new et(ft[Zt],ft[Zt+1]);bt.push(xs),Ve.push(xs.x,xs.y),Je.push(xs.clone())}Ct.x=Math.min(Ct.x,ts.x),Ct.y=Math.min(Ct.y,ts.y),vt.x=Math.max(vt.x,qt.x),vt.y=Math.max(vt.y,qt.y),this.groundEffect.addData(bt,[ts,qt],ce)}const Jt=this.groundEffect.vertexArray.length-os;(je.x<0||Me.x>Rt||je.y<0||Me.y>Rt)&&this.featuresOnBorder.push({featureId:j.id,footprintIndex:this.footprints.length});{const ft=Fm(Ve,null,2),bt=new M1(Je,ft,8,256);let ts=j.id;j.properties&&j.properties.hasOwnProperty("building_id")&&(ts=j.properties.building_id),this.footprints.push({vertices:Je,indices:ft,grid:bt,min:Ct,max:vt,buildingId:ts,hiddenFlags:0,indicesOffset:St,indicesLength:_t,bloomIndicesOffset:lt,bloomIndicesLength:gt,groundEffectVertexOffset:os,groundEffectVertexLength:Jt,segment:Fe,height:Ye})}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,j,T,{},i.availableImages,u,i.brightness),this.groundEffect.addPaintPropertiesData(j,T,{},i.availableImages,u,i.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0])}update(t,i,u,h,g,x,b){this.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b),this.groundEffect.update(t,i,g,u,h,x,b)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,OM.members),this.layoutNormalBuffer=t.createVertexBuffer(this.layoutNormalArray,i7.members),this.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(this.entranceBloom.layoutVertexArray,OM.members),this.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(this.entranceBloom.layoutAttenuationArray,o7.members),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.layoutNormalBuffer.destroy(),this.layoutColorBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segmentsBucket.destroy(),this.entranceBloom.layoutVertexBuffer.destroy(),this.entranceBloom.layoutColorBuffer.destroy(),this.entranceBloom.layoutAttenuationBuffer.destroy(),this.entranceBloom.indexBuffer.destroy(),this.entranceBloom.segmentsBucket.destroy())}updateFootprintHiddenFlags(t,i,u=!0){let h=!1;const g=u?i:0,x=0|(u?-1:~i);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const b of t){const j=this.footprints[b],T=j.hiddenFlags&x|g;j.hiddenFlags!==T&&(j.hiddenFlags=T,h=!0,this.groundEffect.updateHiddenByLandmarkRange(j.groundEffectVertexOffset,j.groundEffectVertexLength,j.hiddenFlags!==0))}return h&&(this.indexArrayForConflationUploaded=!1),h}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),!this.indexArrayForConflationUploaded&&this.indexArray.length!==0){this.indexArrayForConflation.resize(this.indexArray.length),this.indexArrayForConflation.uint16.set(this.indexArray.uint16),this.entranceBloom.indexArrayForConflation.resize(this.entranceBloom.indexArray.length),this.entranceBloom.indexArrayForConflation.uint16.set(this.entranceBloom.indexArray.uint16);for(const i of this.footprints){const u=i.indicesOffset+i.indicesLength;if(i.hiddenFlags!==0){for(let g=i.indicesOffset;g<u;g++)this.indexArrayForConflation.uint16[3*g+0]=0,this.indexArrayForConflation.uint16[3*g+1]=0,this.indexArrayForConflation.uint16[3*g+2]=0;const h=i.bloomIndicesOffset+i.bloomIndicesLength;for(let g=i.bloomIndicesOffset;g<h;g++)this.entranceBloom.indexArrayForConflation.uint16[3*g+0]=0,this.entranceBloom.indexArrayForConflation.uint16[3*g+1]=0,this.entranceBloom.indexArrayForConflation.uint16[3*g+2]=0}}this.indexBuffer?this.indexBuffer.updateData(this.indexArrayForConflation):this.indexBuffer=t.createIndexBuffer(this.indexArrayForConflation,!0),this.entranceBloom.indexBuffer?this.entranceBloom.indexBuffer.updateData(this.entranceBloom.indexArrayForConflation):this.entranceBloom.indexBuffer=t.createIndexBuffer(this.entranceBloom.indexArrayForConflation,!0),this.indexArrayForConflationUploaded=!0}}uploadUpdatedColorBuffer(t){this.layoutColorBuffer?this.layoutColorBuffer.updateData(this.layoutColorArray):this.layoutColorBuffer=t.createVertexBuffer(this.layoutColorArray,FM.members,!0),this.entranceBloom.layoutColorBuffer?this.entranceBloom.layoutColorBuffer.updateData(this.entranceBloom.layoutColorArray):this.entranceBloom.layoutColorBuffer=t.createVertexBuffer(this.entranceBloom.layoutColorArray,FM.members,!0)}evaluate(t){const i=t.paint.get("building-ambient-occlusion-intensity");for(const u of this.buildingFeatures){const h=u.feature;h.properties["building-part"]="roof";const g=t.paint.get("building-color").evaluate(h,{},this.canonical),x=t.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="wall";const b=t.paint.get("building-color").evaluate(h,{},this.canonical),j=t.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="window";const T=t.paint.get("building-color").evaluate(h,{},this.canonical),A=t.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);h.properties["building-part"]="door";const I=t.paint.get("building-color").evaluate(h,{},this.canonical),R=t.paint.get("building-emissive-strength").evaluate(h,{},this.canonical);for(const V of u.parts){let K,Q=g;V.part==="roof"?(Q=g,K=x):V.part==="wall"?(Q=b,K=j):V.part==="facade_glazing"?(Q=T,K=A):V.part==="entrance"&&(Q=I,K=R),K=xe(K,0,1);for(let re=0;re<V.vertexLength;re++){const ue=V.vertexOffset+re,ce=1+(this.layoutAOArray[ue]-1)*i;this.layoutColorArray.emplace(ue,Q.r*ce*255<<8|Q.g*ce*255,Q.b*ce*255<<8|255*K)}}const B=u.buildingBloom;if(B)for(let V=0;V<B.vertexLength;V++)this.bloomGeometry.layoutColorArray.emplace(B.vertexOffset+V,255*I.r<<8|255*I.g,255*I.b<<8|51*R)}}needsEvaluation(t,i){const u=t.transform.projectionOptions,h=t.style.getBrightness();return!(this.uploaded&&u.name===this.projection.name&&this.brightness===h||(this.projection=u,this.brightness=h,0))}updateReplacement(t,i,u){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const h=i.getReplacementRegionsForTile(t.toUnwrapped());if(k1(this.activeReplacements,h))return;this.activeReplacements=h;for(const x of this.footprints)x.hiddenFlags&=-2;const g=[];for(const x of this.activeReplacements){if(x.order<=WI)continue;const b=Math.max(1,Math.pow(2,x.footprintTileId.canonical.z-t.canonical.z));for(const j of this.footprints)j.min.x>x.max.x||j.max.x<x.min.x||j.min.y>x.max.y||j.max.y<x.min.y||(g.length=0,l7(j.vertices,0,j.vertices.length,x.footprintTileId.canonical,t.canonical,g),yj(x.footprint,g,j.indices,0,j.indices.length,0,-b)&&(j.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const x of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(x.groundEffectVertexOffset,x.groundEffectVertexLength,x.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(t,i){let u=Number.NEGATIVE_INFINITY,h=!0;const g=4*(t+Rt)*Rt+(i+Rt);if(this.footprintLookup.hasOwnProperty(g)){const b=this.footprintLookup[g];return b?{height:b.height,hidden:b.hiddenFlags!==0}:void 0}const x=new et(t,i);for(const b of this.footprints)t>b.max.x||b.min.x>t||i>b.max.y||b.min.y>i||b.height<=u||_j(x,b)&&(u=b.height,this.footprintLookup[g]=b,h=b.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:h};this.footprintLookup[g]=void 0}}function l7(a,t,i,u,h,g){const x=Math.pow(2,u.z-h.z);for(let b=0;b<i;b++){let j=a[b+t].x,T=a[b+t].y;j=(j+h.x*Rt)*x-u.x*Rt,T=(T+h.y*Rt)*x-u.y*Rt,g.push(new et(j,T))}}let UM,$M;Yt(VM,"BuildingBucket",{omit:["layers"]});const c7=ln([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),u7=ln([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:d7}=c7,h7=ln([{name:"a_packed",components:3,type:"Float32"}]),{members:p7}=h7,f7=ln([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:m7}=f7;class GM{constructor(t,i){this.width=t,this.height=i,this.nextRow=0,this.image=new Hd({width:t,height:i}),this.positions={},this.uploaded=!1}getDash(t,i){const u=this.getKey(t,i);return this.positions[u]}trim(){const t=this.width,i=this.height=hs(this.nextRow);this.image.resize({width:t,height:i})}getKey(t,i){return t.join(",")+i}getDashRanges(t,i,u){const h=[];let g=t.length%2==1?-t[t.length-1]*u:0,x=t[0]*u,b=!0;h.push({left:g,right:x,isDash:b,zeroLength:t[0]===0});let j=t[0];for(let T=1;T<t.length;T++){b=!b;const A=t[T];g=j*u,j+=A,x=j*u,h.push({left:g,right:x,isDash:b,zeroLength:A===0})}return h}addRoundDash(t,i,u){const h=i/2;for(let g=-u;g<=u;g++){const x=this.width*(this.nextRow+u+g);let b=0,j=t[b];for(let T=0;T<this.width;T++){T/j.right>1&&(j=t[++b]);const A=Math.abs(T-j.left),I=Math.abs(T-j.right),R=Math.min(A,I);let B;const V=g/u*(h+1);if(j.isDash){const K=h-Math.abs(V);B=Math.sqrt(R*R+K*K)}else B=h-Math.sqrt(R*R+V*V);this.image.data[x+T]=Math.max(0,Math.min(255,B+128))}}}addRegularDash(t,i){for(let j=t.length-1;j>=0;--j){const T=t[j],A=t[j+1];T.zeroLength?t.splice(j,1):A&&A.isDash===T.isDash&&(A.left=T.left,t.splice(j,1))}const u=t[0],h=t[t.length-1];u.isDash===h.isDash&&(u.left=h.left-this.width,h.right=u.right+this.width);const g=this.width*this.nextRow;let x=0,b=t[x];for(let j=0;j<this.width;j++){j/b.right>1&&(b=t[++x]);const T=Math.abs(j-b.left),A=Math.abs(j-b.right),I=Math.min(T,A);this.image.data[g+j]=Math.max(0,Math.min(255,(b.isDash?I:-I)+i+128))}}addDash(t,i){const u=this.getKey(t,i);if(this.positions[u])return this.positions[u];const h=i==="round",g=h?7:0,x=2*g+1;if(this.nextRow+x>this.height)return rn("LineAtlas out of space"),null;t.length===0&&t.push(1);let b=0;for(let A=0;A<t.length;A++)t[A]<0&&(rn("Negative value is found in line dasharray, replacing values with 0"),t[A]=0),b+=t[A];if(b!==0){const A=this.width/b,I=this.getDashRanges(t,this.width,A);h?this.addRoundDash(I,A,g):this.addRegularDash(I,i==="square"?.5*A:0)}const j=this.nextRow+g;this.nextRow+=x;const T={tl:[j,g],br:[b,0]};return this.positions[u]=T,T}}Yt(GM,"LineAtlas");const g7=Ge.types,x7=Math.cos(Math.PI/180*37.5),y7=Math.cos(Math.PI/180*5);class Oj{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach(i=>{this.gradients[i.id]={}}),this.layoutVertexArray=new Am,this.layoutVertexArray2=new na,this.patternVertexArray=new na,this.indexArray=new ur,this.programConfigurations=new ia(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new mr,this.maxLineLength=0,this.zOffsetVertexArray=new na,this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.tessellationStep=t.tessellationStep?t.tessellationStep:Rt/64,this.worldview=t.worldview}updateFootprints(t,i){}populate(t,i,u,h){this.hasPattern=hj("line",this.layers,this.pixelRatio,i);const g=this.layers[0].layout.get("line-sort-key");this.tileToMeter=ve(u);const x=this.layers[0].layout.get("line-elevation-reference");if(x==="hd-road-markup")this.elevationType="road";else{const R=this.layers[0].layout.get("line-z-offset"),B=R.isConstant()&&!R.constantOr(0);this.elevationType=x!=="sea"&&x!=="ground"&&B?"none":"offset",this.elevationType==="offset"&&x==="none"&&rn(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const b=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&b!==void 0;const j=[];for(const{feature:R,id:B,index:V,sourceLayerIndex:K}of t){const Q=this.layers[0]._featureFilter.needGeometry,re=Ke(R,Q);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),re,u))continue;const ue=g?g.evaluate(re,{},u):void 0,ce={id:B,properties:R.properties,type:R.type,sourceLayerIndex:K,index:V,geometry:Q?re.geometry:Ae(R,u,h),patterns:{},sortKey:ue};j.push(ce)}g&&j.sort((R,B)=>R.sortKey-B.sortKey);const{lineAtlas:T,featureIndex:A}=i,I=this.addConstantDashes(T);for(const R of j){const{geometry:B,index:V,sourceLayerIndex:K}=R;if(I&&this.addFeatureDashes(R,T),this.hasPattern){const Q=pj("line",this.layers,R,this.zoom,this.pixelRatio,i);this.patternFeatures.push(Q)}else this.addFeature(R,B,V,u,T.positions,i.availableImages,i.brightness,i.elevationFeatures);A.insert(t[V].feature,B,V,K,this.index)}}addConstantDashes(t){let i=!1;for(const u of this.layers){const h=u.paint.get("line-dasharray").value,g=u.layout.get("line-cap").value;if(h.kind!=="constant"||g.kind!=="constant")i=!0;else{const x=g.value,b=h.value;if(!b)continue;t.addDash(b,x)}}return i}addFeatureDashes(t,i){const u=this.zoom;for(const h of this.layers){const g=h.paint.get("line-dasharray").value,x=h.layout.get("line-cap").value;if(g.kind==="constant"&&x.kind==="constant")continue;let b,j;if(g.kind==="constant"){if(b=g.value,!b)continue}else b=g.evaluate({zoom:u},t);j=x.kind==="constant"?x.value:x.evaluate({zoom:u},t),i.addDash(b,j),t.patterns[h.id]=[i.getKey(b,j)]}}update(t,i,u,h,g,x,b,j){this.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,j)}addFeatures(t,i,u,h,g,x){for(const b of this.patternFeatures)this.addFeature(b,b.geometry,b.index,i,u,h,x)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,p7)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,m7)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,u7.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,d7),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t){if(t.properties&&t.properties.hasOwnProperty("mapbox_clip_start")&&t.properties.hasOwnProperty("mapbox_clip_end"))return{start:+t.properties.mapbox_clip_start,end:+t.properties.mapbox_clip_end}}addFeature(t,i,u,h,g,x,b,j){const T=this.layers[0].layout,A=T.get("line-join").evaluate(t,{}),I=T.get("line-cap").evaluate(t,{}),R=T.get("line-miter-limit"),B=T.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t,this.zOffsetValue=T.get("line-z-offset").value;const V=this.layers[0].paint.get("line-width").value;if(V.kind!=="constant"&&V.isLineProgressConstant===!1&&(this.variableWidthValue=V),this.elevationType==="road"){const K=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,i,h,j,A,I,R,B)){const[Q,re]=this.clipRuntimeLinesToTile(i,1);for(let ue=0;ue<Q.length;ue++){const ce=Q[ue],he=re[ue],Ee={progress:{min:he.progress.min,max:he.progress.max},nextDir:this.computeSegNextDir(he,ce),prevDir:this.computeSegPrevDir(he,ce)};this.addLine(ce,t,h,A,I,R,B,Ee)}this.fillNonElevatedRoadSegment(K)}}else for(const K of i)this.addLine(K,t,h,A,I,R,B);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,g,x,h,b,void 0,this.worldview)}computeSegNextDir(t,i){return t.nextPoint.sub(i.at(-2)).unit()}computeSegPrevDir(t,i){return i[1].sub(t.prevPoint).unit()}clipLinesToTile(t,i){return z1(t,-i,-i,Rt+i,Rt+i)}clipRuntimeLinesToTile(t,i){const u=[];return[z1(t,-i,-i,Rt+i,Rt+i,u),u]}addElevatedRoadFeature(t,i,u,h,g,x,b,j){const T=[],A=gr.getElevationFeature(t,h);if(A){const I=this.clipLinesToTile(i,1),R=this.prepareElevatedLines(I,A,u);for(const B of R)T.push({geometry:B,elevation:A,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(T.length===0)return!1;for(const I of T){const R=this.layoutVertexArray.length;this.addLine(I.geometry,t,u,g,x,b,j);const B=new dn(u,I.elevationTileID);if(I.elevation)for(let V=R;V<this.layoutVertexArray.length;V++){const K=new et(this.layoutVertexArray.int16[6*V]>>1,this.layoutVertexArray.int16[6*V+1]>>1),Q=B.pointElevation(K,I.elevation,.05);this.updateHeightRange(Q),this.zOffsetVertexArray.emplaceBack(Q,0,0)}else this.fillNonElevatedRoadSegment(R)}return!0}prepareElevatedLines(t,i,u){if(i.constantHeight!=null)return t;const h=[],g=1/ve(u);for(const x of t)DG(x,new Pn(i,g),0,h);return h}fillNonElevatedRoadSegment(t){for(let i=t;i<this.layoutVertexArray.length;i++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,i,u,h,g,x,b,j){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0;const T=h==="none";this.patternJoinNone=this.hasPattern&&T,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const A=j&&j.progress.min>0,I=j&&j.progress.max<1;if(this.lineClips){let Me={min:this.lineClips.start,max:this.lineClips.end},ke=1;if(j){const st=this.lineClips.end-this.lineClips.start;Me=function(Tt,lt,gt){return{min:Wh(Tt.min,lt,gt),max:Wh(Tt.max,lt,gt)}}(j.progress,{min:0,max:1},Me),st>0&&(ke=(Me.max-Me.min)/st)}const Qe=+i.properties.mapbox_clip_feature_len,Fe=+i.properties.mapbox_clip_seg_len;if(Number.isNaN(Qe)||Number.isNaN(Fe)){for(let Tt=0;Tt<t.length-1;Tt++)this.totalDistance+=t[Tt].dist(t[Tt+1]);const st=this.totalDistance/(Me.max-Me.min);this.totalFeatureLength=Number.isFinite(st)?st:0,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Qe,this.distance=Fe*ke,this.lineClips.start=Me.min,this.lineClips.end=Me.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const R=g7[i.type]==="Polygon";let B=t.length;for(;B>=2&&t[B-1].equals(t[B-2]);)B--;let V=0;for(;V<B-1&&t[V].equals(t[V+1]);)V++;if(B<(R?3:2))return;h==="bevel"&&(x=1.05);const K=this.segments.prepareSegment(10*B,this.layoutVertexArray,this.indexArray);let Q,re,ue,ce,he,Ee,we,je;j&&j.prevDir&&(Ee=j.prevDir.perp()),j&&j.nextDir&&(we=j.nextDir.perp()),this.e1=this.e2=-1,R&&(Q=t[B-2],he=t[V].sub(Q)._unit()._perp());for(let Me=V;Me<B;Me++){if(ue=Me===B-1?R?t[V+1]:void 0:t[Me+1],ue&&t[Me].equals(ue))continue;he&&(ce=he),Q&&(re=Q),Q=t[Me],je=this.evaluateLineProgressFeatures(re?re.dist(Q):0),he=ue?ue.sub(Q)._unit()._perp():ce,ce=ce||he;const ke=re&&ue;let Qe=ke?h:R||T?"butt":g;const Fe=ce.x*he.x+ce.y*he.y;if(T){const Ve=function(Je){if(Je.patternJoinNone){const Ct=Je.segmentPoints.length/2,vt=Je.lineSoFar-Je.segmentStart;for(let os=0;os<Ct;++os){const Jt=Je.segmentPoints[2*os+1],ft=Math.round(Je.segmentPoints[2*os])+.5+.25*Jt;Je.patternVertexArray.emplaceBack(ft,vt,Je.segmentStart),Je.patternVertexArray.emplaceBack(ft,vt,Je.segmentStart)}Je.segmentPoints.length=0}Je.e1=Je.e2=-1};if(ke&&Fe<y7){this.updateDistance(re,Q),this.addCurrentVertex(Q,ce,1,1,K,je),Ve(this),this.addCurrentVertex(Q,he,-1,-1,K,je);continue}if(re){if(!ue){this.updateDistance(re,Q),this.addCurrentVertex(Q,ce,1,1,K,je),Ve(this);continue}Qe="miter"}}let st=ce.add(he);st.x===0&&st.y===0||st._unit();const Tt=st.x*he.x+st.y*he.y,lt=Tt!==0?1/Tt:1/0,gt=2*Math.sqrt(2-2*Tt),St=Tt<x7&&re&&ue,Ye=ce.x*he.y-ce.y*he.x>0,_t=this.overscaling<=16?15*Rt/(512*this.overscaling):0;if(ke&&Qe==="round"){if(lt<b)Qe="miter";else if(lt<=2){const Ve=Fj(Q,-10,Rt+10);Qe=this.elevationType==="offset"&&(Ve||this.hasCrossSlope)?"miter":"fakeround"}}if(Qe==="miter"&&lt>x&&(Qe="bevel"),Qe==="bevel"&&(lt>2&&(Qe="flipbevel"),lt<x&&(Qe="miter")),re&&!(Qe==="miter"&&St)&&this.updateDistance(re,Q),Qe==="miter")if(St){const Ve=Q.dist(re);if(Ve>2*_t){const Ct=Q.sub(Q.sub(re)._mult(_t/Ve)._round());this.updateDistance(re,Ct),this.addCurrentVertex(Ct,ce,0,0,K,je),re=Ct}this.updateDistance(re,Q),st._mult(lt),this.addCurrentVertex(Q,st,0,0,K,je);const Je=Q.dist(ue);if(Je>2*_t){const Ct=Q.add(ue.sub(Q)._mult(_t/Je)._round());this.updateDistance(Q,Ct),this.addCurrentVertex(Ct,he,0,0,K,je),Q=Ct}}else st._mult(lt),this.addCurrentVertex(Q,st,0,0,K,je);else if(Qe==="flipbevel"){if(lt>100)st=he.mult(-1);else{const Ve=lt*ce.add(he).mag()/ce.sub(he).mag();st._perp()._mult(Ve*(Ye?-1:1))}this.addCurrentVertex(Q,st,0,0,K,je),this.addCurrentVertex(Q,st.mult(-1),0,0,K,je)}else if(Qe==="bevel"||Qe==="fakeround"){je!=null&&re&&this.addCurrentVertex(Q,we||ce,-1,-1,K,je);const Ve=Q.dist(re)<=2*_t&&Qe!=="bevel",Je=st.mult(Ye?1:-1);Je._mult(lt);const Ct=he.mult(Ye?-1:1),vt=ce.mult(Ye?-1:1),os=this.evaluateLineProgressFeatures(this.distance);if(je==null&&(this.addHalfVertex(Q,Je.x,Je.y,!1,!Ye,0,K,os),Ve||this.addHalfVertex(Q,Je.x+2*vt.x,Je.y+2*vt.y,!1,Ye,0,K,os)),Qe==="fakeround"){const Jt=Math.round(180*gt/Math.PI/20);this.addHalfVertex(Q,vt.x,vt.y,!1,Ye,0,K,os);for(let ft=0;ft<Jt;ft++){let bt=ft/Jt;if(bt!==.5){const qt=bt-.5;bt+=bt*qt*(bt-1)*((1.0904+Fe*(Fe*(3.55645-1.43519*Fe)-3.2452))*qt*qt+(.848013+Fe*(.215638*Fe-1.06021)))}const ts=Ct.sub(vt)._mult(bt)._add(vt)._unit();this.addHalfVertex(Q,ts.x,ts.y,!1,Ye,0,K,os)}this.addHalfVertex(Q,Ct.x,Ct.y,!1,Ye,0,K,os)}Ve||je!=null||this.addHalfVertex(Q,Je.x+2*Ct.x,Je.y+2*Ct.y,!1,Ye,0,K,os),je!=null&&ue&&this.addCurrentVertex(Q,Ee||he,1,1,K,je)}else if(Qe==="butt")this.addCurrentVertex(Q,st,0,0,K,je);else if(Qe==="square"){if(!re){const Ve=A?0:-1;this.addCurrentVertex(Q,st,Ve,Ve,K,je)}if(this.addCurrentVertex(Q,st,0,0,K,je),re){const Ve=I?0:1;this.addCurrentVertex(Q,st,Ve,Ve,K,je)}}else if(Qe==="round"){if(re){const Ve=!ke&&we?we:ce;this.addCurrentVertex(Q,Ve,0,0,K,je),!ke&&I||this.addCurrentVertex(Q,Ve,1,1,K,je,!0)}if(ue){const Ve=!ke&&Ee?Ee:he;!ke&&A||this.addCurrentVertex(Q,Ve,-1,-1,K,je,!0),this.addCurrentVertex(Q,Ve,0,0,K,je)}}}}addVerticesTo(t,i,u,h,g,x,b,j,T,A){const I=(i.w-t.w)/this.tessellationStep|0;let R=0;const B=this.scaledDistance;if(I>1){this.lineSoFar=t.w;const K=(i.x-t.x)/I,Q=(i.y-t.y)/I,re=(i.z-t.z)/I,ue=(i.w-t.w)/I;for(let ce=1;ce<I;++ce){t.x+=K,t.y+=Q,t.z+=re,this.lineSoFar+=ue,R+=ue;const he=this.evaluateLineProgressFeatures(this.prevDistance+R);this.scaledDistance=(this.prevDistance+R)/this.totalDistance,this.addHalfVertex(t,u,h,A,!1,b,T,he),this.addHalfVertex(t,g,x,A,!0,-j,T,he)}}this.lineSoFar=i.w,this.scaledDistance=B;const V=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(i,u,h,A,!1,b,T,V),this.addHalfVertex(i,g,x,A,!0,-j,T,V)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):rn(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let i=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(i=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:i}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:i}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:i}}addCurrentVertex(t,i,u,h,g,x,b=!1){const j=i.x+i.y*u,T=i.y-i.x*u,A=i.y*h-i.x,I=-i.y-i.x*h;if(x!=null){const R=this.elevationType==="offset",B=-10,V=Rt+10,K=x.zOffset,Q=new pM(t.x,t.y,K,this.lineSoFar),re=!!R&&Fj(t,B,V),ue=this.lineSoFar,ce=this.distance;if(this.currentVertex)if(re){const he=this.currentVertexIsOutside,Ee=this.currentVertex,we=new pM(t.x,t.y,K,this.lineSoFar);if(mM(Ee,we,B,V),!Fj(we,B,V)){if(he){this.e1=this.e2=-1,this.distance-=Ee.dist(Q),this.lineSoFar=Ee.w;const je=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,j,T,b,!1,u,g,je),this.addHalfVertex(Ee,A,I,b,!0,-h,g,je),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(we),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,we,j,T,A,I,u,h,g,b),this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){mM(he,Q,B,V),this.e1=this.e2=-1,this.distance-=he.dist(Q),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const Ee=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,j,T,b,!1,u,g,Ee),this.addHalfVertex(he,A,I,b,!0,-h,g,Ee),this.prevDistance=this.distance,this.distance=ce,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,Q,j,T,A,I,u,h,g,b)}else re||(this.addHalfVertex(t,j,T,b,!1,u,g,x),this.addHalfVertex(t,A,I,b,!0,-h,g,x));this.currentVertex=Q,this.currentVertexIsOutside=re,this.lineSoFar=ue}else this.addHalfVertex(t,j,T,b,!1,u,g,x),this.addHalfVertex(t,A,I,b,!0,-h,g,x)}addHalfVertex({x:t,y:i},u,h,g,x,b,j,T){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),x||this.segmentPoints.push(this.lineSoFar-this.segmentStart,b)),this.layoutVertexArray.emplaceBack((t<<1)+(g?1:0),(i<<1)+(x?1:0),Math.round(63*u)+128,Math.round(63*h)+128,1+(b===0?0:b<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const I=fs(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,I)}const A=j.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,A),j.primitiveLength++),x?this.e2=A:this.e1=A,T!=null&&this.zOffsetVertexArray.emplaceBack(T.zOffset,T.variableWidth,T.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,i){this.prevDistance=this.distance,this.distance+=t.dist(i),this.updateScaledDistance()}}function Fj(a,t,i){return a.x<t||a.x>i||a.y<t||a.y>i}let HM,WM;function qM(a,t,i){return t*(Rt/(a.tileSize*Math.pow(2,i-a.tileID.overscaledZ)))}Yt(Oj,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const ZM=(a,t,i)=>(1-i)*a+i*t;function KM(a,t){return 1/qM(a,1,t.tileZoom)}function XM(a,t,i,u){return a.translatePosMatrix(u||t.tileID.projMatrix,t,i.paint.get("line-translate"),i.paint.get("line-translate-anchor"))}const YM=a=>{const t=[];JM(a)&&t.push("RENDER_LINE_DASH"),a.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const i=a.paint.get("line-trim-offset");i[0]===0&&i[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),a.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const u=a.layout.get("line-join").constantOr("miter")==="none",h=!!a.paint.get("line-pattern").constantOr(1);return u&&h&&t.push("LINE_JOIN_NONE"),t};function JM(a){const t=a.paint.get("line-dasharray").value;return t.value||t.kind!=="constant"}let Bj;const QM=()=>Bj||(Bj={layout:HM||(HM=new Er({"line-cap":new Gt(Oe.layout_line["line-cap"]),"line-join":new Gt(Oe.layout_line["line-join"]),"line-miter-limit":new Nt(Oe.layout_line["line-miter-limit"]),"line-round-limit":new Nt(Oe.layout_line["line-round-limit"]),"line-sort-key":new Gt(Oe.layout_line["line-sort-key"]),"line-z-offset":new Gt(Oe.layout_line["line-z-offset"]),"line-elevation-reference":new Nt(Oe.layout_line["line-elevation-reference"]),"line-cross-slope":new Nt(Oe.layout_line["line-cross-slope"]),visibility:new Nt(Oe.layout_line.visibility),"line-width-unit":new Nt(Oe.layout_line["line-width-unit"])})),paint:WM||(WM=new Er({"line-opacity":new Gt(Oe.paint_line["line-opacity"]),"line-color":new Gt(Oe.paint_line["line-color"]),"line-translate":new Nt(Oe.paint_line["line-translate"]),"line-translate-anchor":new Nt(Oe.paint_line["line-translate-anchor"]),"line-width":new Gt(Oe.paint_line["line-width"]),"line-gap-width":new Gt(Oe.paint_line["line-gap-width"]),"line-offset":new Gt(Oe.paint_line["line-offset"]),"line-blur":new Gt(Oe.paint_line["line-blur"]),"line-dasharray":new Gt(Oe.paint_line["line-dasharray"]),"line-pattern":new Gt(Oe.paint_line["line-pattern"]),"line-pattern-cross-fade":new Nt(Oe.paint_line["line-pattern-cross-fade"]),"line-gradient":new Cd(Oe.paint_line["line-gradient"]),"line-trim-offset":new Nt(Oe.paint_line["line-trim-offset"]),"line-trim-fade-range":new Nt(Oe.paint_line["line-trim-fade-range"]),"line-trim-color":new Nt(Oe.paint_line["line-trim-color"]),"line-emissive-strength":new Nt(Oe.paint_line["line-emissive-strength"]),"line-border-width":new Gt(Oe.paint_line["line-border-width"]),"line-border-color":new Gt(Oe.paint_line["line-border-color"]),"line-occlusion-opacity":new Nt(Oe.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},Bj);class _7 extends Gt{possiblyEvaluate(t,i){return i=new Mn(Math.floor(i.zoom),{now:i.now,fadeDuration:i.fadeDuration,transition:i.transition,worldview:i.worldview}),super.possiblyEvaluate(t,i)}evaluate(t,i,u,h){return i=He({},i,{zoom:Math.floor(i.zoom)}),super.evaluate(t,i,u,h)}}let u_;function eR(a,t){return t>0?t+2*a:a}const v7=ln([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),b7=ln([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),w7=ln([{name:"a_projected_pos",components:4,type:"Float32"}],4);ln([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const S7=ln([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),j7=ln([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),T7=ln([{name:"a_texb",components:2,type:"Uint16"}]),N7=ln([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),E7=ln([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const tR=ln([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),C7=ln([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ln([{name:"triangle",components:3,type:"Uint16"}]),ln([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ln([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ln([{type:"Float32",name:"offsetX"}]),ln([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var wi=24;function A7(a,t,i){return a.sections.forEach(u=>{u.text=function(h,g,x){const b=g.layout.get("text-transform").evaluate(x,{});return b==="uppercase"?h=h.toLocaleUpperCase():b==="lowercase"&&(h=h.toLocaleLowerCase()),fl.applyArabicShaping&&(h=fl.applyArabicShaping(h)),h}(u.text,t,i)}),a}const d_={"!":"","#":"",$:"","%":"","&":"","(":"",")":"","*":"","+":"",",":"","-":"",".":"","/":"",":":"",";":"","<":"","=":"",">":"","?":"","@":"","[":"","\\":"","]":"","^":"",_:"","`":"","{":"","|":"","}":"","~":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":"","":""};function P7(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}function I7(a){return a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""||a===""}const Vj=4294967296,sR=1/Vj,nR=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let H1=class{constructor(a=new Uint8Array(16)){this.buf=ArrayBuffer.isView(a)?a:new Uint8Array(a),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(a,t,i=this.length){for(;this.pos<i;){const u=this.readVarint(),h=u>>3,g=this.pos;this.type=7&u,a(h,t,this),this.pos===g&&this.skip(u)}return t}readMessage(a,t){return this.readFields(a,t,this.readVarint()+this.pos)}readFixed32(){const a=this.dataView.getUint32(this.pos,!0);return this.pos+=4,a}readSFixed32(){const a=this.dataView.getInt32(this.pos,!0);return this.pos+=4,a}readFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*Vj;return this.pos+=8,a}readSFixed64(){const a=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*Vj;return this.pos+=8,a}readFloat(){const a=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,a}readDouble(){const a=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,a}readVarint(a){const t=this.buf;let i,u;return u=t[this.pos++],i=127&u,u<128?i:(u=t[this.pos++],i|=(127&u)<<7,u<128?i:(u=t[this.pos++],i|=(127&u)<<14,u<128?i:(u=t[this.pos++],i|=(127&u)<<21,u<128?i:(u=t[this.pos],i|=(15&u)<<28,function(h,g,x){const b=x.buf;let j,T;if(T=b[x.pos++],j=(112&T)>>4,T<128||(T=b[x.pos++],j|=(127&T)<<3,T<128)||(T=b[x.pos++],j|=(127&T)<<10,T<128)||(T=b[x.pos++],j|=(127&T)<<17,T<128)||(T=b[x.pos++],j|=(127&T)<<24,T<128)||(T=b[x.pos++],j|=(1&T)<<31,T<128))return Wm(h,j,g);throw new Error("Expected varint not more than 10 bytes")}(i,a,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const a=this.readVarint();return a%2==1?(a+1)/-2:a/2}readBoolean(){return!!this.readVarint()}readString(){const a=this.readVarint()+this.pos,t=this.pos;return this.pos=a,a-t>=12&&nR?nR.decode(this.buf.subarray(t,a)):function(i,u,h){let g="",x=u;for(;x<h;){const b=i[x];let j,T,A,I=null,R=b>239?4:b>223?3:b>191?2:1;if(x+R>h)break;R===1?b<128&&(I=b):R===2?(j=i[x+1],(192&j)==128&&(I=(31&b)<<6|63&j,I<=127&&(I=null))):R===3?(j=i[x+1],T=i[x+2],(192&j)==128&&(192&T)==128&&(I=(15&b)<<12|(63&j)<<6|63&T,(I<=2047||I>=55296&&I<=57343)&&(I=null))):R===4&&(j=i[x+1],T=i[x+2],A=i[x+3],(192&j)==128&&(192&T)==128&&(192&A)==128&&(I=(15&b)<<18|(63&j)<<12|(63&T)<<6|63&A,(I<=65535||I>=1114112)&&(I=null))),I===null?(I=65533,R=1):I>65535&&(I-=65536,g+=String.fromCharCode(I>>>10&1023|55296),I=56320|1023&I),g+=String.fromCharCode(I),x+=R}return g}(this.buf,t,a)}readBytes(){const a=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,a);return this.pos=a,t}readPackedVarint(a=[],t){const i=this.readPackedEnd();for(;this.pos<i;)a.push(this.readVarint(t));return a}readPackedSVarint(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSVarint());return a}readPackedBoolean(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readBoolean());return a}readPackedFloat(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFloat());return a}readPackedDouble(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readDouble());return a}readPackedFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed32());return a}readPackedSFixed32(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed32());return a}readPackedFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readFixed64());return a}readPackedSFixed64(a=[]){const t=this.readPackedEnd();for(;this.pos<t;)a.push(this.readSFixed64());return a}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(a){const t=7&a;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(a,t){this.writeVarint(a<<3|t)}realloc(a){let t=this.length||16;for(;t<this.pos+a;)t*=2;if(t!==this.length){const i=new Uint8Array(t);i.set(this.buf),this.buf=i,this.dataView=new DataView(i.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeSFixed32(a){this.realloc(4),this.dataView.setInt32(this.pos,a,!0),this.pos+=4}writeFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*sR),!0),this.pos+=8}writeSFixed64(a){this.realloc(8),this.dataView.setInt32(this.pos,-1&a,!0),this.dataView.setInt32(this.pos+4,Math.floor(a*sR),!0),this.pos+=8}writeVarint(a){(a=+a||0)>268435455||a<0?function(t,i){let u,h;if(t>=0?(u=t%4294967296|0,h=t/4294967296|0):(u=~(-t%4294967296),h=~(-t/4294967296),4294967295^u?u=u+1|0:(u=0,h=h+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");i.realloc(10),function(g,x,b){b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,g>>>=7,b.buf[b.pos++]=127&g|128,b.buf[b.pos]=127&(g>>>=7)}(u,0,i),function(g,x){const b=(7&g)<<4;x.buf[x.pos++]|=b|((g>>>=3)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g|((g>>>=7)?128:0),g&&(x.buf[x.pos++]=127&g)))))}(h,i)}(a,this):(this.realloc(4),this.buf[this.pos++]=127&a|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=127&(a>>>=7)|(a>127?128:0),a<=127||(this.buf[this.pos++]=a>>>7&127))))}writeSVarint(a){this.writeVarint(a<0?2*-a-1:2*a)}writeBoolean(a){this.writeVarint(+a)}writeString(a){a=String(a),this.realloc(4*a.length),this.pos++;const t=this.pos;this.pos=function(u,h,g){for(let x,b,j=0;j<h.length;j++){if(x=h.charCodeAt(j),x>55295&&x<57344){if(!b){x>56319||j+1===h.length?(u[g++]=239,u[g++]=191,u[g++]=189):b=x;continue}if(x<56320){u[g++]=239,u[g++]=191,u[g++]=189,b=x;continue}x=b-55296<<10|x-56320|65536,b=null}else b&&(u[g++]=239,u[g++]=191,u[g++]=189,b=null);x<128?u[g++]=x:(x<2048?u[g++]=x>>6|192:(x<65536?u[g++]=x>>12|224:(u[g++]=x>>18|240,u[g++]=x>>12&63|128),u[g++]=x>>6&63|128),u[g++]=63&x|128)}return g}(this.buf,a,this.pos);const i=this.pos-t;i>=128&&rR(t,i,this),this.pos=t-1,this.writeVarint(i),this.pos+=i}writeFloat(a){this.realloc(4),this.dataView.setFloat32(this.pos,a,!0),this.pos+=4}writeDouble(a){this.realloc(8),this.dataView.setFloat64(this.pos,a,!0),this.pos+=8}writeBytes(a){const t=a.length;this.writeVarint(t),this.realloc(t);for(let i=0;i<t;i++)this.buf[this.pos++]=a[i]}writeRawMessage(a,t){this.pos++;const i=this.pos;a(t,this);const u=this.pos-i;u>=128&&rR(i,u,this),this.pos=i-1,this.writeVarint(u),this.pos+=u}writeMessage(a,t,i){this.writeTag(a,2),this.writeRawMessage(t,i)}writePackedVarint(a,t){t.length&&this.writeMessage(a,M7,t)}writePackedSVarint(a,t){t.length&&this.writeMessage(a,R7,t)}writePackedBoolean(a,t){t.length&&this.writeMessage(a,L7,t)}writePackedFloat(a,t){t.length&&this.writeMessage(a,k7,t)}writePackedDouble(a,t){t.length&&this.writeMessage(a,D7,t)}writePackedFixed32(a,t){t.length&&this.writeMessage(a,z7,t)}writePackedSFixed32(a,t){t.length&&this.writeMessage(a,O7,t)}writePackedFixed64(a,t){t.length&&this.writeMessage(a,F7,t)}writePackedSFixed64(a,t){t.length&&this.writeMessage(a,B7,t)}writeBytesField(a,t){this.writeTag(a,2),this.writeBytes(t)}writeFixed32Field(a,t){this.writeTag(a,5),this.writeFixed32(t)}writeSFixed32Field(a,t){this.writeTag(a,5),this.writeSFixed32(t)}writeFixed64Field(a,t){this.writeTag(a,1),this.writeFixed64(t)}writeSFixed64Field(a,t){this.writeTag(a,1),this.writeSFixed64(t)}writeVarintField(a,t){this.writeTag(a,0),this.writeVarint(t)}writeSVarintField(a,t){this.writeTag(a,0),this.writeSVarint(t)}writeStringField(a,t){this.writeTag(a,2),this.writeString(t)}writeFloatField(a,t){this.writeTag(a,5),this.writeFloat(t)}writeDoubleField(a,t){this.writeTag(a,1),this.writeDouble(t)}writeBooleanField(a,t){this.writeVarintField(a,+t)}};function Wm(a,t,i){return i?4294967296*t+(a>>>0):4294967296*(t>>>0)+(a>>>0)}function rR(a,t,i){const u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));i.realloc(u);for(let h=i.pos-1;h>=a;h--)i.buf[h+u]=i.buf[h]}function M7(a,t){for(let i=0;i<a.length;i++)t.writeVarint(a[i])}function R7(a,t){for(let i=0;i<a.length;i++)t.writeSVarint(a[i])}function k7(a,t){for(let i=0;i<a.length;i++)t.writeFloat(a[i])}function D7(a,t){for(let i=0;i<a.length;i++)t.writeDouble(a[i])}function L7(a,t){for(let i=0;i<a.length;i++)t.writeBoolean(a[i])}function z7(a,t){for(let i=0;i<a.length;i++)t.writeFixed32(a[i])}function O7(a,t){for(let i=0;i<a.length;i++)t.writeSFixed32(a[i])}function F7(a,t){for(let i=0;i<a.length;i++)t.writeFixed64(a[i])}function B7(a,t){for(let i=0;i<a.length;i++)t.writeSFixed64(a[i])}const Uj=3;function V7(a,t,i){t.glyphs=[],a===1&&i.readMessage(U7,t)}function U7(a,t,i){if(a===3){const{id:u,bitmap:h,width:g,height:x,left:b,top:j,advance:T}=i.readMessage($7,{});t.glyphs.push({id:u,bitmap:new Hd({width:g+2*Uj,height:x+2*Uj},h),metrics:{width:g,height:x,left:b,top:j,advance:T}})}else a===4?t.ascender=i.readSVarint():a===5&&(t.descender=i.readSVarint())}function $7(a,t,i){a===1?t.id=i.readVarint():a===2?t.bitmap=i.readBytes():a===3?t.width=i.readVarint():a===4?t.height=i.readVarint():a===5?t.left=i.readSVarint():a===6?t.top=i.readSVarint():a===7&&(t.advance=i.readVarint())}const iR=Uj,da={horizontal:1,vertical:2,horizontalOnly:3};class h_{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,i){const u=new h_;return u.scale=t||1,u.fontStack=i,u}static forImage(t){const i=new h_;return i.image=t,i}}class qm{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,i,u){const h=new qm;for(let g=0;g<t.sections.length;g++){const x=t.sections[g];x.image?h.addImageSection(x,u):h.addTextSection(x,i)}return h}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=function(i,u){let h="";for(let g=0;g<i.length;g++){const x=i.charCodeAt(g+1)||null,b=i.charCodeAt(g-1)||null;h+=!u&&(x&&wm(x)&&!d_[i[g+1]]||b&&wm(b)&&!d_[i[g-1]])||!d_[i[g]]?i[g]:d_[i[g]]}return h}(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&W1[this.text.charCodeAt(u)];u++)t++;let i=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&W1[this.text.charCodeAt(u)];u--)i--;this.text=this.text.substring(t,i),this.sectionIndex=this.sectionIndex.slice(t,i)}substring(t,i){const u=new qm;return u.text=this.text.substring(t,i),u.sectionIndex=this.sectionIndex.slice(t,i),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce((t,i)=>Math.max(t,this.sections[i].scale),0)}addTextSection(t,i){this.text+=t.text,this.sections.push(h_.forText(t.scale,t.fontStack||i));const u=this.sections.length-1;for(let h=0;h<t.text.length;++h)this.sectionIndex.push(u)}addImageSection(t,i){const u=t.image?t.image.getPrimary():null;if(!u)return void rn("Can't add FormattedSection with an empty image.");u.scaleSelf(i);const h=this.getNextImageSectionCharCode();h?(this.text+=String.fromCodePoint(h),this.sections.push(h_.forImage(u)),this.sectionIndex.push(this.sections.length-1)):rn("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function $j(a,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K=1){const Q=qm.fromFeature(a,h,K);I===da.vertical&&Q.verticalizePunctuation(R);let re=[];const ue=function(je,Me,ke,Qe,Fe,st){if(!je)return[];const Tt=[],lt=function(_t,Ve,Je,Ct,vt,os){let Jt=0;for(let ft=0;ft<_t.length();ft++){const bt=_t.getSection(ft);Jt+=oR(_t.getCodePoint(ft),bt,Ct,vt,Ve,os)}return Jt/Math.max(1,Math.ceil(Jt/Je))}(je,Me,ke,Qe,Fe,st),gt=je.text.indexOf("")>=0;let St=0;for(let _t=0;_t<je.length();_t++){const Ve=je.getSection(_t),Je=je.getCodePoint(_t);if(W1[Je]||(St+=oR(Je,Ve,Qe,Fe,Me,st)),_t<je.length()-1){const Ct=!((Ye=Je)<11904||!(ys["Bopomofo Extended"](Ye)||ys.Bopomofo(Ye)||ys["CJK Compatibility Forms"](Ye)||ys["CJK Compatibility Ideographs"](Ye)||ys["CJK Compatibility"](Ye)||ys["CJK Radicals Supplement"](Ye)||ys["CJK Strokes"](Ye)||ys["CJK Symbols and Punctuation"](Ye)||ys["CJK Unified Ideographs Extension A"](Ye)||ys["CJK Unified Ideographs"](Ye)||ys["Enclosed CJK Letters and Months"](Ye)||ys["Halfwidth and Fullwidth Forms"](Ye)||ys.Hiragana(Ye)||ys["Ideographic Description Characters"](Ye)||ys["Kangxi Radicals"](Ye)||ys["Katakana Phonetic Extensions"](Ye)||ys.Katakana(Ye)||ys["Vertical Forms"](Ye)||ys["Yi Radicals"](Ye)||ys["Yi Syllables"](Ye)));(G7[Je]||Ct||Ve.image)&&Tt.push(lR(_t+1,St,lt,Tt,H7(Je,je.getCodePoint(_t+1),Ct&&gt),!1))}}var Ye;return cR(lR(je.length(),St,lt,Tt,0,!0))}(Q,T,g,t,u,B),{processBidirectionalText:ce,processStyledBidirectionalText:he}=fl;if(ce&&Q.sections.length===1){const je=ce(Q.toString(),ue);for(const Me of je){const ke=new qm;ke.text=Me,ke.sections=Q.sections;for(let Qe=0;Qe<Me.length;Qe++)ke.sectionIndex.push(0);re.push(ke)}}else if(he){const je=he(Q.text,Q.sectionIndex,ue);for(const Me of je){const ke=new qm;ke.text=Me[0],ke.sectionIndex=Me[1],ke.sections=Q.sections,re.push(ke)}}else re=function(je,Me){const ke=[],Qe=je.text;let Fe=0;for(const st of Me)ke.push(je.substring(Fe,st)),Fe=st;return Fe<Qe.length&&ke.push(je.substring(Fe,Qe.length)),ke}(Q,ue);const Ee=[],we={positionedLines:Ee,text:Q.toString(),top:A[1],bottom:A[1],left:A[0],right:A[0],writingMode:I,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if(function(je,Me,ke,Qe,Fe,st,Tt,lt,gt,St,Ye,_t){let Ve=0,Je=0,Ct=0;const vt=lt==="right"?1:lt==="left"?0:.5;let os=!1;for(const kt of Fe){const Zt=kt.getSections();for(const xs of Zt){if(xs.image)continue;const As=Me[xs.fontStack];if(As&&(os=As.ascender!==void 0&&As.descender!==void 0,!os))break}if(!os)break}let Jt=0;for(const kt of Fe){kt.trim();const Zt=kt.getMaxScale(),xs=(Zt-1)*wi,As={positionedGlyphs:[],lineOffset:0};je.positionedLines[Jt]=As;const zs=As.positionedGlyphs;let ks=0;if(!kt.length()){Je+=st,++Jt;continue}let on=0,Gs=0;for(let me=0;me<kt.length();me++){const ge=kt.getSection(me),Ze=kt.getSectionIndex(me),At=kt.getCodePoint(me);let Ft=ge.scale,zt=null,es=null,js=null,Qs=wi,en=0,Bs=gt;Bs===da.vertical&&((ft=At)===12312||ft===12313||ft===12316||ft===12540||ft===12448)&&(Bs=da.horizontal);const Rn=!(Bs===da.horizontal||!Ye&&!bm(At)||Ye&&(W1[At]||s1(At)));if(ge.image){const br=Qe.get(ge.image.toString());if(!br)continue;js=ge.image,je.iconsInText=je.iconsInText||!0,es=br.paddedRect;const Os=br.displaySize;Ft=Ft*wi/_t,zt={width:Os[0],height:Os[1],left:0,top:-iR,advance:Rn?Os[1]:Os[0],localGlyph:!1},en=os?-zt.height*Ft:Zt*wi-17-Os[1]*Ft,Qs=zt.advance;const ar=(Rn?Os[0]:Os[1])*Ft-wi*Zt;ar>0&&ar>ks&&(ks=ar)}else{const br=ke[ge.fontStack];if(!br)continue;br[At]&&(es=br[At]);const Os=Me[ge.fontStack];if(!Os)continue;const ar=Os.glyphs[At];if(!ar)continue;if(zt=ar.metrics,Qs=At!==8203?wi:0,os){const Yn=Os.ascender!==void 0?Math.abs(Os.ascender):0,An=Os.descender!==void 0?Math.abs(Os.descender):0,xr=(Yn+An)*Ft;on<xr&&(on=xr,Gs=(Yn-An)/2*Ft),en=-Yn*Ft}else en=(Zt-Ft)*wi-17}Rn?(je.verticalizable=!0,zs.push({glyph:At,image:js,x:Ve,y:Je+en,vertical:Rn,scale:Ft,localGlyph:zt.localGlyph,fontStack:ge.fontStack,sectionIndex:Ze,metrics:zt,rect:es}),Ve+=Qs*Ft+St):(zs.push({glyph:At,image:js,x:Ve,y:Je+en,vertical:Rn,scale:Ft,localGlyph:zt.localGlyph,fontStack:ge.fontStack,sectionIndex:Ze,metrics:zt,rect:es}),Ve+=zt.advance*Ft+St)}zs.length!==0&&(Ct=Math.max(Ve-St,Ct),os?uR(zs,vt,ks,Gs,st*Zt/2):uR(zs,vt,ks,0,st/2)),Ve=0;const nr=st*Zt+ks;As.lineOffset=Math.max(ks,xs),Je+=nr,++Jt}var ft;const bt=Je,{horizontalAlign:ts,verticalAlign:qt}=Gj(Tt);(function(kt,Zt,xs,As,zs,ks){const on=(Zt-xs)*zs,Gs=-ks*As;for(const nr of kt)for(const me of nr.positionedGlyphs)me.x+=on,me.y+=Gs})(je.positionedLines,vt,ts,qt,Ct,bt),je.top+=-qt*bt,je.bottom=je.top+bt,je.left+=-ts*Ct,je.right=je.left+Ct,je.hasBaseline=os}(we,t,i,u,re,x,b,j,I,T,R,V),!function(je){for(const Me of je)if(Me.positionedGlyphs.length!==0)return!1;return!0}(Ee))return we}const W1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},G7={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function oR(a,t,i,u,h,g){if(t.image){const x=u.get(t.image.toString());return x?x.displaySize[0]*t.scale*wi/g+h:0}{const x=i[t.fontStack],b=x&&x.glyphs[a];return b?b.metrics.advance*t.scale+h:0}}function aR(a,t,i,u){const h=Math.pow(a-t,2);return u?a<t?h/2:2*h:h+Math.abs(i)*i}function H7(a,t,i){let u=0;return a===10&&(u-=1e4),i&&(u+=150),a!==40&&a!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function lR(a,t,i,u,h,g){let x=null,b=aR(t,i,h,g);for(const j of u){const T=aR(t-j.x,i,h,g)+j.badness;T<=b&&(x=j,b=T)}return{index:a,x:t,priorBreak:x,badness:b}}function cR(a){return a?cR(a.priorBreak).concat(a.index):[]}function Gj(a){let t=.5,i=.5;switch(a){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(a){case"bottom":case"bottom-right":case"bottom-left":i=1;break;case"top":case"top-right":case"top-left":i=0}return{horizontalAlign:t,verticalAlign:i}}function uR(a,t,i,u,h){if(!(t||i||u||h))return;const g=a.length-1,x=a[g],b=(x.x+x.metrics.advance*x.scale)*t;for(let j=0;j<=g;j++)a[j].x-=b,a[j].y+=i+u+h}function dR(a){return a.imagePrimary!==void 0&&a.top!==void 0&&a.bottom!==void 0&&a.left!==void 0&&a.right!==void 0}function W7(a,t,i,u){const{horizontalAlign:h,verticalAlign:g}=Gj(u),x=i[0]-a.displaySize[0]*h,b=i[1]-a.displaySize[1]*g;return{imagePrimary:a,imageSecondary:t,top:b,bottom:b+a.displaySize[1],left:x,right:x+a.displaySize[0]}}function hR(a,t,i,u,h,g){const x=a.imagePrimary;let b;if(x.content){const Q=x.content,re=x.pixelRatio||1;b=[Q[0]/re,Q[1]/re,x.displaySize[0]-Q[2]/re,x.displaySize[1]-Q[3]/re]}const j=t.left*g,T=t.right*g;let A,I,R,B;i==="width"||i==="both"?(B=h[0]+j-u[3],I=h[0]+T+u[1]):(B=h[0]+(j+T-x.displaySize[0])/2,I=B+x.displaySize[0]);const V=t.top*g,K=t.bottom*g;return i==="height"||i==="both"?(A=h[1]+V-u[0],R=h[1]+K+u[2]):(A=h[1]+(V+K-x.displaySize[1])/2,R=A+x.displaySize[1]),{imagePrimary:x,imageSecondary:void 0,top:A,right:I,bottom:R,left:B,collisionPadding:b}}function pR(a){return!a.imagePrimary.stretchX}function fR(a){return!a.imagePrimary.stretchY}function mR(a){return{width:a.right-a.left,height:a.bottom-a.top}}const Bc=128;function gR(a,t,i){const{expression:u}=t;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Mn(a+1,{worldview:i}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:h,interpolationType:g}=u;let x=0;for(;x<h.length&&h[x]<=a;)x++;x=Math.max(0,x-1);let b=x;for(;b<h.length&&h[b]<a+1;)b++;b=Math.min(h.length-1,b);const j=h[x],T=h[b];return u.kind==="composite"?{kind:"composite",minZoom:j,maxZoom:T,interpolationType:g}:{kind:"camera",minZoom:j,maxZoom:T,minSize:u.evaluate(new Mn(j,{worldview:i})),maxSize:u.evaluate(new Mn(T,{worldview:i})),interpolationType:g}}}function Hj(a,{uSize:t,uSizeT:i},{lowerSize:u,upperSize:h}){return a.kind==="source"?u/Bc:a.kind==="composite"?fs(u/Bc,h/Bc,i):t}function p_(a,t,i=1){let u=0,h=0;if(a.kind==="constant")h=a.layoutSize*i;else if(a.kind!=="source"){const{interpolationType:g,minZoom:x,maxZoom:b}=a,j=g?xe(Co.interpolationFactor(g,t,x,b),0,1):0;a.kind==="camera"?h=fs(a.minSize,a.maxSize,j)*i:u=j*i}return{uSizeT:u,uSize:h}}class ku extends et{constructor(t,i,u,h,g){super(t,i),this.angle=h,this.z=u,g!==void 0&&(this.segment=g)}clone(){return new ku(this.x,this.y,this.z,this.angle,this.segment)}}function xR(a,t,i,u,h){if(t.segment===void 0)return!0;let g=t,x=t.segment+1,b=0;for(;b>-i/2;){if(x--,x<0)return!1;b-=a[x].dist(g),g=a[x]}b+=a[x].dist(a[x+1]),x++;const j=[];let T=0;for(;b<i/2;){const A=a[x],I=a[x+1];if(!I)return!1;let R=a[x-1].angleTo(A)-A.angleTo(I);for(R=Math.abs((R+3*Math.PI)%(2*Math.PI)-Math.PI),j.push({distance:b,angleDelta:R}),T+=R;b-j[0].distance>u;)T-=j.shift().angleDelta;if(T>h)return!1;x++,b+=A.dist(I)}return!0}function yR(a){let t=0;for(let i=0;i<a.length-1;i++)t+=a[i].dist(a[i+1]);return t}function _R(a,t,i){return a?.6*t*i:0}function vR(a,t){return Math.max(a?a.right-a.left:0,t?t.right-t.left:0)}function q7(a,t,i,u,h,g){const x=_R(i,h,g),b=vR(i,u)*g;let j=0;const T=yR(a)/2;for(let A=0;A<a.length-1;A++){const I=a[A],R=a[A+1],B=I.dist(R);if(j+B>T){const V=(T-j)/B,K=fs(I.x,R.x,V),Q=fs(I.y,R.y,V),re=new ku(K,Q,0,R.angleTo(I),A);return!x||xR(a,re,b,x,t)?re:void 0}j+=B}}function Z7(a,t,i,u,h,g,x,b,j){const T=_R(u,g,x),A=vR(u,h),I=A*x,R=a[0].x===0||a[0].x===j||a[0].y===0||a[0].y===j;return t-I<t/4&&(t=I+t/4),bR(a,R?t/2*b%t:(A/2+2*g)*x*b%t,t,T,i,I,R,!1,j)}function bR(a,t,i,u,h,g,x,b,j){const T=g/2,A=yR(a);let I=0,R=t-i,B=[];for(let V=0;V<a.length-1;V++){const K=a[V],Q=a[V+1],re=K.dist(Q),ue=Q.angleTo(K);for(;R+i<I+re;){R+=i;const ce=(R-I)/re,he=fs(K.x,Q.x,ce),Ee=fs(K.y,Q.y,ce);if(he>=0&&he<j&&Ee>=0&&Ee<j&&R-T>=0&&R+T<=A){const we=new ku(he,Ee,0,ue,V);u&&!xR(a,we,g,u,h)||B.push(we)}}I+=re}return b||B.length||x||(B=bR(a,I/2,i,u,h,g,x,!0,j)),B}function wR(a){let t=0,i=0;for(const x of a)t+=x.w*x.h,i=Math.max(i,x.w);a.sort((x,b)=>b.h-x.h);const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),i),h:1/0}];let h=0,g=0;for(const x of a)for(let b=u.length-1;b>=0;b--){const j=u[b];if(!(x.w>j.w||x.h>j.h)){if(x.x=j.x,x.y=j.y,g=Math.max(g,x.y+x.h),h=Math.max(h,x.x+x.w),x.w===j.w&&x.h===j.h){const T=u.pop();T&&b<u.length&&(u[b]=T)}else x.h===j.h?(j.x+=x.w,j.w-=x.w):x.w===j.w?(j.y+=x.h,j.h-=x.h):(u.push({x:j.x+x.w,y:j.y,w:j.w-x.w,h:x.h}),j.y+=x.h,j.h-=x.h);break}}return{w:h,h:g,fill:t/(h*g)||0}}Yt(ku,"Anchor");const Vp=1;class f_{static getImagePositionScale(t,i,u){if(i&&t&&t.options&&t.options.transform){const h=t.options.transform;return{x:h.a,y:h.d}}return{x:u,y:u}}constructor(t,i,u,h){this.paddedRect=t;const{pixelRatio:g,version:x,stretchX:b,stretchY:j,content:T,sdf:A,usvg:I}=i;this.pixelRatio=g,this.stretchX=b,this.stretchY=j,this.content=T,this.version=x,this.padding=u,this.sdf=A,this.usvg=I,this.scale=f_.getImagePositionScale(h,I,g)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Wj(a,t,i){const u=Fl.parse(a),h=function(g,x,b=[1,1]){return{x:0,y:0,w:(g.data?g.data.width:g.width*b[0])+2*x,h:(g.data?g.data.height:g.height*b[1])+2*x}}(t,i,[u.options.transform.a,u.options.transform.d]);return{bin:h,imagePosition:new f_(h,t,i,u),imageVariant:u}}class SR{constructor(t,i,u){const h=new Map,g=new Map;this.haveRenderCallbacks=[];const x=[];this.addImages(t,h,Vp,x),this.addImages(i,g,2,x);const{w:b,h:j}=wR(x),T=new $i({width:b||1,height:j||1});for(const[A,I]of t.entries()){const R=h.get(A).paddedRect;$i.copy(I.data,T,{x:0,y:0},{x:R.x+Vp,y:R.y+Vp},I.data,u,I.sdf)}for(const[A,I]of i.entries()){const R=g.get(A),B=R.paddedRect;let V=R.padding;const K=B.x+V,Q=B.y+V,re=I.data.width,ue=I.data.height;V=V>1?V-1:V,$i.copy(I.data,T,{x:0,y:0},{x:K,y:Q},I.data,u),$i.copy(I.data,T,{x:0,y:ue-V},{x:K,y:Q-V},{width:re,height:V},u),$i.copy(I.data,T,{x:0,y:0},{x:K,y:Q+ue},{width:re,height:V},u),$i.copy(I.data,T,{x:re-V,y:0},{x:K-V,y:Q},{width:V,height:ue},u),$i.copy(I.data,T,{x:0,y:0},{x:K+re,y:Q},{width:V,height:ue},u),$i.copy(I.data,T,{x:re-V,y:ue-V},{x:K-V,y:Q-V},{width:V,height:V},u),$i.copy(I.data,T,{x:0,y:ue-V},{x:K+re,y:Q-V},{width:V,height:V},u),$i.copy(I.data,T,{x:0,y:0},{x:K+re,y:Q+ue},{width:V,height:V},u),$i.copy(I.data,T,{x:re-V,y:0},{x:K-V,y:Q+ue},{width:V,height:V},u)}this.lut=u,this.image=T,this.iconPositions=h,this.patternPositions=g}addImages(t,i,u,h){for(const[g,x]of t.entries()){const{bin:b,imagePosition:j,imageVariant:T}=Wj(g,x,u);i.set(g,j),h.push(b),x.hasRenderCallback&&this.haveRenderCallbacks.push(T.id)}}patchUpdatedImages(t,i,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter(h=>t.hasImage(h,u)),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const h of t.getUpdatedImages(u)){for(const g of this.iconPositions.keys()){const x=Fl.parse(g);if(Do.isEqual(x.id,h)){const b=t.getImage(h,u);this.patchUpdatedImage(this.iconPositions.get(g),b,i)}}for(const g of this.patternPositions.keys()){const x=Fl.parse(g);if(Do.isEqual(x.id,h)){const b=t.getImage(h,u);this.patchUpdatedImage(this.patternPositions.get(g),b,i)}}}}patchUpdatedImage(t,i,u){if(!t||!i||t.version===i.version)return;t.version=i.version;const[h,g]=t.tl,x=t.sdf;if(this.lut||x){const b={width:i.data.width,height:i.data.height},j=new $i(b);$i.copy(i.data,j,{x:0,y:0},{x:0,y:0},b,this.lut,x),u.update(j,{position:{x:h,y:g}})}else u.update(i.data,{position:{x:h,y:g}})}}Yt(f_,"ImagePosition"),Yt(SR,"ImageAtlas");const m_=1e20;function jR(a,t,i,u,h,g,x,b,j){for(let T=t;T<t+u;T++)TR(a,i*g+T,g,h,x,b,j);for(let T=i;T<i+h;T++)TR(a,T*g+t,1,u,x,b,j)}function TR(a,t,i,u,h,g,x){g[0]=0,x[0]=-m_,x[1]=m_,h[0]=a[t];for(let b=1,j=0,T=0;b<u;b++){h[b]=a[t+b*i];const A=b*b;do{const I=g[j];T=(h[b]-h[I]+A-I*I)/(b-I)/2}while(T<=x[j]&&--j>-1);j++,g[j]=b,x[j]=T,x[j+1]=m_}for(let b=0,j=0;b<u;b++){for(;x[j+1]<b;)j++;const T=g[j],A=b-T;a[t+b*i]=h[T]+A*A}}const $l=2,qj={none:0,ideographs:1,all:2};class Zm{constructor(t,i,u){this.requestManager=t,this.localGlyphMode=i,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,i){const u=[],h=this.url||Ii.GLYPHS_URL;for(const g in t)for(const x of t[g])u.push({stack:g,id:x});De(u,({stack:g,id:x},b)=>{let j=this.entries[g];j||(j=this.entries[g]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let T=j.glyphs[x];if(T!==void 0)return void b(null,{stack:g,id:x,glyph:T});if(T=this._tinySDF(j,g,x),T)return j.glyphs[x]=T,void b(null,{stack:g,id:x,glyph:T});const A=Math.floor(x/256);if(256*A>65535)return rn("glyphs > 65535 not supported"),void b(null,{stack:g,id:x,glyph:T});if(j.ranges[A])return void b(null,{stack:g,id:x,glyph:T});let I=j.requests[A];I||(I=j.requests[A]=[],Zm.loadGlyphRange(g,A,h,this.requestManager,(R,B)=>{if(B){j.ascender=B.ascender,j.descender=B.descender;for(const V in B.glyphs)this._doesCharSupportLocalGlyph(+V)||(j.glyphs[+V]=B.glyphs[+V]);j.ranges[A]=!0}for(const V of I)V(R,B);delete j.requests[A]})),I.push((R,B)=>{R?b(R):B&&b(null,{stack:g,id:x,glyph:B.glyphs[x]||null})})},(g,x)=>{if(g)i(g);else if(x){const b={};for(const{stack:j,id:T,glyph:A}of x)b[j]===void 0&&(b[j]={}),b[j].glyphs===void 0&&(b[j].glyphs={}),b[j].glyphs[T]=A&&{id:A.id,bitmap:A.bitmap.clone(),metrics:A.metrics},b[j].ascender=this.entries[j].ascender,b[j].descender=this.entries[j].descender;i(null,b)}})}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==qj.none&&(this.localGlyphMode===qj.all?!!this.localFontFamily:!!this.localFontFamily&&(ys["CJK Unified Ideographs"](t)||ys["Hangul Syllables"](t)||ys.Hiragana(t)||ys.Katakana(t)||ys["CJK Symbols and Punctuation"](t)||ys["CJK Unified Ideographs Extension A"](t)||ys["CJK Unified Ideographs Extension B"](t)||ys.Osage(t)))}_tinySDF(t,i,u){const h=this.localFontFamily;if(!h||!this._doesCharSupportLocalGlyph(u))return;let g=t.tinySDF;if(!g){let K="400";/bold/i.test(i)?K="900":/medium/i.test(i)?K="500":/light/i.test(i)&&(K="200"),g=t.tinySDF=new Zm.TinySDF({fontFamily:h,fontWeight:K,fontSize:24*$l,buffer:3*$l,radius:8*$l}),g.fontWeight=K}if(this.localGlyphs[g.fontWeight][u])return this.localGlyphs[g.fontWeight][u];const x=String.fromCodePoint(u),{data:b,width:j,height:T,glyphWidth:A,glyphHeight:I,glyphLeft:R,glyphTop:B,glyphAdvance:V}=g.draw(x);return this.localGlyphs[g.fontWeight][u]={id:u,bitmap:new Hd({width:j,height:T},b),metrics:{width:A/$l,height:I/$l,left:R/$l,top:B/$l-27,advance:V/$l,localGlyph:!0}}}}Zm.loadGlyphRange=function(a,t,i,u,h){const g=256*t,x=g+255,b=u.transformRequest(u.normalizeGlyphsURL(i).replace("{fontstack}",a).replace("{range}",`${g}-${x}`),Qh.Glyphs);ep(b,(j,T)=>{if(j)h(j);else if(T){const A={},I=function(R){return new H1(R).readFields(V7,{})}(T);for(const R of I.glyphs)A[R.id]=R;h(null,{glyphs:A,ascender:I.ascender,descender:I.descender})}})},Zm.TinySDF=class{constructor({fontSize:a=24,buffer:t=3,radius:i=8,cutoff:u=.25,fontFamily:h="sans-serif",fontWeight:g="normal",fontStyle:x="normal"}={}){this.buffer=t,this.cutoff=u,this.radius=i;const b=this.size=a+4*t,j=this._createCanvas(b),T=this.ctx=j.getContext("2d",{willReadFrequently:!0});T.font=`${x} ${g} ${a}px ${h}`,T.textBaseline="alphabetic",T.textAlign="left",T.fillStyle="black",this.gridOuter=new Float64Array(b*b),this.gridInner=new Float64Array(b*b),this.f=new Float64Array(b),this.z=new Float64Array(b+1),this.v=new Uint16Array(b)}_createCanvas(a){const t=document.createElement("canvas");return t.width=t.height=a,t}draw(a){const{width:t,actualBoundingBoxAscent:i,actualBoundingBoxDescent:u,actualBoundingBoxLeft:h,actualBoundingBoxRight:g}=this.ctx.measureText(a),x=Math.ceil(i),b=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(g-h))),j=Math.min(this.size-this.buffer,x+Math.ceil(u)),T=b+2*this.buffer,A=j+2*this.buffer,I=Math.max(T*A,0),R=new Uint8ClampedArray(I),B={data:R,width:T,height:A,glyphWidth:b,glyphHeight:j,glyphTop:x,glyphLeft:0,glyphAdvance:t};if(b===0||j===0)return B;const{ctx:V,buffer:K,gridInner:Q,gridOuter:re}=this;V.clearRect(K,K,b,j),V.fillText(a,K,K+x);const ue=V.getImageData(K,K,b,j);re.fill(m_,0,I),Q.fill(0,0,I);for(let ce=0;ce<j;ce++)for(let he=0;he<b;he++){const Ee=ue.data[4*(ce*b+he)+3]/255;if(Ee===0)continue;const we=(ce+K)*T+he+K;if(Ee===1)re[we]=0,Q[we]=m_;else{const je=.5-Ee;re[we]=je>0?je*je:0,Q[we]=je<0?je*je:0}}jR(re,0,0,T,A,T,this.f,this.v,this.z),jR(Q,K,K,b,j,T,this.f,this.v,this.z);for(let ce=0;ce<I;ce++){const he=Math.sqrt(re[ce])-Math.sqrt(Q[ce]);R[ce]=Math.round(255-255*(he/this.radius+this.cutoff))}return B}};const Zd=Vp;function NR(a,t){return a+t[1]-t[0]}function ER(a,t,i,u,h=1){const g=[],x=a.imagePrimary,b=x.pixelRatio,j=x.paddedRect.w-2*Zd,T=x.paddedRect.h-2*Zd,A=(a.right-a.left)*h,I=(a.bottom-a.top)*h,R=x.stretchX||[[0,j]],B=x.stretchY||[[0,T]],V=R.reduce(NR,0),K=B.reduce(NR,0),Q=j-V,re=T-K;let ue=0,ce=V,he=0,Ee=K,we=0,je=Q,Me=0,ke=re;if(x.content&&u){const Fe=x.content;ue=q1(R,0,Fe[0]),he=q1(B,0,Fe[1]),ce=q1(R,Fe[0],Fe[2]),Ee=q1(B,Fe[1],Fe[3]),we=Fe[0]-ue,Me=Fe[1]-he,je=Fe[2]-Fe[0]-ce,ke=Fe[3]-Fe[1]-Ee}const Qe=(Fe,st,Tt,lt)=>{const gt=Z1(Fe.stretch-ue,ce,A,a.left*h),St=K1(Fe.fixed-we,je,Fe.stretch,V),Ye=Z1(st.stretch-he,Ee,I,a.top*h),_t=K1(st.fixed-Me,ke,st.stretch,K),Ve=Z1(Tt.stretch-ue,ce,A,a.left*h),Je=K1(Tt.fixed-we,je,Tt.stretch,V),Ct=Z1(lt.stretch-he,Ee,I,a.top*h),vt=K1(lt.fixed-Me,ke,lt.stretch,K),os=new et(gt,Ye),Jt=new et(Ve,Ye),ft=new et(Ve,Ct),bt=new et(gt,Ct),ts=new et(St/b,_t/b),qt=new et(Je/b,vt/b),kt=t*Math.PI/180;if(kt){const on=Math.sin(kt),Gs=Math.cos(kt),nr=[Gs,-on,on,Gs];os._matMult(nr),Jt._matMult(nr),bt._matMult(nr),ft._matMult(nr)}const Zt=Fe.stretch+Fe.fixed,xs=Tt.stretch+Tt.fixed,As=st.stretch+st.fixed,zs=lt.stretch+lt.fixed,ks=a.imageSecondary;return{tl:os,tr:Jt,bl:bt,br:ft,texPrimary:{x:x.paddedRect.x+Zd+Zt,y:x.paddedRect.y+Zd+As,w:xs-Zt,h:zs-As},texSecondary:ks?{x:ks.paddedRect.x+Zd+Zt,y:ks.paddedRect.y+Zd+As,w:xs-Zt,h:zs-As}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ts,pixelOffsetBR:qt,minFontScaleX:je/b/A,minFontScaleY:ke/b/I,isSDF:i}};if(u&&(x.stretchX||x.stretchY)){const Fe=CR(R,Q,V),st=CR(B,re,K);for(let Tt=0;Tt<Fe.length-1;Tt++){const lt=Fe[Tt],gt=Fe[Tt+1];for(let St=0;St<st.length-1;St++)g.push(Qe(lt,st[St],gt,st[St+1]))}}else g.push(Qe({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:j+1},{fixed:0,stretch:T+1}));return g}function q1(a,t,i){let u=0;for(const h of a)u+=Math.max(t,Math.min(i,h[1]))-Math.max(t,Math.min(i,h[0]));return u}function CR(a,t,i){const u=[{fixed:-Zd,stretch:0}];for(const[h,g]of a){const x=u[u.length-1];u.push({fixed:h-x.stretch,stretch:x.stretch}),u.push({fixed:h-x.stretch,stretch:x.stretch+(g-h)})}return u.push({fixed:t+Zd,stretch:i}),u}function Z1(a,t,i,u){return a/t*i+u}function K1(a,t,i,u){return a-t*i/u}function K7(a,t,i,u){const h=t+a.positionedLines[u].lineOffset;return u===0?i+h/2:i+(h+(t+a.positionedLines[u-1].lineOffset))/2}function X7(a,t=1,i=!1){let u=1/0,h=1/0,g=-1/0,x=-1/0;const b=a[0];for(let B=0;B<b.length;B++){const V=b[B];(!B||V.x<u)&&(u=V.x),(!B||V.y<h)&&(h=V.y),(!B||V.x>g)&&(g=V.x),(!B||V.y>x)&&(x=V.y)}const j=Math.min(g-u,x-h);let T=j/2;const A=new Xf([],Y7);if(j===0)return new et(u,h);for(let B=u;B<g;B+=j)for(let V=h;V<x;V+=j)A.push(new Km(B+T,V+T,T,a));let I=function(B){let V=0,K=0,Q=0;const re=B[0];for(let ue=0,ce=re.length,he=ce-1;ue<ce;he=ue++){const Ee=re[ue],we=re[he],je=Ee.x*we.y-we.x*Ee.y;K+=(Ee.x+we.x)*je,Q+=(Ee.y+we.y)*je,V+=3*je}return new Km(K/V,Q/V,0,B)}(a),R=A.length;for(;A.length;){const B=A.pop();(B.d>I.d||!I.d)&&(I=B,i&&console.log("found best %d after %d probes",Math.round(1e4*B.d)/1e4,R)),B.max-I.d<=t||(T=B.h/2,A.push(new Km(B.p.x-T,B.p.y-T,T,a)),A.push(new Km(B.p.x+T,B.p.y-T,T,a)),A.push(new Km(B.p.x-T,B.p.y+T,T,a)),A.push(new Km(B.p.x+T,B.p.y+T,T,a)),R+=4)}return i&&(console.log(`num probes: ${R}`),console.log(`best distance: ${I.d}`)),I.p}function Y7(a,t){return t.max-a.max}class Km{constructor(t,i,u,h){this.p=new et(t,i),this.h=u,this.d=function(g,x){let b=!1,j=1/0;for(let T=0;T<x.length;T++){const A=x[T];for(let I=0,R=A.length,B=R-1;I<R;B=I++){const V=A[I],K=A[B];V.y>g.y!=K.y>g.y&&g.x<(K.x-V.x)*(g.y-V.y)/(K.y-V.y)+V.x&&(b=!b),j=Math.min(j,oa(g,V,K))}}return(b?1:-1)*Math.sqrt(j)}(this.p,h),this.max=this.d+this.h*Math.SQRT2}}const J7=Object.keys,Zj=Number.POSITIVE_INFINITY,Q7=Math.sqrt(2);function AR(a,[t,i]){let u=0,h=0;if(i===Zj){t<0&&(t=0);const g=t/Q7;switch(a){case"top-right":case"top-left":h=g-7;break;case"bottom-right":case"bottom-left":h=7-g;break;case"bottom":h=7-t;break;case"top":h=t-7}switch(a){case"top-right":case"bottom-right":u=-g;break;case"top-left":case"bottom-left":u=g;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),i=Math.abs(i),a){case"top-right":case"top-left":case"top":h=i-7;break;case"bottom-right":case"bottom-left":case"bottom":h=7-i}switch(a){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,h]}function X1(a,t,i,u,h,g,x,b,j){if(!t||!t.usvg)return;const T=mR(u),A=mR(h),I=g!=="both"&&g!=="width"||!pR(u)?1:A.width/T.width,R=g!=="both"&&g!=="height"||!fR(u)?1:A.height/T.height;i.scaleSelf(I,R);const B=i.toString();x.set(B,i),b.set(B,t);const{imagePosition:V}=Wj(B,t,Vp);j.set(B,V)}function PR(a,t,i,u,h,g,x,b,j){if(!a)return;const T=function(A,I,R,B,V,K){if(A.kind==="camera")return A.maxSize;if(A.kind==="composite"){const Q=I.possiblyEvaluate(new Mn(A.maxZoom,{worldview:K}),R).evaluate(V,{},R),re=I.possiblyEvaluate(new Mn(A.minZoom,{worldview:K}),R).evaluate(V,{},R);return Math.max(Q,re)}return I.possiblyEvaluate(new Mn(B,{worldview:K})).evaluate(V,{},R)}(t,i,u,h,g,j);return a.scaleSelf(T*b*x)}function IR(a,t,i,u,h,g,x,b,j){return{iconPrimary:PR(a.getPrimary(),t,i,u,h,g,x,b,j),iconSecondary:PR(a.getSecondary(),t,i,u,h,g,x,b,j)}}function eH(a,t,i){if(!t)return;const u=i.get(a.toString()),h=i.get(t.toString());h&&(u.paddedRect.w===h.paddedRect.w&&u.paddedRect.h===h.paddedRect.h||rn(`Mismatch in icon variant sizes: ${a.toString()} and ${t.toString()}`),u.usvg!==h.usvg&&rn(`Mismatch in icon variant image types: ${a.id} and ${t.id}`))}function MR(a,t,i,u){if(!a)return;const h=t.get(i.toString());if(a.imagePrimary=h,u){const g=t.get(u.toString());a.imageSecondary=g}}function tH(a,t){for(const i in a.horizontal)RR(a.horizontal[i],t);RR(a.vertical,t)}function RR(a,t){if(a){for(const i of a.positionedLines)for(const u of i.positionedGlyphs)if(u.image!==null){const h=u.image.toString();u.rect=t.get(h).paddedRect}}}function Kj(a){switch(a){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function sH(a,t,i,u,h,g,x,b,j){const T=Xj(g.horizontal)||g.vertical,A=i.get("icon-text-fit-padding").evaluate(u,{},h);let I,R=t;return t&&j!=="none"&&(a.allowVerticalPlacement&&g.vertical&&(I=hR(t,g.vertical,j,A,b,x)),T&&(R=hR(t,T,j,A,b,x))),{defaultShapedIcon:R,verticallyShapedIcon:I}}function nH(a,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re,ue,ce){let he=x.textMaxSize.evaluate(t,{},R);he===void 0?he=b*x.textScaleFactor:he*=x.textScaleFactor;const Ee=a.layers[0].layout,we=Xj(i.horizontal)||i.vertical,je=B.name==="globe",Me=wi,ke=a.tilePixelRatio*he/Me,Qe=(St=a.overscaling,a.zoom>18&&St>2&&(St>>=1),Math.max(Rt/(512*St),1)*Ee.get("symbol-spacing")),Fe=Ee.get("text-padding")*a.tilePixelRatio,st=Ee.get("icon-padding")*a.tilePixelRatio,Tt=Ks(Ee.get("text-max-angle")),lt=Ee.get("icon-rotation-alignment")==="map"&&ce!=="point",gt=Qe/2;var St;a.hasAnyIconTextFit===!1&&Q!=="none"&&(a.hasAnyIconTextFit=!0);const Ye=t.properties?+t.properties[Wt]:null,_t=Ye&&a.elevationFeatureIdToIndex?a.elevationFeatureIdToIndex.get(Ye):65535,Ve=(Je,Ct,vt)=>{if(Ct.x<0||Ct.x>=Rt||Ct.y<0||Ct.y>=Rt)return;let os=null;if(je){const{x:Jt,y:ft,z:bt}=B.projectTilePoint(Ct.x,Ct.y,vt);os={anchor:new ku(Jt,ft,bt,0,void 0),up:B.upVector(vt,Ct.x,Ct.y)}}(function(Jt,ft,bt,ts,qt,kt,Zt,xs,As,zs,ks,on,Gs,nr,me,ge,Ze,At,Ft,zt,es,js,Qs,en,Bs,Rn,br,Os,ar){const Yn=Jt.addToLineVertexArray(ft,ts);let An,xr,rr,Jn,tr,In,Vs,kn=0,yr=0,_s=0,un=0,ir=-1,jr=-1;const lr={};let qr=dd("");const On=bt?bt.anchor:ft,Ur=Os!=="none";let Fo=0,Gi=0;if(As._unevaluatedLayout.getValue("text-radial-offset")===void 0){const Zr=As.layout.get("text-offset").evaluate(es,{},Bs);Fo=Zr[0]*wi,Gi=Zr[1]*wi}else Fo=As.layout.get("text-radial-offset").evaluate(es,{},Bs)*wi,Gi=Zj;if(Jt.allowVerticalPlacement&&qt.vertical){const Zr=qt.vertical;if(me)In=Yj(Zr),xs&&(Vs=Yj(xs));else{const ni=As.layout.get("text-rotate").evaluate(es,{},Bs)+90;rr=Y1(zs,On,ft,ks,on,Gs,Zr,nr,ni,ge),xs&&(Jn=Y1(zs,On,ft,ks,on,Gs,xs,At,ni))}}if(kt){const Zr=Jt.iconSizeData,ni=As.layout.get("icon-rotate").evaluate(es,{},Bs),Hi=ER(kt,ni,Qs,Ur,js.iconScaleFactor),xo=xs?ER(xs,ni,Qs,Ur,js.iconScaleFactor):void 0;xr=Y1(zs,On,ft,ks,on,Gs,kt,At,ni,null),kn=4*Hi.length;let so=null;Zr.kind==="source"?(so=[Bc*As.layout.get("icon-size").evaluate(es,{},Bs)*js.iconScaleFactor],so[0]>Kd&&rn(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${g_}. Reduce your "icon-size".`)):Zr.kind==="composite"&&(so=[Bc*js.compositeIconSizes[0].evaluate(es,{},Bs)*js.iconScaleFactor,Bc*js.compositeIconSizes[1].evaluate(es,{},Bs)*js.iconScaleFactor],(so[0]>Kd||so[1]>Kd)&&rn(`${Jt.layerIds[0]}: Value for "icon-size" is >= ${g_}. Reduce your "icon-size".`)),Jt.addSymbols(Jt.icon,Hi,so,zt,Ft,es,void 0,bt,ft,Yn.lineStartIndex,Yn.lineLength,-1,en,Bs,Rn,br),ir=Jt.icon.placedSymbolArray.length-1,xo&&(yr=4*xo.length,Jt.addSymbols(Jt.icon,xo,so,zt,Ft,es,da.vertical,bt,ft,Yn.lineStartIndex,Yn.lineLength,-1,en,Bs,Rn,br),jr=Jt.icon.placedSymbolArray.length-1)}for(const Zr in qt.horizontal){const ni=Zr,Hi=qt.horizontal[ni];An||(qr=dd(Hi.text),me?tr=Yj(Hi):An=Y1(zs,On,ft,ks,on,Gs,Hi,nr,As.layout.get("text-rotate").evaluate(es,{},Bs),ge));const xo=Hi.positionedLines.length===1;if(_s+=kR(Jt,bt,ft,Hi,Zt,As,me,es,ge,Yn,qt.vertical?da.horizontal:da.horizontalOnly,xo?J7(qt.horizontal):[ni],lr,ir,js,en,Bs,Rn),xo)break}qt.vertical&&(un+=kR(Jt,bt,ft,qt.vertical,Zt,As,me,es,ge,Yn,da.vertical,["vertical"],lr,jr,js,en,Bs,Rn));let Mi=-1;const Bo=(Zr,ni)=>Zr?Math.max(Zr,ni):ni;Mi=Bo(tr,Mi),Mi=Bo(In,Mi),Mi=Bo(Vs,Mi);const Vc=Mi>-1?1:0;Jt.glyphOffsetArray.length>=65535&&rn("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),es.sortKey!==void 0&&Jt.addToSortKeyRanges(Jt.symbolInstances.length,es.sortKey),Jt.symbolInstances.emplaceBack(ft.x,ft.y,On.x,On.y,On.z,lr.right>=0?lr.right:-1,lr.center>=0?lr.center:-1,lr.left>=0?lr.left:-1,lr.vertical>=0?lr.vertical:-1,ir,jr,qr,An!==void 0?An:Jt.collisionBoxArray.length,An!==void 0?An+1:Jt.collisionBoxArray.length,rr!==void 0?rr:Jt.collisionBoxArray.length,rr!==void 0?rr+1:Jt.collisionBoxArray.length,xr!==void 0?xr:Jt.collisionBoxArray.length,xr!==void 0?xr+1:Jt.collisionBoxArray.length,Jn||Jt.collisionBoxArray.length,Jn?Jn+1:Jt.collisionBoxArray.length,ks,_s,un,kn,yr,Vc,0,Fo,Gi,Mi,0,Ur?1:0,ar)})(a,Ct,os,Je,i,u,g,h,a.layers[0],a.collisionBoxArray,t.index,t.sourceLayerIndex,a.index,Fe,ue,T,0,st,lt,re,t,x,A,I,R,V,K,Q,_t)};if(ce==="line")for(const Je of z1(t.geometry,0,0,Rt,Rt)){const Ct=Z7(Je,Qe,Tt,i.vertical||we,u,Me,ke,a.overscaling,Rt);for(const vt of Ct)we&&rH(a,we.text,gt,vt)||Ve(Je,vt,R)}else if(ce==="line-center"){for(const Je of t.geometry)if(Je.length>1){const Ct=q7(Je,Tt,i.vertical||we,u,Me,ke);Ct&&Ve(Je,Ct,R)}}else if(t.type==="Polygon")for(const Je of Jy(t.geometry,0)){const Ct=X7(Je,16);Ve(Je[0],new ku(Ct.x,Ct.y,0,0,void 0),R)}else if(t.type==="LineString")for(const Je of t.geometry)Ve(Je,new ku(Je[0].x,Je[0].y,0,0,void 0),R);else if(t.type==="Point")for(const Je of t.geometry)for(const Ct of Je)Ve([Ct],new ku(Ct.x,Ct.y,0,0,void 0),R)}const g_=255,Kd=g_*Bc;function kR(a,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q,re){const ue=function(Ee,we,je,Me,ke,Qe,Fe,st){const Tt=[];if(we.positionedLines.length===0)return Tt;const lt=Me.layout.get("text-rotate").evaluate(Qe,{})*Math.PI/180,gt=function(Je){const Ct=Je[0],vt=Je[1],os=Ct*vt;return os>0?[Ct,-vt]:os<0?[-Ct,vt]:Ct===0?[vt,Ct]:[vt,-Ct]}(je);let St=Math.abs(we.top-we.bottom);for(const Je of we.positionedLines)St-=Je.lineOffset;const Ye=we.positionedLines.length,_t=St/Ye;let Ve=we.top-je[1];for(let Je=0;Je<Ye;++Je){const Ct=we.positionedLines[Je];Ve=K7(we,_t,Ve,Je);for(const vt of Ct.positionedGlyphs){if(!vt.rect)continue;const os=vt.rect||{};let Jt=iR+1,ft=!0,bt=1,ts=0;if(vt.image){const es=Fe.get(vt.image.toString());if(!es)continue;if(es.sdf){rn("SDF images are not supported in formatted text and will be ignored.");continue}ft=!1,bt=es.pixelRatio,Jt=Vp/bt}const qt=(ke||st)&&vt.vertical,kt=vt.metrics.advance*vt.scale/2,Zt=vt.metrics,xs=vt.rect;if(xs===null)continue;st&&we.verticalizable&&(ts=vt.image?kt-vt.metrics.width*vt.scale/2:0);const As=ke?[vt.x+kt,vt.y]:[0,0];let zs=[0,0],ks=[0,0],on=!1;ke||(qt?(ks=[vt.x+kt+gt[0],vt.y+gt[1]-ts],on=!0):zs=[vt.x+kt+je[0],vt.y+je[1]-ts]);const Gs=xs.w*vt.scale/(bt*(vt.localGlyph?$l:1)),nr=xs.h*vt.scale/(bt*(vt.localGlyph?$l:1));let me,ge,Ze,At;if(qt){const es=vt.y-Ve,js=new et(-kt,kt-es),Qs=-Math.PI/2,en=new et(...ks);me=new et(-kt+zs[0],zs[1]),me._rotateAround(Qs,js)._add(en),me.x+=-es+kt,me.y-=(Zt.left-Jt)*vt.scale;const Bs=vt.image?Zt.advance*vt.scale:wi*vt.scale,Rn=String.fromCodePoint(vt.glyph);P7(Rn)?me.x+=(1-Jt)*vt.scale:I7(Rn)?me.x+=Bs-Zt.height*vt.scale+(-Jt-1)*vt.scale:me.x+=vt.image||Zt.width+2*Jt===xs.w&&Zt.height+2*Jt===xs.h?(Bs-nr)/2:(Bs-(Zt.height+2*Jt)*vt.scale)/2,ge=new et(me.x,me.y-Gs),Ze=new et(me.x+nr,me.y),At=new et(me.x+nr,me.y-Gs)}else{const es=(Zt.left-Jt)*vt.scale-kt+zs[0],js=(-Zt.top-Jt)*vt.scale+zs[1],Qs=es+Gs,en=js+nr;me=new et(es,js),ge=new et(Qs,js),Ze=new et(es,en),At=new et(Qs,en)}if(lt){let es;es=ke?new et(0,0):on?new et(gt[0],gt[1]):new et(je[0],je[1]),me._rotateAround(lt,es),ge._rotateAround(lt,es),Ze._rotateAround(lt,es),At._rotateAround(lt,es)}const Ft=new et(0,0),zt=new et(0,0);Tt.push({tl:me,tr:ge,bl:Ze,br:At,texPrimary:os,texSecondary:void 0,writingMode:we.writingMode,glyphOffset:As,sectionIndex:vt.sectionIndex,isSDF:ft,pixelOffsetTL:Ft,pixelOffsetBR:zt,minFontScaleX:0,minFontScaleY:0})}}return Tt}(0,u,j,g,x,b,h,a.allowVerticalPlacement),ce=a.textSizeData;let he=null;ce.kind==="source"?(he=[Bc*g.layout.get("text-size").evaluate(b,{},Q)*V.textScaleFactor],he[0]>Kd&&rn(`${a.layerIds[0]}: Value for "text-size" is >= ${g_}. Reduce your "text-size".`)):ce.kind==="composite"&&(he=[Bc*V.compositeTextSizes[0].evaluate(b,{},Q)*V.textScaleFactor,Bc*V.compositeTextSizes[1].evaluate(b,{},Q)*V.textScaleFactor],(he[0]>Kd||he[1]>Kd)&&rn(`${a.layerIds[0]}: Value for "text-size" is >= ${g_}. Reduce your "text-size".`)),a.addSymbols(a.text,ue,he,j,x,b,A,t,i,T.lineStartIndex,T.lineLength,B,K,Q,re,!1);for(const Ee of I)R[Ee]=a.text.placedSymbolArray.length-1;return 4*ue.length}function Xj(a){for(const t in a)return a[t];return null}function Y1(a,t,i,u,h,g,x,b,j,T){let A=x.top,I=x.bottom,R=x.left,B=x.right;if(dR(x)&&x.collisionPadding){const V=x.collisionPadding;R-=V[0],A-=V[1],B+=V[2],I+=V[3]}if(j){const V=new et(R,A),K=new et(B,A),Q=new et(R,I),re=new et(B,I),ue=Ks(j);let ce=new et(0,0);T&&(ce=new et(T[0],T[1])),V._rotateAround(ue,ce),K._rotateAround(ue,ce),Q._rotateAround(ue,ce),re._rotateAround(ue,ce),R=Math.min(V.x,K.x,Q.x,re.x),B=Math.max(V.x,K.x,Q.x,re.x),A=Math.min(V.y,K.y,Q.y,re.y),I=Math.max(V.y,K.y,Q.y,re.y)}return a.emplaceBack(t.x,t.y,t.z,i.x,i.y,R,A,B,I,b,u,h,g),a.length-1}function Yj(a){dR(a)&&a.collisionPadding&&(a.top-=a.collisionPadding[1],a.bottom+=a.collisionPadding[3]);const t=a.bottom-a.top;return t>0?Math.max(10,t):null}function rH(a,t,i,u){const h=a.compareText;if(t in h){const g=h[t];for(let x=g.length-1;x>=0;x--)if(u.dist(g[x])<i)return!0}else h[t]=[];return h[t].push(u),!1}function DR(a,t){const i=a.fovAboveCenter,u=a.elevation?a.elevation.getMinElevationBelowMSL()*t:0,h=(a._camera.position[2]*a.worldSize-u)/Math.cos(a._pitch),g=Math.sin(i)*h/Math.sin(Math.max(Math.PI/2-a._pitch-i,.01));let x=Math.sin(a._pitch)*g+h;const b=h*(1/a._horizonShift);if(!a.elevation||a.elevation.exaggeration()===0){let j=Math.max(a.zoom-17,0);a.isOrthographic&&(j/=10),x*=1+j}return Math.min(1.01*x,b)}function x_(a,t){if(!t.isReprojectedInTileSpace)return{scale:1<<a.z,x:a.x,y:a.y,x2:a.x+1,y2:a.y+1,projection:t};const i=Math.pow(2,-a.z),u=a.x*i,h=(a.x+1)*i,g=a.y*i,x=(a.y+1)*i,b=le(u),j=le(h),T=de(g),A=de(x),I=t.project(b,T),R=t.project(j,T),B=t.project(j,A),V=t.project(b,A);let K=Math.min(I.x,R.x,B.x,V.x),Q=Math.min(I.y,R.y,B.y,V.y),re=Math.max(I.x,R.x,B.x,V.x),ue=Math.max(I.y,R.y,B.y,V.y);const ce=i/16;function he(we,je,Me,ke,Qe,Fe){const st=(Me+Qe)/2,Tt=(ke+Fe)/2,lt=t.project(le(st),de(Tt)),gt=Math.max(0,K-lt.x,Q-lt.y,lt.x-re,lt.y-ue);K=Math.min(K,lt.x),re=Math.max(re,lt.x),Q=Math.min(Q,lt.y),ue=Math.max(ue,lt.y),gt>ce&&(he(we,lt,Me,ke,st,Tt),he(lt,je,st,Tt,Qe,Fe))}he(I,R,u,g,h,g),he(R,B,h,g,h,x),he(B,V,h,x,u,x),he(V,I,u,x,u,g),K-=ce,Q-=ce,re+=ce,ue+=ce;const Ee=1/Math.max(re-K,ue-Q);return{scale:Ee,x:K*Ee,y:Q*Ee,x2:re*Ee,y2:ue*Ee,projection:t}}function LR(a,{x:t,y:i},u=0){return new et(((t-u)*a.scale-a.x)*Rt,(i*a.scale-a.y)*Rt)}const iH=H(new Float32Array(16));class Xd{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,i){return{x:0,y:0,z:0}}unproject(t,i){return new D(0,0)}projectTilePoint(t,i,u){return{x:t,y:i,z:0}}locationPoint(t,i,u,h=!0){return t._coordinatePoint(t.locationCoordinate(i,u),h)}pixelsPerMeter(t,i){return te(1,t)*i}pixelSpaceConversion(t,i,u){return 1}farthestPixelDistance(t){return DR(t,t.pixelsPerMeter)}pointCoordinate(t,i,u,h){const g=t.horizonLineFromTop(!1),x=new et(i,Math.max(g,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(x,h))}pointCoordinate3D(t,i,u){const h=new et(i,u);if(t.elevation)return t.elevation.pointCoordinate(h);{const g=this.pointCoordinate(t,h.x,h.y,0);return[g.x,g.y,g.z]}}isPointAboveHorizon(t,i){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,i.x,i.y);const u=t.horizonLineFromTop();return i.y<u}createInversionMatrix(t,i){return iH}createTileMatrix(t,i,u){let h,g,x;const b=u.canonical,j=H(new Float64Array(16));if(this.isReprojectedInTileSpace){const T=x_(b,this);h=1,g=T.x+u.wrap*T.scale,x=T.y,q(j,j,[h/T.scale,h/T.scale,t.pixelsPerMeter/i])}else h=i/t.zoomScale(b.z),g=(b.x+Math.pow(2,b.z)*u.wrap)*h,x=b.y*h;return W(j,j,[g,x,0]),q(j,j,[h/Rt,h/Rt,1]),j}upVector(t,i,u){return[0,0,1]}upVectorScale(t,i,u){return{metersToTile:1}}}class oH extends Xd{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[i,u]=this.parallels=t.parallels||[29.5,45.5],h=Math.sin(Ks(i));this.n=(h+Math.sin(Ks(u)))/2,this.c=1+h*(2*this.n-h),this.r0=Math.sqrt(this.c)/this.n}project(t,i){const{n:u,c:h,r0:g}=this,x=Ks(t-this.center[0]),b=Ks(i),j=Math.sqrt(h-2*u*Math.sin(b))/u;return{x:j*Math.sin(x*u),y:j*Math.cos(x*u)-g,z:0}}unproject(t,i){const{n:u,c:h,r0:g}=this,x=g+i;let b=Math.atan2(t,Math.abs(x))*Math.sign(x);x*u<0&&(b-=Math.PI*Math.sign(t)*Math.sign(x));const j=Ks(this.center[0])*u;b=qe(b,-Math.PI-j,Math.PI-j);const T=xe(Be(b/u)+this.center[0],-180,180),A=Math.asin(xe((h-(t*t+x*x)*u*u)/(2*u),-1,1)),I=xe(Be(A),-ye,ye);return new D(T,I)}}const y_=1.340264,__=-.081106,v_=893e-6,b_=.003796,J1=Math.sqrt(3)/2;class aH extends Xd{project(t,i){i=i/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(J1*Math.sin(i)),h=u*u,g=h*h*h;return{x:.5*(t*Math.cos(u)/(J1*(y_+3*__*h+g*(7*v_+9*b_*h)))/Math.PI+.5),y:1-.5*(u*(y_+__*h+g*(v_+b_*h))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=u*u,g=h*h*h;for(let A,I,R,B=0;B<12&&(I=u*(y_+__*h+g*(v_+b_*h))-i,R=y_+3*__*h+g*(7*v_+9*b_*h),A=I/R,u=xe(u-A,-Math.PI/3,Math.PI/3),h=u*u,g=h*h*h,!(Math.abs(A)<1e-12));++B);const x=J1*t*(y_+3*__*h+g*(7*v_+9*b_*h))/Math.cos(u),b=Math.asin(Math.sin(u)/J1),j=xe(180*x/Math.PI,-180,180),T=xe(180*b/Math.PI,-ye,ye);return new D(j,T)}}class lH extends Xd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){return{x:.5+t/360,y:.5-i/360,z:0}}unproject(t,i){const u=360*(t-.5),h=xe(360*(.5-i),-ye,ye);return new D(u,h)}}const Xm=Math.PI/2;function Q1(a){return Math.tan((Xm+a)/2)}class cH extends Xd{constructor(t){super(t),this.center=t.center||[0,30];const[i,u]=this.parallels=t.parallels||[30,30];let h=Ks(i),g=Ks(u);this.southernCenter=h+g<0,this.southernCenter&&(h=-h,g=-g);const x=Math.cos(h),b=Q1(h);this.n=h===g?Math.sin(h):Math.log(x/Math.cos(g))/Math.log(Q1(g)/b),this.f=x*Math.pow(Q1(h),this.n)/this.n}project(t,i){i=Ks(i),this.southernCenter&&(i=-i),t=Ks(t-this.center[0]);const u=1e-6,{n:h,f:g}=this;g>0?i<-Xm+u&&(i=-Xm+u):i>Xm-u&&(i=Xm-u);const x=g/Math.pow(Q1(i),h);let b=x*Math.sin(h*t),j=g-x*Math.cos(h*t);return b=.5*(b/Math.PI+.5),j=.5*(j/Math.PI+.5),{x:b,y:this.southernCenter?j:1-j,z:0}}unproject(t,i){t=(2*t-.5)*Math.PI,this.southernCenter&&(i=1-i),i=(2*(1-i)-.5)*Math.PI;const{n:u,f:h}=this,g=h-i,x=Math.sign(g),b=Math.sign(u)*Math.sqrt(t*t+g*g);let j=Math.atan2(t,Math.abs(g))*x;g*u<0&&(j-=Math.PI*Math.sign(t)*x);const T=xe(Be(j/u)+this.center[0],-180,180),A=xe(Be(2*Math.atan(Math.pow(h/b,1/u))-Xm),-ye,ye);return new D(T,this.southernCenter?-A:A)}}class zR extends Xd{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,i){return{x:J(t),y:se(i),z:0}}unproject(t,i){const u=le(t),h=de(i);return new D(u,h)}}const OR=Ks(ye);class uH extends Xd{project(t,i){const u=(i=Ks(i))*i,h=u*u;return{x:.5*((t=Ks(t))*(.8707-.131979*u+h*(h*(.003971*u-.001529*h)-.013791))/Math.PI+.5),y:1-.5*(i*(1.007226+u*(.015085+h*(.028874*u-.044475-.005916*h)))/Math.PI+1),z:0}}unproject(t,i){t=(2*t-.5)*Math.PI;let u=i=(2*(1-i)-1)*Math.PI,h=25,g=0,x=u*u;do{x=u*u;const T=x*x;g=(u*(1.007226+x*(.015085+T*(.028874*x-.044475-.005916*T)))-i)/(1.007226+x*(.045255+T*(.259866*x-.311325-.005916*11*T))),u=xe(u-g,-OR,OR)}while(Math.abs(g)>1e-6&&--h>0);x=u*u;const b=xe(Be(t/(.8707+x*(x*(x*x*x*(.003971-.001529*x)-.013791)-.131979))),-180,180),j=Be(u);return new D(b,j)}}const FR=Ks(ye);class dH extends Xd{project(t,i){i=Ks(i),t=Ks(t);const u=Math.cos(i),h=2/Math.PI,g=Math.acos(u*Math.cos(t/2)),x=Math.sin(g)/g,b=.5*(t*h+2*u*Math.sin(t/2)/x)||0,j=.5*(i+Math.sin(i)/x)||0;return{x:.5*(b/Math.PI+.5),y:1-.5*(j/Math.PI+1),z:0}}unproject(t,i){let u=t=(2*t-.5)*Math.PI,h=i=(2*(1-i)-1)*Math.PI,g=25;const x=1e-6;let b=0,j=0;do{const T=Math.cos(h),A=Math.sin(h),I=2*A*T,R=A*A,B=T*T,V=Math.cos(u/2),K=Math.sin(u/2),Q=2*V*K,re=K*K,ue=1-B*V*V,ce=ue?1/ue:0,he=ue?Math.acos(T*V)*Math.sqrt(1/ue):0,Ee=.5*(2*he*T*K+2*u/Math.PI)-t,we=.5*(he*A+h)-i,je=.5*ce*(B*re+he*T*V*R)+1/Math.PI,Me=ce*(Q*I/4-he*A*K),ke=.125*ce*(I*K-he*A*B*Q),Qe=.5*ce*(R*V+he*re*T)+.5,Fe=Me*ke-Qe*je;b=(we*Me-Ee*Qe)/Fe,j=(Ee*ke-we*je)/Fe,u=xe(u-b,-Math.PI,Math.PI),h=xe(h-j,-FR,FR)}while((Math.abs(b)>x||Math.abs(j)>x)&&--g>0);return new D(Be(u),Be(h))}}class BR extends Xd{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ks(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,i){const{scale:u,cosPhi:h}=this;return{x:Ks(t)*h*u+.5,y:-Math.sin(Ks(i))/h*u+.5,z:0}}unproject(t,i){const{scale:u,cosPhi:h}=this,g=-(i-.5)/u,x=xe(Be((t-.5)/u)/h,-180,180),b=Math.asin(xe(g*h,-1,1)),j=xe(Be(b),-ye,ye);return new D(x,j)}}class hH extends zR{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,i,u){const h=Wy(t,i,u);return ws(h,h,C1(Oc(u))),{x:h[0],y:h[1],z:h[2]}}locationPoint(t,i,u){const h=N(i.lat,i.lng),g=Ms([],h),x=u?t._centerAltitude+u:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(i),t._centerAltitude):t._centerAltitude;Mt(h,h,g,te(1,0)*Rt*x);const b=H(new Float64Array(16));return Z(b,t.pixelMatrix,t.globeMatrix),ws(h,h,b),new et(h[0],h[1])}pixelsPerMeter(t,i){return te(1,0)*i}pixelSpaceConversion(t,i,u){const h=te(1,t)*i,g=fs(te(1,45)*i,h,u);return this.pixelsPerMeter(t,i)/g}createTileMatrix(t,i,u){const h=oj(Oc(u.canonical));return Z(new Float64Array(16),t.globeMatrix,h)}createInversionMatrix(t,i){const{center:u}=t,h=C1(Oc(i));return ae(h,h,Ks(u.lng)),oe(h,h,Ks(u.lat)),q(h,h,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(h)}pointCoordinate(t,i,u,h){return dI(t,i,u,!0)||new be(0,0)}pointCoordinate3D(t,i,u){const h=this.pointCoordinate(t,i,u,0);return[h.x,h.y,h.z]}isPointAboveHorizon(t,i){return!dI(t,i.x,i.y,!1)}farthestPixelDistance(t){const i=function(h,g){const x=h.cameraToCenterDistance,b=h._centerAltitude*g,j=h._camera,T=h._camera.forward(),A=Vt([],nt([],T,-x),[0,0,b]),I=h.worldSize/(2*Math.PI),R=[0,0,-I],B=h.width/h.height,V=Math.tan(h.fovAboveCenter),K=nt([],j.up(),V),Q=nt([],j.right(),V*B),re=Ms([],Vt([],Vt([],T,K),Q)),ue=[];let ce;if(new fn(A,re).closestPointOnSphere(R,I,ue)){const he=Vt([],ue,R),Ee=vn([],he,A);ce=Math.cos(h.fovAboveCenter)*Dt(Ee)}else{const he=vn([],A,R),Ee=vn([],R,A);Ms(Ee,Ee);const we=Dt(he)-I;ce=Math.sqrt(we*(we+2*I));const je=Math.acos(ce/(I+we))-Math.acos(Xt(T,Ee));ce*=Math.cos(je)}return 1.01*ce}(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=Gd(t.zoom);if(u>0){const h=DR(t,te(1,t.center.lat)*t.worldSize),g=t.worldSize/(2*Math.PI),x=Math.max(t.width,t.height)/t.worldSize*Math.PI;return fs(i,h+g*(1-Math.cos(x)),Math.pow(u,10))}return i}upVector(t,i,u){return Wy(i,u,t,1)}upVectorScale(t){return{metersToTile:T1(E1(Oc(t)))}}}function VR(a){const t=a.parallels,i=!!t&&Math.abs(t[0]+t[1])<.01;switch(a.name){case"mercator":return new zR(a);case"equirectangular":return new lH(a);case"naturalEarth":return new uH(a);case"equalEarth":return new aH(a);case"winkelTripel":return new dH(a);case"albers":return i?new BR(a):new oH(a);case"lambertConformalConic":return i?new BR(a):new cH(a);case"globe":return new hH(a)}throw new Error(`Invalid projection name: ${a.name}`)}const pH=Ge.types,fH=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function eb(a,t,i,u,h,g,x,b,j,T,A,I,R){const B=b?Math.min(Kd,Math.round(b[0])):0,V=b?Math.min(Kd,Math.round(b[1])):0;a.emplaceBack(t,i,Math.round(32*u),Math.round(32*h),g,x,(B<<1)+(j?1:0),V,16*T,16*A,256*I,256*R)}function tb(a,t,i){a.emplaceBack(t,i)}function sb(a,t,i,u,h,g,x){a.emplaceBack(t,i,u,h,g,x)}const nb=(a,t,i,u)=>{for(let h=0;h<t;h++)a.emplaceBack(i[0],i[1],i[2],u[0],u[1],u[2])};function rb(a,t,i,u,h){a.emplaceBack(t,i,u,h),a.emplaceBack(t,i,u,h),a.emplaceBack(t,i,u,h),a.emplaceBack(t,i,u,h)}function mH(a){for(const t of a.sections)if(HS(t.text))return!0;return!1}class Jj{constructor(t){this.layoutVertexArray=new Im,this.indexArray=new ur,this.programConfigurations=t,this.segments=new mr,this.dynamicLayoutVertexArray=new Dc,this.opacityVertexArray=new Ay,this.placedSymbolArray=new Ap,this.iconTransitioningVertexArray=new gl,this.globeExtVertexArray=new Dd,this.zOffsetVertexArray=new Au,this.orientationVertexArray=new My}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,i,u,h,g){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,v7.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,i),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,w7.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,fH,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,T7.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,b7.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||g)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,S7.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,j7.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||h)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}Yt(Jj,"SymbolBuffers");class Qj{constructor(t,i,u){this.layoutVertexArray=new t,this.layoutAttributes=i,this.indexArray=new u,this.segments=new mr,this.collisionVertexArray=new zd,this.collisionVertexArrayExt=new Dc}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,N7.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,E7.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}Yt(Qj,"CollisionBuffers");class ib{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.lut=t.lut,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map(x=>x.fqid),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=H([]),this.placementViewportMatrix=H([]);const i=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.textSizeData=gR(this.zoom,i["text-size"],this.worldview),this.iconSizeData=gR(this.zoom,i["icon-size"],this.worldview);const u=this.layers[0].layout,h=u.get("symbol-sort-key"),g=u.get("symbol-z-order");this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=g!=="viewport-y"&&h.constantOr(1)!==void 0,this.sortFeaturesByY=(g==="viewport-y"||g==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map(x=>da[x]),this.stateDependentLayerIds=this.layers.filter(x=>x.isStateDependent()).map(x=>x.id),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Jj(new ia(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("text")||t.startsWith("symbol"))),this.icon=new Jj(new ia(this.layers,{zoom:this.zoom,lut:this.lut},t=>t.startsWith("icon")||t.startsWith("symbol"))),this.glyphOffsetArray=new By,this.lineVertexArray=new p1,this.symbolInstances=new h1}calculateGlyphDependencies(t,i,u,h,g){for(const x of t){const b=x.codePointAt(0);if(b===void 0)break;if(i[b]=!0,h&&g&&b<=65535){const j=d_[x];j&&(i[j.charCodeAt(0)]=!0)}}}updateFootprints(t,i){}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!k1(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(t,i,u,h){const g=this.layers[0],x=g.layout,b=this.projection.name==="globe",j=x.get("text-font"),T=x.get("text-field"),A=x.get("icon-image"),[I,R]=x.get("icon-size-scale-range"),B=xe(i.scaleFactor||1,I,R),V=(T.value.kind!=="constant"||T.value.value instanceof ho&&!T.value.value.isEmpty()||T.value.value.toString().length>0)&&(j.value.kind!=="constant"||j.value.value.length>0),K=A.value.kind!=="constant"||!!A.value.value||Object.keys(A.parameters).length>0,Q=x.get("symbol-sort-key");if(this.features=[],!V&&!K)return;const re=i.iconDependencies,ue=i.glyphDependencies,ce=i.availableImages,he=new Mn(this.zoom,{worldview:this.worldview});for(const{feature:Ee,id:we,index:je,sourceLayerIndex:Me}of t){const ke=g._featureFilter.needGeometry,Qe=Ke(Ee,ke);if(!g._featureFilter.filter(he,Qe,u))continue;if(ke||(Qe.geometry=Ae(Ee,u,h)),b&&Ee.type!==1&&u.z<=5){const gt=Qe.geometry,St=.98078528056,Ye=(_t,Ve)=>Xt(Wy(_t.x,_t.y,u,1),Wy(Ve.x,Ve.y,u,1))<St;for(let _t=0;_t<gt.length;_t++)gt[_t]=We(gt[_t],Ye)}let Fe,st;if(V){const gt=g.getValueAndResolveTokens("text-field",Qe,u,ce),St=ho.factory(gt);mH(St)&&(this.hasRTLText=!0),(!this.hasRTLText||wy()==="unavailable"||this.hasRTLText&&fl.isParsed())&&(Fe=A7(St,g,Qe))}if(K){const gt=g.getValueAndResolveTokens("icon-image",Qe,u,ce);st=typeof gt=="string"?Eo.build(gt):gt}if(!Fe&&!st)continue;const Tt=this.sortFeaturesByKey?Q.evaluate(Qe,{},u):void 0,lt={id:we,text:Fe,icon:st,index:je,sourceLayerIndex:Me,geometry:Qe.geometry,properties:Ee.properties,type:pH[Ee.type],sortKey:Tt};if(this.features.push(lt),st){const gt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:St,iconSecondary:Ye}=IR(st,this.iconSizeData,gt["icon-size"],u,this.zoom,lt,this.pixelRatio,B,this.worldview),_t=St.id.toString();if(re.has(_t)?re.get(_t).push(St):re.set(_t,[St]),Ye){this.hasAnySecondaryIcon=!0;const Ve=Ye.id.toString();re.has(Ve)?re.get(Ve).push(Ye):re.set(Ve,[Ye])}}if(Fe){const gt=j.evaluate(Qe,{},u).join(","),St=x.get("text-rotation-alignment")==="map"&&x.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(da.vertical)>=0;for(const Ye of Fe.sections)if(Ye.image){const _t=Ye.image.getPrimary().scaleSelf(this.pixelRatio),Ve=_t.id.toString(),Je=re.get(Ve)||[];Je.push(_t),re.set(Ve,Je)}else{const _t=yy(Fe.toString()),Ve=Ye.fontStack||gt,Je=ue[Ve]=ue[Ve]||{};this.calculateGlyphDependencies(Ye.text,Je,St,this.allowVerticalPlacement,_t)}}}if(x.get("symbol-placement")==="line"&&(this.features=function(Ee){const we={},je={},Me=[];let ke=0;function Qe(lt){Me.push(Ee[lt]),ke++}function Fe(lt,gt,St){const Ye=je[lt];return delete je[lt],je[gt]=Ye,Me[Ye].geometry[0].pop(),Me[Ye].geometry[0]=Me[Ye].geometry[0].concat(St[0]),Ye}function st(lt,gt,St){const Ye=we[gt];return delete we[gt],we[lt]=Ye,Me[Ye].geometry[0].shift(),Me[Ye].geometry[0]=St[0].concat(Me[Ye].geometry[0]),Ye}function Tt(lt,gt,St){const Ye=St?gt[0][gt[0].length-1]:gt[0][0];return`${lt}:${Ye.x}:${Ye.y}`}for(let lt=0;lt<Ee.length;lt++){const gt=Ee[lt],St=gt.geometry,Ye=gt.text?gt.text.toString():null;if(!Ye){Qe(lt);continue}const _t=Tt(Ye,St),Ve=Tt(Ye,St,!0);if(_t in je&&Ve in we&&je[_t]!==we[Ve]){const Je=st(_t,Ve,St),Ct=Fe(_t,Ve,Me[Je].geometry);delete we[_t],delete je[Ve],je[Tt(Ye,Me[Ct].geometry,!0)]=Ct,Me[Je].geometry=null}else _t in je?Fe(_t,Ve,St):Ve in we?st(_t,Ve,St):(Qe(lt),we[_t]=ke-1,je[Ve]=ke-1)}return Me.filter(lt=>lt.geometry)}(this.features)),x.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",i.elevationFeatures){!this.elevationFeatures&&i.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of i.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else x.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort((Ee,we)=>Ee.sortKey-we.sortKey)}update(t,i,u,h,g,x,b){this.text.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,i,g,u,h,x,b,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let i=!1;const u=ve(t),h=1/u;let g=!1,x=!1;for(let b=0;b<this.symbolInstances.length;b++){const j=this.symbolInstances.get(b),T=wt(1,0,0),A=wt(0,1,0),{numHorizontalGlyphVertices:I,numVerticalGlyphVertices:R,numIconVertices:B,numVerticalIconVertices:V}=j,K=I>0||R>0,Q=B>0,re=this.elevationFeatures[j.elevationFeatureIndex];if(re){const ue=new et(j.tileAnchorX,j.tileAnchorY),ce=.075+re.pointElevation(ue);j.zOffset!==ce&&(i=!0,j.zOffset=ce);const he=re.computeSlopeNormal(ue,h),Ee=Va(va(),wt(0,0,1),he);cn(T,T,Ee),cn(A,A,Ee),T[2]*=u,A[2]*=u,T[0]===1&&T[1]===0&&T[2]===0&&A[0]===0&&A[1]===1&&A[2]===0||(g=g||K,x=x||Q)}if(K&&(nb(this.text.orientationVertexArray,I,T,A),nb(this.text.orientationVertexArray,R,T,A)),Q){const{placedIconSymbolIndex:ue,verticalPlacedIconSymbolIndex:ce}=j;ue>=0&&nb(this.icon.orientationVertexArray,B,T,A),ce>=0&&nb(this.icon.orientationVertexArray,V,T,A)}}g||(this.text.orientationVertexArray=void 0),x||(this.icon.orientationVertexArray=void 0),i&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(g,x,b)=>{u+=x,u>g.length&&g.resize(u);for(let j=-x;j<0;j++)g.emplace(j+u,b)},i=(g,x,b)=>{h+=x,h>g.length&&g.resize(h);for(let j=-x;j<0;j++)g.emplace(j+h,b)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,h=0;for(let g=0;g<this.symbolInstances.length;g++){const x=this.symbolInstances.get(g),{numHorizontalGlyphVertices:b,numVerticalGlyphVertices:j,numIconVertices:T}=x,A=x.zOffset,I=T>0;if((b>0||j>0)&&(t(this.text.zOffsetVertexArray,b,A),t(this.text.zOffsetVertexArray,j,A)),I){const{placedIconSymbolIndex:R,verticalPlacedIconSymbolIndex:B}=x;R>=0&&i(this.icon.zOffsetVertexArray,T,A),B>=0&&i(this.icon.zOffsetVertexArray,x.numVerticalIconVertices,A)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=VR(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,i){const u=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:h,y:g}of i)this.lineVertexArray.emplaceBack(h,g);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,i,u,h,g,x,b,j,T,A,I,R,B,V,K,Q){const re=t.indexArray,ue=t.layoutVertexArray,ce=t.globeExtVertexArray,he=t.segments.prepareSegment(4*i.length,ue,re,this.canOverlap?x.sortKey:void 0),Ee=this.glyphOffsetArray.length,we=he.vertexLength,je=this.allowVerticalPlacement&&b===da.vertical?Math.PI/2:0,Me=x.text&&x.text.sections;for(let Qe=0;Qe<i.length;Qe++){const{tl:Fe,tr:st,bl:Tt,br:lt,texPrimary:gt,texSecondary:St,pixelOffsetTL:Ye,pixelOffsetBR:_t,minFontScaleX:Ve,minFontScaleY:Je,glyphOffset:Ct,isSDF:vt,sectionIndex:os}=i[Qe],Jt=he.vertexLength,ft=Ct[1];if(eb(ue,T.x,T.y,Fe.x,ft+Fe.y,gt.x,gt.y,u,vt,Ye.x,Ye.y,Ve,Je),eb(ue,T.x,T.y,st.x,ft+st.y,gt.x+gt.w,gt.y,u,vt,_t.x,Ye.y,Ve,Je),eb(ue,T.x,T.y,Tt.x,ft+Tt.y,gt.x,gt.y+gt.h,u,vt,Ye.x,_t.y,Ve,Je),eb(ue,T.x,T.y,lt.x,ft+lt.y,gt.x+gt.w,gt.y+gt.h,u,vt,_t.x,_t.y,Ve,Je),j){const{x:bt,y:ts,z:qt}=j.anchor,[kt,Zt,xs]=j.up;sb(ce,bt,ts,qt,kt,Zt,xs),sb(ce,bt,ts,qt,kt,Zt,xs),sb(ce,bt,ts,qt,kt,Zt,xs),sb(ce,bt,ts,qt,kt,Zt,xs),rb(t.dynamicLayoutVertexArray,bt,ts,qt,je)}else rb(t.dynamicLayoutVertexArray,T.x,T.y,T.z,je);if(Q){const bt=St||gt;tb(t.iconTransitioningVertexArray,bt.x,bt.y),tb(t.iconTransitioningVertexArray,bt.x+bt.w,bt.y),tb(t.iconTransitioningVertexArray,bt.x,bt.y+bt.h),tb(t.iconTransitioningVertexArray,bt.x+bt.w,bt.y+bt.h)}re.emplaceBack(Jt,Jt+1,Jt+2),re.emplaceBack(Jt+1,Jt+2,Jt+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Ct[0]),Qe!==i.length-1&&os===i[Qe+1].sectionIndex||t.programConfigurations.populatePaintArrays(ue.length,x,x.index,{},B,V,K,Me&&Me[os],this.worldview)}const ke=j?j.anchor:T;t.placedSymbolArray.emplaceBack(ke.x,ke.y,ke.z,T.x,T.y,Ee,this.glyphOffsetArray.length-Ee,we,A,I,T.segment,u?u[0]:0,u?u[1]:0,h[0],h[1],b,0,0,0,R,0)}_commitLayoutVertex(t,i,u,h,g,x,b){t.emplaceBack(i,u,h,g,x,Math.round(b.x),Math.round(b.y))}_addCollisionDebugVertices(t,i,u,h,g,x,b){const j=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),T=j.vertexLength,A=b.tileAnchorX,I=b.tileAnchorY;for(let B=0;B<4;B++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,i,t.padding,b.zOffset),this._commitLayoutVertex(u.layoutVertexArray,h,g,x,A,I,new et(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,x,A,I,new et(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,h,g,x,A,I,new et(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,h,g,x,A,I,new et(t.x1,t.y2)),j.vertexLength+=4;const R=u.indexArray;R.emplaceBack(T,T+1),R.emplaceBack(T+1,T+2),R.emplaceBack(T+2,T+3),R.emplaceBack(T+3,T),j.primitiveLength+=4}_addTextDebugCollisionBoxes(t,i,u,h,g,x){for(let b=h;b<g;b++){const j=u.get(b),T=this.getSymbolInstanceTextSize(t,x,i,b);this._addCollisionDebugVertices(j,T,this.textCollisionBox,j.projectedAnchorX,j.projectedAnchorY,j.projectedAnchorZ,x)}}_addIconDebugCollisionBoxes(t,i,u,h,g,x){for(let b=h;b<g;b++){const j=u.get(b),T=this.getSymbolInstanceIconSize(t,i,x.placedIconSymbolIndex);this._addCollisionDebugVertices(j,T,this.iconCollisionBox,j.projectedAnchorX,j.projectedAnchorY,j.projectedAnchorZ,x)}}generateCollisionDebugBuffers(t,i,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Qj(Mm,tR.members,gl),this.iconCollisionBox=new Qj(Mm,tR.members,gl);const h=p_(this.iconSizeData,t),g=p_(this.textSizeData,t,u);for(let x=0;x<this.symbolInstances.length;x++){const b=this.symbolInstances.get(x);this._addTextDebugCollisionBoxes(g,t,i,b.textBoxStartIndex,b.textBoxEndIndex,b),this._addTextDebugCollisionBoxes(g,t,i,b.verticalTextBoxStartIndex,b.verticalTextBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,t,i,b.iconBoxStartIndex,b.iconBoxEndIndex,b),this._addIconDebugCollisionBoxes(h,t,i,b.verticalIconBoxStartIndex,b.verticalIconBoxEndIndex,b)}}getSymbolInstanceTextSize(t,i,u,h){const g=this.text.placedSymbolArray.get(i.rightJustifiedTextSymbolIndex>=0?i.rightJustifiedTextSymbolIndex:i.centerJustifiedTextSymbolIndex>=0?i.centerJustifiedTextSymbolIndex:i.leftJustifiedTextSymbolIndex>=0?i.leftJustifiedTextSymbolIndex:i.verticalPlacedTextSymbolIndex>=0?i.verticalPlacedTextSymbolIndex:h),x=Hj(this.textSizeData,t,g)/wi;return this.tilePixelRatio*x}getSymbolInstanceIconSize(t,i,u){const h=this.icon.placedSymbolArray.get(u),g=Hj(this.iconSizeData,t,h);return this.tilePixelRatio*g}_commitDebugCollisionVertexUpdate(t,i,u,h){t.emplaceBack(i,-u,-u,h),t.emplaceBack(i,u,-u,h),t.emplaceBack(i,u,u,h),t.emplaceBack(i,-u,u,h)}_updateTextDebugCollisionBoxes(t,i,u,h,g,x,b){for(let j=h;j<g;j++){const T=u.get(j),A=this.getSymbolInstanceTextSize(t,x,i,j);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,A,T.padding,x.zOffset)}}_updateIconDebugCollisionBoxes(t,i,u,h,g,x,b){for(let j=h;j<g;j++){const T=u.get(j),A=this.getSymbolInstanceIconSize(t,i,x.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,A,T.padding,x.zOffset)}}updateCollisionDebugBuffers(t,i,u,h){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const g=p_(this.iconSizeData,t,h),x=p_(this.textSizeData,t,u);for(let b=0;b<this.symbolInstances.length;b++){const j=this.symbolInstances.get(b);this._updateTextDebugCollisionBoxes(x,t,i,j.textBoxStartIndex,j.textBoxEndIndex,j,u),this._updateTextDebugCollisionBoxes(x,t,i,j.verticalTextBoxStartIndex,j.verticalTextBoxEndIndex,j,u),this._updateIconDebugCollisionBoxes(g,t,i,j.iconBoxStartIndex,j.iconBoxEndIndex,j,h),this._updateIconDebugCollisionBoxes(g,t,i,j.verticalIconBoxStartIndex,j.verticalIconBoxEndIndex,j,h)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,i,u,h,g,x,b,j,T){const A={};if(i<u){const{x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he,featureIndex:Ee}=t.get(i);A.textBox={x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he},A.textFeatureIndex=Ee}if(h<g){const{x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he,featureIndex:Ee}=t.get(h);A.verticalTextBox={x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he},A.verticalTextFeatureIndex=Ee}if(x<b){const{x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he,featureIndex:Ee}=t.get(x);A.iconBox={x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he},A.iconFeatureIndex=Ee}if(j<T){const{x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he,featureIndex:Ee}=t.get(j);A.verticalIconBox={x1:I,y1:R,x2:B,y2:V,padding:K,projectedAnchorX:Q,projectedAnchorY:re,projectedAnchorZ:ue,tileAnchorX:ce,tileAnchorY:he},A.verticalIconFeatureIndex=Ee}return A}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let i=0;i<this.symbolInstances.length;i++){const u=this.symbolInstances.get(i);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,i){const u=t.placedSymbolArray.get(i),h=u.vertexStartIndex+4*u.numGlyphs;for(let g=u.vertexStartIndex;g<h;g+=4)t.indexArray.emplaceBack(g,g+1,g+2),t.indexArray.emplaceBack(g+1,g+2,g+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const i=Math.sin(t),u=Math.cos(t),h=[],g=[],x=[];for(let b=0;b<this.symbolInstances.length;++b){x.push(b);const j=this.symbolInstances.get(b);h.push(0|Math.round(i*j.tileAnchorX+u*j.tileAnchorY)),g.push(j.featureIndex)}return x.sort((b,j)=>h[b]-h[j]||g[j]-g[b]),x}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort((t,i)=>this.symbolInstances.get(i).zOffset-this.symbolInstances.get(t).zOffset)}addToSortKeyRanges(t,i){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===i?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:i,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const i of this.symbolInstanceIndexes){const u=this.symbolInstances.get(i);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:h,centerJustifiedTextSymbolIndex:g,leftJustifiedTextSymbolIndex:x,verticalPlacedTextSymbolIndex:b,placedIconSymbolIndex:j,verticalPlacedIconSymbolIndex:T}=u;h>=0&&this.addIndicesForPlacedSymbol(this.text,h),g>=0&&g!==h&&this.addIndicesForPlacedSymbol(this.text,g),x>=0&&x!==g&&x!==h&&this.addIndicesForPlacedSymbol(this.text,x),b>=0&&this.addIndicesForPlacedSymbol(this.text,b),j>=0&&this.addIndicesForPlacedSymbol(this.icon,j),T>=0&&this.addIndicesForPlacedSymbol(this.icon,T)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let UR,$R,eT;Yt(ib,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),ib.addDynamicAttributes=rb;class GR{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:pd,this.defaultValue=t}evaluate(t){if(t.formattedSection){const i=this.defaultValue.property.overrides;if(i&&i.hasOverride(t.formattedSection))return i.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}Yt(GR,"FormatSectionOverride",{omit:["defaultValue"]});const tT=()=>eT||(eT={layout:UR||(UR=new Er({"symbol-placement":new Nt(Oe.layout_symbol["symbol-placement"]),"symbol-spacing":new Nt(Oe.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new Nt(Oe.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Gt(Oe.layout_symbol["symbol-sort-key"]),"symbol-z-order":new Nt(Oe.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new Nt(Oe.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new Nt(Oe.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new Nt(Oe.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new Nt(Oe.layout_symbol["icon-ignore-placement"]),"icon-optional":new Nt(Oe.layout_symbol["icon-optional"]),"icon-rotation-alignment":new Nt(Oe.layout_symbol["icon-rotation-alignment"]),"icon-size":new Gt(Oe.layout_symbol["icon-size"]),"icon-size-scale-range":new Nt(Oe.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Gt(Oe.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Gt(Oe.layout_symbol["icon-text-fit-padding"]),"icon-image":new Gt(Oe.layout_symbol["icon-image"]),"icon-rotate":new Gt(Oe.layout_symbol["icon-rotate"]),"icon-padding":new Nt(Oe.layout_symbol["icon-padding"]),"icon-keep-upright":new Nt(Oe.layout_symbol["icon-keep-upright"]),"icon-offset":new Gt(Oe.layout_symbol["icon-offset"]),"icon-anchor":new Gt(Oe.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new Nt(Oe.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new Nt(Oe.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new Nt(Oe.layout_symbol["text-rotation-alignment"]),"text-field":new Gt(Oe.layout_symbol["text-field"]),"text-font":new Gt(Oe.layout_symbol["text-font"]),"text-size":new Gt(Oe.layout_symbol["text-size"]),"text-size-scale-range":new Nt(Oe.layout_symbol["text-size-scale-range"]),"text-max-width":new Gt(Oe.layout_symbol["text-max-width"]),"text-line-height":new Gt(Oe.layout_symbol["text-line-height"]),"text-letter-spacing":new Gt(Oe.layout_symbol["text-letter-spacing"]),"text-justify":new Gt(Oe.layout_symbol["text-justify"]),"text-radial-offset":new Gt(Oe.layout_symbol["text-radial-offset"]),"text-variable-anchor":new Nt(Oe.layout_symbol["text-variable-anchor"]),"text-anchor":new Gt(Oe.layout_symbol["text-anchor"]),"text-max-angle":new Nt(Oe.layout_symbol["text-max-angle"]),"text-writing-mode":new Nt(Oe.layout_symbol["text-writing-mode"]),"text-rotate":new Gt(Oe.layout_symbol["text-rotate"]),"text-padding":new Nt(Oe.layout_symbol["text-padding"]),"text-keep-upright":new Nt(Oe.layout_symbol["text-keep-upright"]),"text-transform":new Gt(Oe.layout_symbol["text-transform"]),"text-offset":new Gt(Oe.layout_symbol["text-offset"]),"text-allow-overlap":new Nt(Oe.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new Nt(Oe.layout_symbol["text-ignore-placement"]),"text-optional":new Nt(Oe.layout_symbol["text-optional"]),visibility:new Nt(Oe.layout_symbol.visibility)})),paint:$R||($R=new Er({"icon-opacity":new Gt(Oe.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Gt(Oe.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Gt(Oe.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Gt(Oe.paint_symbol["text-emissive-strength"]),"icon-color":new Gt(Oe.paint_symbol["icon-color"]),"icon-halo-color":new Gt(Oe.paint_symbol["icon-halo-color"]),"icon-halo-width":new Gt(Oe.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Gt(Oe.paint_symbol["icon-halo-blur"]),"icon-translate":new Nt(Oe.paint_symbol["icon-translate"]),"icon-translate-anchor":new Nt(Oe.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new Nt(Oe.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Gt(Oe.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Gt(Oe.paint_symbol["text-occlusion-opacity"]),"text-color":new Gt(Oe.paint_symbol["text-color"],{runtimeType:Lo,getOverride:a=>a.textColor,hasOverride:a=>!!a.textColor}),"text-halo-color":new Gt(Oe.paint_symbol["text-halo-color"]),"text-halo-width":new Gt(Oe.paint_symbol["text-halo-width"]),"text-halo-blur":new Gt(Oe.paint_symbol["text-halo-blur"]),"text-translate":new Nt(Oe.paint_symbol["text-translate"]),"text-translate-anchor":new Nt(Oe.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new Nt(Oe.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new Nt(Oe.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new Nt(Oe.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new Nt(Oe.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Gt(Oe.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},eT);class ob extends eo{constructor(t,i,u,h){super(t,tT(),i,u,h),this._colorAdjustmentMatrix=H([]),this.hasInitialOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}recalculate(t,i){super.recalculate(t,i),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const h=[];for(const g of u)h.indexOf(g)<0&&h.push(g);this.layout._values["text-writing-mode"]=h}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,i,u,h){return this._saturation===t&&this._contrast===i&&this._brightnessMin===u&&this._brightnessMax===h||(this._colorAdjustmentMatrix=function(g,x,b,j){g=Yi(g),x=To(x);const T=Y(),A=g/3,I=1-2*A,R=[I,A,A,0,A,I,A,0,A,A,I,0,0,0,0,1],B=.5-.5*x,V=j-b;return Z(T,[V,0,0,0,0,V,0,0,0,0,V,0,b,b,b,1],[x,0,0,0,0,x,0,0,0,0,x,0,B,B,B,1]),Z(T,T,R),T}(t,i,u,h),this._saturation=t,this._contrast=i,this._brightnessMin=u,this._brightnessMax=h),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,i,u,h){const g=this.layout.get(t).evaluate(i,{},u,h),x=this._unevaluatedLayout._values[t];return x.isDataDriven()||fy(x.value)||!g?g:function(b,j){return j.replace(/{([^{}]+)}/g,(T,A)=>A in b?String(b[A]):"")}(i.properties,g)}createBucket(t){return new ib(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of tT().paint.overridableProperties){if(!ob.hasPaintOverride(this.layout,t))continue;const i=this.paint.get(t),u=new GR(i),h=new py(u,i.property.specification,this.scope,this.options);let g=null;g=i.value.kind==="constant"||i.value.kind==="source"?new _m("source",h):new Pc("composite",h,i.value.zoomStops,i.value.interpolationType),this.paint._values[t]=new Cu(i.property,g,i.parameters)}}_handleOverridablePaintPropertyUpdate(t,i,u){return!(!this.layout||i.isDataDriven()||u.isDataDriven())&&ob.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,i){const u=t.get("text-field"),h=tT().paint.properties[i];let g=!1;const x=b=>{for(const j of b)if(h.overrides&&h.overrides.hasOverride(j))return void(g=!0)};if(u.value.kind==="constant"&&u.value.value instanceof ho)x(u.value.value.sections);else if(u.value.kind==="source"){const b=T=>{g||(T instanceof Ss&&Kt(T.value)===op?x(T.value.sections):T instanceof md?x(T.sections):T.eachChild(b))},j=u.value;j._styleExpression&&b(j._styleExpression.expression)}return g}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,i,u){return{config:new mo(this,{zoom:i,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let HR,WR,qR,ZR;var sT=ln([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function ab(a,t,i,u,h,g,x,b){const j=[a,t,1,i,u,1,h,g,1],T=[x,b,1],A=F([],j),[I,R,B]=tn(T,T,A);return $(j,j,[I,0,0,0,R,0,0,0,B])}function KR(a,t,i,u,h,g,x,b){const j=function(T,A,I,R,B,V,K,Q){const re=ab(0,0,1,0,1,1,0,1),ue=ab(T,A,I,R,B,V,K,Q);return $(ue,ue,F([],re))}(a,t,i,u,h,g,x,b);return[j[2]/j[8]/Rt,j[5]/j[8]/Rt]}function lb(a){return[a[0],Math.min(Math.max(a[1],-ye),ye)]}class XR extends xu{constructor(t,i,u,h){super(),this.id=t,this.dispatcher=u,this.coordinates=i.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(h),this.options=i,this._dirty=!1}load(t,i){if(this._loaded=i||!1,this.fire(new zl("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=sp(this.map._requestManager.transformRequest(this.url,Qh.Image),(u,h)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ea(u)):h&&(this.image=h instanceof HTMLImageElement?$a.getImageData(h):h,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())})}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new l_(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new zl("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof l_||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let i=t[0][1],u=t[0][1];for(const g of t)g[1]>u&&(u=g[1]),g[1]<i&&(i=g[1]);const h=(u+i)/2;if(h>ye?this.onNorthPole=!0:h<-ye&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const g=t.map(be.fromLngLat);this.tileID=function(x){let b=1/0,j=1/0,T=-1/0,A=-1/0;for(const K of x)b=Math.min(b,K.x),j=Math.min(j,K.y),T=Math.max(T,K.x),A=Math.max(A,K.y);const I=Math.max(T-b,A-j),R=Math.max(0,Math.floor(-Math.log(I)/Math.LN2)),B=Math.pow(2,R);let V=Math.floor((b+T)/2*B);return V>1&&(V-=1),new la(R,V,Math.floor((j+A)/2*B))}(g),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new zl("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof l_||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const re in this.tiles){const ue=this.tiles[re];ue.state!=="loaded"&&(ue.state="loaded",ue.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const i=x_(new la(0,0,0),this.map.transform.projection),u=[i.projection.project(this.coordinates[0][0],this.coordinates[0][1]),i.projection.project(this.coordinates[1][0],this.coordinates[1][1]),i.projection.project(this.coordinates[2][0],this.coordinates[2][1]),i.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!function(re){const ue=re[1].x-re[0].x,ce=re[1].y-re[0].y,he=re[2].x-re[1].x,Ee=re[2].y-re[1].y,we=re[3].x-re[2].x,je=re[3].y-re[2].y,Me=re[0].x-re[3].x,ke=re[0].y-re[3].y,Qe=ue*Ee-he*ce,Fe=he*je-we*Ee,st=we*ke-Me*je,Tt=Me*ce-ue*ke;return Qe>0&&Fe>0&&st>0&&Tt>0||Qe<0&&Fe<0&&st<0&&Tt<0}(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const h=x_(this.tileID,this.map.transform.projection),[g,x,b,j]=this.coordinates.map(re=>{const ue=h.projection.project(re[0],re[1]);return LR(h,ue)._round()});this.perspectiveTransform=KR(g.x,g.y,x.x,x.y,b.x,b.y,j.x,j.y);const T=this._boundsArray=new Rd;T.emplaceBack(g.x,g.y,0,0),T.emplaceBack(x.x,x.y,Rt,0),T.emplaceBack(j.x,j.y,0,Rt),T.emplaceBack(b.x,b.y,Rt,Rt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(T,sT.members),this.boundsSegments=mr.simpleSegment(0,0,4,2);const A=[],I=[lb((R=this.coordinates)[0]),lb(R[1]),lb(R[2]),lb(R[3])];var R;const[B,V,K,Q]=function(re){let ue=re[0][0],ce=ue,he=re[0][1],Ee=he;for(let we=1;we<re.length;we++)re[we][0]<ue?ue=re[we][0]:re[we][0]>ce&&(ce=re[we][0]),re[we][1]<he?he=re[we][1]:re[we][1]>Ee&&(Ee=re[we][1]);return[ue,he,ce-ue,Ee-he]}(I);{const re=new Rd,[ue,ce,he,Ee]=function(Ye){let _t=Ye[0].x,Ve=_t,Je=Ye[0].y,Ct=Je;for(let vt=1;vt<Ye.length;vt++)Ye[vt].x<_t?_t=Ye[vt].x:Ye[vt].x>Ve&&(Ve=Ye[vt].x),Ye[vt].y<Je?Je=Ye[vt].y:Ye[vt].y>Ct&&(Ct=Ye[vt].y);return[_t,Je,Ve-_t,Ct-Je]}(u),we=Ye=>[(Ye.x-ue)/he,(Ye.y-ce)/Ee],[je,Me,ke,Qe]=u.map(we),Fe=function(Ye,_t,Ve,Je,Ct,vt,os,Jt){const ft=ab(0,0,1,0,1,1,0,1);return $(ft,ft,F([],ab(Ye,_t,Ve,Je,Ct,vt,os,Jt)))}(je[0],je[1],Me[0],Me[1],ke[0],ke[1],Qe[0],Qe[1]);this.elevatedGlobePerspectiveTransform=KR(je[0],je[1],Me[0],Me[1],ke[0],ke[1],Qe[0],Qe[1]);const st=(Ye,_t)=>{A.push(Ye.lng);const Ve=Math.round((Ye.lng-B)/K*Rt),Je=Math.round((Ye.lat-V)/Q*Rt),Ct=we(_t),vt=tn([],[Ct[0],Ct[1],1],Fe),os=Math.round(vt[0]/vt[2]*Rt),Jt=Math.round(vt[1]/vt[2]*Rt);re.emplaceBack(Ve,Je,os,Jt)},Tt=u[3].x-u[0].x,lt=u[3].y-u[0].y,gt=u[2].x-u[1].x,St=u[2].y-u[1].y;for(let Ye=0;Ye<65;Ye++){const _t=Ye/64,Ve=[u[0].x+_t*Tt,u[0].y+_t*lt],Je=[u[1].x+_t*gt,u[1].y+_t*St],Ct=Je[0]-Ve[0],vt=Je[1]-Ve[1];for(let os=0;os<65;os++){const Jt=os/64,ft={x:Ve[0]+Ct*Jt,y:Ve[1]+vt*Jt};st(i.projection.unproject(ft.x,ft.y),ft)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(re,sT.members)}{this.maxLongitudeTriangleSize=0;let re=[],ue=new ur;const ce=(he,Ee,we)=>{ue.emplaceBack(he,Ee,we);const je=A[he],Me=A[Ee],ke=A[we],Qe=Math.min(Math.min(je,Me),ke),Fe=Math.max(Math.max(je,Me),ke)-Qe;Fe>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Fe),re.push(Qe+Fe/2)};for(let he=0;he<64;he++)for(let Ee=0;Ee<64;Ee++){const we=65*he+Ee,je=we+1,Me=we+65,ke=Me+1;ce(we,Me,je),ce(je,Me,ke)}[re,ue]=function(he,Ee){const we=Array.from({length:he.length},(ke,Qe)=>Qe);we.sort((ke,Qe)=>he[ke]-he[Qe]);const je=[],Me=new ur;for(let ke=0;ke<we.length;ke++){const Qe=we[ke];je.push(he[Qe]);const Fe=3*Qe,st=Fe+1;Me.emplaceBack(Ee.uint16[Fe],Ee.uint16[st],Ee.uint16[st+1])}return[je,Me]}(re,ue),this.elevatedGlobeTrianglesCenterLongitudes=re,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(ue)}this.elevatedGlobeSegments=mr.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,K/Rt,0,Q/Rt,0,0,V,B,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const i=this.map.painter.context,u=i.gl;!this._dirty||this.texture instanceof l_||(this.texture?this.texture.update(this.image):(this.texture=new Ij(i,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(i)}loadTile(t,i){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},i(null)):(t.state="errored",i(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const i=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!i)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let h=(g=t+180)+360*Math.round((u[0]-g)/360);var g;const x=new mr,b=(I,R)=>{x.segments.push({vertexOffset:0,primitiveOffset:I,vertexLength:i.segments[0].vertexLength,primitiveLength:R,sortKey:void 0,vaos:{}})},j=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-h)<=j){const I=yi(u,0,u.length,h+j);return I===u.length||b(I,fr(u,I+1,u.length,h+360-j)-I),x}h<u[0]&&(h+=360);const T=fr(u,0,u.length,h-j);if(T===u.length)return b(0,u.length),x;b(0,T-0);const A=yi(u,T+1,u.length,h+j);return A!==u.length&&b(A,u.length-A),x}}const gH=(Math.pow(256,2)-1)/16907520;class YR extends eo{constructor(t,i,u,h){super(t,{layout:qR||(qR=new Er({visibility:new Nt(Oe.layout_raster.visibility)})),paint:ZR||(ZR=new Er({"raster-opacity":new Nt(Oe.paint_raster["raster-opacity"]),"raster-color":new Cd(Oe.paint_raster["raster-color"]),"raster-color-mix":new Nt(Oe.paint_raster["raster-color-mix"]),"raster-color-range":new Nt(Oe.paint_raster["raster-color-range"]),"raster-hue-rotate":new Nt(Oe.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new Nt(Oe.paint_raster["raster-brightness-min"]),"raster-brightness-max":new Nt(Oe.paint_raster["raster-brightness-max"]),"raster-saturation":new Nt(Oe.paint_raster["raster-saturation"]),"raster-contrast":new Nt(Oe.paint_raster["raster-contrast"]),"raster-resampling":new Nt(Oe.paint_raster["raster-resampling"]),"raster-fade-duration":new Nt(Oe.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new Nt(Oe.paint_raster["raster-emissive-strength"]),"raster-array-band":new Nt(Oe.paint_raster["raster-array-band"]),"raster-elevation":new Nt(Oe.paint_raster["raster-elevation"]),"raster-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof XR&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const i=this._transitionablePaint._values["raster-color"].value.expression,[u,h]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(h)||u===this._curRampRange[0]&&h===this._curRampRange[1]||(this.colorRamp=qy({expression:i,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:h}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,h])}}let JR,QR,ek,tk,sk;class nk extends eo{constructor(t,i,u,h){super(t,{layout:JR||(JR=new Er({visibility:new Nt(Oe["layout_raster-particle"].visibility)})),paint:QR||(QR=new Er({"raster-particle-array-band":new Nt(Oe["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new Nt(Oe["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new Cd(Oe["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new Nt(Oe["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new Nt(Oe["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new Nt(Oe["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new Nt(Oe["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new Nt(Oe["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},i,u,h),this._updateColorRamp(),this.lastInvalidatedAt=$a.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,i=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=qy({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:i}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=$a.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class xH extends eo{constructor(t,i){super(t,{},i,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function nT(a,t,i){const u=[0,0,1],h=Ki([]);return hc(h,h,i?-Ks(a)+Math.PI:Ks(a)),Rl(h,h,-Ks(t)),cn(u,u,h),Ms(u,u)}const rk={None:0,Model:1,Symbol:2,FillExtrusion:4};class cb{constructor(t,i,u,h){this.message=(t?`${t}: `:"")+u,h&&(this.identifier=h),i!=null&&i.__line__&&(this.line=i.__line__)}}function rT(a,t){const i=a.indexOf("://")===-1;try{return new URL(a,i&&t?"http://example.com":void 0),!0}catch{return!1}}class ik{constructor(t,i){this.feature=t,this.instancedDataOffset=i,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class ok{constructor(){this.instancedDataArray=new Rm,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class iT{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map(i=>i.fqid),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter(i=>i.isStateDependent()).map(i=>i.id),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs}updateFootprints(t,i){}populate(t,i,u,h){this.tileToMeter=ve(u);const g=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:x,id:b,index:j,sourceLayerIndex:T}of t){const A=b??(x.properties&&x.properties.hasOwnProperty("id")?x.properties.id:void 0),I=Ke(x,g);if(!this.layers[0]._featureFilter.filter(new Mn(this.zoom,{worldview:this.worldview}),I,u))continue;const R={id:A,sourceLayerIndex:T,index:j,geometry:g?I.geometry:Ae(x,u,h),properties:x.properties,type:x.type,patterns:{}},B=this.addFeature(R,R.geometry,I);B&&i.featureIndex.insert(x,R.geometry,j,T,this.index,this.instancesPerModel[B].instancedDataArray.length,Rt/32)}this.lookup=null}update(t,i,u,h){for(const g in this.instancesPerModel){const x=this.instancesPerModel[g];for(const b in t)x.idToFeaturesIndex.hasOwnProperty(b)&&(this.evaluate(x.features[x.idToFeaturesIndex[b]],t[b],x,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];for(const h of u.features){const g=this.layers[0],x=h.feature,b=this.canonical,j=g.paint.get("model-rotation").evaluate(x,{},b),T=g.paint.get("model-scale").evaluate(x,{},b),A=g.paint.get("model-translation").evaluate(x,{},b);cr(h.rotation,j)&&cr(h.scale,T)&&cr(h.translation,A)||(this.evaluate(h,h.featureStates,u,!0),t=!0)}}return t}updateReplacement(t,i,u,h){if(i.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=i.updateTime;const g=i.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(k1(this.activeReplacements,g))return!1;this.activeReplacements=g;let x=!1;for(const b in this.instancesPerModel){const j=this.instancesPerModel[b],T=j.instancedDataArray;for(const A of j.features){const I=A.instancedDataOffset,R=A.instancedDataCount;for(let B=0;B<R;B++){const V=16*(B+I);let K=T.float32[V+0];const Q=K>Rt;K=Q?K-Rt:K;const re=Math.floor(K),ue=T.float32[V+1];let ce=!1;for(const he of this.activeReplacements)if(!qI(he,u,rk.Model,h)&&!(he.min.x>re||re>he.max.x||he.min.y>ue||ue>he.max.y)&&(ce=_j(YI(re,ue,t.canonical,he.footprintTileId.canonical),he.footprint),ce))break;T.float32[V]=ce?K+Rt:K,x=x||ce!==Q}}}return x}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,XG.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const i in this.instancesPerModel){const u=this.instancesPerModel[i];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris&&this.modelsRequested)for(const i of this.modelUris)t.removeModel(i,"",!0)}addFeature(t,i,u){const h=this.layers[0],g=h.layout.get("model-id").evaluate(u,{},this.canonical);if(!g)return rn(`modelId is not evaluated for layer ${h.id} and it is not going to get rendered.`),g;(rT(g,!1)||this.styleDefinedModelURLs[g]!==void 0)&&(this.modelUris.includes(g)||this.modelUris.push(g)),this.instancesPerModel[g]||(this.instancesPerModel[g]=new ok);const x=this.instancesPerModel[g],b=x.instancedDataArray,j=new ik(u,b.length);for(const T of i)for(const A of T){if(A.x<0||A.x>=Rt||A.y<0||A.y>=Rt)continue;const I=(this.lookupDim-1)/Rt,R=this.lookupDim*(A.y*I|0)+A.x*I|0;if(this.lookup){if(this.lookup[R]!==0)continue;this.lookup[R]=1}this.instanceCount++;const B=b.length;b.resize(B+1),x.instancesEvaluatedElevation.push(0),b.float32[16*B]=A.x,b.float32[16*B+1]=A.y}return j.instancedDataCount=x.instancedDataArray.length-j.instancedDataOffset,j.instancedDataCount>0&&(t.id&&(x.idToFeaturesIndex[t.id]=x.features.length),x.features.push(j),this.evaluate(j,{},x,!1)),g}getModelUris(){return this.modelUris}evaluate(t,i,u,h){const g=this.layers[0],x=t.feature,b=this.canonical,j=t.rotation=g.paint.get("model-rotation").evaluate(x,i,b),T=t.scale=g.paint.get("model-scale").evaluate(x,i,b),A=t.translation=g.paint.get("model-translation").evaluate(x,i,b),I=g.paint.get("model-color").evaluate(x,i,b);I.a=g.paint.get("model-color-mix-intensity").evaluate(x,i,b);const R=[];this.maxVerticalOffset<A[2]&&(this.maxVerticalOffset=A[2]),this.maxScale=Math.max(Math.max(this.maxScale,T[0]),Math.max(T[1],T[2])),MM(R,j,T);const B=Math.round(100*I.a)+I.b/1.05;for(let V=0;V<t.instancedDataCount;++V){const K=t.instancedDataOffset+V,Q=16*K,re=u.instancedDataArray.float32;let ue=0;h&&(ue=re[Q+6]-u.instancesEvaluatedElevation[K]);const ce=0|re[Q+1];re[Q]=(0|re[Q])+I.r/1.05,re[Q+1]=ce+I.g/1.05,re[Q+2]=B,re[Q+3]=1/(b.z>10?this.tileToMeter:ve(b,ce)),re[Q+4]=A[0],re[Q+5]=A[1],re[Q+6]=A[2]+ue,re[Q+7]=R[0],re[Q+8]=R[1],re[Q+9]=R[2],re[Q+10]=R[4],re[Q+11]=R[5],re[Q+12]=R[6],re[Q+13]=R[8],re[Q+14]=R[9],re[Q+15]=R[10],u.instancesEvaluatedElevation[K]=A[2]}}}let ak,lk;Yt(iT,"ModelBucket",{omit:["layers"]}),Yt(ok,"PerModelAttributes"),Yt(ik,"ModelFeature");class Ym{constructor(t,i,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=i,this._offset=u}static create(t,i,u){const h=u||t.findDEMTileFor(i);if(!h||!h.dem)return;const g=h.dem,x=h.tileID,b=1<<i.canonical.z-x.canonical.z;return new Ym(h,g.dim/Rt/b,[(i.canonical.x/b-x.canonical.x)*g.dim,(i.canonical.y/b-x.canonical.y)*g.dim])}tileCoordToPixel(t,i){const u=i*this._scale+this._offset[1];return new et(Math.floor(t*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(t,i,u,h){const g=t*this._scale+this._offset[0],x=i*this._scale+this._offset[1],b=Math.floor(g),j=Math.floor(x),T=this._dem;return h=!!h,u?fs(fs(T.get(b,j,h),T.get(b,j+1,h),x-j),fs(T.get(b+1,j,h),T.get(b+1,j+1,h),x-j),g-b):T.get(b,j,h)}getElevationAtPixel(t,i,u){return this._dem.get(t,i,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*te(1,t)*this._dem.stride}}const oT=new Float32Array(262144),Up=new Uint8Array(262144);function ck(a){let t=0;if(a.meshes)for(const i of a.meshes)t=Math.max(t,i.aabb.max[2]);if(a.children)for(const i of a.children)t=Math.max(t,ck(i));return t}function uk(a,t,i){if(a.meshes)for(const u of a.meshes){if(u.aabb.min[0]===1/0)continue;const h=qs.applyTransform(u.aabb,a.matrix);i.insert(t,h.min[0],h.min[1],h.max[0],h.max[1])}if(a.children)for(const u of a.children)uk(u,t,i)}const dk=["","wall","door","roof","window","lamp","logo"];class hk{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:ck(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new qs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const i=new qs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==t&&(u.transformedAabb=qs.applyTransformFast(u.aabb,this.node.matrix),i.encapsulate(u.transformedAabb)),t++;this.aabb=i}return this.aabb}}class ub{constructor(t,i,u,h,g,x,b,j){this.id=u,this.layers=t,this.layerIds=this.layers.map(T=>T.fqid),this.stateDependentLayerIds=this.layers.filter(T=>T.isStateDependent()).map(T=>T.id),this.modelTraits|=Hm.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,h&&(this.modelTraits|=Hm.HasMapboxMeshFeatures),g&&(this.modelTraits|=Hm.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=x,this.worldview=j,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const T of i)this.nodesInfo.push(new hk(T)),uk(T,b.featureIndexArray.length,b.grid),b.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,b.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,i){for(const u of this.getNodesInfo()){const h=u.node;h.footprint&&i.push({footprint:h.footprint,id:t})}}update(t){const i=Object.keys(t).length!==0;if(i&&!this.stateDependentLayers.length)return;const u=i?this.stateDependentLayers:this.layers;if(!er(t,this.states))for(const h of u)this.evaluate(h,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const i=this.getNodesInfo();for(const u of i){const h=u.node;this.uploaded?this.updatePbrBuffer(h):kj(h,t,!0)}for(const u of i)G1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let i=!1;if(!t.meshes)return i;for(const u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),i=!0);return i}needsReEvaluation(t,i,u){const h=t.transform.projectionOptions,g=t.style.getBrightness(),x=this.brightness!==g;if(!this.uploaded||this.dirty||h.name!==this.projection.name||w_(u.paint.get("model-color").value,x)||w_(u.paint.get("model-color-mix-intensity").value,x)||w_(u.paint.get("model-roughness").value,x)||w_(u.paint.get("model-emissive-strength").value,x)||w_(u.paint.get("model-height-based-emissive-strength-multiplier").value,x)){this.projection=h,this.brightness=g;const b=this.getNodesInfo();for(const j of b)j.state=null;return!0}return!1}evaluateTransform(t,i){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const u=this.getNodesInfo(),h=this.id.canonical;for(const g of u){const x=g.feature;g.evaluatedTranslation=i.paint.get("model-translation").evaluate(x,{},h),g.evaluatedScale=i.paint.get("model-scale").evaluate(x,{},h)}}evaluate(t,i){const u=this.getNodesInfo();for(const h of u){if(!h.node.meshes)continue;const g=h.feature,x=i&&i[g.id];if(er(x,h.state))continue;h.state=structuredClone(x);const b=h.node.meshes&&h.node.meshes[0].featureData,j=h.evaluatedColor[2],T=h.evaluatedRMEA[2],A=this.id.canonical;if(h.hasTranslucentParts=!1,b){for(let I=0;I<dk.length;I++){const R=dk[I];R.length&&(g.properties.part=R);const B=t.paint.get("model-color").evaluate(g,x,A).toPremultipliedRenderColor(null),V=t.paint.get("model-color-mix-intensity").evaluate(g,x,A);h.evaluatedColor[I]=[B.r,B.g,B.b,V],h.evaluatedRMEA[I][0]=t.paint.get("model-roughness").evaluate(g,x,A),h.evaluatedRMEA[I][2]=t.paint.get("model-emissive-strength").evaluate(g,x,A),h.evaluatedRMEA[I][3]=B.a,h.emissionHeightBasedParams[I]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(g,x,A),!h.hasTranslucentParts&&B.a<1&&(h.hasTranslucentParts=!0)}delete g.properties.part,_H(h,j!==h.evaluatedColor[2]||T!==h.evaluatedRMEA[2],this.modelTraits)}else h.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(g,x,A);h.evaluatedTranslation=t.paint.get("model-translation").evaluate(g,x,A),h.evaluatedScale=t.paint.get("model-scale").evaluate(g,x,A),this.updatePbrBuffer(h.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,i,u,h){const g=t.findDEMTileFor(u);if(g&&(g.tileID.canonical!==this.terrainTile||i!==this.terrainExaggeration)){if(g.dem&&g.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=g.tileID.overscaledZ;const x=Ym.create(t,u,g);if(!x)return;this.modelTraits&Hm.HasMapboxMeshFeatures&&this.updateDEM(t,x,u,h);for(const b of this.getNodesInfo()){const j=b.node;if(!j.footprint||!j.footprint.vertices||!j.footprint.vertices.length)continue;const T=j.footprint.vertices;let A=x.getElevationAt(T[0].x,T[0].y,!0,!0);for(let I=1;I<T.length;I++)A=Math.min(A,x.getElevationAt(T[I].x,T[I].y,!0,!0));j.elevation=A}}this.terrainTile=g.tileID.canonical,this.terrainExaggeration=i}}updateDEM(t,i,u,h){let g=i._dem._modifiedForSources[h];if(g===void 0&&(i._dem._modifiedForSources[h]=[],g=i._dem._modifiedForSources[h]),g.includes(u.canonical))return;const x=i._dem.dim;g.push(u.canonical);let b=!1;for(const j of this.getNodesInfo()){const T=j.node;if(!T.footprint||!T.footprint.grid)continue;const A=T.footprint.grid,I=i.tileCoordToPixel(A.min.x,A.min.y),R=i.tileCoordToPixel(A.max.x,A.max.y),B=Math.min(Math.min(x-R.y,I.x),Math.min(I.y,x-R.x));if(B<0)continue;const V=xe(B,2,5);let K=Math.max(0,I.x-V),Q=Math.max(0,I.y-V),re=Math.min(R.x+V,x-1),ue=Math.min(R.y+V,x-1);for(let we=Q;we<=ue;++we)for(let je=K;je<=re;++je)Up[we*x+je]=255;let ce=0,he=0;for(let we=0;we<A.cellsY;++we)for(let je=0;je<A.cellsX;++je){if(!A.cells[we*A.cellsX+je])continue;const Me=i.tileCoordToPixel(A.min.x+je/A.xScale,A.min.y+we/A.yScale),ke=i.tileCoordToPixel(A.min.x+(je+1)/A.xScale,A.min.y+(we+1)/A.yScale);for(let Qe=Me.y;Qe<=Math.min(ke.y+1,x-1);++Qe)for(let Fe=Me.x;Fe<=Math.min(ke.x+1,x-1);++Fe)Up[Qe*x+Fe]===255&&(Up[Qe*x+Fe]=0,ce+=i.getElevationAtPixel(Fe,Qe),he++)}const Ee=ce/he;K=Math.max(1,I.x-V),Q=Math.max(1,I.y-V),re=Math.min(R.x+V,x-2),ue=Math.min(R.y+V,x-2),b=!0;for(let we=Q;we<=ue;++we)for(let je=K;je<=re;++je)Up[we*x+je]===0&&(oT[we*x+je]=i._dem.set(je,we,Ee));for(let we=1;we<V;++we){K=Math.max(1,I.x-we),Q=Math.max(1,I.y-we),re=Math.min(R.x+we,x-2),ue=Math.min(R.y+we,x-2);for(let je=Q;je<=ue;++je)for(let Me=K;Me<=re;++Me){const ke=je*x+Me;if(Up[ke]===255){let Qe=0,Fe=0,st=-1,Tt=-1;for(let lt=-1;lt<=1;++lt)for(let gt=-1;gt<=1;++gt){const St=(je+lt)*x+Me+gt;if(Up[St]>=we)continue;const Ye=oT[St],_t=Math.abs(Ye);_t>Fe&&(Qe=Ye,Fe=_t,st=gt,Tt=lt)}if(Fe>.1){const lt=1-(we+.5*Math.abs(st*Tt))/V;let gt=i._dem.get(Me,je)+Qe*lt;const St=i._dem.get(Me+st,je+Tt),Ye=i._dem.get(Me-st,je-Tt,!0);(gt-St)*(gt-Ye)>0&&(gt=(St+Ye)/2),oT[ke]=i._dem.set(Me,je,gt),Up[ke]=we}}}}}b&&(i._demTile.needsDEMTextureUpload=!0,i._dem._timestamp=$a.now())}setFilter(t){this.filter=t?Ad(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter(t=>this.filter.filter(new Mn(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical)):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const i of t)G1(i.node),Dj(i.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,i){if(i.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=i.updateTime;const u=i.getReplacementRegionsForTile(t.toUnwrapped());for(const h of this.getNodesInfo()){const g=h.node.footprint;h.hiddenByReplacement=!!g&&!u.find(x=>x.footprint===g)}}getHeightAtTileCoord(t,i){const u=[],h=[0,0,0],g=H([]);for(const x of this.getNodesInfo()){const b=x.node.meshes[0],j=b.transformedAabb;if(t<j.min[0]||i<j.min[1]||t>j.max[0]||i>j.max[1])continue;if(x.node.hidden===!0)return{height:1/0,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};X(g,x.node.matrix),h[0]=t,h[1]=i,ws(h,h,g);const T=(h[0]-b.aabb.min[0])/(b.aabb.max[0]-b.aabb.min[0])*Fp|0,A=Math.min(63,(h[1]-b.aabb.min[1])/(b.aabb.max[1]-b.aabb.min[1])*Fp|0)*Fp+Math.min(63,T),I=b.heightmap[A];if(!(I<0&&x.node.footprint))return x.hiddenByReplacement?void 0:{height:I,maxHeight:x.feature.properties.height,hidden:!1,verticalScale:x.evaluatedScale[2]};if(x.node.footprint.grid.query(new et(t,i),new et(t,i),u),u.length>0)return{height:void 0,maxHeight:x.feature.properties.height,hidden:x.hiddenByReplacement,verticalScale:x.evaluatedScale[2]}}}}function w_(a,t){return a instanceof _m&&!a.isLightConstant&&t}function yH(a,t,i,u,h,g,x,b){let j=(61440&t|(61440&t)>>4)>>8,T=(3840&t|(3840&t)>>4)>>4,A=240&t|(240&t)>>4;i[3]>0&&(j=fs(j,255*i[0],i[3]),T=fs(T,255*i[1],i[3]),A=fs(A,255*i[2],i[3]));const I=j<<8|T,R=A<<8|Math.floor(255*u[3]),B=function(we){const je=xe(we,0,2);return Math.min(Math.round(.5*je*255),255)}(u[2])<<8|15*u[0]<<4|15*u[1],V=xe(h[0],0,1),K=xe(h[1],0,1),Q=xe(h[2],0,1),re=xe(h[3],0,1);let ue,ce,he,Ee;if(V!==K&&x!==g&&K!==V){const we=x-g;ce=1/(we*(K-V)),he=-(g+we*V)/(we*(K-V));const je=xe(h[4],-1,1);Ee=Math.pow(10,je),ue=255*Q<<8|255*re}else ue=65535,ce=0,he=1,Ee=1;if(a.emplaceBack(I,R,B,ue,ce,he,Ee),b){const we=b.length;b.clear();for(let je=0;je<we;je++)b.emplaceBack(I,R,B,ue,ce,he,Ee)}}function _H(a,t,i){const u=a.node;let h=0;const g=i&Hm.HasMeshoptCompression;for(const x of u.meshes){if(u.lights&&u.lightMeshIndex===h||!x.featureData)continue;x.featureArray=new Fd,x.featureArray.reserve(x.featureData.length);let b=t;for(const j of x.featureData){const T=g?65535&j:j>>16&65535,A=g?j>>16&65535:65535&j,I=(15&A)<8?15&A:0,R=a.evaluatedRMEA[I],B=a.evaluatedColor[I],V=a.emissionHeightBasedParams[I];let K;if(b&&I===2&&u.lights&&(K=new Fd,K.resize(10*u.lights.length)),yH(x.featureArray,T,B,R,V,x.aabb.min[2],x.aabb.max[2],K),K&&b){b=!1;const Q=u.meshes[u.lightMeshIndex];Q.featureArray=K,Q.featureArray._trim()}}x.featureArray._trim(),h++}}function pk(a,t,i,u){const h=1<<a.z;t.lat=de((u/Rt+a.y)/h),t.lng=le((i/Rt+a.x)/h)}function vH(a,t,i,u){const h=a.getNodesInfo()[t];if(!h||h.hiddenByReplacement||!h.node.meshes)return;let g=Number.MAX_VALUE;const x=h.node,b=i.tile,j=u.calculatePosMatrix(b.tileID.toUnwrapped(),u.worldSize),T=h.evaluatedScale;let A=0;u.elevation&&x.elevation&&(A=x.elevation*u.elevation.exaggeration()),W(j,j,[(x.anchor?x.anchor[0]:0)*(T[0]-1),(x.anchor?x.anchor[1]:0)*(T[1]-1),A]),q(j,j,T);const I=i.queryGeometry,R=I.isPointQuery()?I.screenBounds:I.screenGeometry,B=function(K){const Q=Z([],j,K.matrix);Z(Q,u.expandedFarZProjMatrix,Q);for(let re=0;re<K.meshes.length;++re){const ue=K.meshes[re];if(re===K.lightMeshIndex)continue;const ce=RM(R,u,Q,ue.aabb);ce!=null&&(g=Math.min(ce,g))}if(K.children)for(const re of K.children)B(re)};if(B(x),g===Number.MAX_VALUE)return;const V=new D(0,0);return pk(b.tileID.canonical,V,h.node.anchor[0],h.node.anchor[1]),{intersectionZ:g,position:V,feature:h.feature}}Yt(ub,"Tiled3dModelBucket",{omit:["layers"]}),Yt(hk,"Tiled3dModelFeature");const bH={circle:class extends eo{constructor(a,t,i,u){super(a,{layout:zc||(zc=new Er({"circle-sort-key":new Gt(Oe.layout_circle["circle-sort-key"]),"circle-elevation-reference":new Nt(Oe.layout_circle["circle-elevation-reference"]),visibility:new Nt(Oe.layout_circle.visibility)})),paint:Ud||(Ud=new Er({"circle-radius":new Gt(Oe.paint_circle["circle-radius"]),"circle-color":new Gt(Oe.paint_circle["circle-color"]),"circle-blur":new Gt(Oe.paint_circle["circle-blur"]),"circle-opacity":new Gt(Oe.paint_circle["circle-opacity"]),"circle-translate":new Nt(Oe.paint_circle["circle-translate"]),"circle-translate-anchor":new Nt(Oe.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new Nt(Oe.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new Nt(Oe.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Gt(Oe.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Gt(Oe.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Gt(Oe.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new Nt(Oe.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u)}createBucket(a){return new Sn(a)}queryRadius(a){const t=a;return bi("circle-radius",this,t)+bi("circle-stroke-width",this,t)+Ir(this.paint.get("circle-translate"))}queryIntersectsFeature(a,t,i,u,h,g,x,b){const j=Iu(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),T=this.paint.get("circle-radius").evaluate(t,i)+this.paint.get("circle-stroke-width").evaluate(t,i);return vI(a,u,g,x,b,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",j,T)}getProgramIds(){return["circle"]}getDefaultProgramParams(a,t,i){const u=_I(this);return{config:new mo(this,{zoom:t,lut:i}),defines:u,overrideFog:!1}}is3D(a){return!a&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends eo{createBucket(a){return new wI(a)}constructor(a,t,i,u){super(a,{layout:SI||(SI=new Er({visibility:new Nt(Oe.layout_heatmap.visibility)})),paint:jI||(jI=new Er({"heatmap-radius":new Gt(Oe.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Gt(Oe.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new Nt(Oe.paint_heatmap["heatmap-intensity"]),"heatmap-color":new Cd(Oe.paint_heatmap["heatmap-color"]),"heatmap-opacity":new Nt(Oe.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(a){a==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=qy({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(a){return bi("heatmap-radius",this,a)}queryIntersectsFeature(a,t,i,u,h,g,x,b){const j=this.paint.get("heatmap-radius").evaluate(t,i);return vI(a,u,g,x,b,!0,!0,new et(0,0),j)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(a,t,i){return a==="heatmap"?{config:new mo(this,{zoom:t,lut:i}),overrideFog:!1}:{}}},hillshade:class extends eo{constructor(a,t,i,u){super(a,{layout:TI||(TI=new Er({visibility:new Nt(Oe.layout_hillshade.visibility)})),paint:NI||(NI=new Er({"hillshade-illumination-direction":new Nt(Oe.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new Nt(Oe.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new Nt(Oe.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new Nt(Oe.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new Nt(Oe.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new Nt(Oe.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new Nt(Oe.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(a,t,i){return{overrideFog:!1}}},fill:class extends eo{constructor(a,t,i,u){super(a,{layout:VI||(VI=new Er({"fill-sort-key":new Gt(Oe.layout_fill["fill-sort-key"]),visibility:new Nt(Oe.layout_fill.visibility),"fill-elevation-reference":new Nt(Oe.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Gt(Oe.layout_fill["fill-construct-bridge-guard-rail"])})),paint:UI||(UI=new Er({"fill-antialias":new Nt(Oe.paint_fill["fill-antialias"]),"fill-opacity":new Gt(Oe.paint_fill["fill-opacity"]),"fill-color":new Gt(Oe.paint_fill["fill-color"]),"fill-outline-color":new Gt(Oe.paint_fill["fill-outline-color"]),"fill-translate":new Nt(Oe.paint_fill["fill-translate"]),"fill-translate-anchor":new Nt(Oe.paint_fill["fill-translate-anchor"]),"fill-pattern":new Gt(Oe.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new Nt(Oe.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new Nt(Oe.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Gt(Oe.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Gt(Oe.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Gt(Oe.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u)}getProgramIds(){const a=this.paint.get("fill-pattern"),t=a&&a.constantOr(1),i=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&i.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),i}getDefaultProgramParams(a,t,i){return{config:new mo(this,{zoom:t,lut:i}),overrideFog:!1}}recalculate(a,t){super.recalculate(a,t);const i=this.paint._values["fill-outline-color"];i.value.kind==="constant"&&i.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(a){return new gj(a)}queryRadius(){return Ir(this.paint.get("fill-translate"))}queryIntersectsFeature(a,t,i,u,h,g){return!a.queryGeometry.isAboveHorizon&&Lr(aa(a.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(a){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return a!=null?t&&!a:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends eo{constructor(a,t,i,u){super(a,{layout:dM||(dM=new Er({visibility:new Nt(Oe["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new Nt(Oe["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:hM||(hM=new Er({"fill-extrusion-opacity":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Gt(Oe["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new Nt(Oe["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new L1(a)}queryRadius(){return Ir(this.paint.get("fill-extrusion-translate"))}is3D(a){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(a,t,i,u,h,g,x,b,j){const T=Iu(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),A=this.paint.get("fill-extrusion-height").evaluate(t,i),I=this.paint.get("fill-extrusion-base").evaluate(t,i),R=[0,0],B=b&&g.elevation,V=g.elevation?g.elevation.exaggeration():1,K=a.tile.getBucket(this);if(B&&K instanceof L1){const he=K.centroidVertexArray,Ee=j+1;Ee<he.length&&(R[0]=he.geta_centroid_pos0(Ee),R[1]=he.geta_centroid_pos1(Ee))}if(R[0]===0&&R[1]===1)return!1;g.projection.name==="globe"&&(u=uM([u],[new et(0,0),new et(Rt,Rt)],a.tileID.canonical).map(he=>he.polygon).flat());const Q=B?b:null,[re,ue]=function(he,Ee,we,je,Me,ke,Qe,Fe,st,Tt,lt){return he.projection.name==="globe"?function(gt,St,Ye,_t,Ve,Je,Ct,vt,os,Jt,ft){const bt=[],ts=[],qt=gt.projection.upVectorScale(ft,gt.center.lat,gt.worldSize).metersToTile,kt=[0,0,0,1],Zt=[0,0,0,1],xs=(zs,ks,on,Gs)=>{zs[0]=ks,zs[1]=on,zs[2]=Gs,zs[3]=1},As=cM();Ye>0&&(Ye+=As),_t+=As;for(const zs of St){const ks=[],on=[];for(const Gs of zs){const nr=Gs.x+Ve.x,me=Gs.y+Ve.y,ge=gt.projection.projectTilePoint(nr,me,ft),Ze=gt.projection.upVector(ft,Gs.x,Gs.y);let At=Ye,Ft=_t;if(Ct){const zt=yM(nr,me,Ye,_t,Ct,vt,os,Jt);At+=zt.base,Ft+=zt.top}Ye!==0?xs(kt,ge.x+Ze[0]*qt*At,ge.y+Ze[1]*qt*At,ge.z+Ze[2]*qt*At):xs(kt,ge.x,ge.y,ge.z),xs(Zt,ge.x+Ze[0]*qt*Ft,ge.y+Ze[1]*qt*Ft,ge.z+Ze[2]*qt*Ft),ws(kt,kt,Je),ws(Zt,Zt,Je),ks.push(new zp(kt[0],kt[1],kt[2])),on.push(new zp(Zt[0],Zt[1],Zt[2]))}bt.push(ks),ts.push(on)}return[bt,ts]}(he,Ee,we,je,Me,ke,Qe,Fe,st,Tt,lt):Qe?function(gt,St,Ye,_t,Ve,Je,Ct,vt,os){const Jt=[],ft=[],bt=[0,0,0,1];for(const ts of gt){const qt=[],kt=[];for(const Zt of ts){const xs=Zt.x+_t.x,As=Zt.y+_t.y,zs=yM(xs,As,St,Ye,Je,Ct,vt,os);bt[0]=xs,bt[1]=As,bt[2]=zs.base,bt[3]=1,gi(bt,bt,Ve),bt[3]=Math.max(bt[3],1e-5);const ks=new zp(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);bt[0]=xs,bt[1]=As,bt[2]=zs.top,bt[3]=1,gi(bt,bt,Ve),bt[3]=Math.max(bt[3],1e-5);const on=new zp(bt[0]/bt[3],bt[1]/bt[3],bt[2]/bt[3]);qt.push(ks),kt.push(on)}Jt.push(qt),ft.push(kt)}return[Jt,ft]}(Ee,we,je,Me,ke,Qe,Fe,st,Tt):function(gt,St,Ye,_t,Ve){const Je=[],Ct=[],vt=Ve[8]*St,os=Ve[9]*St,Jt=Ve[10]*St,ft=Ve[11]*St,bt=Ve[8]*Ye,ts=Ve[9]*Ye,qt=Ve[10]*Ye,kt=Ve[11]*Ye;for(const Zt of gt){const xs=[],As=[];for(const zs of Zt){const ks=zs.x+_t.x,on=zs.y+_t.y,Gs=Ve[0]*ks+Ve[4]*on+Ve[12],nr=Ve[1]*ks+Ve[5]*on+Ve[13],me=Ve[2]*ks+Ve[6]*on+Ve[14],ge=Ve[3]*ks+Ve[7]*on+Ve[15],Ze=Gs+vt,At=nr+os,Ft=me+Jt,zt=Math.max(ge+ft,1e-5),es=Gs+bt,js=nr+ts,Qs=me+qt,en=Math.max(ge+kt,1e-5);xs.push(new zp(Ze/zt,At/zt,Ft/zt)),As.push(new zp(es/en,js/en,Qs/en))}Je.push(xs),Ct.push(As)}return[Je,Ct]}(Ee,we,je,Me,ke)}(g,u,I,A,T,x,Q,R,V,g.center.lat,a.tileID.canonical),ce=a.queryGeometry;return function(he,Ee,we){let je=1/0;Lr(we,Ee)&&(je=xM(we,Ee[0]));for(let Me=0;Me<Ee.length;Me++){const ke=Ee[Me],Qe=he[Me];for(let Fe=0;Fe<ke.length-1;Fe++){const st=ke[Fe],Tt=[st,ke[Fe+1],Qe[Fe+1],Qe[Fe],st];zn(we,Tt)&&(je=Math.min(je,xM(we,Tt)))}}return je!==1/0&&je}(re,ue,ce.isPointQuery()?ce.screenBounds:ce.screenGeometry)}},building:class extends eo{constructor(a,t,i,u){super(a,{layout:UM||(UM=new Er({visibility:new Nt(Oe.layout_building.visibility),"building-facade":new Gt(Oe.layout_building["building-facade"]),"building-facade-floors":new Gt(Oe.layout_building["building-facade-floors"]),"building-facade-window":new Gt(Oe.layout_building["building-facade-window"]),"building-roof-shape":new Gt(Oe.layout_building["building-roof-shape"]),"building-height":new Gt(Oe.layout_building["building-height"]),"building-base":new Gt(Oe.layout_building["building-base"])})),paint:$M||($M=new Er({"building-opacity":new Nt(Oe.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new Nt(Oe.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new Nt(Oe.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new Nt(Oe.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new Nt(Oe.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new Nt(Oe.paint_building["building-vertical-scale"]),"building-cast-shadows":new Nt(Oe.paint_building["building-cast-shadows"]),"building-color":new Gt(Oe.paint_building["building-color"]),"building-emissive-strength":new Gt(Oe.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new Nt(Oe.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new Nt(Oe.paint_building["building-cutoff-fade-range"]),"building-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new VM(a)}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(a){return!0}},line:class extends eo{constructor(a,t,i,u){const h=QM();super(a,h,t,i,u),h.layout&&(this.layout=new Wa(h.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(a){if(a==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof gp,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(a,t){super.recalculate(a,t),this.paint._values["line-floorwidth"]=(()=>{if(u_)return u_;const i=QM();return u_=new _7(i.paint.properties["line-width"].specification),u_.useIntegerZoom=!0,u_})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,a)}createBucket(a){return new Oj(a)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(a,t,i){const u=YM(this);return{config:new mo(this,{zoom:t,lut:i}),defines:u,overrideFog:!1}}queryRadius(a){const t=a,i=eR(bi("line-width",this,t),bi("line-gap-width",this,t)),u=bi("line-offset",this,t);return i/2+Math.abs(u)+Ir(this.paint.get("line-translate"))}queryIntersectsFeature(a,t,i,u,h,g){if(a.queryGeometry.isAboveHorizon)return!1;const x=aa(a.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),g.angle,a.pixelToTileUnitsFactor),b=a.pixelToTileUnitsFactor/2*eR(this.paint.get("line-width").evaluate(t,i),this.paint.get("line-gap-width").evaluate(t,i)),j=this.paint.get("line-offset").evaluate(t,i);return j&&(u=function(T,A){const I=[],R=new et(0,0);for(let B=0;B<T.length;B++){const V=T[B],K=[];for(let Q=0;Q<V.length;Q++){const re=V[Q],ue=V[Q+1],ce=Q===0?R:re.sub(V[Q-1])._unit()._perp(),he=Q===V.length-1?R:ue.sub(re)._unit()._perp(),Ee=ce._add(he)._unit();Ee._mult(1/(Ee.x*he.x+Ee.y*he.y)),K.push(Ee._mult(A)._add(re))}I.push(K)}return I}(u,j*a.pixelToTileUnitsFactor)),function(T,A,I){for(let R=0;R<A.length;R++){const B=A[R];if(T.length>=3){for(let V=0;V<B.length;V++)if(Ui(T,B[V]))return!0}if(Br(T,B,I))return!0}return!1}(x,u,b)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(a){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:ob,background:class extends eo{constructor(a,t,i,u){super(a,{layout:HR||(HR=new Er({visibility:new Nt(Oe.layout_background.visibility)})),paint:WR||(WR=new Er({"background-pitch-alignment":new Nt(Oe.paint_background["background-pitch-alignment"]),"background-color":new Nt(Oe.paint_background["background-color"]),"background-pattern":new Nt(Oe.paint_background["background-pattern"]),"background-opacity":new Nt(Oe.paint_background["background-opacity"]),"background-emissive-strength":new Nt(Oe.paint_background["background-emissive-strength"]),"background-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(a,t,i){return{overrideFog:!1}}is3D(a){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:YR,"raster-particle":nk,sky:class extends eo{constructor(a,t,i,u){super(a,{layout:ek||(ek=new Er({visibility:new Nt(Oe.layout_sky.visibility)})),paint:tk||(tk=new Er({"sky-type":new Nt(Oe.paint_sky["sky-type"]),"sky-atmosphere-sun":new Nt(Oe.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new Nt(Oe.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new Nt(Oe.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new Nt(Oe.paint_sky["sky-gradient-radius"]),"sky-gradient":new Cd(Oe.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new Nt(Oe.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new Nt(Oe.paint_sky["sky-atmosphere-color"]),"sky-opacity":new Nt(Oe.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(a){a==="sky-gradient"?this._updateColorRamp():a!=="sky-atmosphere-sun"&&a!=="sky-atmosphere-halo-color"&&a!=="sky-atmosphere-color"&&a!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=qy({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(a){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=a.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(a,t){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),h=!u,g=a.style.light,x=g.properties.get("position");return h&&g.properties.get("anchor")==="viewport"&&rn("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),h?nT(x.azimuthal,90-x.polar,t):nT(u[0],90-u[1],t)}const i=this.paint.get("sky-gradient-center");return nT(i[0],90-i[1],t)}isSky(){return!0}markSkyboxValid(a){this._skyboxInvalidated=!1,this._lightPosition=a.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const a=this.paint.get("sky-type");return a==="atmosphere"?["skyboxCapture","skybox"]:a==="gradient"?["skyboxGradient"]:null}},slot:class extends eo{constructor(a,t,i,u){super(a,{paint:sk||(sk=new Er({}))},t,null)}},model:class extends eo{constructor(a,t,i,u){super(a,{layout:ak||(ak=new Er({visibility:new Nt(Oe.layout_model.visibility),"model-id":new Gt(Oe.layout_model["model-id"])})),paint:lk||(lk=new Er({"model-opacity":new Gt(Oe.paint_model["model-opacity"]),"model-rotation":new Gt(Oe.paint_model["model-rotation"]),"model-scale":new Gt(Oe.paint_model["model-scale"]),"model-translation":new Gt(Oe.paint_model["model-translation"]),"model-color":new Gt(Oe.paint_model["model-color"]),"model-color-mix-intensity":new Gt(Oe.paint_model["model-color-mix-intensity"]),"model-type":new Nt(Oe.paint_model["model-type"]),"model-cast-shadows":new Nt(Oe.paint_model["model-cast-shadows"]),"model-receive-shadows":new Nt(Oe.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new Nt(Oe.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Gt(Oe.paint_model["model-emissive-strength"]),"model-roughness":new Gt(Oe.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Gt(Oe.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new Nt(Oe.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new Nt(Oe.paint_model["model-front-cutoff"]),"model-color-use-theme":new Gt({type:"string",default:"default","property-type":"data-driven"})}))},t,i,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(a){return new iT(a)}getProgramIds(){return["model"]}is3D(a){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(a){return a instanceof ub?Rt-1:0}queryIntersectsFeature(a,t,i,u,h,g){if(!this.modelManager)return!1;const x=this.modelManager,b=a.tile.getBucket(this);if(!(b&&b instanceof iT))return!1;for(const j in b.instancesPerModel){const T=b.instancesPerModel[j],A=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(T.idToFeaturesIndex.hasOwnProperty(A)){const I=T.features[T.idToFeaturesIndex[A]],R=x.getModel(j,this.scope);if(!R)return!1;let B=Y();const V=new D(0,0),K=b.canonical;let Q=Number.MAX_VALUE;for(let re=0;re<I.instancedDataCount;++re){const ue=16*(I.instancedDataOffset+re),ce=T.instancedDataArray.float32,he=[ce[ue+4],ce[ue+5],ce[ue+6]];pk(K,V,ce[ue],0|ce[ue+1]),kM(B,R,g,V,I.rotation,I.scale,he,!1,!1,!1),g.projection.name==="globe"&&(B=Rj(B,g));const Ee=Z([],g.projMatrix,B),we=a.queryGeometry,je=RM(we.isPointQuery()?we.screenBounds:we.screenGeometry,g,Ee,R.aabb);je!=null&&(Q=Math.min(je,Q))}return Q!==Number.MAX_VALUE&&Q}}return!1}_handleOverridablePaintPropertyUpdate(a,t,i){return!(!this.layout||t.isDataDriven()||i.isDataDriven()||a!=="model-color"&&a!=="model-color-mix-intensity"&&a!=="model-rotation"&&a!=="model-scale"&&a!=="model-translation"&&a!=="model-emissive-strength")}_isPropertyZoomDependent(a){const t=this._transitionablePaint._values[a];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof Pc}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends eo{constructor(a,t,i,u){super(a,{layout:$I||($I=new Er({"clip-layer-types":new Nt(Oe.layout_clip["clip-layer-types"]),"clip-layer-scope":new Nt(Oe.layout_clip["clip-layer-scope"])})),paint:GI||(GI=new Er({}))},t,i,u)}recalculate(a,t){super.recalculate(a,t)}createBucket(a){return new HI(a)}is3D(a){return!0}}},aT=new En(0,0,0),lT={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},cT={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},db={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},wH={PAINT_ORDER_FILL_AND_STROKE:1},S_={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},fk={MASK_TYPE_LUMINANCE:1};function SH(a,t,i){a===1&&t.icons.push(function(u,h){return function(g){if(g.usvg_tree.height||(g.usvg_tree.height=g.usvg_tree.width),!g.metadata)return g;const{metadata:x}=g;if(x.content_area){const{content_area:b}=x;b.top==null&&(b.top=b.left),b.width==null&&(b.width=g.usvg_tree.width),b.height==null&&(b.height=b.width)}return x.stretch_x&&x.stretch_x.length&&mk(x,"x"),x.stretch_y&&x.stretch_y.length&&mk(x,"y"),g}(u.readFields(jH,{name:void 0},h))}(i,i.readVarint()+i.pos))}function mk(a,t){const i=[],u=a[`stretch_${t}`];let h=null;for(let g=0;g<u.length;g++)h===null?h=i.length===0?u[0]:i[i.length-1][1]+u[g]:(i.push([h,h+u[g]]),h=null);a[`stretch_${t}_areas`]=i}function jH(a,t,i){a===1?t.name=i.readString():a===2?t.metadata=function(u,h){return u.readFields(TH,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},h)}(i,i.readVarint()+i.pos):a===3&&(t.usvg_tree=function(u,h){return u.readFields(CH,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},h)}(i,i.readVarint()+i.pos),t.data="usvg_tree")}function TH(a,t,i){a===1?t.stretch_x=i.readPackedVarint():a===2?t.stretch_y=i.readPackedVarint():a===3?t.content_area=function(u,h){return u.readFields(NH,{left:0},h)}(i,i.readVarint()+i.pos):a===4&&t.variables.push(function(u,h){return u.readFields(EH,{name:void 0},h)}(i,i.readVarint()+i.pos))}function NH(a,t,i){a===1?t.left=i.readVarint():a===2?t.width=i.readVarint():a===3?t.top=i.readVarint():a===4&&(t.height=i.readVarint())}function EH(a,t,i){a===1?t.name=i.readString():a===2&&(t.rgb_color=fb(i.readVarint()),t.value="rgb_color")}function CH(a,t,i){a===1?t.width=t.height=i.readVarint():a===2?t.height=i.readVarint():a===3?t.children.push(hb(i,i.readVarint()+i.pos)):a===4?t.linear_gradients.push(function(u,h){return u.readFields(DH,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},h)}(i,i.readVarint()+i.pos)):a===5?t.radial_gradients.push(function(u,h){return u.readFields(zH,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},h)}(i,i.readVarint()+i.pos)):a===7?t.clip_paths.push(function(u,h){return u.readFields(OH,{children:[]},h)}(i,i.readVarint()+i.pos)):a===8&&t.masks.push(function(u,h){const g=u.readFields(FH,{left:0,width:20,mask_type:fk.MASK_TYPE_LUMINANCE,children:[]},h);return g.height==null&&(g.height=g.width),g.top==null&&(g.top=g.left),g}(i,i.readVarint()+i.pos))}function hb(a,t){return a.readFields(AH,{},t)}function AH(a,t,i){a===1?(t.group=function(u,h){return u.readFields(PH,{opacity:255,children:[]},h)}(i,i.readVarint()+i.pos),t.node="group"):a===2&&(t.path=function(u,h){return u.readFields(MH,{paint_order:1,commands:[],step:1,diffs:[],rule:lT.PATH_RULE_NON_ZERO},h)}(i,i.readVarint()+i.pos),t.node="path")}function PH(a,t,i){a===1?t.transform=pb(i,i.readVarint()+i.pos):a===2?t.opacity=i.readVarint():a===5?t.clip_path_idx=i.readVarint():a===6?t.mask_idx=i.readVarint():a===7&&t.children.push(hb(i,i.readVarint()+i.pos))}function pb(a,t){return a.readFields(IH,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function IH(a,t,i){a===1?t.sx=i.readFloat():a===2?t.ky=i.readFloat():a===3?t.kx=i.readFloat():a===4?t.sy=i.readFloat():a===5?t.tx=i.readFloat():a===6&&(t.ty=i.readFloat())}function MH(a,t,i){a===1?t.fill=function(u,h){return u.readFields(RH,{rgb_color:aT,paint:"rgb_color",opacity:255},h)}(i,i.readVarint()+i.pos):a===2?t.stroke=function(u,h){return u.readFields(kH,{rgb_color:aT,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},h)}(i,i.readVarint()+i.pos):a===3?t.paint_order=i.readVarint():a===5?i.readPackedVarint(t.commands):a===6?t.step=i.readFloat():a===7?i.readPackedSVarint(t.diffs):a===8&&(t.rule=i.readVarint())}function RH(a,t,i){a===1?(t.rgb_color=fb(i.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):a===5&&(t.opacity=i.readVarint())}function fb(a){return new En((a>>16&255)/255,(a>>8&255)/255,(255&a)/255,1)}function kH(a,t,i){a===1?(t.rgb_color=fb(i.readVarint()),t.paint="rgb_color"):a===2?(t.linear_gradient_idx=i.readVarint(),t.paint="linear_gradient_idx"):a===3?(t.radial_gradient_idx=i.readVarint(),t.paint="radial_gradient_idx"):a===5?i.readPackedFloat(t.dasharray):a===6?t.dashoffset=i.readFloat():a===7?t.miterlimit=i.readFloat():a===8?t.opacity=i.readVarint():a===9?t.width=i.readFloat():a===10?t.linecap=i.readVarint():a===11&&(t.linejoin=i.readVarint())}function DH(a,t,i){a===1?t.transform=pb(i,i.readVarint()+i.pos):a===2?t.spread_method=i.readVarint():a===3?t.stops.push(gk(i,i.readVarint()+i.pos)):a===4?t.x1=i.readFloat():a===5?t.y1=i.readFloat():a===6?t.x2=i.readFloat():a===7&&(t.y2=i.readFloat())}function gk(a,t){return a.readFields(LH,{offset:0,opacity:255,rgb_color:aT},t)}function LH(a,t,i){a===1?t.offset=i.readFloat():a===2?t.opacity=i.readVarint():a===3&&(t.rgb_color=fb(i.readVarint()))}function zH(a,t,i){a===1?t.transform=pb(i,i.readVarint()+i.pos):a===2?t.spread_method=i.readVarint():a===3?t.stops.push(gk(i,i.readVarint()+i.pos)):a===4?t.cx=i.readFloat():a===5?t.cy=i.readFloat():a===6?t.r=i.readFloat():a===7?t.fx=i.readFloat():a===8?t.fy=i.readFloat():a===9&&(t.fr=i.readFloat())}function OH(a,t,i){a===1?t.transform=pb(i,i.readVarint()+i.pos):a===2?t.clip_path_idx=i.readVarint():a===3&&t.children.push(hb(i,i.readVarint()+i.pos))}function FH(a,t,i){a===1?t.left=t.top=i.readFloat():a===2?t.width=t.height=i.readFloat():a===3?t.top=i.readFloat():a===4?t.height=i.readFloat():a===5?t.mask_type=i.readVarint():a===6?t.mask_idx=i.readVarint():a===7&&t.children.push(hb(i,i.readVarint()+i.pos))}class BH{static calculate(t={},i=[]){const u=new Map,h=new Map;if(Object.keys(t).length===0)return u;i.forEach(g=>{h.set(g.name,g.rgb_color||new En(0,0,0))});for(const[g,x]of Object.entries(t))h.has(g)?u.set(h.get(g).toString(),x):console.warn(`Ignoring unknown image variable "${g}"`);return u}}function Jm(a,t=255,i){const u=t/255,h=a.toString(),g=i.has(h)?i.get(h).clone():a.clone();return g.a*=u,g.toString()}function j_(a,t){if(!Bf()){const i=document.createElement("canvas");return i.width=a,i.height=t,i}return new OffscreenCanvas(a,t)}function VH(a,t){const i=BH.calculate(t.params,a.metadata?a.metadata.variables:[]),u=a.usvg_tree,h=u.width,g=u.height,x=t.transform?t.transform:new DOMMatrix,b=Math.max(1,Math.round(h*x.a)),j=Math.max(1,Math.round(g*x.d)),T=new DOMMatrix([b/h,0,0,j/g,0,0]),A=j_(b,j).getContext("2d");return uT(A,T,u,u,i),A.getImageData(0,0,b,j)}function uT(a,t,i,u,h){for(const g of u.children)xk(a,t,i,g,h)}function xk(a,t,i,u,h){u.group?(a.save(),function(g,x,b,j,T){const A=j.mask_idx!=null?b.masks[j.mask_idx]:null,I=j.clip_path_idx!=null?b.clip_paths[j.clip_path_idx]:null;if(j.transform&&(x=Qm(j.transform).preMultiplySelf(x)),!function(V,K,Q){return V.opacity!==255||K||Q}(j,I!=null,A!=null))return void uT(g,x,b,j,T);const R=j_(g.canvas.width,g.canvas.height),B=R.getContext("2d");uT(B,x,b,j,T),I&&jk(B,x,b,I),A&&Tk(B,x,b,A,T),g.globalAlpha=j.opacity/255,g.drawImage(R,0,0)}(a,t,i,u.group,h),a.restore()):u.path&&(a.save(),function(g,x,b,j,T){g.setTransform(x),j.paint_order===wH.PAINT_ORDER_FILL_AND_STROKE?(yk(g,b,j,T),vk(g,b,j,T)):(vk(g,b,j,T),yk(g,b,j,T))}(a,t,i,u.path,h),a.restore())}function yk(a,t,i,u){const h=i.fill;if(!h)return;const g=h.opacity/255;switch(a.save(),a.beginPath(),Nk(i,a),h.paint){case"rgb_color":a.fillStyle=Jm(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":{const x=t.linear_gradients[h.linear_gradient_idx];x.transform&&a.setTransform(Qm(x.transform).preMultiplySelf(a.getTransform())),a.fillStyle=bk(a,x,g,u);break}case"radial_gradient_idx":{const x=t.radial_gradients[h.radial_gradient_idx];x.transform&&a.setTransform(Qm(x.transform).preMultiplySelf(a.getTransform())),a.fillStyle=wk(a,x,g,u)}}a.fill(_k(i)),a.restore()}function _k(a){return a.rule===lT.PATH_RULE_NON_ZERO?"nonzero":a.rule===lT.PATH_RULE_EVEN_ODD?"evenodd":void 0}function vk(a,t,i,u){const h=i.stroke;if(!h)return;const g=Ek(i);a.lineWidth=h.width,a.miterLimit=h.miterlimit,a.setLineDash(h.dasharray),a.lineDashOffset=h.dashoffset;const x=h.opacity/255;switch(h.paint){case"rgb_color":a.strokeStyle=Jm(h.rgb_color,h.opacity,u);break;case"linear_gradient_idx":a.strokeStyle=bk(a,t.linear_gradients[h.linear_gradient_idx],x,u,!0);break;case"radial_gradient_idx":a.strokeStyle=wk(a,t.radial_gradients[h.radial_gradient_idx],x,u,!0)}switch(h.linejoin){case db.LINE_JOIN_MITER_CLIP:case db.LINE_JOIN_MITER:a.lineJoin="miter";break;case db.LINE_JOIN_ROUND:a.lineJoin="round";break;case db.LINE_JOIN_BEVEL:a.lineJoin="bevel"}switch(h.linecap){case cT.LINE_CAP_BUTT:a.lineCap="butt";break;case cT.LINE_CAP_ROUND:a.lineCap="round";break;case cT.LINE_CAP_SQUARE:a.lineCap="square"}a.stroke(g)}function bk(a,t,i,u,h=!1){if(t.stops.length===1){const R=t.stops[0];return Jm(R.rgb_color,R.opacity*i,u)}const{x1:g,y1:x,x2:b,y2:j}=t;let T=new DOMPoint(g,x),A=new DOMPoint(b,j);if(h){const R=Qm(t.transform);T=R.transformPoint(T),A=R.transformPoint(A)}const I=a.createLinearGradient(T.x,T.y,A.x,A.y);for(const R of t.stops)I.addColorStop(R.offset,Jm(R.rgb_color,R.opacity*i,u));return I}function wk(a,t,i,u,h=!1){if(t.stops.length===1){const re=t.stops[0];return Jm(re.rgb_color,re.opacity*i,u)}const g=Qm(t.transform),{fx:x,fy:b,fr:j,cx:T,cy:A,r:I}=t;let R=new DOMPoint(x,b),B=new DOMPoint(T,A),V=j,K=I;if(h){R=g.transformPoint(R),B=g.transformPoint(B);const re=(g.a+g.d)/2;V=j*re,K=t.r*re}const Q=a.createRadialGradient(R.x,R.y,V,B.x,B.y,K);for(const re of t.stops)Q.addColorStop(re.offset,Jm(re.rgb_color,re.opacity*i,u));return Q}function Sk(a,t,i,u){const h=u.transform?Qm(u.transform).preMultiplySelf(t):t,g=j_(a.canvas.width,a.canvas.height),x=g.getContext("2d");for(const j of u.children)if(j.group)Sk(x,h,i,j.group);else if(j.path){const T=j.path,A=new Path2D;A.addPath(Ek(T),h),x.fill(A,_k(T))}const b=u.clip_path_idx!=null?i.clip_paths[u.clip_path_idx]:null;b&&jk(x,h,i,b),a.globalCompositeOperation="source-over",a.drawImage(g,0,0)}function jk(a,t,i,u){const h=j_(a.canvas.width,a.canvas.height);Sk(h.getContext("2d"),t,i,u),a.globalCompositeOperation="destination-in",a.drawImage(h,0,0)}function Tk(a,t,i,u,h){if(u.children.length===0)return;const g=u.mask_idx!=null?i.masks[u.mask_idx]:null;g&&Tk(a,t,i,g,h);const x=a.canvas.width,b=a.canvas.height,j=j_(x,b),T=j.getContext("2d"),A=u.width,I=u.height,R=u.left,B=u.top,V=new Path2D,K=new Path2D;K.rect(R,B,A,I),V.addPath(K,t),T.clip(V);for(const ue of u.children)xk(T,t,i,ue,h);const Q=T.getImageData(0,0,x,b),re=Q.data;if(u.mask_type===fk.MASK_TYPE_LUMINANCE)for(let ue=0;ue<re.length;ue+=4)re[ue+3]=re[ue+3]/255*(.2126*re[ue]+.7152*re[ue+1]+.0722*re[ue+2]);T.putImageData(Q,0,0),a.globalCompositeOperation="destination-in",a.drawImage(j,0,0)}function Qm(a){return a?new DOMMatrix([a.sx,a.ky,a.kx,a.sy,a.tx,a.ty]):new DOMMatrix}function Nk(a,t){const i=a.step;let u=a.diffs[0]*i,h=a.diffs[1]*i;t.moveTo(u,h);for(let g=0,x=2;g<a.commands.length;g++)switch(a.commands[g]){case S_.PATH_COMMAND_MOVE:u+=a.diffs[x++]*i,h+=a.diffs[x++]*i,t.moveTo(u,h);break;case S_.PATH_COMMAND_LINE:u+=a.diffs[x++]*i,h+=a.diffs[x++]*i,t.lineTo(u,h);break;case S_.PATH_COMMAND_QUAD:{const b=u+a.diffs[x++]*i,j=h+a.diffs[x++]*i;u=b+a.diffs[x++]*i,h=j+a.diffs[x++]*i,t.quadraticCurveTo(b,j,u,h);break}case S_.PATH_COMMAND_CUBIC:{const b=u+a.diffs[x++]*i,j=h+a.diffs[x++]*i,T=b+a.diffs[x++]*i,A=j+a.diffs[x++]*i;u=T+a.diffs[x++]*i,h=A+a.diffs[x++]*i,t.bezierCurveTo(b,j,T,A,u,h);break}case S_.PATH_COMMAND_CLOSE:t.closePath()}return t}function Ek(a){return Nk(a,new Path2D)}class mb{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const i=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,i),i}put(t,i){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,i)}delete(t){this.cache.delete(t)}}Yt(mb,"LRUCache");class dT{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new $i(t,t.data)}getFromCache(t,i,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new mb(150)),this.cacheMap.get(u).get(Id(t.toString(),i))}setInCache(t,i,u,h){this.cacheDependenciesMap.has(h)||this.cacheDependenciesMap.set(h,new Map),this.cacheMap.has(h)||this.cacheMap.set(h,new mb(150));const g=this.cacheDependenciesMap.get(h),x=Id(t.id.toString(),u);g.get(x)||g.set(x,new Set);const b=this.cacheMap.get(h),j=t.toString();g.get(x).add(j),b.put(Id(t.toString(),u),i)}removeImagesFromCacheByIds(t,i,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const h=this.cacheMap.get(u),g=this.cacheDependenciesMap.get(u);for(const x of t){const b=Id(x.toString(),i);if(g.has(b)){for(const j of g.get(b))h.delete(j);g.delete(b)}}}rasterize(t,i,u,h,g=VH){const x=this.getFromCache(t,u,h);if(x)return x.clone();const b=g(i.icon,t.options),j=dT._getImage(b);return this.setInCache(t,j,u,h),j.clone()}}class Ck{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,i){const u=this.toIdx(t,i);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,i){return this.leaves[this.toIdx(t,i)]}toIdx(t,i){return i*this.size+t}}function Ak(a,t,i,u){let h=0,g=Number.MAX_VALUE;for(let x=0;x<3;x++)if(Math.abs(u[x])<1e-15){if(i[x]<a[x]||i[x]>t[x])return null}else{const b=1/u[x];let j=(a[x]-i[x])*b,T=(t[x]-i[x])*b;if(j>T){const A=j;j=T,T=A}if(j>h&&(h=j),T<g&&(g=T),h>g)return null}return h}function Pk(a,t,i,u,h,g,x,b,j,T,A){const I=u-a,R=h-t,B=g-i,V=x-a,K=b-t,Q=j-i,re=A[1]*Q-A[2]*K,ue=A[2]*V-A[0]*Q,ce=A[0]*K-A[1]*V,he=I*re+R*ue+B*ce;if(Math.abs(he)<1e-15)return null;const Ee=1/he,we=T[0]-a,je=T[1]-t,Me=T[2]-i,ke=(we*re+je*ue+Me*ce)*Ee;if(ke<0||ke>1)return null;const Qe=je*B-Me*R,Fe=Me*I-we*B,st=we*R-je*I,Tt=(A[0]*Qe+A[1]*Fe+A[2]*st)*Ee;return Tt<0||ke+Tt>1?null:(V*Qe+K*Fe+Q*st)*Ee}function Ik(a,t,i){return(a-t)/(i-t)}function Mk(a,t,i,u,h,g,x,b,j){const T=1<<i,A=g-u,I=x-h,R=(a+1)/T*A+u,B=(t+0)/T*I+h,V=(t+1)/T*I+h;b[0]=(a+0)/T*A+u,b[1]=B,j[0]=R,j[1]=V}class Rk{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const i=function(g){const x=Math.ceil(Math.log2(g.dim/8)),b=[];let j=Math.ceil(Math.pow(2,x));const T=1/j,A=(B,V,K,Q,re)=>{const ue=Q?1:0,ce=(B+1)*K-ue,he=V*K,Ee=(V+1)*K-ue;re[0]=B*K,re[1]=he,re[2]=ce,re[3]=Ee};let I=new Ck(j);const R=[];for(let B=0;B<j*j;B++){A(B%j,Math.floor(B/j),T,!1,R);const V=Yd(R[0],R[1],g),K=Yd(R[2],R[1],g),Q=Yd(R[2],R[3],g),re=Yd(R[0],R[3],g);I.minimums.push(Math.min(V,K,Q,re)),I.maximums.push(Math.max(V,K,Q,re)),I.leaves.push(1)}for(b.push(I),j/=2;j>=1;j/=2){const B=b[b.length-1];I=new Ck(j);for(let V=0;V<j*j;V++){A(V%j,Math.floor(V/j),2,!0,R);const K=B.getElevation(R[0],R[1]),Q=B.getElevation(R[2],R[1]),re=B.getElevation(R[2],R[3]),ue=B.getElevation(R[0],R[3]),ce=B.isLeaf(R[0],R[1]),he=B.isLeaf(R[2],R[1]),Ee=B.isLeaf(R[2],R[3]),we=B.isLeaf(R[0],R[3]),je=Math.min(K.min,Q.min,re.min,ue.min),Me=Math.max(K.max,Q.max,re.max,ue.max),ke=ce&&he&&Ee&&we;I.maximums.push(Me),I.minimums.push(je),I.leaves.push(Me-je<=5&&ke?1:0)}b.push(I)}return b}(this.dem),u=i.length-1,h=i[u];this._addNode(h.minimums[0],h.maximums[0],h.leaves[0]),this._construct(i,0,0,u,0)}raycastRoot(t,i,u,h,g,x,b=1){return Ak([t,i,-100],[u,h,this.maximums[0]*b],g,x)}raycast(t,i,u,h,g,x,b=1){if(!this.nodeCount)return null;const j=this.raycastRoot(t,i,u,h,g,x,b);if(j==null)return null;const T=[],A=[],I=[],R=[],B=[{idx:0,t:j,nodex:0,nodey:0,depth:0}];for(;B.length>0;){const{idx:V,t:K,nodex:Q,nodey:re,depth:ue}=B.pop();if(this.leaves[V]){Mk(Q,re,ue,t,i,u,h,I,R);const he=1<<ue,Ee=(Q+0)/he,we=(Q+1)/he,je=(re+0)/he,Me=(re+1)/he,ke=Yd(Ee,je,this.dem)*b,Qe=Yd(we,je,this.dem)*b,Fe=Yd(we,Me,this.dem)*b,st=Yd(Ee,Me,this.dem)*b,Tt=Pk(I[0],I[1],ke,R[0],I[1],Qe,R[0],R[1],Fe,g,x),lt=Pk(R[0],R[1],Fe,I[0],R[1],st,I[0],I[1],ke,g,x),gt=Math.min(Tt!==null?Tt:Number.MAX_VALUE,lt!==null?lt:Number.MAX_VALUE);if(gt!==Number.MAX_VALUE)return gt;{const St=Mt([],g,x,K);if(kk(ke,Qe,st,Fe,Ik(St[0],I[0],R[0]),Ik(St[1],I[1],R[1]))>=St[2])return K}continue}let ce=0;for(let he=0;he<this._siblingOffset.length;he++){Mk((Q<<1)+this._siblingOffset[he][0],(re<<1)+this._siblingOffset[he][1],ue+1,t,i,u,h,I,R),I[2]=-100,R[2]=this.maximums[this.childOffsets[V]+he]*b;const Ee=Ak(I,R,g,x);if(Ee!=null){const we=Ee;T[he]=we;let je=!1;for(let Me=0;Me<ce&&!je;Me++)we>=T[A[Me]]&&(A.splice(Me,0,he),je=!0);je||(A[ce]=he),ce++}}for(let he=0;he<ce;he++){const Ee=A[he];B.push({idx:this.childOffsets[V]+Ee,t:T[Ee],nodex:(Q<<1)+this._siblingOffset[Ee][0],nodey:(re<<1)+this._siblingOffset[Ee][1],depth:ue+1})}}return null}_addNode(t,i,u){return this.minimums.push(t),this.maximums.push(i),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,i,u,h,g){if(t[h].isLeaf(i,u)===1)return;this.childOffsets[g]||(this.childOffsets[g]=this.nodeCount);const x=h-1,b=t[x];let j=0,T=0;for(let A=0;A<this._siblingOffset.length;A++){const I=2*i+this._siblingOffset[A][0],R=2*u+this._siblingOffset[A][1],B=b.getElevation(I,R),V=b.isLeaf(I,R),K=this._addNode(B.min,B.max,V);V&&(j|=1<<A),T||(T=K)}for(let A=0;A<this._siblingOffset.length;A++)j&1<<A||this._construct(t,2*i+this._siblingOffset[A][0],2*u+this._siblingOffset[A][1],x,T+A)}}function kk(a,t,i,u,h,g){return fs(fs(a,i,g),fs(t,u,g),h)}function Yd(a,t,i){const u=i.dim,h=xe(a*u-.5,0,u-1),g=xe(t*u-.5,0,u-1),x=Math.floor(h),b=Math.floor(g),j=Math.min(x+1,u-1),T=Math.min(b+1,u-1);return kk(i.get(x,b),i.get(j,b),i.get(x,T),i.get(j,T),h-x,g-b)}const UH={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function $H(a,t,i){return(256*a*256+256*t+i)/10-1e4}function GH(a,t,i){return 256*a+t+i/256-32768}class gb{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,i,u,h=!1){if(this.uid=t,i.height!==i.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void rn(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=i.height;const g=this.dim=i.height-2,x=new Uint32Array(i.data.buffer);if(this.pixels=new Uint8Array(i.data.buffer),this.floatView=new Float32Array(i.data.buffer),this.borderReady=h,this._modifiedForSources={},!h){for(let j=0;j<g;j++)x[this._idx(-1,j)]=x[this._idx(0,j)],x[this._idx(g,j)]=x[this._idx(g-1,j)],x[this._idx(j,-1)]=x[this._idx(j,0)],x[this._idx(j,g)]=x[this._idx(j,g-1)];x[this._idx(-1,-1)]=x[this._idx(0,0)],x[this._idx(g,-1)]=x[this._idx(g-1,0)],x[this._idx(-1,g)]=x[this._idx(0,g-1)],x[this._idx(g,g)]=x[this._idx(g-1,g-1)]}const b=u==="terrarium"?GH:$H;for(let j=0;j<x.length;++j){const T=4*j;this.floatView[j]=b(this.pixels[T],this.pixels[T+1],this.pixels[T+2])}this._timestamp=$a.now()}_buildQuadTree(){this._tree=new Rk(this)}get(t,i,u=!1){u&&(t=xe(t,-1,this.dim),i=xe(i,-1,this.dim));const h=this._idx(t,i);return this.floatView[h]}set(t,i,u){const h=this._idx(t,i),g=this.floatView[h];return this.floatView[h]=u,u-g}static getUnpackVector(t){return UH[t]}_idx(t,i){if(t<-1||t>=this.dim+1||i<-1||i>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(i+1)*this.stride+(t+1)}static pack(t,i){const u=[0,0,0,0],h=gb.getUnpackVector(i);let g=Math.floor((t+h[3])/h[2]);return u[2]=g%256,g=Math.floor(g/256),u[1]=g%256,g=Math.floor(g/256),u[0]=g,u}getPixels(){return new AI({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,i,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let h=i*this.dim,g=i*this.dim+this.dim,x=u*this.dim,b=u*this.dim+this.dim;switch(i){case-1:h=g-1;break;case 1:g=h+1}switch(u){case-1:x=b-1;break;case 1:b=x+1}const j=-i*this.dim,T=-u*this.dim;for(let A=x;A<b;A++)for(let I=h;I<g;I++){const R=4*this._idx(I,A),B=4*this._idx(I+j,A+T);this.pixels[R+0]=t.pixels[B+0],this.pixels[R+1]=t.pixels[B+1],this.pixels[R+2]=t.pixels[B+2],this.pixels[R+3]=t.pixels[B+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function HH(a,t,i){a===1?t.headerLength=i.readFixed32():a===2?t.x=i.readVarint():a===3?t.y=i.readVarint():a===4?t.z=i.readVarint():a===5&&t.layers.push(function(u,h){return u.readFields(XH,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},h)}(i,i.readVarint()+i.pos))}function WH(a,t,i){a===1?(t.delta_filter=function(u,h){return u.readFields(qH,{blockSize:0},h)}(i,i.readVarint()+i.pos),t.filter="delta_filter"):a===2?(i.readVarint(),t.filter="zigzag_filter"):a===3?(i.readVarint(),t.filter="bitshuffle_filter"):a===4&&(i.readVarint(),t.filter="byteshuffle_filter")}function qH(a,t,i){a===1&&(t.blockSize=i.readVarint())}function ZH(a,t,i){a===1?(i.readVarint(),t.codec="gzip_data"):a===2?(i.readVarint(),t.codec="jpeg_image"):a===3?(i.readVarint(),t.codec="webp_image"):a===4&&(i.readVarint(),t.codec="png_image")}function KH(a,t,i){let u=0,h=0;a===1?t.firstByte=i.readFixed64():a===2?t.lastByte=i.readFixed64():a===3?t.filters.push(function(g,x){return g.readFields(WH,{},x)}(i,i.readVarint()+i.pos)):a===4?t.codec=function(g,x){return g.readFields(ZH,{},x)}(i,i.readVarint()+i.pos):a===5?h=i.readFloat():a===6?u=i.readFloat():a===7?t.bands.push(i.readString()):a===8?t.offset=i.readDouble():a===9&&(t.scale=i.readDouble()),t.offset===0&&(t.offset=h),t.scale===0&&(t.scale=u)}function XH(a,t,i){a===1?t.version=i.readVarint():a===2?t.name=i.readString():a===3?t.units=i.readString():a===4?t.tileSize=i.readVarint():a===5?t.buffer=i.readVarint():a===6?t.pixelFormat=i.readVarint():a===7&&t.dataIndex.push(function(u,h){return u.readFields(KH,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},h)}(i,i.readVarint()+i.pos))}function YH(a,t,i){if(a===2)(function(u,h,g){u.readFields(JH,g,h)})(i,i.readVarint()+i.pos,t);else if(a===3)throw new Error("Not implemented")}function JH(a,t,i){if(a===1){let u=0;const h=i.readVarint()+i.pos;for(;i.pos<h;)t[u++]=i.readVarint()}}function QH(a,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let i=t[3];for(let u=2;u>=1;u--){const h=u===1?1:0,g=u===2?1:0;for(let x=0;x<t[0];x++){const b=t[1]*x;for(let j=h;j<t[1];j++){const T=t[2]*(j+b);for(let A=g;A<t[2];A++){const I=t[3]*(A+T);for(let R=0;R<t[3];R++){const B=I+R;a[B]+=a[B-i]}}}}i*=t[u]}return a}function e9(a){for(let t=0,i=a.length;t<i;t++)a[t]=a[t]>>>1^-(1&a[t]);return a}function t9(a,t){switch(t){case"uint32":return a;case"uint16":for(let i=0;i<a.length;i+=2){const u=a[i],h=a[i+1];a[i]=(240&u)>>4|(61440&u)>>8|(240&h)<<4|61440&h,a[i+1]=15&u|(3840&u)>>4|(15&h)<<8|(3840&h)<<4}return a;case"uint8":for(let i=0;i<a.length;i+=4){const u=a[i],h=a[i+1],g=a[i+2],x=a[i+3];a[i+0]=(192&u)>>6|(192&h)>>4|(192&g)>>2|192&x,a[i+1]=(48&u)>>4|(48&h)>>2|48&g|(48&x)<<2,a[i+2]=(12&u)>>2|12&h|(12&g)<<2|(12&x)<<4,a[i+3]=3&u|(3&h)<<2|(3&g)<<4|(3&x)<<6}return a;default:throw new Error(`Invalid pixel format, "${t}"`)}}Yt(gb,"DEMData"),Yt(Rk,"DemMinMaxQuadTree",{omit:["dem"]});var Za=Uint8Array,T_=Uint16Array,s9=Int32Array,Dk=new Za([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),Lk=new Za([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),n9=new Za([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),zk=function(a,t){for(var i=new T_(31),u=0;u<31;++u)i[u]=t+=1<<a[u-1];var h=new s9(i[30]);for(u=1;u<30;++u)for(var g=i[u];g<i[u+1];++g)h[g]=g-i[u]<<5|u;return{b:i,r:h}},Ok=zk(Dk,2),Fk=Ok.b,r9=Ok.r;Fk[28]=258,r9[258]=28;for(var i9=zk(Lk,0).b,Bk=new T_(32768),Jr=0;Jr<32768;++Jr){var eg=(43690&Jr)>>1|(21845&Jr)<<1;Bk[Jr]=((65280&(eg=(61680&(eg=(52428&eg)>>2|(13107&eg)<<2))>>4|(3855&eg)<<4))>>8|(255&eg)<<8)>>1}var N_=function(a,t,i){for(var u=a.length,h=0,g=new T_(t);h<u;++h)a[h]&&++g[a[h]-1];var x,b=new T_(t);for(h=1;h<t;++h)b[h]=b[h-1]+g[h-1]<<1;x=new T_(1<<t);var j=15-t;for(h=0;h<u;++h)if(a[h])for(var T=h<<4|a[h],A=t-a[h],I=b[a[h]-1]++<<A,R=I|(1<<A)-1;I<=R;++I)x[Bk[I]>>j]=T;return x},E_=new Za(288);for(Jr=0;Jr<144;++Jr)E_[Jr]=8;for(Jr=144;Jr<256;++Jr)E_[Jr]=9;for(Jr=256;Jr<280;++Jr)E_[Jr]=7;for(Jr=280;Jr<288;++Jr)E_[Jr]=8;var Vk=new Za(32);for(Jr=0;Jr<32;++Jr)Vk[Jr]=5;var o9=N_(E_,9),a9=N_(Vk,5),hT=function(a){for(var t=a[0],i=1;i<a.length;++i)a[i]>t&&(t=a[i]);return t},Gl=function(a,t,i){var u=t/8|0;return(a[u]|a[u+1]<<8)>>(7&t)&i},pT=function(a,t){var i=t/8|0;return(a[i]|a[i+1]<<8|a[i+2]<<16)>>(7&t)},l9=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],Hl=function(a,t,i){var u=new Error(t||l9[a]);if(u.code=a,Error.captureStackTrace&&Error.captureStackTrace(u,Hl),!i)throw u;return u},c9=new Za(0),u9=typeof TextDecoder<"u"&&new TextDecoder;try{u9.decode(c9,{stream:!0})}catch{}const d9={gzip_data:"gzip"};class _l extends Error{constructor(t){super(t),this.name="MRTError"}}const h9={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},Uk={uint32:1,uint16:2,uint8:4},p9={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let fT;class xb{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const i=this.layers[t];if(!i)throw new _l(`Layer '${t}' not found`);return i}getHeaderLength(t){const i=new Uint8Array(t),u=new DataView(t);if(i[0]!==13)throw new _l("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){const i=new Uint8Array(t),u=this.getHeaderLength(t);if(i.length<u)throw new _l(`Expected header with length >= ${u} but got buffer of length ${i.length}`);const h=new fT(i.subarray(0,u)).readFields(HH,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==h.x||this.y!==h.y||this.z!==h.z))throw new _l(`Invalid attempt to parse header ${h.z}/${h.x}/${h.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=h.x,this.y=h.y,this.z=h.z;for(const g of h.layers)this.layers[g.name]=new $k(g,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const i=[],u=this.getLayer(t.layerName);for(let h of t.blockIndices){const g=u.dataIndex[h],x=g.firstByte-t.firstByte,b=g.lastByte-t.firstByte;if(u._blocksInProgress.has(h))continue;const j={layerName:u.name,firstByte:x,lastByte:b,pixelFormat:u.pixelFormat,blockIndex:h,blockShape:[g.bands.length].concat(u.bandShape),buffer:u.buffer,codec:g.codec.codec,filters:g.filters.map(T=>T.filter)};u._blocksInProgress.add(h),i.push(j)}return new Gk(i,()=>{i.forEach(h=>u._blocksInProgress.delete(h.blockIndex))},(h,g)=>{if(i.forEach(x=>u._blocksInProgress.delete(x.blockIndex)),h)throw h;g.forEach(x=>{this.getLayer(x.layerName).processDecodedData(x)})})}}class $k{constructor({version:t,name:i,units:u,tileSize:h,pixelFormat:g,buffer:x,dataIndex:b},j){if(this.version=t,this.version!==1)throw new _l(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=i,this.units=u,this.tileSize=h,this.buffer=x,this.pixelFormat=h9[g],this.dataIndex=b,this.bandShape=[h+2*x,h+2*x,Uk[this.pixelFormat]],this._decodedBlocks=new mb(j?j.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return Uk[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map(({bands:t})=>t).flat()}processDecodedData(t){const i=t.blockIndex.toString();this._decodedBlocks.get(i)||this._decodedBlocks.put(i,t.data)}getBlockForBand(t){let i=0;switch(typeof t){case"string":for(const[u,h]of this.dataIndex.entries()){for(const[g,x]of h.bands.entries())if(x===t)return{bandIndex:i+g,blockIndex:u,blockBandIndex:g};i+=h.bands.length}break;case"number":for(const[u,h]of this.dataIndex.entries()){if(t>=i&&t<i+h.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-i};i+=h.bands.length}break;default:throw new _l(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let i=1/0,u=-1/0;const h=[],g=new Set;for(const x of t){const{blockIndex:b}=this.getBlockForBand(x);if(b<0)throw new _l(`Invalid band: ${JSON.stringify(x)}`);const j=this.dataIndex[b];h.includes(b)||h.push(b),g.add(b),i=Math.min(i,j.firstByte),u=Math.max(u,j.lastByte)}if(g.size>this.cacheSize)throw new _l(`Number of blocks to decode (${g.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:i,lastByte:u,blockIndices:h}}hasBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0}hasDataForBand(t){const{blockIndex:i}=this.getBlockForBand(t);return i>=0&&!!this._decodedBlocks.get(i.toString())}getBandView(t){const{blockIndex:i,blockBandIndex:u}=this.getBlockForBand(t);if(i<0)throw new _l(`Band not found: ${JSON.stringify(t)}`);const h=this._decodedBlocks.get(i.toString());if(!h)throw new _l(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const g=this.dataIndex[i],x=this.bandShape.reduce((T,A)=>T*A,1),b=u*x,j=h.subarray(b,b+x);return{data:j,bytes:new Uint8Array(j.buffer).subarray(j.byteOffset,j.byteOffset+j.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:g.offset,scale:g.scale}}}xb.setPbf=function(a){fT=a};class Gk{constructor(t,i,u){this.tasks=t,this._onCancel=i,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,i){this._finalized||(this._onComplete(t,i),this._finalized=!0)}}xb.performDecoding=function(a,t){const i=new Uint8Array(a);return Promise.all(t.tasks.map(u=>{const{layerName:h,firstByte:g,lastByte:x,pixelFormat:b,blockShape:j,blockIndex:T,filters:A,codec:I}=u,R=i.subarray(g,x+1),B=new Uint32Array(j[0]*j[1]*j[2]);let V;if(I!=="gzip_data")throw new _l(`Unhandled codec: ${I}`);return V=function(K,Q){if(!globalThis.DecompressionStream&&Q==="gzip_data")return Promise.resolve(((he=function(je){je[0]==31&&je[1]==139&&je[2]==8||Hl(6,"invalid gzip data");var Me=je[3],ke=10;4&Me&&(ke+=2+(je[10]|je[11]<<8));for(var Qe=(Me>>3&1)+(Me>>4&1);Qe>0;Qe-=!je[ke++]);return ke+(2&Me)}(ce=K))+8>ce.length&&Hl(6,"invalid gzip data"),function(je,Me,ke,Qe){var Fe=je.length;if(!Fe||Me.f&&!Me.l)return ke||new Za(0);var st=!ke,Tt=st||Me.i!=2,lt=Me.i;st&&(ke=new Za(3*Fe));var gt,St,Ye=function(xr){var rr=ke.length;if(xr>rr){var Jn=new Za(Math.max(2*rr,xr));Jn.set(ke),ke=Jn}},_t=Me.f||0,Ve=Me.p||0,Je=Me.b||0,Ct=Me.l,vt=Me.d,os=Me.m,Jt=Me.n,ft=8*Fe;do{if(!Ct){_t=Gl(je,Ve,1);var bt=Gl(je,Ve+1,3);if(Ve+=3,!bt){var ts=je[(me=4+((Ve+7)/8|0))-4]|je[me-3]<<8,qt=me+ts;if(qt>Fe){lt&&Hl(0);break}Tt&&Ye(Je+ts),ke.set(je.subarray(me,qt),Je),Me.b=Je+=ts,Me.p=Ve=8*qt,Me.f=_t;continue}if(bt==1)Ct=o9,vt=a9,os=9,Jt=5;else if(bt==2){var kt=Gl(je,Ve,31)+257,Zt=Gl(je,Ve+10,15)+4,xs=kt+Gl(je,Ve+5,31)+1;Ve+=14;for(var As=new Za(xs),zs=new Za(19),ks=0;ks<Zt;++ks)zs[n9[ks]]=Gl(je,Ve+3*ks,7);Ve+=3*Zt;var on=hT(zs),Gs=(1<<on)-1,nr=N_(zs,on);for(ks=0;ks<xs;){var me,ge=nr[Gl(je,Ve,Gs)];if(Ve+=15&ge,(me=ge>>4)<16)As[ks++]=me;else{var Ze=0,At=0;for(me==16?(At=3+Gl(je,Ve,3),Ve+=2,Ze=As[ks-1]):me==17?(At=3+Gl(je,Ve,7),Ve+=3):me==18&&(At=11+Gl(je,Ve,127),Ve+=7);At--;)As[ks++]=Ze}}var Ft=As.subarray(0,kt),zt=As.subarray(kt);os=hT(Ft),Jt=hT(zt),Ct=N_(Ft,os),vt=N_(zt,Jt)}else Hl(1);if(Ve>ft){lt&&Hl(0);break}}Tt&&Ye(Je+131072);for(var es=(1<<os)-1,js=(1<<Jt)-1,Qs=Ve;;Qs=Ve){var en=(Ze=Ct[pT(je,Ve)&es])>>4;if((Ve+=15&Ze)>ft){lt&&Hl(0);break}if(Ze||Hl(2),en<256)ke[Je++]=en;else{if(en==256){Qs=Ve,Ct=null;break}var Bs=en-254;en>264&&(Bs=Gl(je,Ve,(1<<(Os=Dk[ks=en-257]))-1)+Fk[ks],Ve+=Os);var Rn=vt[pT(je,Ve)&js],br=Rn>>4;if(Rn||Hl(3),Ve+=15&Rn,zt=i9[br],br>3){var Os=Lk[br];zt+=pT(je,Ve)&(1<<Os)-1,Ve+=Os}if(Ve>ft){lt&&Hl(0);break}Tt&&Ye(Je+131072);var ar=Je+Bs;if(Je<zt){var Yn=0-zt,An=Math.min(zt,ar);for(Yn+Je<0&&Hl(3);Je<An;++Je)ke[Je]=(void 0)[Yn+Je]}for(;Je<ar;++Je)ke[Je]=ke[Je-zt]}}Me.l=Ct,Me.p=Qs,Me.b=Je,Me.f=_t,Ct&&(_t=1,Me.m=os,Me.d=vt,Me.n=Jt)}while(!_t);return Je!=ke.length&&st?(gt=ke,((St=Je)==null||St>gt.length)&&(St=gt.length),new Za(gt.subarray(0,St))):ke.subarray(0,Je)}(ce.subarray(he,-8),{i:2},new Za(((re=ce)[(ue=re.length)-4]|re[ue-3]<<8|re[ue-2]<<16|re[ue-1]<<24)>>>0))));var re,ue,ce,he;const Ee=d9[Q];if(!Ee)throw new Error(`Unhandled codec: ${Q}`);const we=new globalThis.DecompressionStream(Ee);return new Response(new Blob([K]).stream().pipeThrough(we)).arrayBuffer().then(je=>new Uint8Array(je))}(R,I).then(K=>(function(Q,re){Q.readFields(YH,re)}(new fT(K),B),new p9[b](B.buffer))),V.then(K=>{for(let Q=A.length-1;Q>=0;Q--)switch(A[Q]){case"delta_filter":QH(K,j);break;case"zigzag_filter":e9(K);break;case"bitshuffle_filter":t9(K,b);break;default:throw new _l(`Unhandled filter "${A[Q]}"`)}return{layerName:h,blockIndex:T,data:K}}).catch(K=>{throw K})}))},Yt(Gk,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),Yt(xb,"MapboxRasterTile"),Yt($k,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class Hk{constructor(t){this._stringToNumber={},this._numberToString=[];for(let i=0;i<t.length;i++){const u=t[i];this._stringToNumber[u]=i,this._numberToString[i]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const f9=["id","tile","layer","source","sourceLayer","state"];class tg{constructor(t,i,u,h,g){this.type="Feature",this._vectorTileFeature=t,this._z=i,this._x=u,this._y=h,this.properties=t.properties,this.id=g}clone(){const t=new tg(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const i of f9)this[i]!==void 0&&(t[i]=this[i]);return t}}class Wk{constructor(t,i){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Ic(Rt,16,0),this.featureIndexArray=new f1,this.promoteId=i,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,i,u,h,g,x=0,b=0){const j=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,h,g,x);const T=this.grid;for(let A=0;A<i.length;A++){const I=i[A],R=[1/0,1/0,-1/0,-1/0];for(let B=0;B<I.length;B++){const V=I[B];R[0]=Math.min(R[0],V.x),R[1]=Math.min(R[1],V.y),R[2]=Math.max(R[2],V.x),R[3]=Math.max(R[3],V.y)}b!==0&&(R[0]-=b,R[1]-=b,R[2]+=b,R[3]+=b),R[0]<Rt&&R[1]<Rt&&R[2]>=0&&R[3]>=0&&T.insert(j,R[0],R[1],R[2],R[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new ns(new H1(this.rawTileData)).layers,this.sourceLayerCoder=new Hk(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,i){const{tilespaceGeometry:u,transform:h,tileTransform:g,pixelPosMatrix:x,availableImages:b,worldview:j}=i;this.loadVTLayers(),this.serializedLayersCache.clear();const T=u.bufferedTilespaceBounds,A=this.grid.query(T.min.x,T.min.y,T.max.x,T.max.y,(V,K,Q,re)=>Pr(u.bufferedTilespaceGeometry,V,K,Q,re));A.sort(m9);let I=null;h.elevation&&A.length>0&&(I=Ym.create(h.elevation,this.tileID));const R={};let B;for(let V=0;V<A.length;V++){const K=A[V];if(K===B)continue;B=K;const Q=this.featureIndexArray.get(K);let re=null;this.is3DTile?this.loadMatchingModelFeature(R,Q,t,u,h,j):this.loadMatchingFeature(R,Q,t,b,j,(ue,ce,he,Ee=0)=>(re||(re=Ae(ue,this.tileID.canonical,g)),ce.queryIntersectsFeature(u,ue,he,re,this.z,h,x,I,Ee)))}return R}loadMatchingFeature(t,i,u,h,g,x){const{featureIndex:b,bucketIndex:j,sourceLayerIndex:T,layoutVertexArrayOffset:A}=i,I=this.bucketLayerIDs[j],R=u.layers,B=Object.keys(R);if(B.length&&!nn(B,I))return;const V=u.sourceCache,K=this.sourceLayerCoder.decode(T),Q=this.vtLayers[K].feature(b),re=this.getId(Q,K);for(let ue=0;ue<I.length;ue++){const ce=I[ue];if(!R[ce])continue;const{styleLayer:he,targets:Ee}=R[ce];let we={};re!==void 0&&(we=V.getFeatureState(he.sourceLayer,re));const je=!x||x(Q,he,we,A);if(!je)continue;const Me=new tg(Q,this.z,this.x,this.y,re);Me.tile=this.tileID.canonical,Me.state=we;let ke=this.serializedLayersCache.get(ce);ke||(ke=he.serialize(),ke.id=ce,this.serializedLayersCache.set(ce,ke)),Me.source=ke.source,Me.sourceLayer=ke["source-layer"],Me.layer=He({},ke),Me.layer.paint=qk(ke.paint,he.paint,Q,we,h),Me.layer.layout=qk(ke.layout,he.layout,Q,we,h);let Qe=!1;for(const Fe of Ee){this.updateFeatureProperties(Me,Fe);const{filter:st}=Fe;if(st){if(Q.properties=Me.properties,st.needGeometry){const Tt=Ke(Q,!0);if(!st.filter(new Mn(this.tileID.overscaledZ,{worldview:g}),Tt,this.tileID.canonical))continue}else if(!st.filter(new Mn(this.tileID.overscaledZ,{worldview:g}),Q))continue}Qe=!0,Fe.targetId&&this.addFeatureVariant(Me,Fe)}Qe&&this.appendToResult(t,ce,b,Me,je)}}loadMatchingModelFeature(t,i,u,h,g,x){const{featureIndex:b,bucketIndex:j}=i,T=this.bucketLayerIDs[j],A=u.layers,I=Object.keys(A);if(!I.length||nn(I,T))for(let R=0;R<T.length;R++){const B=T[R],{styleLayer:V,targets:K}=A[B];if(V.type!=="model")continue;const Q=h.tile,re=Q.getBucket(V);if(!(re&&re instanceof ub))continue;const ue=vH(re,b,h,g);if(!ue)continue;const{z:ce,x:he,y:Ee}=Q.tileID.canonical,{feature:we,intersectionZ:je,position:Me}=ue;let ke={};we.id!==void 0&&(ke=u.sourceCache.getFeatureState(V.sourceLayer,we.id));const Qe=new tg({},ce,he,Ee,we.id);Qe.tile=this.tileID.canonical,Qe.state=ke,Qe.properties=we.properties,Qe.geometry={type:"Point",coordinates:[Me.lng,Me.lat]};let Fe=this.serializedLayersCache.get(B);Fe||(Fe=V.serialize(),Fe.id=B,this.serializedLayersCache.set(B,Fe)),Qe.source=Fe.source,Qe.sourceLayer=Fe["source-layer"],Qe.layer=He({},Fe);let st=!1;for(const Tt of K){this.updateFeatureProperties(Qe,Tt);const{filter:lt}=Tt;if(lt){if(we.properties=Qe.properties,lt.needGeometry){if(!lt.filter(new Mn(this.tileID.overscaledZ,{worldview:x}),we,this.tileID.canonical))continue}else if(!lt.filter(new Mn(this.tileID.overscaledZ,{worldview:x}),we))continue}st=!0,Tt.targetId&&this.addFeatureVariant(Qe,Tt)}st&&this.appendToResult(t,B,b,Qe,je)}}updateFeatureProperties(t,i,u){if(i.properties){const h={};for(const g in i.properties){const x=i.properties[g].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,u);x!=null&&(h[g]=x)}t.properties=h}}addFeatureVariant(t,i,u){const h={target:i.target,namespace:i.namespace,uniqueFeatureID:i.uniqueFeatureID};i.properties&&(h.properties=t.properties),t.variants=t.variants||{},t.variants[i.targetId]=t.variants[i.targetId]||[],t.variants[i.targetId].push(h)}appendToResult(t,i,u,h,g){let x=t[i];x===void 0&&(x=t[i]=[]),x.push({featureIndex:u,feature:h,intersectionZ:g})}lookupSymbolFeatures(t,i,u,h,g,x){const b={};this.loadVTLayers();for(const j of t)this.loadMatchingFeature(b,{bucketIndex:i,sourceLayerIndex:u,featureIndex:j,layoutVertexArrayOffset:0},h,g,x);return b}loadFeature(t){const{featureIndex:i,sourceLayerIndex:u}=t;this.loadVTLayers();const h=this.sourceLayerCoder.decode(u),g=this.vtFeatures[h];if(g[i])return g[i];const x=this.vtLayers[h].feature(i);return g[i]=x,x}hasLayer(t){for(const i of this.bucketLayerIDs)for(const u of i)if(t===u)return!0;return!1}getId(t,i){let u=t.id;if(this.promoteId){const h=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[i];if(h!=null)if(Array.isArray(h)){if(!this.promoteIdExpression){const g=Nu(h);if(g.result!=="success"){const x=g.value.map(b=>`${b.key}: ${b.message}`).join(", ");return void rn(`Failed to create expression for promoteId: ${x}`)}this.promoteIdExpression=g.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new dp),u=this.promoteIdExpression.evaluate({zoom:0},t)}else u=t.properties[h];typeof u=="boolean"&&(u=Number(u))}return u}}function qk(a,t,i,u,h){return Is(a,(g,x)=>{const b=t instanceof Wa?t.get(x):null;return b&&b.evaluate?b.evaluate(i,u,void 0,h):b})}function m9(a,t){return t-a}Yt(Wk,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const Zk=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class mT{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[i,u]=new Uint8Array(t,0,2);if(i!==219)throw new Error("Data does not appear to be in a KDBush format.");const h=u>>4;if(h!==1)throw new Error(`Got v${h} data when expected v1.`);const g=Zk[15&u];if(!g)throw new Error("Unrecognized array type.");const[x]=new Uint16Array(t,2,1),[b]=new Uint32Array(t,4,1);return new mT(b,x,g,t)}constructor(t,i=64,u=Float64Array,h){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+i,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const g=Zk.indexOf(this.ArrayType),x=2*t*this.ArrayType.BYTES_PER_ELEMENT,b=t*this.IndexArrayType.BYTES_PER_ELEMENT,j=(8-b%8)%8;if(g<0)throw new Error(`Unexpected typed array class: ${u}.`);h&&h instanceof ArrayBuffer?(this.data=h,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+j,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+x+b+j),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+b+j,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+g]),new Uint16Array(this.data,2,1)[0]=i,new Uint32Array(this.data,4,1)[0]=t)}add(t,i){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=i,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return gT(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,i,u,h){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:g,coords:x,nodeSize:b}=this,j=[0,g.length-1,0],T=[];for(;j.length;){const A=j.pop()||0,I=j.pop()||0,R=j.pop()||0;if(I-R<=b){for(let Q=R;Q<=I;Q++){const re=x[2*Q],ue=x[2*Q+1];re>=t&&re<=u&&ue>=i&&ue<=h&&T.push(g[Q])}continue}const B=R+I>>1,V=x[2*B],K=x[2*B+1];V>=t&&V<=u&&K>=i&&K<=h&&T.push(g[B]),(A===0?t<=V:i<=K)&&(j.push(R),j.push(B-1),j.push(1-A)),(A===0?u>=V:h>=K)&&(j.push(B+1),j.push(I),j.push(1-A))}return T}within(t,i,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:h,coords:g,nodeSize:x}=this,b=[0,h.length-1,0],j=[],T=u*u;for(;b.length;){const A=b.pop()||0,I=b.pop()||0,R=b.pop()||0;if(I-R<=x){for(let Q=R;Q<=I;Q++)Xk(g[2*Q],g[2*Q+1],t,i)<=T&&j.push(h[Q]);continue}const B=R+I>>1,V=g[2*B],K=g[2*B+1];Xk(V,K,t,i)<=T&&j.push(h[B]),(A===0?t-u<=V:i-u<=K)&&(b.push(R),b.push(B-1),b.push(1-A)),(A===0?t+u>=V:i+u>=K)&&(b.push(B+1),b.push(I),b.push(1-A))}return j}}function gT(a,t,i,u,h,g){if(h-u<=i)return;const x=u+h>>1;Kk(a,t,x,u,h,g),gT(a,t,i,u,x-1,1-g),gT(a,t,i,x+1,h,1-g)}function Kk(a,t,i,u,h,g){for(;h>u;){if(h-u>600){const T=h-u+1,A=i-u+1,I=Math.log(T),R=.5*Math.exp(2*I/3),B=.5*Math.sqrt(I*R*(T-R)/T)*(A-T/2<0?-1:1);Kk(a,t,i,Math.max(u,Math.floor(i-A*R/T+B)),Math.min(h,Math.floor(i+(T-A)*R/T+B)),g)}const x=t[2*i+g];let b=u,j=h;for(C_(a,t,u,i),t[2*h+g]>x&&C_(a,t,u,h);b<j;){for(C_(a,t,b,j),b++,j--;t[2*b+g]<x;)b++;for(;t[2*j+g]>x;)j--}t[2*u+g]===x?C_(a,t,u,j):(j++,C_(a,t,j,h)),j<=i&&(u=j+1),i<=j&&(h=j-1)}}function C_(a,t,i,u){xT(a,i,u),xT(t,2*i,2*u),xT(t,2*i+1,2*u+1)}function xT(a,t,i){const u=a[t];a[t]=a[i],a[i]=u}function Xk(a,t,i,u){const h=a-i,g=t-u;return h*h+g*g}o.$=_i,o.A=zl,o.B=Fl,o.C=Id,o.D=Vm,o.E=xu,o.F=2,o.G=f_,o.H=wR,o.I=Do,o.J=vc,o.K=class extends cb{},o.L=yu,o.M=a1,o.N=xm,o.O=gm,o.P=et,o.Q=Yv,o.R=Qh,o.S=fy,o.T=Ij,o.U=jp,o.V=cb,o.W=my,o.X=Nu,o.Y=sm,o.Z=wd,o._=bd,o.a=function(a){return Ii.API_CDN_URL_REGEX.test(a)},o.a$=ut,o.a0=zx,o.a1=Tp,o.a2=ym,o.a3=Xv,o.a4=function(a){const t=a.value;let i=[];if(!t)return i;const u=vc(t);return u!=="string"?(i=i.concat([new cb(a.key,t,`string expected, "${u}" found`)]),i):(rT(t,!0)||(i=i.concat([new cb(a.key,t,`invalid url "${t}"`)])),i)},o.a5=Oe,o.a6=Sp,o.a7=Er,o.a8=Nt,o.a9=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return $r(a.expression.evaluate(t))}interpolate(a,t,i){return{x:fs(a.x,t.x,i),y:fs(a.y,t.y,i),z:fs(a.z,t.z,i),azimuthal:fs(a.azimuthal,t.azimuthal,i),polar:fs(a.polar,t.polar,i)}}},o.aA=gi,o.aB=to,o.aC=Ui,o.aD=J,o.aE=Ie,o.aF=function(a,t){const i={};for(let u=0;u<t.length;u++){const h=t[u];h in a&&(i[h]=a[h])}return i},o.aG=U,o.aH=se,o.aI=class{constructor(a){this.entries={},this.scheduler=a}request(a,t,i,u){const h=this.entries[a]=this.entries[a]||{callbacks:[]};if(h.result){const[g,x]=h.result;return this.scheduler?this.scheduler.add(()=>{u(g,x)},t):u(g,x),()=>{}}return h.callbacks.push(u),h.cancel||(h.cancel=i((g,x)=>{h.result=[g,x];for(const b of h.callbacks)this.scheduler?this.scheduler.add(()=>{b(g,x)},t):b(g,x);setTimeout(()=>delete this.entries[a],3e3)})),()=>{h.result||(h.callbacks=h.callbacks.filter(g=>g!==u),h.callbacks.length||(h.cancel(),delete this.entries[a]))}}},o.aJ=function(a,t,i){const u=JSON.stringify(a.request);return a.data&&(this.deduped.entries[u]={result:[null,a.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:a.isSymbolTile,zoom:a.tileZoom},h=>{const g=ep(a.request,(x,b,j,T)=>{x?h(x):b&&h(null,{vectorTile:i?void 0:new ns(new H1(b)),rawData:b,cacheControl:j,expires:T})});return()=>{g.cancel(),h()}},t)},o.aK=function(a){Mx++,Mx>Ll&&(a.getActor().send("enforceCacheSizeLimit",Ga),Mx=0)},o.aL=function(a){return a<=1?1:Math.pow(2,Math.floor(Math.log(a)/Math.LN2))},o.aM=Wr,o.aN=YR,o.aO=nk,o.aP=XR,o.aQ=function(a,t){const i=document.createElement("video");i.muted=!0,i.onloadstart=function(){t(null,i)};for(let u=0;u<a.length;u++){const h=document.createElement("source");jS(a[u])||(i.crossOrigin="Anonymous"),h.src=a[u],i.appendChild(h)}return{cancel:()=>{}}},o.aR=l_,o.aS=function(a){return fetch(a).then(t=>t.arrayBuffer()).then(t=>CM(t,0,a))},o.aT=LM,o.aU=class{constructor(a,t,i,u){this.id=a,this.position=t!=null?new D(t[0],t[1]):new D(0,0),this.orientation=i??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new qs([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(a,t){if(Z(a.matrix,t,a.matrix),a.meshes)for(const i of a.meshes){const u=qs.applyTransformFast(i.aabb,a.matrix);this.aabb.encapsulate(u)}if(a.children)for(const i of a.children)this._applyTransformations(i,a.matrix)}computeBoundsAndApplyParent(){const a=H([]);for(const t of this.nodes)this._applyTransformations(t,a)}computeModelMatrix(a,t,i,u,h,g,x=!1){kM(this.matrix,this,a.transform,this.position,t,i,u,h,g,x)}upload(a){if(!this.uploaded){for(const t of this.nodes)kj(t,a);for(const t of this.nodes)G1(t);this.uploaded=!0}}destroy(){for(const a of this.nodes)Dj(a)}},o.aV=Ts,o.aW=x_,o.aX=le,o.aY=de,o.aZ=Rd,o.a_=ur,o.aa=Mn,o.ab=Pc,o.ac=be,o.ad=ws,o.ae=Dt,o.af=Re,o.ag=Wa,o.ah=Gd,o.ai=fs,o.aj=Rt,o.ak=Tv,o.al=Ks,o.am=En,o.an=class{constructor(a){this.specification=a}possiblyEvaluate(a,t){return function([i,u]){const h=$r([1,i,u]);return{x:h.x,y:h.y,z:h.z}}(a.expression.evaluate(t))}interpolate(a,t,i){return{x:fs(a.x,t.x,i),y:fs(a.y,t.y,i),z:fs(a.z,t.z,i)}}},o.ao=function(a,t,i=0,u=!0){const h=new et(i,i),g=a.sub(h),x=t.add(h),b=[g,new et(x.x,g.y),x,new et(g.x,x.y)];return u&&b.push(g.clone()),b},o.ap=function(a,t){const i=[];for(let u=0;u<a.length;u++){const h=qe(u-1,-1,a.length-1),g=qe(u+1,-1,a.length-1),x=a[u],b=a[g],j=a[h].sub(x).unit(),T=b.sub(x).unit(),A=T.angleWithSep(j.x,j.y),I=j.add(T).unit().mult(-1*t/Math.sin(A/2));i.push(x.add(I))}return i},o.aq=LR,o.ar=Pr,o.as=function(a,t,i=0){return wt(((t.x-i)*a.scale-a.x)*Rt,(t.y*a.scale-a.y)*Rt,pe(t.z,t.y))},o.at=vn,o.au=Ms,o.av=fn,o.aw=qM,o.ax=function(a){let t=1/0,i=1/0,u=-1/0,h=-1/0;for(const g of a)t=Math.min(t,g.x),i=Math.min(i,g.y),u=Math.max(u,g.x),h=Math.max(h,g.y);return{min:new et(t,i),max:new et(u,h)}},o.ay=xe,o.az=Z,o.b=function(a){return Ii.API_FONTS_REGEX.test(a)},o.b$=Kj,o.b0=d1,o.b1=ib,o.b2=function(){fl.isLoading()||fl.isLoaded()||wy()!=="deferred"||r1()},o.b3=Ad,o.b4=Ke,o.b5=tg,o.b6=bn,o.b7=Oj,o.b8=gj,o.b9=Ae,o.bA=function(a,t){const{x:i,y:u}=a.point,h=gI(i,u,a.worldSize/a._pixelsPerMercatorPixel,0,0);return Z(h,h,oj(Oc(t)))},o.bB=M,o.bC=wr,o.bD=function(a,t){return Math.hypot(t[0]-a[0],t[1]-a[1],t[2]-a[2])},o.bE=Mt,o.bF=It,o.bG=Xt,o.bH=p_,o.bI=da,o.bJ=Hj,o.bK=function(a,t,i,u,h){const g=5*t+2;a.float32[g+0]=i,a.float32[g+1]=u,a.float32[g+2]=h},o.bL=rb,o.bM=co,o.bN=Ua,o.bO=ba,o.bP=jo,o.bQ=qe,o.bR=function(a,t,i,u){var h=new P(4);return h[0]=a,h[1]=t,h[2]=i,h[3]=u,h},o.bS=z1,o.bT=zn,o.bU=wi,o.bV=qI,o.bW=rk,o.bX=YI,o.bY=_j,o.bZ=Gj,o.b_=AR,o.ba=Po,o.bb=Ly,o.bc=uI,o.bd=mr,o.be=Fm,o.bf=sT,o.bg=function(a,t){const i=Gd(t.zoom);if(i===0)return Oc(a);const u=N1(a),h=ij(u),g=J(u.getWest())*t.worldSize,x=J(u.getEast())*t.worldSize,b=se(u.getNorth())*t.worldSize,j=se(u.getSouth())*t.worldSize,T=[g,b,0],A=[x,b,0],I=[g,j,0],R=[x,j,0],B=X([],t.globeMatrix);return ws(T,T,B),ws(A,A,B),ws(I,I,B),ws(R,R,B),h[0]=Ru(h[0],I,i),h[1]=Ru(h[1],R,i),h[2]=Ru(h[2],A,i),h[3]=Ru(h[3],T,i),qs.fromPoints(h)},o.bh=C1,o.bi=X,o.bj=Wy,o.bk=Ru,o.bl=Md,o.bm=q$,o.bn=Pe,o.bo=W,o.bp=xb,o.bq=H1,o.br=ep,o.bs=function(a,t){const i=[];for(const u in a)u in t||i.push(u);return i},o.bt=De,o.bu=["type","source","source-layer","minzoom","maxzoom","filter","layout"],o.bv=er,o.bw=function(a){var t=new P(16);return t[0]=a[0],t[1]=a[1],t[2]=a[2],t[3]=a[3],t[4]=a[4],t[5]=a[5],t[6]=a[6],t[7]=a[7],t[8]=a[8],t[9]=a[9],t[10]=a[10],t[11]=a[11],t[12]=a[12],t[13]=a[13],t[14]=a[14],t[15]=a[15],t},o.bx=H,o.by=Ne,o.bz=Y,o.c=zf,o.c$=45,o.c0=mT,o.c1=nt,o.c2=Rr,o.c3=Ki,o.c4=function(a,t,i){i*=.5;var u=t[0],h=t[1],g=t[2],x=t[3],b=Math.sin(i),j=Math.cos(i);return a[0]=u*j+h*b,a[1]=h*j-u*b,a[2]=g*j+x*b,a[3]=x*j-g*b,a},o.c5=Rl,o.c6=vr,o.c7=function(a,t){return a[0]=-t[0],a[1]=-t[1],a[2]=-t[2],a[3]=t[3],a},o.c8=ct,o.c9=function(a,t,i,u,h){var g,x=1/Math.tan(t/2);return a[0]=x/i,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=x,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[11]=-1,a[12]=0,a[13]=0,a[15]=0,h!=null&&h!==1/0?(a[10]=(h+u)*(g=1/(u-h)),a[14]=2*h*u*g):(a[10]=-1,a[14]=-2*u),a},o.cA=la,o.cB=pI,o.cC=function(a,t,i,u,h,g,x,b,j){if(j.name==="globe")return pI(a,t,new la(i,u,h),!1);const T=x_({z:i,x:u,y:h},j);return new qs([(g+T.x/T.scale)*t,t*(T.y/T.scale),x],[(g+T.x2/T.scale)*t,t*(T.y2/T.scale),b])},o.cD=function(a,t,i){return a[0]=Math.min(t[0],i[0]),a[1]=Math.min(t[1],i[1]),a[2]=Math.min(t[2],i[2]),a[3]=Math.min(t[3],i[3]),a},o.cE=function(a,t,i){return a[0]=Math.max(t[0],i[0]),a[1]=Math.max(t[1],i[1]),a[2]=Math.max(t[2],i[2]),a[3]=Math.max(t[3],i[3]),a},o.cF=function(a){const t=Math.round((a+45+360)%360/90)%4;return ne[t]},o.cG=ye,o.cH=ao,o.cI=p,o.cJ=function(a){const t=H(new Float64Array(16));Z(t,a.pixelMatrix,a.globeMatrix);const i=[0,y,0],u=[0,v,0];return ws(i,i,t),ws(u,u,t),[i[0]>0&&i[0]<=a.width&&i[1]>0&&i[1]<=a.height&&!lj(a,new D(a.center.lat,90)),u[0]>0&&u[0]<=a.width&&u[1]>0&&u[1]<=a.height&&!lj(a,new D(a.center.lat,-90))]},o.cK=function(a,t){const{scale:i}=a.tileTransform,u=i*Rt/(a.tileSize*Math.pow(2,t.zoom-a.tileID.overscaledZ+a.tileID.canonical.z));return function(h,g,x){var b=g[1],j=g[2],T=g[3],A=x[0],I=x[1];return h[0]=g[0]*A,h[1]=b*A,h[2]=j*I,h[3]=T*I,h}(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},o.cL=U1,o.cM=xt,o.cN=AM,o.cO=function(a){const t=AM(a,!0);return M([],[t[0],t[1],t[4],t[5]])},o.cP=q,o.cQ=yn,o.cR=oe,o.cS=function(a){const{x:t,y:i}=a.point,{lng:u,lat:h}=a._center;return gI(t,i,a.worldSize,u,h)},o.cT=ze,o.cU=Be,o.cV=ca,o.cW=Sr,o.cX=S1,o.cY=function(a,t,i){let u=0;for(let h=0;h<2;++h)a[h]>0&&(u+=(a[h]-0)*(a[h]-0)),t[h]<0&&(u+=(0-t[h])*(0-t[h]));return u},o.cZ=function(a){return a*a*a*a*a},o.c_=ee,o.ca=function(a,t,i,u,h,g,x){var b=1/(t-i),j=1/(u-h),T=1/(g-x);return a[0]=-2*b,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=-2*j,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=2*T,a[11]=0,a[12]=(t+i)*b,a[13]=(h+u)*j,a[14]=(x+g)*T,a[15]=1,a},o.cb=te,o.cc=function(a,t,i){a[4*t+0]=i[0],a[4*t+1]=i[1],a[4*t+2]=i[2],a[4*t+3]=i[3]},o.cd=Om,o.ce=Bd,o.cf=zr,o.cg=xl,o.ch=Rp,o.ci=D,o.cj=VR,o.ck=function(){var a=new P(4);return P!=Float32Array&&(a[1]=0,a[2]=0),a[0]=1,a[3]=1,a},o.cl=function(a,t,i){var u=t[0],h=t[1],g=t[2],x=t[3],b=Math.sin(i),j=Math.cos(i);return a[0]=u*j+g*b,a[1]=h*j+x*b,a[2]=u*-b+g*j,a[3]=h*-b+x*j,a},o.cm=function(a,t){return a[0]===t[0]&&a[1]===t[1]&&a[2]===t[2]&&a[3]===t[3]},o.cn=cr,o.co=function(a){return Math.hypot(a[0],a[1],a[2],a[3])},o.cp=Ba,o.cq=cn,o.cr=yl,o.cs=3,o.ct=2,o.cu=7,o.cv=6,o.cw=Ns,o.cx=yt,o.cy=wn,o.cz=PM,o.d=function(a){return Ii.API_TILEJSON_REGEX.test(a)},o.d$=(a,t,i,u,h,g,x,b,j,T)=>{const A=a.transform,I=A.calculatePixelsToTileUnitsMatrix(t),R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none",B=A.pitch<15?ZM(.07,.7,xe((14-A.zoom)/5,0,1)):.07;return{u_matrix:XM(a,t,i,u),u_pixels_to_tile_units:I,u_device_pixel_ratio:g,u_width_scale:x,u_floor_width_scale:b,u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:h,u_texsize:JM(i)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:KM(t,a.transform),u_alpha_discard_threshold:0,u_trim_offset:j,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:ve(t.tileID.canonical,0),u_ground_shadow_factor:T}},o.d0=Mp,o.d1=function(a,t,i){const u=Math.sqrt(a*a+t*t+i*i),h=u>0?Math.acos(i/u)*Xi:0;let g=a!==0||t!==0?Math.atan2(-t,-a)*Xi+90:0;return g<0&&(g+=360),[u,g,h]},o.d2=wt,o.d3=$r,o.d4=ve,o.d5=Vt,o.d6=qs,o.d7=Bt,o.d8=function(a){return[Math.pow(a[0],1/2.2),Math.pow(a[1],1/2.2),Math.pow(a[2],1/2.2)]},o.d9=rT,o.dA=N1,o.dB=function(a){const t=ye-5;a=xe(a,-t,t)/t*90;const i=Math.pow(Math.abs(Math.sin(Ks(a))),3);return Math.round(i*(f.length-1))},o.dC=function(a,t,i,u){const h=t.getNorth(),g=t.getSouth(),x=t.getWest(),b=t.getEast(),j=1<<a.z,T=b-x,A=h-g,I=T/c,R=-A/f[i],B=[0,I,0,R,0,0,h,x,0];if(a.z>0){const V=180/u;$(B,B,[V/T+1,0,0,0,V/A+1,0,-.5*V/I,.5*V/R,1])}return B[2]=j,B[5]=a.x,B[8]=a.y,B},o.dD=Oc,o.dE=function(a,t,i){const u=H(new Float64Array(16)),h=(t/(1<<a)-.5)*Math.PI*2;return ae(u,i.globeMatrix,h),Float32Array.from(u)},o.dF=class{isDataAvailableAtPoint(a){const t=this._source();if(this.isUsingMockSource()||!t||a.y<0||a.y>1)return!1;const i=t.getSource().maxzoom,u=1<<i,h=Math.floor(a.x),g=Math.floor((a.x-h)*u),x=Math.floor(a.y*u),b=this.findDEMTileFor(new Wr(i,h,i,g,x));return!(!b||!b.dem)}getAtPointOrZero(a,t=0){return this.getAtPoint(a,t)||0}getAtPoint(a,t,i=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const u=this._source();if(!u||a.y<0||a.y>1)return t;const h=u.getSource().maxzoom,g=1<<h,x=Math.floor(a.x),b=a.x-x,j=new Wr(h,x,h,Math.floor(b*g),Math.floor(a.y*g)),T=this.findDEMTileFor(j);if(!T||!T.dem)return t;const A=T.dem,I=1<<T.tileID.canonical.z,R=(b*I-T.tileID.canonical.x)*A.dim,B=(a.y*I-T.tileID.canonical.y)*A.dim,V=Math.floor(R),K=Math.floor(B);return(i?this.exaggeration():1)*fs(fs(A.get(V,K),A.get(V,K+1),B-K),fs(A.get(V+1,K),A.get(V+1,K+1),B-K),R-V)}getAtTileOffset(a,t,i){const u=1<<a.canonical.z;return this.getAtPointOrZero(new be(a.wrap+(a.canonical.x+t/Rt)/u,(a.canonical.y+i/Rt)/u))}getAtTileOffsetFunc(a,t,i,u){return h=>{const g=this.getAtTileOffset(a,h.x,h.y),x=u.upVector(a.canonical,h.x,h.y);return nt(x,x,g*u.upVectorScale(a.canonical,t,i).metersToTile),x}}getForTilePoints(a,t,i,u){if(this.isUsingMockSource())return!1;const h=Ym.create(this,a,u);return!!h&&(t.forEach(g=>{g[2]=this.exaggeration()*h.getElevationAt(g[0],g[1],i)}),!0)}getMinMaxForTile(a){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(a);if(!t||!t.dem)return null;const i=t.dem.tree,u=t.tileID,h=1<<a.canonical.z-u.canonical.z;let g=a.canonical.x/h-u.canonical.x,x=a.canonical.y/h-u.canonical.y,b=0;for(let j=0;j<a.canonical.z-u.canonical.z&&!i.leaves[b];j++){g*=2,x*=2;const T=2*Math.floor(x)+Math.floor(g);b=i.childOffsets[b]+T,g%=1,x%=1}return{min:this.exaggeration()*i.minimums[b],max:this.exaggeration()*i.maximums[b]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(a,t,i){throw new Error("Pure virtual method called.")}pointCoordinate(a){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(a){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const a=this.visibleDemTiles;if(a.length===0)return null;let t=!1,i=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const h of a){const g=this.getMinMaxForTile(h.tileID);g&&(i=Math.min(i,g.min),u=Math.max(u,g.max),t=!0)}return t?{min:i,max:u}:null}},o.dG=AI,o.dH=T1,o.dI=function(a,t){return[Math.pow(a[0],2.2)*t,Math.pow(a[1],2.2)*t,Math.pow(a[2],2.2)*t]},o.dJ=L,o.dK=function(a,t){var i=Math.sin(t),u=Math.cos(t);return a[0]=u,a[1]=i,a[2]=0,a[3]=-i,a[4]=u,a[5]=0,a[6]=0,a[7]=0,a[8]=1,a},o.dL=tn,o.dM=mI,o.dN=To,o.dO=Yi,o.dP=256,o.dQ=function(a,t){const i=[0,0,0];return ws(i,i,C1(Oc(t.canonical))),ws(i,i,a),i},o.dR=a=>({u_matrix:new Rp(a),u_texsize:new xl(a),u_pixels_to_tile_units:new Gy(a),u_device_pixel_ratio:new zr(a),u_width_scale:new zr(a),u_floor_width_scale:new zr(a),u_image:new Om(a),u_units_to_pixels:new xl(a),u_tile_units_to_pixels:new zr(a),u_alpha_discard_threshold:new zr(a),u_trim_offset:new xl(a),u_trim_fade_range:new xl(a),u_trim_color:new Mp(a),u_emissive_strength:new zr(a),u_zbias_factor:new zr(a),u_tile_to_meter:new zr(a),u_ground_shadow_factor:new Bd(a),u_pattern_transition:new zr(a)}),o.dS=a=>({u_matrix:new Rp(a),u_pixels_to_tile_units:new Gy(a),u_device_pixel_ratio:new zr(a),u_width_scale:new zr(a),u_floor_width_scale:new zr(a),u_units_to_pixels:new xl(a),u_dash_image:new Om(a),u_gradient_image:new Om(a),u_image_height:new zr(a),u_texsize:new xl(a),u_tile_units_to_pixels:new zr(a),u_alpha_discard_threshold:new zr(a),u_trim_offset:new xl(a),u_trim_fade_range:new xl(a),u_trim_color:new Mp(a),u_emissive_strength:new zr(a),u_zbias_factor:new zr(a),u_tile_to_meter:new zr(a),u_ground_shadow_factor:new Bd(a)}),o.dT=a=>({u_camera_to_center_distance:new zr(a),u_extrude_scale:new Gy(a),u_device_pixel_ratio:new zr(a),u_matrix:new Rp(a),u_inv_rot_matrix:new Rp(a),u_merc_center:new xl(a),u_tile_id:new Bd(a),u_zoom_transition:new zr(a),u_up_dir:new Bd(a),u_emissive_strength:new zr(a)}),o.dU=Ld,o.dV=C7,o.dW=_I,o.dX=(a,t,i,u,h,g)=>{const x=a.transform,b=x.projection.name==="globe";let j;if(g.paint.get("circle-pitch-alignment")==="map")if(b){const A=mI(x.zoom,t.canonical)*x._pixelsPerMercatorPixel;j=Float32Array.from([A,0,0,A])}else j=x.calculatePixelsToTileUnitsMatrix(i);else j=new Float32Array([x.pixelsToGLUnits[0],0,0,x.pixelsToGLUnits[1]]);const T={u_camera_to_center_distance:a.transform.getCameraToCenterDistance(x.projection),u_matrix:a.translatePosMatrix(t.projMatrix,i,g.paint.get("circle-translate"),g.paint.get("circle-translate-anchor")),u_device_pixel_ratio:$a.devicePixelRatio,u_extrude_scale:j,u_inv_rot_matrix:J$,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:g.paint.get("circle-emissive-strength")};if(b){T.u_inv_rot_matrix=u,T.u_merc_center=h,T.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],T.u_zoom_transition=Gd(x.zoom);const A=h[0]*Rt,I=h[1]*Rt;T.u_up_dir=x.projection.upVector(new la(0,0,0),A,I)}return T},o.dY=YM,o.dZ=Eo,o.d_=(a,t,i,u,h,g,x,b,j,T)=>{const A=a.transform,I=A.pitch<15?ZM(.07,.7,xe((14-A.zoom)/5,0,1)):.07,R=i.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:XM(a,t,i,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:A.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:h,u_width_scale:g,u_floor_width_scale:x,u_image:0,u_tile_units_to_pixels:KM(t,A),u_units_to_pixels:[1/A.pixelsToGLUnits[0],1/A.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:b,u_trim_fade_range:i.paint.get("line-trim-fade-range"),u_trim_color:i.paint.get("line-trim-color").toPremultipliedRenderColor(R?null:i.lut).toArray01(),u_emissive_strength:i.paint.get("line-emissive-strength"),u_zbias_factor:I,u_tile_to_meter:ve(t.tileID.canonical,0),u_ground_shadow_factor:j,u_pattern_transition:T}},o.da=function(a,t){return a.readFields(SH,{icons:[]},t)},o.db=O1,o.dc=Zm,o.dd=qj,o.de=Vf,o.df=n1,o.dg=Sa,o.dh=dd,o.di=Hs,o.dj=function(a){const t=a.indexOf(Np);return t>=0?a.slice(0,t):a},o.dk=function(a){return a.indexOf(Np)>=0},o.dl=function(a){const t=a.lastIndexOf(Np);return t>=0?a.slice(t+1):""},o.dm=function(a){const t=[],i=a.id;return i===void 0&&t.push({message:`layers.${i}: missing required property "id"`}),a.render===void 0&&t.push({message:`layers.${i}: missing required method "render"`}),a.renderingMode&&a.renderingMode!=="2d"&&a.renderingMode!=="3d"&&t.push({message:`layers.${i}: property "renderingMode" must be either "2d" or "3d"`}),t},o.dn=function(a,t,i,u){return a.type==="custom"?new xH(a,t):new bH[a.type](a,t,i,u)},o.dp=sn,o.dq=function(a){const t=a.indexOf(Np);return t>=0?a.slice(t+1):""},o.dr=class extends tg{constructor(a,t){super(a._vectorTileFeature,a._z,a._x,a._y,a.id),a.state&&(this.state=Object.assign({},a.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=a.source,this.sourceLayer=a.sourceLayer,this.layer=a.layer)}toJSON(){const a=super.toJSON();return a.target=this.target,a.namespace=this.namespace,a}},o.ds=by,o.dt=cd,o.du=function(a){return a({pluginStatus:fo,pluginURL:Mc}),by.on("pluginStateChange",a),a},o.dv=$y,o.dw=class extends Ca{constructor(a){super(a),this.current=QS}set(a,t,i){if(this.fetchUniformLocation(a,t)){for(let u=0;u<9;u++)if(i[u]!==this.current[u]){this.current=i,this.gl.uniformMatrix3fv(this.location,!1,i);break}}}},o.dx=ie,o.dy=function(a,t,i){const u=Gd(i.zoom),h=a.style.map._antialias,g=a.terrain&&a.terrain.exaggeration()>0;return u===0&&!h&&!g},o.dz=function(a){const t=a.pixelsPerMeter,i=t/te(1,a.center.lat),u=H(new Float64Array(16));return W(u,u,[a.point.x,a.point.y,0]),q(u,u,[i,i,t]),Float32Array.from(u)},o.e=Ii,o.e$=wy,o.e0=hs,o.e1=qy,o.e2=pe,o.e3=Mu,o.e4=L1,o.e5=cM,o.e6=Wd,o.e7=450,o.e8=7,o.e9=Te,o.eA=function(a,t,i,u,h,g,x,b,j,T,A,I,R,B,V,K){var Q=new P(16);return Q[0]=a,Q[1]=t,Q[2]=i,Q[3]=u,Q[4]=h,Q[5]=g,Q[6]=x,Q[7]=b,Q[8]=j,Q[9]=T,Q[10]=A,Q[11]=I,Q[12]=R,Q[13]=B,Q[14]=V,Q[15]=K,Q},o.eB=C,o.eC=ky,o.eD=Cp,o.eE=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new et(1/0,1/0),max:new et(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(a,t=!1){const i=KI(new et(0,0),new et(Rt,Rt),a),u=[];if(t&&!xj(i,this._globalClipBounds))return u;for(const h of this._activeRegions){if(h.hiddenByOverlap||!xj(i,h))continue;const g=NG(h.min,h.max,a);u.push({min:g.min,max:g.max,sourceId:this._sourceIds[h.priority],footprint:h.footprint,footprintTileId:h.tileId,order:h.order,clipMask:h.clipMask,clipScope:h.clipScope})}return u}setSources(a){this._setSources(a.map(t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const i=[];for(const u of t.cache.getVisibleCoordinates()){const h=t.cache.getTile(u).buckets[t.layer];h&&h.updateFootprints(u.toUnwrapped(),i)}return i},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope})))}_addSource(a){const t=a.getFootprints();if(t.length===0)return;const i=a.getOrder(),u=a.getClipMask(),h=a.getClipScope();for(const g of t){if(!g.footprint)continue;const x=KI(g.footprint.min,g.footprint.max,g.id);this._activeRegions.push({min:x.min,max:x.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:g.id,footprint:g.footprint,order:i,clipMask:u,clipScope:h})}this._sourceIds.push(a.getSourceId())}_computeReplacement(){this._activeRegions.sort((t,i)=>t.priority-i.priority||R1(t.min,i.min)||R1(t.max,i.max)||t.order-i.order||t.clipMask-i.clipMask||function(u,h){const g=(x,b)=>x+b;return u.length-h.length||u.reduce(g,"").localeCompare(h.reduce(g,""))}(t.clipScope,i.clipScope));let a=this._activeRegions.length!==this._prevRegions.length;if(!a){let t=0;for(;!a&&t!==this._activeRegions.length;){const i=this._activeRegions[t],u=this._prevRegions[t];a=i.priority!==u.priority||!ZI(i,u)||i.order!==u.order||i.clipMask!==u.clipMask||!er(i.clipScope,u.clipScope),++t}}if(a){++this._updateTime;for(const i of this._activeRegions)i.order!==Qy&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,i.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,i.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,i.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,i.max.y));const t=i=>{const u=this._activeRegions;if(i>=u.length)return i;const h=u[i].priority;for(;i<u.length&&u[i].priority===h;)++i;return i};if(this._sourceIds.length>1){let i=0,u=t(i);for(;i!==u;){let h=i;const g=i;for(;h!==u;){const x=this._activeRegions[h];x.hiddenByOverlap=!1;for(let b=0;b<g;b++){const j=this._activeRegions[b];if(!j.hiddenByOverlap&&x.order===Qy&&xj(x,j)&&(x.hiddenByOverlap=XI(x.footprint,x.tileId,j.footprint,j.tileId),x.hiddenByOverlap))break}++h}i=u,u=t(i)}}}}_setSources(a){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=a.length-1;t>=0;t--)this._addSource(a[t]);this._computeReplacement()}},o.eF=Qy,o.eG=class{constructor(a){this._createGrid(a),this._createPoles(a)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const a of this._poleSegments)a.destroy();for(const a of this._gridSegments)a.withSkirts.destroy(),a.withoutSkirts.destroy()}_fillGridMeshWithLods(a,t){const i=new Po,u=new ur,h=[],g=a+1+2,x=t[0]+1,b=t[0]+1+(1+t.length),j=(T,A,I)=>{let R=T===g-1?T-2:T===0?T:T-1;return R+=I?24575:0,[R,A]};for(let T=0;T<g;++T)i.emplaceBack(...j(T,0,!0));for(let T=0;T<x;++T)for(let A=0;A<g;++A)i.emplaceBack(...j(A,T,(A===0||A===g-1)&&!0));for(let T=0;T<t.length;++T){const A=t[T];for(let I=0;I<g;++I)i.emplaceBack(...j(I,A,!0))}for(let T=0;T<t.length;++T){const A=u.length,I=t[T]+1+2,R=new ur;for(let K=0;K<I-1;K++){const Q=K===I-2,re=Q?g*(b-t.length+T-K):g;for(let ue=0;ue<g-1;ue++){const ce=K*g+ue;K===0||Q||ue===0||ue===g-2?(R.emplaceBack(ce+1,ce,ce+re),R.emplaceBack(ce+re,ce+re+1,ce+1)):(u.emplaceBack(ce+1,ce,ce+re),u.emplaceBack(ce+re,ce+re+1,ce+1))}}const B=mr.simpleSegment(0,A,i.length,u.length-A);for(let K=0;K<R.uint16.length;K+=3)u.emplaceBack(R.uint16[K],R.uint16[K+1],R.uint16[K+2]);const V=mr.simpleSegment(0,A,i.length,u.length-A);h.push({withoutSkirts:B,withSkirts:V})}return{vertices:i,indices:u,segments:h}}_createGrid(a){const t=this._fillGridMeshWithLods(c,f);this._gridSegments=t.segments,this._gridBuffer=a.createVertexBuffer(t.vertices,uI.members),this._gridIndexBuffer=a.createIndexBuffer(t.indices,!0)}_createPoles(a){const t=new ur;for(let x=0;x<=c;x++)t.emplaceBack(0,x+1,x+2);this._poleIndexBuffer=a.createIndexBuffer(t,!0);const i=new Pu,u=new Pu,h=new Pu,g=new Pu;this._poleSegments=[];for(let x=0,b=0;x<S1;x++){const j=360/(1<<x);i.emplaceBack(0,-to,0,.5,0),u.emplaceBack(0,-to,0,.5,1),h.emplaceBack(0,-to,0,.5,.5),g.emplaceBack(0,-to,0,.5,.5);for(let T=0;T<=c;T++){let A=T/c,I=0;const R=fs(0,j,A),[B,V,K]=S(X$,Y$,R,to);i.emplaceBack(B,V,K,A,I),u.emplaceBack(B,V,K,A,1-I);const Q=Ks(R);A=.5+.5*Math.sin(Q),I=.5+.5*Math.cos(Q),h.emplaceBack(B,V,K,A,I),g.emplaceBack(B,V,K,A,1-I)}this._poleSegments.push(mr.simpleSegment(b,0,66,64)),b+=66}this._poleNorthVertexBuffer=a.createVertexBuffer(i,j1,!1),this._poleSouthVertexBuffer=a.createVertexBuffer(u,j1,!1),this._texturedPoleNorthVertexBuffer=a.createVertexBuffer(h,j1,!1),this._texturedPoleSouthVertexBuffer=a.createVertexBuffer(g,j1,!1)}getGridBuffers(a,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[a].withSkirts:this._gridSegments[a].withoutSkirts]}getPoleBuffers(a,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[a]]}},o.eH=WI,o.eI=fe,o.eJ=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},o.eK=Ce,o.eL=_e,o.eM=function(a,t,i){return a[0]=t[0]/i[0],a[1]=t[1]/i[1],a[2]=t[2]/i[2],a},o.eN=Js,o.eO=N,o.eP=Ps,o.eQ=rs,o.eR=function([a,t,i]){const u=Math.hypot(a,t,i),h=Math.atan2(a,i),g=.5*Math.PI-Math.acos(-t/u);return new D(Be(h),Be(g))},o.eS=lo,o.eT=Mj,o.eU=function(a){const t=a.navigator?a.navigator.userAgent:null;return!!function(i){if(Nr==null){const u=i.navigator?i.navigator.userAgent:null;Nr=!!i.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return Nr}(a)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},o.eV=function(a,t){Ga=a,Ll=t},o.eW=lj,o.eX=xI,o.eY=function(a){const t=[0,0,0],i=H(new Float64Array(16));return Z(i,a.pixelMatrix,a.globeMatrix),ws(t,t,i),new et(t[0],t[1])},o.eZ=function(){const a=i_;a&&(a.isPreloaded()&&a.numActive()===1?(a.release(jj),i_=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},o.e_=function(){O1().acquire(jj)},o.ea=function(a,t){if(a===t){var i=t[1],u=t[2],h=t[3],g=t[6],x=t[7],b=t[11];a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=i,a[6]=t[9],a[7]=t[13],a[8]=u,a[9]=g,a[11]=t[14],a[12]=h,a[13]=x,a[14]=b}else a[0]=t[0],a[1]=t[4],a[2]=t[8],a[3]=t[12],a[4]=t[1],a[5]=t[5],a[6]=t[9],a[7]=t[13],a[8]=t[2],a[9]=t[6],a[10]=t[10],a[11]=t[14],a[12]=t[3],a[13]=t[7],a[14]=t[11],a[15]=t[15];return a},o.eb=gH,o.ec=ln,o.ed=zy,o.ee=256,o.ef=oj,o.eg=na,o.eh=ae,o.ei=function(a,t){return a[0]=t[0],a[1]=t[1],a[2]=t[2],a[3]=t[4],a[4]=t[5],a[5]=t[6],a[6]=t[8],a[7]=t[9],a[8]=t[10],a},o.ej=Pu,o.ek=Ry,o.el=qv,o.em=function(a,t,i,u,h){return xe((a-t)/(i-t)*(h-u)+u,u,h)},o.en=hc,o.eo=function(a,t){var i=t[0],u=t[1],h=t[2],g=t[3],x=t[4],b=t[5],j=t[6],T=t[7],A=t[8],I=A*x-b*T,R=-A*g+b*j,B=T*g-x*j,V=i*I+u*R+h*B;return V?(a[0]=I*(V=1/V),a[1]=(-A*u+h*T)*V,a[2]=(b*u-h*x)*V,a[3]=R*V,a[4]=(A*i-h*j)*V,a[5]=(-b*i+h*g)*V,a[6]=B*V,a[7]=(-T*i+u*j)*V,a[8]=(x*i-u*g)*V,a):null},o.ep=2,o.eq=xn,o.er=Rj,o.es=[1,1,1],o.et=class{constructor(a,t,i,u){this.context=a,this.format=u,this.size=i,this.texture=a.gl.createTexture();const[h,g,x]=this.size,{gl:b}=a;b.bindTexture(b.TEXTURE_3D,this.texture),a.pixelStoreUnpackFlipY.set(!1),a.pixelStoreUnpack.set(1),a.pixelStoreUnpackPremultiplyAlpha.set(!1),b.texImage3D(b.TEXTURE_3D,0,this.format,h,g,x,0,Aj(this.format),Pj(this.format),t.data)}bind(a,t){const{context:i}=this,{gl:u}=i;u.bindTexture(u.TEXTURE_3D,this.texture),a!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,a),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,a),this.minFilter=a),t!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:a}=this.context;a.deleteTexture(this.texture),this.texture=null}},o.eu=Ym,o.ev=Jo,o.ew=function(a,t,i,u){var h=t[0],g=t[1],x=t[2],b=t[3];return a[0]=h+u*(i[0]-h),a[1]=g+u*(i[1]-g),a[2]=x+u*(i[2]-x),a[3]=b+u*(i[3]-b),a},o.ex=Hm,o.ey=gl,o.ez=Lc,o.f=function(a){return btoa(encodeURIComponent(a).replace(/%([0-9A-F]{2})/g,(t,i)=>String.fromCharCode(+("0x"+i))))},o.f0=function(a,t,i=!1){if(fo===zo.deferred||fo===zo.loading||fo===zo.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Mc=$a.resolveURL(a),fo=zo.deferred,_y=t,vy(),i||r1()},o.f1=function(a){Um=$a.resolveURL(a),$m||($m=new Vm(O1(),new xu)),$m.broadcast("setMeshoptUrl",Um)},o.f2=wM,o.f3=function(a){Nj=$a.resolveURL(a),$m||($m=new Vm(O1(),new xu)),$m.broadcast("setDracoUrl",Nj)},o.f4=bM,o.f5=r_,o.f6=function(a){const t=pu();if(!t)return;const i=t.delete(Dl);a&&i.then(()=>a()).catch(a)},o.f7=Op,o.f8=Yt,o.f9=Hd,o.fa=$l,o.fb=Hk,o.fc=Wk,o.fd=GM,o.fe=Wt,o.ff="hd_road_elevation",o.fg=gr,o.fh=Is,o.fi=Lp,o.fj=Wj,o.fk=Vp,o.fl=function(a,t,i,u,h,g,x,b=1,j,T,A){a.createArrays(),a.tilePixelRatio=Rt/(512*a.overscaling),a.compareText={},a.iconsNeedLinear=!1;const I=a.layers[0].layout,R=a.layers[0]._unevaluatedLayout._values,B={};B.scaleFactor=b,B.textSizeScaleRange=I.get("text-size-scale-range"),B.iconSizeScaleRange=I.get("icon-size-scale-range");const[V,K]=B.textSizeScaleRange,[Q,re]=B.iconSizeScaleRange;B.textScaleFactor=xe(B.scaleFactor,V,K),B.iconScaleFactor=xe(B.scaleFactor,Q,re);const ue=R["text-size"],ce=R["icon-size"];if(a.textSizeData.kind==="composite"){const{minZoom:ke,maxZoom:Qe}=a.textSizeData;B.compositeTextSizes=[ue.possiblyEvaluate(new Mn(ke,{worldview:A}),g),ue.possiblyEvaluate(new Mn(Qe,{worldview:A}),g)]}if(a.iconSizeData.kind==="composite"){const{minZoom:ke,maxZoom:Qe}=a.iconSizeData;B.compositeIconSizes=[ce.possiblyEvaluate(new Mn(ke,{worldview:A}),g),ce.possiblyEvaluate(new Mn(Qe,{worldview:A}),g)]}B.layoutTextSize=ue.possiblyEvaluate(new Mn(x+1,{worldview:A}),g),B.layoutIconSize=ce.possiblyEvaluate(new Mn(x+1,{worldview:A}),g),B.textMaxSize=ue.possiblyEvaluate(new Mn(18,{worldview:A}),g);const he=I.get("symbol-placement"),Ee=I.get("text-rotation-alignment")==="map"&&he!=="point",we=I.get("text-size");let je=!1;const Me=[];for(const ke of a.features){const Qe=I.get("text-font").evaluate(ke,{},g).join(","),Fe=we.evaluate(ke,{},g)*B.textScaleFactor,st=B.layoutTextSize.evaluate(ke,{},g)*B.textScaleFactor,Tt=B.layoutIconSize.evaluate(ke,{},g)*B.iconScaleFactor,lt={horizontal:{},vertical:void 0},gt=ke.text;let St,Ye=[0,0];if(gt){const Zt=gt.toString(),xs=I.get("text-letter-spacing").evaluate(ke,{},g)*wi,As=I.get("text-line-height").evaluate(ke,{},g)*wi,zs=US(Zt)?xs:0,ks=I.get("text-anchor").evaluate(ke,{},g),on=I.get("text-variable-anchor");if(!on){const Ze=I.get("text-radial-offset").evaluate(ke,{},g);if(Ze)Ye=AR(ks,[Ze*wi,Zj]);else{const At=I.get("text-offset").evaluate(ke,{},g);Ye=[At[0]*wi,At[1]*wi]}}let Gs=Ee?"center":I.get("text-justify").evaluate(ke,{},g);const nr=he==="point",me=nr?I.get("text-max-width").evaluate(ke,{},g)*wi:1/0,ge=Ze=>{a.allowVerticalPlacement&&yy(Zt)&&(lt.vertical=$j(gt,t,i,h,Qe,me,As,ks,Ze,zs,Ye,da.vertical,!0,st,Fe,j))};if(!Ee&&on){const Ze=Gs==="auto"?on.map(Ft=>Kj(Ft)):[Gs];let At=!1;for(let Ft=0;Ft<Ze.length;Ft++){const zt=Ze[Ft];if(!lt.horizontal[zt])if(At)lt.horizontal[zt]=lt.horizontal[0];else{const es=$j(gt,t,i,h,Qe,me,As,"center",zt,zs,Ye,da.horizontal,!1,st,Fe,j);es&&(lt.horizontal[zt]=es,At=es.positionedLines.length===1)}}ge("left")}else{if(Gs==="auto"&&(Gs=Kj(ks)),nr||I.get("text-writing-mode").indexOf("horizontal")>=0||!yy(Zt)){const Ze=$j(gt,t,i,h,Qe,me,As,ks,Gs,zs,Ye,da.horizontal,!1,st,Fe,j);Ze&&(lt.horizontal[Gs]=Ze)}ge(nr?"left":Gs)}}let _t,Ve,Je,Ct,vt,os,Jt=!1;const ft=I.get("icon-text-fit").evaluate(ke,{},g);if(ke.icon&&ke.icon.hasPrimary()){const Zt=IR(ke.icon,a.iconSizeData,R["icon-size"],g,a.zoom,ke,j,B.iconScaleFactor,A);_t=Zt.iconPrimary,Je=Zt.iconSecondary;const xs=_t.toString();if(Ve=u.get(xs),Ve&&(vt=I.get("icon-offset").evaluate(ke,{},g),os=I.get("icon-anchor").evaluate(ke,{},g),St=W7(h.get(xs),Je?h.get(Je.toString()):void 0,vt,os),Jt=Ve.sdf,a.sdfIcons===void 0?a.sdfIcons=Ve.sdf:a.sdfIcons!==Ve.sdf&&rn("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(Ve.pixelRatio!==a.pixelRatio||I.get("icon-rotate").constantOr(1)!==0)&&(a.iconsNeedLinear=!0)),Je){const As=Je.toString();Ct=u.get(As)}}je=je||!(!ke.icon||!ke.icon.hasSecondary());const bt=Xj(lt.horizontal)||lt.vertical;a.iconsInText||(a.iconsInText=!!bt&&bt.iconsInText);const ts=st*B.textScaleFactor/wi,{defaultShapedIcon:qt,verticallyShapedIcon:kt}=sH(a,St,I,ke,g,lt,ts,vt,ft);ft!=="none"&&St&&(pR(St)||fR(St))&&(X1(0,Ve,_t,St,qt,ft,T,u,h),X1(0,Ct,Je,St,qt,ft,T,u,h),kt&&(X1(0,Ve,_t,St,kt,ft,T,u,h),X1(0,Ct,Je,St,kt,ft,T,u,h))),St=qt,Me.push({feature:ke,shapedTextOrientations:lt,shapedText:bt,shapedIcon:St,iconPrimary:_t,iconSecondary:Je,iconOffset:vt,iconAnchor:os,verticallyShapedIcon:kt,layoutTextSize:st,layoutIconSize:Tt,textOffset:Ye,isSDFIcon:Jt,iconTextFit:ft})}return{featureData:Me,sizes:B,hasAnySecondaryIcon:je,textAlongLine:Ee,symbolPlacement:he}},o.fm=SR,o.fn=function(a,t,i,u,h,g,x,b,j,T){const{featureData:A,hasAnySecondaryIcon:I,sizes:R,textAlongLine:B,symbolPlacement:V}=t;for(const K of A){const{shapedIcon:Q,verticallyShapedIcon:re,feature:ue,shapedTextOrientations:ce,shapedText:he,layoutTextSize:Ee,textOffset:we,isSDFIcon:je,iconPrimary:Me,iconSecondary:ke,iconTextFit:Qe,iconOffset:Fe}=K;MR(Q,T.iconPositions,Me,ke),MR(re,T.iconPositions,Me,ke),tH(ce,T.iconPositions),eH(Me,ke,T.iconPositions),(he||Q)&&nH(a,ue,ce,Q,re,j,R,Ee,0,we,je,u,h,x,b,I,Qe,Fe,B,V)}i&&a.generateCollisionDebugBuffers(g,a.collisionBoxArray,R.textScaleFactor)},o.fo=ns,o.fp=gb,o.fq=Ge,o.fr=function(a){let t=0;if(new Uint32Array(a,0,1)[0]!==jM){const i=new Uint32Array(a,0,7),[,,u,h,g,x]=i;t=i.byteLength+h+g+x+g,(u!==a.byteLength||t>=a.byteLength)&&rn("Invalid b3dm header information.")}return CM(a,t)},o.fs=function(a,t){const i=LM(a);for(const u of i){for(const h of u.meshes)n7(h);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(r7(u.lights,t)))}return i},o.ft=ub,o.fu=Ln,o.fv=_M,o.fw=fl,o.fx=zo,o.fy=function(a){ad(),hl!=null&&hl.then(t=>{t.keys().then(i=>{for(let u=0;u<i.length-a;u++)t.delete(i[u]).catch(h=>rn(h.message))}).catch(i=>rn(i.message))}).catch(t=>rn(t.message))},o.g=function(a,t){return cd(He(a,{method:"GET"}),t)},o.h=He,o.i=function(a){return Ii.API_STYLE_REGEX.test(a)&&!zf(a)},o.j=function(a){return a.indexOf("mapbox:")===0},o.k=xc,o.l=Rx,o.m=function(a){return decodeURIComponent(atob(a).split("").map(t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2)).join(""))},o.n=function(a,t){return cd(He(a,{type:"json"}),t)},o.o=sp,o.p=function(a,t){return cd(He(a,{method:"POST"}),t)},o.q=$a,o.r=$i,o.s=function(a){try{const t=self[a];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},o.t=Bf,o.u=function(){return function a(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,a)}()},o.v=function(a){return!!a&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(a)},o.w=rn,o.x=function(){return Tj||(Tj=new Op),Tj},o.y=dT,o.z=ea}),_(["./shared"],function(o){function E(Be){const ne=Be?Be.url.toString():void 0;return ne?performance.getEntriesByName(ne):[]}function P(Be){if(typeof Be=="number"||typeof Be=="boolean"||typeof Be=="string"||Be==null)return JSON.stringify(Be);if(Array.isArray(Be)){let ie="[";for(const fe of Be)ie+=`${P(fe)},`;return`${ie}]`}let ne="{";for(const ie of Object.keys(Be).sort())ne+=`${ie}:${P(Be[ie])},`;return`${ne}}`}function M(Be){let ne="";for(const ie of o.bu)ne+=`/${P(Be[ie])}`;return ne}class L{constructor(ne){this.keyCache={},this._layers={},this._layerConfigs={},ne&&this.replace(ne)}replace(ne,ie){this._layerConfigs={},this._layers={},this.update(ne,[],ie)}update(ne,ie,fe){this._options=fe;for(const xe of ne)this._layerConfigs[xe.id]=xe,(this._layers[xe.id]=o.dn(xe,this.scope,null,this._options)).compileFilter(fe),this.keyCache[xe.id]&&delete this.keyCache[xe.id];for(const xe of ie)delete this.keyCache[xe],delete this._layerConfigs[xe],delete this._layers[xe];this.familiesBySource={};const Ce=function(xe,Re){const qe={};for(let He=0;He<xe.length;He++){const Et=xe[He];let ut=Re&&Re[Et.id];ut||(Et.type==="symbol"?ut=Et.id:(ut=M(Et),Et.type==="line"&&Et.paint&&function Ts(Is){return typeof Is=="string"&&Is==="line-progress"||(Array.isArray(Is)?Is.some(Ts):!(!Is||typeof Is!="object")&&Object.values(Is).some(Ts))}(Et.paint["line-width"])&&(ut+=`/${P(Et.paint["line-width"])}`))),Re&&(Re[Et.id]=ut);let hs=qe[ut];hs||(hs=qe[ut]=[]),hs.push(Et)}const De=[];for(const He in qe)De.push(qe[He]);return De}(Object.values(this._layerConfigs),this.keyCache);for(const xe of Ce){const Re=xe.map(hs=>this._layers[hs.id]),qe=Re[0];if(qe.visibility==="none")continue;const De=qe.source||"";let He=this.familiesBySource[De];He||(He=this.familiesBySource[De]={});const Et=qe.sourceLayer||"_geojsonTileLayer";let ut=He[Et];ut||(ut=He[Et]=[]),ut.push(Re)}}}const F=1*o.fa;class ${constructor(ne){const ie={},fe=[];for(const qe in ne){const De=ne[qe],He=ie[qe]={};for(const Et in De.glyphs){const ut=De.glyphs[+Et];if(!ut||ut.bitmap.width===0||ut.bitmap.height===0)continue;const hs=ut.metrics.localGlyph?F:1,Ts={x:0,y:0,w:ut.bitmap.width+2*hs,h:ut.bitmap.height+2*hs};fe.push(Ts),He[Et]=Ts}}const{w:Ce,h:xe}=o.H(fe),Re=new o.f9({width:Ce||1,height:xe||1});for(const qe in ne){const De=ne[qe];for(const He in De.glyphs){const Et=De.glyphs[+He];if(!Et||Et.bitmap.width===0||Et.bitmap.height===0)continue;const ut=ie[qe][He],hs=Et.metrics.localGlyph?F:1;o.f9.copy(Et.bitmap,Re,{x:0,y:0},{x:ut.x+hs,y:ut.y+hs},Et.bitmap)}}this.image=Re,this.positions=ie}}o.f8($,"GlyphAtlas");class Y{constructor(ne){this.tileID=new o.aM(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.lut=ne.lut,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.scope=ne.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=ne.showCollisionBoxes,this.collectResourceTiming=!!ne.request&&ne.request.collectResourceTiming,this.promoteId=ne.promoteId,this.isSymbolTile=ne.isSymbolTile,this.tileTransform=o.aW(ne.tileID.canonical,ne.projection),this.projection=ne.projection,this.worldview=ne.worldview,this.localizableLayerIds=ne.localizableLayerIds,this.brightness=ne.brightness,this.extraShadowCaster=!!ne.extraShadowCaster,this.tessellationStep=ne.tessellationStep,this.scaleFactor=ne.scaleFactor,this.worldview=ne.worldview}parse(ne,ie,fe,Ce,xe,Re){this.status="parsing",this.data=ne,this.collisionBoxArray=new o.b0;const qe=new o.fb(Object.keys(ne.layers).sort()),De=new o.fc(this.tileID,this.promoteId);De.bucketLayerIDs=[];const He={},Et=new o.fd(256,256),ut={featureIndex:De,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Et,availableImages:fe,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},hs=[],Ts=ie.familiesBySource[this.source];for(const sn in Ts){const Hs=ne.layers[sn];if(!Hs)continue;let nn=!1,Kn=!1,rn=!1;for(const Ln of Ts[sn])Ln[0].type==="symbol"?nn=!0:Kn=!0,Ln[0].is3D()&&Ln[0].type!=="model"&&(rn=!0);if(this.extraShadowCaster&&!rn||this.isSymbolTile===!0&&!nn||this.isSymbolTile===!1&&!Kn)continue;Hs.version===1&&o.w(`Vector tile source "${this.source}" layer "${sn}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const Ar=qe.encode(sn),Yr=[];let $r=!1;for(let Ln=0,bn=0;Ln<Hs.length;Ln++){const Nr=Hs.feature(Ln),vr=De.getId(Nr,sn);if(this.localizableLayerIds&&this.localizableLayerIds.has(sn)){const fr=Nr.properties?Nr.properties.worldview:null;if(this.worldview&&typeof fr=="string")if(fr==="all")Nr.properties.$localized=!0;else{if(!fr.split(",").includes(this.worldview))continue;Nr.properties.$localized=!0,Nr.properties.worldview=this.worldview}}!$r&&Nr.properties&&Nr.properties.hasOwnProperty(o.fe)&&($r=!0),Yr.push({feature:Nr,id:vr,index:bn,sourceLayerIndex:Ar}),bn++}$r&&!ut.elevationFeatures&&ne.layers.hasOwnProperty(o.ff)&&(ut.elevationFeatures=o.fg.parseFrom(ne.layers[o.ff],this.canonical));for(const Ln of Ts[sn]){const bn=Ln[0];if(this.extraShadowCaster&&(!bn.is3D()||bn.type==="model")||this.isSymbolTile!==void 0&&bn.type==="symbol"!==this.isSymbolTile||bn.minzoom&&this.zoom<Math.floor(bn.minzoom)||bn.maxzoom&&this.zoom>=bn.maxzoom||bn.visibility==="none")continue;H(Ln,this.zoom,ut.brightness,fe,this.worldview);const Nr=He[bn.id]=bn.createBucket({index:De.bucketLayerIDs.length,layers:Ln,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:Ar,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Ce,worldview:this.worldview});De.bucketLayerIDs.push(Ln.map(fr=>o.C(fr.id,fr.scope)));let vr=Nr.prepare?Nr.prepare():null;vr!=null?(vr=vr.then(()=>Nr.populate(Yr,ut,this.tileID.canonical,this.tileTransform)),hs.push(vr)):Nr.populate(Yr,ut,this.tileID.canonical,this.tileTransform)}}const Is=()=>{let sn,Hs,nn,Kn,rn,Ar;Et.trim();const Yr={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},$r=()=>{if(sn)return this.status="done",Re(sn);if(this.extraShadowCaster)this.status="done",Re(null,{buckets:Object.values(He).filter(bn=>!bn.isEmpty()),featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:ut.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(Hs&&nn&&Kn){const bn=new $(Hs),Nr=new Map;for(const[yi,To]of nn.entries()){const{imagePosition:Yi}=o.fj(yi,To,o.fk);Nr.set(yi,Yi)}const vr={};for(const yi in He){const To=He[yi];To instanceof o.b1&&(H(To.layers,this.zoom,ut.brightness,fe,this.worldview),vr[yi]=o.fl(To,Hs,bn.positions,nn,Nr,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,rn,this.worldview))}const fr={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(xe,nn,rn,()=>{fr.iconsPending=!1,Ln(vr,bn,fr)}),this.rasterizeIfNeeded(xe,Kn,Ar,()=>{fr.patternsPending=!1,Ln(vr,bn,fr)})}},Ln=(bn,Nr,vr,fr)=>{if(vr.iconsPending||vr.patternsPending)return;const yi=new o.fm(nn,Kn,this.lut);for(const To in He){const Yi=He[To];if(To in bn)o.fn(Yi,bn[To],this.showCollisionBoxes,fe,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,nn,yi);else if(Yi.hasPattern&&(Yi instanceof o.b7||Yi instanceof o.b8||Yi instanceof o.e4)){H(Yi.layers,this.zoom,ut.brightness,fe,this.worldview);const Wh=Object.fromEntries(yi.patternPositions);Yi.addFeatures(ut,this.tileID.canonical,Wh,fe,this.tileTransform,this.brightness)}}this.status="done",Re(null,{buckets:Object.values(He).filter(To=>!To.isEmpty()),featureIndex:De,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:Nr.image,lineAtlas:Et,imageAtlas:yi,brightness:ut.brightness})};if(!this.extraShadowCaster){const bn=o.fh(ut.glyphDependencies,fr=>Object.keys(fr).map(Number));Object.keys(bn).length?xe.send("getGlyphs",{uid:this.uid,stacks:bn},(fr,yi)=>{sn||(sn=fr,Hs=yi,$r())},void 0,!1,Yr):Hs={};const Nr=Array.from(ut.iconDependencies.keys()).map(fr=>o.I.parse(fr));Nr.length?xe.send("getImages",{images:Nr,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},(fr,yi)=>{sn||(sn=fr,nn=new Map,rn=this.updateImageMapAndGetImageTaskQueue(nn,yi,ut.iconDependencies),$r())},void 0,!1,Yr):(nn=new Map,rn=new Map);const vr=Array.from(ut.patternDependencies.keys()).map(fr=>o.I.parse(fr));vr.length?xe.send("getImages",{images:vr,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},(fr,yi)=>{sn||(sn=fr,Kn=new Map,Ar=this.updateImageMapAndGetImageTaskQueue(Kn,yi,ut.patternDependencies),$r())},void 0,!1,Yr):(Kn=new Map,Ar=new Map)}if(ut.elevationFeatures&&ut.elevationFeatures.length>0){const bn=[];for(const vr of Object.values(He))if(vr instanceof o.b8){const fr=vr.getUnevaluatedPortalGraph();fr&&bn.push(fr)}const Nr=o.fi.evaluate(bn);for(const vr of Object.values(He))if(vr instanceof o.b8){const fr=ne.layers[qe.decode(vr.sourceLayerIndex)];vr.setEvaluatedPortalGraph(Nr,fr,this.tileID.canonical,ut.availableImages,ut.brightness)}}$r()};hs.length>0?Promise.allSettled(hs).then(Is).catch(Re):Is()}rasterizeIfNeeded(ne,ie,fe,Ce){Array.from(ie.values()).some(xe=>xe.usvg)?this.rasterize(ne,ie,fe,Ce):Ce()}updateImageMapAndGetImageTaskQueue(ne,ie,fe){const Ce=new Map;for(const xe of ie.keys()){const Re=fe.get(xe)||[];for(const qe of Re){const De=qe.toString(),He=ie.get(qe.id.toString());He.usvg?Ce.has(De)||(Ce.set(De,qe),ne.set(De,Object.assign({},He))):ne.set(De,He)}}return Ce}rasterize(ne,ie,fe,Ce){this.rasterizeTask=ne.send("rasterizeImages",{scope:this.scope,tasks:fe},(xe,Re)=>{if(!xe)for(const[qe,De]of Re.entries()){const He=Object.assign(ie.get(qe),{data:De});ie.set(qe,He)}Ce()})}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function H(Be,ne,ie,fe,Ce){const xe=new o.aa(ne,{brightness:ie,worldview:Ce});for(const Re of Be)Re.recalculate(xe,fe)}class X extends o.E{constructor(ne,ie,fe,Ce,xe,Re,qe){super(),this.actor=ne,this.layerIndex=ie,this.availableImages=fe,this.availableModels=Ce,this.loadVectorData=Re||o.aJ,this.loading={},this.loaded={},this.deduped=new o.aI(ne.scheduler),this.isSpriteLoaded=xe,this.scheduler=ne.scheduler,this.brightness=qe}loadTile(ne,ie){const fe=ne.uid,Ce=ne&&ne.request,xe=Ce&&Ce.collectResourceTiming,Re=this.loading[fe]=new Y(ne);Re.abort=this.loadVectorData(ne,(qe,De)=>{const He=!this.loading[fe];if(delete this.loading[fe],Re.cancelRasterize(),He||qe||!De)return Re.status="done",He||(this.loaded[fe]=Re),ie(qe);const Et=De.rawData,ut={};De.expires&&(ut.expires=De.expires),De.cacheControl&&(ut.cacheControl=De.cacheControl),Re.vectorTile=De.vectorTile||new o.fo(new o.bq(Et));const hs=()=>{Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,(Ts,Is)=>{if(Ts||!Is)return ie(Ts);const sn={};if(xe){const Hs=E(Ce);Hs.length>0&&(sn.resourceTiming=JSON.parse(JSON.stringify(Hs)))}ie(null,o.h({rawTileData:Et.slice(0)},Is,ut,sn))})};this.isSpriteLoaded?hs():this.once("isSpriteLoaded",()=>{this.scheduler?this.scheduler.add(hs,{type:"parseTile",isSymbolTile:ne.isSymbolTile,zoom:ne.tileZoom}):hs()}),this.loaded=this.loaded||{},this.loaded[fe]=Re})}reloadTile(ne,ie){const fe=this.loaded,Ce=ne.uid;if(fe&&fe[Ce]){const xe=fe[Ce];xe.scaleFactor=ne.scaleFactor,xe.showCollisionBoxes=ne.showCollisionBoxes,xe.projection=ne.projection,xe.brightness=ne.brightness,xe.tileTransform=o.aW(ne.tileID.canonical,ne.projection),xe.extraShadowCaster=ne.extraShadowCaster,xe.lut=ne.lut,xe.worldview=ne.worldview;const Re=(qe,De)=>{const He=xe.reloadCallback;He&&(delete xe.reloadCallback,xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,He)),ie(qe,De)};xe.status==="parsing"?xe.reloadCallback=Re:xe.status==="done"&&(xe.vectorTile?xe.parse(xe.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Re):Re())}else ie(null,void 0)}abortTile(ne,ie){const fe=ne.uid,Ce=this.loading[fe];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[fe]),ie()}removeTile(ne,ie){const fe=this.loaded,Ce=ne.uid;fe&&fe[Ce]&&delete fe[Ce],ie()}}class Z{loadTile(ne,ie){const{uid:fe,encoding:Ce,rawImageData:xe,padding:Re}=ne,qe=ImageBitmap&&xe instanceof ImageBitmap?this.getImageData(xe,Re):xe;ie(null,new o.fp(fe,qe,Ce,Re<1))}reloadTile(ne,ie){ie(null,null)}abortTile(ne,ie){ie()}removeTile(ne,ie){ie()}getImageData(ne,ie){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(ne.width,ne.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=ne.width,this.offscreenCanvas.height=ne.height,this.offscreenCanvasContext.drawImage(ne,0,0,ne.width,ne.height);const fe=this.offscreenCanvasContext.getImageData(-ie,-ie,ne.width+2*ie,ne.height+2*ie);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),fe}}o.bp.setPbf(o.bq);class W{constructor(ne){this._mrt=new o.bp(ne.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=ne.uid,this.tileID=ne.tileID,this.source=ne.source}parse(ne,ie){const fe=this._mrt;this.status="parsing",this._entireBuffer=ne;try{fe.parseHeader(ne),this._isHeaderLoaded=!0;const Ce=[];for(const xe in fe.layers){const Re=fe.getLayer(xe),qe=Re.getDataRange(Re.getBandList()),De=fe.createDecodingTask(qe),He=ne.slice(qe.firstByte,qe.lastByte+1),Et=o.bp.performDecoding(He,De).then(ut=>De.complete(null,ut)).catch(ut=>De.complete(ut,null));Ce.push(Et)}Promise.allSettled(Ce).then(()=>ie(null,fe)).catch(xe=>ie(xe))}catch(Ce){ie(Ce)}}}class q{constructor(ne){this.actor=ne,this.loading={},this.loaded={}}loadTile(ne,ie){const fe=ne.uid,Ce=ne.request,xe=this.loading[fe]=new W(ne),{cancel:Re}=o.br(Ce,(qe,De,He,Et)=>{const ut=!this.loading[fe];if(delete this.loading[fe],ut||qe||!De)return xe.status="done",ut||(this.loaded[fe]=xe),ie(qe);xe.parse(De,(hs,Ts)=>{if(hs||!Ts)return ie(hs);ie(null,Ts,He,Et)}),this.loaded[fe]=xe});xe.abort=Re}reloadTile(ne,ie){ie(null,void 0)}abortTile(ne,ie){const fe=ne.uid,Ce=this.loading[fe];Ce&&(Ce.abort&&Ce.abort(),delete this.loading[fe]),ie()}removeTile(ne,ie){const fe=ne.uid;this.loaded[fe]&&delete this.loaded[fe],ie()}decodeRasterArray(ne,ie){o.bp.performDecoding(ne.buffer,ne.task).then(fe=>ie(null,fe)).catch(fe=>ie(fe))}}const oe=o.fq.prototype.toGeoJSON;class ae{constructor(ne){this._feature=ne,this.extent=o.aj,this.type=ne.type,this.properties=ne.tags,"id"in ne&&!isNaN(ne.id)&&(this.id=parseInt(ne.id,10))}loadGeometry(){if(this._feature.type===1){const ne=[];for(const ie of this._feature.geometry)ne.push([new o.P(ie[0],ie[1])]);return ne}{const ne=[];for(const ie of this._feature.geometry){const fe=[];for(const Ce of ie)fe.push(new o.P(Ce[0],Ce[1]));ne.push(fe)}return ne}}toGeoJSON(ne,ie,fe){return oe.call(this,ne,ie,fe)}}class Ne{constructor(ne,ie){this.name=ne,this.extent=o.aj,this.length=ie.length,this._jsonFeatures=ie}feature(ne){return new ae(this._jsonFeatures[ne])}}class Pe{constructor(ne){this.layers={},this.extent=o.aj;for(const ie of Object.keys(ne))this.layers[ie]=new Ne(ie,ne[ie])}}const Le=64/4096,ct=128;class xt{constructor(){this.features=new Map}clear(){this.features.clear()}load(ne=[],ie){for(const fe of ne){const Ce=fe.id;if(Ce==null)continue;let xe=this.features.get(Ce);xe&&this.updateCache(xe,ie),fe.geometry?(xe=Ht(fe),this.updateCache(xe,ie),this.features.set(Ce,xe)):this.features.delete(Ce),this.updateCache(xe,ie)}}updateCache(ne,ie){for(const{canonical:fe,uid:Ce}of Object.values(ie)){const{z:xe,x:Re,y:qe}=fe;yt(ne,Math.pow(2,xe),Re,qe)&&delete ie[Ce]}}getTile(ne,ie,fe){const Ce=Math.pow(2,ne),xe=[];for(const Re of this.features.values())yt(Re,Ce,ie,fe)&&xe.push(Vt(Re,Ce,ie,fe));return{features:xe}}getFeatures(){return[...this.features.values()]}}function yt({minX:Be,minY:ne,maxX:ie,maxY:fe},Ce,xe,Re){return Be<(xe+1+Le)/Ce&&ne<(Re+1+Le)/Ce&&ie>(xe-Le)/Ce&&fe>(Re-Le)/Ce}function Ht(Be){const{id:ne,geometry:ie,properties:fe}=Be;if(!ie)return;if(ie.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Ce,coordinates:xe}=ie,Re={id:ne,type:1,geometry:[],tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},qe=Re.geometry;if(Ce==="Point")Dt(xe,qe,Re);else if(Ce==="MultiPoint")for(const De of xe)Dt(De,qe,Re);else if(Ce==="LineString")Re.type=2,wt(xe,qe,Re);else if(Ce==="MultiLineString")Re.type=2,rs(xe,qe,Re);else if(Ce==="Polygon")Re.type=3,rs(xe,qe,Re,!0);else{if(Ce!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Re.type=3;for(const De of xe)rs(De,qe,Re,!0)}return Re}function Dt([Be,ne],ie,fe){const Ce=o.aD(Be);let xe=o.aH(ne);xe=xe<0?0:xe>1?1:xe,ie.push(Ce,xe),fe.minX=Math.min(fe.minX,Ce),fe.minY=Math.min(fe.minY,xe),fe.maxX=Math.max(fe.maxX,Ce),fe.maxY=Math.max(fe.maxY,xe)}function wt(Be,ne,ie,fe=!1,Ce=!1){const xe=[];for(const Re of Be)Dt(Re,xe,ie);ne.push(xe),fe&&function(Re,qe){let De=0;for(let He=0,Et=Re.length,ut=Et-2;He<Et;ut=He,He+=2)De+=(Re[He]-Re[ut])*(Re[He+1]+Re[ut+1]);if(De>0===qe)for(let He=0,Et=Re.length;He<Et/2;He+=2){const ut=Re[He],hs=Re[He+1];Re[He]=Re[Et-2-He],Re[He+1]=Re[Et-1-He],Re[Et-2-He]=ut,Re[Et-1-He]=hs}}(xe,Ce)}function rs(Be,ne,ie,fe=!1){for(let Ce=0;Ce<Be.length;Ce++)wt(Be[Ce],ne,ie,fe,Ce===0)}function Vt(Be,ne,ie,fe){const{id:Ce,type:xe,geometry:Re,tags:qe}=Be,De=[];if(xe===1)(function(He,Et,ut,hs,Ts){for(let Is=0;Is<He.length;Is+=2){const sn=Math.round(o.aj*(He[Is+0]*Et-ut)),Hs=Math.round(o.aj*(He[Is+1]*Et-hs));Ts.push([sn,Hs])}})(Re,ne,ie,fe,De);else for(const He of Re)Bt(He,ne,ie,fe,De);return{id:Ce,type:xe,geometry:De,tags:qe}}function Bt(Be,ne,ie,fe,Ce){const xe=-ct,Re=o.aj+ct;let qe;for(let De=0;De<Be.length-2;De+=2){let He=Math.round(o.aj*(Be[De+0]*ne-ie)),Et=Math.round(o.aj*(Be[De+1]*ne-fe)),ut=Math.round(o.aj*(Be[De+2]*ne-ie)),hs=Math.round(o.aj*(Be[De+3]*ne-fe));const Ts=ut-He,Is=hs-Et;He<xe&&ut<xe||(He<xe?(Et+=Math.round(Is*((xe-He)/Ts)),He=xe):ut<xe&&(hs=Et+Math.round(Is*((xe-He)/Ts)),ut=xe),Et<xe&&hs<xe||(Et<xe?(He+=Math.round(Ts*((xe-Et)/Is)),Et=xe):hs<xe&&(ut=He+Math.round(Ts*((xe-Et)/Is)),hs=xe),He>=Re&&ut>=Re||(He>=Re?(Et+=Math.round(Is*((Re-He)/Ts)),He=Re):ut>=Re&&(hs=Et+Math.round(Is*((Re-He)/Ts)),ut=Re),Et>=Re&&hs>=Re||(Et>=Re?(He+=Math.round(Ts*((Re-Et)/Is)),Et=Re):hs>=Re&&(ut=He+Math.round(Ts*((Re-Et)/Is)),hs=Re),qe&&He===qe[qe.length-1][0]&&Et===qe[qe.length-1][1]||(qe=[[He,Et]],Ce.push(qe)),qe.push([ut,hs])))))}}function ze({name:Be,features:ne},ie){ie.writeStringField(1,Be),ie.writeVarintField(5,o.aj);const fe=new Map,Ce=new Map,xe={keys:fe,values:Ce,feature:null};for(const Re of ne)xe.feature=Re,ie.writeMessage(2,Xe,xe);for(const Re of fe.keys())ie.writeStringField(3,Re);for(const Re of Ce.keys())ie.writeMessage(4,Ps,Re)}function Xe(Be,ne){const ie=Be.feature;ie.id===void 0||isNaN(+ie.id)||ne.writeVarintField(1,+ie.id),ie.tags&&ne.writeMessage(2,Ot,Be),ne.writeVarintField(3,ie.type),ne.writeMessage(4,ss,ie)}function Ot({keys:Be,values:ne,feature:ie},fe){for(const Ce of Object.keys(ie.tags)){let xe=ie.tags[Ce];if(xe===null)continue;let Re=Be.get(Ce);Re===void 0&&(Re=Be.size,Be.set(Ce,Re)),fe.writeVarint(Re);const qe=typeof xe;qe!=="string"&&qe!=="boolean"&&qe!=="number"&&(xe=JSON.stringify(xe));let De=ne.get(xe);De===void 0&&(De=ne.size,ne.set(xe,De)),fe.writeVarint(De)}}function nt(Be,ne){return(ne<<3)+(7&Be)}function Mt(Be){return Be<<1^Be>>31}function ss(Be,ne){const{geometry:ie,type:fe}=Be;let Ce=0,xe=0;if(fe===1){ne.writeVarint(nt(1,ie.length));for(const Re of ie){const qe=Re[0]-Ce,De=Re[1]-xe;ne.writeVarint(Mt(qe)),ne.writeVarint(Mt(De)),Ce+=qe,xe+=De}}else for(const Re of ie){ne.writeVarint(nt(1,1));const qe=Re.length-(fe===3?1:0);for(let De=0;De<qe;De++){De===1&&ne.writeVarint(nt(2,qe-1));const He=Re[De][0]-Ce,Et=Re[De][1]-xe;ne.writeVarint(Mt(He)),ne.writeVarint(Mt(Et)),Ce+=He,xe+=Et}fe===3&&ne.writeVarint(nt(7,1))}}function Ps(Be,ne){const ie=typeof Be;ie==="string"?ne.writeStringField(1,Be):ie==="boolean"?ne.writeBooleanField(7,Be):ie==="number"&&(Be%1!=0?ne.writeDoubleField(3,Be):Be<0?ne.writeSVarintField(6,Be):ne.writeVarintField(5,Be))}const xn={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Be=>Be},Ms=Math.fround||(Xt=new Float32Array(1),Be=>(Xt[0]=+Be,Xt[0]));var Xt;const It=3,Ns=5,ws=6;class tn{constructor(ne){this.options=Object.assign(Object.create(xn),ne),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(ne){const{log:ie,minZoom:fe,maxZoom:Ce}=this.options;ie&&console.time("total time");const xe=`prepare ${ne.length} points`;ie&&console.time(xe),this.points=ne;const Re=[];for(let De=0;De<ne.length;De++){const He=ne[De];if(!He.geometry)continue;const[Et,ut]=He.geometry.coordinates,hs=Ms(cr(Et)),Ts=Ms(vn(ut));Re.push(hs,Ts,1/0,De,-1,1),this.options.reduce&&Re.push(0)}let qe=this.trees[Ce+1]=this._createTree(Re);ie&&console.timeEnd(xe);for(let De=Ce;De>=fe;De--){const He=+Date.now();qe=this.trees[De]=this._createTree(this._cluster(qe,De)),ie&&console.log("z%d: %d clusters in %dms",De,qe.numItems,+Date.now()-He)}return ie&&console.timeEnd("total time"),this}getClusters(ne,ie){let fe=((ne[0]+180)%360+360)%360-180;const Ce=Math.max(-90,Math.min(90,ne[1]));let xe=ne[2]===180?180:((ne[2]+180)%360+360)%360-180;const Re=Math.max(-90,Math.min(90,ne[3]));if(ne[2]-ne[0]>=360)fe=-180,xe=180;else if(fe>xe){const ut=this.getClusters([fe,Ce,180,Re],ie),hs=this.getClusters([-180,Ce,xe,Re],ie);return ut.concat(hs)}const qe=this.trees[this._limitZoom(ie)],De=qe.range(cr(fe),vn(Re),cr(xe),vn(Ce)),He=qe.data,Et=[];for(const ut of De){const hs=this.stride*ut;Et.push(He[hs+Ns]>1?cn(He,hs,this.clusterProps):this.points[He[hs+It]])}return Et}getChildren(ne){const ie=this._getOriginId(ne),fe=this._getOriginZoom(ne),Ce="No cluster with the specified id.",xe=this.trees[fe];if(!xe)throw new Error(Ce);const Re=xe.data;if(ie*this.stride>=Re.length)throw new Error(Ce);const qe=this.options.radius/(this.options.extent*Math.pow(2,fe-1)),De=xe.within(Re[ie*this.stride],Re[ie*this.stride+1],qe),He=[];for(const Et of De){const ut=Et*this.stride;Re[ut+4]===ne&&He.push(Re[ut+Ns]>1?cn(Re,ut,this.clusterProps):this.points[Re[ut+It]])}if(He.length===0)throw new Error(Ce);return He}getLeaves(ne,ie,fe){const Ce=[];return this._appendLeaves(Ce,ne,ie=ie||10,fe=fe||0,0),Ce}getTile(ne,ie,fe){const Ce=this.trees[this._limitZoom(ne)],xe=Math.pow(2,ne),{extent:Re,radius:qe}=this.options,De=qe/Re,He=(fe-De)/xe,Et=(fe+1+De)/xe,ut={features:[]};return this._addTileFeatures(Ce.range((ie-De)/xe,He,(ie+1+De)/xe,Et),Ce.data,ie,fe,xe,ut),ie===0&&this._addTileFeatures(Ce.range(1-De/xe,He,1,Et),Ce.data,xe,fe,xe,ut),ie===xe-1&&this._addTileFeatures(Ce.range(0,He,De/xe,Et),Ce.data,-1,fe,xe,ut),ut.features.length?ut:null}getClusterExpansionZoom(ne){let ie=this._getOriginZoom(ne)-1;for(;ie<=this.options.maxZoom;){const fe=this.getChildren(ne);if(ie++,fe.length!==1)break;ne=fe[0].properties.cluster_id}return ie}_appendLeaves(ne,ie,fe,Ce,xe){const Re=this.getChildren(ie);for(const qe of Re){const De=qe.properties;if(De&&De.cluster?xe+De.point_count<=Ce?xe+=De.point_count:xe=this._appendLeaves(ne,De.cluster_id,fe,Ce,xe):xe<Ce?xe++:ne.push(qe),ne.length===fe)break}return xe}_createTree(ne){const ie=new o.c0(ne.length/this.stride|0,this.options.nodeSize,Float32Array);for(let fe=0;fe<ne.length;fe+=this.stride)ie.add(ne[fe],ne[fe+1]);return ie.finish(),ie.data=ne,ie}_addTileFeatures(ne,ie,fe,Ce,xe,Re){for(const qe of ne){const De=qe*this.stride,He=ie[De+Ns]>1;let Et,ut,hs;if(He)Et=wr(ie,De,this.clusterProps),ut=ie[De],hs=ie[De+1];else{const sn=this.points[ie[De+It]];Et=sn.properties;const[Hs,nn]=sn.geometry.coordinates;ut=cr(Hs),hs=vn(nn)}const Ts={type:1,geometry:[[Math.round(this.options.extent*(ut*xe-fe)),Math.round(this.options.extent*(hs*xe-Ce))]],tags:Et};let Is;Is=He||this.options.generateId?ie[De+It]:this.points[ie[De+It]].id,Is!==void 0&&(Ts.id=Is),Re.features.push(Ts)}}_limitZoom(ne){return Math.max(this.options.minZoom,Math.min(Math.floor(+ne),this.options.maxZoom+1))}_cluster(ne,ie){const{radius:fe,extent:Ce,reduce:xe,minPoints:Re}=this.options,qe=fe/(Ce*Math.pow(2,ie)),De=ne.data,He=[],Et=this.stride;for(let ut=0;ut<De.length;ut+=Et){if(De[ut+2]<=ie)continue;De[ut+2]=ie;const hs=De[ut],Ts=De[ut+1],Is=ne.within(De[ut],De[ut+1],qe),sn=De[ut+Ns];let Hs=sn;for(const nn of Is){const Kn=nn*Et;De[Kn+2]>ie&&(Hs+=De[Kn+Ns])}if(Hs>sn&&Hs>=Re){let nn,Kn=hs*sn,rn=Ts*sn,Ar=-1;const Yr=(ut/Et<<5)+(ie+1)+this.points.length;for(const $r of Is){const Ln=$r*Et;if(De[Ln+2]<=ie)continue;De[Ln+2]=ie;const bn=De[Ln+Ns];Kn+=De[Ln]*bn,rn+=De[Ln+1]*bn,De[Ln+4]=Yr,xe&&(nn||(nn=this._map(De,ut,!0),Ar=this.clusterProps.length,this.clusterProps.push(nn)),xe(nn,this._map(De,Ln)))}De[ut+4]=Yr,He.push(Kn/Hs,rn/Hs,1/0,Yr,-1,Hs),xe&&He.push(Ar)}else{for(let nn=0;nn<Et;nn++)He.push(De[ut+nn]);if(Hs>1)for(const nn of Is){const Kn=nn*Et;if(!(De[Kn+2]<=ie)){De[Kn+2]=ie;for(let rn=0;rn<Et;rn++)He.push(De[Kn+rn])}}}}return He}_getOriginId(ne){return ne-this.points.length>>5}_getOriginZoom(ne){return(ne-this.points.length)%32}_map(ne,ie,fe){if(ne[ie+Ns]>1){const Re=this.clusterProps[ne[ie+ws]];return fe?Object.assign({},Re):Re}const Ce=this.points[ne[ie+It]].properties,xe=this.options.map(Ce);return fe&&xe===Ce?Object.assign({},xe):xe}}function cn(Be,ne,ie){return{type:"Feature",id:Be[ne+It],properties:wr(Be,ne,ie),geometry:{type:"Point",coordinates:[(fe=Be[ne],360*(fe-.5)),Js(Be[ne+1])]}};var fe}function wr(Be,ne,ie){const fe=Be[ne+Ns],Ce=fe>=1e4?`${Math.round(fe/1e3)}k`:fe>=1e3?Math.round(fe/100)/10+"k":fe,xe=Be[ne+ws],Re=xe===-1?{}:Object.assign({},ie[xe]);return Object.assign(Re,{cluster:!0,cluster_id:Be[ne+It],point_count:fe,point_count_abbreviated:Ce})}function cr(Be){return Be/360+.5}function vn(Be){const ne=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ie<0?0:ie>1?1:ie}function Js(Be){const ne=(180-360*Be)*Math.PI/180;return 360*Math.atan(Math.exp(ne))/Math.PI-90}function Rr(Be,ne,ie,fe){let Ce=fe;const xe=ne+(ie-ne>>1);let Re,qe=ie-ne;const De=Be[ne],He=Be[ne+1],Et=Be[ie],ut=Be[ie+1];for(let hs=ne+3;hs<ie;hs+=3){const Ts=Jo(Be[hs],Be[hs+1],De,He,Et,ut);if(Ts>Ce)Re=hs,Ce=Ts;else if(Ts===Ce){const Is=Math.abs(hs-xe);Is<qe&&(Re=hs,qe=Is)}}Ce>fe&&(Re-ne>3&&Rr(Be,ne,Re,fe),Be[Re+2]=Ce,ie-Re>3&&Rr(Be,Re,ie,fe))}function Jo(Be,ne,ie,fe,Ce,xe){let Re=Ce-ie,qe=xe-fe;if(Re!==0||qe!==0){const De=((Be-ie)*Re+(ne-fe)*qe)/(Re*Re+qe*qe);De>1?(ie=Ce,fe=xe):De>0&&(ie+=Re*De,fe+=qe*De)}return Re=Be-ie,qe=ne-fe,Re*Re+qe*qe}function ao(Be,ne,ie,fe){const Ce={id:Be??null,type:ne,geometry:ie,tags:fe,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(ne==="Point"||ne==="MultiPoint"||ne==="LineString")lo(Ce,ie);else if(ne==="Polygon")lo(Ce,ie[0]);else if(ne==="MultiLineString")for(const xe of ie)lo(Ce,xe);else if(ne==="MultiPolygon")for(const xe of ie)lo(Ce,xe[0]);return Ce}function lo(Be,ne){for(let ie=0;ie<ne.length;ie+=3)Be.minX=Math.min(Be.minX,ne[ie]),Be.minY=Math.min(Be.minY,ne[ie+1]),Be.maxX=Math.max(Be.maxX,ne[ie]),Be.maxY=Math.max(Be.maxY,ne[ie+1])}function gi(Be,ne,ie,fe){if(!ne.geometry)return;const Ce=ne.geometry.coordinates;if(Ce&&Ce.length===0)return;const xe=ne.geometry.type,Re=Math.pow(ie.tolerance/((1<<ie.maxZoom)*ie.extent),2);let qe=[],De=ne.id;if(ie.promoteId?De=ne.properties[ie.promoteId]:ie.generateId&&(De=fe||0),xe==="Point")va(Ce,qe);else if(xe==="MultiPoint")for(const He of Ce)va(He,qe);else if(xe==="LineString")Ki(Ce,qe,Re,!1);else if(xe==="MultiLineString"){if(ie.lineMetrics){for(const He of Ce)qe=[],Ki(He,qe,Re,!1),Be.push(ao(De,"LineString",qe,ne.properties));return}Rl(Ce,qe,Re,!1)}else if(xe==="Polygon")Rl(Ce,qe,Re,!0);else{if(xe!=="MultiPolygon"){if(xe==="GeometryCollection"){for(const He of ne.geometry.geometries)gi(Be,{id:De,geometry:He,properties:ne.properties},ie,fe);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const He of Ce){const Et=[];Rl(He,Et,Re,!0),qe.push(Et)}}Be.push(ao(De,xe,qe,ne.properties))}function va(Be,ne){ne.push(hc(Be[0]),kr(Be[1]),0)}function Ki(Be,ne,ie,fe){let Ce,xe,Re=0;for(let De=0;De<Be.length;De++){const He=hc(Be[De][0]),Et=kr(Be[De][1]);ne.push(He,Et,0),De>0&&(Re+=fe?(Ce*Et-He*xe)/2:Math.sqrt(Math.pow(He-Ce,2)+Math.pow(Et-xe,2))),Ce=He,xe=Et}const qe=ne.length-3;ne[2]=1,Rr(ne,0,qe,ie),ne[qe+2]=1,ne.size=Math.abs(Re),ne.start=0,ne.end=ne.size}function Rl(Be,ne,ie,fe){for(let Ce=0;Ce<Be.length;Ce++){const xe=[];Ki(Be[Ce],xe,ie,fe),ne.push(xe)}}function hc(Be){return Be/360+.5}function kr(Be){const ne=Math.sin(Be*Math.PI/180),ie=.5-.25*Math.log((1+ne)/(1-ne))/Math.PI;return ie<0?0:ie>1?1:ie}function xi(Be,ne,ie,fe,Ce,xe,Re,qe){if(fe/=ne,xe>=(ie/=ne)&&Re<fe)return Be;if(Re<ie||xe>=fe)return null;const De=[];for(const He of Be){const Et=He.geometry;let ut=He.type;const hs=Ce===0?He.minX:He.minY,Ts=Ce===0?He.maxX:He.maxY;if(hs>=ie&&Ts<fe){De.push(He);continue}if(Ts<ie||hs>=fe)continue;let Is=[];if(ut==="Point"||ut==="MultiPoint")du(Et,Is,ie,fe,Ce);else if(ut==="LineString")Ba(Et,Is,ie,fe,Ce,!1,qe.lineMetrics);else if(ut==="MultiLineString")Pi(Et,Is,ie,fe,Ce,!1);else if(ut==="Polygon")Pi(Et,Is,ie,fe,Ce,!0);else if(ut==="MultiPolygon")for(const sn of Et){const Hs=[];Pi(sn,Hs,ie,fe,Ce,!0),Hs.length&&Is.push(Hs)}if(Is.length){if(qe.lineMetrics&&ut==="LineString"){for(const sn of Is)De.push(ao(He.id,ut,sn,He.tags));continue}ut!=="LineString"&&ut!=="MultiLineString"||(Is.length===1?(ut="LineString",Is=Is[0]):ut="MultiLineString"),ut!=="Point"&&ut!=="MultiPoint"||(ut=Is.length===3?"Point":"MultiPoint"),De.push(ao(He.id,ut,Is,He.tags))}}return De.length?De:null}function du(Be,ne,ie,fe,Ce){for(let xe=0;xe<Be.length;xe+=3){const Re=Be[xe+Ce];Re>=ie&&Re<=fe&&co(ne,Be[xe],Be[xe+1],Be[xe+2])}}function Ba(Be,ne,ie,fe,Ce,xe,Re){let qe=Va(Be);const De=Ce===0?ba:uo;let He,Et,ut=Be.start;for(let Hs=0;Hs<Be.length-3;Hs+=3){const nn=Be[Hs],Kn=Be[Hs+1],rn=Be[Hs+2],Ar=Be[Hs+3],Yr=Be[Hs+4],$r=Ce===0?nn:Kn,Ln=Ce===0?Ar:Yr;let bn=!1;Re&&(He=Math.sqrt(Math.pow(nn-Ar,2)+Math.pow(Kn-Yr,2))),$r<ie?Ln>ie&&(Et=De(qe,nn,Kn,Ar,Yr,ie),Re&&(qe.start=ut+He*Et)):$r>fe?Ln<fe&&(Et=De(qe,nn,Kn,Ar,Yr,fe),Re&&(qe.start=ut+He*Et)):co(qe,nn,Kn,rn),Ln<ie&&$r>=ie&&(Et=De(qe,nn,Kn,Ar,Yr,ie),bn=!0),Ln>fe&&$r<=fe&&(Et=De(qe,nn,Kn,Ar,Yr,fe),bn=!0),!xe&&bn&&(Re&&(qe.end=ut+He*Et),ne.push(qe),qe=Va(Be)),Re&&(ut+=He)}let hs=Be.length-3;const Ts=Be[hs],Is=Be[hs+1],sn=Ce===0?Ts:Is;sn>=ie&&sn<=fe&&co(qe,Ts,Is,Be[hs+2]),hs=qe.length-3,xe&&hs>=3&&(qe[hs]!==qe[0]||qe[hs+1]!==qe[1])&&co(qe,qe[0],qe[1],qe[2]),qe.length&&ne.push(qe)}function Va(Be){const ne=[];return ne.size=Be.size,ne.start=Be.start,ne.end=Be.end,ne}function Pi(Be,ne,ie,fe,Ce,xe){for(const Re of Be)Ba(Re,ne,ie,fe,Ce,xe,!1)}function co(Be,ne,ie,fe){Be.push(ne,ie,fe)}function ba(Be,ne,ie,fe,Ce,xe){const Re=(xe-ne)/(fe-ne);return co(Be,xe,ie+(Ce-ie)*Re,1),Re}function uo(Be,ne,ie,fe,Ce,xe){const Re=(xe-ie)/(Ce-ie);return co(Be,ne+(fe-ne)*Re,xe,1),Re}function Ua(Be,ne){const ie=[];for(let fe=0;fe<Be.length;fe++){const Ce=Be[fe],xe=Ce.type;let Re;if(xe==="Point"||xe==="MultiPoint"||xe==="LineString")Re=So(Ce.geometry,ne);else if(xe==="MultiLineString"||xe==="Polygon"){Re=[];for(const qe of Ce.geometry)Re.push(So(qe,ne))}else if(xe==="MultiPolygon"){Re=[];for(const qe of Ce.geometry){const De=[];for(const He of qe)De.push(So(He,ne));Re.push(De)}}ie.push(ao(Ce.id,xe,Re,Ce.tags))}return ie}function So(Be,ne){const ie=[];ie.size=Be.size,Be.start!==void 0&&(ie.start=Be.start,ie.end=Be.end);for(let fe=0;fe<Be.length;fe+=3)ie.push(Be[fe]+ne,Be[fe+1],Be[fe+2]);return ie}function pc(Be,ne){if(Be.transformed)return Be;const ie=1<<Be.z,fe=Be.x,Ce=Be.y;for(const xe of Be.features){const Re=xe.geometry,qe=xe.type;if(xe.geometry=[],qe===1)for(let De=0;De<Re.length;De+=2)xe.geometry.push(sr(Re[De],Re[De+1],ne,ie,fe,Ce));else for(let De=0;De<Re.length;De++){const He=[];for(let Et=0;Et<Re[De].length;Et+=2)He.push(sr(Re[De][Et],Re[De][Et+1],ne,ie,fe,Ce));xe.geometry.push(He)}}return Be.transformed=!0,Be}function sr(Be,ne,ie,fe,Ce,xe){return[Math.round(ie*(Be*fe-Ce)),Math.round(ie*(ne*fe-xe))]}function fc(Be,ne,ie,fe,Ce){const xe=ne===Ce.maxZoom?0:Ce.tolerance/((1<<ne)*Ce.extent),Re={features:[],numPoints:0,numSimplified:0,numFeatures:Be.length,source:null,x:ie,y:fe,z:ne,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const qe of Be)mc(Re,qe,xe,Ce);return Re}function mc(Be,ne,ie,fe){const Ce=ne.geometry,xe=ne.type,Re=[];if(Be.minX=Math.min(Be.minX,ne.minX),Be.minY=Math.min(Be.minY,ne.minY),Be.maxX=Math.max(Be.maxX,ne.maxX),Be.maxY=Math.max(Be.maxY,ne.maxY),xe==="Point"||xe==="MultiPoint")for(let qe=0;qe<Ce.length;qe+=3)Re.push(Ce[qe],Ce[qe+1]),Be.numPoints++,Be.numSimplified++;else if(xe==="LineString")jo(Re,Ce,Be,ie,!1,!1);else if(xe==="MultiLineString"||xe==="Polygon")for(let qe=0;qe<Ce.length;qe++)jo(Re,Ce[qe],Be,ie,xe==="Polygon",qe===0);else if(xe==="MultiPolygon")for(let qe=0;qe<Ce.length;qe++){const De=Ce[qe];for(let He=0;He<De.length;He++)jo(Re,De[He],Be,ie,!0,He===0)}if(Re.length){let qe=ne.tags||null;if(xe==="LineString"&&fe.lineMetrics){qe={};for(const He in ne.tags)qe[He]=ne.tags[He];qe.mapbox_clip_start=Ce.start/Ce.size,qe.mapbox_clip_end=Ce.end/Ce.size}const De={geometry:Re,type:xe==="Polygon"||xe==="MultiPolygon"?3:xe==="LineString"||xe==="MultiLineString"?2:1,tags:qe};ne.id!==null&&(De.id=ne.id),Be.features.push(De)}}function jo(Be,ne,ie,fe,Ce,xe){const Re=fe*fe;if(fe>0&&ne.size<(Ce?Re:fe))return void(ie.numPoints+=ne.length/3);const qe=[];for(let De=0;De<ne.length;De+=3)(fe===0||ne[De+2]>Re)&&(ie.numSimplified++,qe.push(ne[De],ne[De+1])),ie.numPoints++;Ce&&function(De,He){let Et=0;for(let ut=0,hs=De.length,Ts=hs-2;ut<hs;Ts=ut,ut+=2)Et+=(De[ut]-De[Ts])*(De[ut+1]+De[Ts+1]);if(Et>0===He)for(let ut=0,hs=De.length;ut<hs/2;ut+=2){const Ts=De[ut],Is=De[ut+1];De[ut]=De[hs-2-ut],De[ut+1]=De[hs-1-ut],De[hs-2-ut]=Ts,De[hs-1-ut]=Is}}(qe,xe),Be.push(qe)}const kl={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class wa{constructor(ne,ie){const fe=(ie=this.options=function(xe,Re){for(const qe in Re)xe[qe]=Re[qe];return xe}(Object.create(kl),ie)).debug;if(fe&&console.time("preprocess data"),ie.maxZoom<0||ie.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(ie.promoteId&&ie.generateId)throw new Error("promoteId and generateId cannot be used together.");let Ce=function(xe,Re){const qe=[];if(xe.type==="FeatureCollection")for(let De=0;De<xe.features.length;De++)gi(qe,xe.features[De],Re,De);else gi(qe,xe.type==="Feature"?xe:{geometry:xe},Re);return qe}(ne,ie);this.tiles={},this.tileCoords=[],fe&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",ie.indexMaxZoom,ie.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Ce=function(xe,Re){const qe=Re.buffer/Re.extent;let De=xe;const He=xi(xe,1,-1-qe,qe,0,-1,2,Re),Et=xi(xe,1,1-qe,2+qe,0,-1,2,Re);return(He||Et)&&(De=xi(xe,1,-qe,1+qe,0,-1,2,Re)||[],He&&(De=Ua(He,1).concat(De)),Et&&(De=De.concat(Ua(Et,-1)))),De}(Ce,ie),Ce.length&&this.splitTile(Ce,0,0,0),fe&&(Ce.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(ne,ie,fe,Ce,xe,Re,qe){const De=[ne,ie,fe,Ce],He=this.options,Et=He.debug;for(;De.length;){Ce=De.pop(),fe=De.pop(),ie=De.pop(),ne=De.pop();const ut=1<<ie,hs=gc(ie,fe,Ce);let Ts=this.tiles[hs];if(!Ts&&(Et>1&&console.time("creation"),Ts=this.tiles[hs]=fc(ne,ie,fe,Ce,He),this.tileCoords.push({z:ie,x:fe,y:Ce}),Et)){Et>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",ie,fe,Ce,Ts.numFeatures,Ts.numPoints,Ts.numSimplified),console.timeEnd("creation"));const bn=`z${ie}`;this.stats[bn]=(this.stats[bn]||0)+1,this.total++}if(Ts.source=ne,xe==null){if(ie===He.indexMaxZoom||Ts.numPoints<=He.indexMaxPoints)continue}else{if(ie===He.maxZoom||ie===xe)continue;if(xe!=null){const bn=xe-ie;if(fe!==Re>>bn||Ce!==qe>>bn)continue}}if(Ts.source=null,ne.length===0)continue;Et>1&&console.time("clipping");const Is=.5*He.buffer/He.extent,sn=.5-Is,Hs=.5+Is,nn=1+Is;let Kn=null,rn=null,Ar=null,Yr=null,$r=xi(ne,ut,fe-Is,fe+Hs,0,Ts.minX,Ts.maxX,He),Ln=xi(ne,ut,fe+sn,fe+nn,0,Ts.minX,Ts.maxX,He);ne=null,$r&&(Kn=xi($r,ut,Ce-Is,Ce+Hs,1,Ts.minY,Ts.maxY,He),rn=xi($r,ut,Ce+sn,Ce+nn,1,Ts.minY,Ts.maxY,He),$r=null),Ln&&(Ar=xi(Ln,ut,Ce-Is,Ce+Hs,1,Ts.minY,Ts.maxY,He),Yr=xi(Ln,ut,Ce+sn,Ce+nn,1,Ts.minY,Ts.maxY,He),Ln=null),Et>1&&console.timeEnd("clipping"),De.push(Kn||[],ie+1,2*fe,2*Ce),De.push(rn||[],ie+1,2*fe,2*Ce+1),De.push(Ar||[],ie+1,2*fe+1,2*Ce),De.push(Yr||[],ie+1,2*fe+1,2*Ce+1)}}getTile(ne,ie,fe){ne=+ne,ie=+ie,fe=+fe;const Ce=this.options,{extent:xe,debug:Re}=Ce;if(ne<0||ne>24)return null;const qe=1<<ne,De=gc(ne,ie=ie+qe&qe-1,fe);if(this.tiles[De])return pc(this.tiles[De],xe);Re>1&&console.log("drilling down to z%d-%d-%d",ne,ie,fe);let He,Et=ne,ut=ie,hs=fe;for(;!He&&Et>0;)Et--,ut>>=1,hs>>=1,He=this.tiles[gc(Et,ut,hs)];return He&&He.source?(Re>1&&(console.log("found parent tile z%d-%d-%d",Et,ut,hs),console.time("drilling down")),this.splitTile(He.source,Et,ut,hs,ne,ie,fe),Re>1&&console.timeEnd("drilling down"),this.tiles[De]?pc(this.tiles[De],xe):null):null}}function gc(Be,ne,ie){return 32*((1<<Be)*ie+ne)+Be}function et(Be,ne){const ie=Be.tileID.canonical;if(!this._geoJSONIndex)return void ne(null,null);const fe=this._geoJSONIndex.getTile(ie.z,ie.x,ie.y);if(!fe)return void ne(null,null);const Ce=He=>He.tags&&"3d_elevation_id"in He.tags&&"source"in He.tags&&He.tags.source==="elevation",xe=fe.features.filter(He=>Ce(He));let Re={_geojsonTileLayer:fe.features};xe.length>0&&(Re={_geojsonTileLayer:fe.features.filter(He=>!Ce(He)),hd_road_elevation:xe});const qe=new Pe(Re),De=function(He){const Et=new o.bq;for(const ut of Object.keys(He))Et.writeMessage(3,ze,{name:ut,features:He[ut]});return Et.finish()}(Re).buffer;ne(null,{vectorTile:qe,rawData:De})}class er extends X{constructor(ne,ie,fe,Ce,xe,Re,qe){super(ne,ie,fe,Ce,xe,et,qe),Re&&(this.loadGeoJSON=Re),this._dynamicIndex=new xt}loadData(ne,ie){const fe=ne&&ne.request,Ce=fe&&fe.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(ne,(xe,Re)=>{if(xe||!Re)return ie(xe);if(typeof Re!="object")return ie(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));{try{if(ne.filter){const De=o.X(ne.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(De.result==="error")throw new Error(De.value.map(He=>`${He.key}: ${He.message}`).join(", "));Re.features=Re.features.filter(He=>De.value.evaluate({zoom:0},He))}ne.dynamic?(Re.type==="Feature"&&(Re={type:"FeatureCollection",features:[Re]}),ne.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Re.features,this.loaded),ne.cluster&&(Re.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=ne.cluster?new tn(function({superclusterOptions:De,clusterProperties:He}){if(!He||!De)return De;const Et={},ut={},hs={accumulated:null,zoom:0},Ts={properties:null},Is=Object.keys(He);for(const sn of Is){const[Hs,nn]=He[sn],Kn=o.X(nn),rn=o.X(typeof Hs=="string"?[Hs,["accumulated"],["get",sn]]:Hs);Et[sn]=Kn.value,ut[sn]=rn.value}return De.map=sn=>{Ts.properties=sn;const Hs={};for(const nn of Is)Hs[nn]=Et[nn].evaluate(hs,Ts);return Hs},De.reduce=(sn,Hs)=>{Ts.properties=Hs;for(const nn of Is)hs.accumulated=sn[nn],sn[nn]=ut[nn].evaluate(hs,Ts)},De}(ne)).load(Re.features):ne.dynamic?this._dynamicIndex:function(De,He){return new wa(De,He)}(Re,ne.geojsonVtOptions)}catch(De){return ie(De)}const qe={};if(Ce){const De=E(fe);De&&(qe.resourceTiming={},qe.resourceTiming[ne.source]=JSON.parse(JSON.stringify(De)))}ie(null,qe)}})}reloadTile(ne,ie){const fe=this.loaded;return fe&&fe[ne.uid]?ne.partial?ie(null,void 0):super.reloadTile(ne,ie):this.loadTile(ne,ie)}loadGeoJSON(ne,ie){if(ne.request)o.n(ne.request,ie);else{if(typeof ne.data!="string")return ie(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`));setTimeout(()=>{try{return ie(null,JSON.parse(ne.data))}catch{return ie(new Error(`Input data given to '${ne.source}' is not a valid GeoJSON object.`))}},0)}}getClusterExpansionZoom(ne,ie){try{ie(null,this._geoJSONIndex.getClusterExpansionZoom(ne.clusterId))}catch(fe){ie(fe)}}getClusterChildren(ne,ie){try{ie(null,this._geoJSONIndex.getChildren(ne.clusterId))}catch(fe){ie(fe)}}getClusterLeaves(ne,ie){try{ie(null,this._geoJSONIndex.getLeaves(ne.clusterId,ne.limit,ne.offset))}catch(fe){ie(fe)}}}class Dr{constructor(ne,ie,fe){this.tileID=new o.aM(ne.tileID.overscaledZ,ne.tileID.wrap,ne.tileID.canonical.z,ne.tileID.canonical.x,ne.tileID.canonical.y),this.tileZoom=ne.tileZoom,this.uid=ne.uid,this.zoom=ne.zoom,this.canonical=ne.tileID.canonical,this.pixelRatio=ne.pixelRatio,this.tileSize=ne.tileSize,this.source=ne.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=ne.projection,this.brightness=ie,this.worldview=fe}parse(ne,ie,fe,Ce){this.status="parsing";const xe=new o.aM(fe.tileID.overscaledZ,fe.tileID.wrap,fe.tileID.canonical.z,fe.tileID.canonical.x,fe.tileID.canonical.y),Re=[],qe=ie.familiesBySource[fe.source],De=new o.fc(xe,fe.promoteId);De.bucketLayerIDs=[],De.is3DTile=!0,o.fr(ne).then(He=>{if(!He)return Ce(new Error("Could not parse tile"));const Et=He.json.extensionsUsed&&He.json.extensionsUsed.includes("MAPBOX_mesh_features")||He.json.asset.extras&&He.json.asset.extras.MAPBOX_mesh_features,ut=He.json.extensionsUsed&&He.json.extensionsUsed.includes("EXT_meshopt_compression"),hs=new o.aa(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const Ts in qe)for(const Is of qe[Ts]){const sn=Is[0];De.bucketLayerIDs.push(Is.map(Kn=>o.C(Kn.id,Kn.scope))),sn.recalculate(hs,[]);const Hs=o.fs(He,1/o.d4(fe.tileID.canonical)),nn=new o.ft(Is,Hs,xe,Et,ut,this.brightness,De,this.worldview);Et||(nn.needsUpload=!0),Re.push(nn),nn.evaluate(sn)}this.status="done",Ce(null,{buckets:Re,featureIndex:De,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})}).catch(He=>Ce(new Error(He.message)))}}class Xi{constructor(ne,ie,fe,Ce,xe,Re,qe,De){this.actor=ne,this.layerIndex=ie,this.availableImages=fe,this.availableModels=Ce,this.brightness=qe,this.loading={},this.loaded={},this.worldview=De}loadTile(ne,ie){const fe=ne.uid,Ce=this.loading[fe]=new Dr(ne,this.brightness,this.worldview);o.br(ne.request,(xe,Re)=>{const qe=!this.loading[fe];return delete this.loading[fe],qe||xe?(Ce.status="done",qe||(this.loaded[fe]=Ce),ie(xe)):Re&&Re.byteLength!==0?void Ce.parse(Re,this.layerIndex,ne,(De,He)=>{Ce.status="done",this.loaded=this.loaded||{},this.loaded[fe]=Ce,De||!He?ie(De):ie(null,He)}):(Ce.status="done",this.loaded[fe]=Ce,ie())})}reloadTile(ne,ie){const fe=this.loaded,Ce=ne.uid;if(fe&&fe[Ce]){const xe=fe[Ce];xe.projection=ne.projection,xe.brightness=ne.brightness;const Re=(qe,De)=>{xe.reloadCallback&&(delete xe.reloadCallback,this.loadTile(ne,ie)),ie(qe,De)};xe.status==="parsing"?xe.reloadCallback=Re:xe.status==="done"&&this.loadTile(ne,ie)}}abortTile(ne,ie){const fe=ne.uid;this.loading[fe]&&delete this.loading[fe],ie()}removeTile(ne,ie){const fe=this.loaded,Ce=ne.uid;fe&&fe[Ce]&&delete fe[Ce],ie()}}class Ks{constructor(ne){this.self=ne,this.actor=new o.fv(ne,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new o.y,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=o.cj({name:"mercator"}),this.workerSourceTypes={vector:X,geojson:er,"raster-dem":Z,"raster-array":q,"batched-model":Xi},this.workerSources={},this.self.registerWorkerSource=(ie,fe)=>{if(this.workerSourceTypes[ie])throw new Error(`Worker source with name "${ie}" already registered.`);this.workerSourceTypes[ie]=fe},this.self.registerRTLTextPlugin=ie=>{if(o.fw.isParsed())throw new Error("RTL text plugin already registered.");o.fw.setState({pluginStatus:o.fx.parsed,pluginURL:o.fw.getPluginURL()}),o.fw.applyArabicShaping=ie.applyArabicShaping,o.fw.processBidirectionalText=ie.processBidirectionalText,o.fw.processStyledBidirectionalText=ie.processStyledBidirectionalText;for(const fe of this.rtlPluginParsingListeners)fe(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(ne,ie,fe){delete this.layerIndexes[ne],delete this.availableImages[ne],delete this.availableModels[ne],delete this.workerSources[ne],fe()}checkIfReady(ne,ie,fe){fe()}setReferrer(ne,ie){this.referrer=ie}spriteLoaded(ne,ie){this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={});const{scope:fe,isLoaded:Ce}=ie;if(this.isSpriteLoaded[ne][fe]=Ce,this.workerSources[ne]&&this.workerSources[ne][fe])for(const xe in this.workerSources[ne][fe]){const Re=this.workerSources[ne][fe][xe];for(const qe in Re){const De=Re[qe];De instanceof X&&(De.isSpriteLoaded=Ce,De.fire(new o.A("isSpriteLoaded")))}}}setImages(ne,ie,fe){this.availableImages[ne]||(this.availableImages[ne]={});const{scope:Ce,images:xe}=ie;if(this.availableImages[ne][Ce]=xe,this.workerSources[ne]&&this.workerSources[ne][Ce]){for(const Re in this.workerSources[ne][Ce]){const qe=this.workerSources[ne][Ce][Re];for(const De in qe)qe[De].availableImages=xe}fe()}else fe()}setModels(ne,{scope:ie,models:fe},Ce){if(this.availableModels[ne]||(this.availableModels[ne]={}),this.availableModels[ne][ie]=fe,this.workerSources[ne]&&this.workerSources[ne][ie]){for(const xe in this.workerSources[ne][ie]){const Re=this.workerSources[ne][ie][xe];for(const qe in Re)Re[qe].availableModels=fe}Ce()}else Ce()}setProjection(ne,ie){this.projections[ne]=o.cj(ie)}setBrightness(ne,ie,fe){this.brightness=ie,fe()}setWorldview(ne,ie,fe){this.worldview=ie,fe()}setLayers(ne,ie,fe){this.getLayerIndex(ne,ie.scope).replace(ie.layers,ie.options),fe()}updateLayers(ne,ie,fe){this.getLayerIndex(ne,ie.scope).update(ie.layers,ie.removedIds,ie.options),fe()}loadTile(ne,ie,fe){ie.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ie.type,ie.source,ie.scope).loadTile(ie,fe)}decodeRasterArray(ne,ie,fe){this.getWorkerSource(ne,ie.type,ie.source,ie.scope).decodeRasterArray(ie,fe)}reloadTile(ne,ie,fe){ie.projection=this.projections[ne]||this.defaultProjection,this.getWorkerSource(ne,ie.type,ie.source,ie.scope).reloadTile(ie,fe)}abortTile(ne,ie,fe){this.getWorkerSource(ne,ie.type,ie.source,ie.scope).abortTile(ie,fe)}removeTile(ne,ie,fe){this.getWorkerSource(ne,ie.type,ie.source,ie.scope).removeTile(ie,fe)}removeSource(ne,ie,fe){if(!(this.workerSources[ne]&&this.workerSources[ne][ie.scope]&&this.workerSources[ne][ie.scope][ie.type]&&this.workerSources[ne][ie.scope][ie.type][ie.source]))return;const Ce=this.workerSources[ne][ie.scope][ie.type][ie.source];delete this.workerSources[ne][ie.scope][ie.type][ie.source],Ce.removeSource!==void 0?Ce.removeSource(ie,fe):fe()}loadWorkerSource(ne,ie,fe){try{this.self.importScripts(ie.url),fe()}catch(Ce){fe(Ce.toString())}}syncRTLPluginState(ne,ie,fe){if(o.fw.isParsed())fe(null,!0);else if(o.fw.isParsing())this.rtlPluginParsingListeners.push(fe);else try{o.fw.setState(ie);const Ce=o.fw.getPluginURL();!o.fw.isLoaded()||o.fw.isParsed()||o.fw.isParsing()||Ce==null||(o.fw.setState({pluginStatus:o.fx.parsing,pluginURL:o.fw.getPluginURL()}),this.self.importScripts(Ce),o.fw.isParsed()?fe(null,!0):this.rtlPluginParsingListeners.push(fe))}catch(Ce){fe(Ce.toString())}}setDracoUrl(ne,ie){this.dracoUrl=ie}getAvailableImages(ne,ie){this.availableImages[ne]||(this.availableImages[ne]={});let fe=this.availableImages[ne][ie];return fe||(fe=[]),fe}getAvailableModels(ne,ie){this.availableModels[ne]||(this.availableModels[ne]={});let fe=this.availableModels[ne][ie];return fe||(fe={}),fe}getLayerIndex(ne,ie){this.layerIndexes[ne]||(this.layerIndexes[ne]={});let fe=this.layerIndexes[ne][ie];return fe||(fe=this.layerIndexes[ne][ie]=new L,fe.scope=ie),fe}getWorkerSource(ne,ie,fe,Ce){const xe=this.workerSources;return xe[ne]||(xe[ne]={}),xe[ne][Ce]||(xe[ne][Ce]={}),xe[ne][Ce][ie]||(xe[ne][Ce][ie]={}),this.isSpriteLoaded[ne]||(this.isSpriteLoaded[ne]={}),xe[ne][Ce][ie][fe]||(xe[ne][Ce][ie][fe]=new this.workerSourceTypes[ie]({send:(Re,qe,De,He,Et,ut)=>this.actor.send(Re,qe,De,ne,Et,ut),scheduler:this.actor.scheduler},this.getLayerIndex(ne,Ce),this.getAvailableImages(ne,Ce),this.getAvailableModels(ne,Ce),this.isSpriteLoaded[ne][Ce],void 0,this.brightness,this.worldview)),xe[ne][Ce][ie][fe]}rasterizeImagesWorker(ne,ie,fe){const Ce=new Map;for(const[xe,{image:Re,imageVariant:qe}]of ie.tasks.entries()){const De=this.imageRasterizer.rasterize(qe,Re,ie.scope,ne);Ce.set(xe,De)}fe(void 0,Ce)}removeRasterizedImages(ne,ie,fe){this.imageRasterizer.removeImagesFromCacheByIds(ie.imageIds,ie.scope,ne),fe()}enforceCacheSizeLimit(ne,ie){o.fy(ie)}getWorkerPerformanceMetrics(ne,ie,fe){fe(void 0,void 0)}}return o.fu(self)&&(self.worker=new Ks(self)),Ks}),_(["./shared"],function(o){var E="3.14.0";const P={create:"create",load:"load",fullLoad:"fullLoad"},M={mark(p){performance.mark(p)},measure(p,r,c){performance.measure(p,r,c)}};function L(p){const r=p.name.split("?")[0];return o.a(r)&&r.includes("mapbox-gl.js")?"javascript":o.a(r)&&r.includes("mapbox-gl.css")?"css":o.b(r)?"fontRange":o.c(r)?"sprite":o.i(r)?"style":o.d(r)?"tilejson":"other"}var F,$={},Y=function(){if(F)return $;function p(f){return!r(f)}function r(f){return typeof window>"u"||typeof document>"u"?"not a browser":function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var v,S,N=new Blob([""],{type:"text/javascript"}),C=URL.createObjectURL(N);try{S=new Worker(C),v=!0}catch{v=!1}return S&&S.terminate(),URL.revokeObjectURL(C),v}()?function(){var v=document.createElement("canvas");v.width=v.height=1;var S=v.getContext("2d");if(!S)return!1;var N=S.getImageData(0,0,1,1);return N&&N.width===v.width}()?(c[y=f&&f.failIfMajorPerformanceCaveat]===void 0&&(c[y]=function(v){var S,N=function(C){var k=document.createElement("canvas"),D=Object.create(p.webGLContextAttributes);return D.failIfMajorPerformanceCaveat=C,k.getContext("webgl2",D)}(v);if(!N)return!1;try{S=N.createShader(N.VERTEX_SHADER)}catch{return!1}return!(!S||N.isContextLost())&&(N.shaderSource(S,"void main() {}"),N.compileShader(S),N.getShaderParameter(S,N.COMPILE_STATUS)===!0)}(y)),c[y]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var y}F=1,$.supported=p,$.notSupportedReason=r;var c={};return p.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},$}();function H(p,r,c){const f=document.createElement(p);return r!=null&&(f.className=r),c&&c.appendChild(f),f}function X(p,r,c){const f=document.createElementNS("http://www.w3.org/2000/svg",p);for(const y of Object.keys(r))f.setAttributeNS(null,y,String(r[y]));return c&&c.appendChild(f),f}const Z=typeof document<"u"?document.documentElement&&document.documentElement.style:null,W=Z&&Z.userSelect!==void 0?"userSelect":"WebkitUserSelect";let q;function oe(){Z&&W&&(q=Z[W],Z[W]="none")}function ae(){Z&&W&&(Z[W]=q)}function Ne(p){p.preventDefault(),p.stopPropagation(),window.removeEventListener("click",Ne,!0)}function Pe(){window.addEventListener("click",Ne,!0),window.setTimeout(()=>{window.removeEventListener("click",Ne,!0)},0)}function Le(p,r){const c=p.getBoundingClientRect();return yt(p,c,r)}function ct(p,r){const c=p.getBoundingClientRect(),f=[];for(let y=0;y<r.length;y++)f.push(yt(p,c,r[y]));return f}function xt(p){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&p.button===2&&p.ctrlKey?0:p.button}function yt(p,r,c){const f=p.offsetWidth===r.width?1:p.offsetWidth/r.width;return new o.P((c.clientX-r.left)*f,(c.clientY-r.top)*f)}const Ht="01",Dt="NO_ACCESS_TOKEN";class wt{constructor(r,c,f){this._transformRequestFn=r,this._customAccessToken=c,this._silenceAuthErrors=!!f,this._createSkuToken()}_createSkuToken(){const r=function(){let c="";for(let f=0;f<10;f++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Ht,c].join(""),tokenExpiresAt:Date.now()+432e5}}();this._skuToken=r.token,this._skuTokenExpiresAt=r.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(r,c){return this._transformRequestFn&&this._transformRequestFn(r,c)||{url:r}}normalizeStyleURL(r,c){if(!o.j(r))return r;const f=Vt(r);return f.params.push(`sdk=js-${E}`),f.path=`/styles/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeGlyphsURL(r,c){if(!o.j(r))return r;const f=Vt(r);return f.path=`/fonts/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeModelURL(r,c){if(!o.j(r))return r;const f=Vt(r);return f.path=`/models/v1${f.path}`,this._makeAPIURL(f,this._customAccessToken||c)}normalizeSourceURL(r,c,f,y){if(!o.j(r))return r;const v=Vt(r);return v.path=`/v4/${v.authority}.json`,v.params.push("secure"),f&&v.params.push(`language=${f}`),y&&v.params.push(`worldview=${y}`),this._makeAPIURL(v,this._customAccessToken||c)}normalizeIconsetURL(r,c){const f=Vt(r);return o.j(r)?(f.path=`/styles/v1${f.path}/iconset.pbf`,this._makeAPIURL(f,this._customAccessToken||c)):Bt(f)}normalizeSpriteURL(r,c,f,y){const v=Vt(r);return o.j(r)?(v.path=`/styles/v1${v.path}/sprite${c}${f}`,this._makeAPIURL(v,this._customAccessToken||y)):(v.path+=`${c}${f}`,Bt(v))}normalizeTileURL(r,c,f){if(this._isSkuTokenExpired()&&this._createSkuToken(),r&&!o.j(r))return r;const y=Vt(r);y.path=y.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||f&&y.authority!=="raster"&&f===512?"@2x":""}${o.l.supported?".webp":"$1"}`),y.authority==="raster"?y.path=`/${o.e.RASTER_URL_PREFIX}${y.path}`:y.authority==="rasterarrays"?y.path=`/${o.e.RASTERARRAYS_URL_PREFIX}${y.path}`:y.authority==="3dtiles"?y.path=`/${o.e.TILES3D_URL_PREFIX}${y.path}`:(y.path=y.path.replace(/^.+\/v4\//,"/"),y.path=`/${o.e.TILE_URL_VERSION}${y.path}`);const v=this._customAccessToken||function(S){for(const N of S){const C=N.match(/^access_token=(.*)$/);if(C)return C[1]}return null}(y.params)||o.e.ACCESS_TOKEN;return o.e.REQUIRE_ACCESS_TOKEN&&v&&this._skuToken&&y.params.push(`sku=${this._skuToken}`),this._makeAPIURL(y,v)}canonicalizeTileURL(r,c){const f=Vt(r);if(!f.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!f.path.match(/\.[\w]+$/))return r;let y="mapbox://";f.path.match(/^\/raster\/v1\//)?y+=`raster/${f.path.replace(`/${o.e.RASTER_URL_PREFIX}/`,"")}`:f.path.match(/^\/rasterarrays\/v1\//)?y+=`rasterarrays/${f.path.replace(`/${o.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:y+=`tiles/${f.path.replace(`/${o.e.TILE_URL_VERSION}/`,"")}`;let v=f.params;return c&&(v=v.filter(S=>!S.match(/^access_token=/))),v.length&&(y+=`?${v.join("&")}`),y}canonicalizeTileset(r,c){const f=!!c&&o.j(c),y=[];for(const v of r.tiles||[])o.k(v)?y.push(this.canonicalizeTileURL(v,f)):y.push(v);return y}_makeAPIURL(r,c){const f="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",y=Vt(o.e.API_URL);if(r.protocol=y.protocol,r.authority=y.authority,r.protocol==="http"){const v=r.params.indexOf("secure");v>=0&&r.params.splice(v,1)}if(y.path!=="/"&&(r.path=`${y.path}${r.path}`),!o.e.REQUIRE_ACCESS_TOKEN)return Bt(r);if(c=c||o.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${f}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${f}`)}return r.params=r.params.filter(v=>v.indexOf("access_token")===-1),r.params.push(`access_token=${c||""}`),Bt(r)}}const rs=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Vt(p){const r=p.match(rs);if(!r)throw new Error("Unable to parse URL object");return{protocol:r[1],authority:r[2],path:r[3]||"/",params:r[4]?r[4].split("&"):[]}}function Bt(p){const r=p.params.length?`?${p.params.join("&")}`:"";return`${p.protocol}://${p.authority}${p.path}${r}`}const ze="mapbox.eventData";function Xe(p){if(!p)return null;const r=p.split(".");if(!r||r.length!==3)return null;try{return JSON.parse(o.m(r[1]))}catch{return null}}class Ot{constructor(r){this.type=r,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(r){const c=Xe(o.e.ACCESS_TOKEN);let f="";return f=c&&c.u?o.f(c.u):o.e.ACCESS_TOKEN||"",r?`${ze}.${r}:${f}`:`${ze}:${f}`}fetchEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid");if(r)try{const y=localStorage.getItem(c);y&&(this.eventData=JSON.parse(y));const v=localStorage.getItem(f);v&&(this.anonId=v)}catch{o.w("Unable to read from LocalStorage")}}saveEventData(){const r=o.s("localStorage"),c=this.getStorageKey(),f=this.getStorageKey("uuid"),y=this.anonId;if(r&&y)try{localStorage.setItem(f,y),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{o.w("Unable to write to LocalStorage")}}processRequests(r){}postEvent(r,c,f,y){if(!o.e.EVENTS_URL)return;const v=Vt(o.e.EVENTS_URL);v.params.push(`access_token=${y||o.e.ACCESS_TOKEN||""}`);const S={event:this.type,created:new Date(r).toISOString()},N=c?o.h(S,c):S,C={url:Bt(v),headers:{"Content-Type":"text/plain"},body:JSON.stringify([N])};this.pendingRequest=o.p(C,k=>{this.pendingRequest=null,f(k),this.saveEventData(),this.processRequests(y)})}queueRequest(r,c){this.queue.push(r),this.processRequests(c)}}const nt=new class extends Ot{constructor(p){super("appUserTurnstile"),this._customAccessToken=p}postTurnstileEvent(p,r){o.e.EVENTS_URL&&o.e.ACCESS_TOKEN&&Array.isArray(p)&&p.some(c=>o.j(c)||o.k(c))&&this.queueRequest(Date.now(),r)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const r=Xe(o.e.ACCESS_TOKEN),c=r?r.u:o.e.ACCESS_TOKEN;let f=c!==this.eventData.tokenU;o.v(this.anonId)||(this.anonId=o.u(),f=!0);const y=this.queue.shift();if(this.eventData.lastSuccess){const v=new Date(this.eventData.lastSuccess),S=new Date(y),N=(y-this.eventData.lastSuccess)/864e5;f=f||N>=1||N<-1||v.getDate()!==S.getDate()}else f=!0;f?this.postEvent(y,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Ht,"enabled.telemetry":!1,userId:this.anonId},v=>{v||(this.eventData.lastSuccess=y,this.eventData.tokenU=c)},p):this.processRequests()}},Mt=nt.postTurnstileEvent.bind(nt),ss=new class extends Ot{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(p,r,c,f){this.skuToken=r,this.errorCb=f,o.e.EVENTS_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(Dt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||(this.anonId||this.fetchEventData(),o.v(this.anonId)||(this.anonId=o.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:E,skuId:Ht,skuToken:this.skuToken,userId:this.anonId},f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},p))}remove(){this.errorCb=null}},Ps=ss.postMapLoadEvent.bind(ss),xn=new class extends Ot{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(p){let r=this.mapInstanceIdMap.get(p);return r||(r=o.u(),this.mapInstanceIdMap.set(p,r)),r}getEventId(p){const r=this.eventIdPerMapInstanceMap.get(p)||0;return this.eventIdPerMapInstanceMap.set(p,r+1),r}postStyleLoadEvent(p,r){const{map:c,style:f,importedStyles:y}=r;if(!o.e.EVENTS_URL||!p&&!o.e.ACCESS_TOKEN)return;const v=this.getMapInstanceId(c),S={mapInstanceId:v,eventId:this.getEventId(v),style:f};y.length&&(S.importedStyles=y),this.queueRequest({timestamp:Date.now(),payload:S},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,payload:c}=this.queue.shift();this.postEvent(r,c,()=>{},p)}},Ms=xn.postStyleLoadEvent.bind(xn),Xt=new class extends Ot{constructor(){super("gljs.performance")}postPerformanceEvent(p,r){o.e.EVENTS_URL&&(p||o.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:r},p)}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:r,performanceData:c}=this.queue.shift(),f=function(y){const v=performance.getEntriesByType("resource"),S=performance.getEntriesByType("mark"),N=function(G){const ee={};if(G){for(const J in G)if(J!=="other")for(const se of G[J]){const te=`${J}ResolveRangeMin`,le=`${J}ResolveRangeMax`,de=`${J}RequestCount`,pe=`${J}RequestCachedCount`;ee[te]=Math.min(ee[te]||1/0,se.startTime),ee[le]=Math.max(ee[le]||-1/0,se.responseEnd);const ye=Se=>{ee[Se]===void 0&&(ee[Se]=0),++ee[Se]};se.transferSize!==void 0&&se.transferSize===0&&ye(pe),ye(de)}}return ee}(function(G,ee){const J={};if(G)for(const se of G){const te=ee(se);J[te]===void 0&&(J[te]=[]),J[te].push(se)}return J}(v,L)),C=window.devicePixelRatio,k=navigator.connection||navigator.mozConnection||navigator.webkitConnection,D=k?k.effectiveType:void 0,U={counters:[],metadata:[],attributes:[]},O=(G,ee,J)=>{J!=null&&G.push({name:ee,value:J.toString()})};for(const G in N)O(U.counters,G,N[G]);if(y.interactionRange[0]!==1/0&&y.interactionRange[1]!==-1/0&&(O(U.counters,"interactionRangeMin",y.interactionRange[0]),O(U.counters,"interactionRangeMax",y.interactionRange[1])),S)for(const G of Object.keys(P)){const ee=P[G],J=S.find(se=>se.name===ee);J&&O(U.counters,ee,J.startTime)}return O(U.counters,"visibilityHidden",y.visibilityHidden),O(U.attributes,"style",function(G){if(G)for(const ee of G){const J=ee.name.split("?")[0];if(o.i(J)){const se=J.split("/").slice(-2);if(se.length===2)return`mapbox://styles/${se[0]}/${se[1]}`}}}(v)),O(U.attributes,"terrainEnabled",y.terrainEnabled?"true":"false"),O(U.attributes,"fogEnabled",y.fogEnabled?"true":"false"),O(U.attributes,"projection",y.projection),O(U.attributes,"zoom",y.zoom),O(U.metadata,"devicePixelRatio",C),O(U.metadata,"connectionEffectiveType",D),O(U.metadata,"navigatorUserAgent",navigator.userAgent),O(U.metadata,"screenWidth",window.screen.width),O(U.metadata,"screenHeight",window.screen.height),O(U.metadata,"windowWidth",window.innerWidth),O(U.metadata,"windowHeight",window.innerHeight),O(U.metadata,"mapWidth",y.width/C),O(U.metadata,"mapHeight",y.height/C),O(U.metadata,"webglRenderer",y.renderer),O(U.metadata,"webglVendor",y.vendor),O(U.metadata,"sdkVersion",E),O(U.metadata,"sdkIdentifier","mapbox-gl-js"),U}(c);for(const y of f.metadata);for(const y of f.counters);for(const y of f.attributes);this.postEvent(r,f,()=>{},p)}},It=Xt.postPerformanceEvent.bind(Xt),Ns=new class extends Ot{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(p,r,c,f){if(!o.e.API_URL||!o.e.SESSION_PATH)return;const y=Vt(o.e.API_URL+o.e.SESSION_PATH);y.params.push(`sku=${r||""}`),y.params.push(`access_token=${f||o.e.ACCESS_TOKEN||""}`);const v={url:Bt(y),headers:{"Content-Type":"text/plain"}};this.pendingRequest=o.g(v,S=>{this.pendingRequest=null,c(S),this.saveEventData(),this.processRequests(f)})}getSessionAPI(p,r,c,f){this.skuToken=r,this.errorCb=f,o.e.SESSION_PATH&&o.e.API_URL&&(c||o.e.ACCESS_TOKEN?this.queueRequest({id:p,timestamp:Date.now()},c):this.errorCb(new Error(Dt)))}processRequests(p){if(this.pendingRequest||this.queue.length===0)return;const{id:r,timestamp:c}=this.queue.shift();r&&this.success[r]||this.getSession(c,this.skuToken,f=>{f?this.errorCb(f):r&&(this.success[r]=!0)},p)}remove(){this.errorCb=null}},ws=Ns.getSessionAPI.bind(Ns),tn=new Set;function cn(p,r){r?tn.add(p):tn.delete(p)}class wr{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(r,c){this._updatedSourceCaches[r]=c,this.setDirty()}discardSourceCacheUpdate(r){delete this._updatedSourceCaches[r]}updateLayer(r){const c=r.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(r.id),this.setDirty()}removeLayer(r){const c=r.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][r.id]=r,this._updatedLayers[c].delete(r.id),this._updatedPaintProps.delete(r.fqid),this.setDirty()}getRemovedLayer(r){return this._removedLayers[r.scope]?this._removedLayers[r.scope][r.id]:null}discardLayerRemoval(r){this._removedLayers[r.scope]&&delete this._removedLayers[r.scope][r.id]}getLayerUpdatesByScope(){const r={};for(const c in this._updatedLayers)r[c]=r[c]||{},r[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)r[c]=r[c]||{},r[c].removedIds=Object.keys(this._removedLayers[c]);return r}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(r){this._updatedPaintProps.add(r.fqid),this.setDirty()}getUpdatedImages(r){return this._updatedImages[r]?Array.from(this._updatedImages[r].values()):[]}updateImage(r,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(o.I.toString(r)),this.setDirty()}resetUpdatedImages(r){this._updatedImages[r]&&this._updatedImages[r].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function cr(p){const{userImage:r}=p;return!!(r&&r.render&&r.render())&&(p.data.replace(new Uint8Array(r.data.buffer)),!0)}class vn extends o.E{constructor(r){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=r,r!=="raster"&&o.t()&&(this.imageRasterizerDispatcher=new o.D(o.x(),this,"Image Rasterizer Worker",1))}addScope(r){this.loaded.set(r,!1),this.imageProviders.set(r,new Map),this.images.set(r,new Map),this.updatedImages.set(r,new Set),this.callbackDispatchedThisFrame.set(r,new Set),this.patterns.set(r,new Map),this.atlasImage.set(r,new o.r({width:1,height:1}))}removeScope(r){this.loaded.delete(r),this.imageProviders.delete(r),this.images.delete(r),this.updatedImages.delete(r),this.callbackDispatchedThisFrame.delete(r),this.patterns.delete(r),this.atlasImage.delete(r);const c=this.atlasTexture.get(r);c&&(c.destroy(),this.atlasTexture.delete(r))}addImageProvider(r,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(r.id,r)}removeImageProvider(r,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(r)}getPendingImageProviders(){const r=[];for(const c of this.imageProviders.values())for(const f of c.values())f.hasPendingRequests()&&r.push(f);return r}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new o.y),this._imageRasterizer}isLoaded(){for(const r of this.loaded.keys())if(!this.loaded.get(r))return!1;return!0}setLoaded(r,c){if(this.loaded.get(c)!==r&&(this.loaded.set(c,r),r)){for(const{ids:f,callback:y}of this.requestors)this._notify(f,c,y);this.requestors=[]}}hasImage(r,c){return!!this.getImage(r,c)}getImage(r,c){return this.images.get(c).get(r.toString())}addImage(r,c,f){this._validate(r,f)&&this.images.get(c).set(r.toString(),f)}_validate(r,c){let f=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchX" value`))),f=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "stretchY" value`))),f=!1),this._validateContent(c.content,c)||(this.fire(new o.z(new Error(`Image "${r.name}" has invalid "content" value`))),f=!1),f}_validateStretch(r,c){if(!r)return!0;let f=0;for(const y of r){if(y[0]<f||y[1]<y[0]||c<y[1])return!1;f=y[1]}return!0}_validateContent(r,c){return r?r.length!==4||!c.usvg&&(r[0]<0||c.data.width<r[0]||r[1]<0||c.data.height<r[1]||r[2]<0||c.data.width<r[2]||r[3]<0||c.data.height<r[3])?!1:!(r[2]<r[0]||r[3]<r[1]):!0}updateImage(r,c,f){const y=this.images.get(c).get(r.toString());f.version=y.version+1,this.images.get(c).set(r.toString(),f),this.updatedImages.get(c).add(r),this.removeFromImageRasterizerCache(r,c)}clearUpdatedImages(r){this.updatedImages.get(r).clear()}removeFromImageRasterizerCache(r,c){this.spriteFormat!=="raster"&&(o.t()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[r],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([r],c))}removeImage(r,c){const f=this.images.get(c),y=f.get(r.toString());f.delete(r.toString()),this.patterns.get(c).delete(r.toString()),this.removeFromImageRasterizerCache(r,c),y.userImage&&y.userImage.onRemove&&y.userImage.onRemove()}listImages(r){return Array.from(this.images.get(r).keys()).map(c=>o.I.from(c))}getImages(r,c,f){const y=[],v=[],S=this.imageProviders.get(c);for(const D of r){if(!D.iconsetId){y.push(D);continue}const U=S.get(D.iconsetId);U&&(this.getImage(D,c)?v.push(D):U.addPendingRequest(D))}if(y.length===0)return void this._notify(v,c,f);let N=!0;const C=!!this.loaded.get(c),k=this.images.get(c);if(!C)for(const D of y)k.has(D.toString())||(N=!1);C||N?this._notify(y,c,f):this.requestors.push({ids:y,scope:c,callback:f})}rasterizeImages(r,c){const f=new Map,{tasks:y,scope:v}=r;for(const[S,N]of y.entries()){const C=this.getImage(N.id,v);C&&f.set(S,{image:C,imageVariant:N})}this._rasterizeImages(v,f,c)}_rasterizeImages(r,c,f){if(o.t())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:r},f);else{const y=new Map;for(const[v,{image:S,imageVariant:N}]of c.entries())y.set(v,this.imageRasterizer.rasterize(N,S,r,0));f(void 0,y)}}getUpdatedImages(r){return this.updatedImages.get(r)||new Set}_notify(r,c,f){const y=this.images.get(c),v=new Map;for(const S of r){if(!y.get(S.toString())){if(S.iconsetId)continue;this.fire(new o.A("styleimagemissing",{id:S.name}))}const N=y.get(S.toString());if(!N){o.w(`Image "${S.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const C={data:N.usvg?null:N.data.clone(),pixelRatio:N.pixelRatio,sdf:N.sdf,usvg:N.usvg,version:N.version,stretchX:N.stretchX,stretchY:N.stretchY,content:N.content,hasRenderCallback:!!(N.userImage&&N.userImage.render)};N.usvg&&Object.assign(C,{width:N.icon.usvg_tree.width,height:N.icon.usvg_tree.height}),v.set(o.I.toString(S),C)}f(null,v)}getPixelSize(r){const{width:c,height:f}=this.atlasImage.get(r);return{width:c,height:f}}getPattern(r,c,f){const y=r.toString(),v=this.patterns.get(c),S=v.get(y),N=this.getImage(r,c);if(!N)return null;if(S){if(S.position.version===N.version)return S.position;S.position.version=N.version}else{if(N.usvg&&!N.data){const C=this.getPatternInFlightId(y,c);if(this.patternsInFlight.has(C))return null;this.patternsInFlight.add(C);const k=new o.B(r).scaleSelf(o.q.devicePixelRatio),D=new Map([[k.toString(),{image:N,imageVariant:k}]]);return this._rasterizeImages(c,D,(U,O)=>this.storePatternImage(k,c,N,f,O)),null}this.storePattern(r,c,N)}return this._updatePatternAtlas(c,f),v.get(y).position}getPatternInFlightId(r,c){return o.C(r,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(r,c,f,y,v){const S=r.toString(),N=v?v.get(S):void 0;N&&(f.data=N,this.storePattern(r.id,c,f),this._updatePatternAtlas(c,y),this.patternsInFlight.delete(this.getPatternInFlightId(r.id.toString(),c)))}storePattern(r,c,f){const y={w:f.data.width+2*o.F,h:f.data.height+2*o.F,x:0,y:0},v=new o.G(y,f,o.F);this.patterns.get(c).set(r.toString(),{bin:y,position:v})}destroyAtlasTextures(){for(const r of this.atlasTexture.values())r&&r.destroy();this.atlasTexture.clear()}bind(r,c){const f=r.gl;let y=this.atlasTexture.get(c);y?this.dirty&&(y.update(this.atlasImage.get(c)),this.dirty=!1):(y=new o.T(r,this.atlasImage.get(c),f.RGBA8),this.atlasTexture.set(c,y)),y.bind(f.LINEAR,f.CLAMP_TO_EDGE)}_updatePatternAtlas(r,c){const f=this.patterns.get(r),y=Array.from(f.values()).map(({bin:k})=>k),{w:v,h:S}=o.H(y),N=this.atlasImage.get(r);N.resize({width:v||1,height:S||1});const C=this.images.get(r);for(const[k,{bin:D,position:U}]of f.entries()){let O=U.padding;const G=D.x+O,ee=D.y+O,J=C.get(k).data,se=J.width,te=J.height;O=O>1?O-1:O,o.r.copy(J,N,{x:0,y:0},{x:G,y:ee},{width:se,height:te},c),o.r.copy(J,N,{x:0,y:te-O},{x:G,y:ee-O},{width:se,height:O},c),o.r.copy(J,N,{x:0,y:0},{x:G,y:ee+te},{width:se,height:O},c),o.r.copy(J,N,{x:se-O,y:0},{x:G-O,y:ee},{width:O,height:te},c),o.r.copy(J,N,{x:0,y:0},{x:G+se,y:ee},{width:O,height:te},c),o.r.copy(J,N,{x:se-O,y:te-O},{x:G-O,y:ee-O},{width:O,height:O},c),o.r.copy(J,N,{x:0,y:te-O},{x:G+se,y:ee-O},{width:O,height:O},c),o.r.copy(J,N,{x:0,y:0},{x:G+se,y:ee+te},{width:O,height:O},c),o.r.copy(J,N,{x:se-O,y:0},{x:G-O,y:ee+te},{width:O,height:O},c)}this.dirty=!0}beginFrame(){for(const r of this.images.keys())this.callbackDispatchedThisFrame.set(r,new Set)}dispatchRenderCallbacks(r,c){const f=this.images.get(c);for(const y of r){if(this.callbackDispatchedThisFrame.get(c).has(y.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(y.toString());const v=f.get(y.toString());cr(v)&&this.updateImage(y,c,v)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Js(p){const r=p.key,c=p.value,f=p.valueSpec||{},y=p.objectElementValidators||{},v=p.style,S=p.styleSpec;let N=[];const C=o.J(c);if(C!=="object")return[new o.V(r,c,`object expected, ${C} found`)];for(const k in c){const D=k.split(".")[0];let U;y[D]?U=y[D]:f[D]?U=sr:y["*"]?U=y["*"]:f["*"]&&(U=sr),U?N=N.concat(U({key:(r&&`${r}.`)+k,value:c[k],valueSpec:f[D]||f["*"],style:v,styleSpec:S,object:c,objectKey:k},c)):N.push(new o.K(r,c[k],`unknown property "${k}"`))}for(const k in f)y[k]||f[k].required&&f[k].default===void 0&&c[k]===void 0&&N.push(new o.V(r,c,`missing required property "${k}"`));return N}function Rr(p){const r=p.value,c=p.valueSpec,f=p.style,y=p.styleSpec,v=p.key,S=p.arrayElementValidator||sr;if(o.J(r)!=="array")return[new o.V(v,r,`array expected, ${o.J(r)} found`)];if(c.length&&r.length!==c.length)return[new o.V(v,r,`array length ${c.length} expected, length ${r.length} found`)];if(c["min-length"]&&r.length<c["min-length"])return[new o.V(v,r,`array length at least ${c["min-length"]} expected, length ${r.length} found`)];let N={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};y.$version<7&&(N.function=c.function),o.J(c.value)==="object"&&(N=c.value);let C=[];for(let k=0;k<r.length;k++)C=C.concat(S({array:r,arrayIndex:k,value:r[k],valueSpec:N,style:f,styleSpec:y,key:`${v}[${k}]`},!0));return C}function Jo(p){const r=p.key,c=p.value,f=p.valueSpec;let y=o.J(c);if(y==="number"&&c!=c&&(y="NaN"),y!=="number")return[new o.V(r,c,`number expected, ${y} found`)];if("minimum"in f){let v=f.minimum;if(o.J(f.minimum)==="array"&&(v=f.minimum[p.arrayIndex]),c<v)return[new o.V(r,c,`${c} is less than the minimum value ${v}`)]}if("maximum"in f){let v=f.maximum;if(o.J(f.maximum)==="array"&&(v=f.maximum[p.arrayIndex]),c>v)return[new o.V(r,c,`${c} is greater than the maximum value ${v}`)]}return[]}function ao(p){const r=p.valueSpec,c=o.M(p.value.type);let f,y,v,S={};const N=c!=="categorical"&&p.value.property===void 0,C=!N,k=o.J(p.value.stops)==="array"&&o.J(p.value.stops[0])==="array"&&o.J(p.value.stops[0][0])==="object",D=Js({key:p.key,value:p.value,valueSpec:p.styleSpec.function,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{stops:function(G){if(c==="identity")return[new o.V(G.key,G.value,'identity function may not have a "stops" property')];let ee=[];const J=G.value;return ee=ee.concat(Rr({key:G.key,value:J,valueSpec:G.valueSpec,style:G.style,styleSpec:G.styleSpec,arrayElementValidator:U})),o.J(J)==="array"&&J.length===0&&ee.push(new o.V(G.key,J,"array must have at least one stop")),ee},default:function(G){return sr({key:G.key,value:G.value,valueSpec:r,style:G.style,styleSpec:G.styleSpec})}}});return c==="identity"&&N&&D.push(new o.V(p.key,p.value,'missing required property "property"')),c==="identity"||p.value.stops||D.push(new o.V(p.key,p.value,'missing required property "stops"')),c==="exponential"&&p.valueSpec.expression&&!o.N(p.valueSpec)&&D.push(new o.V(p.key,p.value,"exponential functions not supported")),p.styleSpec.$version>=8&&(C&&!o.O(p.valueSpec)?D.push(new o.V(p.key,p.value,"property functions not supported")):N&&!o.Q(p.valueSpec)&&D.push(new o.V(p.key,p.value,"zoom functions not supported"))),c!=="categorical"&&!k||p.value.property!==void 0||D.push(new o.V(p.key,p.value,'"property" property is required')),D;function U(G){let ee=[];const J=G.value,se=G.key;if(o.J(J)!=="array")return[new o.V(se,J,`array expected, ${o.J(J)} found`)];if(J.length!==2)return[new o.V(se,J,`array length 2 expected, length ${J.length} found`)];if(k){if(o.J(J[0])!=="object")return[new o.V(se,J,`object expected, ${o.J(J[0])} found`)];if(J[0].zoom===void 0)return[new o.V(se,J,"object stop key must have zoom")];if(J[0].value===void 0)return[new o.V(se,J,"object stop key must have value")];const te=o.M(J[0].zoom);if(typeof te!="number")return[new o.V(se,J[0].zoom,"stop zoom values must be numbers")];if(v&&v>te)return[new o.V(se,J[0].zoom,"stop zoom values must appear in ascending order")];te!==v&&(v=te,y=void 0,S={}),ee=ee.concat(Js({key:`${se}[0]`,value:J[0],valueSpec:{zoom:{}},style:G.style,styleSpec:G.styleSpec,objectElementValidators:{zoom:Jo,value:O}}))}else ee=ee.concat(O({key:`${se}[0]`,value:J[0],style:G.style,styleSpec:G.styleSpec},J));return o.S(o.U(J[1]))?ee.concat([new o.V(`${se}[1]`,J[1],"expressions are not allowed in function stops.")]):ee.concat(sr({key:`${se}[1]`,value:J[1],valueSpec:r,style:G.style,styleSpec:G.styleSpec}))}function O(G,ee){const J=o.J(G.value),se=o.M(G.value),te=G.value!==null?G.value:ee;if(f){if(J!==f)return[new o.V(G.key,te,`${J} stop domain type must match previous stop domain type ${f}`)]}else f=J;if(J!=="number"&&J!=="string"&&J!=="boolean"&&typeof se!="number"&&typeof se!="string"&&typeof se!="boolean")return[new o.V(G.key,te,"stop domain value must be a number, string, or boolean")];if(J!=="number"&&c!=="categorical"){let le=`number expected, ${J} found`;return o.O(r)&&c===void 0&&(le+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new o.V(G.key,te,le)]}return c!=="categorical"||J!=="number"||typeof se=="number"&&isFinite(se)&&Math.floor(se)===se?c!=="categorical"&&J==="number"&&typeof se=="number"&&typeof y=="number"&&y!==void 0&&se<y?[new o.V(G.key,te,"stop domain values must appear in ascending order")]:(y=se,c==="categorical"&&se in S?[new o.V(G.key,te,"stop domain values must be unique")]:(S[se]=!0,[])):[new o.V(G.key,te,`integer expected, found ${String(se)}`)]}}function lo(p){const r=(p.expressionContext==="property"?o.W:o.X)(o.U(p.value),p.valueSpec);if(r.result==="error")return r.value.map(f=>new o.V(`${p.key}${f.key}`,p.value,f.message));const c=r.value.expression||r.value._styleExpression.expression;if(p.expressionContext==="property"&&p.propertyKey==="text-font"&&!c.outputDefined())return[new o.V(p.key,p.value,`Invalid data expression for "${p.propertyKey}". Output values must be contained as literals within the expression.`)];if(p.expressionContext==="property"&&p.propertyType==="layout"&&!o.Y(c))return[new o.V(p.key,p.value,'"feature-state" data expressions are not supported with layout properties.')];if(p.expressionContext==="filter")return gi(c,p);if(p.expressionContext&&p.expressionContext.indexOf("cluster")===0){if(!o.Z(c,["zoom","feature-state"]))return[new o.V(p.key,p.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(p.expressionContext==="cluster-initial"&&!o._(c))return[new o.V(p.key,p.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function gi(p,r){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(r.valueSpec&&r.valueSpec.expression)for(const y of r.valueSpec.expression.parameters)c.delete(y);if(c.size===0)return[];const f=[];return p instanceof o.$&&c.has(p.name)?[new o.V(r.key,r.value,`["${p.name}"] expression is not supported in a filter for a ${r.object.type} layer with id: ${r.object.id}`)]:(p.eachChild(y=>{f.push(...gi(y,r))}),f)}function va(p){const r=p.key,c=p.value,f=p.valueSpec,y=[];return Array.isArray(f.values)?f.values.indexOf(o.M(c))===-1&&y.push(new o.V(r,c,`expected one of [${f.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(f.values).indexOf(o.M(c))===-1&&y.push(new o.V(r,c,`expected one of [${Object.keys(f.values).join(", ")}], ${JSON.stringify(c)} found`)),y}function Ki(p){return o.a1(o.U(p.value))?lo(o.L({},p,{expressionContext:"filter",valueSpec:p.styleSpec[`filter_${p.layerType||"fill"}`]})):Rl(p)}function Rl(p){const r=p.value,c=p.key;if(o.J(r)!=="array")return[new o.V(c,r,`array expected, ${o.J(r)} found`)];const f=p.styleSpec;let y,v=[];if(r.length<1)return[new o.V(c,r,"filter array must have at least 1 element")];switch(v=v.concat(va({key:`${c}[0]`,value:r[0],valueSpec:f.filter_operator,style:p.style,styleSpec:p.styleSpec})),o.M(r[0])){case"<":case"<=":case">":case">=":r.length>=2&&o.M(r[1])==="$type"&&v.push(new o.V(c,r,`"$type" cannot be use with operator "${r[0]}"`));case"==":case"!=":r.length!==3&&v.push(new o.V(c,r,`filter array for operator "${r[0]}" must have 3 elements`));case"in":case"!in":r.length>=2&&(y=o.J(r[1]),y!=="string"&&v.push(new o.V(`${c}[1]`,r[1],`string expected, ${y} found`)));for(let S=2;S<r.length;S++)y=o.J(r[S]),o.M(r[1])==="$type"?v=v.concat(va({key:`${c}[${S}]`,value:r[S],valueSpec:f.geometry_type,style:p.style,styleSpec:p.styleSpec})):y!=="string"&&y!=="number"&&y!=="boolean"&&v.push(new o.V(`${c}[${S}]`,r[S],`string, number, or boolean expected, ${y} found`));break;case"any":case"all":case"none":for(let S=1;S<r.length;S++)v=v.concat(Rl({key:`${c}[${S}]`,value:r[S],style:p.style,styleSpec:p.styleSpec}));break;case"has":case"!has":y=o.J(r[1]),r.length!==2?v.push(new o.V(c,r,`filter array for "${r[0]}" operator must have 2 elements`)):y!=="string"&&v.push(new o.V(`${c}[1]`,r[1],`string expected, ${y} found`))}return v}function hc(p,r){const c=p.key,f=p.style,y=p.layer,v=p.styleSpec,S=p.value,N=p.objectKey,C=v[`${r}_${p.layerType}`];if(!C)return[];const k=N.match(/^(.*)-use-theme$/);if(r==="paint"&&k&&C[k[1]])return o.S(S)?[].concat(sr({key:p.key,value:S,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:N})):sr({key:c,value:S,valueSpec:{type:"string"},style:f,styleSpec:v});const D=N.match(/^(.*)-transition$/);if(r==="paint"&&D&&C[D[1]]&&C[D[1]].transition)return sr({key:c,value:S,valueSpec:v.transition,style:f,styleSpec:v});const U=p.valueSpec||C[N];if(!U)return[new o.K(c,S,`unknown property "${N}"`)];let O;if(o.J(S)==="string"&&o.O(U)&&!U.tokens&&(O=/^{([^}]+)}$/.exec(S))){const ee=`\`{ "type": "identity", "property": ${O?JSON.stringify(O[1]):'"_"'} }\``;return[new o.V(c,S,`"${N}" does not support interpolation syntax
Use an identity property function instead: ${ee}.`)]}const G=[];if(p.layerType==="symbol")N!=="text-field"||!f||f.glyphs||f.imports||G.push(new o.V(c,S,'use of "text-field" requires a style "glyphs" property')),N==="text-font"&&o.a2(o.U(S))&&o.M(S.type)==="identity"&&G.push(new o.V(c,S,'"text-font" does not support identity functions'));else if(p.layerType==="model"&&r==="paint"&&y&&y.layout&&y.layout.hasOwnProperty("model-id")&&o.O(U)&&(o.a3(U)||o.Q(U))){const ee=o.W(o.U(S),U),J=ee.value.expression||ee.value._styleExpression.expression;J&&!o.Z(J,["measure-light"])&&(N==="model-emissive-strength"&&o._(J)&&o.Y(J)||G.push(new o.V(c,S,`${N} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return G.concat(sr({key:p.key,value:S,valueSpec:U,style:f,styleSpec:v,expressionContext:"property",propertyType:r,propertyKey:N}))}function kr(p){return hc(p,"paint")}function xi(p){return hc(p,"layout")}function du(p){let r=[];const c=p.value,f=p.key,y=p.style,v=p.styleSpec;c.type||c.ref||r.push(new o.V(f,c,'either "type" or "ref" is required'));let S=o.M(c.type);const N=o.M(c.ref);if(c.id){const C=o.M(c.id);for(let k=0;k<p.arrayIndex;k++){const D=y.layers[k];o.M(D.id)===C&&r.push(new o.V(f,c.id,`duplicate layer id "${c.id}", previously used at line ${D.id.__line__}`))}}if("ref"in c){let C;["type","source","source-layer","filter","layout"].forEach(k=>{k in c&&r.push(new o.V(f,c[k],`"${k}" is prohibited for ref layers`))}),y.layers.forEach(k=>{o.M(k.id)===N&&(C=k)}),C?C.ref?r.push(new o.V(f,c.ref,"ref cannot reference another ref layer")):S=o.M(C.type):typeof N=="string"&&r.push(new o.V(f,c.ref,`ref layer "${N}" not found`))}else if(S!=="background"&&S!=="sky"&&S!=="slot")if(c.source){const C=y.sources&&y.sources[c.source],k=C&&o.M(C.type);C?k==="vector"&&S==="raster"?r.push(new o.V(f,c.source,`layer "${c.id}" requires a raster source`)):k==="raster"&&S!=="raster"?r.push(new o.V(f,c.source,`layer "${c.id}" requires a vector source`)):k!=="vector"||c["source-layer"]?k==="raster-dem"&&S!=="hillshade"?r.push(new o.V(f,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):k!=="raster-array"||["raster","raster-particle"].includes(S)?S==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&k==="geojson"&&!C.lineMetrics?r.push(new o.V(f,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):S==="raster-particle"&&k!=="raster-array"&&r.push(new o.V(f,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):r.push(new o.V(f,c.source,"raster-array source can only be used with layer type 'raster'.")):r.push(new o.V(f,c,`layer "${c.id}" must specify a "source-layer"`)):r.push(new o.V(f,c.source,`source "${c.source}" not found`))}else r.push(new o.V(f,c,'missing required property "source"'));return r=r.concat(Js({key:f,value:c,valueSpec:v.layer,style:p.style,styleSpec:p.styleSpec,objectElementValidators:{"*":()=>[],type:()=>sr({key:`${f}.type`,value:c.type,valueSpec:v.layer.type,style:p.style,styleSpec:p.styleSpec,object:c,objectKey:"type"}),filter:C=>Ki(o.L({layerType:S},C)),layout:C=>Js({layer:c,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>xi(o.L({layerType:S},k))}}),paint:C=>Js({layer:c,key:C.key,value:C.value,valueSpec:{},style:C.style,styleSpec:C.styleSpec,objectElementValidators:{"*":k=>kr(o.L({layerType:S,layer:c},k))}})}})),r}function Ba(p){const r=p.value,c=p.key,f=o.J(r);return f!=="string"?[new o.V(c,r,`string expected, ${f} found`)]:[]}const Va={promoteId:function p({key:r,value:c}){if(o.J(c)==="string")return Ba({key:r,value:c});if(Array.isArray(c)){const f=[],y=o.U(c),v=o.X(y);return v.result==="error"&&v.value.forEach(S=>{f.push(new o.V(`${r}${S.key}`,null,`${S.message}`))}),o.Z(v.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||f.push(new o.V(`${r}`,null,"promoteId expression should be only feature dependent")),f}{const f=[];for(const y in c)f.push(...p({key:`${r}.${y}`,value:c[y]}));return f}}};function Pi(p){const r=p.value,c=p.key,f=p.styleSpec,y=p.style;if(!r.type)return[new o.V(c,r,'"type" is required')];const v=o.M(r.type);let S=[];switch(["vector","raster","raster-dem","raster-array"].includes(v)&&(r.url||r.tiles||S.push(new o.K(c,r,'Either "url" or "tiles" is required.'))),v){case"vector":case"raster":case"raster-dem":case"raster-array":return S=S.concat(Js({key:c,value:r,valueSpec:f[`source_${v.replace("-","_")}`],style:p.style,styleSpec:f,objectElementValidators:Va})),S;case"geojson":if(S=Js({key:c,value:r,valueSpec:f.source_geojson,style:y,styleSpec:f,objectElementValidators:Va}),r.cluster)for(const N in r.clusterProperties){const[C,k]=r.clusterProperties[N],D=typeof C=="string"?[C,["accumulated"],["get",N]]:C;S.push(...lo({key:`${c}.${N}.map`,value:k,expressionContext:"cluster-map"})),S.push(...lo({key:`${c}.${N}.reduce`,value:D,expressionContext:"cluster-reduce"}))}return S;case"video":return Js({key:c,value:r,valueSpec:f.source_video,style:y,styleSpec:f});case"image":return Js({key:c,value:r,valueSpec:f.source_image,style:y,styleSpec:f});case"canvas":return[new o.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return va({key:`${c}.type`,value:r.type,valueSpec:{values:co(f)}})}}function co(p){return p.source.reduce((r,c)=>{const f=p[c];return f.type.type==="enum"&&(r=r.concat(Object.keys(f.type.values))),r},[])}function ba(p){const r=p.value,c=p.styleSpec,f=c.light,y=p.style;let v=[];const S=o.J(r);if(r===void 0)return v;if(S!=="object")return v=v.concat([new o.V("light",r,`object expected, ${S} found`)]),v;for(const N in r){const C=N.match(/^(.*)-transition$/),k=N.match(/^(.*)-use-theme$/);v=v.concat(k&&f[k[1]]?sr({key:N,value:r[N],valueSpec:{type:"string"},style:y,styleSpec:c}):C&&f[C[1]]&&f[C[1]].transition?sr({key:N,value:r[N],valueSpec:c.transition,style:y,styleSpec:c}):f[N]?sr({key:N,value:r[N],valueSpec:f[N],style:y,styleSpec:c}):[new o.V(N,r[N],`unknown property "${N}"`)])}return v}function uo(p){const r=p.value;let c=[];if(!r)return c;const f=o.J(r);if(f!=="object")return c=c.concat([new o.V("light-3d",r,`object expected, ${f} found`)]),c;const y=p.styleSpec,v=y["light-3d"],S=p.key,N=p.style,C=p.style.lights;for(const U of["type","id"])if(!(U in r))return c=c.concat([new o.V("light-3d",r,`missing property ${U} on light`)]),c;if(r.type&&C)for(let U=0;U<p.arrayIndex;U++){const O=o.M(r.type),G=C[U];o.M(G.type)===O&&c.push(new o.V(S,r.id,`duplicate light type "${r.type}", previously defined at line ${G.id.__line__}`))}const k=`properties_light_${r.type}`;if(!(k in y))return c=c.concat([new o.V("light-3d",r,`Invalid light type ${r.type}`)]),c;const D=y[k];for(const U in r)if(U==="properties"){const O=r[U],G=o.J(O);if(G!=="object")return c=c.concat([new o.V("properties",O,`object expected, ${G} found`)]),c;for(const ee in O){const J=ee.match(/^(.*)-transition$/),se=ee.match(/^(.*)-use-theme$/);c=c.concat(se&&D[se[1]]?sr({key:U,value:O[ee],valueSpec:{type:"string"},style:N,styleSpec:y}):J&&D[J[1]]&&D[J[1]].transition?sr({key:U,value:r[U],valueSpec:y.transition,style:N,styleSpec:y}):D[ee]?sr({key:ee,value:O[ee],valueSpec:D[ee],style:N,styleSpec:y}):[new o.K(p.key,O[ee],`unknown property "${ee}"`)])}}else c=c.concat(v[U]?sr({key:U,value:r[U],valueSpec:v[U],style:N,styleSpec:y}):[new o.K(U,r[U],`unknown property "${U}"`)]);return c}function Ua(p){const r=p.value,c=p.key,f=p.style,y=p.styleSpec,v=y.terrain;let S=[];const N=o.J(r);if(r===void 0||N==="null")return S;if(N!=="object")return S=S.concat([new o.V("terrain",r,`object expected, ${N} found`)]),S;for(const C in r){const k=C.match(/^(.*)-transition$/),D=C.match(/^(.*)-use-theme$/);S=S.concat(D&&v[D[1]]?sr({key:C,value:r[C],valueSpec:{type:"string"},style:f,styleSpec:y}):k&&v[k[1]]&&v[k[1]].transition?sr({key:C,value:r[C],valueSpec:y.transition,style:f,styleSpec:y}):v[C]?sr({key:C,value:r[C],valueSpec:v[C],style:f,styleSpec:y}):[new o.K(C,r[C],`unknown property "${C}"`)])}if(r.source){const C=f.sources&&f.sources[r.source],k=C&&o.M(C.type);C?k!=="raster-dem"&&S.push(new o.V(c,r.source,`terrain cannot be used with a source of type ${String(k)}, it only be used with a "raster-dem" source type`)):S.push(new o.V(c,r.source,`source "${r.source}" not found`))}else S.push(new o.V(c,r,'terrain is missing required property "source"'));return S}function So(p){const r=p.value,c=p.style,f=p.styleSpec,y=f.fog;let v=[];const S=o.J(r);if(r===void 0)return v;if(S!=="object")return v=v.concat([new o.V("fog",r,`object expected, ${S} found`)]),v;for(const N in r){const C=N.match(/^(.*)-transition$/),k=N.match(/^(.*)-use-theme$/);v=v.concat(k&&y[k[1]]?sr({key:N,value:r[N],valueSpec:{type:"string"},style:c,styleSpec:f}):C&&y[C[1]]&&y[C[1]].transition?sr({key:N,value:r[N],valueSpec:f.transition,style:c,styleSpec:f}):y[N]?sr({key:N,value:r[N],valueSpec:y[N],style:c,styleSpec:f}):[new o.K(N,r[N],`unknown property "${N}"`)])}return v}const pc={"*":()=>[],array:Rr,boolean:function(p){const r=p.value,c=p.key,f=o.J(r);return f!=="boolean"?[new o.V(c,r,`boolean expected, ${f} found`)]:[]},number:Jo,color:function(p){const r=p.key,c=p.value,f=o.J(c);return f!=="string"?[new o.V(r,c,`color expected, ${f} found`)]:o.a0.parseCSSColor(c)===null?[new o.V(r,c,`color expected, "${c}" found`)]:[]},enum:va,filter:Ki,function:ao,layer:du,object:Js,source:Pi,model:o.a4,light:ba,"light-3d":uo,terrain:Ua,fog:So,string:Ba,formatted:function(p){return Ba(p).length===0?[]:lo(p)},resolvedImage:function(p){return Ba(p).length===0?[]:lo(p)},projection:function(p){const r=p.value,c=p.styleSpec,f=c.projection,y=p.style;let v=[];const S=o.J(r);if(S==="object")for(const N in r)v=v.concat(sr({key:N,value:r[N],valueSpec:f[N],style:y,styleSpec:c}));else S!=="string"&&(v=v.concat([new o.V("projection",r,`object or string expected, ${S} found`)]));return v},import:function(p){const{value:r,styleSpec:c}=p,{data:f,...y}=r;Object.defineProperty(y,"__line__",{value:r.__line__,enumerable:!1});let v=Js(o.L({},p,{value:y,valueSpec:c.import}));return o.M(y.id)===""&&v.push(new o.V(`${p.key}.id`,y,"import id can't be an empty string")),f&&(v=v.concat(mc(f,c,{key:`${p.key}.data`}))),v},iconset:function(p){const r=p.value,c=p.key,f=p.styleSpec,y=p.style;if(!r.type)return[new o.V(c,r,'"type" is required')];const v=o.M(r.type);let S=[];if(S=S.concat(Js({key:c,value:r,valueSpec:f[`iconset_${v}`],style:y,styleSpec:f})),v==="source"&&r.source){const N=y.sources&&y.sources[r.source],C=N&&o.M(N.type);N?C!=="raster-array"&&S.push(new o.V(c,r.source,`iconset cannot be used with a source of type ${String(C)}, it only be used with a "raster-array" source type`)):S.push(new o.V(c,r.source,`source "${r.source}" not found`))}return S}};function sr(p,r=!1){const c=p.value,f=p.valueSpec,y=p.styleSpec;if(f.expression&&o.a2(o.M(c)))return ao(p);if(f.expression&&o.S(o.U(c)))return lo(p);if(f.type&&pc[f.type]){const v=pc[f.type](p);return r===!0&&v.length>0&&o.J(p.value)==="array"?lo(p):v}return Js(o.L({},p,{valueSpec:f.type?y[f.type]:f}))}function fc(p){const r=p.value,c=p.key,f=Ba(p);return f.length||(r.indexOf("{fontstack}")===-1&&f.push(new o.V(c,r,'"glyphs" url must include a "{fontstack}" token')),r.indexOf("{range}")===-1&&f.push(new o.V(c,r,'"glyphs" url must include a "{range}" token'))),f}function mc(p,r=o.a5,c={}){return sr({key:c.key||"",value:p,valueSpec:r.$root,styleSpec:r,style:p,objectElementValidators:{glyphs:fc,"*":()=>[]}})}function jo(p,r=o.a5){return Ce(mc(p,r))}const kl=p=>Ce(Pi(p)),wa=p=>Ce(ba(p)),gc=p=>Ce(uo(p)),et=p=>Ce(Ua(p)),er=p=>Ce(So(p)),Dr=p=>Ce(function(r){const c=r.value,f=r.style,y=r.styleSpec,v=y.snow;let S=[];const N=o.J(c);if(c===void 0)return S;if(N!=="object")return S=S.concat([new o.V("snow",c,`object expected, ${N} found`)]),S;for(const C in c){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&v[k[1]]&&v[k[1]].transition?sr({key:C,value:c[C],valueSpec:y.transition,style:f,styleSpec:y}):v[C]?sr({key:C,value:c[C],valueSpec:v[C],style:f,styleSpec:y}):[new o.K(C,c[C],`unknown property "${C}"`)])}return S}(p)),Xi=p=>Ce(function(r){const c=r.value,f=r.style,y=r.styleSpec,v=y.rain;let S=[];const N=o.J(c);if(c===void 0)return S;if(N!=="object")return S=S.concat([new o.V("rain",c,`object expected, ${N} found`)]),S;for(const C in c){const k=C.match(/^(.*)-transition$/);S=S.concat(k&&v[k[1]]&&v[k[1]].transition?sr({key:C,value:c[C],valueSpec:y.transition,style:f,styleSpec:y}):v[C]?sr({key:C,value:c[C],valueSpec:v[C],style:f,styleSpec:y}):[new o.K(C,c[C],`unknown property "${C}"`)])}return S}(p)),Ks=p=>Ce(du(p)),Be=p=>Ce(Ki(p)),ne=p=>Ce(kr(p)),ie=p=>Ce(xi(p)),fe=p=>Ce(o.a4(p));function Ce(p){return p.slice().sort((r,c)=>r.line&&c.line?r.line-c.line:0)}function xe(p,r){let c=!1;if(r&&r.length)for(const f of r)f instanceof o.K?o.w(f.message):(p.fire(new o.z(new Error(f.message))),c=!0);return c}let Re;class qe extends o.E{constructor(r,c="flat"){super(),this._transitionable=new o.a6(Re||(Re=new o.a7({anchor:new o.a8(o.a5.light.anchor),position:new o.a9(o.a5.light.position),color:new o.a8(o.a5.light.color),intensity:new o.a8(o.a5.light.intensity)}))),this.setLight(r,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(r,c,f={}){this._validate(wa,r,f)||(this._transitionable.setTransitionOrValue(r),this.id=c)}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,f){return(!f||f.validate!==!1)&&xe(this,r.call(jo,o.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let De=class extends o.E{constructor(p,r,c,f,y){super(),this.scope=c,this._transitionable=new o.a6(new o.a7({source:new o.a8(o.a5.terrain.source),exaggeration:new o.a8(o.a5.terrain.exaggeration)}),c,f),this._transitionable.setTransitionOrValue(p,f),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=r,this.worldview=y}get(){return this._transitionable.serialize()}set(p,r){this._transitionable.setTransitionOrValue(p,r)}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}getExaggeration(p){return this._transitioning.possiblyEvaluate(new o.aa(p,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const p=this._transitionable._values.exaggeration;if(!p)return null;const r=p.value.expression;if(!r)return null;let c=-1,f=-1,y=1;for(const v of r.zoomStops)y=r.evaluate(new o.aa(v,{worldview:this.worldview})),y>.01?(c=v,f=-1):f=v;return y<.01&&c>0&&f>c?[c,f]:null}isZoomDependent(){const p=this._transitionable._values.exaggeration;return p!=null&&p.value!=null&&p.value.expression!=null&&p.value.expression instanceof o.ab}};const He=45,Et=65,ut=.05;function hs(p,r,c,f){const y=o.af(He,Et,c),[v,S]=Ts(p,f);let N=1-Math.min(1,Math.exp((r-v)/(S-v)*-6));return N*=N*N,N=Math.min(1,1.00747*N),N*y*p.alpha}function Ts(p,r){const c=.5/Math.tan(.5*r);return[p.range[0]+c,p.range[1]+c]}function Is(p,r,c,f,y){const v=o.ad([],[r,c,f],y.mercatorFogMatrix);return hs(p,o.ae(v),y.pitch,y._fov)}function sn(p,r,c,f,y,v,S){const N=[[c,f,0],[y,f,0],[y,v,0],[c,v,0]];let C=Number.MAX_VALUE,k=-Number.MAX_VALUE;for(const D of N){const U=o.ad([],D,r),O=o.ae(U);C=Math.min(C,O),k=Math.max(k,O)}return[hs(p,C,S.pitch,S._fov),hs(p,k,S.pitch,S._fov)]}class Hs extends o.E{constructor(r,c,f,y){super();const v=new o.a7({range:new o.a8(o.a5.fog.range),color:new o.a8(o.a5.fog.color),"color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"high-color":new o.a8(o.a5.fog["high-color"]),"high-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"space-color":new o.a8(o.a5.fog["space-color"]),"space-color-use-theme":new o.a8({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new o.a8(o.a5.fog["horizon-blend"]),"star-intensity":new o.a8(o.a5.fog["star-intensity"]),"vertical-range":new o.a8(o.a5.fog["vertical-range"])});this._transitionable=new o.a6(v,f,new Map(y)),this.set(r,y),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new o.ag(v),this.scope=f}get state(){const r=this._transform,c=r.projection.name==="globe",f=o.ah(r.zoom),y=this.properties.get("range"),v=[.5,3];return{range:c?[o.ai(v[0],y[0],f),o.ai(v[1],y[1],f)]:y,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(r,c,f={}){if(this._validate(er,r,f))return;const y=o.h({},r);for(const v of Object.keys(o.a5.fog))y[v]===void 0&&(y[v]=o.a5.fog[v].default);this._options=y,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(r){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:o.af(He,Et,r))*c.a}getOpacityAtLatLng(r,c){return this._transform.projection.supportsFog?function(f,y,v){const S=o.ac.fromLngLat(y),N=v.elevation?v.elevation.getAtPointOrZero(S):0;return Is(f,S.x,S.y,N,v)}(this.state,r,c):0}getOpacityForTile(r){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(r.toUnwrapped());return sn(this.state,c,0,0,o.aj,o.aj,this._transform)}getOpacityForBounds(r,c,f,y,v){return this._transform.projection.supportsFog?sn(this.state,r,c,f,y,v,this._transform):[1,1]}getFovAdjustedRange(r){return this._transform.projection.supportsFog?Ts(this.state,r):[0,1]}isVisibleOnFrustum(r){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const f of c){const y=r.points[f];let v;if(y[2]>=0)v=y;else{const S=r.points[f-4];v=o.ak(S,y,S[2]/(S[2]-y[2]))}if(Is(this.state,v[0],v[1],0,this._transform)>=ut)return!0}return!1}updateConfig(r){this._transitionable.setTransitionOrValue(this._options,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}_validate(r,c,f){return(!f||f.validate!==!1)&&xe(this,r.call(jo,o.h({value:c,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}}let nn,Kn,rn,Ar,Yr=class extends o.E{constructor(p,r,c,f){super();const y=nn||(nn=new o.a7({density:new o.a8(o.a5.snow.density),intensity:new o.a8(o.a5.snow.intensity),color:new o.a8(o.a5.snow.color),opacity:new o.a8(o.a5.snow.opacity),vignette:new o.a8(o.a5.snow.vignette),"vignette-color":new o.a8(o.a5.snow["vignette-color"]),"center-thinning":new o.a8(o.a5.snow["center-thinning"]),direction:new o.a8(o.a5.snow.direction),"flake-size":new o.a8(o.a5.snow["flake-size"])}));this._transitionable=new o.a6(y,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=c}get state(){const p=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),f=o.al(c[0]),y=-Math.max(o.al(c[1]),.01),v=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette"),N=this.properties.get("vignette-color");return N.a=S,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*p),direction:v,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:N}}get(){return this._transitionable.serialize()}set(p,r,c={}){if(this._validate(Dr,p,c))return;const f=o.h({},p);for(const y of Object.keys(o.a5.snow))f[y]===void 0&&(f[y]=o.a5.snow[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,r,c){return(!c||c.validate!==!1)&&xe(this,p.call(jo,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}},$r=class extends o.E{constructor(p,r,c,f){super();const y=Kn||(Kn=new o.a7({density:new o.a8(o.a5.rain.density),intensity:new o.a8(o.a5.rain.intensity),color:new o.a8(o.a5.rain.color),opacity:new o.a8(o.a5.rain.opacity),vignette:new o.a8(o.a5.rain.vignette),"vignette-color":new o.a8(o.a5.rain["vignette-color"]),"center-thinning":new o.a8(o.a5.rain["center-thinning"]),direction:new o.a8(o.a5.rain.direction),"droplet-size":new o.a8(o.a5.rain["droplet-size"]),"distortion-strength":new o.a8(o.a5.rain["distortion-strength"])}));this._transitionable=new o.a6(y,c,new Map(f)),this.set(p,f),this._transitioning=this._transitionable.untransitioned(),this.properties=new o.ag(y),this.scope=c}get state(){const p=this.properties.get("opacity"),r=this.properties.get("color"),c=this.properties.get("direction"),f=o.al(c[0]),y=-Math.max(o.al(c[1]),.01),v=[Math.cos(f)*Math.cos(y),Math.sin(f)*Math.cos(y),Math.sin(y)],S=this.properties.get("vignette-color");return S.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new o.am(r.r,r.g,r.b,r.a*p),direction:v,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:S}}get(){return this._transitionable.serialize()}set(p,r,c={}){if(this._validate(Xi,p,c))return;const f=o.h({},p);for(const y of Object.keys(o.a5.rain))f[y]===void 0&&(f[y]=o.a5.rain[y].default);this._options=f,this._transitionable.setTransitionOrValue(this._options,r)}updateConfig(p){this._transitionable.setTransitionOrValue(this._options,new Map(p))}updateTransitions(p){this._transitioning=this._transitionable.transitioned(p,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(p){this.properties=this._transitioning.possiblyEvaluate(p)}_validate(p,r,c){return(!c||c.validate!==!1)&&xe(this,p.call(jo,o.h({value:r,style:{glyphs:!0,sprite:!0},styleSpec:o.a5})))}};class Ln extends o.E{constructor(r,c,f,y){super(),this.scope=f,this._options=r,this.properties=new o.ag(c),this._transitionable=new o.a6(c,f,new Map(y)),this._transitionable.setTransitionOrValue(r.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(r){this._transitionable.setTransitionOrValue(this._options.properties,new Map(r))}updateTransitions(r){this._transitioning=this._transitionable.transitioned(r,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(r){this.properties=this._transitioning.possiblyEvaluate(r)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(r,c){this._options=r,this._transitionable.setTransitionOrValue(r.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class bn{constructor(r,c,f){this.screenBounds=r,this.cameraPoint=f.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,f)}static createFromScreenPoints(r,c){let f,y;if(r instanceof o.P||typeof r[0]=="number"){const v=o.P.convert(r);f=[v],y=c.isPointAboveHorizon(v)}else{const v=o.P.convert(r[0]),S=o.P.convert(r[1]),N=v.add(S)._div(2);f=[v,S],y=o.ao(v,S).every(C=>c.isPointAboveHorizon(C))&&c.isPointAboveHorizon(N)}return new bn(f,y,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(r){return o.ao(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],r)}bufferedCameraGeometry(r){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(c,f,0,!1);return this.cameraPoint.y>f.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<f.x?y.splice(3,0,this.cameraPoint):this.cameraPoint.x>=f.x?y[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(y[3]=this.cameraPoint)),o.ap(y,r)}bufferedCameraGeometryGlobe(r){const c=this.screenBounds[0],f=this.screenBounds.length===1?this.screenBounds[0].add(new o.P(1,1)):this.screenBounds[1],y=o.ao(c,f,r),v=this.cameraPoint.clone();switch(3*((v.y>c.y)+(v.y>f.y))+((v.x>c.x)+(v.x>f.x))){case 0:y[0]=v,y[4]=v.clone();break;case 1:y.splice(1,0,v);break;case 2:y[1]=v;break;case 3:y.splice(4,0,v);break;case 5:y.splice(2,0,v);break;case 6:y[3]=v;break;case 7:y.splice(3,0,v);break;case 8:y[2]=v}return y}containsTile(r,c,f,y=0){const v=r.queryPadding/c._pixelsPerMercatorPixel+1,S=f?this._bufferedCameraMercator(v,c):this._bufferedScreenMercator(v,c);let N=r.tileID.wrap+(S.unwrapped?y:0);const C=S.polygon.map(se=>o.aq(r.tileTransform,se,N));if(!o.ar(C,0,0,o.aj,o.aj))return;N=r.tileID.wrap+(this.screenGeometryMercator.unwrapped?y:0);const k=this.screenGeometryMercator.polygon.map(se=>o.as(r.tileTransform,se,N)),D=k.map(se=>new o.P(se[0],se[1])),U=c.getFreeCameraOptions().position||new o.ac(0,0,0),O=o.as(r.tileTransform,U,N),G=k.map(se=>{const te=o.at(se,se,O);return o.au(te,te),new o.av(O,te)}),ee=o.aw(r,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:D,tilespaceRays:G,bufferedTilespaceGeometry:C,bufferedTilespaceBounds:(J=o.ax(C),J.min.x=o.ay(J.min.x,0,o.aj),J.min.y=o.ay(J.min.y,0,o.aj),J.max.x=o.ay(J.max.x,0,o.aj),J.max.y=o.ay(J.max.y,0,o.aj),J),tile:r,tileID:r.tileID,pixelToTileUnitsFactor:ee};var J}_bufferedScreenMercator(r,c){const f=fr(r);if(this._screenRaycastCache[f])return this._screenRaycastCache[f];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(r),c):{polygon:this.bufferedScreenGeometry(r).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._screenRaycastCache[f]=y,y}}_bufferedCameraMercator(r,c){const f=fr(r);if(this._cameraRaycastCache[f])return this._cameraRaycastCache[f];{let y;return y=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(r),c):{polygon:this.bufferedCameraGeometry(r).map(v=>c.pointCoordinate3D(v)),unwrapped:!0},this._cameraRaycastCache[f]=y,y}}_projectAndResample(r,c){const f=function(v,S){const N=o.az([],S.pixelMatrix,S.globeMatrix),C=[0,-o.aB,0,1],k=[0,o.aB,0,1],D=[0,0,0,1];o.aA(C,C,N),o.aA(k,k,N),o.aA(D,D,N);const U=new o.P(C[0]/C[3],C[1]/C[3]),O=new o.P(k[0]/k[3],k[1]/k[3]),G=o.aC(v,U)&&C[3]<D[3],ee=o.aC(v,O)&&k[3]<D[3];if(!G&&!ee)return null;const J=function(Te,_e,ve){for(let be=1;be<Te.length;be++){const Ue=vr(_e.pointCoordinate3D(Te[be-1]).x),Ie=vr(_e.pointCoordinate3D(Te[be]).x);if(ve<0){if(Ue<Ie)return{idx:be,t:-Ue/(Ie-1-Ue)}}else if(Ie<Ue)return{idx:be,t:(1-Ue)/(Ie+1-Ue)}}return null}(v,S,G?-1:1);if(!J)return null;const{idx:se,t:te}=J;let le=se>1?Nr(v.slice(0,se),S):[],de=se<v.length?Nr(v.slice(se),S):[];le=le.map(Te=>new o.P(vr(Te.x),Te.y)),de=de.map(Te=>new o.P(vr(Te.x),Te.y));const pe=[...le];pe.length===0&&pe.push(de[de.length-1]);const ye=o.ai(pe[pe.length-1].y,(de.length===0?le[0]:de[0]).y,te);let Se;return Se=G?[new o.P(0,ye),new o.P(0,0),new o.P(1,0),new o.P(1,ye)]:[new o.P(1,ye),new o.P(1,1),new o.P(0,1),new o.P(0,ye)],pe.push(...Se),de.length===0?pe.push(le[0]):pe.push(...de),{polygon:pe.map(Te=>new o.ac(Te.x,Te.y)),unwrapped:!1}}(r,c);if(f)return f;const y=function(v,S){let N=!1,C=-1/0,k=0;for(let U=0;U<v.length-1;U++)v[U].x>C&&(C=v[U].x,k=U);for(let U=0;U<v.length-1;U++){const O=(k+U)%(v.length-1),G=v[O],ee=v[O+1];Math.abs(G.x-ee.x)>.5&&(G.x<ee.x?(G.x+=1,O===0&&(v[v.length-1].x+=1)):(ee.x+=1,O+1===v.length-1&&(v[0].x+=1)),N=!0)}const D=o.aD(S.center.lng);return N&&D<Math.abs(D-1)&&v.forEach(U=>{U.x-=1}),{polygon:v,unwrapped:N}}(Nr(r,c).map(v=>new o.P(vr(v.x),v.y)),c);return{polygon:y.polygon.map(v=>new o.ac(v.x,v.y)),unwrapped:y.unwrapped}}}function Nr(p,r){return o.aE(p,c=>{const f=r.pointCoordinate3D(c);c.x=f.x,c.y=f.y},1/256)}function vr(p){return p<0?1+p%1:p%1}function fr(p){return 100*p|0}function yi(p,r,c,f,y){const v=function(N,C){if(N)return y(N);if(C){if(p.url&&C.tiles&&p.tiles&&delete p.tiles,C.variants){if(!Array.isArray(C.variants))return y(new Error("variants must be an array"));for(const D of C.variants){if(D==null||typeof D!="object"||D.constructor!==Object)return y(new Error("variant must be an object"));if(!Array.isArray(D.capabilities))return y(new Error("capabilities must be an array"));if(D.capabilities.length===1&&D.capabilities[0]==="meshopt"){C=o.h(C,D);break}}}const k=o.aF(o.h({},C,p),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);k.tiles=r.canonicalizeTileset(k,p.url),y(null,k)}},S=function(N,C,k){if(!N)return null;if(!C&&!k)return N;k=k||N.worldview_default;const D=Object.values(N.language||{});if(D.length===0)return null;const U=Object.values(N.worldview||{});if(U.length===0)return null;const O=D.every(ee=>ee===C),G=U.every(ee=>ee===k);return O&&G?N:C in(N.language_options||{})||k in(N.worldview_options||{})?null:N.language_options&&N.worldview_options?N:null}(p.data,c,f);return S?o.q.frame(()=>v(null,S)):p.url?o.n(r.transformRequest(r.normalizeSourceURL(p.url,null,c,f),o.R.Source),v):o.q.frame(()=>{const{data:N,...C}=p;v(null,C)})}function To(p,r){const c=Math.pow(2,r.z),f=Math.floor(o.aD(p.getWest())*c),y=Math.floor(o.aH(p.getNorth())*c),v=Math.ceil(o.aD(p.getEast())*c),S=Math.ceil(o.aH(p.getSouth())*c);return r.x>=f&&r.x<v&&r.y>=y&&r.y<S}class Yi{constructor(r,c,f){this.bounds=r?o.aG.convert(this.validateBounds(r)):null,this.minzoom=c||0,this.maxzoom=f||24}validateBounds(r){return Array.isArray(r)&&r.length===4?[Math.max(-180,r[0]),Math.max(-90,r[1]),Math.min(180,r[2]),Math.min(90,r[3])]:[-180,-90,180,90]}addExtraBounds(r){if(r){this.extraBounds||(this.extraBounds=[]);for(const c of r)this.extraBounds.push(o.aG.convert(this.validateBounds(c)))}}contains(r){if(r.z>this.maxzoom||r.z<this.minzoom||this.bounds&&!To(this.bounds,r))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(To(c,r))return!0;return!1}static fromTileJSON(r){if(!r.bounds&&!r.extra_bounds)return null;const c=new Yi(r.bounds,r.minzoom,r.maxzoom);return c.addExtraBounds(r.extra_bounds),c}}class Wh extends o.E{constructor(r,c,f,y){if(super(),this.id=r,this.dispatcher=f,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,o.h(this,o.aF(c,["url","scheme","tileSize","promoteId"])),this._options=o.h({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(y),this._tileWorkers={},this._deduped=new o.aI}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,f=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,c,f,(y,v)=>{if(this._tileJSONRequest=null,this._loaded=!0,y)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),f&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${f}`),this.fire(new o.z(y));else if(v){if(o.h(this,v),this.hasWorldviews=!!v.worldview_options,v.worldview_default&&(this.worldviewDefault=v.worldview_default),v.vector_layers){this.vectorLayers=v.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const S of v.vector_layers)this.vectorLayerIds.push(S.id),v.worldview&&v.worldview[S.source]&&this.localizableLayerIds.add(S.id)}this.tileBounds=Yi.fromTileJSON(v),Mt(v.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}r&&r(y)})}loaded(){return this._loaded}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}loadTile(r,c){const f=r.tileID.canonical.url(this.tiles,this.scheme),y=this.map._requestManager.normalizeTileURL(f),v=this.map._requestManager.transformRequest(y,o.R.Tile),S=this.map.style?this.map.style.getLut(this.scope):null,N=S?{image:S.image.clone()}:null,C={request:v,data:void 0,uid:r.uid,tileID:r.tileID,tileZoom:r.tileZoom,zoom:r.tileID.overscaledZ,maxZoom:this.maxzoom,lut:N,tileSize:this.tileSize*r.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:r.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:r.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&o.j(f)&&(C.localizableLayerIds=this.localizableLayerIds),C.request.collectResourceTiming=this._collectResourceTiming,r.actor&&r.state!=="expired")r.state==="loading"?r.reloadCallback=c:r.request=r.actor.send("reloadTile",C,k.bind(this));else if(r.actor=this._tileWorkers[y]=this._tileWorkers[y]||this.dispatcher.getActor(),this.dispatcher.ready)r.request=r.actor.send("loadTile",C,k.bind(this),void 0,!0);else{const D=o.aJ.call({deduped:this._deduped},C,(U,O)=>{U||!O?k.call(this,U):(C.data={cacheControl:O.cacheControl,expires:O.expires,rawData:O.rawData.slice(0)},r.actor&&r.actor.send("loadTile",C,k.bind(this),void 0,!0))},!0);r.request={cancel:D}}function k(D,U){return delete r.request,r.aborted?c(null):D&&D.status!==404?c(D):(U&&U.resourceTiming&&(r.resourceTiming=U.resourceTiming),this.map._refreshExpiredTiles&&U&&r.setExpiryData(U),r.loadVectorData(U,this.map.painter),o.aK(this.dispatcher),c(null),void(r.reloadCallback&&(this.loadTile(r,r.reloadCallback),r.reloadCallback=null)))}}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){r.actor&&r.actor.send("removeTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope}),r.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Ii extends o.E{constructor(r,c,f,y){super(),this.id=r,this.dispatcher=f,this.setEventedParent(y),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=o.h({type:"raster"},c),o.h(this,o.aF(c,["url","scheme","tileSize"]))}load(r){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,null,c,(f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?this.fire(new o.z(f)):y&&(o.h(this,y),y.raster_layers&&(this.rasterLayers=y.raster_layers,this.rasterLayerIds=this.rasterLayers.map(v=>v.id)),this.tileBounds=Yi.fromTileJSON(y),Mt(y.tiles),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),r&&r(f)})}loaded(){return this._loaded}onAdd(r){this.map=r,this.load()}reload(){this.cancelTileJSONRequest();const r=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(r))}setTiles(r){return this._options.tiles=r,this.reload(),this}setUrl(r){return this.url=r,this._options.url=r,this.reload(),this}onRemove(r){this.cancelTileJSONRequest()}serialize(){return o.h({},this._options)}hasTile(r){return!this.tileBounds||this.tileBounds.contains(r.canonical)}loadTile(r,c){const f=o.q.devicePixelRatio>=2,y=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),f,this.tileSize);r.request=o.o(this.map._requestManager.transformRequest(y,o.R.Tile),(v,S,N,C)=>(delete r.request,r.aborted?(r.state="unloaded",c(null)):v?(r.state="errored",c(v)):S?(this.map._refreshExpiredTiles&&r.setExpiryData({cacheControl:N,expires:C}),r.setTexture(S,this.map.painter),r.state="loaded",o.aK(this.dispatcher),void c(null)):c(null)))}abortTile(r,c){r.request&&(r.request.cancel(),delete r.request),c&&c()}unloadTile(r,c){r.texture&&r.texture instanceof o.T?(r.destroy(!0),r.texture&&r.texture instanceof o.T&&this.map.painter.saveTileTexture(r.texture)):r.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class xc extends Ii{constructor(r,c,f,y){super(r,c,f,y),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._options=o.h({type:"raster-array"},c)}triggerRepaint(r){const c=this.map.painter._terrain,f=this.map.style.getSourceCache(this.id);c&&c.enabled&&f&&c._clearRenderCacheForTile(f.id,r.tileID),this.map.triggerRepaint()}loadTile(r,c){const f=this.map._requestManager.normalizeTileURL(r.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),y=this.map._requestManager.transformRequest(f,o.R.Tile),v={request:y,uid:r.uid,tileID:r.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};r.source=this.id,r.scope=this.scope,r.requestParams=y,r.actor||(r.actor=this.dispatcher.getActor());const S=(N,C,k,D)=>{if(delete r.request,r.aborted)return r.state="unloaded",c(null);if(N)return N.name==="AbortError"?void 0:(r.state="errored",c(N));if(this.map._refreshExpiredTiles&&C&&r.setExpiryData({cacheControl:k,expires:D}),this.partial)r.state="empty";else{if(!C)return c(null);r.state="loaded",r._isHeaderLoaded=!0,r._mrt=C}c(null)};r.request=this.partial?r.fetchHeader(void 0,S.bind(this)):r.actor.send("loadTile",v,S.bind(this),void 0,!0)}abortTile(r){r.request&&(r.request.cancel(),delete r.request),r.actor&&r.actor.send("abortTile",{uid:r.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(r,c){const f=r.texturePerLayer;if(r.flushAllQueues(),f.size){r.destroy(!0);for(const y of f.values())this.map.painter.saveTileTexture(y)}else r.destroy()}prepareTile(r,c,f,y){r._isHeaderLoaded&&(r.state!=="empty"&&(r.state="reloading"),r.fetchBand(c,f,y,(v,S)=>{if(v)return r.state="errored",this.fire(new o.z(v)),void this.triggerRepaint(r);S&&(r._isHeaderLoaded=!0,r.setTexturePerLayer(f,S,this.map.painter),r.state="loaded",this.triggerRepaint(r))}))}getInitialBand(r){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find(({id:v})=>v===r),f=c&&c.fields,y=f&&f.bands&&f.bands;return y?y[0]:0}getTextureDescriptor(r,c,f){if(!r)return;const y=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!y)return;let v=null;c instanceof o.aN?v=c.paint.get("raster-array-band"):c instanceof o.aO&&(v=c.paint.get("raster-particle-array-band"));const S=v||this.getInitialBand(y);if(S==null)return;if(!r.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(r,y,c.id,S);if(r.updateNeeded(c.id,S)&&!f)return;const N=r.textureDescriptorPerLayer.get(c.id);return Object.assign({},N,{texture:r.texturePerLayer.get(c.id)})}getImages(r,c){const f=new Map;for(const y of r)for(const v of c){const[S,N]=v.split("/"),C=y.getLayer(S);if(!C||!C.hasBand(N)||!C.hasDataForBand(N))continue;const{bytes:k,tileSize:D,buffer:U}=C.getBandView(N),O=D+2*U,G={data:new o.r({width:O,height:O},k),pixelRatio:2,sdf:!1,usvg:!1,version:0};f.set(v,G)}return f}}const zf={vector:Wh,raster:Ii,"raster-dem":class extends Ii{constructor(p,r,c,f){super(p,r,c,f),this.type="raster-dem",this.maxzoom=22,this._options=o.h({type:"raster-dem"},r),this.encoding=r.encoding||"mapbox"}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function f(y,v){y&&(p.state="errored",r(y)),v&&(p.dem=v,p.dem.onDeserialize(),p.needsHillshadePrepare=!0,p.needsDEMTextureUpload=!0,p.state="loaded",r(null))}p.request=o.o(this.map._requestManager.transformRequest(c,o.R.Tile),(function(y,v,S,N){if(delete p.request,p.aborted)p.state="unloaded",r(null);else if(y)p.state="errored",r(y);else if(v){this.map._refreshExpiredTiles&&p.setExpiryData({cacheControl:S,expires:N});const C=ImageBitmap&&v instanceof ImageBitmap&&o.t(),k=1-(v.width-o.aL(v.width))/2;k<1||p.neighboringTiles||(p.neighboringTiles=this._getNeighboringTiles(p.tileID));const D=C?v:o.q.getImageData(v,k),U={uid:p.uid,tileID:p.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:D,encoding:this.encoding,padding:k};p.actor&&p.state!=="expired"||(p.actor=this.dispatcher.getActor(),p.actor.send("loadTile",U,f.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(p){const r=p.canonical,c=Math.pow(2,r.z),f=(r.x-1+c)%c,y=r.x===0?p.wrap-1:p.wrap,v=(r.x+1+c)%c,S=r.x+1===c?p.wrap+1:p.wrap,N={};return N[new o.aM(p.overscaledZ,y,r.z,f,r.y).key]={backfilled:!1},N[new o.aM(p.overscaledZ,S,r.z,v,r.y).key]={backfilled:!1},r.y>0&&(N[new o.aM(p.overscaledZ,y,r.z,f,r.y-1).key]={backfilled:!1},N[new o.aM(p.overscaledZ,p.wrap,r.z,r.x,r.y-1).key]={backfilled:!1},N[new o.aM(p.overscaledZ,S,r.z,v,r.y-1).key]={backfilled:!1}),r.y+1<c&&(N[new o.aM(p.overscaledZ,y,r.z,f,r.y+1).key]={backfilled:!1},N[new o.aM(p.overscaledZ,p.wrap,r.z,r.x,r.y+1).key]={backfilled:!1},N[new o.aM(p.overscaledZ,S,r.z,v,r.y+1).key]={backfilled:!1}),N}},"raster-array":xc,geojson:class extends o.E{constructor(p,r,c,f){super(),this.id=p,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(f),this._data=r.data,this._options=o.h({},r),this._collectResourceTiming=r.collectResourceTiming,r.maxzoom!==void 0&&(this.maxzoom=r.maxzoom),r.minzoom!==void 0&&(this.minzoom=r.minzoom),r.type&&(this.type=r.type),r.attribution&&(this.attribution=r.attribution),this.promoteId=r.promoteId;const y=o.aj/this.tileSize;this.workerOptions=o.h({source:this.id,scope:this.scope,cluster:r.cluster||!1,geojsonVtOptions:{buffer:(r.buffer!==void 0?r.buffer:128)*y,tolerance:(r.tolerance!==void 0?r.tolerance:.375)*y,extent:o.aj,maxZoom:this.maxzoom,lineMetrics:r.lineMetrics||!1,generateId:r.generateId||!1},superclusterOptions:{maxZoom:r.clusterMaxZoom!==void 0?r.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,r.clusterMinPoints||2),extent:o.aj,radius:(r.clusterRadius!==void 0?r.clusterRadius:50)*y,log:!1,generateId:r.generateId||!1},clusterProperties:r.clusterProperties,filter:r.filter,dynamic:r.dynamic},r.workerOptions)}onAdd(p){this.map=p,this.setData(this._data)}setData(p){return this._data=p,this._updateWorkerData(),this}updateData(p){if(!this._options.dynamic)return this.fire(new o.z(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof p!="string"&&(p.type==="Feature"&&(p={type:"FeatureCollection",features:[p]}),p.type!=="FeatureCollection"))return this.fire(new o.z(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof p!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const r=new Map;for(const c of this._data.features)r.set(c.id,c);for(const c of p.features)r.set(c.id,c);this._data.features=[...r.values()]}else this._data=p;return this._updateWorkerData(!0),this}getClusterExpansionZoom(p,r){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterChildren(p,r){return this.actor.send("geojson.getClusterChildren",{clusterId:p,source:this.id,scope:this.scope},r),this}getClusterLeaves(p,r,c,f){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:p,limit:r,offset:c},f),this}_updateWorkerData(p=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new o.A("dataloading",{dataType:"source"})),this._loaded=!1;const r=o.h({append:p},this.workerOptions);r.scope=this.scope;const c=this._data;typeof c=="string"?(r.request=this.map._requestManager.transformRequest(o.q.resolveURL(c),o.R.Source),r.request.collectResourceTiming=this._collectResourceTiming):r.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,r,(f,y)=>{if(this._loaded=!0,this._pendingLoad=null,f)this.fire(new o.z(f));else{const v={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&y&&y.resourceTiming&&y.resourceTiming[this.id]&&(v.resourceTiming=y.resourceTiming[this.id]),p&&(this._partialReload=!0),this.fire(new o.A("data",v)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(p),this._coalesce=!1)})}loaded(){return this._loaded}reload(){const p=o.C(this.id,this.scope);this.map.style.clearSource(p),this._updateWorkerData()}loadTile(p,r){const c=p.actor?"reloadTile":"loadTile";p.actor=this.actor;const f=this.map.style?this.map.style.getLut(this.scope):null,y=f?{image:f.image.clone()}:null,v=this._partialReload,S={type:this.type,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:y,scope:this.scope,pixelRatio:o.q.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:p.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:v,worldview:this.map.getWorldview()};p.request=this.actor.send(c,S,(N,C)=>v&&!C?(p.state="loaded",r(null)):(delete p.request,p.destroy(),p.aborted?r(null):N?r(N):(p.loadVectorData(C,this.map.painter,c==="reloadTile"),r(null))),void 0,c==="loadTile")}abortTile(p){p.request&&(p.request.cancel(),delete p.request),p.aborted=!0}unloadTile(p,r){this.actor.send("removeTile",{uid:p.uid,type:this.type,source:this.id,scope:this.scope}),p.destroy()}onRemove(p){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return o.h({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends o.aP{constructor(p,r,c,f){super(p,r,c,f),this.roundZoom=!0,this.type="video",this.options=r}load(){this._loaded=!1;const p=this.options;this.urls=[];for(const r of p.urls)this.urls.push(this.map._requestManager.transformRequest(r,o.R.Source).url);o.aQ(this.urls,(r,c)=>{this._loaded=!0,r?this.fire(new o.z(r)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",()=>{this.map.triggerRepaint()}),this.map&&this.video.play(),this._finishLoading())})}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(p){if(this.video){const r=this.video.seekable;p<r.start(0)||p>r.end(0)?this.fire(new o.z(new o.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${r.start(0)} and ${r.end(0)}-second mark.`))):this.video.currentTime=p}}getVideo(){return this.video}onAdd(p){this.map||(this.map=p,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const p=this.map.painter.context,r=p.gl;this.texture?this.video.paused||(this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),r.texSubImage2D(r.TEXTURE_2D,0,0,0,r.RGBA,r.UNSIGNED_BYTE,this.video)):(this.texture=new o.T(p,this.video,r.RGBA8),this.texture.bind(r.LINEAR,r.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(p)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:o.aP,model:class extends o.E{constructor(p,r,c,f){super(),this.id=p,this.type="model",this.models=[],this._loaded=!1,this._options=r}load(){const p=[];for(const r in this._options.models){const c=this._options.models[r],f=o.aS(this.map._requestManager.transformRequest(c.uri,o.R.Model).url).then(y=>{if(!y)return;const v=o.aT(y),S=new o.aU(r,c.position,c.orientation,v);S.computeBoundsAndApplyParent(),this.models.push(S)}).catch(y=>{this.fire(new o.z(new Error(`Could not load model ${r} from ${c.uri}: ${y.message}`)))});p.push(f)}Promise.allSettled(p).then(()=>{this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"}))}).catch(r=>{this._loaded=!0,this.fire(new o.z(new Error(`Could not load models: ${r.message}`)))})}onAdd(p){this.map=p,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(p,r){}serialize(){return this._options}},"batched-model":class extends o.E{constructor(p,r,c,f){super(),this.type="batched-model",this.id=p,this.tileSize=512,this._options=r,this.tiles=this._options.tiles,this.maxzoom=r.maxzoom||19,this.minzoom=r.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(f)}onAdd(p){this.map=p,this.load()}reload(){this.cancelTileJSONRequest();const p=o.C(this.id,this.scope);this.load(()=>this.map.style.clearSource(p))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(p){this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"}));const r=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=yi(this._options,this.map._requestManager,r,c,(f,y)=>{this._tileJSONRequest=null,this._loaded=!0,f?(r&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${r}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new o.z(f))):y&&(o.h(this,y),y.bounds&&(this.tileBounds=new Yi(y.bounds,this.minzoom,this.maxzoom)),Mt(y.tiles,this.map._requestManager._customAccessToken),this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))),p&&p(f)})}hasTransition(){return!1}hasTile(p){return!this.tileBounds||this.tileBounds.contains(p.canonical)}loaded(){return this._loaded}loadTile(p,r){const c=this.map._requestManager.normalizeTileURL(p.tileID.canonical.url(this.tiles,this.scheme)),f={request:this.map._requestManager.transformRequest(c,o.R.Tile),data:void 0,uid:p.uid,tileID:p.tileID,tileZoom:p.tileZoom,zoom:p.tileID.overscaledZ,tileSize:this.tileSize*p.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:p.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:o.q.devicePixelRatio,promoteId:this.promoteId};if(p.actor&&p.state!=="expired")if(p.state==="loading")p.reloadCallback=r;else{if(p.buckets){const v=Object.values(p.buckets);for(const S of v)S.dirty=!0;return void(p.state="loaded")}p.request=p.actor.send("reloadTile",f,y.bind(this))}else p.actor=this.dispatcher.getActor(),p.request=p.actor.send("loadTile",f,y.bind(this),void 0,!0);function y(v,S){return p.aborted?r(null):v&&v.status!==404?r(v):(this.map._refreshExpiredTiles&&S&&p.setExpiryData(S),p.loadModelData(S,this.map.painter),p.state="loaded",void r(null))}}serialize(){return o.h({},this._options)}},canvas:class extends o.aP{constructor(p,r,c,f){super(p,r,c,f),r.coordinates?Array.isArray(r.coordinates)&&r.coordinates.length===4&&!r.coordinates.some(y=>!Array.isArray(y)||y.length!==2||y.some(v=>typeof v!="number"))||this.fire(new o.z(new o.V(`sources.${p}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new o.z(new o.V(`sources.${p}`,null,'missing required property "coordinates"'))),r.animate&&typeof r.animate!="boolean"&&this.fire(new o.z(new o.V(`sources.${p}`,null,'optional "animate" property must be a boolean value'))),r.canvas?typeof r.canvas=="string"||r.canvas instanceof HTMLCanvasElement||this.fire(new o.z(new o.V(`sources.${p}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new o.z(new o.V(`sources.${p}`,null,'missing required property "canvas"'))),this.options=r,this.animate=r.animate===void 0||r.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new o.z(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(p){this.map=p,this.load(),this.canvas&&this.animate&&this.play()}onRemove(p){this.pause()}prepare(){let p=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,p=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,p=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const r=this.map.painter.context;this.texture?!p&&!this._playing||this.texture instanceof o.aR||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new o.T(r,this.canvas,r.gl.RGBA8,{premultiply:!0}),this._prepareData(r)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const p of[this.canvas.width,this.canvas.height])if(isNaN(p)||p<=0)return!0;return!1}},custom:class extends o.E{constructor(p,r,c,f){super(),this.id=p,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=r,this.setEventedParent(f),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new o.z(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new o.z(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Yi(this._implementation.bounds,this.minzoom,this.maxzoom)),r.update=this._update.bind(this),r.clearTiles=this._clearTiles.bind(this),r.coveringTiles=this._coveringTiles.bind(this),o.h(this,o.aF(r,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return o.aF(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new o.A("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(p){this.map=p,this._loaded=!1,this.fire(new o.A("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(p),this.load()}onRemove(p){this._implementation.onRemove&&this._implementation.onRemove(p)}hasTile(p){if(this._implementation.hasTile){const{x:r,y:c,z:f}=p.canonical;return this._implementation.hasTile({x:r,y:c,z:f})}return!this.tileBounds||this.tileBounds.contains(p.canonical)}loadTile(p,r){const{x:c,y:f,z:y}=p.tileID.canonical,v=new AbortController;p.request=Promise.resolve(this._implementation.loadTile({x:c,y:f,z:y},{signal:v.signal})).then((function(S){return delete p.request,p.aborted?(p.state="unloaded",r(null)):S===void 0?(p.state="errored",r(null)):S===null?(this.loadTileData(p,{width:this.tileSize,height:this.tileSize,data:null}),p.state="loaded",r(null)):function(N){return N instanceof ImageData||N instanceof HTMLCanvasElement||N instanceof ImageBitmap||N instanceof HTMLImageElement}(S)?(this.loadTileData(p,S),p.state="loaded",void r(null)):(p.state="errored",r(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch(S=>{S.name!=="AbortError"&&(p.state="errored",r(S))}),p.request.cancel=()=>v.abort()}loadTileData(p,r){p.setTexture(r,this.map.painter)}unloadTile(p,r){if(p.texture&&p.texture instanceof o.T?(p.destroy(!0),p.texture&&p.texture instanceof o.T&&this.map.painter.saveTileTexture(p.texture)):p.destroy(),this._implementation.unloadTile){const{x:c,y:f,z:y}=p.tileID.canonical;this._implementation.unloadTile({x:c,y:f,z:y})}r&&r()}abortTile(p,r){p.request&&p.request.cancel&&(p.request.cancel(),delete p.request),r&&r()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map(p=>({x:p.canonical.x,y:p.canonical.y,z:p.canonical.z}))}_clearTiles(){const p=o.C(this.id,this.scope);this.map.style.clearSource(p)}_update(){this.fire(new o.A("data",{dataType:"source",sourceDataType:"content"}))}}},qh=function(p,r,c,f){const y=new zf[r.type](p,r,c,f);if(y.id!==p)throw new Error(`Expected Source id to be ${p} instead of ${y.id}`);return o.aV(["load","abort","unload","serialize","prepare"],y),y};function Zh(p,r,c=""){return`${c}:${r.id||""}:${r.layer.id}:${function(f){if("layerId"in f)return`layer:${f.layerId}`;{const{featuresetId:y,importId:v}=f;return`featureset:${y}${v?`:import:${v}`:""}`}}(p.target)}`}function Of(p,r,c,f=""){if(p.uniqueFeatureID){const y=Zh(p,r,f);if(c.has(y))return!0;c.add(y)}return!1}function Ff(p,r,c,f,y=!1){const v=r.sourceCache.transform,S=r.sourceCache.tilesIn(p,r.has3DLayers,y);S.sort(Bf);const N=[];for(const C of S){const k=C.tile.queryRenderedFeatures(r,C,c,f,v,y);Object.keys(k).length&&N.push({wrappedTileID:C.tile.tileID.wrapped().key,queryResults:k})}return N.length===0?{}:function(C){const k={},D={};for(const U of C){const O=U.queryResults,G=U.wrappedTileID,ee=D[G]=D[G]||{};for(const J in O){const se=O[J],te=ee[J]=ee[J]||{},le=k[J]=k[J]||[];for(const de of se)te[de.featureIndex]||(te[de.featureIndex]=!0,le.push(de))}}return k}(N)}function hu(p,r,c,f,y,v){const S={},N=f.queryRenderedSymbols(p),C=[];for(const k of Object.keys(N).map(Number))C.push(y[k]);C.sort(Bf);for(const k of C){const D=k.featureIndex.lookupSymbolFeatures(N[k.bucketInstanceId],k.bucketIndex,k.sourceLayerIndex,r,c,v);for(const U in D){const O=S[U]=S[U]||[],G=D[U];G.sort((ee,J)=>{const se=k.featureSortOrder;if(se){const te=se.indexOf(ee.featureIndex);return se.indexOf(J.featureIndex)-te}return J.featureIndex-ee.featureIndex});for(const ee of G)O.push(ee)}}return S}function Kh(p,r){const c=p.getRenderableIds().map(v=>p.getTileByID(v)),f=[],y={};for(let v=0;v<c.length;v++){const S=c[v],N=S.tileID.canonical.key;y[N]||(y[N]=!0,S.querySourceFeatures(f,r))}return f}function Bf(p,r){const c=p.tileID,f=r.tileID;return c.overscaledZ-f.overscaledZ||c.canonical.y-f.canonical.y||c.wrap-f.wrap||c.canonical.x-f.canonical.x}function $a(p,r){const c={};if(!r)return c;for(const f of p){const y=f.layerIds.map(v=>r.getLayer(v)).filter(Boolean);if(y.length!==0){f.layers=y,f.stateDependentLayerIds&&(f.stateDependentLayers=f.stateDependentLayerIds.map(v=>y.filter(S=>S.id===v)[0]));for(const v of y)c[v.fqid]=f}}return c}const Qo=32,Sa=33,Dl=new Uint16Array(8184);for(let p=0;p<2046;p++){let r=p+2,c=0,f=0,y=0,v=0,S=0,N=0;for(1&r?y=v=S=Qo:c=f=N=Qo;(r>>=1)>1;){const k=c+y>>1,D=f+v>>1;1&r?(y=c,v=f,c=S,f=N):(c=y,f=v,y=S,v=N),S=k,N=D}const C=4*p;Dl[C+0]=c,Dl[C+1]=f,Dl[C+2]=y,Dl[C+3]=v}const Ga=new Uint16Array(2178),Ll=new Uint8Array(1089),Xh=new Uint16Array(1089);function hl(p){return p===0?-.03125:p===32?.03125:0}const Yh={type:2,extent:o.aj,loadGeometry:()=>[[new o.P(0,0),new o.P(o.aj+1,0),new o.P(o.aj+1,o.aj+1),new o.P(0,o.aj+1),new o.P(0,0)]]};class pu{constructor(r,c,f,y,v,S){this.tileID=r,this.uid=o.a$(),this.uses=0,this.tileSize=c,this.tileZoom=f,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=v,y&&y.style&&(this._lastUpdatedBrightness=y.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",y&&y.transform&&(this.projection=y.transform.projection),this.worldview=S}registerFadeDuration(r){const c=r+this.timeAdded;c<o.q.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=o.aW(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(r,c,f){if(this.unloadVectorData(),this.state="loaded",r){r.featureIndex&&(this.latestFeatureIndex=r.featureIndex,r.rawTileData?(this.latestRawTileData=r.rawTileData,this.latestFeatureIndex.rawTileData=r.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=r.collisionBoxArray,this.buckets=$a(r.buckets,c.style),this.hasSymbolBuckets=!1;for(const y in this.buckets){const v=this.buckets[y];if(v instanceof o.b1){if(this.hasSymbolBuckets=!0,!f)break;v.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const y in this.buckets){const v=this.buckets[y];if(v instanceof o.b1&&v.hasRTLText){this.hasRTLText=!0,o.b2();break}}this.queryPadding=0;for(const y in this.buckets){const v=this.buckets[y],S=c.style.getOwnLayer(y);if(!S)continue;const N=S.queryRadius(v);this.queryPadding=Math.max(this.queryPadding,N)}r.imageAtlas&&(this.imageAtlas=r.imageAtlas),r.glyphAtlasImage&&(this.glyphAtlasImage=r.glyphAtlasImage),r.lineAtlas&&(this.lineAtlas=r.lineAtlas),this._lastUpdatedBrightness=r.brightness}else this.collisionBoxArray=new o.b0}unloadVectorData(){if(this.hasData()){for(const r in this.buckets)this.buckets[r].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(r,c,f){r&&(r.resourceTiming&&(this.resourceTiming=r.resourceTiming),this.buckets=Object.assign({},this.buckets,$a(r.buckets,c.style)),r.featureIndex&&(this.latestFeatureIndex=r.featureIndex))}getBucket(r){return this.buckets[r.fqid]}upload(r){for(const y in this.buckets){const v=this.buckets[y];v.uploadPending()&&v.upload(r)}const c=r.gl,f=this.imageAtlas;f&&!f.uploaded&&(this.imageAtlasTexture=new o.T(r,f.image,c.RGBA8,{useMipmap:!!f.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new o.T(r,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new o.T(r,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(r,c,f){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(r,this.imageAtlasTexture,f),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const y=c.style.getBrightness();(this._lastUpdatedBrightness||y)&&(this._lastUpdatedBrightness&&y&&Math.abs(this._lastUpdatedBrightness-y)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==y),this._lastUpdatedBrightness=y))}queryRenderedFeatures(r,c,f,y,v,S){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const N=function(C,k){const D=o.bn([],[.5*C.width,.5*-C.height,1]);return o.bo(D,D,[1,-1,0]),o.az(D,D,C.calculateProjMatrix(k.toUnwrapped())),Float32Array.from(D)}(v,this.tileID);return this.latestFeatureIndex.query(r,{tilespaceGeometry:c,pixelPosMatrix:N,transform:y,availableImages:f,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(r,c){const f=this.latestFeatureIndex;if(!f||!f.rawTileData)return;const y=f.loadVTLayers(),v=c?c.sourceLayer:"",S=y._geojsonTileLayer||y[v];if(!S)return;const N=o.b3(c&&c.filter),{z:C,x:k,y:D}=this.tileID.canonical,U={z:C,x:k,y:D};for(let O=0;O<S.length;O++){const G=S.feature(O);if(N.needGeometry){const se=o.b4(G,!0);if(!N.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),se,this.tileID.canonical))continue}else if(!N.filter(new o.aa(this.tileID.overscaledZ,{worldview:this.worldview}),G))continue;const ee=f.getId(G,v),J=new o.b5(G,C,k,D,ee);J.tile=U,r.push(J)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(r){const c=this.expirationTime;if(r.cacheControl){const f=o.b6(r.cacheControl);f["max-age"]&&(this.expirationTime=Date.now()+1e3*f["max-age"])}else r.expires&&(this.expirationTime=new Date(r.expires).getTime());if(this.expirationTime){const f=Date.now();let y=!1;if(this.expirationTime>f)y=!1;else if(c)if(this.expirationTime<c)y=!0;else{const v=this.expirationTime-c;v?this.expirationTime=f+Math.max(v,3e4):y=!0}else y=!0;y?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(r){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&r&&this.updateBuckets(r)}updateBuckets(r,c){if(!this.latestFeatureIndex||!r.style)return;const f=this.latestFeatureIndex.loadVTLayers(),y=r.style.listImages(),v=r.style.getBrightness();for(const S in this.buckets){if(!r.style.hasLayer(S))continue;const N=this.buckets[S],C=N.layers[0],k=C.sourceLayer||"_geojsonTileLayer",D=f[k],U=r.style.getLayerSourceCache(C);let O={};U&&(O=U._state.getState(k,void 0));const G=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},ee=Object.keys(O).length>0&&!c;ee&&!N.stateDependentLayers.length&&!c||N.update(O,D,y,G,ee?N.stateDependentLayers:N.layers,c,v),(N instanceof o.b7||N instanceof o.b8)&&r._terrain&&r._terrain.enabled&&U&&N.uploadPending()&&r._terrain._clearRenderCacheForTile(U.id,this.tileID);const J=r&&r.style&&r.style.getOwnLayer(S);J&&(this.queryPadding=Math.max(this.queryPadding,J.queryRadius(N)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<o.q.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(r){this.symbolFadeHoldUntil=o.q.now()+r}setTexture(r,c){const f=c.context,y=f.gl;this.texture=this.texture||c.getTileTexture(r.width),this.texture&&this.texture instanceof o.T?this.texture.update(r):(this.texture=new o.T(f,r,y.RGBA8,{useMipmap:!0}),this.texture.bind(y.LINEAR,y.CLAMP_TO_EDGE))}setDependencies(r,c){const f={};for(const y of c)f[y]=!0;this.dependencies[r]=f}hasDependency(r,c){for(const f of r){const y=this.dependencies[f];if(y){for(const v of c)if(y[v])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(r,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const f=o.b9(Yh,this.tileID.canonical,this.tileTransform)[0],y=new o.ba,v=new o.bb;for(let S=0;S<f.length;S++){const{x:N,y:C}=f[S];y.emplaceBack(N,C),v.emplaceBack(S)}v.emplaceBack(0),this._tileDebugIndexBuffer=r.createIndexBuffer(v),this._tileDebugBuffer=r.createVertexBuffer(y,o.bc.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,y.length,v.length)}_makeTileBoundsBuffers(r,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const f=o.b9(Yh,this.tileID.canonical,this.tileTransform)[0];let y,v;if(this.isRaster){const S=function(N,C){const k=o.aW(N,C),D=Math.pow(2,N.z);for(let se=0;se<Sa;se++)for(let te=0;te<Sa;te++){const le=o.aX((N.x+(te+hl(te))/Qo)/D),de=o.aY((N.y+(se+hl(se))/Qo)/D),pe=C.project(le,de),ye=se*Sa+te;Ga[2*ye+0]=Math.round((pe.x*k.scale-k.x)*o.aj),Ga[2*ye+1]=Math.round((pe.y*k.scale-k.y)*o.aj)}Ll.fill(0),Xh.fill(0);for(let se=2045;se>=0;se--){const te=4*se,le=Dl[te+0],de=Dl[te+1],pe=Dl[te+2],ye=Dl[te+3],Se=le+pe>>1,Te=de+ye>>1,_e=Se+Te-de,ve=Te+le-Se,be=de*Sa+le,Ue=ye*Sa+pe,Ie=Te*Sa+Se,tt=Math.hypot((Ga[2*be+0]+Ga[2*Ue+0])/2-Ga[2*Ie+0],(Ga[2*be+1]+Ga[2*Ue+1])/2-Ga[2*Ie+1])>=16;Ll[Ie]=Ll[Ie]||(tt?1:0),se<1022&&(Ll[Ie]=Ll[Ie]||Ll[(de+ve>>1)*Sa+(le+_e>>1)]||Ll[(ye+ve>>1)*Sa+(pe+_e>>1)])}const U=new o.aZ,O=new o.a_;let G=0;function ee(se,te){const le=te*Sa+se;return Xh[le]===0&&(U.emplaceBack(Ga[2*le+0],Ga[2*le+1],se*o.aj/Qo,te*o.aj/Qo),Xh[le]=++G),Xh[le]-1}function J(se,te,le,de,pe,ye){const Se=se+le>>1,Te=te+de>>1;if(Math.abs(se-pe)+Math.abs(te-ye)>1&&Ll[Te*Sa+Se])J(pe,ye,se,te,Se,Te),J(le,de,pe,ye,Se,Te);else{const _e=ee(se,te),ve=ee(le,de),be=ee(pe,ye);O.emplaceBack(_e,ve,be)}}return J(0,0,Qo,Qo,Qo,0),J(Qo,Qo,0,0,0,Qo),{vertices:U,indices:O}}(this.tileID.canonical,c);y=S.vertices,v=S.indices}else{y=new o.aZ,v=new o.a_;for(const{x:N,y:C}of f)y.emplaceBack(N,C,0,0);const S=o.be(y.int16.subarray(0,4*y.length),void 0,4);for(let N=0;N<S.length;N+=3)v.emplaceBack(S[N],S[N+1],S[N+2])}this._tileBoundsBuffer=r.createVertexBuffer(y,o.bf.members),this._tileBoundsIndexBuffer=r.createIndexBuffer(v),this._tileBoundsSegments=o.bd.simpleSegment(0,0,y.length,v.length)}_makeGlobeTileDebugBuffers(r,c){const f=c.projection;if(!f||f.name!=="globe"||c.freezeTileCoverage)return;const y=this.tileID.canonical,v=o.bg(y,c),S=o.bh(v),N=o.ah(c.zoom);let C;N>0&&(C=o.bi(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(r,y,c,S,C,N),this._makeGlobeTileDebugTextBuffer(r,y,c,S,C,N)}_globePoint(r,c,f,y,v,S,N){let C=o.bj(r,c,f);if(S){const k=1<<f.z,D=o.aD(y.center.lng),U=o.aH(y.center.lat),O=(f.x+.5)/k-D;let G=0;O>.5?G=-1:O<-.5&&(G=1);let ee=(r/o.aj+f.x)/k+G,J=(c/o.aj+f.y)/k;ee=(ee-D)*y._pixelsPerMercatorPixel+D,J=(J-U)*y._pixelsPerMercatorPixel+U;const se=[ee*y.worldSize,J*y.worldSize,0];o.ad(se,se,S),C=o.bk(C,se,N)}return o.ad(C,C,v)}_makeGlobeTileDebugBorderBuffer(r,c,f,y,v,S){const N=new o.ba,C=new o.bb,k=new o.bl,D=(O,G,ee,J,se)=>{const te=(ee-O)/(se-1),le=(J-G)/(se-1),de=N.length;for(let pe=0;pe<se;pe++){const ye=O+pe*te,Se=G+pe*le;N.emplaceBack(ye,Se);const Te=this._globePoint(ye,Se,c,f,y,v,S);k.emplaceBack(Te[0],Te[1],Te[2]),C.emplaceBack(de+pe)}},U=o.aj;D(0,0,U,0,16),D(U,0,U,U,16),D(U,U,0,U,16),D(0,U,0,0,16),this._tileDebugIndexBuffer=r.createIndexBuffer(C),this._tileDebugBuffer=r.createVertexBuffer(N,o.bc.members),this._globeTileDebugBorderBuffer=r.createVertexBuffer(k,o.bm.members),this._tileDebugSegments=o.bd.simpleSegment(0,0,N.length,C.length)}_makeGlobeTileDebugTextBuffer(r,c,f,y,v,S){const N=o.aj/4,C=new o.ba,k=new o.a_,D=new o.bl,U=25;k.reserve(32),C.reserve(U),D.reserve(U);const O=(G,ee)=>U*G+ee;for(let G=0;G<U;G++){const ee=G*N;for(let J=0;J<U;J++){const se=J*N;C.emplaceBack(se,ee);const te=this._globePoint(se,ee,c,f,y,v,S);D.emplaceBack(te[0],te[1],te[2])}}for(let G=0;G<4;G++)for(let ee=0;ee<4;ee++){const J=O(G,ee),se=O(G,ee+1),te=O(G+1,ee),le=O(G+1,ee+1);k.emplaceBack(J,se,te),k.emplaceBack(te,se,le)}this._tileDebugTextIndexBuffer=r.createIndexBuffer(k),this._tileDebugTextBuffer=r.createVertexBuffer(C,o.bc.members),this._globeTileDebugTextBuffer=r.createVertexBuffer(D,o.bm.members),this._tileDebugTextSegments=o.bd.simpleSegment(0,0,U,32)}destroy(r=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!r&&this.texture&&this.texture instanceof o.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}o.bp.setPbf(o.bq);class ad extends pu{constructor(r,c,f,y,v){super(r,c,f,y,v),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(r){return this._mrt&&this._mrt.getLayer(r)}setTexturePerLayer(r,c,f){const y=f.context,v=y.gl;let S=this.texturePerLayer.get(r)||f.getTileTexture(c.width);S&&S instanceof o.T?S.update(c,{premultiply:!1}):S=new o.T(y,c,v.RGBA8,{premultiply:!1}),this.texturePerLayer.has(r)||this.texturePerLayer.set(r,S)}flushQueues(r){const c=this._workQueuePerLayer.get(r)||[],f=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()();for(;f.length;)f.pop()()}flushAllQueues(){for(const r of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}for(const r of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(r)||[];for(;c.length;)c.pop()()}}fetchHeader(r=16384,c){const f=this._mrt=new o.bp(30),y=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(r-1)}});return this.entireBuffer=null,this.request=o.br(y,(v,S,N,C)=>{if(v)c(v);else try{const k=f.getHeaderLength(S);if(k>r)return void(this.request=this.fetchHeader(k,c));f.parseHeader(S),this._isHeaderLoaded=!0;let D=0;for(const U of Object.values(f.layers))D=Math.max(D,U.dataIndex[U.dataIndex.length-1].lastByte);S.byteLength>=D&&(this.entireBuffer=S),c(null,this.entireBuffer||S,N,C)}catch(k){c(k)}}),this.request}fetchBand(r,c,f,y){const v=this._mrt;if(!this._isHeaderLoaded||!v)return void y(new Error("Tile header is not ready"));const S=this.actor;if(!S)return void y(new Error("Can't fetch tile band without an actor"));let N;const C=(O,G)=>{if(N.complete(O,G),O)return void y(O);this.updateTextureDescriptor(r,c,f);const ee=this.textureDescriptorPerLayer.get(c);y(null,ee&&ee.img)},k=(O,G)=>{if(O)return y(O);const ee=S.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:G,task:N},C,void 0,!0),J=this._workQueuePerLayer.get(c)||[];J.push(()=>{ee&&ee.cancel(),N.cancel()}),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,J)},D=v.getLayer(r);if(!D)return void y(new Error(`Unknown sourceLayer "${r}"`));if(D.hasDataForBand(f)){this.updateTextureDescriptor(r,c,f);const O=this.textureDescriptorPerLayer.get(c);return void y(null,O?O.img:null)}const U=D.getDataRange([f]);if(N=v.createDecodingTask(U),!N||N.tasks.length)if(this.flushQueues(c),this.entireBuffer)k(null,this.entireBuffer.slice(U.firstByte,U.lastByte+1));else{const O=Object.assign({},this.requestParams,{headers:{Range:`bytes=${U.firstByte}-${U.lastByte}`}}),G=o.br(O,k),ee=this._fetchQueuePerLayer.get(c)||[];ee.push(()=>{G.cancel(),N.cancel()}),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,ee)}else y(null)}updateNeeded(r,c){return(!this.textureDescriptorPerLayer.get(r)||this.textureDescriptorPerLayer.get(r).band!==c)&&this.state!=="errored"}updateTextureDescriptor(r,c,f){if(!this._mrt)return;const y=this._mrt.getLayer(r);if(!y||!y.hasBand(f)||!y.hasDataForBand(f))return;const{bytes:v,tileSize:S,buffer:N,offset:C,scale:k}=y.getBandView(f),D=S+2*N,U=new o.r({width:D,height:D},v),O=this.texturePerLayer.get(c);O&&O instanceof o.T&&O.update(U,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:r,band:f,img:U,buffer:N,offset:C,tileSize:S,format:y.pixelFormat,mix:[k,256*k,65536*k,16777216*k]})}destroy(r=!1){if(super.destroy(r),delete this._mrt,!r)for(const c of this.texturePerLayer.values())c&&c instanceof o.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Mx{constructor(r,c){this.max=r,this.onRemove=c,this.reset()}reset(){for(const r in this.data)for(const c of this.data[r])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(r,c,f){const y=r.wrapped().key;this.data[y]===void 0&&(this.data[y]=[]);const v={value:c,timeout:void 0};if(f!==void 0&&(v.timeout=setTimeout(()=>{this.remove(r,v)},f)),this.data[y].push(v),this.order.push(y),this.order.length>this.max){const S=this._getAndRemoveByKey(this.order[0]);S&&this.onRemove(S)}return this}has(r){return r.wrapped().key in this.data}getAndRemove(r){return this.has(r)?this._getAndRemoveByKey(r.wrapped().key):null}_getAndRemoveByKey(r){const c=this.data[r].shift();return c.timeout&&clearTimeout(c.timeout),this.data[r].length===0&&delete this.data[r],this.order.splice(this.order.indexOf(r),1),c.value}getByKey(r){const c=this.data[r];return c?c[0].value:null}get(r){return this.has(r)?this.data[r.wrapped().key][0].value:null}remove(r,c){if(!this.has(r))return this;const f=r.wrapped().key,y=c===void 0?0:this.data[f].indexOf(c),v=this.data[f][y];return this.data[f].splice(y,1),v.timeout&&clearTimeout(v.timeout),this.data[f].length===0&&delete this.data[f],this.onRemove(v.value),this.order.splice(this.order.indexOf(f),1),this}setMaxSize(r){for(this.max=r;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(r){const c=[];for(const f in this.data)for(const y of this.data[f])r(y.value)||c.push(y);for(const f of c)this.remove(f.value.tileID,f)}}class Rx{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(r,c,f){const y=String(c);if(this.stateChanges[r]=this.stateChanges[r]||{},this.stateChanges[r][y]=this.stateChanges[r][y]||{},o.h(this.stateChanges[r][y],f),this.deletedStates[r]===null){this.deletedStates[r]={};for(const v in this.state[r])v!==y&&(this.deletedStates[r][v]=null)}else if(this.deletedStates[r]&&this.deletedStates[r][y]===null){this.deletedStates[r][y]={};for(const v in this.state[r][y])f[v]||(this.deletedStates[r][y][v]=null)}else for(const v in f)this.deletedStates[r]&&this.deletedStates[r][y]&&this.deletedStates[r][y][v]===null&&delete this.deletedStates[r][y][v]}removeFeatureState(r,c,f){if(this.deletedStates[r]===null)return;const y=String(c);if(this.deletedStates[r]=this.deletedStates[r]||{},f&&c!==void 0)this.deletedStates[r][y]!==null&&(this.deletedStates[r][y]=this.deletedStates[r][y]||{},this.deletedStates[r][y][f]=null);else if(c!==void 0)if(this.stateChanges[r]&&this.stateChanges[r][y])for(f in this.deletedStates[r][y]={},this.stateChanges[r][y])this.deletedStates[r][y][f]=null;else this.deletedStates[r][y]=null;else this.deletedStates[r]=null}getState(r,c){const f=this.state[r]||{},y=this.stateChanges[r]||{},v=this.deletedStates[r];if(v===null)return{};if(c!==void 0){const N=String(c),C=o.h({},f[N],y[N]);if(v){const k=v[c];if(k===null)return{};for(const D in k)delete C[D]}return C}const S=o.h({},f,y);if(v)for(const N in v)delete S[N];return S}initializeTileState(r,c){r.refreshFeatureState(c)}coalesceChanges(r,c){const f={};for(const y in this.stateChanges){this.state[y]=this.state[y]||{};const v={};for(const S in this.stateChanges[y])this.state[y][S]||(this.state[y][S]={}),o.h(this.state[y][S],this.stateChanges[y][S]),v[S]=this.state[y][S];f[y]=v}for(const y in this.deletedStates){this.state[y]=this.state[y]||{};const v={};if(this.deletedStates[y]===null)for(const S in this.state[y])v[S]={},this.state[y][S]={};else for(const S in this.deletedStates[y]){if(this.deletedStates[y][S]===null)this.state[y][S]={};else if(this.state[y][S])for(const N of Object.keys(this.deletedStates[y][S]))delete this.state[y][S][N];v[S]=this.state[y][S]}f[y]=f[y]||{},o.h(f[y],v)}if(this.stateChanges={},this.deletedStates={},Object.keys(f).length!==0)for(const y in r)r[y].refreshFeatureState(c)}}class No extends o.E{constructor(r,c,f){super(),this.id=r,this._onlySymbols=f,c.on("data",y=>{y.dataType==="source"&&y.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&y.dataType==="source"&&y.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))}),c.on("error",()=>{this._sourceErrored=!0}),this._source=c,this._tiles={},this._cache=new Mx(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new Rx,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(r){this.map=r,this._minTileCacheSize=this._minTileCacheSize===void 0&&r?r._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&r?r._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const r in this._tiles)if(!this._tiles[r].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const r=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,r&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(r,c){return r.isSymbolTile=this._onlySymbols,r.isExtraShadowCaster=this._shadowCasterTiles[r.tileID.key],this._source.loadTile(r,c)}_unloadTile(r){if(this._source.unloadTile)return this._source.unloadTile(r)}_abortTile(r){if(this._source.abortTile)return this._source.abortTile(r)}serialize(){return this._source.serialize()}prepare(r){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const f=this._tiles[c];f.upload(r),f.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map(r=>r.tileID).sort(fu).map(r=>r.key)}getRenderableIds(r,c){const f=[];for(const y in this._tiles)this._isIdRenderable(+y,r,c)&&f.push(this._tiles[y]);return r?f.sort((y,v)=>{const S=y.tileID,N=v.tileID,C=new o.P(S.canonical.x,S.canonical.y)._rotate(this.transform.angle),k=new o.P(N.canonical.x,N.canonical.y)._rotate(this.transform.angle);return S.overscaledZ-N.overscaledZ||k.y-C.y||k.x-C.x}).map(y=>y.tileID.key):f.map(y=>y.tileID).sort(fu).map(y=>y.key)}hasRenderableParent(r){const c=this.findLoadedParent(r,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(r,c,f){return this._tiles[r]&&this._tiles[r].hasData()&&!this._coveredTiles[r]&&(c||!this._tiles[r].holdingForFade())&&(f||!this._shadowCasterTiles[r])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const r in this._tiles)this._tiles[r].state!=="errored"&&this._reloadTile(+r,"reloading")}}_reloadTile(r,c){const f=this._tiles[r];f&&(f.state!=="loading"&&(f.state=c),this._loadTile(f,this._tileLoaded.bind(this,f,r,c)))}_tileLoaded(r,c,f,y){if(y)if(r.state="errored",y.status!==404)this._source.fire(new o.z(y,{tile:r}));else{if(this._source.fire(new o.A("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:r})),!(r.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const v=this.map.painter.terrain;this.update(this.transform,v.getScaledDemTileSize(),!0),v.resetTileLookupCache(this.id)}else this.update(this.transform)}else r.timeAdded=o.q.now(),f==="expired"&&(r.refreshedUponExpiration=!0),this._setTileReloadTimer(c,r),this._source.type==="raster-dem"&&r.dem&&this._backfillDEM(r),this._state.initializeTileState(r,this.map?this.map.painter:null),this._source.fire(new o.A("data",{dataType:"source",tile:r,coord:r.tileID,sourceCacheId:this.id}))}_backfillDEM(r){const c=this.getRenderableIds();for(let y=0;y<c.length;y++){const v=c[y];if(r.neighboringTiles&&r.neighboringTiles[v]){const S=this.getTileByID(v);f(r,S),f(S,r)}}function f(y,v){if(!y.dem||y.dem.borderReady)return;y.needsHillshadePrepare=!0,y.needsDEMTextureUpload=!0;let S=v.tileID.canonical.x-y.tileID.canonical.x;const N=v.tileID.canonical.y-y.tileID.canonical.y,C=Math.pow(2,y.tileID.canonical.z),k=v.tileID.key;S===0&&N===0||Math.abs(N)>1||(Math.abs(S)>1&&(Math.abs(S+C)===1?S+=C:Math.abs(S-C)===1&&(S-=C)),v.dem&&y.dem&&(y.dem.backfillBorder(v.dem,S,N),y.neighboringTiles&&y.neighboringTiles[k]&&(y.neighboringTiles[k].backfilled=!0)))}}getTile(r){return this.getTileByID(r.key)}getTileByID(r){return this._tiles[r]}_retainLoadedChildren(r,c,f,y){for(const v in this._tiles){let S=this._tiles[v];if(y[v]||!S.hasData()||S.tileID.overscaledZ<=c||S.tileID.overscaledZ>f)continue;let N=S.tileID;for(;S&&S.tileID.overscaledZ>c+1;){const k=S.tileID.scaledTo(S.tileID.overscaledZ-1);S=this._tiles[k.key],S&&S.hasData()&&(N=k)}let C=N;for(;C.overscaledZ>c;)if(C=C.scaledTo(C.overscaledZ-1),r[C.key]){y[N.key]=N;break}}}findLoadedParent(r,c){if(r.key in this._loadedParentTiles){const f=this._loadedParentTiles[r.key];return f&&f.tileID.overscaledZ>=c?f:null}for(let f=r.overscaledZ-1;f>=c;f--){const y=r.scaledTo(f),v=this._getLoadedTile(y);if(v)return v}}_getLoadedTile(r){const c=this._tiles[r.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?r.wrapped().key:r.canonical.key)}updateCacheSize(r,c){c=c||this._source.tileSize;const f=Math.ceil(r.width/c)+1,y=Math.ceil(r.height/c)+1,v=Math.floor(f*y*5),S=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,v):v,N=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,S):S;this._cache.setMaxSize(N)}handleWrapJump(r){const c=Math.round((r-(this._prevLng===void 0?r:this._prevLng))/360);if(this._prevLng=r,c){const f={};for(const y in this._tiles){const v=this._tiles[y];v.tileID=v.tileID.unwrapTo(v.tileID.wrap+c),f[v.tileID.key]=v}this._tiles=f;for(const y in this._timers)clearTimeout(this._timers[y]),delete this._timers[y];for(const y in this._tiles)this._setTileReloadTimer(+y,this._tiles[y])}}update(r,c,f,y,v){if(this.transform=r,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!f)return;this.updateCacheSize(r,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const S=this._source.type==="batched-model";let N,C=this._source.maxzoom;const k=this.map&&this.map.painter?this.map.painter._terrain:null;if(k&&k.sourceCache===this&&k.attenuationRange()){const O=k.attenuationRange()[0],G=Math.floor(O)-Math.log2(k.getDemUpscale());C>G&&(C=G)}if(this.used||this.usedForTerrain){if(this._source.tileID)N=r.getVisibleUnwrappedCoordinates(this._source.tileID).map(O=>new o.aM(O.canonical.z,O.wrap,O.canonical.z,O.canonical.x,O.canonical.y));else if(this.tileCoverLift!==0){const O=r.clone();O.tileCoverLift=this.tileCoverLift,N=O.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.minzoom<=1&&r.projection.name==="globe"&&(N.push(new o.aM(1,0,1,0,0)),N.push(new o.aM(1,0,1,1,0)),N.push(new o.aM(1,0,1,0,1)),N.push(new o.aM(1,0,1,1,1)))}else if(N=r.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:C,roundZoom:this._source.roundZoom&&!f,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:S}),this._source.hasTile){const O=this._source.hasTile.bind(this._source);N=N.filter(G=>O(G))}}else N=[];if(N.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!Jh(this._source.type)){const O=r.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!f}),G=Math.min(O,this._source.maxzoom);if(S){const ee=r.extendTileCover(N,G);for(const J of ee)N.push(J)}else if(v){const ee=r.extendTileCoverToNearPlane(N,this.transform.getFrustum(G),G);for(const J of ee)N.push(J)}else if(this.castsShadows&&y){const ee=r.extendTileCover(N,G,y);for(const J of ee)this._shadowCasterTiles[J.key]=!0,N.push(J)}}const D=this._updateRetainedTiles(N);if(Jh(this._source.type)&&N.length!==0){const O={},G={},ee=Object.keys(D);for(const se of ee){const te=D[se],le=this._tiles[se];if(!le||le.fadeEndTime&&le.fadeEndTime<=o.q.now())continue;const de=this.findLoadedParent(te,Math.max(te.overscaledZ-No.maxOverzooming,this._source.minzoom));de&&(this._addTile(de.tileID),O[de.tileID.key]=de.tileID),G[se]=te}const J=N[N.length-1].overscaledZ;for(const se in this._tiles){const te=this._tiles[se];if(D[se]||!te.hasData())continue;let le=te.tileID;for(;le.overscaledZ>J;){le=le.scaledTo(le.overscaledZ-1);const de=this._tiles[le.key];if(de&&de.hasData()&&G[le.key]){D[se]=te.tileID;break}}}for(const se in O)D[se]||(this._coveredTiles[se]=!0,D[se]=O[se])}for(const O in D)this._tiles[O].clearFadeHold();const U=o.bs(this._tiles,D);for(const O of U){const G=this._tiles[O];G.hasSymbolBuckets&&!G.holdingForFade()?G.setHoldDuration(this.map._fadeDuration):G.hasSymbolBuckets&&!G.symbolFadeFinished()||this._removeTile(+O)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const r in this._tiles)this._tiles[r].holdingForFade()&&this._removeTile(+r)}_updateRetainedTiles(r){const c={};if(r.length===0)return c;const f={},y=r.reduce((k,D)=>Math.min(k,D.overscaledZ),1/0),v=r[0].overscaledZ,S=Math.max(v-No.maxOverzooming,this._source.minzoom),N=Math.max(v+No.maxUnderzooming,this._source.minzoom),C={};for(const k of r){const D=this._addTile(k);c[k.key]=k,D.hasData()||y<this._source.maxzoom&&(C[k.key]=k)}this._retainLoadedChildren(C,y,N,c);for(const k of r){let D=this._tiles[k.key];if(D.hasData())continue;if(k.canonical.z>=this._source.maxzoom){const O=k.children(this._source.maxzoom)[0],G=this.getTile(O);if(G&&G.hasData()){c[O.key]=O;continue}}else{const O=k.children(this._source.maxzoom);if(c[O[0].key]&&c[O[1].key]&&c[O[2].key]&&c[O[3].key])continue}let U=D.wasRequested();for(let O=k.overscaledZ-1;O>=S;--O){const G=k.scaledTo(O);if(f[G.key]||(f[G.key]=!0,D=this.getTile(G),!D&&U&&(D=this._addTile(G)),D&&(c[G.key]=G,U=D.wasRequested(),D.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const r in this._tiles){const c=[];let f,y=this._tiles[r].tileID;for(;y.overscaledZ>0;){if(y.key in this._loadedParentTiles){f=this._loadedParentTiles[y.key];break}c.push(y.key);const v=y.scaledTo(y.overscaledZ-1);if(f=this._getLoadedTile(v),f)break;y=v}for(const v of c)this._loadedParentTiles[v]=f}}_addTile(r){let c=this._tiles[r.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[r.key]||this._reloadTile(r.key,"reloading"),c;c=this._cache.getAndRemove(r),c&&(this._setTileReloadTimer(r.key,c),c.tileID=r,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[r.key]&&(clearTimeout(this._cacheTimers[r.key]),delete this._cacheTimers[r.key],this._setTileReloadTimer(r.key,c)));const f=!!c;if(!f){const y=this.map?this.map.painter:null,v=this._source.tileSize*r.overscaleFactor();c=this._source.type==="raster-array"?new ad(r,v,this.transform.tileZoom,y,this._isRaster):new pu(r,v,this.transform.tileZoom,y,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,r.key,c.state))}return c.uses++,this._tiles[r.key]=c,f||this._source.fire(new o.A("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(r,c){r in this._timers&&(clearTimeout(this._timers[r]),delete this._timers[r]);const f=c.getExpiryTimeout();f&&(this._timers[r]=setTimeout(()=>{this._reloadTile(r,"expired"),delete this._timers[r]},f))}_removeTile(r){const c=this._tiles[r];c&&(c.uses--,delete this._tiles[r],this._timers[r]&&(clearTimeout(this._timers[r]),delete this._timers[r]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const r in this._tiles)this._removeTile(+r);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(r,c,f){const y=[],v=this.transform;if(!v)return y;const S=v.projection.name==="globe",N=o.aD(v.center.lng);for(const C in this._tiles){const k=this._tiles[C];if(f&&k.clearQueryDebugViz(),k.holdingForFade())continue;let D;if(S){const U=k.tileID.canonical;if(U.z===0){const O=[Math.abs(o.ay(N,...ld(U,-1))-N),Math.abs(o.ay(N,...ld(U,1))-N)];D=[0,2*O.indexOf(Math.min(...O))-1]}else{const O=[Math.abs(o.ay(N,...ld(U,-1))-N),Math.abs(o.ay(N,...ld(U,0))-N),Math.abs(o.ay(N,...ld(U,1))-N)];D=[O.indexOf(Math.min(...O))-1]}}else D=[0];for(const U of D){const O=r.containsTile(k,v,c,U);O&&y.push(O)}}return y}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(r){return this._getRenderableCoordinates(r)}_getRenderableCoordinates(r,c){const f=this.getRenderableIds(r,c).map(v=>this._tiles[v].tileID),y=this.transform.projection.name==="globe";for(const v of f)v.projMatrix=this.transform.calculateProjMatrix(v.toUnwrapped()),v.expandedProjMatrix=y?this.transform.calculateProjMatrix(v.toUnwrapped(),!1,!0):v.projMatrix;return f}sortCoordinatesByDistance(r){const c=r.slice(),f=this.transform._camera.position,y=this.transform._camera.forward(),v={};for(const S of c){const N=1/(1<<S.canonical.z);v[S.key]=((S.canonical.x+.5)*N+S.wrap-f[0])*y[0]+((S.canonical.y+.5)*N-f[1])*y[1]-f[2]*y[2]}return c.sort((S,N)=>v[S.key]-v[N.key]),c}hasTransition(){if(this._source.hasTransition())return!0;if(Jh(this._source.type))for(const r in this._tiles){const c=this._tiles[r];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=o.q.now())return!0}return!1}setFeatureState(r,c,f){this._state.updateState(r=r||"_geojsonTileLayer",c,f)}removeFeatureState(r,c,f){this._state.removeFeatureState(r=r||"_geojsonTileLayer",c,f)}getFeatureState(r,c){return this._state.getState(r=r||"_geojsonTileLayer",c)}setDependencies(r,c,f){const y=this._tiles[r];y&&y.setDependencies(c,f)}reloadTilesForDependencies(r,c){for(const f in this._tiles)this._tiles[f].hasDependency(r,c)&&this._reloadTile(+f,"reloading");this._cache.filter(f=>!f.hasDependency(r,c))}_preloadTiles(r,c){if(!this._sourceLoaded){const C=()=>{this._sourceLoaded&&(this._source.off("data",C),this._preloadTiles(r,c))};return void this._source.on("data",C)}const f=new Map,y=Array.isArray(r)?r:[r],v=this.map.painter.terrain,S=this.usedForTerrain&&v?v.getScaledDemTileSize():this._source.tileSize;for(const C of y){const k=C.coveringTiles({tileSize:S,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const D of k)f.set(D.key,D);this.usedForTerrain&&C.updateElevation(!1)}const N=Array.from(f.values());o.bt(N,(C,k)=>{const D=new pu(C,this._source.tileSize*C.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(D,U=>{this._source.type==="raster-dem"&&D.dem&&this._backfillDEM(D),k(U,D)})},c)}}function fu(p,r){const c=Math.abs(2*p.wrap)-+(p.wrap<0),f=Math.abs(2*r.wrap)-+(r.wrap<0);return p.overscaledZ-r.overscaledZ||f-c||r.canonical.y-p.canonical.y||r.canonical.x-p.canonical.x}function Jh(p){return p==="raster"||p==="image"||p==="video"||p==="custom"}function ld(p,r){const c=1<<p.z;return[p.x/c+r,(p.x+1)/c+r]}No.maxOverzooming=10,No.maxUnderzooming=3;class _v{constructor(r){this.style=r,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const r=!1,c=!1;for(const f in this.style._mergedLayers){const y=this.style._mergedLayers[f];if(y.type==="fill-extrusion"||y.type==="building")this.layers.push({layer:y,visible:r,visibilityChanged:c});else if(y.type==="model"){const v=this.style.getLayerSource(y);v&&v.type==="batched-model"&&this.layers.push({layer:y,visible:r,visibilityChanged:c})}}}onNewFrame(r){this.layersGotHidden=!1;for(const c of this.layers){const f=c.layer;let y=!1;f.type==="fill-extrusion"?y=!f.isHidden(r)&&f.paint.get("fill-extrusion-opacity")>0:f.type==="building"?y=!f.isHidden(r)&&f.paint.get("building-opacity")>0:f.type==="model"&&(y=!f.isHidden(r)&&f.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!y&&c.visible,c.visible=y}}updateZOffset(r,c){this.currentBuildingBuckets=[];for(const y of this.layers){const v=y.layer,S=this.style.getLayerSourceCache(v);let N=1;v.type==="fill-extrusion"?N=y.visible?v.paint.get("fill-extrusion-vertical-scale"):0:v.type==="building"&&(N=y.visible?v.paint.get("building-vertical-scale"):0);let C=S?S.getTile(c):null;if(!C&&S)for(const k in S._tiles){const D=S._tiles[k];if(c.canonical.isChildOf(D.tileID.canonical)){C=D;break}}this.currentBuildingBuckets.push({bucket:C?C.getBucket(v):null,tileID:C?C.tileID:c,verticalScale:N})}r.hasAnyZOffset=!1;let f=!1;for(let y=0;y<r.symbolInstances.length;y++){const v=r.symbolInstances.get(y),S=v.zOffset,N=this._getHeightAtTileOffset(c,v.tileAnchorX,v.tileAnchorY);v.zOffset=N!==Number.NEGATIVE_INFINITY?N:S,f||S===v.zOffset||(f=!0),r.hasAnyZOffset||v.zOffset===0||(r.hasAnyZOffset=!0)}f&&(r.zOffsetBuffersNeedUpload=!0,r.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(r,c,f,y){let v=c,S=f;if(r.canonical.z!==y.canonical.z){const N=y.canonical,C=1/(1<<r.canonical.z-N.z);v=(c+r.canonical.x*o.aj)*C-N.x*o.aj|0,S=(f+r.canonical.y*o.aj)*C-N.y*o.aj|0}return{tileX:v,tileY:S}}_getHeightAtTileOffset(r,c,f){let y,v;for(let S=0;S<this.layers.length;++S){const N=this.layers[S].layer;if(N.type!=="fill-extrusion"&&N.type!=="building")continue;const{bucket:C,tileID:k,verticalScale:D}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:U,tileY:O}=this._mapCoordToOverlappingTile(r,c,f,k),G=C.getHeightAtTileCoord(U,O);G&&G.height!==void 0&&(G.hidden?y=G.height:v=Math.max(G.height*D,v||0))}if(v!==void 0)return v;for(let S=0;S<this.layers.length;++S){const N=this.layers[S];if(N.layer.type!=="model"||!N.visible)continue;const{bucket:C,tileID:k}=this.currentBuildingBuckets[S];if(!C)continue;const{tileX:D,tileY:U}=this._mapCoordToOverlappingTile(r,c,f,k),O=C.getHeightAtTileCoord(D,U);if(O&&!O.hidden)return O.height===void 0&&y!==void 0?Math.min(O.maxHeight,y)*O.verticalScale:O.height?O.height*O.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function vv(p,r){const c={};for(const f in p)f!=="ref"&&(c[f]=p[f]);return o.bu.forEach(f=>{f in r&&(c[f]=r[f])}),c}function Qh(p){p=p.slice();const r=Object.create(null);for(let c=0;c<p.length;c++)r[p[c].id]=p[c];for(let c=0;c<p.length;c++)"ref"in p[c]&&(p[c]=vv(p[c],r[p[c].ref]));return p}const hn={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function Vf(p,r,c){c.push({command:hn.addSource,args:[p,r[p]]})}function cd(p,r,c){r.push({command:hn.removeSource,args:[p]}),c[p]=!0}function ep(p,r,c,f){cd(p,c,f),Vf(p,r,c)}function jS(p,r,c){let f;for(f in p[c])if(p[c].hasOwnProperty(f)&&f!=="data"&&!o.bv(p[c][f],r[c][f]))return!1;for(f in r[c])if(r[c].hasOwnProperty(f)&&f!=="data"&&!o.bv(p[c][f],r[c][f]))return!1;return!0}function tp(p,r,c,f,y,v){let S;for(S in r=r||{},p=p||{})p.hasOwnProperty(S)&&(o.bv(p[S],r[S])||c.push({command:v,args:[f,S,r[S],y]}));for(S in r)r.hasOwnProperty(S)&&!p.hasOwnProperty(S)&&(o.bv(p[S],r[S])||c.push({command:v,args:[f,S,r[S],y]}))}function mu(p){return p.id}function yc(p,r){return p[r.id]=r,p}function sp(p,r,c){const f=r.createTileMatrix(p,p.worldSize,c.toUnwrapped());return o.az(new Float32Array(16),p.projMatrix,f)}function bv(p,r,c){if(r.projection.name===c.projection.name)return p.projMatrix;const f=c.clone();return f.setProjection(r.projection),sp(f,r.getProjection(),p)}function Uf(p,r,c){return r.name===c.projection.name?p.projMatrix:sp(c,r,p)}class wv{constructor(r,c){this.reset(r,c)}reset(r,c){this.points=r||[],this._distances=[0];for(let f=1;f<this.points.length;f++)this._distances[f]=this._distances[f-1]+this.points[f].dist(this.points[f-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(r){if(this.points.length===1)return this.points[0];r=o.ay(r,0,1);let c=1,f=this._distances[c];const y=r*this.paddedLength+this.padding;for(;f<y&&c<this._distances.length;)f=this._distances[++c];const v=c-1,S=this._distances[v],N=f-S,C=N>0?(y-S)/N:0;return this.points[v].mult(1-C).add(this.points[c].mult(C))}}class ud{constructor(r,c,f){const y=this.boxCells=[],v=this.circleCells=[];this.xCellCount=Math.ceil(r/f),this.yCellCount=Math.ceil(c/f);for(let S=0;S<this.xCellCount*this.yCellCount;S++)y.push([]),v.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=r,this.height=c,this.xScale=this.xCellCount/r,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(r,c,f,y,v){this._forEachCell(c,f,y,v,this._insertBoxCell,this.boxUid++),this.boxKeys.push(r),this.bboxes.push(c),this.bboxes.push(f),this.bboxes.push(y),this.bboxes.push(v)}insertCircle(r,c,f,y){this._forEachCell(c-y,f-y,c+y,f+y,this._insertCircleCell,this.circleUid++),this.circleKeys.push(r),this.circles.push(c),this.circles.push(f),this.circles.push(y)}_insertBoxCell(r,c,f,y,v,S){this.boxCells[v].push(S)}_insertCircleCell(r,c,f,y,v,S){this.circleCells[v].push(S)}_query(r,c,f,y,v,S){if(f<0||r>this.width||y<0||c>this.height)return!v&&[];const N=[];if(r<=0&&c<=0&&this.width<=f&&this.height<=y){if(v)return!0;for(let C=0;C<this.boxKeys.length;C++)N.push({key:this.boxKeys[C],x1:this.bboxes[4*C],y1:this.bboxes[4*C+1],x2:this.bboxes[4*C+2],y2:this.bboxes[4*C+3]});for(let C=0;C<this.circleKeys.length;C++){const k=this.circles[3*C],D=this.circles[3*C+1],U=this.circles[3*C+2];N.push({key:this.circleKeys[C],x1:k-U,y1:D-U,x2:k+U,y2:D+U})}return S?N.filter(S):N}return this._forEachCell(r,c,f,y,this._queryCell,N,{hitTest:v,seenUids:{box:{},circle:{}}},S),v?N.length>0:N}_queryCircle(r,c,f,y,v){const S=r-f,N=r+f,C=c-f,k=c+f;if(N<0||S>this.width||k<0||C>this.height)return!y&&[];const D=[];return this._forEachCell(S,C,N,k,this._queryCellCircle,D,{hitTest:y,circle:{x:r,y:c,radius:f},seenUids:{box:{},circle:{}}},v),y?D.length>0:D}query(r,c,f,y,v){return this._query(r,c,f,y,!1,v)}hitTest(r,c,f,y,v){return this._query(r,c,f,y,!0,v)}hitTestCircle(r,c,f,y){return this._queryCircle(r,c,f,!0,y)}_queryCell(r,c,f,y,v,S,N,C){const k=N.seenUids,D=this.boxCells[v];if(D!==null){const O=this.bboxes;for(const G of D)if(!k.box[G]){k.box[G]=!0;const ee=4*G;if(r<=O[ee+2]&&c<=O[ee+3]&&f>=O[ee+0]&&y>=O[ee+1]&&(!C||C(this.boxKeys[G]))){if(N.hitTest)return S.push(!0),!0;S.push({key:this.boxKeys[G],x1:O[ee],y1:O[ee+1],x2:O[ee+2],y2:O[ee+3]})}}}const U=this.circleCells[v];if(U!==null){const O=this.circles;for(const G of U)if(!k.circle[G]){k.circle[G]=!0;const ee=3*G;if(this._circleAndRectCollide(O[ee],O[ee+1],O[ee+2],r,c,f,y)&&(!C||C(this.circleKeys[G]))){if(N.hitTest)return S.push(!0),!0;{const J=O[ee],se=O[ee+1],te=O[ee+2];S.push({key:this.circleKeys[G],x1:J-te,y1:se-te,x2:J+te,y2:se+te})}}}}}_queryCellCircle(r,c,f,y,v,S,N,C){const k=N.circle,D=N.seenUids,U=this.boxCells[v];if(U!==null){const G=this.bboxes;for(const ee of U)if(!D.box[ee]){D.box[ee]=!0;const J=4*ee;if(this._circleAndRectCollide(k.x,k.y,k.radius,G[J+0],G[J+1],G[J+2],G[J+3])&&(!C||C(this.boxKeys[ee])))return S.push(!0),!0}}const O=this.circleCells[v];if(O!==null){const G=this.circles;for(const ee of O)if(!D.circle[ee]){D.circle[ee]=!0;const J=3*ee;if(this._circlesCollide(G[J],G[J+1],G[J+2],k.x,k.y,k.radius)&&(!C||C(this.circleKeys[ee])))return S.push(!0),!0}}}_forEachCell(r,c,f,y,v,S,N,C){const k=this._convertToXCellCoord(r),D=this._convertToYCellCoord(c),U=this._convertToXCellCoord(f),O=this._convertToYCellCoord(y);for(let G=k;G<=U;G++)for(let ee=D;ee<=O;ee++)if(v.call(this,r,c,f,y,this.xCellCount*ee+G,S,N,C))return}_convertToXCellCoord(r){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(r*this.xScale)))}_convertToYCellCoord(r){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(r*this.yScale)))}_circlesCollide(r,c,f,y,v,S){const N=y-r,C=v-c,k=f+S;return k*k>N*N+C*C}_circleAndRectCollide(r,c,f,y,v,S,N){const C=(S-y)/2,k=Math.abs(r-(y+C));if(k>C+f)return!1;const D=(N-v)/2,U=Math.abs(c-(v+D));if(U>D+f)return!1;if(k<=C||U<=D)return!0;const O=k-C,G=U-D;return O*O+G*G<=f*f}}const gu={unknown:0,flipRequired:1,flipNotRequired:2},Sv=Math.tan(85*Math.PI/180);function np(p,r,c,f,y,v,S){const N=o.bz();if(c)if(v.name==="globe"){const C=o.bA(y,r);o.az(N,N,C)}else{const C=o.bB([],S);N[0]=C[0],N[1]=C[1],N[4]=C[2],N[5]=C[3],f||o.by(N,N,y.angle)}else o.az(N,y.labelPlaneMatrix,p);return N}function dd(p,r,c,f,y,v,S){const N=np(p,r,c,f,y,v,S);return v.name==="globe"&&c||(N[2]=N[6]=N[10]=N[14]=0),N}function zl(p,r,c,f,y,v,S){if(c){if(v.name==="globe"){const N=np(p,r,c,f,y,v,S);return o.bi(N,N),o.az(N,p,N),N}{const N=o.bw(p),C=o.bx([]);return C[0]=S[0],C[1]=S[1],C[4]=S[2],C[5]=S[3],o.az(N,N,C),f||o.by(N,N,-y.angle),N}}return y.glCoordMatrix}function ea(p,r,c,f){const y=[p,r,c,1];c?o.aA(y,y,f):jv(y,y,f);const v=y[3];return y[0]/=v,y[1]/=v,y[2]/=v,y}function kx(p,r){return Math.min(.5+p/r*.5,1.5)}function Dx(p,r){const c=p[0]/p[3],f=p[1]/p[3];return c>=-r[0]&&c<=r[0]&&f>=-r[1]&&f<=r[1]}function xu(p,r,c,f,y,v,S,N,C,k){const D=c.transform,U=f?p.textSizeData:p.iconSizeData,O=o.bH(U,c.transform.zoom),G=D.projection.name==="globe",ee=[256/c.width*2+1,256/c.height*2+1],J=f?p.text.dynamicLayoutVertexArray:p.icon.dynamicLayoutVertexArray;J.clear();let se=null;G&&(se=f?p.text.globeExtVertexArray:p.icon.globeExtVertexArray);const te=p.lineVertexArray,le=f?p.text.placedSymbolArray:p.icon.placedSymbolArray,de=c.transform.width/c.transform.height;let pe,ye=!1;for(let Se=0;Se<le.length;Se++){const Te=le.get(Se),{numGlyphs:_e,writingMode:ve}=Te;if(ve!==o.bI.vertical||ye||pe===o.bI.horizontal||(ye=!0),pe=ve,(Te.hidden||ve===o.bI.vertical)&&!ye){hd(_e,J);continue}ye=!1;const be=new o.P(Te.tileAnchorX,Te.tileAnchorY);let{x:Ue,y:Ie,z:tt}=D.projection.projectTilePoint(be.x,be.y,k.canonical);if(C){const[ns,us,Wt]=C(be);Ue+=ns,Ie+=us,tt+=Wt}const We=[Ue,Ie,tt,1];if(o.aA(We,We,r),!Dx(We,ee)){hd(_e,J);continue}const rt=We[3],jt=kx(c.transform.getCameraToCenterDistance(D.projection),rt),$e=o.bJ(U,O,Te),Ae=S?$e/jt:$e*jt,Ke=ea(Ue,Ie,tt,y);if(Ke[3]<=0){hd(_e,J);continue}let Ge={};const ht=o.al(p.layers[0].layout.get("text-max-angle")),pt=Math.cos(ht),mt=S?null:C,Pt=$f(Te,Ae,!1,N,r,y,v,p.glyphOffsetArray,te,J,se,Ke,be,Ge,de,mt,D.projection,k,S,pt);ye=Pt.useVertical,mt&&Pt.needsFlipping&&(Ge={}),(Pt.notEnoughRoom||ye||Pt.needsFlipping&&$f(Te,Ae,!0,N,r,y,v,p.glyphOffsetArray,te,J,se,Ke,be,Ge,de,mt,D.projection,k,S,pt).notEnoughRoom)&&hd(_e,J)}f?(p.text.dynamicLayoutVertexBuffer.updateData(J),se&&p.text.globeExtVertexBuffer&&p.text.globeExtVertexBuffer.updateData(se)):(p.icon.dynamicLayoutVertexBuffer.updateData(J),se&&p.icon.globeExtVertexBuffer&&p.icon.globeExtVertexBuffer.updateData(se))}function Do(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se){const{lineStartIndex:te,glyphStartIndex:le,segment:de}=N,pe=le+N.numGlyphs,ye=te+N.lineLength,Se=r.getoffsetX(le),Te=r.getoffsetX(pe-1),_e=rp(p*Se,c,f,y,v,S,de,te,ye,C,k,D,U,O,!0,G,ee,J,se);if(!_e)return null;const ve=rp(p*Te,c,f,y,v,S,de,te,ye,C,k,D,U,O,!0,G,ee,J,se);return ve?{first:_e,last:ve}:null}function Lx(p,r,c,f){return p===o.bI.horizontal&&Math.abs(f)>Math.abs(c)?{useVertical:!0}:p===o.bI.vertical?f>0?{needsFlipping:!0}:null:r!==gu.unknown&&function(y,v){return y===0||Math.abs(v/y)>Sv}(c,f)?r===gu.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function $f(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le,de){const pe=r/24,ye=p.lineOffsetX*pe,Se=p.lineOffsetY*pe,{lineStartIndex:Te,glyphStartIndex:_e,numGlyphs:ve,segment:be,writingMode:Ue,flipState:Ie}=p,tt=Te+p.lineLength,We=rt=>{if(D){const[Ke,Ge,ht]=rt.up,pt=k.length;o.bK(D,pt+0,Ke,Ge,ht),o.bK(D,pt+1,Ke,Ge,ht),o.bK(D,pt+2,Ke,Ge,ht),o.bK(D,pt+3,Ke,Ge,ht)}const[jt,$e,Ae]=rt.point;o.bL(k,jt,$e,Ae,rt.angle)};if(ve>1){const rt=Do(pe,N,ye,Se,c,U,O,p,C,v,G,J,!1,se,te,le,de);if(!rt)return{notEnoughRoom:!0};if(f&&!c){let[jt,$e,Ae]=rt.first.point,[Ke,Ge,ht]=rt.last.point;[jt,$e]=ea(jt,$e,Ae,S),[Ke,Ge]=ea(Ke,Ge,ht,S);const pt=Lx(Ue,Ie,(Ke-jt)*ee,Ge-$e);if(p.flipState=pt&&pt.needsFlipping?gu.flipRequired:gu.flipNotRequired,pt)return pt}We(rt.first);for(let jt=_e+1;jt<_e+ve-1;jt++){const $e=rp(pe*N.getoffsetX(jt),ye,Se,c,U,O,be,Te,tt,C,v,G,J,!1,!1,se,te,le,de);if(!$e)return k.length-=4*(jt-_e),{notEnoughRoom:!0};We($e)}We(rt.last)}else{if(f&&!c){const jt=ea(O.x,O.y,0,y),$e=Te+be+1,Ae=new o.P(C.getx($e),C.gety($e)),Ke=ea(Ae.x,Ae.y,0,y),Ge=Ke[3]>0?Ke:En(O,Ae,jt,1,y,void 0,se,te.canonical),ht=Lx(Ue,Ie,(Ge[0]-jt[0])*ee,Ge[1]-jt[1]);if(p.flipState=ht&&ht.needsFlipping?gu.flipRequired:gu.flipNotRequired,ht)return ht}const rt=rp(pe*N.getoffsetX(_e),ye,Se,c,U,O,be,Te,tt,C,v,G,J,!1,!1,se,te,le,de);if(!rt)return{notEnoughRoom:!0};We(rt)}return{}}function zx(p,r,c,f,y){const{x:v,y:S,z:N}=f.projectTilePoint(p.x,p.y,r);if(!y)return ea(v,S,N,c);const[C,k,D]=y(p);return ea(v+C,S+k,N+D,c)}function En(p,r,c,f,y,v,S,N){const C=zx(p.sub(r)._unit()._add(p),N,y,S,v);return o.at(C,c,C),o.au(C,C),o.bE(C,c,C,f)}function rp(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le){const de=f?p-r:p+r;let pe=de>0?1:-1,ye=0;f&&(pe*=-1,ye=Math.PI),pe<0&&(ye+=Math.PI);let Se=N+S+(pe>0?0:1)|0,Te=y,_e=y,ve=0,be=0;const Ue=Math.abs(de),Ie=[],tt=[];let We=v,rt=We,jt=o.bC([]);const $e=()=>En(rt,We,_e,Ue-ve+1,D,O,J,se.canonical);for(;ve+be<=Ue;){if(Se+=pe,Se<N||Se>=C)return null;if(_e=Te,rt=We,Ie.push(_e),G&&tt.push(rt),We=new o.P(k.getx(Se),k.gety(Se)),Te=U[Se],!Te){const Wt=zx(We,se.canonical,D,J,O);Te=Wt[3]>0?U[Se]=Wt:$e()}ve+=be;const ns=o.at([],Te,_e),us=o.bD(_e,Te);if(c&&us>0&&be>0&&o.bG(jt,ns)/(be*us)<le)return null;be=us,jt=ns}ee&&O&&(U[Se]&&(Te=$e(),be=o.bD(_e,Te),jt=o.at([],Te,_e)),U[Se]=Te);const Ae=(Ue-ve)/be,Ke=We.sub(rt)._mult(Ae)._add(rt),Ge=o.bE([],_e,jt,Ae);let ht=[0,0,1],pt=jt[0],mt=jt[1];if(te&&(ht=J.upVector(se.canonical,Ke.x,Ke.y),ht[0]!==0||ht[1]!==0||ht[2]!==1)){const ns=[ht[2],0,-ht[0]],us=o.bF([],ht,ns);o.au(ns,ns),o.au(us,us),pt=o.bG(jt,ns),mt=o.bG(jt,us)}if(c){const ns=o.bF([],ht,jt);o.au(ns,ns),o.bE(Ge,Ge,ns,c*pe)}const Pt=ye+Math.atan2(mt,pt);return Ie.push(Ge),G&&tt.push(Ke),{point:Ge,angle:Pt,path:Ie,tilePath:tt,up:ht}}function hd(p,r){const c=r.length,f=c+4*p;r.resize(f),r.float32.fill(-1/0,4*c,4*f)}function jv(p,r,c){const f=r[0],y=r[1];return p[0]=c[0]*f+c[4]*y+c[12],p[1]=c[1]*f+c[5]*y+c[13],p[3]=c[3]*f+c[7]*y+c[15],p}const fs=100;class Tv{constructor(r,c,f=new ud(r.width+200,r.height+200,25),y=new ud(r.width+200,r.height+200,25)){this.transform=r,this.grid=f,this.ignoredGrid=y,this.pitchfactor=Math.cos(r._pitch)*r.cameraToCenterDistance,this.screenRightBoundary=r.width+fs,this.screenBottomBoundary=r.height+fs,this.gridRightBoundary=r.width+200,this.gridBottomBoundary=r.height+200,this.fogState=c}placeCollisionBox(r,c,f,y,v,S,N,C,k,D,U){let O=f.projectedAnchorX,G=f.projectedAnchorY,ee=f.projectedAnchorZ;const J=f.tileAnchorX,se=f.tileAnchorY,te=f.elevation,le=f.tileID,de=r.getProjection();if(te&&le){const[tt,We,rt]=de.upVector(le.canonical,f.tileAnchorX,f.tileAnchorY),jt=de.upVectorScale(le.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;O+=tt*te*jt,G+=We*te*jt,ee+=rt*te*jt}const pe=r.projection.name==="globe",ye=r.projection.name==="globe"?o.ah(this.transform.zoom):0;if(le&&pe&&ye<1&&!S){const tt=1<<le.canonical.z,We=o.bM(J,se);o.bN(We,We,1/o.aj),o.bO(We,We,o.bM(le.canonical.x,le.canonical.y)),o.bN(We,We,1/tt),o.bP(We,We,o.bM(y[0],y[1])),We[0]=o.bQ(We[0],-.5,.5),o.bN(We,We,o.aj);const rt=o.bR(We[0],We[1],o.aj/(2*Math.PI),1);o.aA(rt,rt,v),O=o.ai(O,rt[0],ye),G=o.ai(G,rt[1],ye),ee=o.ai(ee,rt[2],ye)}const Se=this.projectAndGetPerspectiveRatio(D,O,G,ee,f.tileID,de.name==="globe"||!!te||this.transform.pitch>0,de),Te=k*Se.perspectiveRatio,_e=(f.x1*c+N.x-f.padding)*Te+Se.point.x,ve=(f.y1*c+N.y-f.padding)*Te+Se.point.y,be=(f.x2*c+N.x+f.padding)*Te+Se.point.x,Ue=(f.y2*c+N.y+f.padding)*Te+Se.point.y,Ie=Se.perspectiveRatio<=.55||Se.occluded;return!this.isInsideGrid(_e,ve,be,Ue)||!C&&this.grid.hitTest(_e,ve,be,Ue,U)||Ie?{box:[],offscreen:!1,occluded:Se.occluded}:{box:[_e,ve,be,Ue],offscreen:this.isOffscreen(_e,ve,be,Ue),occluded:!1}}placeCollisionCircles(r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J){const se=[],te=this.transform.elevation,le=r.getProjection(),de=te?te.getAtTileOffsetFunc(J,this.transform.center.lat,this.transform.worldSize,le):null,pe=new o.P(f.tileAnchorX,f.tileAnchorY);let{x:ye,y:Se,z:Te}=le.projectTilePoint(pe.x,pe.y,J.canonical);if(de){const[ht,pt,mt]=de(pe);ye+=ht,Se+=pt,Te+=mt}const _e=le.name==="globe",ve=this.projectAndGetPerspectiveRatio(N,ye,Se,Te,J,_e||!!te||this.transform.pitch>0,le),{perspectiveRatio:be}=ve,Ue=(U?S/be:S*be)/o.bU,Ie=ea(ye,Se,Te,C),tt=f.lineOffsetX*Ue,We=f.lineOffsetY*Ue,rt=o.al(r.layers[0].layout.get("text-max-angle")),jt=Math.cos(rt),$e=ve.signedDistanceFromCamera>0?Do(Ue,v,tt,We,!1,Ie,pe,f,y,C,{},te&&!U?de:null,U&&!!te,le,J,U,jt):null;let Ae=!1,Ke=!1,Ge=!0;if($e&&!ve.occluded){const ht=.5*G*be+ee,pt=new o.P(-100,-100),mt=new o.P(this.screenRightBoundary,this.screenBottomBoundary),Pt=new wv,{first:ns,last:us}=$e,Wt=ns.path.length;let as=[];for(let Ls=Wt-1;Ls>=1;Ls--)as.push(ns.path[Ls]);for(let Ls=1;Ls<us.path.length;Ls++)as.push(us.path[Ls]);const is=2.5*ht;k&&(as=as.map(([Ls,Ws,pn],Rs)=>(de&&!_e&&(pn=de(Rs<Wt-1?ns.tilePath[Wt-1-Rs]:us.tilePath[Rs-Wt+2])[2]),ea(Ls,Ws,pn,k))),as.some(Ls=>Ls[3]<=0)&&(as=[]));let Cs=[];if(as.length>0){let Ls=1/0,Ws=-1/0,pn=1/0,Rs=-1/0;for(const fn of as)Ls=Math.min(Ls,fn[0]),pn=Math.min(pn,fn[1]),Ws=Math.max(Ws,fn[0]),Rs=Math.max(Rs,fn[1]);Ws>=pt.x&&Ls<=mt.x&&Rs>=pt.y&&pn<=mt.y&&(Cs=[as.map(fn=>new o.P(fn[0],fn[1]))],(Ls<pt.x||Ws>mt.x||pn<pt.y||Rs>mt.y)&&(Cs=o.bS(Cs,pt.x,pt.y,mt.x,mt.y)))}for(const Ls of Cs){Pt.reset(Ls,.25*ht);let Ws=0;Ws=Pt.length<=.5*ht?1:Math.ceil(Pt.paddedLength/is)+1;for(let pn=0;pn<Ws;pn++){const Rs=pn/Math.max(Ws-1,1),fn=Pt.lerp(Rs),yn=fn.x+fs,Hn=fn.y+fs;se.push(yn,Hn,ht,0);const $s=yn-ht,mn=Hn-ht,gn=yn+ht,wn=Hn+ht;if(Ge=Ge&&this.isOffscreen($s,mn,gn,wn),Ke=Ke||this.isInsideGrid($s,mn,gn,wn),!c&&this.grid.hitTestCircle(yn,Hn,ht,O)&&(Ae=!0,!D))return{circles:[],offscreen:!1,collisionDetected:Ae,occluded:!1}}}}return{circles:!D&&Ae||!Ke?[]:se,offscreen:Ge,collisionDetected:Ae,occluded:ve.occluded}}queryRenderedSymbols(r){if(r.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let f=1/0,y=1/0,v=-1/0,S=-1/0;for(const D of r){const U=new o.P(D.x+fs,D.y+fs);f=Math.min(f,U.x),y=Math.min(y,U.y),v=Math.max(v,U.x),S=Math.max(S,U.y),c.push(U)}const N=this.grid.query(f,y,v,S).concat(this.ignoredGrid.query(f,y,v,S)),C={},k={};for(const D of N){const U=D.key;if(C[U.bucketInstanceId]===void 0&&(C[U.bucketInstanceId]={}),C[U.bucketInstanceId][U.featureIndex])continue;const O=[new o.P(D.x1,D.y1),new o.P(D.x2,D.y1),new o.P(D.x2,D.y2),new o.P(D.x1,D.y2)];o.bT(c,O)&&(C[U.bucketInstanceId][U.featureIndex]=!0,k[U.bucketInstanceId]===void 0&&(k[U.bucketInstanceId]=[]),k[U.bucketInstanceId].push(U.featureIndex))}return k}insertCollisionBox(r,c,f,y,v){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:f,featureIndex:y,collisionGroupID:v},r[0],r[1],r[2],r[3])}insertCollisionCircles(r,c,f,y,v){const S=c?this.ignoredGrid:this.grid,N={bucketInstanceId:f,featureIndex:y,collisionGroupID:v};for(let C=0;C<r.length;C+=4)S.insertCircle(N,r[C],r[C+1],r[C+2])}projectAndGetPerspectiveRatio(r,c,f,y,v,S,N){const C=[c,f,y,1];let k=!1;y||this.transform.pitch>0?(o.aA(C,C,r),this.fogState&&v&&N.name!=="globe"&&(k=function(O,G,ee,J,se,te){const le=te.calculateFogTileMatrix(se),de=[G,ee,J];return o.ad(de,de,le),hs(O,o.ae(de),te.pitch,te._fov)}(this.fogState,c,f,y,v.toUnwrapped(),this.transform)>.9)):jv(C,C,r);const D=C[3];return{point:new o.P((C[0]/D+1)/2*this.transform.width+fs,(-C[1]/D+1)/2*this.transform.height+fs),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(N)/D*.5,1.5),signedDistanceFromCamera:D,occluded:S&&C[2]>D||k}}isOffscreen(r,c,f,y){return f<fs||r>=this.screenRightBoundary||y<fs||c>this.screenBottomBoundary}isInsideGrid(r,c,f,y){return f>=0&&r<this.gridRightBoundary&&y>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const r=o.bx([]);return o.bo(r,r,[-100,-100,0]),r}}class ip{constructor(r,c,f,y){this.opacity=r?Math.max(0,Math.min(1,r.opacity+(r.placed?c:-c))):y&&f?1:0,this.placed=f}isHidden(){return this.opacity===0&&!this.placed}}class yu{constructor(r,c,f,y,v,S=!1){this.text=new ip(r?r.text:null,c,f,v),this.icon=new ip(r?r.icon:null,c,y,v),this.clipped=S}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class ta{constructor(r,c,f,y=!1){this.text=r,this.icon=c,this.skipFade=f,this.clipped=y}}class Ox{constructor(){this.invProjMatrix=o.bz(),this.viewportMatrix=o.bz(),this.circles=[]}}class pd{constructor(r,c,f,y,v){this.bucketInstanceId=r,this.featureIndex=c,this.sourceLayerIndex=f,this.bucketIndex=y,this.tileID=v}}class cs{constructor(r){this.crossSourceCollisions=r,this.maxGroupID=0,this.collisionGroups={}}get(r){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[r]){const c=++this.maxGroupID;this.collisionGroups[r]={ID:c,predicate:f=>f.collisionGroupID===c}}return this.collisionGroups[r]}}function jn(p,r,c,f,y){const{horizontalAlign:v,verticalAlign:S}=o.bZ(p),N=-(v-.5)*r,C=-(S-.5)*c,k=o.b_(p,f);return new o.P(N+k[0]*y,C+k[1]*y)}function Tn(p,r,c,f,y){const v=new o.P(p,r);return c&&v._rotate(f?y:-y),v}class Lo{constructor(r,c,f,y,v,S){this.transform=r.clone(),this.projection=r.projection.name,this.collisionIndex=new Tv(this.transform,v),this.buildingIndex=S,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new cs(f),this.collisionCircleArrays={},this.prevPlacement=y,y&&(y.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(r,c,f,y,v=1){const S=f.getBucket(c),N=f.latestFeatureIndex;if(!S||!N||c.fqid!==S.layerIds[0])return;const C=S.layers[0].layout,k=S.layers[0].paint,D=f.collisionBoxArray,U=Math.pow(2,this.transform.zoom-f.tileID.overscaledZ),O=f.tileSize/o.aj,G=f.tileID.toUnwrapped();this.transform.setProjection(S.projection);const ee=(J=f.tileID,se=S.getProjection(),te=this.transform,se.name===this.projection?te.calculateProjMatrix(J.toUnwrapped()):sp(te,se,J));var J,se,te;const le=C.get("text-pitch-alignment")==="map",de=C.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const pe=c.dynamicFilter(),ye=c.dynamicFilterNeedsFeature(),Se=this.transform.calculatePixelsToTileUnitsMatrix(f),Te=dd(ee,f.tileID.canonical,le,de,this.transform,S.getProjection(),Se);let _e=null;const ve=S.getProjection().createInversionMatrix(this.transform,f.tileID.canonical);if(le){const Ae=zl(ee,f.tileID.canonical,le,de,this.transform,S.getProjection(),Se);_e=o.az([],this.transform.labelPlaneMatrix,Ae)}let be=null;pe&&f.latestFeatureIndex&&(be={unwrappedTileID:G,dynamicFilter:pe,dynamicFilterNeedsFeature:ye}),this.retainedQueryData[S.bucketInstanceId]=new pd(S.bucketInstanceId,N,S.sourceLayerIndex,S.index,f.tileID);const[Ue,Ie]=S.layers[0].layout.get("text-size-scale-range"),tt=o.ay(v,Ue,Ie),[We,rt]=C.get("icon-size-scale-range"),jt=o.ay(v,We,rt),$e={bucket:S,layout:C,paint:k,posMatrix:ee,invMatrix:ve,mercatorCenter:[o.aD(this.transform.center.lng),o.aH(this.transform.center.lat)],textLabelPlaneMatrix:Te,labelToScreenMatrix:_e,clippingData:be,scale:U,textPixelRatio:O,holdingForFade:f.holdingForFade(),collisionBoxArray:D,partiallyEvaluatedTextSize:o.bH(S.textSizeData,this.transform.zoom,tt),partiallyEvaluatedIconSize:o.bH(S.iconSizeData,this.transform.zoom,jt),collisionGroup:this.collisionGroups.get(S.sourceID),latestFeatureIndex:f.latestFeatureIndex};if(y)for(const Ae of S.sortKeyRanges){const{sortKey:Ke,symbolInstanceStart:Ge,symbolInstanceEnd:ht}=Ae;r.push({sortKey:Ke,symbolInstanceStart:Ge,symbolInstanceEnd:ht,parameters:$e})}else r.push({symbolInstanceStart:0,symbolInstanceEnd:S.symbolInstances.length,parameters:$e})}attemptAnchorPlacement(r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le,de,pe,ye){const{textOffset0:Se,textOffset1:Te,crossTileID:_e}=J,ve=[Se,Te],be=jn(r,S,N,ve,C),Ue=this.collisionIndex.placeCollisionBox(te,C,c,f,y,v,Tn(be.x,be.y,k,D,this.transform.angle),ee,U,O,G.predicate);if(de){const Ie=te.getSymbolInstanceIconSize(ye,this.transform.zoom,J.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(te,Ie,de,f,y,v,Tn(be.x,be.y,k,D,this.transform.angle),ee,U,O,G.predicate).box.length===0)return}if(Ue.box.length>0){let Ie;return this.prevPlacement&&this.prevPlacement.variableOffsets[_e]&&this.prevPlacement.placements[_e]&&this.prevPlacement.placements[_e].text&&(Ie=this.prevPlacement.variableOffsets[_e].anchor),this.variableOffsets[_e]={textOffset:ve,width:S,height:N,anchor:r,textScale:C,prevAnchor:Ie},this.markUsedJustification(te,r,J,le),te.allowVerticalPlacement&&(this.markUsedOrientation(te,le,J),this.placedOrientations[_e]=le),{shift:be,placedGlyphBoxes:Ue}}}placeLayerBucketPart(r,c,f,y,v=1){const{bucket:S,layout:N,paint:C,posMatrix:k,textLabelPlaneMatrix:D,labelToScreenMatrix:U,clippingData:O,textPixelRatio:G,mercatorCenter:ee,invMatrix:J,holdingForFade:se,collisionBoxArray:te,partiallyEvaluatedTextSize:le,partiallyEvaluatedIconSize:de,collisionGroup:pe,latestFeatureIndex:ye}=r.parameters,Se=N.get("text-optional"),Te=N.get("icon-optional"),_e=N.get("text-allow-overlap"),ve=N.get("icon-allow-overlap"),be=N.get("text-rotation-alignment")==="map",Ue=N.get("icon-rotation-alignment")==="map",Ie=N.get("text-pitch-alignment")==="map",tt=C.get("symbol-z-offset"),We=N.get("symbol-elevation-reference")==="sea",rt=N.get("symbol-placement"),[jt,$e]=N.get("text-size-scale-range"),[Ae,Ke]=N.get("icon-size-scale-range"),Ge=o.ay(v,jt,$e),ht=o.ay(v,Ae,Ke),pt=N.get("text-variable-anchor"),mt=be&&rt!=="point",Pt=Ue&&rt!=="point",ns=pt&&S.hasTextData(),us=S.hasIconTextFit()&&ns&&S.hasIconData();this.transform.setProjection(S.projection);const Wt=ns||mt,as=Pt||us;let is=_e&&(ve||!S.hasIconData()||Te),Cs=ve&&(_e||!S.hasTextData()||Se);const Ls=!tt.isConstant();!S.collisionArrays&&te&&S.deserializeCollisionBoxes(te),f&&y&&S.updateCollisionDebugBuffers(this.transform.zoom,te,Ge,ht);const Ws=(Rs,fn,yn)=>{const{crossTileID:Hn,numVerticalGlyphVertices:$s}=Rs;let mn=null;if(O&&O.dynamicFilterNeedsFeature||Ls){const Pr=this.retainedQueryData[S.bucketInstanceId];mn=ye.loadFeature({featureIndex:Rs.featureIndex,bucketIndex:Pr.bucketIndex,sourceLayerIndex:Pr.sourceLayerIndex,layoutVertexArrayOffset:0})}if(O&&!(0,O.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},mn,this.retainedQueryData[S.bucketInstanceId].tileID.canonical,new o.P(Rs.tileAnchorX,Rs.tileAnchorY),this.transform.calculateDistanceTileData(O.unwrappedTileID)))return this.placements[Hn]=new ta(!1,!1,!1,!0),void c.add(Hn);const gn=tt.evaluate(mn,{});if(c.has(Hn))return;if(se)return void(this.placements[Hn]=new ta(!1,!1,!1));let wn=!1,qs=!1,Pn=!0,_n=!1,gr=!1,dn=null,Sn={box:null,offscreen:null,occluded:null},zn={box:null},Or=null,Lr=null,Br=null,vi=0,qa=0,go=0;yn.textFeatureIndex?vi=yn.textFeatureIndex:Rs.useRuntimeCollisionCircles&&(vi=Rs.featureIndex),yn.verticalTextFeatureIndex&&(qa=yn.verticalTextFeatureIndex);const Oo=Pr=>{Pr.tileID=this.retainedQueryData[S.bucketInstanceId].tileID;const Sr=this.transform.elevation;Pr.elevation=We?gn:gn+(Sr?Sr.getAtTileOffset(Pr.tileID,Pr.tileAnchorX,Pr.tileAnchorY):0),Pr.elevation+=Rs.zOffset},Vi=yn.textBox;if(Vi){Oo(Vi);const Pr=Xn=>{let Hr=o.bI.horizontal;if(S.allowVerticalPlacement&&!Xn&&this.prevPlacement){const bi=this.prevPlacement.placedOrientations[Hn];bi&&(this.placedOrientations[Hn]=bi,Hr=bi,this.markUsedOrientation(S,Hr,Rs))}return Hr},Sr=(Xn,Hr)=>{if(S.allowVerticalPlacement&&$s>0&&yn.verticalTextBox){for(const bi of S.writingModes)if(bi===o.bI.vertical?(Sn=Hr(),zn=Sn):Sn=Xn(),Sn&&Sn.box&&Sn.box.length)break}else Sn=Xn()};if(pt){let Xn=pt;if(this.prevPlacement&&this.prevPlacement.variableOffsets[Hn]){const Ir=this.prevPlacement.variableOffsets[Hn];Xn.indexOf(Ir.anchor)>0&&(Xn=Xn.filter(aa=>aa!==Ir.anchor),Xn.unshift(Ir.anchor))}const Hr=(Ir,aa,Iu)=>{const zc=S.getSymbolInstanceTextSize(le,Rs,this.transform.zoom,fn),Ud=(Ir.x2-Ir.x1)*zc+2*Ir.padding,$d=(Ir.y2-Ir.y1)*zc+2*Ir.padding,la=Rs.hasIconTextFit&&!ve?aa:null;la&&Oo(la);let yl={box:[],offscreen:!1,occluded:!1};const Wr=_e?2*Xn.length:Xn.length;for(let ca=0;ca<Wr;++ca){const Mu=this.attemptAnchorPlacement(Xn[ca%Xn.length],Ir,ee,J,Wt,Ud,$d,zc,be,Ie,G,k,pe,ca>=Xn.length,Rs,fn,S,Iu,la,le,de);if(Mu&&(yl=Mu.placedGlyphBoxes,yl&&yl.box&&yl.box.length)){wn=!0,dn=Mu.shift;break}}return yl};Sr(()=>Hr(Vi,yn.iconBox,o.bI.horizontal),()=>{const Ir=yn.verticalTextBox;return Ir&&Oo(Ir),S.allowVerticalPlacement&&!(Sn&&Sn.box&&Sn.box.length)&&$s>0&&Ir?Hr(Ir,yn.verticalIconBox,o.bI.vertical):{box:null,offscreen:null,occluded:null}}),Sn&&(wn=Sn.box,Pn=Sn.offscreen,_n=Sn.occluded);const bi=Pr(!(!Sn||!Sn.box));if(!wn&&this.prevPlacement){const Ir=this.prevPlacement.variableOffsets[Hn];Ir&&(this.variableOffsets[Hn]=Ir,this.markUsedJustification(S,Ir.anchor,Rs,bi))}}else{const Xn=(Hr,bi)=>{const Ir=S.getSymbolInstanceTextSize(le,Rs,this.transform.zoom,fn,v),aa=this.collisionIndex.placeCollisionBox(S,Ir,Hr,ee,J,Wt,new o.P(0,0),_e,G,k,pe.predicate);return aa&&aa.box&&aa.box.length&&(this.markUsedOrientation(S,bi,Rs),this.placedOrientations[Hn]=bi),aa};Sr(()=>Xn(Vi,o.bI.horizontal),()=>{const Hr=yn.verticalTextBox;return S.allowVerticalPlacement&&$s>0&&Hr?(Oo(Hr),Xn(Hr,o.bI.vertical)):{box:null,offscreen:null,occluded:null}}),Pr(!!(Sn&&Sn.box&&Sn.box.length))}}if(Or=Sn,wn=Or&&Or.box&&Or.box.length>0,Pn=Or&&Or.offscreen,_n=Or&&Or.occluded,Rs.useRuntimeCollisionCircles){const Pr=S.text.placedSymbolArray.get(Rs.centerJustifiedTextSymbolIndex>=0?Rs.centerJustifiedTextSymbolIndex:Rs.verticalPlacedTextSymbolIndex),Sr=o.bJ(S.textSizeData,le,Pr),Xn=N.get("text-padding");Lr=this.collisionIndex.placeCollisionCircles(S,_e,Pr,S.lineVertexArray,S.glyphOffsetArray,Sr,k,D,U,f,Ie,pe.predicate,Rs.collisionCircleDiameter*Sr/o.bU,Xn,this.retainedQueryData[S.bucketInstanceId].tileID),wn=_e||Lr.circles.length>0&&!Lr.collisionDetected,Pn=Pn&&Lr.offscreen,_n=Lr.occluded}if(yn.iconFeatureIndex&&(go=yn.iconFeatureIndex),yn.iconBox){const Pr=Sr=>{Oo(Sr);const Xn=Rs.hasIconTextFit&&dn?Tn(dn.x,dn.y,be,Ie,this.transform.angle):new o.P(0,0),Hr=S.getSymbolInstanceIconSize(de,this.transform.zoom,Rs.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(S,Hr,Sr,ee,J,as,Xn,ve,G,k,pe.predicate)};zn&&zn.box&&zn.box.length&&yn.verticalIconBox?(Br=Pr(yn.verticalIconBox),qs=Br.box.length>0):(Br=Pr(yn.iconBox),qs=Br.box.length>0),Pn=Pn&&Br.offscreen,gr=Br.occluded}const oa=Se||Rs.numHorizontalGlyphVertices===0&&$s===0,Pa=Te||Rs.numIconVertices===0;if(oa||Pa?Pa?oa||(qs=qs&&wn):wn=qs&&wn:qs=wn=qs&&wn,wn&&Or&&Or.box&&this.collisionIndex.insertCollisionBox(Or.box,N.get("text-ignore-placement"),S.bucketInstanceId,zn&&zn.box&&qa?qa:vi,pe.ID),qs&&Br&&this.collisionIndex.insertCollisionBox(Br.box,N.get("icon-ignore-placement"),S.bucketInstanceId,go,pe.ID),Lr&&(wn&&this.collisionIndex.insertCollisionCircles(Lr.circles,N.get("text-ignore-placement"),S.bucketInstanceId,vi,pe.ID),f)){const Pr=S.bucketInstanceId;let Sr=this.collisionCircleArrays[Pr];Sr===void 0&&(Sr=this.collisionCircleArrays[Pr]=new Ox);for(let Xn=0;Xn<Lr.circles.length;Xn+=4)Sr.circles.push(Lr.circles[Xn+0]),Sr.circles.push(Lr.circles[Xn+1]),Sr.circles.push(Lr.circles[Xn+2]),Sr.circles.push(Lr.collisionDetected?1:0)}const Ui=S.projection.name!=="globe";is=is&&(Ui||!_n),Cs=Cs&&(Ui||!gr),this.placements[Hn]=new ta(wn||is,qs||Cs,Pn||S.justReloaded),c.add(Hn)},pn=this.retainedQueryData[S.bucketInstanceId].tileID;if(S.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(S,pn),S.elevationType==="road"&&S.updateRoadElevation(pn.canonical),S.updateZOffset(),S.sortFeaturesByY){const Rs=S.getSortedSymbolIndexes(this.transform.angle);for(let fn=Rs.length-1;fn>=0;--fn){const yn=Rs[fn];Ws(S.symbolInstances.get(yn),yn,S.collisionArrays[yn])}S.hasAnyZOffset&&o.w(`${S.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(S.hasAnyZOffset){const Rs=S.getSortedIndexesByZOffset();for(let fn=0;fn<Rs.length;++fn){const yn=Rs[fn];Ws(S.symbolInstances.get(yn),yn,S.collisionArrays[yn])}}else for(let Rs=r.symbolInstanceStart;Rs<r.symbolInstanceEnd;Rs++)Ws(S.symbolInstances.get(Rs),Rs,S.collisionArrays[Rs]);if(f&&S.bucketInstanceId in this.collisionCircleArrays){const Rs=this.collisionCircleArrays[S.bucketInstanceId];o.bi(Rs.invProjMatrix,k),Rs.viewportMatrix=this.collisionIndex.getViewportMatrix()}S.justReloaded=!1}markUsedJustification(r,c,f,y){const{leftJustifiedTextSymbolIndex:v,centerJustifiedTextSymbolIndex:S,rightJustifiedTextSymbolIndex:N,verticalPlacedTextSymbolIndex:C,crossTileID:k}=f,D=o.b$(c),U=y===o.bI.vertical?C:D==="left"?v:D==="center"?S:D==="right"?N:-1;v>=0&&(r.text.placedSymbolArray.get(v).crossTileID=U>=0&&v!==U?0:k),S>=0&&(r.text.placedSymbolArray.get(S).crossTileID=U>=0&&S!==U?0:k),N>=0&&(r.text.placedSymbolArray.get(N).crossTileID=U>=0&&N!==U?0:k),C>=0&&(r.text.placedSymbolArray.get(C).crossTileID=U>=0&&C!==U?0:k)}markUsedOrientation(r,c,f){const y=c===o.bI.horizontal||c===o.bI.horizontalOnly?c:0,v=c===o.bI.vertical?c:0,{leftJustifiedTextSymbolIndex:S,centerJustifiedTextSymbolIndex:N,rightJustifiedTextSymbolIndex:C,verticalPlacedTextSymbolIndex:k}=f,D=r.text.placedSymbolArray;S>=0&&(D.get(S).placedOrientation=y),N>=0&&(D.get(N).placedOrientation=y),C>=0&&(D.get(C).placedOrientation=y),k>=0&&(D.get(k).placedOrientation=v)}commit(r){this.commitTime=r,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let f=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const y=c?c.symbolFadeChange(r):1,v=c?c.opacities:{},S=c?c.variableOffsets:{},N=c?c.placedOrientations:{};for(const C in this.placements){const k=this.placements[C],D=v[C];D?(this.opacities[C]=new yu(D,y,k.text,k.icon,null,k.clipped),f=f||k.text!==D.text.placed||k.icon!==D.icon.placed):(this.opacities[C]=new yu(null,y,k.text,k.icon,k.skipFade,k.clipped),f=f||k.text||k.icon)}for(const C in v){const k=v[C];if(!this.opacities[C]){const D=new yu(k,y,!1,!1);D.isHidden()||(this.opacities[C]=D,f=f||k.text.placed||k.icon.placed)}}for(const C in S)this.variableOffsets[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.variableOffsets[C]=S[C]);for(const C in N)this.placedOrientations[C]||!this.opacities[C]||this.opacities[C].isHidden()||(this.placedOrientations[C]=N[C]);f?this.lastPlacementChangeTime=r:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:r)}updateLayerOpacities(r,c,f,y){const v=new Set;for(const S of c){const N=S.getBucket(r);N&&S.latestFeatureIndex&&r.fqid===N.layerIds[0]&&(this.updateBucketOpacities(N,v,S,S.collisionBoxArray,f,y,S.tileID,r.scope),N.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(N,S.tileID),N.elevationType==="road"&&N.updateRoadElevation(S.tileID.canonical),N.updateZOffset())}}updateBucketOpacities(r,c,f,y,v,S,N,C){r.hasTextData()&&r.text.opacityVertexArray.clear(),r.hasIconData()&&r.icon.opacityVertexArray.clear(),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexArray.clear(),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexArray.clear();const k=r.layers[0].layout,D=r.layers[0].paint,U=!!r.layers[0].dynamicFilter(),O=new yu(null,0,!1,!1,!0),G=k.get("text-allow-overlap"),ee=k.get("icon-allow-overlap"),J=k.get("text-variable-anchor"),se=k.get("text-rotation-alignment")==="map",te=k.get("text-pitch-alignment")==="map",le=D.get("symbol-z-offset"),de=k.get("symbol-elevation-reference")==="sea",pe=!le.isConstant(),ye=new yu(null,0,G&&(ee||!r.hasIconData()||k.get("icon-optional")),ee&&(G||!r.hasTextData()||k.get("text-optional")),!0);!r.collisionArrays&&y&&(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData())&&r.deserializeCollisionBoxes(y);const Se=(_e,ve,be)=>{for(let Ue=0;Ue<ve/4;Ue++)_e.opacityVertexArray.emplaceBack(be)};let Te=0;S&&r.updateReplacement(N,S);for(let _e=0;_e<r.symbolInstances.length;_e++){const ve=r.symbolInstances.get(_e),{numHorizontalGlyphVertices:be,numVerticalGlyphVertices:Ue,crossTileID:Ie,numIconVertices:tt,tileAnchorX:We,tileAnchorY:rt}=ve;let jt=null;const $e=this.retainedQueryData[r.bucketInstanceId];pe&&ve&&$e&&(jt=f.latestFeatureIndex.loadFeature({featureIndex:ve.featureIndex,bucketIndex:$e.bucketIndex,sourceLayerIndex:$e.sourceLayerIndex,layoutVertexArrayOffset:0}));const Ae=le.evaluate(jt,{}),Ke=c.has(Ie);let Ge=this.opacities[Ie];Ke?Ge=O:Ge||(Ge=ye,this.opacities[Ie]=Ge),c.add(Ie);const ht=be>0||Ue>0,pt=tt>0,mt=this.placedOrientations[Ie],Pt=mt===o.bI.vertical,ns=mt===o.bI.horizontal||mt===o.bI.horizontalOnly;!ht&&!pt||Ge.isHidden()||Te++;let us=!1;if((ht||pt)&&S)for(const Wt of r.activeReplacements){if(o.bV(Wt,v,o.bW.Symbol,C)||Wt.min.x>We||We>Wt.max.x||Wt.min.y>rt||rt>Wt.max.y)continue;const as=o.bX(We,rt,N.canonical,Wt.footprintTileId.canonical);if(us=o.bY(as,Wt.footprint),us)break}if(ht){const Wt=us?_c:fd(Ge.text);Se(r.text,be,Pt?_c:Wt),Se(r.text,Ue,ns?_c:Wt);const as=Ge.text.isHidden(),{leftJustifiedTextSymbolIndex:is,centerJustifiedTextSymbolIndex:Cs,rightJustifiedTextSymbolIndex:Ls,verticalPlacedTextSymbolIndex:Ws}=ve,pn=r.text.placedSymbolArray,Rs=as||Pt?1:0;is>=0&&(pn.get(is).hidden=Rs),Cs>=0&&(pn.get(Cs).hidden=Rs),Ls>=0&&(pn.get(Ls).hidden=Rs),Ws>=0&&(pn.get(Ws).hidden=as||ns?1:0);const fn=this.variableOffsets[Ie];fn&&this.markUsedJustification(r,fn.anchor,ve,mt);const yn=this.placedOrientations[Ie];yn&&(this.markUsedJustification(r,"left",ve,yn),this.markUsedOrientation(r,yn,ve))}if(pt){const Wt=us?_c:fd(Ge.icon),{placedIconSymbolIndex:as,verticalPlacedIconSymbolIndex:is}=ve,Cs=r.icon.placedSymbolArray,Ls=Ge.icon.isHidden()?1:0;as>=0&&(Se(r.icon,tt,Pt?_c:Wt),Cs.get(as).hidden=Ls),is>=0&&(Se(r.icon,ve.numVerticalIconVertices,ns?_c:Wt),Cs.get(is).hidden=Ls)}if(r.hasIconCollisionBoxData()||r.hasTextCollisionBoxData()){const Wt=r.collisionArrays[_e];if(Wt){let as=new o.P(0,0),is=!0;if(Wt.textBox||Wt.verticalTextBox){if(J){const Ls=this.variableOffsets[Ie];Ls?(as=jn(Ls.anchor,Ls.width,Ls.height,Ls.textOffset,Ls.textScale),se&&as._rotate(te?this.transform.angle:-this.transform.angle)):is=!1}U&&(is=!Ge.clipped),Wt.textBox&&Ol(r.textCollisionBox.collisionVertexArray,Ge.text.placed,!is||Pt,Ae,de,as.x,as.y),Wt.verticalTextBox&&Ol(r.textCollisionBox.collisionVertexArray,Ge.text.placed,!is||ns,Ae,de,as.x,as.y)}const Cs=is&&!!(!ns&&Wt.verticalIconBox);Wt.iconBox&&Ol(r.iconCollisionBox.collisionVertexArray,Ge.icon.placed,Cs,Ae,de,ve.hasIconTextFit?as.x:0,ve.hasIconTextFit?as.y:0),Wt.verticalIconBox&&Ol(r.iconCollisionBox.collisionVertexArray,Ge.icon.placed,!Cs,Ae,de,ve.hasIconTextFit?as.x:0,ve.hasIconTextFit?as.y:0)}}}if(r.fullyClipped=Te===0,r.sortFeatures(this.transform.angle),this.retainedQueryData[r.bucketInstanceId]&&(this.retainedQueryData[r.bucketInstanceId].featureSortOrder=r.featureSortOrder),r.hasTextData()&&r.text.opacityVertexBuffer&&r.text.opacityVertexBuffer.updateData(r.text.opacityVertexArray),r.hasIconData()&&r.icon.opacityVertexBuffer&&r.icon.opacityVertexBuffer.updateData(r.icon.opacityVertexArray),r.hasIconCollisionBoxData()&&r.iconCollisionBox.collisionVertexBuffer&&r.iconCollisionBox.collisionVertexBuffer.updateData(r.iconCollisionBox.collisionVertexArray),r.hasTextCollisionBoxData()&&r.textCollisionBox.collisionVertexBuffer&&r.textCollisionBox.collisionVertexBuffer.updateData(r.textCollisionBox.collisionVertexArray),r.bucketInstanceId in this.collisionCircleArrays){const _e=this.collisionCircleArrays[r.bucketInstanceId];r.placementInvProjMatrix=_e.invProjMatrix,r.placementViewportMatrix=_e.viewportMatrix,r.collisionCircleArray=_e.circles,delete this.collisionCircleArrays[r.bucketInstanceId]}}symbolFadeChange(r){return this.fadeDuration===0?1:(r-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(r){return Math.max(0,(this.transform.zoom-r)/1.5)}hasTransitions(r){return this.stale||r-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(r,c){const f=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*f>r}setStale(){this.stale=!0}}function Ol(p,r,c,f,y,v,S){p.emplaceBack(r?1:0,c?1:0,v||0,S||0,f,y?1:0),p.emplaceBack(r?1:0,c?1:0,v||0,S||0,f,y?1:0),p.emplaceBack(r?1:0,c?1:0,v||0,S||0,f,y?1:0),p.emplaceBack(r?1:0,c?1:0,v||0,S||0,f,y?1:0)}const Cn=Math.pow(2,25),Gf=Math.pow(2,24),op=Math.pow(2,17),ap=Math.pow(2,16),Ji=Math.pow(2,9),Gr=Math.pow(2,8),TS=Math.pow(2,1);function fd(p){if(p.opacity===0&&!p.placed)return 0;if(p.opacity===1&&p.placed)return 4294967295;const r=p.placed?1:0,c=Math.floor(127*p.opacity);return c*Cn+r*Gf+c*op+r*ap+c*Ji+r*Gr+c*TS+r}const _c=0;class lp{constructor(r){this._sortAcrossTiles=r.layout.get("symbol-z-order")!=="viewport-y"&&r.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(r,c,f,y,v,S){const N=this._bucketParts;for(;this._currentTileIndex<r.length;)if(c.getBucketParts(N,y,r[this._currentTileIndex],this._sortAcrossTiles,S),this._currentTileIndex++,v())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,N.sort((C,k)=>C.sortKey-k.sortKey));this._currentPartIndex<N.length;){const C=N[this._currentPartIndex];if(c.placeLayerBucketPart(C,this._seenCrossTileIDs,f,C.symbolInstanceStart===0,S),this._currentPartIndex++,v())return!0}return!1}}class Hf{constructor(r,c,f,y,v,S,N,C,k){this.placement=new Lo(r,v,S,N,C,k),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=f,this._showCollisionBoxes=y,this._done=!1}isDone(){return this._done}continuePlacement(r,c,f,y,v){const S=o.q.now(),N=()=>{const C=o.q.now()-S;return!this._forceFullPlacement&&C>2};for(;this._currentPlacementIndex>=0;){const C=c[r[this._currentPlacementIndex]],k=this.placement.collisionIndex.transform.zoom;if(C.type==="symbol"&&(!C.minzoom||C.minzoom<=k)&&(!C.maxzoom||C.maxzoom>k)){const D=C,U=D.layout.get("symbol-z-elevate"),O=D.layout.get("symbol-sort-key").constantOr(1)!==void 0,G=D.layout.get("symbol-z-order"),ee=G==="viewport-y"||G==="auto"&&!(G!=="viewport-y"&&O),J=D.layout.get("text-allow-overlap")||D.layout.get("icon-allow-overlap")||D.layout.get("text-ignore-placement")||D.layout.get("icon-ignore-placement"),se=ee&&J,te=this._inProgressLayer=this._inProgressLayer||new lp(D),le=o.C(C.source,C.scope);if(te.continuePlacement(U||se?y[le]:f[le],this.placement,this._showCollisionBoxes,C,N,v))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(r){return this.placement.commit(r),this.placement}}const cp=512/o.aj/2;class Wf{constructor(r,c,f){this.tileID=r,this.bucketInstanceId=f,this.index=new o.c0(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const y=r.canonical.x*o.aj,v=r.canonical.y*o.aj;for(let S=0;S<c.length;S++){const{key:N,crossTileID:C,tileAnchorX:k,tileAnchorY:D}=c.get(S),U=Math.floor((y+k)*cp),O=Math.floor((v+D)*cp);this.index.add(U,O),this.keys.push(N),this.crossTileIDs.push(C)}this.index.finish()}findMatches(r,c,f){const y=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),v=cp/Math.pow(2,c.canonical.z-this.tileID.canonical.z),S=c.canonical.x*o.aj,N=c.canonical.y*o.aj;for(let C=0;C<r.length;C++){const k=r.get(C);if(k.crossTileID)continue;const{key:D,tileAnchorX:U,tileAnchorY:O}=k,G=Math.floor((S+U)*v),ee=Math.floor((N+O)*v),J=this.index.range(G-y,ee-y,G+y,ee+y).sort((se,te)=>se-te);for(const se of J){const te=this.crossTileIDs[se];if(this.keys[se]===D&&!f.has(te)){f.add(te),k.crossTileID=te;break}}}}}class ho{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Fl{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(r){const c=Math.round((r-this.lng)/360);if(c!==0)for(const f in this.indexes){const y=this.indexes[f],v={};for(const S in y){const N=y[S];N.tileID=N.tileID.unwrapTo(N.tileID.wrap+c),v[N.tileID.key]=N}this.indexes[f]=v}this.lng=r}addBucket(r,c,f){if(this.indexes[r.overscaledZ]&&this.indexes[r.overscaledZ][r.key]){if(this.indexes[r.overscaledZ][r.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(r.overscaledZ,this.indexes[r.overscaledZ][r.key])}for(let v=0;v<c.symbolInstances.length;v++)c.symbolInstances.get(v).crossTileID=0;this.usedCrossTileIDs[r.overscaledZ]||(this.usedCrossTileIDs[r.overscaledZ]=new Set);const y=this.usedCrossTileIDs[r.overscaledZ];for(const v in this.indexes){const S=this.indexes[v];if(Number(v)>r.overscaledZ)for(const N in S){const C=S[N];C.tileID.isChildOf(r)&&C.findMatches(c.symbolInstances,r,y)}else{const N=S[r.scaledTo(Number(v)).key];N&&N.findMatches(c.symbolInstances,r,y)}}for(let v=0;v<c.symbolInstances.length;v++){const S=c.symbolInstances.get(v);S.crossTileID||(S.crossTileID=f.generate(),y.add(S.crossTileID))}return this.indexes[r.overscaledZ]===void 0&&(this.indexes[r.overscaledZ]={}),this.indexes[r.overscaledZ][r.key]=new Wf(r,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(r,c){for(const f of c.crossTileIDs)this.usedCrossTileIDs[r].delete(f)}removeStaleBuckets(r){let c=!1;for(const f in this.indexes){const y=this.indexes[f];for(const v in y)r[y[v].bucketInstanceId]||(this.removeBucketCrossTileIDs(f,y[v]),delete y[v],c=!0)}return c}}class Eo{constructor(){this.layerIndexes={},this.crossTileIDs=new ho,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(r,c,f,y){let v=this.layerIndexes[r.fqid];v===void 0&&(v=this.layerIndexes[r.fqid]=new Fl);let S=!1;const N={};y.name!=="globe"&&v.handleWrapJump(f);for(const C of c){const k=C.getBucket(r);k&&r.fqid===k.layerIds[0]&&(k.bucketInstanceId||(k.bucketInstanceId=++this.maxBucketInstanceId),v.addBucket(C.tileID,k,this.crossTileIDs)&&(S=!0),N[k.bucketInstanceId]=!0)}return v.removeStaleBuckets(N)&&(S=!0),S}pruneUnusedLayers(r){const c={};r.forEach(f=>{c[f]=!0});for(const f in this.layerIndexes)c[f]||delete this.layerIndexes[f]}}const _u=771;class Fs{constructor(r,c,f,y){this.blendFunction=r,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=f,this.blendEquation=y}}Fs.Replace=[1,0,1,0],Fs.disabled=new Fs(Fs.Replace,o.am.transparent,[!1,!1,!1,!1]),Fs.unblended=new Fs(Fs.Replace,o.am.transparent,[!0,!0,!0,!0]),Fs.alphaBlended=new Fs([1,_u,1,_u],o.am.transparent,[!0,!0,!0,!0]),Fs.alphaBlendedNonPremultiplied=new Fs([770,_u,770,_u],o.am.transparent,[!0,!0,!0,!0]),Fs.multiply=new Fs([774,0,774,0],o.am.transparent,[!0,!0,!0,!0]);class Kt{constructor(r,c,f){this.func=r,this.mask=c,this.range=f}}Kt.ReadOnly=!1,Kt.ReadWrite=!0,Kt.disabled=new Kt(519,Kt.ReadOnly,[0,1]);const ja=7680;class Ss{constructor(r,c,f,y,v,S){this.test=r,this.ref=c,this.mask=f,this.fail=y,this.depthFail=v,this.pass=S}}Ss.disabled=new Ss({func:519,mask:0},0,0,ja,ja,ja);const Vr=1029,up=2305;class gs{constructor(r,c,f){this.enable=r,this.mode=c,this.frontFace=f}}function md(p,r){const c=o.c6(p,3);o.c8(p,r),o.cc(p,3,c)}function gd(p,r){const c=o.c3([]);return o.c4(c,c,-r),o.c5(c,c,-p),c}function vc(p,r){const c=[p[0],p[1],0],f=[r[0],r[1],0];if(o.ae(c)>=1e-15){const S=o.au([],c);o.c1(f,S,o.bG(f,S)),r[0]=f[0],r[1]=f[1]}const y=o.bF([],r,p);if(o.c2(y)<1e-15)return null;const v=Math.atan2(-y[1],y[0]);return gd(Math.atan2(Math.sqrt(p[0]*p[0]+p[1]*p[1]),-p[2]),v)}gs.disabled=new gs(!1,Vr,up),gs.backCCW=new gs(!0,Vr,up),gs.backCW=new gs(!0,Vr,2304),gs.frontCW=new gs(!0,1028,2304),gs.frontCCW=new gs(!0,1028,up);class Nv{constructor(r,c){this.position=r,this.orientation=c}get position(){return this._position}set position(r){if(r){const c=r instanceof o.ac?r:new o.ac(r[0],r[1],r[2]);this._renderWorldCopies&&(c.x=o.bQ(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(r,c){if(this.orientation=null,!this.position)return;const f=this.position,y=this._elevation?this._elevation.getAtPointOrZero(o.ac.fromLngLat(r)):0,v=o.ac.fromLngLat(r,y),S=[v.x-f.x,v.y-f.y,v.z-f.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=vc(S,c)}setPitchBearing(r,c){this.orientation=gd(o.al(r),o.al(-c))}}class Ta{constructor(r,c){this._transform=o.bx([]),this.orientation=c,this.position=r}get mercatorPosition(){const r=this.position;return new o.ac(r[0],r[1],r[2])}get position(){const r=o.c6(this._transform,3);return[r[0],r[1],r[2]]}set position(r){var c;r&&o.cc(this._transform,3,[(c=r)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(r){this._orientation=r||o.c3([]),r&&md(this._transform,this._orientation)}getPitchBearing(){const r=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(r[0]*r[0]+r[1]*r[1]),-r[2])}}setPitchBearing(r,c){this._orientation=gd(r,c),md(this._transform,this._orientation)}forward(){const r=o.c6(this._transform,2);return[-r[0],-r[1],-r[2]]}up(){const r=o.c6(this._transform,1);return[-r[0],-r[1],-r[2]]}right(){const r=o.c6(this._transform,0);return[r[0],r[1],r[2]]}getCameraToWorld(r,c){const f=new Float64Array(16);return o.bi(f,this.getWorldToCamera(r,c)),f}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(r,c,f){const y=this.position;o.c1(y,y,-r);const v=new Float64Array(16);return o.bn(v,[f,f,f]),o.bo(v,v,y),v[10]*=c,v}getWorldToCamera(r,c){const f=new Float64Array(16),y=new Float64Array(4),v=this.position;return o.c7(y,this._orientation),o.c1(v,v,-r),o.c8(f,y),o.bo(f,f,v),f[1]*=-1,f[5]*=-1,f[9]*=-1,f[13]*=-1,f[8]*=c,f[9]*=c,f[10]*=c,f[11]*=c,f}getCameraToClipPerspective(r,c,f,y){const v=new Float64Array(16);return o.c9(v,r,c,f,y),v}getCameraToClipOrthographic(r,c,f,y,v,S){const N=new Float64Array(16);return o.ca(N,r,c,f,y,v,S),N}getDistanceToElevation(r,c=!1){const f=r===0?0:o.cb(r,c?o.aY(this.position[1]):this.position[1]),y=this.forward();return(f-this.position[2])/y[2]}clone(){return new Ta([...this.position],[...this.orientation])}}const po={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class dp{constructor(r=0,c=0,f=0,y=0){if(isNaN(r)||r<0||isNaN(c)||c<0||isNaN(f)||f<0||isNaN(y)||y<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=r,this.bottom=c,this.left=f,this.right=y}interpolate(r,c,f){return c.top!=null&&r.top!=null&&(this.top=o.ai(r.top,c.top,f)),c.bottom!=null&&r.bottom!=null&&(this.bottom=o.ai(r.bottom,c.bottom,f)),c.left!=null&&r.left!=null&&(this.left=o.ai(r.left,c.left,f)),c.right!=null&&r.right!=null&&(this.right=o.ai(r.right,c.right,f)),this}getCenter(r,c){const f=o.ay((this.left+r-this.right)/2,0,r),y=o.ay((this.top+c-this.bottom)/2,0,c);return new o.P(f,y)}equals(r){return this.top===r.top&&this.bottom===r.bottom&&this.left===r.left&&this.right===r.right}clone(){return new dp(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const _i=15;class Fx{constructor(r,c,f,y,v,S,N){this.tileSize=512,this._renderWorldCopies=v===void 0||v,this._minZoom=r||0,this._maxZoom=c||22,this._minPitch=f??0,this._maxPitch=y??60,this.setProjection(S),this.setMaxBounds(N),this.width=0,this.height=0,this._center=new o.ci(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new dp,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Ta,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const r=new Fx(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return r._elevation=this._elevation,r._centerAltitude=this._centerAltitude,r._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,r.tileSize=this.tileSize,r.mercatorFromTransition=this.mercatorFromTransition,r.width=this.width,r.height=this.height,r.cameraElevationReference=this.cameraElevationReference,r._center=this._center,r._setZoom(this.zoom),r._seaLevelZoom=this._seaLevelZoom,r.angle=this.angle,r._fov=this._fov,r._pitch=this._pitch,r._nearZ=this._nearZ,r._farZ=this._farZ,r._averageElevation=this._averageElevation,r._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,r._unmodified=this._unmodified,r._edgeInsets=this._edgeInsets.clone(),r._camera=this._camera.clone(),r._calcMatrices(),r.freezeTileCoverage=this.freezeTileCoverage,r.frustumCorners=this.frustumCorners,r._allowWorldUnderZoom=this._allowWorldUnderZoom,r}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<_i}get elevation(){return this._elevation}set elevation(r){this._elevation!==r&&(this._elevation=r,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(r,c=!1){const f=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||f)&&this._updateCameraOnTerrain(),(r||f)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return o.aF(this.projection,["name","center","parallels"])}setProjection(r){this.projectionOptions=r||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=o.cj(this.projectionOptions);const f=this.getProjection(),y=!o.bv(c,f);return y&&this._calcMatrices(),this.mercatorFromTransition=!1,y}setOrthographicProjectionAtLowPitch(r){return this._orthographicProjectionAtLowPitch!==r&&(this._orthographicProjectionAtLowPitch=r,this._calcMatrices(),!0)}setMercatorFromTransition(){const r=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=o.cj({name:"mercator"});const c=r!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(r){this._minZoom!==r&&(this._minZoom=r,this.zoom=Math.max(this.zoom,r))}get maxZoom(){return this._maxZoom}set maxZoom(r){this._maxZoom!==r&&(this._maxZoom=r,this.zoom=Math.min(this.zoom,r))}get minPitch(){return this._minPitch}set minPitch(r){this._minPitch!==r&&(this._minPitch=r,this.pitch=Math.max(this.pitch,r))}get maxPitch(){return this._maxPitch}set maxPitch(r){this._maxPitch!==r&&(this._maxPitch=r,this.pitch=Math.min(this.pitch,r))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(r){r===void 0?r=!0:r===null&&(r=!1),this._renderWorldCopies=r}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get cameraWorldSize(){const r=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(r))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return o.cb(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new o.P(this.width,this.height)}get bearing(){return o.bQ(this.rotation,-180,180)}set bearing(r){this.rotation=r}get rotation(){return-this.angle/Math.PI*180}set rotation(r){const c=-r*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=o.ck(),o.cl(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(r){const c=o.ay(r,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(r){r=Math.max(.01,Math.min(60,r)),this._fov!==r&&(this._unmodified=!1,this._fov=o.al(r),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const r=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/r)}get averageElevation(){return this._averageElevation}set averageElevation(r){this._averageElevation=r,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(r){const c=Math.min(Math.max(r,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(r){this._zoom=r,this.scale=this.zoomScale(r),this.tileZoom=Math.floor(r),this.zoomFraction=r-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(r){this._tileCoverLift!==r&&(this._tileCoverLift=r)}_updateCameraOnTerrain(){const r=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&r===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||r===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const f=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&f.exaggeration()&&this._centerAltitudeValidForExaggeration!==f.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*f.exaggeration(),this._centerAltitudeValidForExaggeration=f.exaggeration()):(this._centerAltitude=r||0,this._centerAltitudeValidForExaggeration=f.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const r=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(r)}sampleAverageElevation(){if(!this._elevation)return 0;const r=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],f=this.horizonLineFromTop();let y=0,v=0;for(let S=0;S<c.length;S++){const N=new o.P(c[S][0]*this.width,f+c[S][1]*(this.height-f)),C=r.pointCoordinate(N);if(!C)continue;const k=1/Math.hypot(C[0]-this._camera.position[0],C[1]-this._camera.position[1]);y+=C[3]*k,v+=k}return v===0?NaN:y/v}get center(){return this._center}set center(r){r.lat===this._center.lat&&r.lng===this._center.lng||(this._unmodified=!1,this._center=r,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const r=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),f=this.pixelsPerMeter/this.worldSize*c,y=this._mercatorZfromZoom(r),v=this._mercatorZfromZoom(this._maxZoom),S=Math.max(y-f,v);this._setZoom(this._zoomFromMercatorZ(S))}get padding(){return this._edgeInsets.toJSON()}set padding(r){this._edgeInsets.equals(r)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,r,1),this._calcMatrices())}computeZoomRelativeTo(r){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,r.toAltitude()));let f;f=r.z<this._camera.position[2]?[c.x,c.y,c.z]:[r.x,r.y,r.z];const y=o.ae(o.at([],this._camera.position,f));return o.ay(this._zoomFromMercatorZ(y),this._minZoom,this._maxZoom)}setFreeCameraOptions(r){if(!this.height||!r.position&&!r.orientation)return;this._updateCameraState();let c=!1;if(r.orientation&&!o.cm(r.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(r.orientation)),r.position){const f=[r.position.x,r.position.y,r.position.z];o.cn(f,this._camera.position)||(this._setCameraPosition(f),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const r=this._camera.position,c=new Nv;return c.position=new o.ac(r[0],r[1],r[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(r){if(!o.co(r))return!1;o.cp(r,r);const c=o.cq([],[0,0,-1],r),f=o.cq([],[0,-1,0],r);if(f[2]<0)return!1;const y=vc(c,f);return!!y&&(this._camera.orientation=y,!0)}_setCameraPosition(r){const c=this.zoomScale(this.minZoom)*this.tileSize,f=this.zoomScale(this.maxZoom)*this.tileSize,y=this.cameraToCenterDistance;r[2]=o.ay(r[2],y/f,y/c),this._camera.position=r}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(r){return this._edgeInsets.equals(r)}interpolatePadding(r,c,f){this._unmodified=!1,this._edgeInsets.interpolate(r,c,f),this._constrain(),this._calcMatrices()}coveringZoomLevel(r){const c=(r.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/r.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(r){const c=[new o.cr(0,r)];if(this.renderWorldCopies){const f=this.pointCoordinate(new o.P(0,0)),y=this.pointCoordinate(new o.P(this.width,0)),v=this.pointCoordinate(new o.P(this.width,this.height)),S=this.pointCoordinate(new o.P(0,this.height)),N=Math.floor(Math.min(f.x,y.x,v.x,S.x)),C=Math.floor(Math.max(f.x,y.x,v.x,S.x)),k=1;for(let D=N-k;D<=C+k;D++)D!==0&&c.push(new o.cr(D,r))}return c}isLODDisabled(r){return(!r||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(r,c,f){let y=[];const v=f!=null,S=!v;if(S&&this.zoom<c||v&&f[0]===0&&f[1]===0)return y;const N=new Set,C=(D,U,O,G,ee)=>{const J=o.cV(U,D,O,G,ee);N.has(J)||(y.push(new o.aM(D,U,O,G,ee)),N.add(J))};for(let D=0;D<r.length;D++){const U=r[D];if(S&&U.canonical.z!==c)continue;const O=U.canonical,G=U.overscaledZ,ee=U.wrap,J=1<<O.z,se=O.x+1<J,te=O.x>0,le=O.y+1<J,de=O.y>0,pe=U.wrap-(te?0:1),ye=U.wrap+(se?0:1),Se=te?O.x-1:J-1,Te=se?O.x+1:0;if(v)f[0]<0?(C(G,ye,O.z,Te,O.y),f[1]<0&&le&&(C(G,ee,O.z,O.x,O.y+1),C(G,ye,O.z,Te,O.y+1)),f[1]>0&&de&&(C(G,ee,O.z,O.x,O.y-1),C(G,ye,O.z,Te,O.y-1))):f[0]>0?(C(G,pe,O.z,Se,O.y),f[1]<0&&le&&(C(G,ee,O.z,O.x,O.y+1),C(G,pe,O.z,Se,O.y+1)),f[1]>0&&de&&(C(G,ee,O.z,O.x,O.y-1),C(G,pe,O.z,Se,O.y-1))):f[1]<0&&le?C(G,ee,O.z,O.x,O.y+1):de&&C(G,ee,O.z,O.x,O.y-1);else{const _e=U.visibleQuadrants;1&_e&&(C(G,pe,O.z,Se,O.y),de&&(C(G,ee,O.z,O.x,O.y-1),C(G,pe,O.z,Se,O.y-1))),2&_e&&(C(G,ye,O.z,Te,O.y),de&&(C(G,ee,O.z,O.x,O.y-1),C(G,ye,O.z,Te,O.y-1))),4&_e&&(C(G,pe,O.z,Se,O.y),le&&(C(G,ee,O.z,O.x,O.y+1),C(G,pe,O.z,Se,O.y+1))),8&_e&&(C(G,ye,O.z,Te,O.y),le&&(C(G,ee,O.z,O.x,O.y+1),C(G,ye,O.z,Te,O.y+1)))}}const k=[];for(const D of y)y.some(U=>D.isChildOf(U))||k.push(D);if(y=k.filter(D=>!r.some(U=>!!(D.overscaledZ<c&&U.isChildOf(D))||D.equals(U)||D.isChildOf(U))),S){const D=1<<c,U=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),O=[D*U.x,D*U.y],G=4,ee=G*G;y=y.filter(J=>{const se=J.canonical.x+.5-O[0],te=J.canonical.y+.5-O[1];return se*se+te*te<ee})}return y}extendTileCoverToNearPlane(r,c,f){const y=[],v=new Set;for(const le of r)v.add(le.key);const S=(le,de,pe,ye,Se)=>{const Te=o.cV(de,le,pe,ye,Se);v.has(Te)||(y.push(new o.aM(le,de,pe,ye,Se)),v.add(Te))},N=r.reduce((le,de)=>Math.max(le,de.overscaledZ),f),C=1<<f,k=[new o.P(0,0),new o.P(o.aj,0),new o.P(o.aj,o.aj),new o.P(0,o.aj)],D=new o.P(0,0),U=new o.P(0,0),O=(le,de)=>{const pe=Math.floor(le[0]),ye=Math.floor(le[1]),Se=(le[0]-pe)*o.aj,Te=(le[1]-ye)*o.aj,_e=Math.floor(de[0]),ve=Math.floor(de[1]),be=(de[0]-_e)*o.aj,Ue=(de[1]-ve)*o.aj;for(let Ie=-1;Ie<=1;Ie++){const tt=pe+Ie;if(!(tt<0||tt>=C)){D.x=Se-Ie*o.aj,U.x=be-(tt-_e)*o.aj;for(let We=-1;We<=1;We++){const rt=ye+We;D.y=Te-We*o.aj,U.y=Ue-(rt-ve)*o.aj,o.cW(D,U,k)&&S(N,0,f,tt,rt)}}}},G=c.points,ee=G[o.cs],J=G[o.ct],se=this._projectToGround(ee,G[o.cu]),te=this._projectToGround(J,G[o.cv]);return O(ee,se),O(J,te),y}_projectToGround(r,c){return o.cw(o.cx(),r,c,r[2]/(r[2]-c[2]))}coveringTiles(r){let c=this.coveringZoomLevel(r);const f=c,y=this.elevation&&this.elevation.exaggeration(),v=y&&!r.isTerrainDEM,S=this.projection.name==="mercator";if(r.minzoom!==void 0&&c<r.minzoom)return[];r.maxzoom!==void 0&&c>r.maxzoom&&(c=r.maxzoom);const N=this.locationCoordinate(this.center),C=this.center.lat,k=1<<c,D=[k*N.x,k*N.y,0],U=this.projection.name==="globe",O=!U,G=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,O),ee=U?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),J=k*o.cb(1,this.center.lat),se=this._camera.position[2]/o.cb(1,this.center.lat),te=[k*ee.x,k*ee.y,se*(O?1:J)],le=U||y,de=this.cameraToCenterDistance/r.tileSize*(r.roundZoom?1:.502),pe=this.isLODDisabled(!0)?c:0;let ye;if(this._elevation&&r.isTerrainDEM)ye=1e4*this._elevation.exaggeration();else if(this._elevation){const Ae=this._elevation.getMinMaxForVisibleTiles();ye=Ae?Ae.max:this._centerAltitude}else ye=this._centerAltitude;const Se=r.isTerrainDEM?-ye:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?o.cz(this):1,_e=Ae=>{const Ge=new o.ac(Ae.x+25e-6,Ae.y,Ae.z),ht=new o.ac(Ae.x,Ae.y+25e-6,Ae.z),pt=Ae.toLngLat(),mt=Ge.toLngLat(),Pt=ht.toLngLat(),ns=this.locationCoordinate(pt),us=this.locationCoordinate(mt),Wt=this.locationCoordinate(Pt),as=Math.hypot(us.x-ns.x,us.y-ns.y),is=Math.hypot(Wt.x-ns.x,Wt.y-ns.y);return Math.sqrt(as*is)*Te/25e-6},ve=Ae=>{const Ke=ye,Ge=Se;return{aabb:o.cC(this,k,0,0,0,Ae,Ge,Ke,this.projection),zoom:0,x:0,y:0,minZ:Ge,maxZ:Ke,wrap:Ae,fullyVisible:!1}},be=[];let Ue=[];const Ie=c,tt=r.reparseOverscaled?f:c,We=(se-this._centerAltitude)*J,rt=Ae=>{if(!this._elevation||!Ae.tileID||!S)return;const Ke=this._elevation.getMinMaxForTile(Ae.tileID),Ge=Ae.aabb;Ke?(Ge.min[2]=Ke.min,Ge.max[2]=Ke.max,Ge.center[2]=(Ge.min[2]+Ge.max[2])/2):(Ae.shouldSplit=$e(Ae),Ae.shouldSplit||(Ge.min[2]=Ge.max[2]=Ge.center[2]=this._centerAltitude))},jt=(Ae,Ke)=>{if(.707*Ke<Ae)return 1;const Ge=Ke/Ae;return Ge/(1.4144271570014144+(Math.pow(1.1,Ge-1.4144271570014144+1)-1)/(1.1-1)-1)},$e=Ae=>{if(Ae.zoom<pe)return!0;if(Ae.zoom===Ie)return!1;if(Ae.shouldSplit!=null)return Ae.shouldSplit;const Ke=Ae.aabb.distanceX(te),Ge=Ae.aabb.distanceY(te);let ht=We,pt=1;if(U){ht=Ae.aabb.distanceZ(te);const is=Math.pow(2,Ae.zoom),Cs=o.aY((Ae.y+1)/is),Ls=o.aY(Ae.y/is),Ws=Math.min(Math.max(C,Cs),Ls),pn=o.c_(Ws)/o.c_(C);if(pt=Ws===C?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,pn/this._mercatorScaleRatio),this.zoom<=o.cX&&Ae.zoom===Ie-1&&pn>=.9)return!0}else if(v&&(ht=Ae.aabb.distanceZ(te)*J),this.projection.isReprojectedInTileSpace&&f<=5){const is=Math.pow(2,Ae.zoom),Cs=_e(new o.ac((Ae.x+.5)/is,(Ae.y+.5)/is));pt=Cs>.85?1:Cs}if(!S){const is=Math.sqrt(Ke*Ke+Ge*Ge+ht*ht);let Cs=(1<<Ie-Ae.zoom)*de*pt;return Cs*=jt(Math.max(ht,We),is),is<Cs}let mt=Number.MAX_VALUE,Pt=0;const ns=Ae.aabb.getCorners(),us=[];for(const is of ns){o.at(us,is,te),U||(v?us[2]*=J:us[2]=We);const Cs=o.bG(us,this._camera.forward());Cs<mt&&(mt=Cs,Pt=Math.abs(us[2]))}let Wt=(1<<Ie-Ae.zoom)*de*pt;if(Wt*=jt(Math.max(Pt,We),mt),mt<Wt)return!0;const as=Ae.aabb.closestPoint(D);return as[0]===D[0]&&as[1]===D[1]};if(this.renderWorldCopies)for(let Ae=1;Ae<=3;Ae++)be.push(ve(-Ae)),be.push(ve(Ae));for(be.push(ve(0));be.length>0;){const Ae=be.pop(),Ke=Ae.x,Ge=Ae.y;let ht=Ae.fullyVisible;const pt=()=>this.projection.name==="globe"&&(Ae.y===0||Ae.y===(1<<Ae.zoom)-1);if(!ht){let mt=le?Ae.aabb.intersects(G):Ae.aabb.intersectsFlat(G);if(mt===0&&pt()){const Pt=new o.cA(Ae.zoom,Ke,Ge);mt=o.cB(this,k,Pt,!0).intersects(G)}if(mt===0)continue;ht=mt===2}if(Ae.zoom!==Ie&&$e(Ae))for(let mt=0;mt<4;mt++){const Pt=(Ke<<1)+mt%2,ns=(Ge<<1)+(mt>>1),us={aabb:S?Ae.aabb.quadrant(mt):o.cC(this,k,Ae.zoom+1,Pt,ns,Ae.wrap,Ae.minZ,Ae.maxZ,this.projection),zoom:Ae.zoom+1,x:Pt,y:ns,wrap:Ae.wrap,fullyVisible:ht,tileID:void 0,shouldSplit:void 0,minZ:Ae.minZ,maxZ:Ae.maxZ};v&&!U&&(us.tileID=new o.aM(Ae.zoom+1===Ie?tt:Ae.zoom+1,Ae.wrap,Ae.zoom+1,Pt,ns),rt(us)),be.push(us)}else{const mt=Ae.zoom===Ie?tt:Ae.zoom;if(r.minzoom&&r.minzoom>mt)continue;let Pt=0;if(!ht){let as=le?Ae.aabb.intersectsPrecise(G):Ae.aabb.intersectsPreciseFlat(G);if(as===0&&pt()){const is=new o.cA(Ae.zoom,Ke,Ge);as=o.cB(this,k,is,!0).intersectsPrecise(G)}if(as===0)continue;if(r.calculateQuadrantVisibility)if(G.containsPoint(Ae.aabb.center))Pt=15;else for(let is=0;is<4;is++)Ae.aabb.quadrant(is).intersects(G)!==0&&(Pt|=1<<is)}const ns=D[0]-(.5+Ke+(Ae.wrap<<Ae.zoom))*(1<<c-Ae.zoom),us=D[1]-.5-Ge,Wt=Ae.tileID?Ae.tileID:new o.aM(mt,Ae.wrap,Ae.zoom,Ke,Ge);r.calculateQuadrantVisibility&&(Wt.visibleQuadrants=Pt),Ue.push({tileID:Wt,distanceSq:ns*ns+us*us})}}if(this.fogCullDistSq){const Ae=this.fogCullDistSq,Ke=this.horizonLineFromTop();Ue=Ue.filter(Ge=>{const ht=[0,0,0,1],pt=[o.aj,o.aj,0,1],mt=this.calculateFogTileMatrix(Ge.tileID.toUnwrapped());o.aA(ht,ht,mt),o.aA(pt,pt,mt);const Pt=o.cD([],ht,pt),ns=o.cE([],ht,pt),us=o.cY(Pt,ns);if(us===0)return!0;let Wt=!1;const as=this._elevation;if(as&&us>Ae&&Ke!==0){const is=this.calculateProjMatrix(Ge.tileID.toUnwrapped());let Cs;r.isTerrainDEM||(Cs=as.getMinMaxForTile(Ge.tileID)),Cs||(Cs={min:Se,max:ye});const Ls=o.cF(this.rotation),Ws=[Ls[0]*o.aj,Ls[1]*o.aj,Cs.max];o.ad(Ws,Ws,is),Wt=(1-Ws[1])*this.height*.5<Ke}return us<Ae||Wt})}return Ue.sort((Ae,Ke)=>Ae.distanceSq-Ke.distanceSq).map(Ae=>Ae.tileID)}resize(r,c){this.width=r,this.height=c,this.pixelsToGLUnits=[2/r,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(r){return Math.pow(2,r)}scaleZoom(r){return Math.log(r)/Math.LN2}project(r){const c=o.ay(r.lat,-o.cG,o.cG),f=this.projection.project(r.lng,c);return new o.P(f.x*this.worldSize,f.y*this.worldSize)}unproject(r){return this.projection.unproject(r.x/this.worldSize,r.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/o.cb(1,this.center.lat)/this.worldSize}setLocationAtPoint(r,c){let f,y;const v=this.centerPoint;if(this.projection.name==="globe"){const N=this.worldSize;f=(c.x-v.x)/N,y=(c.y-v.y)/N}else{const N=this.pointCoordinate(c),C=this.pointCoordinate(v);f=N.x-C.x,y=N.y-C.y}const S=this.locationCoordinate(r);this.setLocation(new o.ac(S.x-f,S.y-y))}setLocation(r){this.center=this.coordinateLocation(r),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(r,c){return this.projection.locationPoint(this,r,c)}locationPoint3D(r,c){return this.projection.locationPoint(this,r,c,!0)}pointLocation(r){return this.coordinateLocation(this.pointCoordinate(r))}pointLocation3D(r,c){return this.coordinateLocation(this.pointCoordinate3D(r,c))}locationCoordinate(r,c){const f=c?o.cb(c,r.lat):void 0,y=this.projection.project(r.lng,r.lat);return new o.ac(y.x,y.y,f)}coordinateLocation(r){return this.projection.unproject(r.x,r.y)}pointRayIntersection(r,c){const f=c??this._centerAltitude,y=[r.x,r.y,0,1],v=[r.x,r.y,1,1];o.aA(y,y,this.pixelMatrixInverse),o.aA(v,v,this.pixelMatrixInverse);const S=v[3];o.cH(y,y,1/y[3]),o.cH(v,v,1/S);const N=y[2],C=v[2];return{p0:y,p1:v,t:N===C?0:(f-N)/(C-N)}}screenPointToMercatorRay(r){const c=[r.x,r.y,0,1],f=[r.x,r.y,1,1];return o.aA(c,c,this.pixelMatrixInverse),o.aA(f,f,this.pixelMatrixInverse),o.cH(c,c,1/c[3]),o.cH(f,f,1/f[3]),c[2]=o.cb(c[2],this._center.lat)*this.worldSize,f[2]=o.cb(f[2],this._center.lat)*this.worldSize,o.cH(c,c,1/this.worldSize),o.cH(f,f,1/this.worldSize),new o.av([c[0],c[1],c[2]],o.au([],o.at([],f,c)))}rayIntersectionCoordinate(r){const{p0:c,p1:f,t:y}=r,v=o.cb(c[2],this._center.lat),S=o.cb(f[2],this._center.lat);return new o.ac(o.ai(c[0],f[0],y)/this.worldSize,o.ai(c[1],f[1],y)/this.worldSize,o.ai(v,S,y))}pointCoordinate(r,c=this._centerAltitude){return this.projection.pointCoordinate(this,r.x,r.y,c)}pointCoordinate3D(r,c){if(!this.elevation)return this.pointCoordinate(r,c);let f=this.projection.pointCoordinate3D(this,r.x,r.y);if(f)return new o.ac(f[0],f[1],f[2]);let y=0,v=this.horizonLineFromTop();if(r.y>v)return this.pointCoordinate(r,c);const S=.02*v,N=r.clone();for(let C=0;C<10&&v-y>S;C++){N.y=o.ai(y,v,.66);const k=this.projection.pointCoordinate3D(this,N.x,N.y);k?(v=N.y,f=k):y=N.y}return f?new o.ac(f[0],f[1],f[2]):this.pointCoordinate(r)}isPointAboveHorizon(r){return this.projection.isPointAboveHorizon(this,r)}isPointOnSurface(r){if(r.y<0||r.y>this.height||r.x<0||r.x>this.width)return!1;if(this.elevation||this.zoom>=o.cI)return!this.isPointAboveHorizon(r);const c=this.pointCoordinate(r);return c.y>=0&&c.y<=1}_coordinatePoint(r,c){const f=c&&this.elevation?this.elevation.getAtPointOrZero(r,this._centerAltitude):this._centerAltitude,y=[r.x*this.worldSize,r.y*this.worldSize,f+r.toAltitude(),1];return o.aA(y,y,this.pixelMatrix),y[3]>0?new o.P(y[0]/y[3],y[1]/y[3]):new o.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:r,left:c}=this._edgeInsets,f=this.height-this._edgeInsets.bottom,y=this.width-this._edgeInsets.right,v=this.pointLocation3D(new o.P(c,r)),S=this.pointLocation3D(new o.P(y,r)),N=this.pointLocation3D(new o.P(y,f)),C=this.pointLocation3D(new o.P(c,f));let k=Math.min(v.lng,S.lng,N.lng,C.lng),D=Math.max(v.lng,S.lng,N.lng,C.lng),U=Math.min(v.lat,S.lat,N.lat,C.lat),O=Math.max(v.lat,S.lat,N.lat,C.lat);const G=Math.pow(2,-this.zoom)/16*270,ee=this.projection.name==="globe"?1:4,J=(se,te,le,de,pe)=>{const ye=(se+le)/2,Se=(te+de)/2,Te=new o.P(ye,Se),{lng:_e,lat:ve}=this.pointLocation3D(Te),be=Math.max(0,k-_e,U-ve,_e-D,ve-O);k=Math.min(k,_e),D=Math.max(D,_e),U=Math.min(U,ve),O=Math.max(O,ve),(pe<ee||be>G)&&(J(se,te,ye,Se,pe+1),J(ye,Se,le,de,pe+1))};if(J(c,r,y,r,1),J(y,r,y,f,1),J(y,f,c,f,1),J(c,f,c,r,1),this.projection.name==="globe"){const[se,te]=o.cJ(this);se?(O=90,D=180,k=-180):te&&(U=-90,D=180,k=-180)}return new o.aG(new o.ci(k,U),new o.ci(D,O))}_getBoundsRectangular(r,c){const{top:f,left:y}=this._edgeInsets,v=this.height-this._edgeInsets.bottom,S=this.width-this._edgeInsets.right,N=new o.P(y,f),C=new o.P(S,f),k=new o.P(S,v),D=new o.P(y,v);let U=this.pointCoordinate(N,r),O=this.pointCoordinate(C,r);const G=this.pointCoordinate(k,c),ee=this.pointCoordinate(D,c),J=(se,te)=>(te.y-se.y)/(te.x-se.x);return U.y>1&&O.y>=0?U=new o.ac((1-ee.y)/J(ee,U)+ee.x,1):U.y<0&&O.y<=1&&(U=new o.ac(-ee.y/J(ee,U)+ee.x,0)),O.y>1&&U.y>=0?O=new o.ac((1-G.y)/J(G,O)+G.x,1):O.y<0&&U.y<=1&&(O=new o.ac(-G.y/J(G,O)+G.x,0)),new o.aG().extend(this.coordinateLocation(U)).extend(this.coordinateLocation(O)).extend(this.coordinateLocation(ee)).extend(this.coordinateLocation(G))}_getBoundsRectangularTerrain(){const r=this.elevation;if(!r.visibleDemTiles.length||r.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=r.visibleDemTiles.reduce((f,y)=>{if(y.dem){const v=y.dem.tree;f.min=Math.min(f.min,v.minimums[0]),f.max=Math.max(f.max,v.maximums[0])}return f},{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*r.exaggeration(),c.max*r.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(r=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,f=this.height/2-c*(1-this._horizonShift);return r?Math.max(0,f):f}getMaxBounds(){return this.maxBounds}setMaxBounds(r){this.maxBounds=r,this.minLat=-o.cG,this.maxLat=o.cG,this.minLng=-180,this.maxLng=180,r&&(this.minLat=r.getSouth(),this.maxLat=r.getNorth(),this.minLng=r.getWest(),this.maxLng=r.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=o.aD(this.minLng)*this.tileSize,this.worldMaxX=o.aD(this.maxLng)*this.tileSize,this.worldMinY=o.aH(this.maxLat)*this.tileSize,this.worldMaxY=o.aH(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(r,c){return this.projection.createTileMatrix(this,c,r)}calculateDistanceTileData(r){const c=r.key,f=this._distanceTileDataCache;if(f[c])return f[c];const y=r.canonical,v=1/this.height,S=this.cameraWorldSize,N=S/this.zoomScale(y.z),C=(y.x+Math.pow(2,y.z)*r.wrap)*N,k=y.y*N,D=this.point;D.x*=S/this.worldSize,D.y*=S/this.worldSize;const U=this.angle,O=Math.sin(-U),G=-Math.cos(-U);return f[c]={bearing:[O,G],center:[(D.x-C)*v,(D.y-k)*v],scale:N/o.aj*v},f[c]}calculateFogTileMatrix(r){const c=r.key,f=this._fogTileMatrixCache;if(f[c])return f[c];const y=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,r);return o.az(y,this.worldToFogMatrix,y),f[c]=new Float32Array(y),f[c]}calculateProjMatrix(r,c=!1,f=!1){const y=r.key;let v;if(v=f?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,v[y])return v[y];const S=this.calculatePosMatrix(r,this.worldSize);let N;return N=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:f?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,o.az(S,N,S),v[y]=new Float32Array(S),v[y]}calculatePixelsToTileUnitsMatrix(r){const c=r.tileID.key,f=this._pixelsToTileUnitsCache;if(f[c])return f[c];const y=o.cK(r,this);return f[c]=y,f[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const r=1/this.worldSize,c=o.bn([],[r,r,r]);return o.az(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const r=this._elevation;this._updateCameraState();const c=o.cb(1,this._center.lat)*this.worldSize,f=this._computeCameraPosition(c),y=this._camera.forward(),v=o.cb(1,this._center.lat);f[2]/=v,y[2]/=v,o.au(y,y);const S=r.raycast(f,y,r.exaggeration());if(S){const N=o.bE([],f,y,S),C=new o.ac(N[0],N[1],o.cb(N[2],o.aY(N[1]))),k=(C.z+o.ae([C.x-f[0],C.y-f[1],C.z-f[2]*v]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(k),this._centerAltitude=C.toAltitude(),this._center=this.coordinateLocation(C),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(r=!1){if(!this._elevation)return;const c=this._elevation,f=o.cb(1,this._center.lat)*this.worldSize,y=this._computeCameraPosition(f),v=c.getAtPointOrZero(new o.ac(...y)),S=this.pixelsPerMeter/this.worldSize*v,N=this._minimumHeightOverTerrain(),C=y[2]-S;if(C<=N)if(C<0||r){const k=this.locationCoordinate(this._center,this._centerAltitude),D=[y[0],y[1],k.z-y[2]],U=o.ae(D);D[2]-=(N-C)/this._pixelsPerMercatorPixel;const O=o.ae(D);if(O===0)return;o.c1(D,D,U/O*this._pixelsPerMercatorPixel),this._camera.position=[y[0],y[1],k.z*this._pixelsPerMercatorPixel-D[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const r=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||r){const O=this.center;return O.lat=o.ay(O.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!r)&&(O.lng=o.ay(O.lng,this.minLng,this.maxLng)),this.center=O,void(this._constraining=!1)}const c=this._unmodified,{x:f,y}=this.point;let v=0,S=f,N=y;const C=this.width/2,k=this.height/2,D=this.worldMinY*this.scale,U=this.worldMaxY*this.scale;if(y-k<D&&(N=D+k),y+k>U&&(N=U-k),U-D<this.height&&(v=Math.max(v,this.height/(U-D)),N=(U+D)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const O=this.worldMinX*this.scale,G=this.worldMaxX*this.scale,ee=this.worldSize/2-(O+G)/2;S=(f+ee+this.worldSize)%this.worldSize-ee,S-C<O&&(S=O+C),S+C>G&&(S=G-C),G-O<this.width&&(v=Math.max(v,this.width/(G-O)),S=(G+O)/2)}S===f&&N===y||this._allowWorldUnderZoom||(this.center=this.unproject(new o.P(S,N))),v&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(v)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let r=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(r=Math.max(r,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),r}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const r=this.centerOffset,c=this.projection.name==="globe",f=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=o.cb(1,this.center.lat)/o.cb(1,o.c$));const y=o.cL(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,y),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const v=this.projection.zAxisUnit==="meters"?f:1,S=this._camera.getWorldToCamera(this.worldSize,v);let N;const C=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(C[8]=2*-r.x/this.width,C[9]=2*r.y/this.height,this.isOrthographic){let ve=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),be=ve*this.aspect,Ue=-be,Ie=-ve;be-=r.x,Ue-=r.x,ve+=r.y,Ie+=r.y,N=this._camera.getCameraToClipOrthographic(Ue,be,Ie,ve,this._nearZ,this._farZ),((tt,We,rt,jt)=>{for(let $e=0;$e<16;$e++)tt[$e]=o.ai(We[$e],rt[$e],jt)})(N,N,C,o.cZ(this.pitch>=_i?1:this.pitch/_i))}else N=C;const k=o.cM([],C,S);let D=o.cM([],N,S);if(this.projection.isReprojectedInTileSpace){const ve=this.locationCoordinate(this.center),be=o.bx([]);o.bo(be,be,[ve.x*this.worldSize,ve.y*this.worldSize,0]),o.az(be,be,o.cN(this)),o.bo(be,be,[-ve.x*this.worldSize,-ve.y*this.worldSize,0]),o.az(D,D,be),o.az(k,k,be),this.inverseAdjustmentMatrix=o.cO(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=o.cP([],D,[this.worldSize,this.worldSize,this.worldSize/v,1]),this.projMatrix=D,this.invProjMatrix=o.bi(new Float64Array(16),this.projMatrix),c){const ve=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);ve[8]=2*-r.x/this.width,ve[9]=2*r.y/this.height,this.expandedFarZProjMatrix=o.cM([],ve,S)}else this.expandedFarZProjMatrix=this.projMatrix;const U=o.bi([],N);this.frustumCorners=o.cQ.fromInvProjectionMatrix(U,this.horizonLineFromTop(),this.height),this.cameraFrustum=o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const O=new Float32Array(16);o.bx(O),o.cP(O,O,[1,-1,1]),o.cR(O,O,this._pitch),o.by(O,O,this.angle);const G=o.c9(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=o.bw(G);const ee=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;G[8]=2*-r.x/this.width,G[9]=2*(r.y+ee)/this.height,this.skyboxMatrix=o.az(O,G,O);const J=this.point,se=J.x,te=J.y,le=this.width%2/2,de=this.height%2/2,pe=Math.cos(this.angle),ye=Math.sin(this.angle),Se=se-Math.round(se)+pe*le+ye*de,Te=te-Math.round(te)+pe*de+ye*le,_e=new Float64Array(D);if(o.bo(_e,_e,[Se>.5?Se-1:Se,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=_e,D=o.bz(),o.cP(D,D,[this.width/2,-this.height/2,1]),o.bo(D,D,[1,-1,0]),this.labelPlaneMatrix=D,D=o.bz(),o.cP(D,D,[1,-1,1]),o.bo(D,D,[-1,-1,0]),o.cP(D,D,[2/this.width,2/this.height,1]),this.glCoordMatrix=D,this.pixelMatrix=o.az(new Float64Array(16),this.labelPlaneMatrix,k),this._calcFogMatrices(),this._distanceTileDataCache={},D=o.bi(new Float64Array(16),this.pixelMatrix),!D)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=D,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=o.cS(this);const ve=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=o.ad(ve,ve,S),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=D;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const r=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,f=this._camera.position,y=1/this.height/this._pixelsPerMercatorPixel,v=[r,r,c];o.c1(v,v,y),o.c1(f,f,-1),o.cT(f,f,v);const S=o.bz();o.bo(S,S,f),o.cP(S,S,v),this.mercatorFogMatrix=S,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(r,c,y)}_computeCameraPosition(r){const c=(r=r||this.pixelsPerMeter)/this.pixelsPerMeter,f=this._camera.forward(),y=this.point,v=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-r/this.worldSize*this._centerAltitude;return[y.x/this.worldSize-f[0]*v,y.y/this.worldSize-f[1]*v,r/this.worldSize*this._centerAltitude-f[2]*v]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(r){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),f=this._camera.position[2],y=r[2];let v=1;this.projection.wrap&&(this.center=this.center.wrap()),y>0&&(v=Math.min((c-f)/y,1)),this._camera.position=o.bE([],this._camera.position,r,v),this._updateStateFromCamera()}_updateStateFromCamera(){const r=this._camera.position,c=this._camera.forward(),{pitch:f,bearing:y}=this._camera.getPitchBearing(),v=o.cb(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,S=this._mercatorZfromZoom(this._maxZoom)*Math.cos(o.al(this._maxPitch)),N=Math.max((r[2]-v)/Math.cos(f),S),C=this._zoomFromMercatorZ(N);o.bE(r,r,c,N),this._pitch=o.ay(f,o.al(this.minPitch),o.al(this.maxPitch)),this.angle=o.bQ(y,-Math.PI,Math.PI),this._setZoom(o.ay(C,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new o.ac(r[0],r[1],r[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(r){return Math.pow(2,r)*this.tileSize}_mercatorZfromZoom(r){return this.cameraToCenterDistance/this._worldSizeFromZoom(r)}_minimumHeightOverTerrain(){const r=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(r)}_zoomFromMercatorZ(r){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,r)*this.tileSize))}zoomFromMercatorZAdjusted(r){let c=0,f=o.cI,y=0,v=1/0;for(;f-c>1e-6&&f>c;){const S=c+.5*(f-c),N=this.tileSize*Math.pow(2,S),C=this.getCameraToCenterDistance(this.projection,S,N),k=this.scaleZoom(C/(Math.max(0,r)*this.tileSize)),D=Math.abs(S-k);D<v&&(v=D,y=S),S<k?c=S:f=S}return y}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(o.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(r,c){const f=Math.min(r.x,c.x),y=Math.max(r.x,c.x),v=Math.min(r.y,c.y),S=Math.max(r.y,c.y);if(v<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const N=[new o.P(f,v),new o.P(y,S),new o.P(f,S),new o.P(y,v)],C=this.renderWorldCopies?-3:0,k=this.renderWorldCopies?4:1;for(const D of N){const U=this.pointRayIntersection(D);if(U.t<0)return!0;const O=this.rayIntersectionCoordinate(U);if(O.x<C||O.y<0||O.x>k||O.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+o.cU(this.fovAboveCenter)>88||this.anyCornerOffEdge(new o.P(0,0),new o.P(this.width,this.height))}zoomDeltaToMovement(r,c){const f=o.ae(o.at([],this._camera.position,r)),y=this._zoomFromMercatorZ(f)+c;return f-this._mercatorZfromZoom(y)}getCameraPoint(){if(this.projection.name==="globe"){const r=function([c,f,y],v){const S=[c,f,y,1];o.aA(S,S,v);const N=S[3]=Math.max(S[3],1e-6);return S[0]/=N,S[1]/=N,S[2]/=N,S}([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new o.P(r[0],r[1])}{const r=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new o.P(0,r))}}getCameraToCenterDistance(r,c=this.zoom,f=this.worldSize){const y=o.cL(r,c,this.width,this.height,1024),v=r.pixelSpaceConversion(this.center.lat,f,y);let S=.5/Math.tan(.5*this._fov)*this.height*v;return this.isOrthographic&&(S=o.ai(1,S,o.cZ(this.pitch>=_i?1:this.pitch/_i))),S}getWorldToCameraMatrix(){const r=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&o.az(r,r,this.globeMatrix),r}getFrustum(r){return o.cy.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,r,this.projection.zAxisUnit==="meters")}}const pl=(p,r)=>{if(r>0&&p.terrain&&o.w("Cutoff is currently disabled on terrain"),r<=0||p.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=p.transform,f=Math.max(Math.abs(c._zoom-(p.minCutoffZoom-1)),1),y=c.isLODDisabled(!1)?o.af(60,45,c.pitch):o.af(30,15,c.pitch),v=c._farZ-c._nearZ,S=r*c.height,N=((1-(C=y))*c.cameraToCenterDistance+C*(c._farZ+S))*f;var C;return{shouldRenderCutoff:y<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(N-c._nearZ)/v,(N-S-c._nearZ)/v]}}},Qi={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class hp{constructor(r,c){this.aabb=r,this.lastCascade=c}}class NS{add(r,c){const f=this.receivers[r.key];f!==void 0?(f.aabb.min[0]=Math.min(f.aabb.min[0],c.min[0]),f.aabb.min[1]=Math.min(f.aabb.min[1],c.min[1]),f.aabb.min[2]=Math.min(f.aabb.min[2],c.min[2]),f.aabb.max[0]=Math.max(f.aabb.max[0],c.max[0]),f.aabb.max[1]=Math.max(f.aabb.max[1],c.max[1]),f.aabb.max[2]=Math.max(f.aabb.max[2],c.max[2])):this.receivers[r.key]=new hp(c,null)}clear(){this.receivers={}}get(r){return this.receivers[r.key]}computeRequiredCascades(r,c,f){const y=o.d6.fromPoints(r.points);let v=0;for(const S in this.receivers){const N=this.receivers[S];if(!N||!y.intersectsAabb(N.aabb))continue;N.aabb.min=y.closestPoint(N.aabb.min),N.aabb.max=y.closestPoint(N.aabb.max);const C=N.aabb.getCorners();for(let k=0;k<f.length;k++){let D=!0;for(const U of C){const O=[U[0]*c,U[1]*c,U[2]];if(o.ad(O,O,f[k].matrix),O[0]<-1||O[0]>1||O[1]<-1||O[1]>1){D=!1;break}}if(N.lastCascade=k,v=Math.max(v,k),D)break}}return v+1}}class ES{constructor(r){this.painter=r,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new NS,this._depthMode=new Kt(r.context.gl.LEQUAL,Kt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,r.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},()=>{this.painter.style.map.triggerRepaint()}),r.tp.registerParameter(Qi,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),r.tp.registerParameter(Qi,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),r.tp.registerParameter(Qi,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),r.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const r of this._cascades)r.texture.destroy(),r.framebuffer.destroy();this._cascades=[]}updateShadowParameters(r,c){const f=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const y=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||y<=0||(this._shadowLayerCount=f.style.order.reduce((ee,J)=>{const se=f.style._mergedLayers[J];return ee+(se.hasShadowPass()&&!se.isHidden(r.zoom)?1:0)},0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const v=f.context,S=Qi.shadowMapResolution,N=Qi.shadowMapResolution;if(this._cascades.length===0||Qi.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let ee=0;ee<Qi.cascadeCount;++ee){const J=f._shadowMapDebug,se=v.gl,te=v.createFramebuffer(S,N,J,"texture"),le=new o.T(v,{width:S,height:N,data:null},se.DEPTH_COMPONENT16);if(te.depthAttachment.set(le.texture),J){const de=new o.T(v,{width:S,height:N,data:null},se.RGBA8);te.colorAttachment.set(de.texture)}this._cascades.push({framebuffer:te,texture:le,matrix:[],far:0,boundingSphereRadius:0,frustum:new o.cy,scale:0})}}this.shadowDirection=xd(c);let C=0;if(r.elevation){const ee=r.elevation,J=[1e4,-1e4];ee.visibleDemTiles.filter(se=>se.dem).forEach(se=>{const te=se.dem.tree;J[0]=Math.min(J[0],te.minimums[0]),J[1]=Math.max(J[1],te.maximums[0])}),J[0]!==1e4&&(C=(J[1]-J[0])*ee.exaggeration())}const k=1.5*r.cameraToCenterDistance,D=3*k,U=new Float64Array(16);for(let ee=0;ee<this._cascades.length;++ee){const J=this._cascades[ee];let se=r.height/50,te=1;Qi.cascadeCount===1?te=D:ee===0?te=k:(se=k,te=D);const[le,de]=yd(r,this.shadowDirection,se,te,Qi.shadowMapResolution,C);J.scale=r.scale,J.matrix=le,J.boundingSphereRadius=de,o.bi(U,J.matrix),J.frustum=o.cy.fromInvProjectionMatrix(U,1,0,!0),J.far=te}const O=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[O].far,this._cascades[O].far],this._uniformValues.u_shadow_intensity=y,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Qi.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Qi.shadowMapResolution,this._uniformValues.u_shadowmap_0=po.ShadowMap0,this._uniformValues.u_shadowmap_1=po.ShadowMap0+1,this._groundShadowTiles=f.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const G=f.transform.elevation;for(const ee of this._groundShadowTiles){let J={min:0,max:0};if(G){const se=G.getMinMaxForTile(ee);se&&(J=se)}this.addShadowReceiver(ee.toUnwrapped(),J.min,J.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(r){this._enabled=r}drawShadowPass(r,c){if(!this.enabled)return;const f=this.painter,y=f.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(f.transform.getFrustum(0),f.transform.worldSize,this._cascades),y.viewport.set([0,0,Qi.shadowMapResolution,Qi.shadowMapResolution]);for(let v=0;v<this._numCascadesToRender;++v){f.currentShadowCascade=v,y.bindFramebuffer.set(this._cascades[v].framebuffer.framebuffer),y.clear({color:o.am.white,depth:1});for(const S of r.order){const N=r._mergedLayers[S];if(!N.hasShadowPass()||N.isHidden(f.transform.zoom))continue;const C=r.getLayerSourceCache(N),k=C?c[C.id]:void 0;(N.type==="model"||k&&k.length)&&f.renderLayer(f,C,N,k)}}f.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const r=this.painter,c=r.style,f=r.context,y=f.gl,v=c.directionalLight,S=c.ambientLight;if(!v||!S)return;const N=[],C=pl(r,r.longestCutoffRange);C.shouldRenderCutoff&&N.push("RENDER_CUTOFF"),N.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&N.push("NORMAL_OFFSET");const k=vu(c,v,S),D=new Kt(y.LEQUAL,Kt.ReadOnly,r.depthRangeFor3D),U=new Ss({func:y.EQUAL,mask:255},0,255,y.KEEP,y.KEEP,y.KEEP);for(const O of this._groundShadowTiles){const G=O.toUnwrapped(),ee=r.isTileAffectedByFog(O),J=r.getOrCreateProgram("groundShadow",{defines:N,overrideFog:ee});this.setupShadows(G,J),r.uploadCommonUniforms(f,J,G,null,C);const se={u_matrix:r.transform.calculateProjMatrix(G),u_ground_shadow_factor:k};J.draw(r,y.TRIANGLES,D,U,Fs.multiply,gs.disabled,se,"ground_shadow",r.tileExtentBuffer,r.quadTriangleIndexBuffer,r.tileExtentSegments,null,r.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?Fs.unblended:Fs.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(r){const c=this.painter.transform,f=c.calculatePosMatrix(r,c.worldSize);return o.az(f,this._cascades[this.painter.currentShadowCascade].matrix,f),Float32Array.from(f)}calculateShadowPassMatrixFromMatrix(r){return o.az(r,this._cascades[this.painter.currentShadowCascade].matrix,r),Float32Array.from(r)}setupShadows(r,c,f){if(!this.enabled)return;const y=this.painter.transform,v=this.painter.context,S=v.gl,N=this._uniformValues,C=new Float64Array(16),k=y.calculatePosMatrix(r,y.worldSize);for(let D=0;D<this._cascades.length;D++)o.az(C,this._cascades[D].matrix,k),N[D===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(C),v.activeTexture.set(S.TEXTURE0+po.ShadowMap0+D),this._cascades[D].texture.bindExtraParam(S.LINEAR,S.LINEAR,S.CLAMP_TO_EDGE,S.CLAMP_TO_EDGE,S.GREATER);if(this.useNormalOffset=!!f,this.useNormalOffset){const D=o.d4(r.canonical),U=2/y.tileSize*o.aj/Qi.shadowMapResolution,O=U*this._cascades[0].boundingSphereRadius,G=U*this._cascades[this._cascades.length-1].boundingSphereRadius,ee=(f==="vector-tile"?1:3)*function(J,se,te,le,de){const pe=o.ay((J-22)/-22,0,1);return .125*(1-pe)+4*pe}(y.zoom);N.u_shadow_normal_offset=[D,O*ee,G*ee],N.u_shadow_bias=[1e-4,.0012,.012]}else N.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(v,N)}setupShadowsFromMatrix(r,c,f=!1){if(!this.enabled)return;const y=this.painter.context,v=y.gl,S=this._uniformValues,N=new Float64Array(16);for(let C=0;C<Qi.cascadeCount;C++)o.az(N,this._cascades[C].matrix,r),S[C===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(N),y.activeTexture.set(v.TEXTURE0+po.ShadowMap0+C),this._cascades[C].texture.bindExtraParam(v.LINEAR,v.LINEAR,v.CLAMP_TO_EDGE,v.CLAMP_TO_EDGE,v.GREATER);if(this.useNormalOffset=f,f){const C=Qi.normalOffset;S.u_shadow_normal_offset=[1,C,C],S.u_shadow_bias=[6e-5,.0012,.012]}else S.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(y,S)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(r,c,f,y){if(y[2]>=0)return{};const v=function(C,k,D){const U=D/(1<<C.canonical.z);return new o.d6([C.canonical.x*U+C.wrap*D,C.canonical.y*U+C.wrap*D,0],[(C.canonical.x+1)*U+C.wrap*D,(C.canonical.y+1)*U+C.wrap*D,k])}(r,c,f).getCorners(),S=c/-y[2];y[0]<0?(o.d5(v[0],v[0],[y[0]*S,0,0]),o.d5(v[3],v[3],[y[0]*S,0,0])):y[0]>0&&(o.d5(v[1],v[1],[y[0]*S,0,0]),o.d5(v[2],v[2],[y[0]*S,0,0])),y[1]<0?(o.d5(v[0],v[0],[0,y[1]*S,0]),o.d5(v[1],v[1],[0,y[1]*S,0])):y[1]>0&&(o.d5(v[2],v[2],[0,y[1]*S,0]),o.d5(v[3],v[3],[0,y[1]*S,0]));const N={};return N.vertices=v,N.planes=[bc(v[1],v[0],v[4]),bc(v[2],v[1],v[5]),bc(v[3],v[2],v[6]),bc(v[0],v[3],v[7])],N}addShadowReceiver(r,c,f){this._receivers.add(r,o.d6.fromTileIdAndHeight(r,c,f))}getMaxCascadeForTile(r){const c=this._receivers.get(r);return c&&c.lastCascade?c.lastCascade:0}}function bc(p,r,c){const f=o.at([],c,r),y=o.at([],p,r),v=o.bF([],f,y),S=o.ae(v);return S===0?[0,0,1,0]:(o.c1(v,v,1/S),[v[0],v[1],v[2],-o.bG(v,r)])}function xd(p){const r=p.properties.get("direction"),c=o.d1(r.x,r.y,r.z);c[2]=o.ay(c[2],0,75);const f=o.d3([c[0],c[1],c[2]]);return o.d2(f.x,f.y,f.z)}function vu(p,r,c){const f=r.properties.get("color-use-theme")==="none",y=r.properties.get("color"),v=r.properties.get("intensity"),S=r.properties.get("direction"),N=[S.x,S.y,S.z],C=c.properties.get("color-use-theme")==="none",k=c.properties.get("color"),D=c.properties.get("intensity"),U=Math.max(o.bG([0,0,1],N),0),O=[0,0,0];o.c1(O,k.toPremultipliedRenderColor(C?null:p.getLut(r.scope)).toArray01Linear().slice(0,3),D);const G=[0,0,0];return o.c1(G,y.toPremultipliedRenderColor(f?null:p.getLut(c.scope)).toArray01Linear().slice(0,3),U*v),o.d8([O[0]>0?O[0]/(O[0]+G[0]):0,O[1]>0?O[1]/(O[1]+G[1]):0,O[2]>0?O[2]/(O[2]+G[2]):0])}function yd(p,r,c,f,y,v){const S=p.zoom,N=p.scale,C=p.worldSize,k=1/C,D=p.aspect,U=Math.sqrt(1+D*D)*Math.tan(.5*p.fovX),O=U*U,G=f-c,ee=f+c;let J,se;O>G/ee?(J=f,se=f*U):(J=.5*ee*(1+O),se=.5*Math.sqrt(G*G+2*(f*f+c*c)*O+ee*ee*O*O));const te=p.projection.pixelsPerMeter(p.center.lat,C),le=p._camera.getCameraToWorldMercator(),de=[0,0,-J*k];o.ad(de,de,le);let pe=se*k;const ye=p._edgeInsets;if(!(ye.left===0&&ye.top===0&&ye.right===0&&ye.bottom===0||ye.left===ye.right&&ye.top===ye.bottom)){const ht=p._camera.getWorldToCamera(p.worldSize,p.projection.zAxisUnit==="meters"?te:1),pt=p._camera.getCameraToClipPerspective(p._fov,p.width/p.height,c,f);pt[8]=2*-p.centerOffset.x/p.width,pt[9]=2*p.centerOffset.y/p.height;const mt=new Float64Array(16);o.cM(mt,pt,ht);const Pt=new Float64Array(16);o.bi(Pt,mt);const ns=o.cy.fromInvProjectionMatrix(Pt,C,S,!0);for(const us of ns.points){const Wt=((Se=us)[0]/=N,Se[1]/=N,Se[2]=o.cb(Se[2],p._center.lat),Se);pe=Math.max(pe,o.c2(o.d7([],de,Wt)))}}var Se;pe*=y/(y-1);const Te=Math.acos(r[2]),_e=Math.atan2(-r[0],-r[1]),ve=new Ta;ve.position=de,ve.setPitchBearing(Te,_e);const be=ve.getWorldToCamera(C,te),Ue=pe*C,Ie=Math.min(p._mercatorZfromZoom(17)*C*-2,-2*Ue),tt=ve.getCameraToClipOrthographic(-Ue,Ue,-Ue,Ue,Ie,(Ue+v*te)/r[2]),We=new Float64Array(16);o.az(We,tt,be);const rt=o.d2(Math.floor(1e6*de[0])/1e6*C,Math.floor(1e6*de[1])/1e6*C,0),jt=.5*y,$e=[0,0,0];o.ad($e,rt,We),o.c1($e,$e,jt);const Ae=[Math.floor($e[0]),Math.floor($e[1]),Math.floor($e[2])],Ke=[0,0,0];o.at(Ke,$e,Ae),o.c1(Ke,Ke,-1/jt);const Ge=new Float64Array(16);return o.bx(Ge),o.bo(Ge,Ge,Ke),o.az(We,Ge,We),[We,Ue]}class Ev extends o.E{constructor(r){super(),this.requestManager=r,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(r,c){return o.aS(this.requestManager.transformRequest(c,o.R.Model).url).then(f=>{if(!f)return;const y=o.aT(f),v=new o.aU(r,void 0,void 0,y);return v.computeBoundsAndApplyParent(),v}).catch(f=>{if(f&&f.status===404)return null;this.fire(new o.z(new Error(`Could not load model ${r} from ${c}: ${f.message}`)))})}load(r,c,f={forceReload:!1}){this.models[c]||(this.models[c]={});const y=Object.keys(r),v=[],S=[];for(const N of y){const C=r[N];this.hasURLBeenRequested(C)&&!f.forceReload||(this.modelByURL[C]={modelId:N,scope:c},v.push(this.loadModel(N,C)),S.push(N)),this.models[c][N]||(this.models[c][N]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+S.length,Promise.allSettled(v).then(N=>{for(let C=0;C<N.length;C++){const{status:k}=N[C];if(k==="rejected")continue;const{value:D}=N[C];this.models[c][S[C]]||(this.models[c][S[C]]={model:null,numReferences:1}),this.models[c][S[C]].model=D}this.numModelsLoading[c]-=S.length,this.fire(new o.A("data",{dataType:"style"}))}).catch(N=>{this.fire(new o.z(new Error(`Could not load models: ${N.message}`)))})}isLoaded(){for(const r in this.numModelsLoading)if(this.numModelsLoading[r]>0)return!1;return!0}hasModel(r,c,f={exactIdMatch:!1}){return!!(f.exactIdMatch?this.getModel(r,c):this.getModelByURL(this.modelUris[c][r]))}getModel(r,c){return this.models[c]||(this.models[c]={}),this.models[c][r]?this.models[c][r].model:void 0}getModelByURL(r){if(!r)return null;const c=this.modelByURL[r];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(r,c){return this.models[c]&&this.models[c][r]!==void 0}getModelURIs(r){return this.modelUris[r]||{}}addModel(r,c,f){this.models[f]||(this.models[f]={}),this.modelUris[f]||(this.modelUris[f]={});const y=this.requestManager.normalizeModelURL(c);if((this.hasModel(r,f,{exactIdMatch:!0})||this.hasModelBeenAdded(r,f))&&this.modelUris[f][r]===y)this.models[f][r].numReferences++;else if(this.hasURLBeenRequested(y)){const{scope:v,modelId:S}=this.modelByURL[y];this.models[v][S].numReferences++}else this.modelUris[f][r]=y,this.load({[r]:this.modelUris[f][r]},f)}addModelURLs(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f=this.modelUris[c];for(const y in r)f[y]=this.requestManager.normalizeModelURL(r[y])}reloadModels(r){this.load(this.modelUris[r],r,{forceReload:!0})}addModelsFromBucket(r,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const f={};for(const y of r)this.hasModel(y,c,{exactIdMatch:!0})||this.hasURLBeenRequested(y)?this.models[c][y].numReferences++:this.modelUris[c][y]&&!this.hasURLBeenRequested(y)?f[y]=this.modelUris[c][y]:!this.hasURLBeenRequested(y)&&o.d9(y,!1)&&(this.modelUris[c][y]=this.requestManager.normalizeModelURL(y),f[y]=this.modelUris[c][y]);this.load(f,c)}hasURLBeenRequested(r){return this.modelByURL[r]!==void 0}removeModel(r,c,f=!1,y=!1){if(this.models[c]&&this.models[c][r]&&(this.models[c][r].numReferences--,this.models[c][r].numReferences===0||y)){const v=this.modelUris[c][r];f||delete this.modelUris[c][r],delete this.modelByURL[v];const S=this.models[c][r].model;if(!S)return;delete this.models[c][r],S.destroy()}}destroy(){for(const r of Object.keys(this.models))for(const c of Object.keys(this.models[r])){const f=this.models[r][c].model;delete this.models[r][c],f&&f.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(r){return this.models[r]||(this.models[r]={}),Object.keys(this.models[r])}upload(r,c){this.models[c]||(this.models[c]={});for(const f in this.models[c])this.models[c][f].model&&this.models[c][f].model.upload(r.context)}}const qf=new o.a7({data:new o.a8(o.a5.colorTheme.data)});class Bx{constructor(r){this._scope=r,this._buildingQueryParams={target:{featuresetId:"building-outline",importId:this._scope}},this._floorQueryParams={target:{featuresetId:"floor-outline",importId:this._scope}}}execute(r){const c=this._makeBuildingsQueryArea(r),f=this._makeFloorsQueryArea(r),y=r.queryRenderedFeatures(c,this._buildingQueryParams).filter(N=>N.properties.shape_type==="building").reduce((N,C)=>{const k=C.properties.id;return C.properties.shape_type!=="building"||N.some(D=>D.properties.id===k)||N.push(C),N},[]),v=r.queryRenderedFeatures(f,this._floorQueryParams).filter(N=>N.properties.shape_type==="floor").reduce((N,C)=>{const k=C.properties.id;return C.properties.shape_type!=="floor"||N.some(D=>D.properties.id===k)||N.push(C),N},[]),S=[r.getCenter().lng,r.getCenter().lat];return{floors:v,building:this._findBuildingAtCenter(S,y)||(y.length>0?y[0]:null)}}_makeBuildingsQueryArea(r){const c=r.transform.width,f=r.transform.height,y=Math.min(c,f),v=y*(1/8),S=y*(1/8),N=.5*(c-v),C=.5*(f-S);return[new o.P(N,C),new o.P(N+v,C+S)]}_makeFloorsQueryArea(r){const c=r.transform.width,f=r.transform.height,y=c*(2/3),v=f*(2/3),S=.5*(c-y),N=.5*(f-v);return[new o.P(S,N),new o.P(S+y,N+v)]}_findBuildingAtCenter(r,c){for(const f of c)if(f.geometry.type==="Polygon"&&this._pointInPolygon(r,f.geometry.coordinates[0]))return f;return null}_pointInPolygon(r,c){let f=!1;for(let y=0,v=c.length-1;y<c.length;v=y++){const S=c[y][0],N=c[y][1],C=c[v][1];N>r[1]!=C>r[1]&&r[0]<(c[v][0]-S)*(r[1]-N)/(C-N)+S&&(f=!f)}return f}}class wc{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}setBuildingId(r){this._selectedBuildingId=r}setFloors(r){if(this._floors=r.filter(c=>c.properties.building_id===this._selectedBuildingId),!this._selectedFloorId||!this._floors.map(c=>c.properties.id).includes(this._selectedFloorId)){const c=this._floors.map(f=>({id:f.properties.id,level:f.properties.floor_level})).reduce((f,y)=>{const v=Math.abs(f.level-1),S=Math.abs(y.level-1);return S<v||S===v&&y.level>f.level?y:f});this._selectedFloorId=c.id}}setFloorId(r){this._selectedFloorId=r}getSelectedFloorId(){return this._selectedFloorId}getCurrentBuildingFloors(){return this._floors}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._floors=[]}}const CS={"mbx-indoor-level-selected":{default:["literal",[]]}};function Cv(p){return p=p||{},Object.assign(p,CS)}class AS extends o.E{constructor(r){super(),o.aV(["_onLoad","_onMove"],this),this._map=r,this._floorSelectionState=new wc,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.indoor.off("load",this._onLoad),this._map.indoor.off("move",this._onMove),this._map=null,this._floorSelectionState=null}_onLoad(){this._map.style.forEachFragmentStyle(r=>{r.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new o.z(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=r.scope,this._indoorDataQuery=new Bx(this._scope)))}),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<16)return void this._clearIndoorData();const r=this._indoorDataQuery.execute(this._map);r&&r.floors.length!==0?(this._floorSelectionState.getSelectedFloorId()||this._map._addIndoorControl(),this._selectFloors(r)):this._clearIndoorData()}_selectFloors(r){if(r.building)this._floorSelectionState.setBuildingId(r.building.properties.id),this._floorSelectionState.setFloors(r.floors),this._updateUI();else{const c=this._floorSelectionState.getSelectedFloorId();if(c&&r.floors.some(f=>f.properties.id===c))return;this._clearIndoorData()}}_clearIndoorData(){this._floorSelectionState.reset(),this._map._removeIndoorControl(),this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[]])}_updateUI(){const r=this._floorSelectionState.getCurrentBuildingFloors().map(f=>({id:f.properties.id,name:f.properties.name,shortName:f.properties.floor_level,levelOrder:f.properties.floor_level})),c=this._floorSelectionState.getSelectedFloorId();c?(this._updateIndoorConfig(),this.fire(new o.A("indoorupdate",{selectedFloorId:c,floors:r}))):console.warn("IndoorManager: Selected floor is not set")}_updateIndoorConfig(){const r=this._floorSelectionState.getSelectedFloorId();r?this._map.setConfigProperty(this._scope,"mbx-indoor-level-selected",["literal",[r]]):console.warn("IndoorManager: Selected floor is not set")}selectFloor(r){this._floorSelectionState.setFloorId(r),this._updateIndoorConfig()}}function Av(p){if(!p.metadata||!p.metadata.content_area)return;const r=o.q.devicePixelRatio,{left:c,top:f,width:y,height:v}=p.metadata.content_area,S=c*r,N=f*r;return[S,N,S+y*r,N+v*r]}function Pv(p){if(p)return p.map(([r,c])=>[r*o.q.devicePixelRatio,c*o.q.devicePixelRatio])}class Vx{constructor(r,c,f){this.id=r,this.scope=c,this.sourceCache=f,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(r){this.missingRequests.has(r.name)||this.pendingRequests.has(r.name)||this.pendingRequests.add(r.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const r=new Map;if(!this.sourceCache.loaded())return r;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return r;const f=this.sourceCache.getSource();if(!(f instanceof xc))return r;const y=c.map(S=>this.sourceCache.getTile(S)),v=f.getImages(y,Array.from(this.pendingRequests));for(const[S,N]of v)r.set(o.I.from({name:S,iconsetId:this.id}),N),this.pendingRequests.delete(S);for(const S of this.pendingRequests)this.missingRequests.add(S);return this.pendingRequests.clear(),r}}const Sc=(p,r)=>xe(p,r&&r.filter(c=>c.identifier!=="source.canvas")),Iv=o.aF(hn,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),Mv=o.aF(hn,["setCenter","setZoom","setBearing","setPitch"]),Zf=new Set(["background","sky","slot","custom"]),jc={version:8,layers:[],sources:{}},pp={duration:300,delay:0};class Na extends o.E{constructor(r,c={}){super(),this.map=r,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=o.h({},pp),this._buildingIndex=new _v(this),this.crossTileSymbolIndex=new Eo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new wr,this.dispatcher=c.dispatcher?c.dispatcher:new o.D(o.db(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new vn(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new o.dc(r._requestManager,c.localFontFamily?o.dd.all:c.localIdeographFontFamily?o.dd.ideographs:o.dd.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Ev(r._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",o.de());const f=this;this._rtlTextPluginCallback=Na.registerForPluginStateChange(y=>{f.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:y.pluginStatus,pluginURL:y.pluginURL},(v,S)=>{if(o.df(v),S&&S.every(N=>N))for(const N in f._sourceCaches){const C=f._sourceCaches[N],k=C.getSource().type;k!=="vector"&&k!=="geojson"||C.reload()}})}),this.on("data",y=>{if(y.dataType!=="source"||y.sourceDataType!=="metadata")return;const v=this.getOwnSource(y.sourceId);if(v&&v.vectorLayerIds)for(const S in this._layers){const N=this._layers[S];N.source===v.id&&this._validateLayer(N)}})}load(r){return r?(typeof r=="string"?this.loadURL(r):this.loadJSON(r),this):this}_getGlobalId(r){if(!r)return null;if(typeof r=="string"){if(o.j(r))return r;const c=o.dg(r);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${o.dh(JSON.stringify(r))}`}_diffStyle(r,c,f){this.globalId=this._getGlobalId(r);const y=(v,S)=>{try{S(null,this.setState(v,f))}catch(N){S(N,!1)}};if(typeof r=="string"){const v=this.map._requestManager.normalizeStyleURL(r),S=this.map._requestManager.transformRequest(v,o.R.Style);o.n(S,(N,C)=>{N?this.fire(new o.z(N)):C&&y(C,c)})}else typeof r=="object"&&y(r,c)}loadURL(r,c={}){this.fire(new o.A("dataloading",{dataType:"style"}));const f=typeof c.validate=="boolean"?c.validate:!o.j(r);this.globalId=this._getGlobalId(r),r=this.map._requestManager.normalizeStyleURL(r,c.accessToken),this.resolvedImports.add(r);const y=this.importsCache.get(r);if(y)return this._load(y,f);const v=this.map._requestManager.transformRequest(r,o.R.Style);this._request=o.n(v,(S,N)=>{if(this._request=null,S)this.fire(new o.z(S));else if(N)return this.importsCache.set(r,N),this._load(N,f)})}loadJSON(r,c={}){this.fire(new o.A("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(r),this._request=o.q.frame(()=>{this._request=null,this._load(r,c.validate!==!1)})}loadEmpty(){this.fire(new o.A("dataloading",{dataType:"style"})),this._load(jc,!1)}_loadImports(r,c,f){if(this.importDepth>=4)return o.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const y=[];for(const v of r){const S=this._createFragmentStyle(v),N=new Promise(D=>{S.once("style.import.load",D),S.once("error",D)}).then(()=>this.mergeAll());if(y.push(N),this.resolvedImports.has(v.url)){S.loadEmpty();continue}const C=v.data||this.importsCache.get(v.url);C?(S.loadJSON(C,{validate:c}),this._isInternalStyle(C)&&(S.globalId=null)):v.url?S.loadURL(v.url,{validate:c}):S.loadEmpty();const k={style:S,id:v.id,config:v.config};if(f){const D=this.fragments.findIndex(({id:U})=>U===f);this.fragments=this.fragments.slice(0,D).concat(k).concat(this.fragments.slice(D))}else this.fragments.push(k)}return Promise.allSettled(y)}getImportGlobalIds(r=this,c=new Set){for(const f of r.fragments)f.style.globalId&&c.add(f.style.globalId),this.getImportGlobalIds(f.style,c);return[...c.values()]}_createFragmentStyle(r){const c=this.scope?o.C(r.id,this.scope):r.id;let f;const y=this._initialConfig&&this._initialConfig[c];(r.config||y)&&(f=o.h({},r.config,y));const v=new Na(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:f,configOptions:this.options,colorThemeOverride:r["color-theme"],configDependentLayers:this._configDependentLayers});return v.setEventedParent(this.map,{style:v}),v}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(r){return this.isRootStyle()&&(r.fragment||!!r.schema&&r.fragment!==!1)}_load(r,c){const f=r.indoor?Cv(r.schema):r.schema;if(this._isInternalStyle(r)){const S=o.h({},jc,{imports:[{id:"basemap",data:r,url:""}]});return void this._load(S,c)}if(this.updateConfig(this._config,f),c&&Sc(this,jo(r)))return;this._loaded=!0,this.stylesheet=o.di(r);const y=()=>{for(const k in r.sources)this.addSource(k,r.sources[k],{validate:!1,isInitialLoad:!0});if(r.iconsets)for(const k in r.iconsets)this.addIconset(k,r.iconsets[k]);r.sprite?this._loadIconset(r.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&r.glyphs&&this.glyphManager.setURL(r.glyphs);const S=Qh(this.stylesheet.layers);if(this._order=S.map(k=>k.id),this.stylesheet.light&&o.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const k=this.stylesheet.lights[0];this.light=new qe(k.properties,k.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new qe(this.stylesheet.light)),this._layers={};for(const k of S){const D=o.dn(k,this.scope,this._styleColorTheme.lut,this.options);D.configDependencies.size!==0&&this._configDependentLayers.add(D.fqid),D.setEventedParent(this,{layer:{id:D.id}}),this._layers[D.id]=D;const U=this.getOwnLayerSourceCache(D),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();U&&D.canCastShadows()&&O&&(U.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const N=this.stylesheet.terrain;N&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(N,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new o.A("data",{dataType:"style"}));const C=this.isRootStyle();r.imports?this._loadImports(r.imports,c).then(()=>{this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load"))}).catch(k=>{this.fire(new o.z(new Error("Failed to load imports",k))),this.fire(new o.A(C?"style.load":"style.import.load"))}):(this._reloadImports(),this.fire(new o.A(C?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const v=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(v){const S=this._evaluateColorThemeData(v);this._loadColorTheme(S).then(()=>{y()}).catch(N=>{o.w(`Couldn't load color theme from the stylesheet: ${N}`),y()})}else this._styleColorTheme.lut=null,y()}isRootStyle(){return this.importDepth===0}mergeAll(){let r,c,f,y,v,S,N,C,k,D;const U={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(O=>{if(O.stylesheet){if(O.light!=null&&(r=O.light),O.stylesheet.lights)for(const G of O.stylesheet.lights)G.type==="ambient"&&O.ambientLight!=null&&(c=O.ambientLight),G.type==="directional"&&O.directionalLight!=null&&(f=O.directionalLight);y=this._prioritizeTerrain(y,O.terrain,O.stylesheet.terrain),O.stylesheet.fog&&O.fog!=null&&(v=O.fog),O.stylesheet.snow&&O.snow!=null&&(S=O.snow),O.stylesheet.rain&&O.rain!=null&&(N=O.rain),O.stylesheet.camera!=null&&(D=O.stylesheet.camera),O.stylesheet.projection!=null&&(C=O.stylesheet.projection),O.stylesheet.transition!=null&&(k=O.stylesheet.transition),U[O.scope]=O._styleColorTheme}}),this.light=r,this.ambientLight=c,this.directionalLight=f,this.fog=v,this.snow=S,this.rain=N,this._styleColorThemeForScope=U,y===null?delete this.terrain:this.terrain=y,this.camera=D||{"camera-projection":"perspective"},this.projection=C||{name:"mercator"},this.transition=o.h({},pp,k),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(r){const c=f=>{for(const y of f.fragments)c(y.style);r(f)};c(this)}_prioritizeTerrain(r,c,f){const y=r&&r.drapeRenderMode===0;return f===null?c&&c.drapeRenderMode===0?c:y?r:null:c!=null&&(!r||y||c&&c.drapeRenderMode===1)?c:r}mergeTerrain(){let r;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle(c=>{r=this._prioritizeTerrain(r,c.terrain,c.stylesheet.terrain)}),r===null?delete this.terrain:this.terrain=r}mergeProjection(){let r;this.forEachFragmentStyle(c=>{c.stylesheet.projection!=null&&(r=c.stylesheet.projection)}),this.projection=r||{name:"mercator"}}mergeSources(){const r={},c={},f={};this.forEachFragmentStyle(y=>{for(const v in y._sourceCaches){const S=o.C(v,y.scope);r[S]=y._sourceCaches[v]}for(const v in y._otherSourceCaches){const S=o.C(v,y.scope);c[S]=y._otherSourceCaches[v]}for(const v in y._symbolSourceCaches){const S=o.C(v,y.scope);f[S]=y._symbolSourceCaches[v]}}),this._mergedSourceCaches=r,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=f}mergeLayers(){const r={},c=[],f={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle(v=>{for(const S of v._order){const N=v._layers[S];if(N.type==="slot"){const C=o.dj(S);if(r[C])continue;r[C]=[]}N.slot&&r[N.slot]?r[N.slot].push(N):c.push(N)}}),this._mergedOrder=[];const y=(v=[])=>{for(const S of v)if(S.type==="slot"){const N=o.dj(S.id);r[N]&&y(r[N]),this._mergedSlots.push(N)}else{const N=o.C(S.id,S.scope);this._mergedOrder.push(N),f[N]=S,S.is3D(!!this.terrain)&&(this._has3DLayers=!0),S.type==="circle"&&(this._hasCircleLayers=!0),S.type==="symbol"&&(this._hasSymbolLayers=!0),S.type==="clip"&&(this._clipLayerPresent=!0)}};y(c),this._mergedOrder.sort((v,S)=>{const N=f[v],C=f[S];return N.hasInitialOcclusionOpacityProperties?C.is3D(!!this.terrain)?1:0:N.is3D(!!this.terrain)&&C.hasInitialOcclusionOpacityProperties?-1:0}),this._mergedLayers=f,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(r){return this.stylesheet.camera=o.h({},this.stylesheet.camera,r),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(r){return r.data?function(c,f,y,v){const S=o.h({},f);for(const C of Object.keys(o.a5.colorTheme))S[C]===void 0&&(S[C]=o.a5.colorTheme[C].default);const N=new o.a6(qf,c,new Map(y));return N.setTransitionOrValue(S,y),N.untransitioned().possiblyEvaluate(new o.aa(0,{worldview:void 0}))}(this.scope,r,this.options).get("data"):null}_loadColorTheme(r){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise((f,y)=>{const v="data:image/png;base64,";if(!r||r.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void f();let S=r;S.startsWith(v)||(S=v+S);const N=o.I.from("mapbox-reserved-lut"),C=new Image;C.src=S,C.onerror=()=>{this._styleColorTheme.lutLoading=!1,y(new Error("Failed to load image data"))},C.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void f();this._styleColorTheme.lutLoading=!1;const{width:k,height:D,data:U}=o.q.getImageData(C);if(D>32)return void y(new Error("The height of the image must be less than or equal to 32 pixels."));if(k!==D*D)return void y(new Error("The width of the image must be equal to the height squared."));this.getImage(N)&&this.removeImage(N),this.addImage(N,{data:new o.r({width:k,height:D},U),pixelRatio:1,sdf:!1,usvg:!1,version:0});const O=this.imageManager.getImage(N,this.scope);O?(this._styleColorTheme.lut={image:O.data,data:r},f()):y(new Error("Missing LUT image."))}})}getLut(r){const c=this._styleColorThemeForScope[r];return c?c.lut:null}setProjection(r){r?this.stylesheet.projection=r:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(r){this._spriteRequest=function(c,f,y){let v,S,N;const C=o.q.devicePixelRatio>1?"@2x":"";let k=o.n(f.transformRequest(f.normalizeSpriteURL(c,C,".json"),o.R.SpriteJSON),(O,G)=>{k=null,N||(N=O,v=G,U())}),D=o.o(f.transformRequest(f.normalizeSpriteURL(c,C,".png"),o.R.SpriteImage),(O,G)=>{D=null,N||(N=O,S=G,U())});function U(){if(N)y(N);else if(v&&S){const O=o.q.getImageData(S),G={};for(const ee in v){const{width:J,height:se,x:te,y:le,sdf:de,pixelRatio:pe,stretchX:ye,stretchY:Se,content:Te}=v[ee],_e=new o.r({width:J,height:se});o.r.copy(O,_e,{x:te,y:le},{x:0,y:0},{width:J,height:se},null),G[ee]={data:_e,pixelRatio:pe,sdf:de,stretchX:ye,stretchY:Se,content:Te,usvg:!1}}y(null,G)}}return{cancel(){k&&(k.cancel(),k=null),D&&(D.cancel(),D=null)}}}(r,this.map._requestManager,(c,f)=>{if(this._spriteRequest=null,c)this.fire(new o.z(c));else if(f){const y=new Map;for(const v in f)y.set(o.I.from(v),f[v]);this.addImages(y)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))})}addIconset(r,c){if(c.type==="sprite")return void this._loadSprite(c.url);const f=this.getOwnSourceCache(c.source);if(!f)return void this.fire(new o.z(new Error(`Source "${c.source}" as specified by iconset "${r}" does not exist and cannot be used as an iconset source`)));const y=f.getSource();if(y.type!=="raster-array")return void this.fire(new o.z(new Error(`Source "${c.source}" as specified by iconset "${r}" is not a "raster-array" source and cannot be used as an iconset source`)));y.partial=!1;const v=new Vx(r,this.scope,f);this.imageManager.addImageProvider(v,this.scope)}removeIconset(r){this.imageManager.removeImageProvider(r,this.scope)}_loadIconset(r){if(!o.j(r)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(r);const c=this.map._spriteFormat==="auto";var f,y;this._spriteRequest=(y=(v,S)=>{if(this._spriteRequest=null,v)c?this._loadSprite(r):this.fire(new o.z(v));else if(S){const N=new Map;for(const C in S)N.set(o.I.from(C),S[C]);this.addImages(N)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new o.A("data",{dataType:"style"}))},o.br((f=this.map._requestManager).transformRequest(f.normalizeIconsetURL(r),o.R.Iconset),(v,S)=>{if(v)return void y(v);const N={},C=o.da(new o.bq(S));for(const k of C.icons){const D={version:1,pixelRatio:o.q.devicePixelRatio,content:Av(k),stretchX:k.metadata?Pv(k.metadata.stretch_x_areas):void 0,stretchY:k.metadata?Pv(k.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:k};N[k.name]=D}y(null,N)}))}_validateLayer(r){const c=this.getOwnSource(r.source);if(!c)return;const f=r.sourceLayer;f&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(f)===-1)&&this.fire(new o.z(new Error(`Source layer "${f}" does not exist on source "${c.id}" as specified by style layer "${r.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const r in this._sourceCaches)if(!this._sourceCaches[r].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:r}of this.fragments)if(!r.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map((r,c)=>{const f=this.fragments[c];return f&&f.style&&(r.data=f.style.serialize()),r})}_serializeSources(){const r={};for(const c in this._sourceCaches){const f=this._sourceCaches[c].getSource();r[f.id]||(r[f.id]=f.serialize())}return r}_serializeLayers(r){const c=[];for(const f of r){const y=this._layers[f];y&&y.type!=="custom"&&c.push(y.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const r in this._sourceCaches)if(this._sourceCaches[r].hasTransition())return!0;for(const r in this._layers)if(this._layers[r].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(r){return r?this.order:this._mergedOrder}isLayerDraped(r){return!!this.terrain&&r.isDraped(this.getLayerSourceCache(r))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(r){const c=this.getOwnLayer(r);if(c)return c;this.fire(new o.z(new Error(`The layer '${r}' does not exist in the map's style.`)))}_checkSource(r){const c=this.getOwnSource(r);if(c)return c;this.fire(new o.z(new Error(`The source '${r}' does not exist in the map's style.`)))}precompilePrograms(r,c){const f=this.map.painter;if(f)for(let y=r.minzoom||0;y<(r.maxzoom||25.5);y++){const v=r.getProgramIds();if(v)for(const S of v){const N=r.getDefaultProgramParams(S,c.zoom,this._styleColorTheme.lut);N&&(f.style=this,this.fog&&(f._fogVisible=!0,N.overrideFog=!0,f.getOrCreateProgram(S,N)),f._fogVisible=!1,N.overrideFog=!1,f.getOrCreateProgram(S,N),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(N.overrideRtt=!0,f.getOrCreateProgram(S,N)))}}}update(r){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(r),this.directionalLight&&this.directionalLight.recalculate(r);const c=this.calculateLightsBrightness();r.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),r.worldview!==this._worldview&&(this._worldview=r.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const f=this._changes.isDirty();let y=!1;if(this._changes.isDirty()){const N=this._changes.getLayerUpdatesByScope();for(const C in N){const{updatedIds:k,removedIds:D}=N[C];(k||D)&&(this._updateWorkerLayers(C,k,D),y=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(r),this.light&&this.light.updateTransitions(r),this.ambientLight&&this.ambientLight.updateTransitions(r),this.directionalLight&&this.directionalLight.updateTransitions(r),this.fog&&this.fog.updateTransitions(r),this.snow&&this.snow.updateTransitions(r),this.rain&&this.rain.updateTransitions(r),this._changes.reset()}const v={};for(const N in this._mergedSourceCaches){const C=this._mergedSourceCaches[N];v[N]=C.used,C.used=!1,C.tileCoverLift=0}for(const N of this._mergedOrder){const C=this._mergedLayers[N];if(C.recalculate(r,this._availableImages),!C.isHidden(r.zoom)){const k=this.getLayerSourceCache(C);k&&(k.used=!0,k.tileCoverLift=Math.max(k.tileCoverLift,C.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback(()=>{this.precompilePrograms(C,r)}):this.precompilePrograms(C,r))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&y&&this.mergeLayers();const S=this.imageManager.getPendingImageProviders();for(const N of S)N.sourceCache.used=!0;for(const N in v){const C=this._mergedSourceCaches[N];v[N]!==C.used&&C.getSource().fire(new o.A("data",{sourceDataType:"visibility",dataType:"source",sourceId:C.getSource().id}))}this.light&&this.light.recalculate(r),this.terrain&&this.terrain.recalculate(r),this.fog&&this.fog.recalculate(r),this.snow&&this.snow.recalculate(r),this.rain&&this.rain.recalculate(r),this.z=r.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),f&&this.fire(new o.A("data",{dataType:"style"}))}updateImageProviders(){const r=this.imageManager.getPendingImageProviders();for(const c of r){const f=c.resolvePendingRequests(),y=this.getFragmentStyle(c.scope);y&&y.addImages(f)}}_updateTilesForChangedImages(){const r={};for(const c in this._mergedSourceCaches){const f=this._mergedSourceCaches[c].getSource().scope;r[f]=r[f]||this._changes.getUpdatedImages(f),r[f].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],r[f])}for(const c in r)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(r,c,f){const y=this.getFragmentStyle(r);y&&this.dispatcher.broadcast("updateLayers",{layers:c?y._serializeLayers(c):[],scope:r,removedIds:f||[],options:y.options})}setState(r,c){if(this._checkLoaded(),Sc(this,jo(r)))return!1;(r=o.di(r)).layers=Qh(r.layers);const f=function(S,N){if(!S)return[{command:hn.setStyle,args:[N]}];let C=[];try{if(!o.bv(S.version,N.version))return[{command:hn.setStyle,args:[N]}];if(o.bv(S.center,N.center)||C.push({command:hn.setCenter,args:[N.center]}),o.bv(S.zoom,N.zoom)||C.push({command:hn.setZoom,args:[N.zoom]}),o.bv(S.bearing,N.bearing)||C.push({command:hn.setBearing,args:[N.bearing]}),o.bv(S.pitch,N.pitch)||C.push({command:hn.setPitch,args:[N.pitch]}),o.bv(S.sprite,N.sprite)||C.push({command:hn.setSprite,args:[N.sprite]}),o.bv(S.glyphs,N.glyphs)||C.push({command:hn.setGlyphs,args:[N.glyphs]}),o.bv(S.imports,N.imports)||function(G=[],ee=[],J){ee=ee||[];const se=(G=G||[]).map(mu),te=ee.map(mu),le=G.reduce(yc,{}),de=ee.reduce(yc,{}),pe=se.slice();let ye,Se,Te,_e;for(ye=0,Se=0;ye<se.length;ye++)Te=se[ye],de.hasOwnProperty(Te)?Se++:(J.push({command:hn.removeImport,args:[Te]}),pe.splice(pe.indexOf(Te,Se),1));for(ye=0,Se=0;ye<te.length;ye++)Te=te[te.length-1-ye],pe[pe.length-1-ye]!==Te&&(le.hasOwnProperty(Te)?(J.push({command:hn.removeImport,args:[Te]}),pe.splice(pe.lastIndexOf(Te,pe.length-Se),1)):Se++,_e=pe[pe.length-ye],J.push({command:hn.addImport,args:[de[Te],_e]}),pe.splice(pe.length-ye,0,Te));for(const ve of ee){const be=le[ve.id];be&&(delete be.data,o.bv(be,ve)||J.push({command:hn.updateImport,args:[ve.id,ve]}))}}(S.imports,N.imports,C),o.bv(S.transition,N.transition)||C.push({command:hn.setTransition,args:[N.transition]}),o.bv(S.light,N.light)||C.push({command:hn.setLight,args:[N.light]}),o.bv(S.fog,N.fog)||C.push({command:hn.setFog,args:[N.fog]}),o.bv(S.snow,N.snow)||C.push({command:hn.setSnow,args:[N.snow]}),o.bv(S.rain,N.rain)||C.push({command:hn.setRain,args:[N.rain]}),o.bv(S.projection,N.projection)||C.push({command:hn.setProjection,args:[N.projection]}),o.bv(S.lights,N.lights)||C.push({command:hn.setLights,args:[N.lights]}),o.bv(S.camera,N.camera)||C.push({command:hn.setCamera,args:[N.camera]}),o.bv(S.iconsets,N.iconsets)||function(G,ee,J){let se;for(se in ee=ee||{},G=G||{})G.hasOwnProperty(se)&&(ee.hasOwnProperty(se)||J.push({command:hn.removeIconset,args:[se]}));for(se in ee){if(!ee.hasOwnProperty(se))continue;const te=ee[se];G.hasOwnProperty(se)?o.bv(G[se],te)||(J.push({command:hn.removeIconset,args:[se]}),J.push({command:hn.addIconset,args:[se,te]})):J.push({command:hn.addIconset,args:[se,te]})}}(S.iconsets,N.iconsets,C),!o.bv(S["color-theme"],N["color-theme"]))return[{command:hn.setStyle,args:[N]}];const k={},D=[];(function(G,ee,J,se){let te;for(te in ee=ee||{},G=G||{})G.hasOwnProperty(te)&&(ee.hasOwnProperty(te)||cd(te,J,se));for(te in ee){if(!ee.hasOwnProperty(te))continue;const le=ee[te];G.hasOwnProperty(te)?o.bv(G[te],le)||(G[te].type==="geojson"&&le.type==="geojson"&&jS(G,ee,te)?J.push({command:hn.setGeoJSONSourceData,args:[te,le.data]}):ep(te,ee,J,se)):Vf(te,ee,J)}})(S.sources,N.sources,D,k);const U=[];S.layers&&S.layers.forEach(G=>{G.source&&k[G.source]?C.push({command:hn.removeLayer,args:[G.id]}):U.push(G)});let O=S.terrain;O&&k[O.source]&&(C.push({command:hn.setTerrain,args:[void 0]}),O=void 0),C=C.concat(D),o.bv(O,N.terrain)||C.push({command:hn.setTerrain,args:[N.terrain]}),function(G,ee,J){ee=ee||[];const se=(G=G||[]).map(mu),te=ee.map(mu),le=G.reduce(yc,{}),de=ee.reduce(yc,{}),pe=se.slice(),ye=Object.create(null);let Se,Te,_e,ve,be,Ue,Ie;for(Se=0,Te=0;Se<se.length;Se++)_e=se[Se],de.hasOwnProperty(_e)?Te++:(J.push({command:hn.removeLayer,args:[_e]}),pe.splice(pe.indexOf(_e,Te),1));for(Se=0,Te=0;Se<te.length;Se++)_e=te[te.length-1-Se],pe[pe.length-1-Se]!==_e&&(le.hasOwnProperty(_e)?(J.push({command:hn.removeLayer,args:[_e]}),pe.splice(pe.lastIndexOf(_e,pe.length-Te),1)):Te++,Ue=pe[pe.length-Se],J.push({command:hn.addLayer,args:[de[_e],Ue]}),pe.splice(pe.length-Se,0,_e),ye[_e]=!0);for(Se=0;Se<te.length;Se++)if(_e=te[Se],ve=le[_e],be=de[_e],!ye[_e]&&!o.bv(ve,be))if(o.bv(ve.source,be.source)&&o.bv(ve["source-layer"],be["source-layer"])&&o.bv(ve.type,be.type)){for(Ie in tp(ve.layout,be.layout,J,_e,null,hn.setLayoutProperty),tp(ve.paint,be.paint,J,_e,null,hn.setPaintProperty),o.bv(ve.slot,be.slot)||J.push({command:hn.setSlot,args:[_e,be.slot]}),o.bv(ve.filter,be.filter)||J.push({command:hn.setFilter,args:[_e,be.filter]}),o.bv(ve.minzoom,be.minzoom)&&o.bv(ve.maxzoom,be.maxzoom)||J.push({command:hn.setLayerZoomRange,args:[_e,be.minzoom,be.maxzoom]}),ve)ve.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?tp(ve[Ie],be[Ie],J,_e,Ie.slice(6),hn.setPaintProperty):o.bv(ve[Ie],be[Ie])||J.push({command:hn.setLayerProperty,args:[_e,Ie,be[Ie]]}));for(Ie in be)be.hasOwnProperty(Ie)&&!ve.hasOwnProperty(Ie)&&Ie!=="layout"&&Ie!=="paint"&&Ie!=="filter"&&Ie!=="metadata"&&Ie!=="minzoom"&&Ie!=="maxzoom"&&Ie!=="slot"&&(Ie.indexOf("paint.")===0?tp(ve[Ie],be[Ie],J,_e,Ie.slice(6),hn.setPaintProperty):o.bv(ve[Ie],be[Ie])||J.push({command:hn.setLayerProperty,args:[_e,Ie,be[Ie]]}))}else J.push({command:hn.removeLayer,args:[_e]}),Ue=pe[pe.lastIndexOf(_e)+1],J.push({command:hn.addLayer,args:[be,Ue]})}(U,N.layers,C)}catch(k){console.warn("Unable to compute style diff:",k),C=[{command:hn.setStyle,args:[N]}]}return C}(this.serialize(),r).filter(S=>!(S.command in Mv));if(f.length===0)return!1;const y=f.filter(S=>!(S.command in Iv));if(y.length>0)throw new Error(`Unimplemented: ${y.map(S=>S.command).join(", ")}.`);const v=[];return f.forEach(S=>{v.push(this[S.command](...S.args))}),c&&Promise.all(v).then(c).catch(c),this.stylesheet=r,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(r){if(r.size===0)return this;for(const[c,f]of r.entries()){if(this.getImage(c))return this.fire(new o.z(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,f),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this}addImage(r,c){return this.getImage(r)?this.fire(new o.z(new Error(`An image with the name "${r.name}" already exists.`))):(this.imageManager.addImage(r,this.scope,c),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this)}updateImage(r,c,f=!1){this.imageManager.updateImage(r,this.scope,c),f&&(this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})))}getImage(r){return this.imageManager.getImage(r,this.scope)}removeImage(r){return this.getImage(r)?(this.imageManager.removeImage(r,this.scope),this._changes.updateImage(r,this.scope),this._updateWorkerImages(),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(r){return this.modelManager.addModelURLs(r,this.scope),this._updateWorkerModels(),this.fire(new o.A("data",{dataType:"style"})),this}addModel(r,c,f={}){return this._checkLoaded(),this._validate(fe,`models.${r}`,c,null,f)||(this.modelManager.addModel(r,c,this.scope),this.fire(new o.A("data",{dataType:"style"}))),this}hasModel(r){return this.modelManager.hasModel(r,this.scope)}removeModel(r){return this.hasModel(r)?(this.modelManager.removeModel(r,this.scope,!1,!0),this.fire(new o.A("data",{dataType:"style"})),this):this.fire(new o.z(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(r,c,f={}){if(this._checkLoaded(),this.getOwnSource(r)!==void 0)throw new Error(`There is already a source with ID "${r}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(kl,`sources.${r}`,c,null,f))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const y=qh(r,c,this.dispatcher,this);y.scope=this.scope,y.setEventedParent(this,()=>({isSourceLoaded:this._isSourceCacheLoaded(y.id),source:y.serialize(),sourceId:y.id}));const v=S=>{const N=(S?"symbol:":"other:")+y.id,C=o.C(N,this.scope),k=this._sourceCaches[N]=new No(C,y,S);(S?this._symbolSourceCaches:this._otherSourceCaches)[y.id]=k,k.onAdd(this.map)};v(!1),c.type!=="vector"&&c.type!=="geojson"||v(!0),y.onAdd&&y.onAdd(this.map),f.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(r){this._checkLoaded();const c=this.getOwnSource(r);if(!c)throw new Error("There is no source with this ID");for(const y in this._layers)if(this._layers[y].source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while layer "${y}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===r)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const y=Object.entries(this.stylesheet.iconsets).find(([v,S])=>S.type==="source"&&S.source===r);if(y)return this.fire(new o.z(new Error(`Source "${r}" cannot be removed while iconset "${y[0]}" is using it.`)))}const f=this.getOwnSourceCaches(r);for(const y of f){const v=o.dj(y.id);delete this._sourceCaches[v],this._changes.discardSourceCacheUpdate(y.id),y.fire(new o.A("data",{sourceDataType:"metadata",dataType:"source",sourceId:y.getSource().id})),y.setEventedParent(null),y.clearTiles()}return delete this._otherSourceCaches[r],delete this._symbolSourceCaches[r],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(r,c){this._checkLoaded(),this.getOwnSource(r).setData(c),this._changes.setDirty()}getOwnSource(r){const c=this.getOwnSourceCache(r);return c&&c.getSource()}getOwnSources(){const r=[];for(const c in this._otherSourceCaches){const f=this.getOwnSourceCache(c);f&&r.push(f.getSource())}return r}areTilesLoaded(){const r=this._mergedSourceCaches;for(const c in r){const f=r[c]._tiles;for(const y in f){const v=f[y];if(v.state!=="loaded"&&v.state!=="errored")return!1}}return!0}setLights(r){if(this._checkLoaded(),!r)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const v of r){if(this._validate(gc,"lights",v))return;switch(v.type){case"ambient":if(this.ambientLight){const S=this.ambientLight;S.set(v),S.updateTransitions(c)}else this.ambientLight=new Ln(v,rn||(rn=new o.a7({color:new o.a8(o.a5.properties_light_ambient.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const S=this.directionalLight;S.set(v),S.updateTransitions(c)}else this.directionalLight=new Ln(v,Ar||(Ar=new o.a7({direction:new o.an(o.a5.properties_light_directional.direction),color:new o.a8(o.a5.properties_light_directional.color),"color-use-theme":new o.a8({type:"string",default:"default","property-type":"data-constant"}),intensity:new o.a8(o.a5.properties_light_directional.intensity),"cast-shadows":new o.a8(o.a5.properties_light_directional["cast-shadows"]),"shadow-quality":new o.a8(o.a5.properties_light_directional["shadow-quality"]),"shadow-intensity":new o.a8(o.a5.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const f=Object.assign(c,{worldview:this.map.getWorldview()}),y=new o.aa(this.z||0,f);this.ambientLight&&this.ambientLight.recalculate(y),this.directionalLight&&this.directionalLight.recalculate(y),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const r=this.directionalLight,c=this.ambientLight;if(!r||!c)return;const f=O=>.2126*(O[0]<=.03928?O[0]/12.92:Math.pow((O[0]+.055)/1.055,2.4))+.7152*(O[1]<=.03928?O[1]/12.92:Math.pow((O[1]+.055)/1.055,2.4))+.0722*(O[2]<=.03928?O[2]/12.92:Math.pow((O[2]+.055)/1.055,2.4)),y=r.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),v=r.properties.get("intensity"),S=r.properties.get("direction"),N=1-o.d1(S.x,S.y,S.z)[2]/90,C=f(y)*v*N,k=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),D=c.properties.get("intensity"),U=f(k)*D;return Number(((C+U)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const r=[];return this.directionalLight&&r.push(this.directionalLight.get()),this.ambientLight&&r.push(this.ambientLight.get()),r}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(r){if(r==null||r===""&&this.isRootStyle())return this;if(o.dk(r)){const c=o.dl(r),f=this.fragments.find(({id:v})=>v===c);if(!f)return;const y=o.dj(r);return f.style.getFragmentStyle(y)}{const c=this.fragments.find(({id:f})=>f===r);return c?c.style:void 0}}setFeaturesetSelectors(r){if(!r)return;const c={},f=(y,v="")=>`${y}::${v}`;this._featuresetSelectors={};for(const y in r){const v=this._featuresetSelectors[y]=[];for(const S of r[y].selectors){if(S.featureNamespace){const C=this.getOwnLayer(S.layer);if(!C){o.w(`Layer is undefined for selector: ${S.layer}`);continue}const k=f(C.source,C.sourceLayer);if(k in c&&c[k]!==S.featureNamespace){o.w(`"featureNamespace ${S.featureNamespace} of featureset ${y}'s selector is not associated to the same source, skip this selector`);continue}c[k]=S.featureNamespace}let N;if(S.properties)for(const C in S.properties){const k=o.X(S.properties[C]);k.result==="success"&&(N=N||{},N[C]=k.value)}v.push({layerId:S.layer,namespace:S.featureNamespace,properties:N,uniqueFeatureID:S._uniqueFeatureID})}}}getFeaturesetDescriptors(r){const c=this.getFragmentStyle(r);if(!c||!c.stylesheet.featuresets)return[];const f=[];for(const y in c.stylesheet.featuresets)f.push({featuresetId:y,importId:c.scope?c.scope:void 0});return f}getFeaturesetLayers(r,c){const f=this.getFragmentStyle(c),y=f.stylesheet.featuresets;if(!y||!y[r])return this.fire(new o.z(new Error(`The featureset '${r}' does not exist in the map's style and cannot be queried.`))),[];const v=[];for(const S of y[r].selectors){const N=f.getOwnLayer(S.layer);N&&v.push(N)}return v}getConfigProperty(r,c){const f=this.getFragmentStyle(r);if(!f)return null;const y=o.C(c,f.scope),v=f.options.get(y),S=v?v.value||v.default:null;return S?S.serialize():null}setConfigProperty(r,c,f){const y=this.getFragmentStyle(r);if(!y)return;const v=y.stylesheet.indoor?Cv(y.stylesheet.schema):y.stylesheet.schema;if(!v||!v[c])return;const S=o.X(f);if(S.result!=="success")return void Sc(this,S.value);const N=S.value.expression,C=o.C(c,y.scope),k=y.options.get(C);if(!k)return;let D;const{minValue:U,maxValue:O,stepValue:G,type:ee,values:J}=v[c],se=o.X(v[c].default);se.result==="success"&&(D=se.value.expression),D?(this.options.set(C,Object.assign({},k,{value:N,default:D,minValue:U,maxValue:O,stepValue:G,type:ee,values:J})),this.updateConfigDependencies(c)):this.fire(new o.z(new Error(`No schema defined for the config option "${c}" in the "${r}" fragment.`)))}getConfig(r){const c=this.getFragmentStyle(r);if(!c)return null;const f=c.stylesheet.schema;if(!f)return null;const y={};for(const v in f){const S=o.C(v,c.scope),N=c.options.get(S),C=N?N.value||N.default:null;y[v]=C?C.serialize():null}return y}setConfig(r,c){const f=this.getFragmentStyle(r);f&&(f.updateConfig(c,f.stylesheet.schema),this.updateConfigDependencies())}getSchema(r){const c=this.getFragmentStyle(r);return c?c.stylesheet.schema:null}setSchema(r,c){const f=this.getFragmentStyle(r);f&&(f.stylesheet.schema=c,f.updateConfig(f._config,c),this.updateConfigDependencies())}updateConfig(r,c){if(this._config=r,r||c)if(c)for(const f in c){let y,v;const S=o.X(c[f].default);if(S.result==="success"&&(y=S.value.expression),r&&r[f]!==void 0){const O=o.X(r[f]);O.result==="success"&&(v=O.value.expression)}const{minValue:N,maxValue:C,stepValue:k,type:D,values:U}=c[f];if(y){const O=o.C(f,this.scope);this.options.set(O,{default:y,value:v,minValue:N,maxValue:C,stepValue:k,type:D,values:U})}else this.fire(new o.z(new Error(`No schema defined for config option "${f}".`)))}else this.fire(new o.z(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(r){for(const c of this._configDependentLayers){const f=this.getLayer(c);if(f){if(r&&!f.configDependencies.has(r))continue;f.possiblyEvaluateVisibility(),this._updateLayer(f)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle(c=>{const f=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(f){const y=c._evaluateColorThemeData(f);(!c._styleColorTheme.lut&&y!==""||c._styleColorTheme.lut&&y!==c._styleColorTheme.lut.data)&&c.setColorTheme(f)}}),this._changes.setDirty()}addLayer(r,c,f={}){this._checkLoaded();const y=r.id;if(this._layers[y])return void this.fire(new o.z(new Error(`Layer with id "${y}" already exists on this map`)));let v;if(r.type==="custom"){if(Sc(this,o.dm(r)))return;v=o.dn(r,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof r.source=="object"&&(this.addSource(y,r.source),r=o.di(r),r=o.h(r,{source:y})),this._validate(Ks,`layers.${y}`,r,{arrayIndex:-1},f))return;v=o.dn(r,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(v),v.setEventedParent(this,{layer:{id:y}})}v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid);let S=this._order.length;if(c){const D=this._order.indexOf(c);if(D===-1)return void this.fire(new o.z(new Error(`Layer with id "${c}" does not exist on this map.`)));v.slot===this._layers[c].slot?S=D:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(S,0,y),this._layerOrderChanged=!0,this._layers[y]=v;const N=this.getOwnLayerSourceCache(v),C=!!this.directionalLight&&this.directionalLight.shadowsEnabled();N&&v.canCastShadows()&&C&&(N.castsShadows=!0);const k=this._changes.getRemovedLayer(v);if(k&&v.source&&N&&v.type!=="custom"){this._changes.discardLayerRemoval(v);const D=o.C(v.source,v.scope);k.type!==v.type?this._changes.updateSourceCache(D,"clear"):(this._changes.updateSourceCache(D,"reload"),N.pause())}this._updateLayer(v),v.onAdd&&v.onAdd(this.map),v.scope=this.scope,this.mergeLayers()}moveLayer(r,c){this._checkLoaded();const f=this._checkLayer(r);if(!f||r===c)return;const y=this._order.indexOf(r);this._order.splice(y,1);let v=this._order.length;if(c){const S=this._order.indexOf(c);if(S===-1)return void this.fire(new o.z(new Error(`Layer with id "${c}" does not exist on this map.`)));f.slot===this._layers[c].slot?v=S:o.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(v,0,r),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(r){this._checkLoaded();const c=this._checkLayer(r);if(!c)return;c.setEventedParent(null);const f=this._order.indexOf(r);this._order.splice(f,1),delete this._layers[r],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const y=this.getOwnLayerSourceCache(c);if(y&&y.castsShadows){let v=!1;for(const S in this._layers)if(this._layers[S].source===c.source&&this._layers[S].canCastShadows()){v=!0;break}y.castsShadows=v}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(r){return this._layers[r]}hasLayer(r){return r in this._mergedLayers}hasLayerType(r){for(const c in this._layers)if(this._layers[c].type===r)return!0;return!1}setLayerZoomRange(r,c,f){this._checkLoaded();const y=this._checkLayer(r);y&&(y.minzoom===c&&y.maxzoom===f||(c!=null&&(y.minzoom=c),f!=null&&(y.maxzoom=f),this._updateLayer(y)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(r,c){this._checkLoaded();const f=this._checkLayer(r);f&&f.slot!==c&&(f.slot=c,this._updateLayer(f))}setFilter(r,c,f={}){this._checkLoaded();const y=this._checkLayer(r);if(y&&!o.bv(y.filter,c))return c==null?(y.filter=void 0,void this._updateLayer(y)):void(this._validate(Be,`layers.${y.id}.filter`,c,{layerType:y.type},f)||(y.filter=o.di(c),this._updateLayer(y)))}getFilter(r){const c=this._checkLayer(r);if(c)return o.di(c.filter)}setLayoutProperty(r,c,f,y={}){this._checkLoaded();const v=this._checkLayer(r);if(v&&!o.bv(v.getLayoutProperty(c),f)){if(f!=null&&(!y||y.validate!==!1)&&Sc(v,ie.call(jo,{key:`layers.${r}.layout.${c}`,layerType:v.type,objectKey:c,value:f,styleSpec:o.a5,style:{glyphs:!0,sprite:!0}})))return;v.setLayoutProperty(c,f),v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),this._updateLayer(v)}}getLayoutProperty(r,c){const f=this._checkLayer(r);if(f)return f.getLayoutProperty(c)}setPaintProperty(r,c,f,y={}){this._checkLoaded();const v=this._checkLayer(r);if(!v||o.bv(v.getPaintProperty(c),f)||f!=null&&(!y||y.validate!==!1)&&Sc(v,ne.call(jo,{key:`layers.${r}.paint.${c}`,layerType:v.type,objectKey:c,value:f,styleSpec:o.a5})))return;const S=v.setPaintProperty(c,f);v.configDependencies.size!==0&&this._configDependentLayers.add(v.fqid),S&&this._updateLayer(v),this._changes.updatePaintProperties(v)}getPaintProperty(r,c){const f=this._checkLayer(r);if(f)return f.getPaintProperty(c)}setFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:C,importId:k}=r.target,D=this.getFragmentStyle(k),U=D.getFeaturesetLayers(C);for(const{source:O,sourceLayer:G}of U)D.setFeatureState({id:r.id,source:O,sourceLayer:G},c)}else if("layerId"in r.target){const{layerId:C}=r.target,k=this.getLayer(C);this.setFeatureState({id:r.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const f=r.source,y=r.sourceLayer,v=this._checkSource(f);if(!v)return;const S=v.type;if(S==="geojson"&&y)return void this.fire(new o.z(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(S==="vector"&&!y)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided.")));const N=this.getOwnSourceCaches(f);for(const C of N)C.setFeatureState(y,r.id,c)}removeFeatureState(r,c){if(this._checkLoaded(),"target"in r){if("featuresetId"in r.target){const{featuresetId:C,importId:k}=r.target,D=this.getFragmentStyle(k),U=D.getFeaturesetLayers(C);for(const{source:O,sourceLayer:G}of U)D.removeFeatureState({id:r.id,source:O,sourceLayer:G},c)}else if("layerId"in r.target){const{layerId:C}=r.target,k=this.getLayer(C);this.removeFeatureState({id:r.id,source:k.source,sourceLayer:k.sourceLayer},c)}return}const f=r.source,y=this._checkSource(f);if(!y)return;const v=y.type,S=v==="vector"?r.sourceLayer:void 0;if(v==="vector"&&!S)return void this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof r.id!="string"&&typeof r.id!="number")return void this.fire(new o.z(new Error("A feature id is required to remove its specific state property.")));const N=this.getOwnSourceCaches(f);for(const C of N)C.removeFeatureState(S,r.id,c)}getFeatureState(r){if(this._checkLoaded(),"target"in r){let v;if("featuresetId"in r.target){const{featuresetId:S,importId:N}=r.target,C=this.getFragmentStyle(N),k=C.getFeaturesetLayers(S);for(const{source:D,sourceLayer:U}of k){const O=C.getFeatureState({id:r.id,source:D,sourceLayer:U});if(O&&!v)v=O;else if(!o.bv(v,O))return void this.fire(new o.z(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in r.target){const{layerId:S}=r.target,N=this.getLayer(S);v=this.getFeatureState({id:r.id,source:N.source,sourceLayer:N.sourceLayer})}return v}const c=r.source,f=r.sourceLayer,y=this._checkSource(c);if(y){if(y.type!=="vector"||f)return r.id===void 0&&this.fire(new o.z(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(f,r.id);this.fire(new o.z(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(r){return this.stylesheet.transition=o.h({},this.stylesheet.transition,r),this.transition=this.stylesheet.transition,this}getTransition(){return o.h({},this.stylesheet.transition)}serialize(){this._checkLoaded();const r=this.getTerrain(),c=r&&this.terrain&&this.terrain.scope===this.scope?r:this.stylesheet.terrain;return o.dp({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},f=>f!==void 0)}_updateFilteredLayers(r){for(const c of Object.values(this._mergedLayers))r(c)&&this._updateLayer(c)}_updateLayer(r){this._changes.updateLayer(r);const c=this.getLayerSourceCache(r),f=o.C(r.source,r.scope),y=this._changes.getUpdatedSourceCaches();r.source&&!y[f]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(f,"reload"),c.pause()),r.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(r){const c=N=>this._mergedLayers[N].is3D(!!this.terrain),f=this.order,y={},v=[];for(let N=f.length-1;N>=0;N--){const C=f[N];if(c(C)){y[C]=N;for(const k of r){const D=k[C];if(D)for(const U of D)v.push(U)}}}v.sort((N,C)=>C.intersectionZ-N.intersectionZ);const S=[];for(let N=f.length-1;N>=0;N--){const C=f[N];if(c(C))for(let k=v.length-1;k>=0;k--){const D=v[k].feature;if(D.layer&&y[D.layer.id]<N)break;S.push(D),v.pop()}else for(const k of r){const D=k[C];if(D)for(const U of D)S.push(U.feature)}}return S}queryRenderedFeatures(r,c,f){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(Be,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b3(c.filter));const v={},S=D=>{if(Zf.has(D.type))return;const U=this.getOwnLayerSourceCache(D),O=v[U.id]=v[U.id]||{sourceCache:U,layers:{},has3DLayers:!1};D.is3D(!!this.terrain)&&(O.has3DLayers=!0),O.layers[D.fqid]=O.layers[D.fqid]||{styleLayer:D,targets:[]},O.layers[D.fqid].targets.push({filter:y})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new o.z(new Error("parameters.layers must be an Array."))),[];for(const D of c.layers){const U=this._layers[D];if(!U)return this.fire(new o.z(new Error(`The layer '${D}' does not exist in the map's style and cannot be queried for features.`))),[];S(U)}}else for(const D in this._layers)S(this._layers[D]);const N=this._queryRenderedFeatures(r,v,f),C=this._flattenAndSortRenderedFeatures(N),k=[];for(const D of C)o.dq(D.layer.id)===this.scope&&k.push(D);return k}queryRenderedFeatureset(r,c,f){let y;c&&!Array.isArray(c)&&c.filter&&(this._validate(Be,"queryRenderedFeatures.filter",c.filter,null,c),y=o.b3(c.filter));const v="mock",S=[];if(c&&c.target)S.push(Object.assign({},c,{targetId:v,filter:y}));else{const D=this.getFeaturesetDescriptors();for(const U of D)S.push({targetId:v,filter:y,target:U});for(const{style:U}of this.fragments){const O=U.getFeaturesetDescriptors();for(const G of O)S.push({targetId:v,filter:y,target:G})}}const N=this.queryRenderedTargets(r,S,f),C=[],k=new Set;for(const D of N)for(const U of D.variants[v])Of(U,D,k)||C.push(new o.dr(D,U));return C}queryRenderedTargets(r,c,f){const y={},v=(N,C,k,D)=>{const U=y[C.id]=y[C.id]||{sourceCache:C,layers:{},has3DLayers:!1};if(U.layers[N.fqid]=U.layers[N.fqid]||{styleLayer:N,targets:[]},N.is3D(!!this.terrain)&&(U.has3DLayers=!0),!D)return k.uniqueFeatureID=!1,void U.layers[N.fqid].targets.push(k);U.layers[N.fqid].targets.push(Object.assign({},k,{namespace:D.namespace,properties:D.properties,uniqueFeatureID:D.uniqueFeatureID}))};for(const N of c)if("featuresetId"in N.target){const{featuresetId:C,importId:k}=N.target,D=this.getFragmentStyle(k);if(!D||!D._featuresetSelectors)continue;const U=D._featuresetSelectors[C];if(!U){this.fire(new o.z(new Error(`The featureset '${C}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const O of U){const G=D.getOwnLayer(O.layerId);G&&!Zf.has(G.type)&&v(G,D.getOwnLayerSourceCache(G),N,O)}}else if("layerId"in N.target){const{layerId:C}=N.target,k=this.getLayer(C);if(!k||Zf.has(k.type))continue;v(k,this.getLayerSourceCache(k),N)}const S=this._queryRenderedFeatures(r,y,f);return this._flattenAndSortRenderedFeatures(S)}_queryRenderedFeatures(r,c,f){const y=[],v=!!this.map._showQueryGeometry,S=bn.createFromScreenPoints(r,f);for(const N in c){const C=Ff(S,c[N],this._availableImages,f,v);Object.keys(C).length&&y.push(C)}if(this.placement)for(const N in c){if(!c[N].sourceCache._onlySymbols)continue;const C=hu(S.screenGeometry,c[N],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(C).length&&y.push(C)}return y}querySourceFeatures(r,c){const f=c&&c.filter;f&&this._validate(Be,"querySourceFeatures.filter",f,null,c);let y=[];const v=this.getOwnSourceCaches(r);for(const S of v)y=y.concat(Kh(S,c));return y}addSourceType(r,c,f){return Na.getSourceType(r)?f(new Error(`A source type called "${r}" already exists.`)):(Na.setSourceType(r,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:r,url:c.workerSourceURL},f):f(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(r,c,f={}){this._checkLoaded();const y=this.light.getLight();let v=!1;for(const N in r)if(!o.bv(r[N],y[N])){v=!0;break}if(!v)return;const S=this._getTransitionParameters();this.light.setLight(r,c,f),this.light.updateTransitions(S)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=o.q.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&o.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(r,c=1){if(this._checkLoaded(),!r)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,r===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let f=r;const y=r.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof f.source=="object"){const N="terrain-dem-src";this.addSource(N,f.source),f=o.di(f),f=o.h(f,{source:N})}const v=o.h({},f),S={};if(this.terrain&&y){v.source=this.terrain.get().source;const N=this.terrain?this.getFragmentStyle(this.terrain.scope):null;N&&(S.style=N.serialize())}if(this._validate(et,"terrain",v,S))return}if(!this.terrain||this.terrain.scope!==this.scope&&!y||this.terrain&&c!==this.terrain.drapeRenderMode){if(!f)return;this._createTerrain(f,c),this.fire(new o.A("data",{dataType:"style"}))}else{const v=this.terrain,S=v.get();for(const N of Object.keys(o.a5.terrain))!f.hasOwnProperty(N)&&o.a5.terrain[N].default&&(f[N]=o.a5.terrain[N].default);for(const N in r)if(!o.bv(r[N],S[N])){v.set(r,this.options),this.stylesheet.terrain=r;const C=this._getTransitionParameters({duration:0});v.updateTransitions(C),this.fire(new o.A("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(r){const c=this.fog=new Hs(r,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createSnow(r){const c=this.snow=new Yr(r,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_createRain(r){const c=this.rain=new $r(r,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask(()=>{for(const r of this.map._markers)r._evaluateOpacity()})}getFog(){return this.fog?this.fog.get():null}setFog(r){if(this._checkLoaded(),!r)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.fog=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createFog(r);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(r){if(this._checkLoaded(),!r)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.snow=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createSnow(r);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(r){if(this._checkLoaded(),!r)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!o.bv(c.get(),r)){c.set(r,this.options),this.stylesheet.rain=c.get();const f=this._getTransitionParameters({duration:0});c.updateTransitions(f)}}else this._createRain(r);this._markersNeedUpdate=!0}_reloadColorTheme(){const r=()=>{for(const y in this._layers)this._layers[y].lut=this._styleColorTheme.lut;for(const y in this._sourceCaches)this._sourceCaches[y].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void r();const f=this._evaluateColorThemeData(c);this._loadColorTheme(f).then(()=>{this.fire(new o.A("colorthemeset")),r()}).catch(y=>{o.w(`Couldn't set color theme: ${y}`)})}setColorTheme(r){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&o.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=r,this._reloadColorTheme()}setImportColorTheme(r,c){const f=this.getFragmentStyle(r);f&&(f._styleColorTheme.colorThemeOverride=c,f._reloadColorTheme())}_getTransitionParameters(r){return{now:o.q.now(),transition:o.h(this.transition,r)}}updateDrapeFirstLayers(){if(!this.terrain)return;const r=[],c=[];for(const f of this._mergedOrder)this.isLayerDraped(this._mergedLayers[f])?r.push(f):c.push(f);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...r),this._drapedFirstOrder.push(...c)}_createTerrain(r,c){const f=this.terrain=new De(r,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=r),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const y=this._getTransitionParameters({duration:0});f.updateTransitions(y)}_force3DLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const r in this._layers){const c=this._layers[r];c.type==="symbol"&&this._updateLayer(c)}}_validate(r,c,f,y,v={}){if(v&&v.validate===!1)return!1;const S=o.h({},this.serialize());return Sc(this,r.call(jo,o.h({key:c,style:S,value:f,styleSpec:o.a5},y)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),o.ds.off("pluginStateChange",this._rtlTextPluginCallback);for(const r in this._mergedLayers)this._mergedLayers[r].setEventedParent(null);for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles(),this._mergedSourceCaches[r].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(r){const c=this.getSourceCaches(r);for(const f of c)f.clearTiles()}clearSources(){for(const r in this._mergedSourceCaches)this._mergedSourceCaches[r].clearTiles()}clearLayers(){for(const r in this._mergedLayers){const c=this._mergedLayers[r];c._clear&&c._clear()}}reloadSource(r){const c=this.getSourceCaches(r);for(const f of c)f.resume(),f.reload()}reloadSources(){for(const r of this.getSources())r.reload&&r.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle(r=>{r.modelManager.reloadModels(r.scope)})}updateSources(r){let c;this.directionalLight&&(c=xd(this.directionalLight));const f=new Set;for(const y in this._mergedLayers){const v=this._mergedLayers[y];v.hasElevation()&&!f.has(v.source)&&f.add(v.source)}for(const y in this._mergedSourceCaches){const v=this._mergedSourceCaches[y],S=f.has(v._source.id);v.update(r,void 0,void 0,c,S)}}_generateCollisionBoxes(){for(const r in this._sourceCaches){const c=this._sourceCaches[r];c.resume(),c.reload()}}_updatePlacement(r,c,f,y,v,S,N=!1){let C=!1,k=!1;const D={},U={};for(const O of this._mergedOrder){const G=this._mergedLayers[O];if(G.type!=="symbol")continue;const ee=o.C(G.source,G.scope);let J=D[ee];if(!J){const te=this.getLayerSourceCache(G);if(!te)continue;const le=te.getRenderableIds(!0).map(de=>te.getTileByID(de));U[ee]=le.slice(),J=D[ee]=le.sort((de,pe)=>pe.tileID.overscaledZ-de.tileID.overscaledZ||(de.tileID.isLessThan(pe.tileID)?-1:1))}const se=this.crossTileSymbolIndex.addLayer(G,J,c.center.lng,c.projection);C=C||se}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),N=N||this._layerOrderChanged||y===0,this._layerOrderChanged&&this.fire(new o.A("neworder")),(N||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(o.q.now(),c.zoom))&&(this.pauseablePlacement=new Hf(c,this._mergedOrder,N,f,y,v,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,D,U,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(o.q.now()),k=!0),C&&this.pauseablePlacement.placement.setStale()),k||C){this._buildingIndex.onNewFrame(c.zoom);for(let O=0;O<this._mergedOrder.length;O++){const G=this._mergedLayers[this._mergedOrder[O]];if(G.type!=="symbol")continue;const ee=this.isLayerClipped(G);this.placement.updateLayerOpacities(G,D[o.C(G.source,G.scope)],O,ee?S:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(o.q.now())}}_releaseSymbolFadeTiles(){for(const r in this._sourceCaches)this._sourceCaches[r].releaseSymbolFadeTiles()}addImport(r,c){this._checkLoaded();const f=this.stylesheet.imports=this.stylesheet.imports||[];if(f.findIndex(({id:v})=>v===r.id)!==-1)return void this.fire(new o.z(new Error(`Import with id '${r.id}' already exists in the map's style.`)));if(!c)return f.push(r),this._loadImports([r],!0);const y=f.findIndex(({id:v})=>v===c);return y===-1&&this.fire(new o.z(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=f.slice(0,y).concat(r).concat(f.slice(y)),this._loadImports([r],!0,c)}updateImport(r,c){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(r);return y===-1?this:typeof c=="string"?(this.setImportUrl(r,c),this):(c.url&&c.url!==f[y].url&&this.setImportUrl(r,c.url),o.bv(c.config,f[y].config)||this.setImportConfig(r,c.config,c.data.schema),o.bv(c.data,f[y].data)||this.setImportData(r,c.data),this)}moveImport(r,c){this._checkLoaded();let f=this.stylesheet.imports||[];const y=this.getImportIndex(r);if(y===-1)return this;const v=this.getImportIndex(c);if(v===-1)return this;const S=f[y],N=this.fragments[y];return f=f.filter(({id:C})=>C!==r),this.fragments=this.fragments.filter(({id:C})=>C!==r),this.stylesheet.imports=f.slice(0,v).concat(S).concat(f.slice(v)),this.fragments=this.fragments.slice(0,v).concat(N).concat(this.fragments.slice(v)),this.mergeLayers(),this}setImportUrl(r,c){this._checkLoaded();const f=this.stylesheet.imports||[],y=this.getImportIndex(r);if(y===-1)return this;f[y].url=c;const v=this.fragments[y];return v.style=this._createFragmentStyle(f[y]),v.style.on("style.import.load",()=>this.mergeAll()),v.style.loadURL(c),this}setImportData(r,c){this._checkLoaded();const f=this.getImportIndex(r),y=this.stylesheet.imports||[];return f===-1?this:c?(this.fragments[f].style.setState(c),this._reloadImports(),this):(delete y[f].data,this.setImportUrl(r,y[f].url))}setImportConfig(r,c,f){this._checkLoaded();const y=this.getImportIndex(r),v=this.stylesheet.imports||[];if(y===-1)return this;c?v[y].config=c:delete v[y].config;const S=this.fragments[y];f&&S.style.stylesheet&&(S.style.stylesheet.schema=f);const N=S.style.stylesheet&&S.style.stylesheet.schema;return S.config=c,S.style.updateConfig(c,N),this.updateConfigDependencies(),this}removeImport(r){this._checkLoaded();const c=this.stylesheet.imports||[],f=this.getImportIndex(r);f!==-1&&(c.splice(f,1),this.fragments[f].style._remove(),this.fragments.splice(f,1),this._reloadImports())}getImportIndex(r){const c=(this.stylesheet.imports||[]).findIndex(f=>f.id===r);return c===-1&&this.fire(new o.z(new Error(`Import '${r}' does not exist in the map's style and cannot be updated.`))),c}getLayer(r){return this._mergedLayers[r]}getSources(){const r=[];for(const c in this._mergedOtherSourceCaches){const f=this._mergedOtherSourceCaches[c];f&&r.push(f.getSource())}return r}getSource(r,c){const f=this.getSourceCache(r,c);return f&&f.getSource()}getLayerSource(r){const c=this.getLayerSourceCache(r);return c&&c.getSource()}getSourceCache(r,c){const f=o.C(r,c);return this._mergedOtherSourceCaches[f]}getLayerSourceCache(r){const c=o.C(r.source,r.scope);return r.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(r){if(r==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[r]&&c.push(this._mergedOtherSourceCaches[r]),this._mergedSymbolSourceCaches[r]&&c.push(this._mergedSymbolSourceCaches[r]),c}updateSourceCaches(){const r=this._changes.getUpdatedSourceCaches();for(const c in r){const f=r[c];f==="reload"?this.reloadSource(c):f==="clear"&&this.clearSource(c)}}updateLayers(r){const c=this._changes.getUpdatedPaintProperties();for(const f of c){const y=this.getLayer(f);y&&y.updateTransitions(r)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(r){this.stylesheet.glyphs=r,this.glyphManager.setURL(r)}getImages(r,c,f){this.imageManager.getImages(c.images,c.scope,f),this._updateTilesForChangedImages();const y=S=>{if(S){const N=c.images.map(C=>o.I.toString(C));S.setDependencies(c.tileID.key,c.type,N)}},v=o.C(c.source,c.scope);y(this._mergedOtherSourceCaches[v]),y(this._mergedSymbolSourceCaches[v]),c.images.some(S=>S.iconsetId)&&this.fire(new o.A("data",{dataType:"style"}))}rasterizeImages(r,c,f){this.imageManager.rasterizeImages(c,f)}getGlyphs(r,c,f){this.glyphManager.getGlyphs(c.stacks,f)}getResource(r,c,f){return o.dt(c,f)}getOwnSourceCache(r){return this._otherSourceCaches[r]}getOwnLayerSourceCache(r){return r.type==="symbol"?this._symbolSourceCaches[r.source]:this._otherSourceCaches[r.source]}getOwnSourceCaches(r){const c=[];return this._otherSourceCaches[r]&&c.push(this._otherSourceCaches[r]),this._symbolSourceCaches[r]&&c.push(this._symbolSourceCaches[r]),c}_isSourceCacheLoaded(r){const c=this.getOwnSourceCaches(r);return c.length===0?(this.fire(new o.z(new Error(`There is no source with ID '${r}'`))),!1):c.every(f=>f.loaded())}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(r,c){if(!this._clipLayerPresent&&r.type!=="fill-extrusion"&&r.type!=="building")return!1;const f=r.type==="fill-extrusion"&&(r.sourceLayer==="building"||r.sourceLayer==="procedural_buildings"),y=r.type==="building";if(r.is3D(!!this.terrain)){if(f||y||c&&c.type==="batched-model"||r.type==="model")return!0}else if(r.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach(r=>{r.style._remove()}),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}Na.getSourceType=function(p){return zf[p]},Na.setSourceType=function(p,r){zf[p]=r},Na.registerForPluginStateChange=o.du;var Ux=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,_d=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,vd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,$x="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",Kf=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,sa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Xf=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,Rt=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,Gx=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Yf=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,Jf=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const fp=[];Ha(Ux,fp),Ha(vd,fp),Ha(_d,fp);const bu={"_prelude_fog.vertex.glsl":sa,"_prelude_terrain.vertex.glsl":Kf,"_prelude_shadow.vertex.glsl":Yf,"_prelude_fog.fragment.glsl":Xf,"_prelude_shadow.fragment.glsl":Jf,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":Rt,"_prelude_raster_particle.glsl":Gx},Ea={};an("",Kf),an(Xf,sa),an(Jf,Yf),an(Rt,""),an(Gx,"");const Qf=an(_d,vd),Tc=Ux;var mp={background:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:an(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:an("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:an(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:an(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:an("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:an("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:an("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:an(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:an(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:an(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:an(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:an(`precision highp float;uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:an("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:an("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:an(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:an(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:an("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:an(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$x),skyboxGradient:an(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,$x),skyboxCapture:an(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:an(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:an(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:an(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:an(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:an("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:an("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:an("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:an("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function Ha(p,r){const c=p.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let f of c)if(f=f.trim(),f[0]==="#"&&f.includes("if")&&!f.includes("endif")){f=f.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const y=f.split(" ");for(const v of y)r.includes(v)||r.push(v)}}function an(p,r){const c=/#include\s+"([^"]+)"/g,f=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g;let y=r.match(/(attribute(\S*)|(^\s*|;)in) (highp |mediump |lowp )?([\w]+) ([\w]+)/gm);y&&(y=y.map(k=>{const D=k.split(" ");return D[D.length-1]}),y=[...new Set(y)]);const v={},S=[],N=[];if(p=p.replace(c,(k,D)=>(N.push(D),"")),(r=r.replace(c,(k,D)=>(S.push(D),""))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let C=[...fp];Ha(p,C),Ha(r,C);for(const k of[...S,...N])bu[k]||console.error(`Undefined include: ${k}`),Ea[k]||(Ea[k]=[],Ha(bu[k],Ea[k])),C=[...C,...Ea[k]];return{fragmentSource:p=p.replace(f,(k,D,U,O,G)=>(v[G]=!0,D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
in ${U} ${O} ${G};
#else
uniform ${U} ${O} u_${G};
#endif
`:D==="initialize"?`
#ifdef HAS_UNIFORM_u_${G}
    ${U} ${O} ${G} = u_${G};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${U} ${O} ${G};
#endif
`:D==="initialize-attribute"?"":void 0)),vertexSource:r=r.replace(f,(k,D,U,O,G)=>{const ee=O==="float"?"vec2":O,J=G.match(/color/)?"color":ee;return D==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${G}
in ${U} ${O} a_${G};
#endif
`:v[G]?D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${ee} a_${G};
out ${U} ${O} ${G};
#else
uniform ${U} ${O} u_${G};
#endif
`:D==="initialize"?J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = a_${G};
#else
    ${U} ${O} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${U} ${O} ${G} = u_${G};
#endif
`:D==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    in ${U} ${O} a_${G};
    out ${U} ${O} ${G};
#endif
`:D==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${G} = a_${G};
#endif
`:void 0:D==="define"?`
#ifndef HAS_UNIFORM_u_${G}
uniform lowp float u_${G}_t;
in ${U} ${ee} a_${G};
#else
uniform ${U} ${O} u_${G};
#endif
`:D==="define-instanced"?J==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${G}0;
in vec4 a_${G}1;
in vec4 a_${G}2;
in vec4 a_${G}3;
#else
uniform ${U} ${O} u_${G};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${U} ${ee} a_${G};
#else
uniform ${U} ${O} u_${G};
#endif
`:D==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${G}
    ${U} ${O} ${G} = a_${G};
#endif
`:J==="vec4"?`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${O} ${G} = a_${G};
#else
    ${U} ${O} ${G} = u_${G};
#endif
`:`
#ifndef HAS_UNIFORM_u_${G}
    ${U} ${O} ${G} = unpack_mix_${J}(a_${G}, u_${G}_t);
#else
    ${U} ${O} ${G} = u_${G};
#endif
`}),staticAttributes:y,usedDefines:C,vertexIncludes:S,fragmentIncludes:N}}class PS{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(r,c,f,y,v,S,N,C){this.context=r;let k=this.boundPaintVertexBuffers.length!==y.length;for(let U=0;!k&&U<y.length;U++)this.boundPaintVertexBuffers[U]!==y[U]&&(k=!0);let D=this.boundDynamicVertexBuffers.length!==N.length;for(let U=0;!D&&U<N.length;U++)this.boundDynamicVertexBuffers[U]!==N[U]&&(D=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==f||k||D||this.boundIndexBuffer!==v||this.boundVertexOffset!==S)this.freshBind(c,f,y,v,S,N,C);else{r.bindVertexArrayOES.set(this.vao);for(const U of N)U&&(U.bind(),C&&U.instanceCount&&U.setVertexAttribDivisor(r.gl,c,C));v&&v.dynamicDraw&&v.bind()}}freshBind(r,c,f,y,v,S,N){const C=r.numAttributes,k=this.context,D=k.gl;this.vao&&this.destroy(),this.vao=k.gl.createVertexArray(),k.bindVertexArrayOES.set(this.vao),this.boundProgram=r,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=f,this.boundIndexBuffer=y,this.boundVertexOffset=v,this.boundDynamicVertexBuffers=S,c.enableAttributes(D,r),c.bind(),c.setVertexAttribPointers(D,r,v);for(const U of f)U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,v);for(const U of S)U&&(U.enableAttributes(D,r),U.bind(),U.setVertexAttribPointers(D,r,v),N&&U.instanceCount&&U.setVertexAttribDivisor(D,r,N));y&&y.bind(),k.currentNumAttributes=C}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function Hx(p,r){const c=Math.pow(2,r.canonical.z),f=r.canonical.y;return[new o.ac(0,f/c).toLngLat().lat,new o.ac(0,(f+1)/c).toLngLat().lat]}function IS(p,r,c,f,y,v,S){const N=p.context,C=N.gl,k=c.hillshadeFBO;if(!k)return;p.prepareDrawTile();const D=p.isTileAffectedByFog(r),U=p.getOrCreateProgram("hillshade",{overrideFog:D});N.activeTexture.set(C.TEXTURE0),C.bindTexture(C.TEXTURE_2D,k.colorAttachment.get());const O=((se,te,le,de)=>{const pe=le.paint.get("hillshade-shadow-color"),ye=le.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",Se=le.paint.get("hillshade-highlight-color"),Te=le.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",_e=le.paint.get("hillshade-accent-color"),ve=le.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",be=le.paint.get("hillshade-emissive-strength");let Ue=o.al(le.paint.get("hillshade-illumination-direction"));if(le.paint.get("hillshade-illumination-anchor")==="viewport")Ue-=se.transform.angle;else if(se.style&&se.style.enable3dLights()&&se.style.directionalLight){const tt=se.style.directionalLight.properties.get("direction"),We=o.d1(tt.x,tt.y,tt.z);Ue=o.al(We[1])}const Ie=!se.options.moving;return{u_matrix:de||se.transform.calculateProjMatrix(te.tileID.toUnwrapped(),Ie),u_image:0,u_latrange:Hx(0,te.tileID),u_light:[le.paint.get("hillshade-exaggeration"),Ue],u_shadow:pe.toPremultipliedRenderColor(ye?null:le.lut),u_highlight:Se.toPremultipliedRenderColor(Te?null:le.lut),u_emissive_strength:be,u_accent:_e.toPremultipliedRenderColor(ve?null:le.lut)}})(p,c,f,p.terrain?r.projMatrix:null);p.uploadCommonUniforms(N,U,r.toUnwrapped());const{tileBoundsBuffer:G,tileBoundsIndexBuffer:ee,tileBoundsSegments:J}=p.getTileBoundsBuffers(c);U.draw(p,C.TRIANGLES,y,v,S,gs.disabled,O,f.id,G,ee,J)}function Wx(p,r,c){if(!r.needsDEMTextureUpload)return;const f=p.context,y=f.gl;f.pixelStoreUnpackPremultiplyAlpha.set(!1),r.demTexture=r.demTexture||p.getTileTexture(c.stride);const v=c.getPixels();r.demTexture?r.demTexture.update(v,{premultiply:!1}):r.demTexture=new o.T(f,v,y.R32F,{premultiply:!1}),r.needsDEMTextureUpload=!1}function Rv(p,r,c){const f=p.context,y=f.gl;if(!r.dem)return;const v=r.dem;if(f.activeTexture.set(y.TEXTURE1),Wx(p,r,v),!r.demTexture)return;r.demTexture.bind(y.NEAREST,y.CLAMP_TO_EDGE);const S=v.dim;f.activeTexture.set(y.TEXTURE0);let N=r.hillshadeFBO;if(!N){const O=new o.T(f,{width:S,height:S,data:null},y.RGBA8);O.bind(y.LINEAR,y.CLAMP_TO_EDGE),N=r.hillshadeFBO=f.createFramebuffer(S,S,!0,"renderbuffer"),N.colorAttachment.set(O.texture)}f.bindFramebuffer.set(N.framebuffer),f.viewport.set([0,0,S,S]);const{tileBoundsBuffer:C,tileBoundsIndexBuffer:k,tileBoundsSegments:D}=p.getMercatorTileBoundsBuffers(),U=[];p.linearFloatFilteringSupported()&&U.push("TERRAIN_DEM_FLOAT_FORMAT"),p.getOrCreateProgram("hillshadePrepare",{defines:U}).draw(p,y.TRIANGLES,Kt.disabled,Ss.disabled,Fs.unblended,gs.disabled,((O,G)=>{const ee=G.stride,J=o.bz();return o.ca(J,0,o.aj,-o.aj,0,0,1),o.bo(J,J,[0,-o.aj,0]),{u_matrix:J,u_image:1,u_dimension:[ee,ee],u_zoom:O.overscaledZ}})(r.tileID,v),c.id,C,k,D),r.needsHillshadePrepare=!1}class pr{constructor(r){this.gl=r.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(r){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class MS extends pr{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.clearColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class RS extends pr{getDefault(){return 1}set(r){(r!==this.current||this.dirty)&&(this.gl.clearDepth(r),this.current=r,this.dirty=!1)}}class kS extends pr{getDefault(){return 0}set(r){(r!==this.current||this.dirty)&&(this.gl.clearStencil(r),this.current=r,this.dirty=!1)}}class DS extends pr{getDefault(){return[!0,!0,!0,!0]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.colorMask(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class kv extends pr{getDefault(){return!0}set(r){(r!==this.current||this.dirty)&&(this.gl.depthMask(r),this.current=r,this.dirty=!1)}}class LS extends pr{getDefault(){return 255}set(r){(r!==this.current||this.dirty)&&(this.gl.stencilMask(r),this.current=r,this.dirty=!1)}}class em extends pr{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(r){const c=this.current;(r.func!==c.func||r.ref!==c.ref||r.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(r.func,r.ref,r.mask),this.current=r,this.dirty=!1)}}class zS extends pr{getDefault(){const r=this.gl;return[r.KEEP,r.KEEP,r.KEEP]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(r[0],r[1],r[2]),this.current=r,this.dirty=!1)}}class Dv extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=r,this.dirty=!1}}class qx extends pr{getDefault(){return[0,1]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||this.dirty)&&(this.gl.depthRange(r[0],r[1]),this.current=r,this.dirty=!1)}}class tm extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=r,this.dirty=!1}}class Zx extends pr{getDefault(){return this.gl.LESS}set(r){(r!==this.current||this.dirty)&&(this.gl.depthFunc(r),this.current=r,this.dirty=!1)}}class wu extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.BLEND):c.disable(c.BLEND),this.current=r,this.dirty=!1}}class bd extends pr{getDefault(){const r=this.gl;return[r.ONE,r.ZERO,r.ONE,r.ZERO]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class sm extends pr{getDefault(){return o.am.transparent.toNonPremultipliedRenderColor(null)}set(r){const c=this.current;(r.r!==c.r||r.g!==c.g||r.b!==c.b||r.a!==c.a||this.dirty)&&(this.gl.blendColor(r.r,r.g,r.b,r.a),this.current=r,this.dirty=!1)}}class nm extends pr{getDefault(){return this.gl.FUNC_ADD}set(r){(r!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(r,r),this.current=r,this.dirty=!1)}}class wd extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;r?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=r,this.dirty=!1}}class Lv extends pr{getDefault(){return this.gl.BACK}set(r){(r!==this.current||this.dirty)&&(this.gl.cullFace(r),this.current=r,this.dirty=!1)}}class Kx extends pr{getDefault(){return this.gl.CCW}set(r){(r!==this.current||this.dirty)&&(this.gl.frontFace(r),this.current=r,this.dirty=!1)}}let zv=class extends pr{getDefault(){return null}set(p){(p!==this.current||this.dirty)&&(this.gl.useProgram(p),this.current=p,this.dirty=!1)}};class Sd extends pr{getDefault(){return this.gl.TEXTURE0}set(r){(r!==this.current||this.dirty)&&(this.gl.activeTexture(r),this.current=r,this.dirty=!1)}}class rm extends pr{getDefault(){const r=this.gl;return[0,0,r.drawingBufferWidth,r.drawingBufferHeight]}set(r){const c=this.current;(r[0]!==c[0]||r[1]!==c[1]||r[2]!==c[2]||r[3]!==c[3]||this.dirty)&&(this.gl.viewport(r[0],r[1],r[2],r[3]),this.current=r,this.dirty=!1)}}class im extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,r),this.current=r,this.dirty=!1}}class Xx extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class om extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,r),this.current=r,this.dirty=!1}}class gp extends pr{getDefault(){return null}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Ov extends pr{getDefault(){return null}set(r){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,r),this.current=r,this.dirty=!1}}class Fv extends pr{getDefault(){return null}set(r){this.gl&&(r!==this.current||this.dirty)&&(this.gl.bindVertexArray(r),this.current=r,this.dirty=!1)}}class Bv extends pr{getDefault(){return 4}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,r),this.current=r,this.dirty=!1}}class jd extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,r),this.current=r,this.dirty=!1}}class Vv extends pr{getDefault(){return!1}set(r){if(r===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,r),this.current=r,this.dirty=!1}}class Yx extends pr{constructor(r,c){super(r),this.context=r,this.parent=c}getDefault(){return null}}class OS extends Yx{setDirty(){this.dirty=!0}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Uv extends Yx{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,r),this.current=r,this.dirty=!1}}class Jx extends Yx{attachment(){return this.gl.DEPTH_ATTACHMENT}set(r){if(r===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,r,0),this.current=r,this.dirty=!1}}class Qx extends Uv{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const ey=(p,r,c)=>({u_matrix:p,u_image0:0,u_skirt_height:r,u_ground_shadow_factor:c}),am=(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J)=>({u_proj_matrix:Float32Array.from(p),u_globe_matrix:r,u_normalize_matrix:Float32Array.from(f),u_merc_matrix:c,u_zoom_transition:y,u_merc_center:v,u_image0:0,u_frustum_tl:S,u_frustum_tr:N,u_frustum_br:C,u_frustum_bl:k,u_globe_pos:D,u_globe_radius:U,u_viewport:O,u_grid_matrix:J?Float32Array.from(J):new Float32Array(9),u_skirt_height:G,u_far_z_cutoff:ee});function ty(p,r){return p!=null&&r!=null&&!(!p.hasData()||!r.hasData())&&p.demTexture!=null&&r.demTexture!=null&&p.tileID.key!==r.tileID.key}const Su=new class{constructor(){this.operations={}}newMorphing(p,r,c,f,y){if(p in this.operations){const v=this.operations[p];v.to.tileID.key!==c.tileID.key&&(v.queued=c)}else this.operations[p]={startTime:f,phase:0,duration:y,from:r,to:c,queued:null}}getMorphValuesForProxy(p){if(!(p in this.operations))return null;const r=this.operations[p];return{from:r.from,to:r.to,phase:r.phase}}update(p){for(const r in this.operations){const c=this.operations[r];for(c.phase=(p-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,p)){delete this.operations[r];break}}}_nextOp(p,r){return!!p.queued&&(p.from=p.to,p.to=p.queued,p.queued=null,p.phase=0,p.startTime=r,!0)}_validOp(p){return p.from.hasData()&&p.to.hasData()}},$v={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Td(p,r,c){if(r===0)return 0;const f=r<1&&c===514?.25/r:1;return 6*Math.pow(1.5,22-p)*Math.max(r,1)*f}function xp(p,r){const c=1<<p.z;return!r&&(p.x===0||p.x===c-1)||p.y===0||p.y===c-1}const lm=p=>({u_matrix:p});function Co(p,r,c,f,y){if(y>0){const v=o.q.now(),S=(v-p.timeAdded)/y,N=r?(v-r.timeAdded)/y:-1,C=c.getSource(),k=f.coveringZoomLevel({tileSize:C.tileSize,roundZoom:C.roundZoom}),D=!r||Math.abs(r.tileID.overscaledZ-k)>Math.abs(p.tileID.overscaledZ-k),U=D&&p.refreshedUponExpiration?1:o.ay(D?S:1-N,0,1);return p.refreshedUponExpiration&&S>=1&&(p.refreshedUponExpiration=!1),r?{opacity:1,mix:1-U}:{opacity:U,mix:0}}return{opacity:1,mix:0}}class sy extends No{constructor(r){const c=qh("mock-dem",{type:"raster-dem",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(r,c){r.state="loaded",c(null)}}class cm extends No{constructor(r){const c=qh("proxy",{type:"geojson",maxzoom:r.transform.maxZoom},r.style.dispatcher,r.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=r,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(r,c,f){if(r.freezeTileCoverage)return;this.transform=r;const y=r.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce((v,S)=>{if(v[S.key]="",!this._tiles[S.key]){const N=new pu(S,this._source.tileSize*S.overscaleFactor(),r.tileZoom,void 0,void 0,this._source.worldview);N.state="loaded",this._tiles[S.key]=N}return v},{});for(const v in this._tiles)v in y||(this.freeFBO(v),this._tiles[v].unloadVectorData(),delete this._tiles[v])}freeFBO(r){const c=this.proxyCachedFBO[r];if(c!==void 0){const f=Object.values(c);this.renderCachePool.push(...f),delete this.proxyCachedFBO[r]}}deallocRenderCache(){this.renderCache.forEach(r=>r.fb.destroy()),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class yp extends o.aM{constructor(r,c,f){super(r.overscaledZ,r.wrap,r.canonical.z,r.canonical.x,r.canonical.y),this.proxyTileKey=c,this.projMatrix=f}}class um extends o.dF{constructor(r,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},r.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},()=>{this._style.map.triggerRepaint()}),r.tp.registerButton(["Terrain"],"Invalidate Render Cache",()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()}),this.painter=r,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[f,y,v]=function(C){const k=new o.ba,D=new o.a_,U=131;k.reserve(17161),D.reserve(33800);const O=o.aj/128,G=o.aj+O/2,ee=G+O;for(let se=-O;se<ee;se+=O)for(let te=-O;te<ee;te+=O){const le=te<0||te>G||se<0||se>G?24575:0,de=o.ay(Math.round(te),0,o.aj),pe=o.ay(Math.round(se),0,o.aj);k.emplaceBack(de+le,pe)}const J=(se,te)=>{const le=te*U+se;D.emplaceBack(le+1,le,le+U),D.emplaceBack(le+U,le+U+1,le+1)};for(let se=1;se<129;se++)for(let te=1;te<129;te++)J(te,se);return[0,129].forEach(se=>{for(let te=0;te<130;te++)J(te,se),J(se,te)}),[k,D,32768]}(),S=r.context;this.gridBuffer=S.createVertexBuffer(f,o.bc.members),this.gridIndexBuffer=S.createIndexBuffer(y),this.gridSegments=o.bd.simpleSegment(0,0,f.length,y.length),this.gridNoSkirtSegments=o.bd.simpleSegment(0,0,f.length,v),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new cm(c.map),this.orthoMatrix=o.bz(),o.ca(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,o.aj,0,o.aj,0,1);const N=S.gl;this._overlapStencilMode=new Ss({func:N.GEQUAL,mask:255},0,255,N.KEEP,N.KEEP,N.REPLACE),this._previousZoom=r.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new sy(c.map),this._pendingGroundEffectLayers=[]}set style(r){r.on("data",this._onStyleDataEvent.bind(this)),this._style=r,this._style.map.on("moveend",()=>{this._clearLineLayersFromRenderCache()})}update(r,c,f){if(r&&r.terrain){this._style!==r&&(this.style=r,this._evaluationZoom=void 0);const y=r.terrain.properties,v=r.terrain.drapeRenderMode===0,S=r.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=o.q.now();const N=r.terrain&&r.terrain.scope,C=y.get("source"),k=v?this._mockSourceCache:r.getSourceCache(C,N);if(!k)return void o.w(`Couldn't find terrain source "${C}".`);if(this.sourceCache=k,this._attenuationRange=r.terrain.getAttenuationRange(),this._exaggeration=S?this.calculateExaggeration(c):y.get("exaggeration"),!c.projection.requiresDraping&&S&&this._exaggeration===0)return void this._disable();this.enabled=!0;const D=()=>{this.sourceCache.used&&o.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const U=this.getScaledDemTileSize();this.sourceCache.update(c,U,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,D(),this._initializing=!0),D(),c.updateElevation(!0,f),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(r){if(this._attenuationRange&&r.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(r.zoom);const c=this._previousCameraAltitude,f=r.getFreeCameraOptions().position.z/r.pixelsPerMeter*r.worldSize;this._previousCameraAltitude=f;const y=c!=null?f-c:Number.MAX_VALUE;if(Math.abs(y)<2)return this._exaggeration;const v=r.zoom,S=this._style.terrain;if(!this._previousUpdateTimestamp)return S.getExaggeration(v);let N=v-this._previousZoom;const C=this._previousUpdateTimestamp;let k=v;this._evaluationZoom!=null&&(k=this._evaluationZoom,Math.abs(v-k)>.5&&(N=.5*(v-k+N)),N*y<0&&(k+=N)),this._evaluationZoom=k;const D=S.getExaggeration(k),U=D===S.getExaggeration(Math.max(0,k-.1));if(U&&Math.abs(D-this._exaggeration)<.01)return D;let O=Math.min(.1,.00375*(this._updateTimestamp-C));return(U||D<.1||Math.abs(N)<1e-4)&&(O=Math.min(.2,4*O)),o.ai(this._exaggeration,D,O)}resetTileLookupCache(r){this._findCoveringTileCache[r]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(r){r.coord&&r.dataType==="source"?this._clearRenderCacheForTile(r.sourceCacheId,r.coord):r.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const r in this._style._mergedSourceCaches)this._style._mergedSourceCaches[r].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach(r=>r.fb.destroy()),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const r=2*this.proxySourceCache.getSource().tileSize;return[r,r]}set useVertexMorphing(r){this._useVertexMorphing=r}updateTileBinding(r){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,f=this.painter.transform;this._initializing&&(this._initializing=f._centerAltitude===0&&this.getAtPointOrZero(o.ac.fromLngLat(f.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const y=this.proxyCoords=c.getIds().map(C=>{const k=c.getTileByID(C).tileID;return k.projMatrix=f.calculateProjMatrix(k.toUnwrapped()),k});(function(C,k){const D=k.transform.pointCoordinate(k.transform.getCameraPoint()),U=new o.P(D.x,D.y);C.sort((O,G)=>{if(G.overscaledZ-O.overscaledZ)return G.overscaledZ-O.overscaledZ;const ee=new o.P(O.canonical.x+(1<<O.canonical.z)*O.wrap,O.canonical.y),J=new o.P(G.canonical.x+(1<<G.canonical.z)*G.wrap,G.canonical.y),se=U.mult(1<<O.canonical.z);return se.x-=.5,se.y-=.5,se.distSqr(ee)-se.distSqr(J)})})(y,this.painter);const v=this.proxyToSource||{};this.proxyToSource={},y.forEach(C=>{this.proxyToSource[C.key]={}}),this.terrainTileForTile={};const S=this._style._mergedSourceCaches;for(const C in S){const k=S[C];if(!k.used||(k!==this.sourceCache&&this.resetTileLookupCache(k.id),this._setupProxiedCoordsForOrtho(k,r[C],v),k.usedForTerrain))continue;const D=r[C];k.getSource().reparseOverscaled&&this._assignTerrainTiles(D)}this.proxiedCoords[c.id]=y.map(C=>new yp(C,C.key,this.orthoMatrix)),this._assignTerrainTiles(y),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(v),this.renderingToTexture=!1;const N={};this._visibleDemTiles=[];for(const C of this.proxyCoords){const k=this.terrainTileForTile[C.key];if(!k)continue;const D=k.tileID.key;D in N||(this._visibleDemTiles.push(k),N[D]=D)}}_assignTerrainTiles(r){this._initializing||r.forEach(c=>{if(this.terrainTileForTile[c.key])return;const f=this._findTileCoveringTileID(c,this.sourceCache);f&&(this.terrainTileForTile[c.key]=f)})}_prepareDEMTextures(){const r=this.painter.context,c=r.gl;for(const f in this.terrainTileForTile){const y=this.terrainTileForTile[f],v=y.dem;!v||y.demTexture&&!y.needsDEMTextureUpload||(r.activeTexture.set(c.TEXTURE1),Wx(this.painter,y,v))}}_prepareDemTileUniforms(r,c,f,y){if(!c||c.demTexture==null)return!1;const v=r.tileID.canonical,S=Math.pow(2,c.tileID.canonical.z-v.z),N=y||"";return f[`u_dem_tl${N}`]=[v.x*S%1,v.y*S%1],f[`u_dem_scale${N}`]=S,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let r=0;const c=this._visibleDemTiles.reduce((f,y)=>{if(!y.dem)return f;const v=y.dem.tree.minimums[0];return v>0&&r++,f+v},0);return r?c/r:0}_updateEmptyDEMTexture(){const r=this.painter.context,c=r.gl;r.activeTexture.set(c.TEXTURE2);const f=this._getLoadedAreaMinimum(),y=new o.dG({width:1,height:1},new Float32Array([f]));this._emptyDEMTextureDirty=!1;let v=this._emptyDEMTexture;return v?v.update(y,{premultiply:!1}):v=this._emptyDEMTexture=new o.T(r,y,c.R32F,{premultiply:!1}),v}setupElevationDraw(r,c,f){const y=this.painter.context,v=y.gl,S={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};S.u_exaggeration=this.exaggeration();let N=null,C=null,k=1;if(f&&f.morphing&&this._useVertexMorphing){const G=f.morphing.srcDemTile,ee=f.morphing.dstDemTile;k=f.morphing.phase,G&&ee&&(this._prepareDemTileUniforms(r,G,S,"_prev")&&(C=G),this._prepareDemTileUniforms(r,ee,S)&&(N=ee))}const D=G=>G&&G.demTexture&&this.painter.linearFloatFilteringSupported()?v.LINEAR:v.NEAREST;let U=null;var O;if(this.enabled?C&&N?(U=N.demTexture,y.activeTexture.set(v.TEXTURE4),C.demTexture.bind(D(C),v.CLAMP_TO_EDGE),S.u_dem_lerp=k):(N=this.terrainTileForTile[r.tileID.key],U=this._prepareDemTileUniforms(r,N,S)?N.demTexture:this.emptyDEMTexture):U=this.emptyDEMTexture,y.activeTexture.set(v.TEXTURE2),U&&(S.u_dem_size=(O=U).size[0]===1?1:O.size[0]-2,U.bind(D(N),v.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(f&&f.useDepthForOcclusion,c,S),f&&f.useMeterToDem&&N){const G=(1<<N.tileID.canonical.z)*o.cb(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;S.u_meter_to_dem=G}if(f&&f.labelPlaneMatrixInv&&(S.u_label_plane_matrix_inv=f.labelPlaneMatrixInv),c.setTerrainUniformValues(y,S),this.painter.transform.projection.name==="globe"){const G=this.globeUniformValues(this.painter.transform,r.tileID.canonical,f&&f.useDenormalizedUpVectorScale);c.setGlobeUniformValues(y,G)}}globeUniformValues(r,c,f){const y=r.projection;return{u_tile_tl_up:y.upVector(c,0,0),u_tile_tr_up:y.upVector(c,o.aj,0),u_tile_br_up:y.upVector(c,o.aj,o.aj),u_tile_bl_up:y.upVector(c,0,o.aj),u_tile_up_scale:f?o.dH(1):y.upVectorScale(c,r.center.lat,r.worldSize).metersToTile}}renderToBackBuffer(r){const c=this.painter,f=this.painter.context;r.length!==0&&(f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,function(y,v,S,N,C){if(y.transform.projection.name==="globe")(function(k,D,U,O,G){const ee=k.context,J=ee.gl;let se,te;const le=k.transform,de=o.dy(k,ee,le),pe=(tt,We)=>{if(te===We)return;const rt=[$v[We],"PROJECTION_GLOBE_VIEW"];de&&rt.push("CUSTOM_ANTIALIASING");const jt=k.isTileAffectedByFog(tt);se=k.getOrCreateProgram("globeRaster",{defines:rt,overrideFog:jt}),te=We},ye=k.colorModeForRenderPass(),Se=new Kt(J.LEQUAL,Kt.ReadWrite,k.depthRangeFor3D);Su.update(G);const Te=o.dz(le),_e=[o.aD(le.center.lng),o.aH(le.center.lat)],ve=k.globeSharedBuffers,be=[le.width*o.q.devicePixelRatio,le.height*o.q.devicePixelRatio],Ue=Float32Array.from(le.globeMatrix),Ie={useDenormalizedUpVectorScale:!0};{const tt=k.transform,We=Td(tt.zoom,D.exaggeration(),D.sourceCache._source.tileSize);te=-1;const rt=J.TRIANGLES;for(const jt of O){const $e=U.getTile(jt),Ae=Ss.disabled,Ke=D.prevTerrainTileForTile[jt.key],Ge=D.terrainTileForTile[jt.key];ty(Ke,Ge)&&Su.newMorphing(jt.key,Ke,Ge,G,250),ee.activeTexture.set(J.TEXTURE0),$e.texture&&$e.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);const ht=Su.getMorphValuesForProxy(jt.key),pt=ht?1:0;ht&&o.L(Ie,{morphing:{srcDemTile:ht.from,dstDemTile:ht.to,phase:o.dx(ht.phase)}});const mt=o.dA(jt.canonical),Pt=o.dB(mt.getCenter().lat),ns=o.dC(jt.canonical,mt,Pt,tt.worldSize/tt._pixelsPerMercatorPixel),us=o.bh(o.dD(jt.canonical)),Wt=am(tt.expandedFarZProjMatrix,Ue,Te,us,o.ah(tt.zoom),_e,tt.frustumCorners.TL,tt.frustumCorners.TR,tt.frustumCorners.BR,tt.frustumCorners.BL,tt.globeCenterInViewSpace,tt.globeRadius,be,We,tt._farZ,ns);if(pe(jt,pt),se&&(D.setupElevationDraw($e,se,Ie),k.uploadCommonUniforms(ee,se,jt.toUnwrapped()),ve)){const[as,is,Cs]=ve.getGridBuffers(Pt,We!==0);se.draw(k,rt,Se,Ae,ye,gs.backCCW,Wt,"globe_raster",as,is,Cs)}}}if(ve&&(k.renderDefaultNorthPole||k.renderDefaultSouthPole)){const tt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];de&&tt.push("CUSTOM_ANTIALIASING"),se=k.getOrCreateProgram("globeRaster",{defines:tt});for(const We of O){const{x:rt,y:jt,z:$e}=We.canonical,Ae=jt===0,Ke=jt===(1<<$e)-1,[Ge,ht,pt,mt]=ve.getPoleBuffers($e,!1);if(mt&&(Ae||Ke)){const Pt=U.getTile(We);ee.activeTexture.set(J.TEXTURE0),Pt.texture&&Pt.texture.bind(J.LINEAR,J.CLAMP_TO_EDGE);let ns=o.dE($e,rt,le);const us=o.bh(o.dD(We.canonical)),Wt=(as,is)=>as.draw(k,J.TRIANGLES,Se,Ss.disabled,ye,gs.disabled,am(le.expandedFarZProjMatrix,ns,ns,us,0,_e,le.frustumCorners.TL,le.frustumCorners.TR,le.frustumCorners.BR,le.frustumCorners.BL,le.globeCenterInViewSpace,le.globeRadius,be,0,le._farZ),"globe_pole_raster",is,pt,mt);D.setupElevationDraw(Pt,se,Ie),k.uploadCommonUniforms(ee,se,We.toUnwrapped()),Ae&&k.renderDefaultNorthPole&&Wt(se,Ge),Ke&&k.renderDefaultSouthPole&&(ns=o.cP(o.bz(),ns,[1,-1,1]),Wt(se,ht))}}}})(y,v,S,N,C);else{const k=y.context,D=k.gl;let U,O;const G=y.shadowRenderer,ee=pl(y,y.longestCutoffRange),J=ye=>{if(O===ye)return;const Se=[];Se.push($v[ye]),ee.shouldRenderCutoff&&Se.push("RENDER_CUTOFF"),G&&(Se.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&Se.push("NORMAL_OFFSET")),U=y.getOrCreateProgram("terrainRaster",{defines:Se}),O=ye},se=y.colorModeForRenderPass(),te=new Kt(D.LEQUAL,Kt.ReadWrite,y.depthRangeFor3D);Su.update(C);const le=y.transform,de=Td(le.zoom,v.exaggeration(),v.sourceCache._source.tileSize);let pe=[0,0,0];if(G){const ye=y.style.directionalLight,Se=y.style.ambientLight;ye&&Se&&(pe=vu(y.style,ye,Se))}{O=-1;const ye=D.TRIANGLES,[Se,Te]=[v.gridIndexBuffer,v.gridSegments];for(const _e of N){const ve=S.getTile(_e),be=Ss.disabled,Ue=v.prevTerrainTileForTile[_e.key],Ie=v.terrainTileForTile[_e.key];ty(Ue,Ie)&&Su.newMorphing(_e.key,Ue,Ie,C,250),k.activeTexture.set(D.TEXTURE0),ve.texture&&ve.texture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const tt=Su.getMorphValuesForProxy(_e.key),We=tt?1:0;let rt;tt&&(rt={morphing:{srcDemTile:tt.from,dstDemTile:tt.to,phase:o.dx(tt.phase)}});const jt=ey(_e.projMatrix,xp(_e.canonical,le.renderWorldCopies)?de/10:de,pe);if(J(We),!U)continue;v.setupElevationDraw(ve,U,rt);const $e=_e.toUnwrapped();G&&G.setupShadows($e,U),y.uploadCommonUniforms(k,U,$e,null,ee),U.draw(y,ye,te,be,se,gs.backCCW,jt,"terrain_raster",v.gridBuffer,Se,Te)}}}}(c,this,this.proxySourceCache,r,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),r.splice(0,r.length))}renderBatch(r){if(this._drapedRenderBatches.length===0)return r+1;this.renderingToTexture=!0;const c=this.painter,f=this.painter.context,y=this.proxySourceCache,v=this.proxiedCoords[y.id],S=this._drapedRenderBatches.shift(),N=c.style.order,C=[];let k=0;for(const D of v){const U=y.getTileByID(D.proxyTileKey),O=y.proxyCachedFBO[D.key]?y.proxyCachedFBO[D.key][r]:void 0,G=O!==void 0?y.renderCache[O]:this.pool[k++],ee=O!==void 0;if(U.texture=G.tex,ee&&!G.dirty){C.push(U.tileID);continue}let J;f.bindFramebuffer.set(G.fb.framebuffer),this.renderedToTile=!1,G.dirty&&(f.clear({color:o.am.transparent,stencil:0}),G.dirty=!1);for(let se=S.start;se<=S.end;++se){const te=c.style._mergedLayers[N[se]];if(te.isHidden(c.transform.zoom))continue;const le=c.style.getLayerSourceCache(te),de=le?this.proxyToSource[D.key][le.id]:[D];if(!de)continue;const pe=de;f.viewport.set([0,0,G.fb.width,G.fb.height]),J!==(le?le.id:null)&&(this._setupStencil(G,de,te,le),J=le?le.id:null),c.renderLayer(c,le,te,pe)}if(this._drapedRenderBatches.length===0)for(const se of this._pendingGroundEffectLayers){const te=c.style._mergedLayers[N[se]];if(te.isHidden(c.transform.zoom))continue;const le=c.style.getLayerSourceCache(te),de=le?this.proxyToSource[D.key][le.id]:[D];if(!de)continue;const pe=de;f.viewport.set([0,0,G.fb.width,G.fb.height]),J!==(le?le.id:null)&&(this._setupStencil(G,de,te,le),J=le?le.id:null),c.renderLayer(c,le,te,pe)}this.renderedToTile?(G.dirty=!0,C.push(U.tileID)):ee||--k,k===5&&(k=0,this.renderToBackBuffer(C))}return this.renderToBackBuffer(C),this.renderingToTexture=!1,f.bindFramebuffer.set(null),f.viewport.set([0,0,c.width,c.height]),S.end+1}postRender(){}isLayerOrderingCorrect(r){const c=r.order.length;let f=-1,y=c;for(let v=0;v<c;++v)this._style.isLayerDraped(r._mergedLayers[r.order[v]])?f=Math.max(f,v):y=Math.min(y,v);return y>f}getMinElevationBelowMSL(){let r=0;return this._visibleDemTiles.filter(c=>c.dem).forEach(c=>{r=Math.min(r,c.dem.tree.minimums[0])}),r===0?r:(r-30)*this._exaggeration}raycast(r,c,f){if(!this._visibleDemTiles)return null;const y=this._visibleDemTiles.filter(v=>v.dem).map(v=>{const S=v.tileID,N=1<<S.overscaledZ,{x:C,y:k}=S.canonical,D=C/N,U=(C+1)/N,O=k/N,G=(k+1)/N;return{minx:D,miny:O,maxx:U,maxy:G,t:v.dem.tree.raycastRoot(D,O,U,G,r,c,f),tile:v}});y.sort((v,S)=>(v.t!==null?v.t:Number.MAX_VALUE)-(S.t!==null?S.t:Number.MAX_VALUE));for(const v of y){if(v.t==null)return null;const S=v.tile.dem.tree.raycast(v.minx,v.miny,v.maxx,v.maxy,r,c,f);if(S!=null)return S}return null}_createFBO(){const r=this.painter.context,c=r.gl,f=this.drapeBufferSize;r.activeTexture.set(c.TEXTURE0);const y=new o.T(r,{width:f[0],height:f[1],data:null},c.RGBA8);y.bind(c.LINEAR,c.CLAMP_TO_EDGE);const v=r.createFramebuffer(f[0],f[1],!0,null);return v.colorAttachment.set(y.texture),v.depthAttachment=new Qx(r,v.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=r.createRenderbuffer(r.gl.DEPTH_STENCIL,f[0],f[1]),this._stencilRef=0,v.depthAttachment.set(this._sharedDepthStencil),r.clear({stencil:0})):v.depthAttachment.set(this._sharedDepthStencil),r.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,r.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,r.extTextureFilterAnisotropicMax),{fb:v,tex:y,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const r in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[r].hasTransition())return!0;return this._style.order.some(r=>{const c=this._style._mergedLayers[r],f=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!f&&c.shouldRedrape():!f&&c.hasTransition()})}_clearLineLayersFromRenderCache(){let r=!1;for(const f of this._style.getSources())if(f instanceof Wh){r=!0;break}if(!r)return;const c={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(y);if(v&&!c[v.id]&&!y.isHidden(this.painter.transform.zoom)&&y.type==="line"&&y.widthExpression()instanceof o.ab){c[v.id]=!0;for(const S of this.proxyCoords){const N=this.proxyToSource[S.key][v.id];if(N)for(const C of N)this._clearRenderCacheForTile(v.id,C)}}}}_clearRasterLayersFromRenderCache(){let r=!1;for(const f in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[f]._source instanceof Ii){r=!0;break}if(!r)return;const c={};for(let f=0;f<this._style.order.length;++f){const y=this._style._mergedLayers[this._style.order[f]],v=this._style.getLayerSourceCache(y);if(!v||c[v.id]||y.isHidden(this.painter.transform.zoom)||y.type!=="raster")continue;const S=y.paint.get("raster-fade-duration");for(const N of this.proxyCoords){const C=this.proxyToSource[N.key][v.id];if(C)for(const k of C){const D=Co(v.getTile(k),v.findLoadedParent(k,0),v,this.painter.transform,S);(D.opacity!==1||D.mix!==0)&&this._clearRenderCacheForTile(v.id,k)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const r=this._style.order,c=r.length;if(c===0)return;const f=[];this._pendingGroundEffectLayers=[];let y,v=0,S=this._style._mergedLayers[r[v]];for(;!this._style.isLayerDraped(S)&&S.isHidden(this.painter.transform.zoom)&&++v<c;)S=this._style._mergedLayers[r[v]];for(;v<c;++v){const N=this._style._mergedLayers[r[v]];N.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(N)?y===void 0&&(y=v):(N.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(v),y!==void 0&&(f.push({start:y,end:v-1}),y=void 0)))}if(y!==void 0&&f.push({start:y,end:v-1}),f.length!==0){const N=f[f.length-1];this._pendingGroundEffectLayers.every(C=>C>N.end)||o.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=f}_setupRenderCache(r){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const S=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let N=0;N<S.length;++N){const C=Object.values(S[N]);c.renderCachePool.push(...C)}}return}this._clearRasterLayersFromRenderCache();const f=this.proxyCoords,y=this._tilesDirty;for(let S=f.length-1;S>=0;S--){const N=f[S];if(c.getTileByID(N.key),c.proxyCachedFBO[N.key]!==void 0){const C=r[N.key],k=this.proxyToSource[N.key];let D=0;for(const U in k){const O=k[U],G=C[U];if(!G||G.length!==O.length||O.some((ee,J)=>ee!==G[J]||y[U]&&y[U].hasOwnProperty(ee.key))){D=-1;break}++D}for(const U in c.proxyCachedFBO[N.key])c.renderCache[c.proxyCachedFBO[N.key][U]].dirty=D<0||D!==Object.values(C).length}}const v=[...this._drapedRenderBatches];v.sort((S,N)=>N.end-N.start-(S.end-S.start));for(const S of v)for(const N of f){if(c.proxyCachedFBO[N.key])continue;let C=c.renderCachePool.pop();C===void 0&&c.renderCache.length<50&&(C=c.renderCache.length,c.renderCache.push(this._createFBO())),C!==void 0&&(c.proxyCachedFBO[N.key]={},c.proxyCachedFBO[N.key][S.start]=C,c.renderCache[C].dirty=!0)}this._tilesDirty={}}_setupStencil(r,c,f,y){if(!y||!this._sourceTilesOverlap[y.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const v=this.painter.context,S=v.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let N;if(f.isTileClipped())N=c.length,this._overlapStencilMode.test={func:S.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);N=1,this._overlapStencilMode.test={func:S.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+N>255&&(v.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=N,this._overlapStencilMode.ref=this._stencilRef,f.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(r){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[r.key]),this._overlapStencilMode):Ss.disabled}_renderTileClippingMasks(r,c){const f=this.painter,y=this.painter.context,v=y.gl;f._tileClippingMaskIDs={},y.setColorMode(Fs.disabled),y.setDepthMode(Kt.disabled);const S=f.getOrCreateProgram("clippingMask");for(const N of r){const C=f._tileClippingMaskIDs[N.key]=--c;S.draw(f,v.TRIANGLES,Kt.disabled,new Ss({func:v.ALWAYS,mask:0},C,255,v.KEEP,v.KEEP,v.REPLACE),Fs.disabled,gs.disabled,lm(N.projMatrix),"$clipping",f.tileExtentBuffer,f.quadTriangleIndexBuffer,f.tileExtentSegments)}}pointCoordinate(r){const c=this.painter.transform;if(r.x<0||r.x>c.width||r.y<0||r.y>c.height)return null;const f=[r.x,r.y,1,1];o.aA(f,f,c.pixelMatrixInverse),o.cH(f,f,1/f[3]),f[0]/=c.worldSize,f[1]/=c.worldSize;const y=c._camera.position,v=o.cb(1,c.center.lat),S=[y[0],y[1],y[2]/v,0],N=o.d7([],f.slice(0,3),S);o.au(N,N);const C=this.raycast(S,N,this._exaggeration);return C!==null&&C?(o.bE(S,S,N,C),S[3]=S[2],S[2]*=v,S):null}_setupProxiedCoordsForOrtho(r,c,f){if(r.getSource()instanceof o.aP)return this._setupProxiedCoordsForImageSource(r,c,f);this._findCoveringTileCache[r.id]=this._findCoveringTileCache[r.id]||{};const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords;for(let C=0;C<v.length;C++){const k=v[C],D=this._findTileCoveringTileID(k,r);if(D){const U=this._createProxiedId(k,D,f[k.key]&&f[k.key][r.id]);y.push(U),this.proxyToSource[k.key][r.id]=[U]}}let S=!1;const N=new Set;for(let C=0;C<c.length;C++){const k=r.getTile(c[C]);if(!k||!k.hasData())continue;const D=this._findTileCoveringTileID(k.tileID,this.proxySourceCache);if(D&&D.tileID.canonical.z!==k.tileID.canonical.z){const U=this.proxyToSource[D.tileID.key][r.id],O=this._createProxiedId(D.tileID,k,f[D.tileID.key]&&f[D.tileID.key][r.id]);U?U.splice(U.length-1,0,O):this.proxyToSource[D.tileID.key][r.id]=[O];const G=this.proxyToSource[D.tileID.key][r.id];N.has(G)||N.add(G),y.push(O),S=!0}}if(this._sourceTilesOverlap[r.id]=S,S&&this._debugParams.sortTilesHiZFirst)for(const C of N)C.sort((k,D)=>D.overscaledZ-k.overscaledZ)}_setupProxiedCoordsForImageSource(r,c,f){if(!r.getSource().loaded())return;const y=this.proxiedCoords[r.id]=[],v=this.proxyCoords,S=r.getSource(),N=S.tileID;if(!N)return;const C=new o.P(N.x,N.y)._div(1<<N.z),k=S.coordinates.map(o.ac.fromLngLat).reduce((U,O)=>(U.min.x=Math.min(U.min.x,O.x-C.x),U.min.y=Math.min(U.min.y,O.y-C.y),U.max.x=Math.max(U.max.x,O.x-C.x),U.max.y=Math.max(U.max.y,O.y-C.y),U),{min:new o.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new o.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),D=(U,O)=>{const G=U.wrap+U.canonical.x/(1<<U.canonical.z),ee=U.canonical.y/(1<<U.canonical.z),J=o.aj/(1<<U.canonical.z),se=O.wrap+O.canonical.x/(1<<O.canonical.z),te=O.canonical.y/(1<<O.canonical.z);return G+J<se+k.min.x||G>se+k.max.x||ee+J<te+k.min.y||ee>te+k.max.y};for(let U=0;U<v.length;U++){const O=v[U];for(let G=0;G<c.length;G++){const ee=r.getTile(c[G]);if(!ee||!ee.hasData()||D(O,ee.tileID))continue;const J=this._createProxiedId(O,ee,f[O.key]&&f[O.key][r.id]),se=this.proxyToSource[O.key][r.id];se?se.push(J):this.proxyToSource[O.key][r.id]=[J],y.push(J)}}}_createProxiedId(r,c,f){let y=this.orthoMatrix;if(f){const v=f.find(S=>S.key===c.tileID.key);if(v)return v}if(c.tileID.key!==r.key){const v=r.canonical.z-c.tileID.canonical.z;let S,N,C;y=o.bz();const k=c.tileID.wrap-r.wrap<<r.overscaledZ;v>0?(S=o.aj>>v,N=S*((c.tileID.canonical.x<<v)-r.canonical.x+k),C=S*((c.tileID.canonical.y<<v)-r.canonical.y)):(S=o.aj<<-v,N=o.aj*(c.tileID.canonical.x-(r.canonical.x+k<<-v)),C=o.aj*(c.tileID.canonical.y-(r.canonical.y<<-v))),o.ca(y,0,S,0,S,0,1),o.bo(y,y,[N,C,0])}return new yp(c.tileID,r.key,y)}_findTileCoveringTileID(r,c){let f=c.getTile(r);if(f&&f.hasData())return f;const y=this._findCoveringTileCache[c.id],v=y[r.key];if(f=v?c.getTileByID(v):null,f&&f.hasData()||v===null)return f;let S=f?f.tileID:r,N=S.overscaledZ;const C=c.getSource().minzoom,k=[];if(!v){const U=c.getSource().maxzoom;if(r.canonical.z>=U){const O=r.canonical.z-U;c.getSource().reparseOverscaled?(N=Math.max(r.canonical.z+2,c.transform.tileZoom),S=new o.aM(N,r.wrap,U,r.canonical.x>>O,r.canonical.y>>O)):O!==0&&(N=U,S=new o.aM(N,r.wrap,U,r.canonical.x>>O,r.canonical.y>>O))}S.key!==r.key&&(k.push(S.key),f=c.getTile(S))}const D=U=>{k.forEach(O=>{y[O]=U}),k.length=0};for(N-=1;N>=C&&(!f||!f.hasData());N--){f&&D(f.tileID.key);const U=S.calculateScaledKey(N);if(f=c.getTileByID(U),f&&f.hasData())break;const O=y[U];if(O===null)break;O===void 0?k.push(U):f=c.getTileByID(O)}return D(f?f.tileID.key:null),f&&f.hasData()?f:null}findDEMTileFor(r){return this.enabled?this._findTileCoveringTileID(r,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(r,c){let f=this._tilesDirty[r];f||(f=this._tilesDirty[r]={}),f[c.key]=!0}}function ny(p,r,c){const f=function(N,C,k){const D=o.bG(C,N),U=o.bG(k,[.2126,.7152,.0722]),O=(ee,J,se)=>(1-se)*ee+se*J,G=O(1-.3*Math.min(U,1),1,Math.min(D+1,1));return O(.92,1,Math.asin(o.ay(C[2],-1,1))/Math.PI+.5)*G}(p,[0,0,1],r),y=[0,0,0];o.c1(y,c.slice(0,3),f);const v=[0,0,0];o.c1(v,r.slice(0,3),p[2]);const S=[0,0,0];return o.d5(S,y,v),o.d8(S)}const ry=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],dm=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class hm{static cacheKey(r,c,f,y){let v=`${c}${y?y.cacheKey:""}`;for(const S of f)r.usedDefines.includes(S)&&(v+=`/${S}`);return v}constructor(r,c,f,y,v,S){const N=r.gl;this.program=N.createProgram(),this.configuration=y,this.name=c,this.fixedDefines=[...S];const C=y?y.getBinderAttributes():[],k=(f.staticAttributes||[]).concat(C);let D=y?y.defines():[];D=D.concat(S.map(se=>`#define ${se}`));const U=`#version 300 es
`;let O=U+D.concat("precision mediump float;",Tc,Qf.fragmentSource).join(`
`);for(const se of f.fragmentIncludes)O+=`
${bu[se]}`;O+=`
${f.fragmentSource}`;let G=U+D.concat("precision highp float;",Tc,Qf.vertexSource).join(`
`);for(const se of f.vertexIncludes)G+=`
${bu[se]}`;this.forceManualRenderingForInstanceIDShaders=r.forceManualRenderingForInstanceIDShaders&&f.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(G+=`
uniform int u_instanceID;
`),G+=`
${f.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(G=G.replaceAll("gl_InstanceID","u_instanceID"));const ee=N.createShader(N.FRAGMENT_SHADER);if(N.isContextLost())return void(this.failedToCreate=!0);N.shaderSource(ee,O),N.compileShader(ee),N.attachShader(this.program,ee);const J=N.createShader(N.VERTEX_SHADER);if(N.isContextLost())this.failedToCreate=!0;else{N.shaderSource(J,G),N.compileShader(J),N.attachShader(this.program,J),this.attributes={},this.numAttributes=k.length;for(let se=0;se<this.numAttributes;se++)if(k[se]){const te=k[se].startsWith("a_")?k[se]:`a_${k[se]}`;N.bindAttribLocation(this.program,se,te),this.attributes[te]=se}N.linkProgram(this.program),N.deleteShader(J),N.deleteShader(ee),this.fixedUniforms=v(r),this.binderUniforms=y?y.getUniforms(r):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(se=>({u_instanceID:new o.cd(se)}))(r)),(S.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(se=>({u_dem:new o.cd(se),u_dem_prev:new o.cd(se),u_dem_tl:new o.cg(se),u_dem_scale:new o.cf(se),u_dem_tl_prev:new o.cg(se),u_dem_scale_prev:new o.cf(se),u_dem_size:new o.cf(se),u_dem_lerp:new o.cf(se),u_exaggeration:new o.cf(se),u_depth:new o.cd(se),u_depth_size_inv:new o.cg(se),u_depth_range_unpack:new o.cg(se),u_occluder_half_size:new o.cf(se),u_occlusion_depth_offset:new o.cf(se),u_meter_to_dem:new o.cf(se),u_label_plane_matrix_inv:new o.ch(se)}))(r)),S.includes("GLOBE")&&(this.globeUniforms=(se=>({u_tile_tl_up:new o.ce(se),u_tile_tr_up:new o.ce(se),u_tile_br_up:new o.ce(se),u_tile_bl_up:new o.ce(se),u_tile_up_scale:new o.cf(se)}))(r)),S.includes("FOG")&&(this.fogUniforms=(se=>({u_fog_matrix:new o.ch(se),u_fog_range:new o.cg(se),u_fog_color:new o.d0(se),u_fog_horizon_blend:new o.cf(se),u_fog_vertical_limit:new o.cg(se),u_fog_temporal_offset:new o.cf(se),u_frustum_tl:new o.ce(se),u_frustum_tr:new o.ce(se),u_frustum_br:new o.ce(se),u_frustum_bl:new o.ce(se),u_globe_pos:new o.ce(se),u_globe_radius:new o.cf(se),u_globe_transition:new o.cf(se),u_is_globe:new o.cd(se),u_viewport:new o.cg(se)}))(r)),S.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(se=>({u_cutoff_params:new o.d0(se)}))(r)),S.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(se=>({u_lighting_ambient_color:new o.ce(se),u_lighting_directional_dir:new o.ce(se),u_lighting_directional_color:new o.ce(se),u_ground_radiance:new o.ce(se)}))(r)),S.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(se=>({u_light_matrix_0:new o.ch(se),u_light_matrix_1:new o.ch(se),u_fade_range:new o.cg(se),u_shadow_normal_offset:new o.ce(se),u_shadow_intensity:new o.cf(se),u_shadow_texel_size:new o.cf(se),u_shadow_map_resolution:new o.cf(se),u_shadow_direction:new o.ce(se),u_shadow_bias:new o.ce(se),u_shadowmap_0:new o.cd(se),u_shadowmap_1:new o.cd(se)}))(r))}}setTerrainUniformValues(r,c){if(!this.terrainUniforms)return;const f=this.terrainUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)f[y]&&f[y].set(this.program,y,c[y])}}setGlobeUniformValues(r,c){if(!this.globeUniforms)return;const f=this.globeUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)f[y]&&f[y].set(this.program,y,c[y])}}setFogUniformValues(r,c){if(!this.fogUniforms)return;const f=this.fogUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setCutoffUniformValues(r,c){if(!this.cutoffUniforms)return;const f=this.cutoffUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setLightsUniformValues(r,c){if(!this.lightsUniforms)return;const f=this.lightsUniforms;if(!this.failedToCreate){r.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}}setShadowUniformValues(r,c){if(this.failedToCreate||!this.shadowUniforms)return;const f=this.shadowUniforms;r.program.set(this.program);for(const y in c)f[y].set(this.program,y,c[y])}_drawDebugWireframe(r,c,f,y,v,S,N,C,k,D){const U=r.options.wireframe;if(U.terrain===!1&&U.layers2D===!1&&U.layers3D===!1)return;const O=r.context;if(!(!(!U.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!U.layers2D||r._terrain&&r._terrain.renderingToTexture||!ry.includes(this.name))||!(!U.layers3D||!dm.includes(this.name))))return;const G=O.gl,ee=r.wireframeDebugCache.getLinesFromTrianglesBuffer(r.frameCounter,v,O);if(!ee)return;const J=[...this.fixedDefines];J.push("DEBUG_WIREFRAME");const se=r.getOrCreateProgram(this.name,{config:this.configuration,defines:J});O.program.set(se.program);const te=(pe,ye,Se)=>{if(ye[pe]&&Se[pe])for(const Te in ye[pe])Se[pe][Te]&&Se[pe][Te].set(Se.program,Te,ye[pe][Te].current)};k&&k.setUniforms(se.program,O,se.binderUniforms,N,{zoom:C}),te("fixedUniforms",this,se),te("terrainUniforms",this,se),te("globeUniforms",this,se),te("fogUniforms",this,se),te("lightsUniforms",this,se),te("shadowUniforms",this,se),ee.bind(),O.setColorMode(new Fs([G.ONE,G.ONE_MINUS_SRC_ALPHA,G.ZERO,G.ONE],o.am.transparent,[!0,!0,!0,!1])),O.setDepthMode(new Kt(c.func===G.LESS?G.LEQUAL:c.func,Kt.ReadOnly,c.range)),O.setStencilMode(Ss.disabled);const le=3*S.primitiveLength*2,de=3*S.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const pe=D||1;for(let ye=0;ye<pe;++ye)se.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,de)}else D&&D>1?G.drawElementsInstanced(G.LINES,le,G.UNSIGNED_SHORT,de,D):G.drawElements(G.LINES,le,G.UNSIGNED_SHORT,de);v.bind(),O.program.set(this.program),O.setDepthMode(c),O.setStencilMode(f),O.setColorMode(y)}checkUniforms(r,c,f){if(this.fixedDefines.includes(c)){for(const y of Object.keys(f))if(!f[y].initialized)throw new Error(`Program '${this.name}', from draw '${r}': uniform ${y} not set but required by ${c} being defined`)}}draw(r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se){const te=r.context,le=te.gl;if(this.failedToCreate)return;te.program.set(this.program),te.setDepthMode(f),te.setStencilMode(y),te.setColorMode(v),te.setCullFace(S);for(const ye of Object.keys(this.fixedUniforms))this.fixedUniforms[ye].set(this.program,ye,N[ye]);ee&&ee.setUniforms(this.program,te,this.binderUniforms,O,{zoom:G});const de={[le.POINTS]:1,[le.LINES]:2,[le.TRIANGLES]:3,[le.LINE_STRIP]:1}[c];this.checkUniforms(C,"RENDER_SHADOWS",this.shadowUniforms);const pe=se&&se>0?1:void 0;for(const ye of U.get()){const Se=ye.vaos||(ye.vaos={});if((Se[C]||(Se[C]=new PS)).bind(te,this,k,ee?ee.getPaintVertexBuffers():[],D,ye.vertexOffset,J||[],pe),this.forceManualRenderingForInstanceIDShaders){const Te=se||1;for(let _e=0;_e<Te;++_e)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",_e),D?le.drawElements(c,ye.primitiveLength*de,le.UNSIGNED_SHORT,ye.primitiveOffset*de*2):le.drawArrays(c,ye.vertexOffset,ye.vertexLength)}else se&&se>1?le.drawElementsInstanced(c,ye.primitiveLength*de,le.UNSIGNED_SHORT,ye.primitiveOffset*de*2,se):D?le.drawElements(c,ye.primitiveLength*de,le.UNSIGNED_SHORT,ye.primitiveOffset*de*2):le.drawArrays(c,ye.vertexOffset,ye.vertexLength);c===le.TRIANGLES&&D&&this._drawDebugWireframe(r,f,y,v,D,ye,O,G,ee,se)}}}function pm(p,r,c=0){const f=Math.pow(2,r.tileID.overscaledZ),y=r.tileSize*Math.pow(2,p.transform.tileZoom)/f,v=y*(r.tileID.canonical.x+r.tileID.wrap*f),S=y*r.tileID.canonical.y;return{u_image:0,u_texsize:r.imageAtlasTexture?r.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/o.aw(r,1,p.transform.tileZoom),u_pixel_coord_upper:[v>>16,S>>16],u_pixel_coord_lower:[65535&v,65535&S],u_pattern_transition:c}}const ju={terrain:0,flat:1},iy=o.bz(),oy=(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te)=>{const le=r.style.light,de=le.properties.get("position"),pe=[de.x,de.y,de.z],ye=o.dJ();le.properties.get("anchor")==="viewport"&&(o.dK(ye,-r.transform.angle),o.dL(pe,pe,ye));const Se=le.properties.get("color").toPremultipliedRenderColor(null),Te=r.transform,_e={u_matrix:p,u_lightpos:pe,u_lightintensity:le.properties.get("intensity"),u_lightcolor:[Se.r,Se.g,Se.b],u_vertical_gradient:+c,u_opacity:f,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:iy,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:ju[k],u_base_type:ju[D],u_ao:y,u_edge_radius:v,u_width_scale:S,u_flood_light_color:ee,u_vertical_scale:J,u_flood_light_intensity:se,u_ground_shadow_factor:te};return Te.projection.name==="globe"&&(_e.u_tile_id=[N.canonical.x,N.canonical.y,1<<N.canonical.z],_e.u_zoom_transition=U,_e.u_inv_rot_matrix=G,_e.u_merc_center=O,_e.u_up_dir=Te.projection.upVector(new o.cA(0,0,0),O[0]*o.aj,O[1]*o.aj),_e.u_height_lift=C),_e},Gv=(p,r,c,f,y,v)=>({u_matrix:p,u_edge_radius:r,u_width_scale:c,u_vertical_scale:f,u_height_type:ju[y],u_base_type:ju[v]}),Nd=(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te)=>{const le=oy(p,r,c,f,y,v,S,N,k,D,U,O,G,ee,J,se,1,[0,0,0]),de={u_height_factor:-Math.pow(2,N.overscaledZ)/C.tileSize/8};return o.h(le,pm(r,C,te),de)},Hv=(p,r,c)=>({u_matrix:p,u_emissive_strength:r,u_ground_shadow_factor:c}),Wv=(p,r,c,f,y,v=0)=>o.h(Hv(p,r,y),pm(c,f,v)),FS=(p,r,c,f)=>({u_matrix:p,u_world:c,u_emissive_strength:r,u_ground_shadow_factor:f}),BS=(p,r,c,f,y,v,S=0)=>o.h(Wv(p,r,c,f,v,S),{u_world:y}),VS=(p,r)=>({u_matrix:p,u_ground_shadow_factor:r}),fm=(p,r,c,f,y)=>({u_matrix:p,u_camera_pos:[r[0],r[1],r[2]],u_depth_bias:c,u_height_scale:f,u_reset_depth:y}),ay=(p,r)=>({u_matrix:p,u_normal_matrix:r,u_opacity:1}),ly=p=>({u_matrix:p}),qv=p=>({u_matrix:p}),Ed=(p,r,c,f,y,v,S,N)=>{const C=o.aj/v.tileSize;return{u_matrix:p,u_inv_rot_matrix:r,u_camera_to_center_distance:c.getCameraToCenterDistance(N),u_extrude_scale:[c.pixelsToGLUnits[0]/C,c.pixelsToGLUnits[1]/C],u_zoom_transition:f,u_tile_id:S,u_merc_center:y}},cy=(p,r,c=1)=>({u_matrix:p,u_color:r,u_overlay:0,u_overlay_scale:c}),Zv=o.bz(),Kv=(p,r,c,f,y,v,S)=>{const N=p.transform,C=N.projection.name==="globe",k=C?o.dM(N.zoom,r.canonical)*N._pixelsPerMercatorPixel:o.aw(c,1,v),D={u_matrix:r.projMatrix,u_extrude_scale:k,u_intensity:S,u_inv_rot_matrix:Zv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(C){D.u_inv_rot_matrix=f,D.u_merc_center=y,D.u_tile_id=[r.canonical.x,r.canonical.y,1<<r.canonical.z],D.u_zoom_transition=o.ah(N.zoom);const U=y[0]*o.aj,O=y[1]*o.aj;D.u_up_dir=N.projection.upVector(new o.cA(0,0,0),U,O)}return D};function mm(p,[r,c,f,y],[v,S]){if(v===S)return[0,0,0,0];const N=255*(p-1)/(p*(S-v));return[r*N,c*N,f*N,y*N]}function Nc(p,r,[c,f]){return c===f?0:.5/p+(r-c)*(p-1)/(p*(f-c))}const uy=(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le,de,pe)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:k,u_fade_t:D.mix,u_opacity:D.opacity*U.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:U.paint.get("raster-brightness-min"),u_brightness_high:U.paint.get("raster-brightness-max"),u_saturation_factor:o.dO(U.paint.get("raster-saturation")),u_contrast_factor:o.dN(U.paint.get("raster-contrast")),u_spin_weights:Ec(U.paint.get("raster-hue-rotate")),u_perspective_transform:O,u_raster_elevation:G,u_zoom_transition:S,u_merc_center:N,u_cutoff_params:C,u_colorization_mix:mm(o.dP,J,te),u_colorization_offset:Nc(o.dP,se,te),u_color_ramp:ee,u_texture_offset:[de/(le+2*de),le/(le+2*de)],u_texture_res:[le+2*de,le+2*de],u_emissive_strength:pe});function Ec(p){p*=Math.PI/180;const r=Math.sin(p),c=Math.cos(p);return[(2*c+1)/3,(-Math.sqrt(3)*r-c+1)/3,(Math.sqrt(3)*r-c+1)/3]}const Cc=.05,gm=(p,r,c,f,y,v,S,N,C,k,D,U)=>({u_matrix:p,u_normalize_matrix:r,u_globe_matrix:c,u_merc_matrix:f,u_grid_matrix:y,u_tl_parent:v,u_scale_parent:k,u_fade_t:D.mix,u_opacity:D.opacity,u_image0:0,u_image1:1,u_raster_elevation:U,u_zoom_transition:S,u_merc_center:N,u_cutoff_params:C}),Xv=(p,r,c,f,y,v,S,N,C,k)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_tile_offset:c,u_velocity:f,u_color_ramp:v,u_velocity_res:y,u_max_speed:S,u_uv_offset:N,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),Yv=(p,r,c,f,y,v,S,N,C,k)=>({u_particle_texture:p,u_particle_texture_side_len:r,u_velocity:c,u_velocity_res:f,u_max_speed:y,u_speed_factor:v,u_reset_rate:S,u_rand_seed:Math.random(),u_uv_offset:N,u_data_scale:[255*C[0],255*C[1]],u_data_offset:k,u_particle_pos_scale:1.1,u_particle_pos_offset:[Cc,Cc]}),xm=o.bz(),ym=(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le,de,pe,ye,Se,Te)=>{const _e=y.transform,ve={u_is_size_zoom_constant:+(p==="constant"||p==="source"),u_is_size_feature_constant:+(p==="constant"||p==="camera"),u_size_t:r?r.uSizeT:0,u_size:r?r.uSize:0,u_camera_to_center_distance:_e.getCameraToCenterDistance(le),u_rotate_symbol:+c,u_aspect_ratio:_e.width/_e.height,u_fade_change:y.options.fadeDuration?y.symbolFadeChange:1,u_matrix:v,u_label_plane_matrix:S,u_coord_matrix:N,u_is_text:+k,u_elevation_from_sea:C?1:0,u_pitch_with_map:+f,u_texsize:D,u_texsize_icon:U,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:xm,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:xm,u_up_vector:[0,-1,0],u_color_adj_mat:ye,u_icon_transition:Se||0,u_gamma_scale:f?y.transform.getCameraToCenterDistance(le)*Math.cos(y.terrain?0:y.transform._pitch):1,u_device_pixel_ratio:o.q.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:de,u_inv_matrix:o.bi(o.bz(),S),u_normal_scale:pe};return le.name==="globe"&&(ve.u_tile_id=[G.canonical.x,G.canonical.y,1<<G.canonical.z],ve.u_zoom_transition=ee,ve.u_inv_rot_matrix=se,ve.u_merc_center=J,ve.u_camera_forward=_e._camera.forward(),ve.u_ecef_origin=o.dQ(_e.globeMatrix,G.toUnwrapped()),ve.u_tile_matrix=Float32Array.from(_e.globeMatrix),ve.u_up_vector=te),ve},Jv=(p,r,c,f)=>({u_matrix:p,u_emissive_strength:r,u_opacity:c,u_color:f}),dy=(p,r,c,f,y,v,S,N,C)=>o.h(function(k,D,U,O,G,ee){const{width:J,height:se}=O.imageManager.getPixelSize(D),te=Math.pow(2,ee.tileID.overscaledZ),le=ee.tileSize*Math.pow(2,O.transform.tileZoom)/te,de=le*(ee.tileID.canonical.x+ee.tileID.wrap*te),pe=le*ee.tileID.canonical.y;return{u_image:0,u_pattern_tl:U.tl,u_pattern_br:U.br,u_texsize:[J,se],u_pattern_size:U.displaySize,u_pattern_units_to_pixels:G?[O.transform.width,-1*O.transform.height]:[1/o.aw(ee,1,O.transform.tileZoom),1/o.aw(ee,1,O.transform.tileZoom)],u_pixel_coord_upper:[de>>16,pe>>16],u_pixel_coord_lower:[65535&de,65535&pe]}}(0,v,S,f,N,C),{u_matrix:p,u_emissive_strength:r,u_opacity:c}),Tu=new Float32Array(o.bx([])),hy=(p,r,c,f,y,v,S,N,C,k,D,U,O,G=[0,0,0],ee)=>{const J=y.style.light,se=J.properties.get("position"),te=[-se.x,-se.y,se.z],le=o.dJ();J.properties.get("anchor")==="viewport"&&(o.dK(le,-y.transform.angle),o.dL(te,te,le));const de=D.alphaMode==="MASK",pe=J.properties.get("color").toNonPremultipliedRenderColor(null),ye=O.paint.get("model-ambient-occlusion-intensity"),Se=O.paint.get("model-color").constantOr(o.am.white).toNonPremultipliedRenderColor(null);return Se.a=O.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:p,u_lighting_matrix:r,u_normal_matrix:c,u_node_matrix:f||Tu,u_lightpos:te,u_lightintensity:J.properties.get("intensity"),u_lightcolor:[pe.r,pe.g,pe.b],u_camera_pos:G,u_opacity:v,u_baseTextureIsAlpha:0,u_alphaMask:+de,u_alphaCutoff:D.alphaCutoff,u_baseColorFactor:S.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:N.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:C,u_roughnessFactor:k,u_baseColorTexture:po.BaseColor,u_metallicRoughnessTexture:po.MetallicRoughness,u_normalTexture:po.Normal,u_occlusionTexture:po.Occlusion,u_emissionTexture:po.Emission,u_lutTexture:po.LUT,u_color_mix:Se.toArray01(),u_aoIntensity:ye,u_emissive_strength:U,u_occlusionTextureTransform:ee||[0,0,0,0]}},Qv=(p,r=Tu,c=Tu)=>({u_matrix:p,u_instance:r,u_node_matrix:c}),e1={fillExtrusion:p=>({u_matrix:new o.ch(p),u_lightpos:new o.ce(p),u_lightintensity:new o.cf(p),u_lightcolor:new o.ce(p),u_vertical_gradient:new o.cf(p),u_opacity:new o.cf(p),u_edge_radius:new o.cf(p),u_width_scale:new o.cf(p),u_ao:new o.cg(p),u_height_type:new o.cd(p),u_base_type:new o.cd(p),u_tile_id:new o.ce(p),u_zoom_transition:new o.cf(p),u_inv_rot_matrix:new o.ch(p),u_merc_center:new o.cg(p),u_up_dir:new o.ce(p),u_height_lift:new o.cf(p),u_flood_light_color:new o.ce(p),u_vertical_scale:new o.cf(p),u_flood_light_intensity:new o.cf(p),u_ground_shadow_factor:new o.ce(p)}),fillExtrusionDepth:p=>({u_matrix:new o.ch(p),u_edge_radius:new o.cf(p),u_width_scale:new o.cf(p),u_vertical_scale:new o.cf(p),u_height_type:new o.cd(p),u_base_type:new o.cd(p)}),fillExtrusionPattern:p=>({u_matrix:new o.ch(p),u_lightpos:new o.ce(p),u_lightintensity:new o.cf(p),u_lightcolor:new o.ce(p),u_vertical_gradient:new o.cf(p),u_height_factor:new o.cf(p),u_edge_radius:new o.cf(p),u_width_scale:new o.cf(p),u_ao:new o.cg(p),u_height_type:new o.cd(p),u_base_type:new o.cd(p),u_tile_id:new o.ce(p),u_zoom_transition:new o.cf(p),u_inv_rot_matrix:new o.ch(p),u_merc_center:new o.cg(p),u_up_dir:new o.ce(p),u_height_lift:new o.cf(p),u_image:new o.cd(p),u_texsize:new o.cg(p),u_pixel_coord_upper:new o.cg(p),u_pixel_coord_lower:new o.cg(p),u_tile_units_to_pixels:new o.cf(p),u_opacity:new o.cf(p),u_pattern_transition:new o.cf(p)}),fillExtrusionGroundEffect:p=>({u_matrix:new o.ch(p),u_opacity:new o.cf(p),u_ao_pass:new o.cf(p),u_meter_to_tile:new o.cf(p),u_ao:new o.cg(p),u_flood_light_intensity:new o.cf(p),u_flood_light_color:new o.ce(p),u_attenuation:new o.cf(p),u_edge_radius:new o.cf(p),u_fb:new o.cd(p),u_fb_size:new o.cf(p),u_dynamic_offset:new o.cf(p)}),fill:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_ground_shadow_factor:new o.ce(p)}),fillPattern:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_image:new o.cd(p),u_texsize:new o.cg(p),u_pixel_coord_upper:new o.cg(p),u_pixel_coord_lower:new o.cg(p),u_tile_units_to_pixels:new o.cf(p),u_ground_shadow_factor:new o.ce(p),u_pattern_transition:new o.cf(p)}),fillOutline:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_world:new o.cg(p),u_ground_shadow_factor:new o.ce(p)}),fillOutlinePattern:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_world:new o.cg(p),u_image:new o.cd(p),u_texsize:new o.cg(p),u_pixel_coord_upper:new o.cg(p),u_pixel_coord_lower:new o.cg(p),u_tile_units_to_pixels:new o.cf(p),u_ground_shadow_factor:new o.ce(p),u_pattern_transition:new o.cf(p)}),building:p=>({u_matrix:new o.ch(p),u_normal_matrix:new o.ch(p),u_opacity:new o.cf(p)}),buildingBloom:p=>({u_matrix:new o.ch(p)}),buildingDepth:p=>({u_matrix:new o.ch(p)}),elevatedStructuresDepth:p=>({u_matrix:new o.ch(p),u_depth_bias:new o.cf(p)}),elevatedStructures:p=>({u_matrix:new o.ch(p),u_ground_shadow_factor:new o.ce(p)}),elevatedStructuresDepthReconstruct:p=>({u_matrix:new o.ch(p),u_camera_pos:new o.ce(p),u_depth_bias:new o.cf(p),u_height_scale:new o.cf(p),u_reset_depth:new o.cf(p)}),circle:o.dT,collisionBox:p=>({u_matrix:new o.ch(p),u_inv_rot_matrix:new o.ch(p),u_camera_to_center_distance:new o.cf(p),u_extrude_scale:new o.cg(p),u_zoom_transition:new o.cf(p),u_merc_center:new o.cg(p),u_tile_id:new o.ce(p)}),collisionCircle:p=>({u_matrix:new o.ch(p),u_inv_matrix:new o.ch(p),u_camera_to_center_distance:new o.cf(p),u_viewport_size:new o.cg(p)}),debug:p=>({u_color:new o.dv(p),u_matrix:new o.ch(p),u_overlay:new o.cd(p),u_overlay_scale:new o.cf(p)}),clippingMask:p=>({u_matrix:new o.ch(p)}),heatmap:p=>({u_extrude_scale:new o.cf(p),u_intensity:new o.cf(p),u_matrix:new o.ch(p),u_inv_rot_matrix:new o.ch(p),u_merc_center:new o.cg(p),u_tile_id:new o.ce(p),u_zoom_transition:new o.cf(p),u_up_dir:new o.ce(p)}),heatmapTexture:p=>({u_image:new o.cd(p),u_color_ramp:new o.cd(p),u_opacity:new o.cf(p)}),hillshade:p=>({u_matrix:new o.ch(p),u_image:new o.cd(p),u_latrange:new o.cg(p),u_light:new o.cg(p),u_shadow:new o.dv(p),u_highlight:new o.dv(p),u_emissive_strength:new o.cf(p),u_accent:new o.dv(p)}),hillshadePrepare:p=>({u_matrix:new o.ch(p),u_image:new o.cd(p),u_dimension:new o.cg(p),u_zoom:new o.cf(p)}),line:o.dS,linePattern:o.dR,raster:p=>({u_matrix:new o.ch(p),u_normalize_matrix:new o.ch(p),u_globe_matrix:new o.ch(p),u_merc_matrix:new o.ch(p),u_grid_matrix:new o.dw(p),u_tl_parent:new o.cg(p),u_scale_parent:new o.cf(p),u_fade_t:new o.cf(p),u_opacity:new o.cf(p),u_image0:new o.cd(p),u_image1:new o.cd(p),u_brightness_low:new o.cf(p),u_brightness_high:new o.cf(p),u_saturation_factor:new o.cf(p),u_contrast_factor:new o.cf(p),u_spin_weights:new o.ce(p),u_perspective_transform:new o.cg(p),u_raster_elevation:new o.cf(p),u_zoom_transition:new o.cf(p),u_merc_center:new o.cg(p),u_cutoff_params:new o.d0(p),u_colorization_mix:new o.d0(p),u_colorization_offset:new o.cf(p),u_color_ramp:new o.cd(p),u_texture_offset:new o.cg(p),u_texture_res:new o.cg(p),u_emissive_strength:new o.cf(p)}),rasterParticle:p=>({u_matrix:new o.ch(p),u_normalize_matrix:new o.ch(p),u_globe_matrix:new o.ch(p),u_merc_matrix:new o.ch(p),u_grid_matrix:new o.dw(p),u_tl_parent:new o.cg(p),u_scale_parent:new o.cf(p),u_fade_t:new o.cf(p),u_opacity:new o.cf(p),u_image0:new o.cd(p),u_image1:new o.cd(p),u_raster_elevation:new o.cf(p),u_zoom_transition:new o.cf(p),u_merc_center:new o.cg(p),u_cutoff_params:new o.d0(p)}),rasterParticleTexture:p=>({u_texture:new o.cd(p),u_opacity:new o.cf(p)}),rasterParticleDraw:p=>({u_particle_texture:new o.cd(p),u_particle_texture_side_len:new o.cf(p),u_tile_offset:new o.cg(p),u_velocity:new o.cd(p),u_color_ramp:new o.cd(p),u_velocity_res:new o.cg(p),u_max_speed:new o.cf(p),u_uv_offset:new o.cg(p),u_data_scale:new o.cg(p),u_data_offset:new o.cf(p),u_particle_pos_scale:new o.cf(p),u_particle_pos_offset:new o.cg(p)}),rasterParticleUpdate:p=>({u_particle_texture:new o.cd(p),u_particle_texture_side_len:new o.cf(p),u_velocity:new o.cd(p),u_velocity_res:new o.cg(p),u_max_speed:new o.cf(p),u_speed_factor:new o.cf(p),u_reset_rate:new o.cf(p),u_rand_seed:new o.cf(p),u_uv_offset:new o.cg(p),u_data_scale:new o.cg(p),u_data_offset:new o.cf(p),u_particle_pos_scale:new o.cf(p),u_particle_pos_offset:new o.cg(p)}),symbol:p=>({u_is_size_zoom_constant:new o.cd(p),u_is_size_feature_constant:new o.cd(p),u_size_t:new o.cf(p),u_size:new o.cf(p),u_camera_to_center_distance:new o.cf(p),u_rotate_symbol:new o.cd(p),u_aspect_ratio:new o.cf(p),u_fade_change:new o.cf(p),u_matrix:new o.ch(p),u_label_plane_matrix:new o.ch(p),u_coord_matrix:new o.ch(p),u_is_text:new o.cd(p),u_elevation_from_sea:new o.cd(p),u_pitch_with_map:new o.cd(p),u_texsize:new o.cg(p),u_texsize_icon:new o.cg(p),u_texture:new o.cd(p),u_texture_icon:new o.cd(p),u_gamma_scale:new o.cf(p),u_device_pixel_ratio:new o.cf(p),u_tile_id:new o.ce(p),u_zoom_transition:new o.cf(p),u_inv_rot_matrix:new o.ch(p),u_merc_center:new o.cg(p),u_camera_forward:new o.ce(p),u_tile_matrix:new o.ch(p),u_up_vector:new o.ce(p),u_ecef_origin:new o.ce(p),u_is_halo:new o.cd(p),u_icon_transition:new o.cf(p),u_color_adj_mat:new o.ch(p),u_scale_factor:new o.cf(p),u_ground_shadow_factor:new o.ce(p),u_inv_matrix:new o.ch(p),u_normal_scale:new o.cf(p)}),background:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_opacity:new o.cf(p),u_color:new o.dv(p)}),backgroundPattern:p=>({u_matrix:new o.ch(p),u_emissive_strength:new o.cf(p),u_opacity:new o.cf(p),u_image:new o.cd(p),u_pattern_tl:new o.cg(p),u_pattern_br:new o.cg(p),u_texsize:new o.cg(p),u_pattern_size:new o.cg(p),u_pixel_coord_upper:new o.cg(p),u_pixel_coord_lower:new o.cg(p),u_pattern_units_to_pixels:new o.cg(p)}),terrainRaster:p=>({u_matrix:new o.ch(p),u_image0:new o.cd(p),u_skirt_height:new o.cf(p),u_ground_shadow_factor:new o.ce(p)}),skybox:p=>({u_matrix:new o.ch(p),u_sun_direction:new o.ce(p),u_cubemap:new o.cd(p),u_opacity:new o.cf(p),u_temporal_offset:new o.cf(p)}),skyboxGradient:p=>({u_matrix:new o.ch(p),u_color_ramp:new o.cd(p),u_center_direction:new o.ce(p),u_radius:new o.cf(p),u_opacity:new o.cf(p),u_temporal_offset:new o.cf(p)}),skyboxCapture:p=>({u_matrix_3f:new o.dw(p),u_sun_direction:new o.ce(p),u_sun_intensity:new o.cf(p),u_color_tint_r:new o.d0(p),u_color_tint_m:new o.d0(p),u_luminance:new o.cf(p)}),globeRaster:p=>({u_proj_matrix:new o.ch(p),u_globe_matrix:new o.ch(p),u_normalize_matrix:new o.ch(p),u_merc_matrix:new o.ch(p),u_zoom_transition:new o.cf(p),u_merc_center:new o.cg(p),u_image0:new o.cd(p),u_grid_matrix:new o.dw(p),u_skirt_height:new o.cf(p),u_far_z_cutoff:new o.cf(p),u_frustum_tl:new o.ce(p),u_frustum_tr:new o.ce(p),u_frustum_br:new o.ce(p),u_frustum_bl:new o.ce(p),u_globe_pos:new o.ce(p),u_globe_radius:new o.cf(p),u_viewport:new o.cg(p)}),globeAtmosphere:p=>({u_frustum_tl:new o.ce(p),u_frustum_tr:new o.ce(p),u_frustum_br:new o.ce(p),u_frustum_bl:new o.ce(p),u_horizon:new o.cf(p),u_transition:new o.cf(p),u_fadeout_range:new o.cf(p),u_color:new o.d0(p),u_high_color:new o.d0(p),u_space_color:new o.d0(p),u_temporal_offset:new o.cf(p),u_horizon_angle:new o.cf(p)}),model:p=>({u_matrix:new o.ch(p),u_lighting_matrix:new o.ch(p),u_normal_matrix:new o.ch(p),u_node_matrix:new o.ch(p),u_lightpos:new o.ce(p),u_lightintensity:new o.cf(p),u_lightcolor:new o.ce(p),u_camera_pos:new o.ce(p),u_opacity:new o.cf(p),u_baseColorFactor:new o.d0(p),u_emissiveFactor:new o.d0(p),u_metallicFactor:new o.cf(p),u_roughnessFactor:new o.cf(p),u_baseTextureIsAlpha:new o.cd(p),u_alphaMask:new o.cd(p),u_alphaCutoff:new o.cf(p),u_baseColorTexture:new o.cd(p),u_metallicRoughnessTexture:new o.cd(p),u_normalTexture:new o.cd(p),u_occlusionTexture:new o.cd(p),u_emissionTexture:new o.cd(p),u_lutTexture:new o.cd(p),u_color_mix:new o.d0(p),u_aoIntensity:new o.cf(p),u_emissive_strength:new o.cf(p),u_occlusionTextureTransform:new o.d0(p)}),modelDepth:p=>({u_matrix:new o.ch(p),u_instance:new o.ch(p),u_node_matrix:new o.ch(p)}),groundShadow:p=>({u_matrix:new o.ch(p),u_ground_shadow_factor:new o.ce(p)}),stars:p=>({u_matrix:new o.ch(p),u_up:new o.ce(p),u_right:new o.ce(p),u_intensity_multiplier:new o.cf(p)}),snowParticle:p=>({u_modelview:new o.ch(p),u_projection:new o.ch(p),u_time:new o.cf(p),u_cam_pos:new o.ce(p),u_velocityConeAperture:new o.cf(p),u_velocity:new o.cf(p),u_horizontalOscillationRadius:new o.cf(p),u_horizontalOscillationRate:new o.cf(p),u_boxSize:new o.cf(p),u_billboardSize:new o.cf(p),u_simpleShapeParameters:new o.cg(p),u_screenSize:new o.cg(p),u_thinningCenterPos:new o.cg(p),u_thinningShape:new o.ce(p),u_thinningAffectedRatio:new o.cf(p),u_thinningParticleOffset:new o.cf(p),u_particleColor:new o.d0(p),u_direction:new o.ce(p)}),rainParticle:p=>({u_modelview:new o.ch(p),u_projection:new o.ch(p),u_time:new o.cf(p),u_cam_pos:new o.ce(p),u_texScreen:new o.cd(p),u_velocityConeAperture:new o.cf(p),u_velocity:new o.cf(p),u_boxSize:new o.cf(p),u_rainDropletSize:new o.cg(p),u_distortionStrength:new o.cf(p),u_rainDirection:new o.ce(p),u_color:new o.d0(p),u_screenSize:new o.cg(p),u_thinningCenterPos:new o.cg(p),u_thinningShape:new o.ce(p),u_thinningAffectedRatio:new o.cf(p),u_thinningParticleOffset:new o.cf(p),u_shapeDirectionalPower:new o.cf(p),u_shapeNormalPower:new o.cf(p),u_mode:new o.cf(p)}),vignette:p=>({u_vignetteShape:new o.ce(p),u_vignetteColor:new o.d0(p)}),occlusion:p=>({u_matrix:new o.ch(p),u_anchorPos:new o.ce(p),u_screenSizePx:new o.cg(p),u_occluderSizePx:new o.cg(p),u_color:new o.d0(p)})};class Ac{constructor(r,c,f,y){this.id=Ac.uniqueIdxCounter,Ac.uniqueIdxCounter++,this.context=r;const v=r.gl;this.buffer=v.createBuffer(),this.dynamicDraw=!!f,this.context.unbindVAO(),r.bindElementBuffer.set(this.buffer),v.bufferData(v.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?v.DYNAMIC_DRAW:v.STATIC_DRAW),this.dynamicDraw||y||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(r){this.id=Ac.uniqueIdxCounter,Ac.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,r.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Ac.uniqueIdxCounter=0;const py={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class fy{constructor(r,c,f,y,v,S){this.length=c.length,this.attributes=f,this.itemSize=c.bytesPerElement,this.dynamicDraw=y,this.instanceCount=S,this.context=r;const N=r.gl;this.buffer=N.createBuffer(),r.bindVertexBuffer.set(this.buffer),N.bufferData(N.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?N.DYNAMIC_DRAW:N.STATIC_DRAW),this.dynamicDraw||v||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(r){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,r.arrayBuffer)}enableAttributes(r,c){for(let f=0;f<this.attributes.length;f++){const y=c.attributes[this.attributes[f].name];y!==void 0&&r.enableVertexAttribArray(y)}}setVertexAttribPointers(r,c,f){for(let y=0;y<this.attributes.length;y++){const v=this.attributes[y],S=c.attributes[v.name];S!==void 0&&r.vertexAttribPointer(S,v.components,r[py[v.type]],!1,this.itemSize,v.offset+this.itemSize*(f||0))}}setVertexAttribDivisor(r,c,f){for(let y=0;y<this.attributes.length;y++){const v=c.attributes[this.attributes[y].name];v!==void 0&&this.instanceCount&&this.instanceCount>0&&r.vertexAttribDivisor(v,f)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Nu{constructor(r,c,f,y,v){this.context=r,this.width=c,this.height=f;const S=this.framebuffer=r.gl.createFramebuffer();y&&(this.colorAttachment=new OS(r,S)),v&&(this.depthAttachmentType=v,this.depthAttachment=v==="renderbuffer"?new Uv(r,S):new Jx(r,S))}destroy(){const r=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&r.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&r.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&r.deleteTexture(c)}r.deleteFramebuffer(this.framebuffer)}}class _m{constructor(r,c){this.gl=r,this.clearColor=new MS(this),this.clearDepth=new RS(this),this.clearStencil=new kS(this),this.colorMask=new DS(this),this.depthMask=new kv(this),this.stencilMask=new LS(this),this.stencilFunc=new em(this),this.stencilOp=new zS(this),this.stencilTest=new Dv(this),this.depthRange=new qx(this),this.depthTest=new tm(this),this.depthFunc=new Zx(this),this.blend=new wu(this),this.blendFunc=new bd(this),this.blendColor=new sm(this),this.blendEquation=new nm(this),this.cullFace=new wd(this),this.cullFaceSide=new Lv(this),this.frontFace=new Kx(this),this.program=new zv(this),this.activeTexture=new Sd(this),this.viewport=new rm(this),this.bindFramebuffer=new im(this),this.bindRenderbuffer=new Xx(this),this.bindTexture=new om(this),this.bindVertexBuffer=new gp(this),this.bindElementBuffer=new Ov(this),this.bindVertexArrayOES=new Fv(this),this.pixelStoreUnpack=new Bv(this),this.pixelStoreUnpackPremultiplyAlpha=new jd(this),this.pixelStoreUnpackFlipY=new Vv(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=r.getExtension("EXT_texture_filter_anisotropic")||r.getExtension("MOZ_EXT_texture_filter_anisotropic")||r.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=r.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=r.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=r.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=r.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=r.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=r.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=r.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=r.getParameter(r.MAX_TEXTURE_SIZE),this.maxPointSize=r.getParameter(r.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(r,c,f){return new Ac(this,r,c,f)}createVertexBuffer(r,c,f,y,v){return new fy(this,r,c,f,y,v)}createRenderbuffer(r,c,f){const y=this.gl,v=y.createRenderbuffer();return this.bindRenderbuffer.set(v),y.renderbufferStorage(y.RENDERBUFFER,r,c,f),this.bindRenderbuffer.set(null),v}createFramebuffer(r,c,f,y){return new Nu(this,r,c,f,y)}clear({color:r,depth:c,stencil:f,colorMask:y}){const v=this.gl;let S=0;r&&(S|=v.COLOR_BUFFER_BIT,this.clearColor.set(r.toNonPremultipliedRenderColor(null)),this.colorMask.set(y||[!0,!0,!0,!0])),c!==void 0&&(S|=v.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),f!==void 0&&(S|=v.STENCIL_BUFFER_BIT,this.clearStencil.set(f),this.stencilMask.set(255)),v.clear(S)}setCullFace(r){r.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(r.mode),this.frontFace.set(r.frontFace))}setDepthMode(r){r.func!==this.gl.ALWAYS||r.mask?(this.depthTest.set(!0),this.depthFunc.set(r.func),this.depthMask.set(r.mask),this.depthRange.set(r.range)):this.depthTest.set(!1)}setStencilMode(r){r.test.func!==this.gl.ALWAYS||r.mask?(this.stencilTest.set(!0),this.stencilMask.set(r.mask),this.stencilOp.set([r.fail,r.depthFail,r.pass]),this.stencilFunc.set({func:r.test.func,ref:r.ref,mask:r.test.mask})):this.stencilTest.set(!1)}setColorMode(r){o.bv(r.blendFunction,Fs.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(r.blendFunction),this.blendColor.set(r.blendColor),r.blendEquation?this.blendEquation.set(r.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(r.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let Pc;function my(p,r,c,f,y,v,S){const N=p.context,C=N.gl,k=p.transform,D=[o.aD(k.center.lng),o.aH(k.center.lat)],U=c.layout.get("symbol-placement"),O=c.layout.get("text-variable-anchor"),G=c.layout.get("icon-rotation-alignment")==="map",ee=c.layout.get("text-rotation-alignment")==="map",J=U!=="point",se=[];let te=0,le=0;for(let ve=0;ve<f.length;ve++){const be=f[ve],Ue=r.getTile(be),Ie=Ue.getBucket(c);if(!Ie)continue;const tt=Ie.getProjection().createInversionMatrix(k,be.canonical),We=[],rt=bv(be,Ie,k),jt=!S&&G&&J,$e=S&&ee&&J,Ae=O&&Ie.hasTextData(),Ke=Ie.hasIconTextFit()&&Ae&&Ie.hasIconData(),Ge=jt||$e||S&&Ae||Ke,ht=Ie.projection.name==="globe",pt=ht?o.ah(k.zoom):0;ht&&(We.push("PROJECTION_GLOBE_VIEW"),Ge&&We.push("PROJECTED_POS_ON_VIEWPORT"));const mt=p.getOrCreateProgram("collisionBox",{defines:We});let Pt=rt;y[0]===0&&y[1]===0||(Pt=p.translatePosMatrix(rt,Ue,y,v));const ns=S?Ie.textCollisionBox:Ie.iconCollisionBox,us=Ie.collisionCircleArray;if(us.length>0){const as=o.bz(),is=Pt;o.cM(as,Ie.placementInvProjMatrix,k.glCoordMatrix),o.cM(as,as,Ie.placementViewportMatrix),se.push({circleArray:us,circleOffset:le,transform:is,invTransform:as,projection:Ie.getProjection()}),te+=us.length/4,le=te}if(!ns)continue;p.terrain&&p.terrain.setupElevationDraw(Ue,mt);const Wt=ht?[be.canonical.x,be.canonical.y,1<<be.canonical.z]:[0,0,0];mt.draw(p,C.LINES,Kt.disabled,Ss.disabled,p.colorModeForRenderPass(),gs.disabled,Ed(Pt,tt,k,pt,D,Ue,Wt,Ie.getProjection()),c.id,ns.layoutVertexBuffer,ns.indexBuffer,ns.segments,null,k.zoom,null,[ns.collisionVertexBuffer,ns.collisionVertexBufferExt])}if(!S||!se.length)return;const de=p.getOrCreateProgram("collisionCircle"),pe=new o.dU;pe.resize(4*te),pe._trim();let ye=0;for(const ve of se)for(let be=0;be<ve.circleArray.length/4;be++){const Ue=4*be,Ie=ve.circleArray[Ue+0],tt=ve.circleArray[Ue+1],We=ve.circleArray[Ue+2],rt=ve.circleArray[Ue+3];pe.emplace(ye++,Ie,tt,We,rt,0),pe.emplace(ye++,Ie,tt,We,rt,1),pe.emplace(ye++,Ie,tt,We,rt,2),pe.emplace(ye++,Ie,tt,We,rt,3)}(!Pc||Pc.length<2*te)&&(Pc=function(ve){const be=2*ve,Ue=new o.a_;Ue.resize(be),Ue._trim();for(let Ie=0;Ie<be;Ie++){const tt=6*Ie;Ue.uint16[tt+0]=4*Ie+0,Ue.uint16[tt+1]=4*Ie+1,Ue.uint16[tt+2]=4*Ie+2,Ue.uint16[tt+3]=4*Ie+2,Ue.uint16[tt+4]=4*Ie+3,Ue.uint16[tt+5]=4*Ie+0}return Ue}(te));const Se=N.createIndexBuffer(Pc,!0),Te=N.createVertexBuffer(pe,o.dV.members,!0);for(const ve of se){const be={u_matrix:ve.transform,u_inv_matrix:ve.invTransform,u_camera_to_center_distance:(_e=k).getCameraToCenterDistance(ve.projection),u_viewport_size:[_e.width,_e.height]};de.draw(p,C.TRIANGLES,Kt.disabled,Ss.disabled,p.colorModeForRenderPass(),gs.disabled,be,c.id,Te,Se,o.bd.simpleSegment(0,2*ve.circleOffset,ve.circleArray.length,ve.circleArray.length/2),null,k.zoom)}var _e;Te.destroy(),Se.destroy()}const Eu=o.bz();function _p(p){const r=p._camera.getWorldToCamera(p.worldSize,1),c=o.az([],r,p.globeMatrix);o.bi(c,c);const f=[0,0,0],y=[0,1,0,0];return o.aA(y,y,c),f[0]=y[0],f[1]=y[1],f[2]=y[2],o.au(f,f),f}function gy({width:p,height:r,anchor:c,textOffset:f,textScale:y},v){const{horizontalAlign:S,verticalAlign:N}=o.bZ(c),C=-(S-.5)*p,k=-(N-.5)*r,D=o.b_(c,f);return new o.P((C/y+D[0])*v,(k/y+D[1])*v)}function t1(p,r,c,f,y,v,S,N,C,k){const D=p.text.placedSymbolArray,U=p.text.dynamicLayoutVertexArray,O=p.icon.dynamicLayoutVertexArray,G={},ee=p.getProjection(),J=Uf(S,ee,y),se=y.elevation,te=ee.upVectorScale(S.canonical,y.center.lat,y.worldSize).metersToTile;U.clear();for(let le=0;le<D.length;le++){const de=D.get(le),{tileAnchorX:pe,tileAnchorY:ye,numGlyphs:Se}=de,Te=de.hidden||!de.crossTileID||p.allowVerticalPlacement&&!de.placedOrientation?null:f[de.crossTileID];if(Te){let _e=0,ve=0,be=0;if(se){const Ke=se?se.getAtTileOffset(S,pe,ye):0,[Ge,ht,pt]=ee.upVector(S.canonical,pe,ye);_e=Ke*Ge*te,ve=Ke*ht*te,be=Ke*pt*te}let[Ue,Ie,tt,We]=ea(de.projectedAnchorX+_e,de.projectedAnchorY+ve,de.projectedAnchorZ+be,c?J:v);const rt=kx(y.getCameraToCenterDistance(ee),We);let jt=o.bJ(p.textSizeData,C,de)*rt/o.bU;c&&(jt*=p.tilePixelRatio/N);const $e=gy(Te,jt);c?({x:Ue,y:Ie,z:tt}=ee.projectTilePoint(pe+$e.x,ye+$e.y,S.canonical),[Ue,Ie,tt]=ea(Ue+_e,Ie+ve,tt+be,v)):(r&&$e._rotate(-y.angle),Ue+=$e.x,Ie+=$e.y,tt=0);const Ae=p.allowVerticalPlacement&&de.placedOrientation===o.bI.vertical?Math.PI/2:0;for(let Ke=0;Ke<Se;Ke++)o.bL(U,Ue,Ie,tt,Ae);k&&de.associatedIconIndex>=0&&(G[de.associatedIconIndex]={x:Ue,y:Ie,z:tt,angle:Ae})}else hd(Se,U)}if(k){O.clear();const le=p.icon.placedSymbolArray;for(let de=0;de<le.length;de++){const pe=le.get(de),{numGlyphs:ye}=pe,Se=G[de];if(pe.hidden||!Se)hd(ye,O);else{const{x:Te,y:_e,z:ve,angle:be}=Se;for(let Ue=0;Ue<ye;Ue++)o.bL(O,Te,_e,ve,be)}}p.icon.dynamicLayoutVertexBuffer.updateData(O)}p.text.dynamicLayoutVertexBuffer.updateData(U)}function xy(p,r,c,f,y,v,S={}){const N=c.paint.get("icon-translate"),C=c.paint.get("text-translate"),k=c.paint.get("icon-translate-anchor"),D=c.paint.get("text-translate-anchor"),U=c.layout.get("icon-rotation-alignment"),O=c.layout.get("text-rotation-alignment"),G=c.layout.get("icon-pitch-alignment"),ee=c.layout.get("text-pitch-alignment"),J=c.layout.get("icon-keep-upright"),se=c.layout.get("text-keep-upright"),te=c.paint.get("icon-color-saturation"),le=c.paint.get("icon-color-contrast"),de=c.paint.get("icon-color-brightness-min"),pe=c.paint.get("icon-color-brightness-max"),ye=c.layout.get("symbol-elevation-reference")==="sea",Se=p.context,Te=Se.gl,_e=p.transform,ve=U==="map",be=O==="map",Ue=G==="map",Ie=ee==="map",tt=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let We=!1;const rt=p.depthModeForSublayer(0,Kt.ReadOnly),jt=new Kt(p.context.gl.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D),$e=[o.aD(_e.center.lng),o.aH(_e.center.lat)],Ae=c.layout.get("text-variable-anchor"),Ke=_e.projection.name==="globe",Ge=[],ht=[0,-1,0];for(const pt of f){const mt=r.getTile(pt),Pt=mt.getBucket(c);if(!Pt||Pt.projection.name==="mercator"&&Ke||Pt.fullyClipped)continue;const ns=Pt.projection.name==="globe",us=ns?o.ah(_e.zoom):0,Wt=Uf(pt,Pt.getProjection(),_e),as=_e.calculatePixelsToTileUnitsMatrix(mt),is=Ae&&Pt.hasTextData(),Cs=Pt.hasIconTextFit()&&is&&Pt.hasIconData(),Ls=Pt.getProjection().createInversionMatrix(_e,pt.canonical),Ws=(1<<mt.tileID.canonical.z)*o.aj/p.transform.worldSize,pn=Pn=>{let _n=[0,0,0];if(Pn){const gr=p.style.directionalLight,dn=p.style.ambientLight;gr&&dn&&(_n=vu(p.style,gr,dn))}return _n},Rs=Pn=>{_e.depthOcclusionForSymbolsAndCircles&&(c.hasInitialOcclusionOpacityProperties||p.terrain)&&(Pn.push("DEPTH_D24"),Pn.push("DEPTH_OCCLUSION"))},fn=()=>{const Pn=ve&&c.layout.get("symbol-placement")!=="point",_n=[];Rs(_n);const gr=Pn||Cs,dn=Pt.elevationType==="road",Sn=p.shadowRenderer,zn=dn&&Ue&&!!Sn&&Sn.enabled,Or=pn(zn),Lr=dn&&Ue&&!p.terrain?jt:rt,Br=c.paint.get("icon-image-cross-fade");p.terrainRenderModeElevated()&&Ue&&_n.push("PITCH_WITH_MAP_TERRAIN"),ns&&(_n.push("PROJECTION_GLOBE_VIEW"),gr&&_n.push("PROJECTED_POS_ON_VIEWPORT")),Br>0&&Pt.hasAnySecondaryIcon&&_n.push("ICON_TRANSITION"),!Pt.icon.zOffsetVertexBuffer||dn&&p.terrain||_n.push("Z_OFFSET"),te===0&&le===0&&de===0&&pe===1||_n.push("COLOR_ADJUSTMENT"),Pt.sdfIcons&&_n.push("RENDER_SDF"),zn&&_n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),dn&&Ue&&!p.terrain&&Pt.icon.orientationVertexBuffer&&_n.push("ELEVATED_ROADS");const vi=Pt.icon.programConfigurations.get(c.id),qa=p.getOrCreateProgram("symbol",{config:vi,defines:_n}),go=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Oo=Pt.iconSizeData,Vi=o.bH(Oo,_e.zoom),oa=Ue||!_e.isOrthographic,Pa=np(Wt,mt.tileID.canonical,Ue,ve,_e,Pt.getProjection(),as),Ui=zl(Wt,mt.tileID.canonical,Ue,ve,_e,Pt.getProjection(),as),Pr=p.translatePosMatrix(Ui,mt,N,k,!0),Sr=p.translatePosMatrix(Wt,mt,N,k),Xn=gr?Eu:Pa,Hr=ve&&!Ue&&!Pn;let bi=ht;!Ke&&!_e.mercatorFromTransition||ve||(bi=_p(_e));const Ir=ns?bi:ht,aa=c.getColorAdjustmentMatrix(te,le,de,pe),Iu=ym(Oo.kind,Vi,Hr,Ue,p,Sr,Xn,Pr,ye,!1,go,[0,0],0,pt,us,$e,Ls,Ir,Pt.getProjection(),Or,Ws,aa,Br,null),zc=mt.imageAtlasTexture?mt.imageAtlasTexture:null,Ud=c.layout.get("icon-size").constantOr(0)!==1||Pt.iconsNeedLinear,$d=Pt.sdfIcons||p.options.rotating||p.options.zooming||Ud||oa?Te.LINEAR:Te.NEAREST,la=Pt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,yl=p.terrain&&Ue&&Pn?o.bi(o.bz(),Pa):Eu;if(Pn&&Pt.icon){const Wr=_e.elevation,ca=Wr?Wr.getAtTileOffsetFunc(pt,_e.center.lat,_e.worldSize,Pt.getProjection()):null,Mu=dd(Wt,mt.tileID.canonical,Ue,ve,_e,Pt.getProjection(),as);xu(Pt,Wt,p,!1,Mu,Ui,Ue,J,ca,pt)}return{program:qa,buffers:Pt.icon,uniformValues:Iu,atlasTexture:zc,atlasTextureIcon:null,atlasInterpolation:$d,atlasInterpolationIcon:null,isSDF:Pt.sdfIcons,hasHalo:la,depthMode:Lr,tile:mt,renderWithShadows:zn,labelPlaneMatrixInv:yl}},yn=()=>{const Pn=be&&c.layout.get("symbol-placement")!=="point",_n=[],gr=Pn||Ae||Cs,dn=Pt.elevationType==="road",Sn=p.shadowRenderer,zn=dn&&Ie&&!!Sn&&Sn.enabled,Or=pn(zn),Lr=dn&&Ie&&!p.terrain?jt:rt;p.terrainRenderModeElevated()&&Ie&&_n.push("PITCH_WITH_MAP_TERRAIN"),ns&&(_n.push("PROJECTION_GLOBE_VIEW"),gr&&_n.push("PROJECTED_POS_ON_VIEWPORT")),!Pt.text.zOffsetVertexBuffer||dn&&p.terrain||_n.push("Z_OFFSET"),Pt.iconsInText&&_n.push("RENDER_TEXT_AND_SYMBOL"),_n.push("RENDER_SDF"),zn&&_n.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),dn&&Ie&&!p.terrain&&Pt.text.orientationVertexBuffer&&_n.push("ELEVATED_ROADS"),Rs(_n);const Br=Pt.text.programConfigurations.get(c.id),vi=p.getOrCreateProgram("symbol",{config:Br,defines:_n});let qa,go=[0,0],Oo=null;const Vi=Pt.textSizeData;Pt.iconsInText&&(go=mt.imageAtlasTexture?mt.imageAtlasTexture.size:[0,0],Oo=mt.imageAtlasTexture?mt.imageAtlasTexture:null,qa=Ie||!_e.isOrthographic||p.options.rotating||p.options.zooming||Vi.kind==="composite"||Vi.kind==="camera"?Te.LINEAR:Te.NEAREST);const oa=mt.glyphAtlasTexture?mt.glyphAtlasTexture.size:[0,0],Pa=c.layout.get("text-size-scale-range"),Ui=o.ay(p.scaleFactor,Pa[0],Pa[1]),Pr=o.bH(Vi,_e.zoom,Ui),Sr=np(Wt,mt.tileID.canonical,Ie,be,_e,Pt.getProjection(),as),Xn=zl(Wt,mt.tileID.canonical,Ie,be,_e,Pt.getProjection(),as),Hr=p.translatePosMatrix(Xn,mt,C,D,!0),bi=p.translatePosMatrix(Wt,mt,C,D),Ir=gr?Eu:Sr,aa=be&&!Ie&&!Pn;let Iu=ht;!Ke&&!_e.mercatorFromTransition||be||(Iu=_p(_e));const zc=ym(Vi.kind,Pr,aa,Ie,p,bi,Ir,Hr,ye,!0,oa,go,0,pt,us,$e,Ls,ns?Iu:ht,Pt.getProjection(),Or,Ws,null,null,Ui),Ud=mt.glyphAtlasTexture?mt.glyphAtlasTexture:null,$d=Te.LINEAR,la=c.paint.get("text-halo-width").constantOr(1)!==0,yl=p.terrain&&Ie&&Pn?o.bi(o.bz(),Sr):Eu;if(Pn&&Pt.text){const Wr=_e.elevation,ca=Wr?Wr.getAtTileOffsetFunc(pt,_e.center.lat,_e.worldSize,Pt.getProjection()):null,Mu=dd(Wt,mt.tileID.canonical,Ie,be,_e,Pt.getProjection(),as);xu(Pt,Wt,p,!0,Mu,Xn,Ie,se,ca,pt)}return{program:vi,buffers:Pt.text,uniformValues:zc,atlasTexture:Ud,atlasTextureIcon:Oo,atlasInterpolation:$d,atlasInterpolationIcon:qa,isSDF:!0,hasHalo:la,depthMode:Lr,tile:mt,renderWithShadows:zn,labelPlaneMatrixInv:yl}},Hn=Pt.icon.segments.get().length,$s=Pt.text.segments.get().length,mn=Hn&&!S.onlyText?fn():null,gn=$s&&!S.onlyIcons?yn():null,wn=c.paint.get("icon-opacity").constantOr(1),qs=c.paint.get("text-opacity").constantOr(1);if(tt&&Pt.canOverlap){We=!0;const Pn=wn&&!S.onlyText?Pt.icon.segments.get():[],_n=qs&&!S.onlyIcons?Pt.text.segments.get():[];for(const gr of Pn)Ge.push({segments:new o.bd([gr]),sortKey:gr.sortKey,state:mn});for(const gr of _n)Ge.push({segments:new o.bd([gr]),sortKey:gr.sortKey,state:gn})}else S.onlyText||Ge.push({segments:wn?Pt.icon.segments:new o.bd([]),sortKey:0,state:mn}),S.onlyIcons||Ge.push({segments:qs?Pt.text.segments:new o.bd([]),sortKey:0,state:gn})}We&&Ge.sort((pt,mt)=>pt.sortKey-mt.sortKey);for(const pt of Ge){const mt=pt.state;if(mt)if(p.terrain?p.terrain.setupElevationDraw(mt.tile,mt.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:mt.labelPlaneMatrixInv}):p.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,mt.program),Se.activeTexture.set(Te.TEXTURE0),mt.atlasTexture&&mt.atlasTexture.bind(mt.atlasInterpolation,Te.CLAMP_TO_EDGE,!0),mt.atlasTextureIcon&&(Se.activeTexture.set(Te.TEXTURE1),mt.atlasTextureIcon&&mt.atlasTextureIcon.bind(mt.atlasInterpolationIcon,Te.CLAMP_TO_EDGE,!0)),mt.renderWithShadows&&p.shadowRenderer.setupShadows(mt.tile.tileID.toUnwrapped(),mt.program,"vector-tile"),p.uploadCommonLightUniforms(p.context,mt.program),mt.hasHalo){const Pt=mt.uniformValues;Pt.u_is_halo=1,Ic(mt.buffers,pt.segments,c,p,mt.program,mt.depthMode,y,v,Pt,2),Pt.u_is_halo=0}else{if(mt.isSDF){const Pt=mt.uniformValues;mt.hasHalo&&(Pt.u_is_halo=1,Ic(mt.buffers,pt.segments,c,p,mt.program,mt.depthMode,y,v,Pt,1)),Pt.u_is_halo=0}Ic(mt.buffers,pt.segments,c,p,mt.program,mt.depthMode,y,v,mt.uniformValues,1)}}}function Ic(p,r,c,f,y,v,S,N,C,k){const D=[p.dynamicLayoutVertexBuffer,p.opacityVertexBuffer,p.iconTransitioningVertexBuffer,p.globeExtVertexBuffer,p.zOffsetVertexBuffer,p.orientationVertexBuffer];y.draw(f,f.context.gl.TRIANGLES,v,S,N,gs.disabled,C,c.id,p.layoutVertexBuffer,p.indexBuffer,r,c.paint,f.transform.zoom,p.programConfigurations.get(c.id),D,k)}function vp(p,r){const c=1<<p.canonical.z,f=(r.x*c-p.canonical.x-p.wrap*c)*o.aj,y=(r.y*c-p.canonical.y)*o.aj,v=o.e2(r.z,r.y);return o.d2(f,y,v)}function Yt(p,r,c,f,y){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const v=p.context.gl,S=new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D),N=new Kt(p.context.gl.GREATER,Kt.ReadWrite,p.depthRangeFor3D),C=function(G){const ee=o.cU(G.pitch);let J=.01;return G.isOrthographic&&(J=o.ai(1e-4,J,o.cZ(ee>=_i?1:ee/_i))),2*J}(p.transform),k=p.transform.getFreeCameraOptions().position,D="elevatedStructuresDepthReconstruct",U=p.getOrCreateProgram(D,{defines:["DEPTH_RECONSTRUCTION"]}),O=p.getOrCreateProgram(D);for(const G of f){const ee=r.getTile(G),J=ee.getBucket(c);if(!J)continue;const se=J.elevatedStructures;if(!se)continue;const te=J.elevationBufferData.heightRange,le=vp(G.toUnwrapped(),k),de=p.translatePosMatrix(G.projMatrix,ee,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let pe,ye,Se,Te;if(y==="initialize"){if(!te||te.min>=1||se.depthSegments.segments[0].primitiveLength===0)continue;pe=fm(de,le,C,1,0),ye=S,Se=se.depthSegments,Te=U}else if(y==="reset"){if(!te||te.min>=0||se.maskSegments.segments[0].primitiveLength===0)continue;pe=fm(de,le,0,0,1),ye=N,Se=se.maskSegments,Te=U}else if(y==="geometry"){if(se.depthSegments.segments[0].primitiveLength===0)continue;pe=fm(de,le,C,1,0),ye=S,Se=se.depthSegments,Te=O}Te.draw(p,v.TRIANGLES,ye,Ss.disabled,Fs.disabled,gs.disabled,pe,c.id,se.vertexBuffer,se.indexBuffer,Se,c.paint,p.transform.zoom)}}function vm(p,r,c){const{painter:f,sourceCache:y,layer:v,coords:S,colorMode:N,elevationType:C,terrainEnabled:k,pass:D}=p,U=f.context.gl,O=v.paint.get("fill-pattern"),G=v.paint.get("fill-pattern-cross-fade"),ee=O.constantOr(null);let J=C;C!=="road"||r&&!k||(J="none");const se=J==="road",te=p.painter.shadowRenderer,le=se&&!!te&&te.enabled,de=new Kt(f.context.gl.LEQUAL,Kt.ReadOnly,f.depthRangeFor3D);let pe=[0,0,0];if(le){const Te=f.style.directionalLight,_e=f.style.ambientLight;Te&&_e&&(pe=vu(f.style,Te,_e))}const ye=O&&O.constantOr(1),Se=(Te,_e)=>{let ve,be,Ue,Ie,tt;_e?(ve=ye&&!v.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",Ue=U.LINES):(ve=ye?"fillPattern":"fill",Ue=U.TRIANGLES);for(const We of S){const rt=y.getTile(We);if(ye&&!rt.patternsLoaded())continue;const jt=rt.getBucket(v);if(!jt)continue;const $e=r?jt.elevationBufferData:jt.bufferData;if($e.isEmpty())continue;f.prepareDrawTile();const Ae=$e.programConfigurations.get(v.id),Ke=f.isTileAffectedByFog(We),Ge=[],ht=[];se&&(Ge.push("ELEVATED_ROADS"),ht.push($e.elevatedLayoutVertexBuffer)),le&&Ge.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),ye&&(f.context.activeTexture.set(U.TEXTURE0),rt.imageAtlasTexture&&rt.imageAtlasTexture.bind(U.LINEAR,U.CLAMP_TO_EDGE),Ae.updatePaintBuffers());let pt=!1;if(ee&&rt.imageAtlas){const Wt=rt.imageAtlas,as=o.dZ.from(ee),is=as.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Cs=as.getSecondary(),Ls=Wt.patternPositions.get(is),Ws=Cs?Wt.patternPositions.get(Cs.scaleSelf(o.q.devicePixelRatio).toString()):null;pt=!!Ls&&!!Ws,Ls&&Ae.setConstantPatternPositions(Ls,Ws)}G>0&&(pt||Ae.getPatternTransitionVertexBuffer("fill-pattern"))&&Ge.push("FILL_PATTERN_TRANSITION");const mt=f.getOrCreateProgram(ve,{config:Ae,overrideFog:Ke,defines:Ge}),Pt=f.translatePosMatrix(We.projMatrix,rt,v.paint.get("fill-translate"),v.paint.get("fill-translate-anchor"));le&&te.setupShadows(rt.tileID.toUnwrapped(),mt,"vector-tile");const ns=v.paint.get("fill-emissive-strength");if(_e){Ie=$e.lineIndexBuffer,tt=$e.lineSegments;const Wt=f.terrain&&f.terrain.renderingToTexture?f.terrain.drapeBufferSize:[U.drawingBufferWidth,U.drawingBufferHeight];be=ve==="fillOutlinePattern"&&ye?BS(Pt,ns,f,rt,Wt,pe,G):FS(Pt,ns,Wt,pe)}else Ie=$e.indexBuffer,tt=$e.triangleSegments,be=ye?Wv(Pt,ns,f,rt,pe,G):Hv(Pt,ns,pe);f.uploadCommonUniforms(f.context,mt,We.toUnwrapped());let us=Te;(C==="road"&&!k||C==="offset")&&(us=de),mt.draw(f,Ue,us,c||f.stencilModeForClipping(We),N,gs.disabled,be,v.id,$e.layoutVertexBuffer,Ie,tt,v.paint,f.transform.zoom,Ae,ht)}};f.renderPass===D&&Se(f.depthModeForSublayer(1,f.renderPass==="opaque"?Kt.ReadWrite:Kt.ReadOnly),!1),J==="none"&&f.renderPass==="translucent"&&v.paint.get("fill-antialias")&&Se(f.depthModeForSublayer(v.getPaintProperty("fill-outline-color")?2:0,Kt.ReadOnly),!0)}function bp(p,r,c,f,y,v,S,N){c.resetLayerRenderingStats(p);const C=p.context,k=C.gl,D=p.transform,U=c.paint.get("fill-extrusion-pattern"),O=c.paint.get("fill-extrusion-pattern-cross-fade"),G=U.constantOr(null),ee=U.constantOr(1),J=c.paint.get("fill-extrusion-opacity"),se=p.style.enable3dLights(),te=c.paint.get(se&&!ee?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),le=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),te],de=c.layout.get("fill-extrusion-edge-radius"),pe=de>0&&!c.paint.get("fill-extrusion-rounded-roof"),ye=pe?0:de,Se=D.projection.name==="globe"?o.e5():0,Te=D.projection.name==="globe",_e=Te?o.ah(D.zoom):0,ve=[o.aD(D.center.lng),o.aH(D.center.lat)],be=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",Ue=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(be?null:c.lut).toArray01().slice(0,3),Ie=c.paint.get("fill-extrusion-flood-light-intensity"),tt=c.paint.get("fill-extrusion-vertical-scale"),We=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,rt=c.paint.get("fill-extrusion-height-alignment"),jt=c.paint.get("fill-extrusion-base-alignment"),$e=pl(p,c.paint.get("fill-extrusion-cutoff-fade-range")),Ae=[];let Ke;Te&&Ae.push("PROJECTION_GLOBE_VIEW"),le[0]>0&&Ae.push("FAUX_AO"),pe&&Ae.push("ZERO_ROOF_RADIUS"),N&&Ae.push("HAS_CENTROID"),Ie>0&&Ae.push("FLOOD_LIGHT"),$e.shouldRenderCutoff&&Ae.push("RENDER_CUTOFF"),We&&Ae.push("RENDER_WALL_MODE");const Ge=p.renderPass==="shadow",ht=p.shadowRenderer,pt=Ge&&!!ht,mt=Ge?gs.disabled:gs.backCCW;p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0);let Pt=[0,0,0];if(ht){const Wt=p.style.directionalLight,as=p.style.ambientLight;Wt&&as&&(Pt=vu(p.style,Wt,as)),Ge||(Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE"),ht.useNormalOffset&&Ae.push("NORMAL_OFFSET")),Ke=Ae.concat(["SHADOWS_SINGLE_CASCADE"])}const ns=pt?"fillExtrusionDepth":ee?"fillExtrusionPattern":"fillExtrusion",us=c.getLayerRenderingStats();for(const Wt of f){const as=r.getTile(Wt),is=as.getBucket(c);if(!is||is.projection.name!==D.projection.name)continue;let Cs=!1;ht&&(Cs=ht.getMaxCascadeForTile(Wt.toUnwrapped())===0);const Ls=p.isTileAffectedByFog(Wt),Ws=is.programConfigurations.get(c.id);let pn=!1;if(G&&as.imageAtlas){const gn=as.imageAtlas,wn=o.dZ.from(G),qs=wn.getPrimary().scaleSelf(o.q.devicePixelRatio).toString(),Pn=wn.getSecondary(),_n=gn.patternPositions.get(qs),gr=Pn?gn.patternPositions.get(Pn.scaleSelf(o.q.devicePixelRatio).toString()):null;pn=!!_n&&!!gr,_n&&Ws.setConstantPatternPositions(_n,gr)}O>0&&(pn||Ws.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Ae.push("FILL_EXTRUSION_PATTERN_TRANSITION");const Rs=p.getOrCreateProgram(ns,{config:Ws,defines:Cs?Ke:Ae,overrideFog:Ls});if(p.terrain&&p.terrain.setupElevationDraw(as,Rs,{useMeterToDem:!0}),!is.centroidVertexBuffer){const gn=Rs.attributes.a_centroid_pos;gn!==void 0&&k.vertexAttrib2f(gn,0,0)}!Ge&&ht&&ht.setupShadows(as.tileID.toUnwrapped(),Rs,"vector-tile"),ee&&(p.context.activeTexture.set(k.TEXTURE0),as.imageAtlasTexture&&as.imageAtlasTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),Ws.updatePaintBuffers());const fn=c.paint.get("fill-extrusion-vertical-gradient"),yn=1/is.tileToMeter;let Hn;if(Ge&&ht){if(bm(as.tileID,is.maxHeight,p))continue;const gn=ht.calculateShadowPassMatrixFromTile(as.tileID.toUnwrapped());Hn=Gv(gn,ye,yn,tt,rt,jt)}else{const gn=p.translatePosMatrix(Wt.expandedProjMatrix,as,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),wn=D.projection.createInversionMatrix(D,Wt.canonical);Hn=ee?Nd(gn,p,fn,J,le,ye,yn,Wt,as,Se,rt,jt,_e,ve,wn,Ue,tt,O):oy(gn,p,fn,J,le,ye,yn,Wt,Se,rt,jt,_e,ve,wn,Ue,tt,Ie,Pt)}p.uploadCommonUniforms(C,Rs,Wt.toUnwrapped(),null,$e);let $s=is.segments;if(D.projection.name==="mercator"&&!Ge&&($s=is.getVisibleSegments(as.tileID,p.terrain,p.transform.getFrustum(0)),!$s.get().length))continue;if(us)if(Ge)for(const gn of $s.get())us.numRenderedVerticesInShadowPass+=gn.primitiveLength;else for(const gn of $s.get())us.numRenderedVerticesInTransparentPass+=gn.primitiveLength;const mn=[];(p.terrain||N)&&mn.push(is.centroidVertexBuffer),Te&&mn.push(is.layoutVertexExtBuffer),We&&mn.push(is.wallVertexBuffer),Rs.draw(p,C.gl.TRIANGLES,y,v,S,mt,Hn,c.id,is.layoutVertexBuffer,is.indexBuffer,$s,c.paint,p.transform.zoom,Ws,mn)}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1)}class Bl{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ao(p,r,c,f,y,v,S,N,C,k,D,U,O,G,ee,J,se,te,le,de){const pe=r.context,ye=pe.gl,Se=r.transform,Te=r.transform.zoom,_e=[],ve=p.translate,be=p.translateAnchor,Ue=p.edgeRadius,Ie=pl(r,p.cutoffFadeRange);D==="clear"?(_e.push("CLEAR_SUBPASS"),de&&(_e.push("CLEAR_FROM_TEXTURE"),pe.activeTexture.set(ye.TEXTURE0),de.bind(ye.LINEAR,ye.CLAMP_TO_EDGE))):D==="sdf"&&_e.push("SDF_SUBPASS"),te&&_e.push("HAS_CENTROID"),Ie.shouldRenderCutoff&&_e.push("RENDER_CUTOFF");const tt=(We,rt,jt,$e,Ae)=>{const Ke=rt.programConfigurations.get(f.id),Ge=r.isTileAffectedByFog(We),ht=r.getOrCreateProgram("fillExtrusionGroundEffect",{config:Ke,defines:_e,overrideFog:Ge}),pt=((Pt,ns,us,Wt,as,is,Cs,Ls,Ws,pn,Rs)=>({u_matrix:ns,u_opacity:us,u_ao_pass:Wt?1:0,u_meter_to_tile:as,u_ao:is,u_flood_light_intensity:Cs,u_flood_light_color:Ls,u_attenuation:Ws,u_edge_radius:pn,u_fb:0,u_fb_size:Rs,u_dynamic_offset:1}))(0,$e,U,k,Ae,[O,G*Ae],ee,J,se,Te>=17?0:Ue*Ae,de?de.size[0]:0),mt=[];te&&mt.push(rt.hiddenByLandmarkVertexBuffer),r.uploadCommonUniforms(pe,ht,We.toUnwrapped(),null,Ie),ht.draw(r,pe.gl.TRIANGLES,v,S,N,C,pt,f.id,rt.vertexBuffer,rt.indexBuffer,jt,f.paint,Te,Ke,mt)};for(const We of y){const rt=c.getTile(We),jt=rt.getBucket(f);if(!jt||jt.projection.name!==Se.projection.name||!jt.groundEffect||jt.groundEffect&&!jt.groundEffect.hasData())continue;const $e=jt.groundEffect,Ae=1/jt.tileToMeter;{const Ke=r.translatePosMatrix(We.projMatrix,rt,ve,be),Ge=$e.getDefaultSegment();tt(We,$e,Ge,Ke,Ae)}if(le)for(let Ke=0;Ke<4;Ke++){const Ge=o.e3[Ke](We),ht=c.getTile(Ge);if(!ht)continue;const pt=ht.getBucket(f);if(!pt||pt.projection.name!==Se.projection.name||!pt.groundEffect||pt.groundEffect&&!pt.groundEffect.hasData())continue;const mt=pt.groundEffect;let Pt,ns;Ke===0?(Pt=[-o.aj,0,0],ns=1):Ke===1?(Pt=[o.aj,0,0],ns=0):Ke===2?(Pt=[0,-o.aj,0],ns=3):(Pt=[0,o.aj,0],ns=2);const us=mt.regionSegments[ns];if(!us)continue;const Wt=new Float32Array(16);o.bo(Wt,We.projMatrix,Pt),tt(We,mt,us,r.translatePosMatrix(Wt,rt,ve,be),Ae)}}}function ys(p,r,c,f,y,v,S){f.centroidVertexArray.length===0&&f.createCentroidsBuffer();const N=v?v.findDEMTileFor(c):null;if(!(N&&N.dem||S))return;v&&N&&N.dem&&f.selfDEMTileTimestamp!==N.dem._timestamp&&(f.borderDoneWithNeighborZ=[-1,-1,-1,-1],f.selfDEMTileTimestamp=N.dem._timestamp);const C=te=>new o.P(Math.ceil((te+o.e7)*o.e8),0),k=te=>{const le=r.getSource().minzoom,de=ye=>{const Se=r.getTileByID(ye);if(Se&&Se.hasData())return Se.getBucket(y)},pe=[0,-1,1];for(const ye of pe){if(te.overscaledZ+ye<le)continue;const Se=de(te.calculateScaledKey(te.overscaledZ+ye));if(Se)return Se}},D=[0,0,0],U=(te,le)=>(D[0]=Math.min(te.min.y,le.min.y),D[1]=Math.max(te.max.y,le.max.y),D[2]=o.aj-le.min.x>te.max.x?le.min.x-o.aj:te.max.x,D),O=(te,le)=>(D[0]=Math.min(te.min.x,le.min.x),D[1]=Math.max(te.max.x,le.max.x),D[2]=o.aj-le.min.y>te.max.y?le.min.y-o.aj:te.max.y,D),G=[(te,le)=>U(te,le),(te,le)=>U(le,te),(te,le)=>O(te,le),(te,le)=>O(le,te)],ee=(te,le,de,pe,ye,Se,Te)=>{if(!v)return 0;const _e=[[Se?de:te,Se?te:de,0],[Se?de:le,Se?le:de,0]],ve=Te<0?o.aj+Te:Te,be=[Se?ve:(te+le)/2,Se?(te+le)/2:ve,0];return de===0&&Te<0||de!==0&&Te>0?v.getForTilePoints(ye,[be],!0,pe):_e.push(be),v.getForTilePoints(c,_e,!0,N),Math.max(_e[0][2],_e[1][2],be[2])/v.exaggeration()};for(let te=0;te<4;te++){const le=f.borderFeatureIndices[te];if(le.length===0)continue;const de=o.e3[te](c),pe=k(de);if(!(pe&&pe instanceof o.e4))continue;const ye=v?v.findDEMTileFor(de):null;if(!(ye&&ye.dem||S)||(v&&ye&&ye.dem&&f.borderDEMTileTimestamp[te]!==ye.dem._timestamp&&(f.borderDoneWithNeighborZ[te]=-1,f.borderDEMTileTimestamp[te]=ye.dem._timestamp),f.borderDoneWithNeighborZ[te]===pe.canonical.z))continue;pe.centroidVertexArray.length===0&&pe.createCentroidsBuffer();const Se=(te<2?1:5)-te,Te=pe.borderDoneWithNeighborZ[Se]!==f.canonical.z,_e=pe.borderFeatureIndices[Se];let ve=0;if(f.canonical.z!==pe.canonical.z){for(const be of le)f.showCentroid(f.featuresOnBorder[be]);if(Te)for(const be of _e)pe.showCentroid(pe.featuresOnBorder[be]);f.borderDoneWithNeighborZ[te]=pe.canonical.z,pe.borderDoneWithNeighborZ[Se]=f.canonical.z}for(const be of le){const Ue=f.featuresOnBorder[be],Ie=f.centroidData[Ue.centroidDataIndex],tt=Ue.borders[te];let We;for(;ve<_e.length;){We=pe.featuresOnBorder[_e[ve]];const rt=We.borders[Se];if(rt[1]>tt[0]+3||rt[0]>tt[0]-3)break;pe.showCentroid(We),ve++}if(We&&ve<_e.length){const rt=ve;let jt=0;for(;!(We.borders[Se][0]>tt[1]-3)&&(jt++,++ve!==_e.length);)We=pe.featuresOnBorder[_e[ve]];We=pe.featuresOnBorder[_e[rt]];let $e=!1;if(jt>=1){const Ge=We.borders[Se];Math.abs(tt[0]-Ge[0])<3&&Math.abs(tt[1]-Ge[1])<3&&(jt=1,$e=!0,ve=rt+1)}else if(jt===0){f.showCentroid(Ue);continue}const Ae=pe.centroidData[We.centroidDataIndex];S&&$e&&(((J=Ie).flags|(se=Ae).flags)&o.e6?(J.flags|=o.e6,se.flags|=o.e6):(J.flags&=~o.e6,se.flags&=~o.e6));const Ke=Ue.intersectsCount()>1||We.intersectsCount()>1;if(jt>1)ve=rt,Ie.centroidXY=Ae.centroidXY=new o.P(0,0);else if(ye&&ye.dem&&!Ke){const Ge=G[te](Ie,Ae),ht=te%2?o.aj-1:0,pt=ee(Ge[0],Math.min(o.aj-1,Ge[1]),ht,ye,de,te<2,Ge[2]);Ie.centroidXY=Ae.centroidXY=C(pt)}else Ke?Ie.centroidXY=Ae.centroidXY=new o.P(0,0):(Ie.centroidXY=f.encodeBorderCentroid(Ue),Ae.centroidXY=pe.encodeBorderCentroid(We));f.writeCentroidToBuffer(Ie),pe.writeCentroidToBuffer(Ae)}else f.showCentroid(Ue)}f.borderDoneWithNeighborZ[te]=pe.canonical.z,pe.borderDoneWithNeighborZ[Se]=f.canonical.z}var J,se;(f.needsCentroidUpdate||!f.centroidVertexBuffer&&f.centroidVertexArray.length!==0)&&f.uploadCentroid(p)}const yy=[1,0,0],US=[0,1,0],$S=[0,0,1];function bm(p,r,c){const f=c.transform,y=c.shadowRenderer;if(!y)return!0;const v=p.toUnwrapped(),S=f.tileSize*y._cascades[c.currentShadowCascade].scale;let N=r;if(f.elevation){const J=f.elevation.getMinMaxForTile(p);J&&(N+=J.max)}const C=[...y.shadowDirection];C[2]=-C[2];const k=y.computeSimplifiedTileShadowVolume(v,N,S,C);if(!k)return!1;const D=[yy,US,$S,C,[C[0],0,C[2]],[0,C[1],C[2]]],U=f.projection.name==="globe",O=f.scaleZoom(S),G=o.cy.fromInvProjectionMatrix(f.invProjMatrix,f.worldSize,O,!U),ee=y.getCurrentCascadeFrustum();return G.intersectsPrecise(k.vertices,k.planes,D)===0||ee.intersectsPrecise(k.vertices,k.planes,D)===0}function wm(p){const{painter:r,source:c,layer:f,coords:y}=p,v=p.defines,S=r.context,N=r.renderPass==="shadow",C=r.renderPass==="light-beam",k=r.shadowRenderer;let D;k&&(D=v.concat(["SHADOWS_SINGLE_CASCADE"]));const U=o.e9(r.transform.center.lat,r.transform.zoom);for(const O of y){const G=c.getTile(O),ee=G.getBucket(f);if(!ee)continue;let J=!1;k&&(J=k.getMaxCascadeForTile(O.toUnwrapped())===0);const se=ee.programConfigurations.get(f.id);let te,le,de=r.translatePosMatrix(O.expandedProjMatrix,G,[0,0],"map");if(de=o.cP(o.bz(),de,[1,1,p.verticalScale]),N&&k){if(bm(G.tileID,ee.maxHeight*U,r))continue;let pe=k.calculateShadowPassMatrixFromTile(G.tileID.toUnwrapped());pe=o.cP(o.bz(),pe,[1,1,p.verticalScale]),le=qv(pe),te=r.getOrCreateProgram("buildingDepth",{config:se,defines:J?D:v,overrideFog:!1})}else if(C)te=r.getOrCreateProgram("buildingBloom",{config:se,defines:J?D:v,overrideFog:!1}),le=ly(de);else{const pe=r.transform.calculatePosMatrix(O.toUnwrapped(),r.transform.worldSize);o.cP(pe,pe,[1,1,p.verticalScale]);const ye=o.bz();o.cP(ye,pe,[1,-1,1/U]),o.bi(ye,ye),o.ea(ye,ye),le=ay(de,ye),te=r.getOrCreateProgram("building",{config:se,defines:J?D:v,overrideFog:!1}),k&&k.setupShadowsFromMatrix(pe,te,!0)}if(r.uploadCommonUniforms(S,te,O.toUnwrapped(),null,null),C){const pe=ee.bloomGeometry;te.draw(r,S.gl.TRIANGLES,p.depthMode,Ss.disabled,p.blendMode,gs.disabled,le,f.id,pe.layoutVertexBuffer,pe.indexBuffer,pe.segmentsBucket,f.paint,r.transform.zoom,se,[pe.layoutAttenuationBuffer,pe.layoutColorBuffer])}else te.draw(r,S.gl.TRIANGLES,p.depthMode,Ss.disabled,p.blendMode,N?gs.disabled:gs.backCW,le,f.id,ee.layoutVertexBuffer,ee.indexBuffer,ee.segments,f.paint,r.transform.zoom,se,[ee.layoutNormalBuffer,ee.layoutColorBuffer])}}function s1(p){return[p[0]*o.eb,p[1]*o.eb,p[2]*o.eb,0]}function Sm(p,r,c,f,y,v,S,N,C){const k=f.getSource(),D=c.globeSharedBuffers;if(!D)return;let U,O,G;if(r&&(U=f.getTile(r)),k instanceof o.aP?(O=k.texture,G=o.dE(0,0,c.transform)):U&&r&&(O=U.texture,G=o.dE(r.canonical.z,r.canonical.x,c.transform)),!O||!G)return;p||(G=o.cP(o.bz(),G,[1,-1,1]));const ee=c.context,J=ee.gl,se=y.paint.get("raster-resampling")==="nearest"?J.NEAREST:J.LINEAR,te=c.colorModeForDrapableLayerRenderPass(v),le=S.defines;le.push("GLOBE_POLES");const de=new Kt(J.LEQUAL,Kt.ReadWrite,c.depthRangeFor3D),pe=Float32Array.from(c.transform.expandedFarZProjMatrix),ye=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),ee.activeTexture.set(J.TEXTURE0),O.bind(se,J.CLAMP_TO_EDGE),ee.activeTexture.set(J.TEXTURE1),O.bind(se,J.CLAMP_TO_EDGE),"useMipmap"in O&&ee.extTextureFilterAnisotropic&&c.transform.pitch>20&&J.texParameterf(J.TEXTURE_2D,ee.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,ee.extTextureFilterAnisotropicMax);const[Se,Te,_e,ve]=r?D.getPoleBuffers(r.canonical.z,!1):D.getPoleBuffers(0,!0),be=y.paint.get("raster-elevation");let Ue;p?(Ue=Se,c.renderDefaultNorthPole=be!==0):(Ue=Te,c.renderDefaultSouthPole=be!==0);const Ie=s1(S.mix),tt=((rt,jt,$e,Ae,Ke,Ge,ht,pt,mt,Pt,ns,us,Wt)=>uy(rt,jt,$e,new Float32Array(16),new Float32Array(9),[0,0],Ae,[0,0],[0,0,0,0],1,{opacity:1,mix:0},Ge,[0,0],pt,2,Pt,ns,us,1,0,Wt))(pe,ye,G,o.ah(c.transform.zoom),0,y,0,be,0,Ie,S.offset,S.range,v),We=c.getOrCreateProgram("raster",{defines:le});c.uploadCommonUniforms(ee,We,null),We.draw(c,J.TRIANGLES,de,C,te,N,tt,y.id,Ue,_e,ve)}function GS(p){const r=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-r,y=.2*p.height,v=r+y;return[r,c,(v-y-r)/f,(v-r)/f]}function HS(p,r,c,f){if(p)return r instanceof xc&&p instanceof ad?r.getTextureDescriptor(p,c,!0):{texture:p.texture,mix:s1(f.mix),offset:f.offset,buffer:0,tileSize:1}}var zo=o.ec([{name:"a_index",type:"Int16",components:1}]);class _y{constructor(r,c,f,y){const v={width:f[0],height:f[1],data:null},S=r.gl;this.targetColorTexture=new o.T(r,v,S.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new o.T(r,v,S.RGBA8,{useMipmap:!1}),this.context=r,this.updateParticleTexture(c,y),this.lastInvalidatedAt=0}updateParticleTexture(r,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const f=this.context.gl,y=c.width*c.height;this.particleTexture0=new o.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new o.T(this.context,c,f.RGBA8,{premultiply:!1,useMipmap:!1});const v=new o.ed;v.reserve(y);for(let S=0;S<y;S++)v.emplaceBack(S);this.particleIndexBuffer=this.context.createVertexBuffer(v,zo.members,!0),this.particleSegment=o.bd.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(r){return!(this.lastInvalidatedAt<r&&(this.lastInvalidatedAt=o.q.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function fo(p,r,c){if(!p)return null;const f=r.getTextureDescriptor(p,c,!0);if(!f)return null;let{texture:y,mix:v,offset:S,tileSize:N,buffer:C,format:k}=f;if(!y||!k)return null;let D=!1;return k==="uint32"&&(D=!0,v[3]=0,v=mm(o.ee,v,[0,c.paint.get("raster-particle-max-speed")]),S=Nc(o.ee,S,[0,c.paint.get("raster-particle-max-speed")])),{texture:y,textureOffset:[C/(N+2*C),N/(N+2*C)],tileSize:N,scalarData:D,scale:v,offset:S,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[k]]}}function Mc(p){const r=p._nearZ,c=p.projection.farthestPixelDistance(p),f=c-r,y=.2*p.height,v=r+y;return[r,c,(v-y-r)/f,(v-r)/f]}const n1=new o.am(1,0,0,1),vy=new o.am(0,1,0,1),by=new o.am(0,0,1,1),wy=new o.am(1,0,1,1),r1=new o.am(0,1,1,1);function fl(p,r,c,f,y,v){for(let S=0;S<c.length;S++)if(y){const k=new o.am(f.r*.8,f.g*.8,f.b*.8,1);Mn(p,r,c[S],f,-1,-1,v),Mn(p,r,c[S],f,-1,1,v),Mn(p,r,c[S],f,1,1,v),Mn(p,r,c[S],f,1,-1,v),Mn(p,r,c[S],k,0,0,v)}else Mn(p,r,c[S],f,0,0,v)}function Mn(p,r,c,f,y,v,S){const N=p.context,C=p.transform,k=N.gl,D=C.projection.name==="globe",U=D?["PROJECTION_GLOBE_VIEW"]:[];let O=o.bw(c.projMatrix);if(D&&o.ah(C.zoom)>0){const Ie=o.bg(c.canonical,C),tt=o.ef(Ie);O=o.az(new Float32Array(16),C.globeMatrix,tt),o.az(O,C.projMatrix,O)}const G=o.bz();G[12]+=2*y/(o.q.devicePixelRatio*C.width),G[13]+=2*v/(o.q.devicePixelRatio*C.height),o.az(O,G,O);const ee=p.getOrCreateProgram("debug",{defines:U}),J=r.getTileByID(c.key);p.terrain&&p.terrain.setupElevationDraw(J,ee);const se=Kt.disabled,te=Ss.disabled,le=p.colorModeForRenderPass(),de="$debug";N.activeTexture.set(k.TEXTURE0),p.emptyTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),D?J._makeGlobeTileDebugBuffers(p.context,C):J._makeDebugTileBoundsBuffers(p.context,C.projection);const pe=J._tileDebugBuffer||p.debugBuffer,ye=J._tileDebugIndexBuffer||p.debugIndexBuffer,Se=J._tileDebugSegments||p.debugSegments;if(ee.draw(p,k.LINE_STRIP,se,te,le,gs.disabled,cy(O,f.toPremultipliedRenderColor(null)),de,pe,ye,Se,null,null,null,[J._globeTileDebugBorderBuffer]),S){const Ie=J.latestRawTileData,tt=Math.floor((Ie&&Ie.byteLength||0)/1024);let We=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(We+=` => ${c.overscaledZ}`),We+=` ${J.state}`,We+=` ${tt}kb`,function(rt,jt){rt.initDebugOverlayCanvas();const $e=rt.debugOverlayCanvas,Ae=rt.context.gl,Ke=rt.debugOverlayCanvas.getContext("2d");Ke.clearRect(0,0,$e.width,$e.height),Ke.shadowColor="white",Ke.shadowBlur=2,Ke.lineWidth=1.5,Ke.strokeStyle="white",Ke.textBaseline="top",Ke.font="bold 36px Open Sans, sans-serif",Ke.fillText(jt,5,5),Ke.strokeText(jt,5,5),rt.debugOverlayTexture.update($e),rt.debugOverlayTexture.bind(Ae.LINEAR,Ae.CLAMP_TO_EDGE)}(p,We)}const Te=r.getTile(c).tileSize,_e=512/Math.min(Te,512)*(c.overscaledZ/C.zoom)*.5,ve=J._tileDebugTextBuffer||p.debugBuffer,be=J._tileDebugTextIndexBuffer||p.quadTriangleIndexBuffer,Ue=J._tileDebugTextSegments||p.debugSegments;ee.draw(p,k.TRIANGLES,se,te,Fs.alphaBlended,gs.disabled,cy(O,o.am.transparent.toPremultipliedRenderColor(null),_e),de,ve,be,Ue,null,null,null,[J._globeTileDebugTextBuffer])}function wp(p,r,c,f){Sp(p,0,r+c/2,p.transform.width,c,f)}function jm(p,r,c,f){Sp(p,r-c/2,0,c,p.transform.height,f)}function Sp(p,r,c,f,y,v){const S=p.context,N=S.gl;N.enable(N.SCISSOR_TEST),N.scissor(r*o.q.devicePixelRatio,c*o.q.devicePixelRatio,f*o.q.devicePixelRatio,y*o.q.devicePixelRatio),S.clear({color:v}),N.disable(N.SCISSOR_TEST)}const i1=o.ec([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:o1}=i1;function Rc(p,r,c,f){p.emplaceBack(r,c,f)}class Cu{constructor(r){this.vertexArray=new o.eg,this.indices=new o.a_,Rc(this.vertexArray,-1,-1,1),Rc(this.vertexArray,1,-1,1),Rc(this.vertexArray,-1,1,1),Rc(this.vertexArray,1,1,1),Rc(this.vertexArray,-1,-1,-1),Rc(this.vertexArray,1,-1,-1),Rc(this.vertexArray,-1,1,-1),Rc(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=r.createVertexBuffer(this.vertexArray,o1),this.indexBuffer=r.createIndexBuffer(this.indices),this.segment=o.bd.simpleSegment(0,0,36,12)}}function Wa(p,r,c,f,y,v){const S=p.context.gl,N=r.paint.get("sky-atmosphere-color"),C=r.paint.get("sky-atmosphere-halo-color"),k=r.paint.get("sky-atmosphere-sun-intensity"),D=((U,O,G,ee,J)=>({u_matrix_3f:U,u_sun_direction:O,u_sun_intensity:G,u_color_tint_r:[ee.r,ee.g,ee.b,ee.a],u_color_tint_m:[J.r,J.g,J.b,J.a],u_luminance:5e-5}))(o.ei(o.dJ(),f),y,k,N.toPremultipliedRenderColor(null),C.toPremultipliedRenderColor(null));S.framebufferTexture2D(S.FRAMEBUFFER,S.COLOR_ATTACHMENT0,S.TEXTURE_CUBE_MAP_POSITIVE_X+v,r.skyboxTexture,0),c.draw(p,S.TRIANGLES,Kt.disabled,Ss.disabled,Fs.unblended,gs.frontCW,D,"skyboxCapture",r.skyboxGeometry.vertexBuffer,r.skyboxGeometry.indexBuffer,r.skyboxGeometry.segment)}const Nt=o.ec([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class Gt{constructor(r){const c=new o.ej;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const f=new o.a_;f.emplaceBack(0,1,2),f.emplaceBack(2,3,0),this.vertexBuffer=r.createVertexBuffer(c,Nt.members),this.indexBuffer=r.createIndexBuffer(f),this.segments=o.bd.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const Cd=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Er{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class Oe{constructor(r){this.colorModeAlphaBlendedWriteRGB=new Fs([1,_u,1,_u],o.am.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new Fs([1,0,1,0],o.am.transparent,[!1,!1,!1,!0]),this.params=new Er,this.updateNeeded=!0,r.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),r.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0}),r.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},()=>{this.updateNeeded=!0})}update(r){const c=r.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new Gt(c);const f=this.params.sizeRange,y=this.params.intensityRange,v=function(D){const U=o.el(30),O=[];for(let G=0;G<D;++G){const ee=2*Math.PI*U(),J=Math.acos(1-2*U())-.5*Math.PI;O.push(o.d2(Math.cos(J)*Math.cos(ee),Math.cos(J)*Math.sin(ee),Math.sin(J)))}return O}(this.params.starsCount),S=o.el(300),N=new o.ek,C=new o.a_;let k=0;for(let D=0;D<v.length;++D){const U=o.c1([],v[D],200),O=Math.max(0,1+.01*f*(1*S()-.5)),G=Math.max(0,1+.01*y*(1*S()-.5));N.emplaceBack(U[0],U[1],U[2],-1,-1,O,G),N.emplaceBack(U[0],U[1],U[2],1,-1,O,G),N.emplaceBack(U[0],U[1],U[2],1,1,O,G),N.emplaceBack(U[0],U[1],U[2],-1,1,O,G),C.emplaceBack(k+0,k+1,k+2),C.emplaceBack(k+0,k+2,k+3),k+=4}this.starsVx=c.createVertexBuffer(N,Cd.members),this.starsIdx=c.createIndexBuffer(C),this.starsSegments=o.bd.simpleSegment(0,0,N.length,C.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(r,c){const f=r.context,y=f.gl,v=r.transform,S=new Kt(y.LEQUAL,Kt.ReadOnly,[0,1]),N=o.ah(v.zoom),C=r.style.getLut(c.scope),k=c.properties.get("color-use-theme")==="none",D=c.properties.get("color").toNonPremultipliedRenderColor(k?null:C).toArray01(),U=c.properties.get("high-color-use-theme")==="none",O=c.properties.get("high-color").toNonPremultipliedRenderColor(U?null:C).toArray01(),G=c.properties.get("space-color-use-theme")==="none",ee=c.properties.get("space-color").toNonPremultipliedRenderColor(G?null:C).toArray01(),J=5e-4,se=o.em(c.properties.get("horizon-blend"),0,1,J,.25),te=o.dy(r,f,v)&&se===J?v.worldSize/(2*Math.PI*1.025)-1:v.globeRadius,le=r.frameCounter/1e3%1,de=o.ae(v.globeCenterInViewSpace),pe=Math.sqrt(Math.pow(de,2)-Math.pow(te,2)),ye=Math.acos(pe/de),Se=Te=>{const _e=v.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&_e.push("ALPHA_PASS");const ve=r.getOrCreateProgram("globeAtmosphere",{defines:_e}),be=((Ie,tt,We,rt,jt,$e,Ae,Ke,Ge,ht,pt,mt)=>({u_frustum_tl:Ie,u_frustum_tr:tt,u_frustum_br:We,u_frustum_bl:rt,u_horizon:jt,u_transition:$e,u_fadeout_range:Ae,u_color:Ke,u_high_color:Ge,u_space_color:ht,u_temporal_offset:pt,u_horizon_angle:mt}))(v.frustumCorners.TL,v.frustumCorners.TR,v.frustumCorners.BR,v.frustumCorners.BL,v.frustumCorners.horizon,N,se,D,O,ee,le,ye);r.uploadCommonUniforms(f,ve);const Ue=this.atmosphereBuffer;Ue&&ve.draw(r,y.TRIANGLES,S,Ss.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,gs.backCW,be,Te?"atmosphere_glow_alpha":"atmosphere_glow",Ue.vertexBuffer,Ue.indexBuffer,Ue.segments)};Se(!1),Se(!0)}drawStars(r,c){const f=o.ay(c.properties.get("star-intensity"),0,1);if(f===0)return;const y=r.context,v=y.gl,S=r.transform,N=r.getOrCreateProgram("stars"),C=o.c3([]);o.c5(C,C,-S._pitch),o.c4(C,C,-S.angle),o.c5(C,C,o.al(S._center.lat)),o.en(C,C,-o.al(S._center.lng));const k=o.c8(new Float32Array(16),C),D=o.az([],S.starsProjMatrix,k),U=o.ei([],k),O=o.eo([],U),G=[0,1,0];o.dL(G,G,O),o.c1(G,G,this.params.sizeMultiplier);const ee=[1,0,0];o.dL(ee,ee,O),o.c1(ee,ee,this.params.sizeMultiplier);const J=(se=G,te=ee,le=f,{u_matrix:Float32Array.from(D),u_up:se,u_right:te,u_intensity_multiplier:le});var se,te,le;r.uploadCommonUniforms(y,N),this.starsVx&&this.starsIdx&&N.draw(r,v.TRIANGLES,Kt.disabled,Ss.disabled,this.colorModeAlphaBlendedWriteRGB,gs.disabled,J,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class a1{constructor(){this.visibleTiles=[]}updateBorders(r,c){const f=[],y=[],v=r._getRenderableCoordinates(!1,!0);for(const C of v){const k=r.getTile(C);if(!k.hasData())continue;const D=k.getBucket(c);D&&(D.isEmpty()||(f.push(C.key),y.push({bucket:D,tileID:C.canonical})))}let S=f.length!==this.visibleTiles.length;if(!S){f.sort();for(let C=0;C<f.length;C++)if(f[C]!==this.visibleTiles[C]){S=!0;break}}if(!S)return;const N=new Set;this.visibleTiles=f,y.sort((C,k)=>C.tileID.z-k.tileID.z||C.tileID.x-k.tileID.x||C.tileID.y-k.tileID.y);for(const C of y){const k=new Array,D=new Array,U=C.bucket;for(const O of U.featuresOnBorder)N.has(O.featureId)?D.push(O.footprintIndex):(N.add(O.featureId),k.push(O.footprintIndex));U.updateFootprintHiddenFlags(k,o.ep,!1),U.updateFootprintHiddenFlags(D,o.ep,!0)}}}function jp(p,r){const c=[...p],f=r.cameraWorldSizeForFog/r.worldSize,y=o.bx([]);return o.cP(y,y,[f,f,1]),o.az(c,y,c),o.az(c,r.worldToFogMatrix,c),c}function Tp(p,r,c,f,y){const v=c.material,S=f.context,{baseColorTexture:N,metallicRoughnessTexture:C}=v.pbrMetallicRoughness,{normalTexture:k,occlusionTexture:D,emissionTexture:U}=v;function O(ee,J,se){if(ee&&(p.push(J),S.activeTexture.set(S.gl.TEXTURE0+se),ee.gfxTexture)){const{minFilter:te,magFilter:le,wrapS:de,wrapT:pe}=ee.sampler;ee.gfxTexture.bindExtraParam(te,le,de,pe)}}O(N,"HAS_TEXTURE_u_baseColorTexture",po.BaseColor),O(C,"HAS_TEXTURE_u_metallicRoughnessTexture",po.MetallicRoughness),O(k,"HAS_TEXTURE_u_normalTexture",po.Normal),O(D,"HAS_TEXTURE_u_occlusionTexture",po.Occlusion),O(U,"HAS_TEXTURE_u_emissionTexture",po.Emission),y&&(y.texture||(y.texture=new o.et(f.context,y.image,[y.image.height,y.image.height,y.image.height],S.gl.RGBA8)),S.activeTexture.set(S.gl.TEXTURE0+po.LUT),y.texture&&y.texture.bind(S.gl.LINEAR,S.gl.CLAMP_TO_EDGE),p.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(p.push("HAS_ATTRIBUTE_a_uv_2f"),r.push(c.texcoordBuffer)),c.colorBuffer&&(p.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),r.push(c.colorBuffer)),c.normalBuffer&&(p.push("HAS_ATTRIBUTE_a_normal_3f"),r.push(c.normalBuffer)),c.pbrBuffer&&(p.push("HAS_ATTRIBUTE_a_pbr"),p.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),r.push(c.pbrBuffer)),v.alphaMode!=="OPAQUE"&&v.alphaMode!=="MASK"||p.push("UNPREMULT_TEXTURE_IN_SHADER"),v.defined||p.push("DIFFUSE_SHADED");const G=f.shadowRenderer;G&&(p.push("RENDER_SHADOWS","DEPTH_TEXTURE"),G.useNormalOffset&&p.push("NORMAL_OFFSET"))}function Ad(p,r,c,f,y,v){const S=c.paint.get("model-opacity").constantOr(1),N=r.context,C=new Kt(r.context.gl.LEQUAL,Kt.ReadWrite,r.depthRangeFor3D),k=r.transform,D=p.mesh,U=D.material,O=U.pbrMetallicRoughness,G=r.style.fog;let ee;ee=r.transform.projection.zAxisUnit==="pixels"?[...p.nodeModelMatrix]:o.az([],f.zScaleMatrix,p.nodeModelMatrix),o.az(ee,f.negCameraPosMatrix,ee);const J=o.bi([],ee);o.ea(J,J);const se=c.paint.get("model-color-use-theme").constantOr("default")==="none",te=c.paint.get("model-emissive-strength").constantOr(0),le=hy(new Float32Array(p.worldViewProjection),new Float32Array(ee),new Float32Array(J),null,r,S,O.baseColorFactor,U.emissiveFactor,O.metallicFactor,O.roughnessFactor,U,te,c),de={defines:[]},pe=[],ye=r.shadowRenderer;ye&&(ye.useNormalOffset=!1),Tp(de.defines,pe,D,r,se?null:c.lut);let Se=null;if(G){const ve=jp(p.nodeModelMatrix,r.transform);if(Se=new Float32Array(ve),k.projection.name!=="globe"){const be=D.aabb.min,Ue=D.aabb.max,[Ie,tt]=G.getOpacityForBounds(ve,be[0],be[1],Ue[0],Ue[1]);de.overrideFog=Ie>=ut||tt>=ut}}const Te=pl(r,c.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&de.defines.push("RENDER_CUTOFF");const _e=r.getOrCreateProgram("model",de);r.uploadCommonUniforms(N,_e,null,Se,Te),r.renderPass!=="shadow"&&ye&&ye.setupShadowsFromMatrix(p.nodeModelMatrix,_e),_e.draw(r,N.gl.TRIANGLES,C,y,v,D.material.doubleSided?gs.disabled:gs.backCCW,le,c.id,D.vertexBuffer,D.indexBuffer,D.segments,c.paint,r.transform.zoom,void 0,pe)}function Sy(p,r,c,f,y,v,S){let N;N=p.projection.name==="globe"?o.er(c,p):[...c],o.az(N,N,r.matrix);const C=o.az([],f,N);if(r.meshes)for(const k of r.meshes){if(k.material.alphaMode!=="BLEND"){S.push({mesh:k,depth:0,modelIndex:y,worldViewProjection:C,nodeModelMatrix:N});continue}const D=o.ad([],k.centroid,C);!p.isOrthographic&&D[2]<=0||v.push({mesh:k,depth:D[2],modelIndex:y,worldViewProjection:C,nodeModelMatrix:N})}if(r.children)for(const k of r.children)Sy(p,k,c,f,y,v,S)}function Tm(p,r,c,f){const y=c.shadowRenderer;if(!y)return;const v=y.getShadowPassDepthMode(),S=y.getShadowPassColorMode(),N=y.calculateShadowPassMatrixFromMatrix(r),C=Qv(N);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,v,Ss.disabled,S,gs.backCCW,C,f.id,p.vertexBuffer,p.indexBuffer,p.segments,f.paint,c.transform.zoom,void 0,void 0)}function Pd(p,r,c){const f=r.updateZoomBasedPaintProperties(),y=function(v,S,N){let C,k,D,U=v.terrain?v.terrain.exaggeration():0;if(v.terrain&&U>0){const O=v.terrain,G=O.findDEMTileFor(N);G&&G.dem?C=o.eu.create(O,N,G):U=0}if(U===0&&(S.terrainElevationMin=0,S.terrainElevationMax=0),U===S.validForExaggeration&&(U===0||C&&C._demTile&&C._demTile.tileID===S.validForDEMTile.id&&C._dem._timestamp===S.validForDEMTile.timestamp))return!1;for(const O in S.instancesPerModel){const G=S.instancesPerModel[O];for(let ee=0;ee<G.instancedDataArray.length;++ee){const J=(C?U*C.getElevationAt(0|G.instancedDataArray.float32[16*ee],0|G.instancedDataArray.float32[16*ee+1],!0,!0):0)+G.instancesEvaluatedElevation[ee];G.instancedDataArray.float32[16*ee+6]=J,k=k?Math.min(S.terrainElevationMin,J):J,D=D?Math.max(S.terrainElevationMax,J):J}}return S.terrainElevationMin=k||0,S.terrainElevationMax=D||0,S.validForExaggeration=U,S.validForDEMTile=C&&C._demTile?{id:C._demTile.tileID,timestamp:C._dem._timestamp}:{id:void 0,timestamp:0},!0}(p,r,c);(f||y)&&(r.uploaded=!1,r.upload(p.context))}const ml={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new o.d6([0,0,0],[o.aj,o.aj,0])};function WS(p,r){const c=1<<p.canonical.z,f=r.getFreeCameraOptions().position,y=r.elevation,v=p.canonical.x/c,S=(p.canonical.x+1)/c,N=p.canonical.y/c,C=(p.canonical.y+1)/c;let k=r._centerAltitude;if(y){const G=y.getMinMaxForTile(p);G&&G.max>k&&(k=G.max)}const D=o.ay(f.x,v,S)-f.x,U=o.ay(f.y,N,C)-f.y,O=o.cb(k,r.center.lat)-f.z;return r._zoomFromMercatorZ(Math.sqrt(D*D+U*U+O*O))}function jy(p,r,c,f,y,v,S){const N=p.context,C=p.renderPass==="shadow",k=p.shadowRenderer,D=C&&k?k.getShadowPassDepthMode():new Kt(N.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D),U=p.isTileAffectedByFog(v);if(c.meshes)for(const O of c.meshes){const G=["MODEL_POSITION_ON_GPU"],ee=[];let J,se,te;f.instancedDataArray.length>20&&G.push("INSTANCED_ARRAYS");const le=pl(p,r.paint.get("model-cutoff-fade-range"));if(le.shouldRenderCutoff&&G.push("RENDER_CUTOFF"),C&&k)J=p.getOrCreateProgram("modelDepth",{defines:G}),se=Qv(S.shadowTileMatrix,S.shadowTileMatrix,Float32Array.from(c.matrix)),te=k.getShadowPassColorMode();else{Tp(G,ee,O,p,r.paint.get("model-color-use-theme").constantOr("default")==="none"?null:r.lut),J=p.getOrCreateProgram("model",{defines:G,overrideFog:U});const pe=O.material,ye=pe.pbrMetallicRoughness,Se=r.paint.get("model-opacity").constantOr(1),Te=r.paint.get("model-emissive-strength").constantOr(0);se=hy(v.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,p,Se,ye.baseColorFactor,pe.emissiveFactor,ye.metallicFactor,ye.roughnessFactor,pe,Te,r,y),k&&(S.shadowUniformsInitialized?J.setShadowUniformValues(N,k.getShadowUniformValues()):(k.setupShadows(v.toUnwrapped(),J,"model-tile"),S.shadowUniformsInitialized=!0)),te=le.shouldRenderCutoff||Se<1||pe.alphaMode!=="OPAQUE"?Fs.alphaBlended:Fs.unblended}p.uploadCommonUniforms(N,J,v.toUnwrapped(),null,le);const de=O.material.doubleSided?gs.disabled:gs.backCCW;if(f.instancedDataArray.length>20)ee.push(f.instancedDataBuffer),J.draw(p,N.gl.TRIANGLES,D,Ss.disabled,te,de,se,r.id,O.vertexBuffer,O.indexBuffer,O.segments,r.paint,p.transform.zoom,void 0,ee,f.instancedDataArray.length);else{const pe=C?"u_instance":"u_normal_matrix";for(let ye=0;ye<f.instancedDataArray.length;++ye)se[pe]=new Float32Array(f.instancedDataArray.arrayBuffer,64*ye,16),J.draw(p,N.gl.TRIANGLES,D,Ss.disabled,te,de,se,r.id,O.vertexBuffer,O.indexBuffer,O.segments,r.paint,p.transform.zoom,void 0,ee)}}if(c.children)for(const O of c.children)jy(p,r,O,f,y,v,S)}const Nm=[1,-1,1];function Ty(p,r,c,f){if(!c.modelManager)return!0;const y=c.modelManager;if(!c.shadowRenderer)return!0;const v=c.shadowRenderer,S=r.aabb;let N=!0,C=p.maxHeight;if(C===0){let D=0;for(const U in p.instancesPerModel){const O=y.getModel(U,f);O?D=Math.max(D,Math.max(Math.max(O.aabb.max[0],O.aabb.max[1]),O.aabb.max[2])):N=!1}C=p.maxScale*D*1.41+p.maxVerticalOffset,N&&(p.maxHeight=C)}S.max[2]=C,S.min[2]+=p.terrainElevationMin,S.max[2]+=p.terrainElevationMax,o.ad(S.min,S.min,r.tileMatrix),o.ad(S.max,S.max,r.tileMatrix);const k=S.intersects(v.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(p.isInsideFirstShadowMapFrustum=k===2),k===0}function l1(p,r){const c=p.uniformValues.u_cutoff_params[0],f=p.uniformValues.u_cutoff_params[1],y=p.uniformValues.u_cutoff_params[2],v=p.uniformValues.u_cutoff_params[3];return f===c||v===y?1:o.ay(((r-c)/(f-c)-y)/(v-y),0,1)}function c1(p,r,c,f){if(r.pitch<20)return 1;const y=r.getWorldToCameraMatrix();o.az(y,y,p);const v=o.bR(c.min[0],c.min[1],c.min[2],1);let S=o.aA(o.ev(),v,y),N=S,C=S;v[1]=c.max[1],S=o.aA(o.ev(),v,y),N=S[1]<N[1]?S:N,C=S[1]>C[1]?S:C,v[0]=c.max[0],S=o.aA(o.ev(),v,y),N=S[1]<N[1]?S:N,C=S[1]>C[1]?S:C,v[1]=c.min[1],S=o.aA(o.ev(),v,y),N=S[1]<N[1]?S:N,C=S[1]>C[1]?S:C;const k=o.ay(f[0],0,1),D=100*r.pixelsPerMeter*o.ay(f[1],0,1),U=o.ay(f[2],0,1),O=o.ew(o.ev(),N,C,k),G=Math.tan(.5*r.fovX),ee=-O[2]*G;if(D===0)return O[1]<-Math.abs(ee)?U:1;const J=(-Math.abs(ee)-O[1])/D,se=(le,de,pe)=>(1-pe)*le+pe*de,te=o.ay(se(1,U,J),U,1);return se(1,te,o.ay((r.pitch-20)/20,0,1))}class Em{}class Np{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(r,c,f){{const U=this._storage.get(c.id);if(U)return U.lastUsedFrameIdx=r,U.buf}const y=f.gl,v=y.getBufferParameter(y.ELEMENT_ARRAY_BUFFER,y.BUFFER_SIZE),S=new ArrayBuffer(v),N=new Int16Array(S);y.getBufferSubData(y.ELEMENT_ARRAY_BUFFER,0,new Int16Array(S));const C=new o.ey;for(let U=0;U<v/2;U+=3){const O=N[U],G=N[U+1],ee=N[U+2];C.emplaceBack(O,G),C.emplaceBack(G,ee),C.emplaceBack(ee,O)}const k=f.bindVertexArrayOES.current,D=new Em;return D.buf=new Ac(f,C),D.lastUsedFrameIdx=r,this._storage.set(c.id,D),f.bindVertexArrayOES.set(k),D.buf}update(r){for(const[c,f]of this._storage)r-f.lastUsedFrameIdx>30&&(f.buf.destroy(),this._storage.delete(c))}destroy(){for(const[r,c]of this._storage)c.buf.destroy(),this._storage.delete(r)}}class Id{constructor(r){this.occluderSize=30,this.depthOffset=-1e-4,r.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),r.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const u1=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class qS{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class eo{constructor(r,c){this.revealStart=11,this.revealRange=2,r.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),r.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const ZS=o.ec([{type:"Float32",name:"a_pos_2f",components:2}]);class Ep{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(r,c){const f=r.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const S=new o.ez,N=new o.a_;S.emplaceBack(-1,-1),S.emplaceBack(1,-1),S.emplaceBack(1,1),S.emplaceBack(-1,1),N.emplaceBack(0,1,2),N.emplaceBack(0,2,3),this.vignetteVx=r.context.createVertexBuffer(S,ZS.members),this.vignetteIdx=r.context.createIndexBuffer(N)}const y=o.bd.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){r.uploadCommonUniforms(r.context,f);const S={u_vignetteShape:(v={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:v.vignetteColor};f.draw(r,r.context.gl.TRIANGLES,Kt.disabled,Ss.disabled,Fs.alphaBlended,gs.disabled,S,"vignette",this.vignetteVx,this.vignetteIdx,y)}var v}}class or{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(r,c){const f=r.getFreeCameraOptions().position,y=f.toAltitude(),v=f.toLngLat(),S=o.al(v.lng),N=o.al(v.lat),C=r.pixelsPerMeter/c,k=S*o.eB,D=o.eB*Math.log(Math.tan(Math.PI/4+N/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const U=-this._offsetYPrev+D,O=-this._elevationPrev+y;this._accumulatedOffsetX+=(-this._offsetXPrev+k)*C,this._accumulatedOffsetY+=U*C,this._accumulatedElevation+=O*C,this._offsetXPrev=k,this._offsetYPrev=D,this._elevationPrev=y}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function ln(p,r){return[-(p[0]-Math.floor(p[0]/r)*r),-(p[1]-Math.floor(p[1]/r)*r),-(p[2]-Math.floor(p[2]/r)*r)]}function Ny(p){const r=o.el(1323123451230),c=[];for(let f=0;f<p;++f){const y=2*r()-1,v=2*r()-1,S=2*r()-1;c.push(o.d2(y,v,S))}return c}function Po(p,r,c,f,y){const v=o.ay((y-c)/(f-c),0,1);return(1-v)*p+v*r}class Md{constructor(r){this._movement=new or,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new Ep,this._ppmScaleFactor=r}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(r,c){const f=r.transform;this._movement.update(f,this._ppmScaleFactor);const y=f.starsProjMatrix,v=o.c3([]);o.c5(v,v,o.al(90)-f._pitch),o.c4(v,v,-f.angle);const S=o.c8(new Float32Array(16),v),N=o.eA(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),C=o.ea([],N),k=o.az([],C,S),D=Date.now()/1e3;return this._accumulatedTimeFromStart+=(D-this._prevTime)*c,this._prevTime=D,{projectionMatrix:y,modelviewMatrix:k}}}class Rd extends Md{constructor(r){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new eo(r.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const f=Ny(this.particlesCount),y=new o.eC,v=new o.a_;let S=0;const N=o.el(1323123451230);for(let C=0;C<f.length;++C){const k=f[C],D=[2*N()-1,N(),N(),N()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...D),y.emplaceBack(k[0],k[1],k[2],1,-1,...D),y.emplaceBack(k[0],k[1],k[2],1,1,...D),y.emplaceBack(k[0],k[1],k[2],-1,1,...D),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=c.createVertexBuffer(y,u1.members),this.particlesIdx=c.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},f=r.transform.zoom;if(c.revealStart>f)return;const y=Po(0,1,c.revealStart,c.revealStart+c.revealRange,f);if(!this.particlesVx||!this.particlesIdx)return;const v=structuredClone(this._params);let S=[-v.direction.x,v.direction.y,-100];o.au(S,S);const N=structuredClone(this._vignetteParams);N.strength*=y,v.overrideStyleParameters||(v.intensity=r.style.rain.state.density,v.timeFactor=r.style.rain.state.intensity,v.color=structuredClone(r.style.rain.state.color),S=structuredClone(r.style.rain.state.direction),v.screenThinning.intensity=r.style.rain.state.centerThinning,v.dropletSizeX=r.style.rain.state.dropletSize[0],v.dropletSizeYScale=r.style.rain.state.dropletSize[1]/r.style.rain.state.dropletSize[0],v.distortionStrength=100*r.style.rain.state.distortionStrength,N.strength=1,N.color=structuredClone(r.style.rain.state.vignetteColor));const C=this.updateOnRender(r,v.timeFactor),k=r.context,D=k.gl,U=r.transform;this.screenTexture&&this.screenTexture.size[0]===r.width&&this.screenTexture.size[1]===r.height||(this.screenTexture=new o.T(k,{width:r.width,height:r.height,data:null},D.RGBA8)),v.distortionStrength>0&&(k.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE),D.copyTexSubImage2D(D.TEXTURE_2D,0,0,0,0,0,r.width,r.height));const O=r.getOrCreateProgram("rainParticle");r.uploadCommonUniforms(k,O),k.activeTexture.set(D.TEXTURE0),this.screenTexture.bind(D.LINEAR,D.CLAMP_TO_EDGE);const G=[v.color.r,v.color.g,v.color.b,v.color.a],ee=(J,se)=>{const te=ln(this._movement.getPosition(),J),le=v.dropletSizeX,de=v.dropletSizeX*v.dropletSizeYScale,pe=r.width/2,ye=r.height/2,Se=Po(0,v.screenThinning.start,0,1,v.screenThinning.intensity),Te=Po(.001,v.screenThinning.range,0,1,v.screenThinning.intensity),_e=Po(0,v.screenThinning.particleOffset,0,1,v.screenThinning.intensity),ve=(be={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:te,velocityConeAperture:v.velocityConeAperture,velocity:v.velocity,boxSize:J,rainDropletSize:[le,de],distortionStrength:v.distortionStrength,rainDirection:S,color:G,screenSize:[U.width,U.height],thinningCenterPos:[pe,ye],thinningShape:[Se,Te,Math.pow(10,v.screenThinning.fadePower)],thinningAffectedRatio:v.screenThinning.affectedRatio,thinningParticleOffset:_e,shapeDirectionalPower:v.shapeDirPower,shapeNormalPower:v.shapeNormalPower,mode:se?0:1},{u_modelview:Float32Array.from(be.modelview),u_projection:Float32Array.from(be.projection),u_time:be.time,u_cam_pos:be.camPos,u_texScreen:0,u_velocityConeAperture:be.velocityConeAperture,u_velocity:be.velocity,u_boxSize:be.boxSize,u_rainDropletSize:be.rainDropletSize,u_distortionStrength:be.distortionStrength,u_rainDirection:be.rainDirection,u_color:be.color,u_screenSize:be.screenSize,u_thinningCenterPos:be.thinningCenterPos,u_thinningShape:be.thinningShape,u_thinningAffectedRatio:be.thinningAffectedRatio,u_thinningParticleOffset:be.thinningParticleOffset,u_shapeDirectionalPower:be.shapeDirectionalPower,u_shapeNormalPower:be.shapeNormalPower,u_mode:be.mode});var be;const Ue=Math.round(v.intensity*this.particlesCount),Ie=o.bd.simpleSegment(0,0,4*Ue,2*Ue);O.draw(r,D.TRIANGLES,Kt.disabled,Ss.disabled,Fs.alphaBlended,gs.disabled,ve,"rain_particles",this.particlesVx,this.particlesIdx,Ie)};v.distortionStrength>0&&ee(v.boxSize,!0),ee(v.boxSize,!1),this._vignette.draw(r,N)}}const Au=o.ec([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ey extends Md{constructor(r){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new eo(r.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(r){const c=r.context;if(!this.particlesVx){const f=Ny(this.particlesCount),y=new o.eD,v=new o.a_;let S=0;const N=o.el(1323123451230);for(let C=0;C<f.length;++C){const k=f[C],D=N(),U=N(),O=N(),G=[C/f.length,D,U,O],ee=[N(),N()];y.emplaceBack(k[0],k[1],k[2],-1,-1,...G,...ee),y.emplaceBack(k[0],k[1],k[2],1,-1,...G,...ee),y.emplaceBack(k[0],k[1],k[2],1,1,...G,...ee),y.emplaceBack(k[0],k[1],k[2],-1,1,...G,...ee),v.emplaceBack(S+0,S+1,S+2),v.emplaceBack(S+0,S+2,S+3),S+=4}this.particlesVx=c.createVertexBuffer(y,Au.members),this.particlesIdx=c.createIndexBuffer(v)}}draw(r){if(!this._params.overrideStyleParameters&&!r.style.snow)return;const c=structuredClone(this._params);let f=[-c.direction.x,c.direction.y,-100];o.au(f,f);const y=structuredClone(this._vignetteParams),v=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},S=r.transform.zoom;if(v.revealStart>S)return;const N=Po(0,1,v.revealStart,v.revealStart+v.revealRange,S);y.strength*=N,c.overrideStyleParameters||(c.intensity=r.style.snow.state.density,c.timeFactor=r.style.snow.state.intensity,c.color=structuredClone(r.style.snow.state.color),f=structuredClone(r.style.snow.state.direction),c.screenThinning.intensity=r.style.snow.state.centerThinning,c.billboardSize=2.79*r.style.snow.state.flakeSize,y.strength=1,y.color=structuredClone(r.style.snow.state.vignetteColor));const C=this.updateOnRender(r,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const k=r.context,D=k.gl,U=r.transform,O=r.getOrCreateProgram("snowParticle");r.uploadCommonUniforms(k,O),((G,ee,J)=>{const se=ln(this._movement.getPosition(),G),te=U.width/2,le=U.height/2,de=Po(0,J.screenThinning.start,0,1,J.screenThinning.intensity),pe=Po(.001,J.screenThinning.range,0,1,J.screenThinning.intensity),ye=Po(0,J.screenThinning.particleOffset,0,1,J.screenThinning.intensity),Se=(Te={modelview:C.modelviewMatrix,projection:C.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:se,velocityConeAperture:J.velocityConeAperture,velocity:J.velocity,horizontalOscillationRadius:J.horizontalOscillationRadius,horizontalOscillationRate:J.horizontalOscillationRate,boxSize:G,billboardSize:1*J.billboardSize,simpleShapeParameters:[J.shapeFadeStart,J.shapeFadePower],screenSize:[U.width,U.height],thinningCenterPos:[te,le],thinningShape:[de,pe,Math.pow(10,J.screenThinning.fadePower)],thinningAffectedRatio:J.screenThinning.affectedRatio,thinningParticleOffset:ye,color:[J.color.r,J.color.g,J.color.b,J.color.a],direction:f},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const _e=Math.round(J.intensity*this.particlesCount),ve=o.bd.simpleSegment(0,0,4*_e,2*_e);this.particlesVx&&this.particlesIdx&&O.draw(r,D.TRIANGLES,Kt.disabled,Ss.disabled,Fs.alphaBlended,gs.disabled,Se,"snow_particles",this.particlesVx,this.particlesIdx,ve)})(c.boxSize,0,c),this._vignette.draw(r,y)}}const Cy={symbol:function(p,r,c,f,y){if(p.renderPass!=="translucent")return;const v=Ss.disabled,S=p.colorModeForRenderPass(),N=c.layout.get("text-variable-anchor"),C=c.layout.get("text-size-scale-range"),k=o.ay(p.scaleFactor,C[0],C[1]);N&&function(O,G,ee,J,se,te,le,de){const pe=G.transform,ye=se==="map",Se=te==="map";for(const Te of O){const _e=J.getTile(Te),ve=_e.getBucket(ee);if(!ve||!ve.text||!ve.text.segments.get().length)continue;const be=o.bH(ve.textSizeData,pe.zoom,de),Ue=Uf(Te,ve.getProjection(),pe),Ie=pe.calculatePixelsToTileUnitsMatrix(_e),tt=np(Ue,_e.tileID.canonical,Se,ye,pe,ve.getProjection(),Ie),We=ve.hasIconTextFit()&&ve.hasIconData();be&&t1(ve,ye,Se,le,pe,tt,Te,Math.pow(2,pe.zoom-_e.tileID.overscaledZ),be,We)}}(f,p,c,r,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),y,k);const D=c.paint.get("icon-opacity").constantOr(1)!==0,U=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(D||U)?xy(p,r,c,f,v,S):(D&&xy(p,r,c,f,v,S,{onlyIcons:!0}),U&&xy(p,r,c,f,v,S,{onlyText:!0})),r.map.showCollisionBoxes&&(my(p,r,c,f,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),my(p,r,c,f,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(p,r,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("circle-opacity"),v=c.paint.get("circle-stroke-width"),S=c.paint.get("circle-stroke-opacity"),N=c.layout.get("circle-sort-key").constantOr(1)!==void 0,C=c.paint.get("circle-emissive-strength");if(y.constantOr(1)===0&&(v.constantOr(1)===0||S.constantOr(1)===0))return;const k=p.context,D=k.gl,U=p.transform,O=!(!p.terrain||!p.terrain.enabled),G=c.layout.get("circle-elevation-reference"),ee=p.depthModeForSublayer(0,Kt.ReadOnly),J=new Kt(p.context.gl.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D),se=G==="none"||O?ee:J,te=Ss.disabled,le=p.colorModeForDrapableLayerRenderPass(C),de=U.projection.name==="globe",pe=[o.aD(U.center.lng),o.aH(U.center.lat)],ye=[];for(let Te=0;Te<f.length;Te++){const _e=f[Te],ve=r.getTile(_e),be=ve.getBucket(c);if(!be||be.projection.name!==U.projection.name)continue;const Ue=be.programConfigurations.get(c.id),Ie=be.layoutVertexBuffer,tt=be.globeExtVertexBuffer,We=be.indexBuffer,rt=o.dW(c),jt=[tt],$e=p.isTileAffectedByFog(_e);de&&rt.push("PROJECTION_GLOBE_VIEW"),rt.push("DEPTH_D24"),p.terrain&&U.depthOcclusionForSymbolsAndCircles&&rt.push("DEPTH_OCCLUSION"),be.hasElevation&&!p.terrain&&(rt.push("ELEVATED_ROADS"),jt.push(be.elevatedLayoutVertexBuffer));const Ae=p.getOrCreateProgram("circle",{config:Ue,defines:rt,overrideFog:$e}),Ke=U.projection.createInversionMatrix(U,_e.canonical),Ge={programConfiguration:Ue,program:Ae,layoutVertexBuffer:Ie,dynamicBuffers:jt,indexBuffer:We,uniformValues:o.dX(p,_e,ve,Ke,pe,c),tile:ve};if(N){const ht=be.segments.get();for(const pt of ht)ye.push({segments:new o.bd([pt]),sortKey:pt.sortKey,state:Ge})}else ye.push({segments:be.segments,sortKey:0,state:Ge})}N&&ye.sort((Te,_e)=>Te.sortKey-_e.sortKey);const Se={useDepthForOcclusion:U.depthOcclusionForSymbolsAndCircles};for(const Te of ye){const{programConfiguration:_e,program:ve,layoutVertexBuffer:be,dynamicBuffers:Ue,indexBuffer:Ie,uniformValues:tt,tile:We}=Te.state,rt=Te.segments;p.terrain&&p.terrain.setupElevationDraw(We,ve,Se),p.uploadCommonUniforms(k,ve,We.tileID.toUnwrapped()),ve.draw(p,D.TRIANGLES,se,te,le,gs.disabled,tt,c.id,be,Ie,rt,c.paint,U.zoom,_e,Ue)}},heatmap:function(p,r,c,f){if(c.paint.get("heatmap-opacity")!==0)if(p.renderPass==="offscreen"){const y=p.context,v=y.gl,S=Ss.disabled,N=new Fs([v.ONE,v.ONE,v.ONE,v.ONE],o.am.transparent,[!0,!0,!0,!0]);(function(G,ee,J,se){const te=G.gl,le=ee.width*se,de=ee.height*se;G.activeTexture.set(te.TEXTURE1),G.viewport.set([0,0,le,de]);let pe=J.heatmapFbo;if(!pe||pe&&(pe.width!==le||pe.height!==de)){pe&&pe.destroy();const ye=te.createTexture();te.bindTexture(te.TEXTURE_2D,ye),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_S,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_WRAP_T,te.CLAMP_TO_EDGE),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MIN_FILTER,te.LINEAR),te.texParameteri(te.TEXTURE_2D,te.TEXTURE_MAG_FILTER,te.LINEAR),pe=J.heatmapFbo=G.createFramebuffer(le,de,!0,null),function(Se,Te,_e,ve,be,Ue){const Ie=Se.gl;Ie.texImage2D(Ie.TEXTURE_2D,0,Se.extRenderToTextureHalfFloat?Ie.RGBA16F:Ie.RGBA,be,Ue,0,Ie.RGBA,Se.extRenderToTextureHalfFloat?Ie.HALF_FLOAT:Ie.UNSIGNED_BYTE,null),ve.colorAttachment.set(_e)}(G,0,ye,pe,le,de)}else te.bindTexture(te.TEXTURE_2D,pe.colorAttachment.get()),G.bindFramebuffer.set(pe.framebuffer)})(y,p,c,p.transform.projection.name==="globe"?.5:.25),y.clear({color:o.am.transparent});const C=p.transform,k=C.projection.name==="globe",D=k?["PROJECTION_GLOBE_VIEW"]:[],U=k?gs.frontCCW:gs.disabled,O=[o.aD(C.center.lng),o.aH(C.center.lat)];for(let G=0;G<f.length;G++){const ee=f[G];if(r.hasRenderableParent(ee))continue;const J=r.getTile(ee),se=J.getBucket(c);if(!se||se.projection.name!==C.projection.name)continue;const te=p.isTileAffectedByFog(ee),le=se.programConfigurations.get(c.id),de=p.getOrCreateProgram("heatmap",{config:le,defines:D,overrideFog:te}),{zoom:pe}=p.transform;p.terrain&&p.terrain.setupElevationDraw(J,de),p.uploadCommonUniforms(y,de,ee.toUnwrapped());const ye=C.projection.createInversionMatrix(C,ee.canonical);de.draw(p,v.TRIANGLES,Kt.disabled,S,N,U,Kv(p,ee,J,ye,O,pe,c.paint.get("heatmap-intensity")),c.id,se.layoutVertexBuffer,se.indexBuffer,se.segments,c.paint,p.transform.zoom,le,k?[se.globeExtVertexBuffer]:null)}y.viewport.set([0,0,p.width,p.height])}else p.renderPass==="translucent"&&(p.context.setColorMode(p.colorModeForRenderPass()),function(y,v){const S=y.context,N=S.gl,C=v.heatmapFbo;if(!C)return;S.activeTexture.set(N.TEXTURE0),N.bindTexture(N.TEXTURE_2D,C.colorAttachment.get()),S.activeTexture.set(N.TEXTURE1);let k=v.colorRampTexture;k||(k=v.colorRampTexture=new o.T(S,v.colorRamp,N.RGBA8)),k.bind(N.LINEAR,N.CLAMP_TO_EDGE),y.getOrCreateProgram("heatmapTexture").draw(y,N.TRIANGLES,Kt.disabled,Ss.disabled,y.colorModeForRenderPass(),gs.disabled,((D,U,O,G)=>({u_image:0,u_color_ramp:1,u_opacity:U.paint.get("heatmap-opacity")}))(0,v),v.id,y.viewportBuffer,y.quadTriangleIndexBuffer,y.viewportSegments,v.paint,y.transform.zoom)}(p,c))},line:function(p,r,c,f){if(p.renderPass!=="translucent")return;const y=c.paint.get("line-opacity"),v=c.paint.get("line-width");if(y.constantOr(1)===0||v.constantOr(1)===0)return;const S=c.paint.get("line-emissive-strength"),N=c.paint.get("line-occlusion-opacity"),C=c.layout.get("line-elevation-reference"),k=c.layout.get("line-width-unit")==="meters",D=C==="sea",U=!(!p.terrain||!p.terrain.enabled),O=p.context,G=O.gl;if(c.hasElevatedBuckets&&p.transform.projection.name==="globe")return;const ee=c.layout.get("line-cross-slope"),J=ee!==void 0,se=ee<1,te=p.colorModeForDrapableLayerRenderPass(S),le=p.terrain&&p.terrain.renderingToTexture,de=le?1:o.q.devicePixelRatio,pe=c.paint.get("line-dasharray"),ye=pe.constantOr(1),Se=c.layout.get("line-cap"),Te=pe.constantOr(null),_e=Se.constantOr(null),ve=c.paint.get("line-pattern"),be=ve.constantOr(1),Ue=c.paint.get("line-pattern-cross-fade"),Ie=ve.constantOr(null),tt=c.paint.get("line-opacity").constantOr(1);let We=!be&&tt!==1||p.depthOcclusion&&N>0&&N<1;const rt=c.paint.get("line-gradient"),jt=be?"linePattern":"line",$e=o.dY(c);let Ae;if(le&&p.terrain&&p.terrain.clipOrMaskOverlapStencilType()&&(We=!1),N!==0&&p.depthOcclusion){const pt=c.paint._values["line-opacity"];pt&&pt.value&&pt.value.kind==="constant"?Ae=pt.value:o.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}v.value.kind!=="constant"&&v.value.isLineProgressConstant===!1&&$e.push("VARIABLE_LINE_WIDTH");const Ke=(pt,mt,Pt,ns,us,Wt)=>{for(const as of pt){const is=r.getTile(as);if(be&&!is.patternsLoaded())continue;const Cs=is.getBucket(c);if(!Cs||Cs.elevationType!=="none"&&!us||Cs.elevationType==="none"&&us)continue;p.prepareDrawTile();const Ls=[...mt],Ws=p.shadowRenderer,pn=Cs.elevationType==="road"&&!!Ws&&Ws.enabled;let Rs=[0,0,0];if(pn){const dn=p.style.directionalLight,Sn=p.style.ambientLight;dn&&Sn&&(Rs=vu(p.style,dn,Sn)),Ls.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const fn=Cs.programConfigurations.get(c.id);let yn=!1;if(Ie&&is.imageAtlas){const dn=o.dZ.from(Ie),Sn=dn.getPrimary().scaleSelf(de).toString(),zn=is.imageAtlas.patternPositions.get(Sn),Or=dn.getSecondary(),Lr=Or?is.imageAtlas.patternPositions.get(Or.scaleSelf(de).toString()):null;yn=!!zn&&!!Lr,zn&&fn.setConstantPatternPositions(zn,Lr)}Ue>0&&(yn||fn.getPatternTransitionVertexBuffer("line-pattern"))&&Ls.push("LINE_PATTERN_TRANSITION");const Hn=p.isTileAffectedByFog(as),$s=p.getOrCreateProgram(jt,{config:fn,defines:Ls,overrideFog:Hn});if(!be&&Te&&_e&&is.lineAtlas){const dn=is.lineAtlas.getDash(Te,_e);dn&&fn.setConstantPatternPositions(dn)}pn&&Ws.setupShadows(is.tileID.toUnwrapped(),$s,"vector-tile");let[mn,gn]=c.paint.get("line-trim-offset");(_e==="round"||_e==="square")&&mn!==gn&&(mn===0&&(mn-=1),gn===1&&(gn+=1));const wn=le?as.projMatrix:null,qs=k?1/Cs.tileToMeter/o.aw(is,1,p.transform.zoom):1,Pn=k?1/Cs.tileToMeter/o.aw(is,1,Math.floor(p.transform.zoom)):1,_n=be?o.d_(p,is,c,wn,de,qs,Pn,[mn,gn],Rs,Ue):o.d$(p,is,c,wn,Cs.lineClipsArray.length,de,qs,Pn,[mn,gn],Rs);if(rt){const dn=Cs.gradients[c.id];let Sn=dn.texture;if(c.gradientVersion!==dn.version){let zn=256;if(c.stepInterpolant){const Or=r.getSource().maxzoom,Lr=as.canonical.z===Or?Math.ceil(1<<p.transform.maxZoom-as.canonical.z):1;zn=o.ay(o.e0(Cs.maxLineLength/o.aj*1024*Lr),256,O.maxTextureSize)}dn.gradient=o.e1({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:zn,image:dn.gradient||void 0,clips:Cs.lineClipsArray}),dn.texture?dn.texture.update(dn.gradient):dn.texture=new o.T(O,dn.gradient,G.RGBA8),dn.version=c.gradientVersion,Sn=dn.texture}O.activeTexture.set(G.TEXTURE1),Sn.bind(c.stepInterpolant?G.NEAREST:G.LINEAR,G.CLAMP_TO_EDGE)}ye&&(O.activeTexture.set(G.TEXTURE0),is.lineAtlasTexture&&is.lineAtlasTexture.bind(G.LINEAR,G.REPEAT),fn.updatePaintBuffers()),be&&(O.activeTexture.set(G.TEXTURE0),is.imageAtlasTexture&&is.imageAtlasTexture.bind(G.LINEAR,G.CLAMP_TO_EDGE),fn.updatePaintBuffers()),us&&!D&&p.terrain.setupElevationDraw(is,$s),p.uploadCommonUniforms(O,$s,as.toUnwrapped());const gr=dn=>{Ae!=null&&(Ae.value=tt*N),$s.draw(p,G.TRIANGLES,Pt,dn,te,gs.disabled,_n,c.id,Cs.layoutVertexBuffer,Cs.indexBuffer,Cs.segments,c.paint,p.transform.zoom,fn,[Cs.layoutVertexBuffer2,Cs.patternVertexBuffer,Cs.zOffsetVertexBuffer]),Ae!=null&&(Ae.value=tt)};if(We&&!us){const dn=p.stencilModeForClipping(as).ref;dn===0&&le&&O.clear({stencil:0});const Sn={func:G.EQUAL,mask:255};_n.u_alpha_discard_threshold=.8,gr(new Ss(Sn,dn,255,G.KEEP,G.KEEP,G.INVERT)),_n.u_alpha_discard_threshold=0,gr(new Ss(Sn,dn,255,G.KEEP,G.KEEP,G.KEEP))}else _n.u_alpha_discard_threshold=We&&us&&Wt?.8:0,gr(us?ns:p.stencilModeForClipping(as))}};let Ge=p.depthModeForSublayer(0,Kt.ReadOnly);const ht=new Kt(p.depthOcclusion?G.GREATER:G.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D);if(c.hasNonElevatedBuckets){const pt=!le&&p.terrain;N!==0&&pt?o.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):pt?o.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):Ke(f,$e,Ge,Ss.disabled,!1,!0)}if(c.hasElevatedBuckets){C==="hd-road-markup"?U||(Ge=ht,$e.push("ELEVATED_ROADS")):($e.push("ELEVATED"),Ge=ht,J&&$e.push(se?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),D&&$e.push("ELEVATION_REFERENCE_SEA"));const pt=We?p.stencilModeFor3D():Ss.disabled;p.forceTerrainMode=!0,Ke(f,$e,Ge,pt,!0,!0),We&&Ke(f,$e,Ge,pt,!0,!1),p.forceTerrainMode=!1}We&&(p.resetStencilClippingMasks(),le&&O.clear({stencil:0})),N===0||p.depthOcclusion||le||p.layersWithOcclusionOpacity.push(p.currentLayer)},fill:function(p,r,c,f){const y=c.paint.get("fill-color"),v=c.paint.get("fill-opacity");if(v.constantOr(1)===0)return;const S=c.paint.get("fill-emissive-strength"),N=p.colorModeForDrapableLayerRenderPass(S),C=c.paint.get("fill-pattern"),k=p.opaquePassEnabledForLayer()&&!C.constantOr(1)&&y.constantOr(o.am.transparent).a===1&&v.constantOr(0)===1?"opaque":"translucent";let D="none";c.layout.get("fill-elevation-reference")!=="none"?D="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(D="offset");const U=!(!p.terrain||!p.terrain.enabled),O={painter:p,sourceCache:r,layer:c,coords:f,colorMode:N,elevationType:D,terrainEnabled:U,pass:k};if(p.renderPass!=="shadow")if(D!=="offset"){if(vm(O,!1),D==="road"){const G=!U&&p.renderPass==="translucent";G&&Yt(p,r,c,f,"geometry"),vm(O,!0,Ss.disabled),G&&function(ee){const{painter:J,sourceCache:se,layer:te,coords:le,colorMode:de}=ee,pe=J.context.gl,ye=ee.painter.shadowRenderer,Se=!!ye&&ye.enabled,Te=new Kt(J.context.gl.LEQUAL,Kt.ReadOnly,J.depthRangeFor3D);let _e=[0,0,0];if(Se){const be=J.style.directionalLight,Ue=J.style.ambientLight;be&&Ue&&(_e=vu(J.style,be,Ue))}const ve=be=>{for(const Ue of le){const Ie=se.getTile(Ue),tt=Ie.getBucket(te);if(!tt)continue;const We=tt.elevatedStructures;if(!We)continue;let rt,jt;if(be?(rt=We.renderableBridgeSegments,jt=We.bridgeProgramConfigurations.get(te.id)):(rt=We.renderableTunnelSegments,jt=We.tunnelProgramConfigurations.get(te.id)),!rt||rt.segments[0].primitiveLength===0)continue;jt.updatePaintBuffers(),J.prepareDrawTile();const $e=J.isTileAffectedByFog(Ue),Ae=[];Se&&Ae.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const Ke=J.getOrCreateProgram("elevatedStructures",{config:jt,overrideFog:$e,defines:Ae}),Ge=J.translatePosMatrix(Ue.projMatrix,Ie,te.paint.get("fill-translate"),te.paint.get("fill-translate-anchor"));Se&&ye.setupShadows(Ie.tileID.toUnwrapped(),Ke,"vector-tile");const ht=VS(Ge,_e);J.uploadCommonUniforms(J.context,Ke,Ue.toUnwrapped()),Ke.draw(J,pe.TRIANGLES,Te,Ss.disabled,de,gs.backCCW,ht,te.id,We.vertexBuffer,We.indexBuffer,rt,te.paint,J.transform.zoom,jt,[We.vertexBufferNormal])}};ve(!0),ve(!1)}(O)}}else vm(O,!1,p.stencilModeFor3D());else p.shadowRenderer&&D==="road"&&!U&&function(G){const{painter:ee,sourceCache:J,layer:se,coords:te}=G,le=ee.context.gl,de=G.painter.shadowRenderer;for(const pe of te){const ye=J.getTile(pe),Se=ye.getBucket(se);if(!Se)continue;const Te=Se.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;ee.prepareDrawTile();const _e=Se.bufferData.programConfigurations.get(se.id),ve=ee.isTileAffectedByFog(pe),be=ee.getOrCreateProgram("elevatedStructuresDepth",{config:_e,overrideFog:ve}),Ue=de.calculateShadowPassMatrixFromTile(ye.tileID.toUnwrapped());ee.uploadCommonUniforms(ee.context,be,pe.toUnwrapped());const Ie={u_matrix:Ue,u_depth_bias:0};be.draw(ee,le.TRIANGLES,de.getShadowPassDepthMode(),Ss.disabled,de.getShadowPassColorMode(),gs.disabled,Ie,se.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,se.paint,ee.transform.zoom,_e)}}(O)},"fill-extrusion":function(p,r,c,f){const y=c.paint.get("fill-extrusion-opacity"),v=p.context,S=v.gl,N=p.terrain,C=N&&N.renderingToTexture;if(y===0)return;const k=p.conflationActive&&p.style.isLayerClipped(c,r.getSource()),D=p.style.order.indexOf(c.fqid);if(k&&function(U,O,G,ee,J){for(const se of ee){const te=O.getTile(se).getBucket(G);te&&(te.updateReplacement(se,U.replacementSource,J),te.uploadCentroid(U.context))}}(p,r,c,f,D),N||k)for(const U of f){const O=r.getTile(U).getBucket(c);O&&ys(p.context,r,U,O,c,N,k)}if(p.renderPass==="shadow"&&p.shadowRenderer){const U=p.shadowRenderer;if(N&&y<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof o.ab)return;const O=U.getShadowPassDepthMode(),G=U.getShadowPassColorMode();bp(p,r,c,f,O,Ss.disabled,G,k)}else if(p.renderPass==="translucent"){const U=!c.paint.get("fill-extrusion-pattern").constantOr(1),O=c.paint.get("fill-extrusion-color").constantOr(o.am.white);if(!C&&O.a!==0){const G=new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D);y===1&&U?bp(p,r,c,f,G,Ss.disabled,Fs.unblended,k):(bp(p,r,c,f,G,Ss.disabled,Fs.disabled,k),bp(p,r,c,f,G,p.stencilModeFor3D(),p.colorModeForRenderPass(),k),p.resetStencilClippingMasks())}if(p.style.enable3dLights()&&U&&(!N&&p.transform.projection.name!=="globe"||C)){const G=c.paint.get("fill-extrusion-opacity"),ee=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),J=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),se=c.paint.get("fill-extrusion-flood-light-intensity"),te=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",le=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(te?null:c.lut).toArray01().slice(0,3),de=ee>0&&J>0,pe=se>0,ye=(_e,ve,be)=>(1-be)*_e+be*ve,Se=new Bl;Se.translate=c.paint.get("fill-extrusion-translate"),Se.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),Se.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),Se.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Te=_e=>{const ve=p.depthModeForSublayer(1,Kt.ReadOnly,S.LEQUAL,!0),be=c.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ue=ye(.1,3,be),Ie=p._showOverdrawInspector;if(!Ie){const tt=new Ss({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),We=new Fs([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);Ao(Se,p,r,c,f,ve,tt,We,gs.disabled,_e,"sdf",G,ee,J,se,le,Ue,k,!1)}{const tt=Ie?Ss.disabled:new Ss({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),We=Ie?p.colorModeForRenderPass():new Fs([S.ONE_MINUS_DST_ALPHA,S.DST_ALPHA,S.ONE,S.ONE],o.am.transparent,[!0,!0,!0,!0]);Ao(Se,p,r,c,f,ve,tt,We,gs.disabled,_e,"color",G,ee,J,se,le,Ue,k,!1)}};if(C){const _e=(ve,be,Ue)=>{const Ie=p.depthModeForSublayer(1,Kt.ReadOnly,S.LEQUAL,!1),tt=c.paint.get(ve?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),We=ye(.1,3,tt);{const rt=new Fs([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0]);Ao(Se,p,r,c,f,Ie,Ss.disabled,rt,gs.disabled,ve,"clear",G,ee,J,se,le,We,k,be)}{const rt=new Ss({func:S.ALWAYS,mask:255},255,255,S.KEEP,S.KEEP,S.REPLACE),jt=new Fs([S.ONE,S.ONE,S.ONE,S.ONE],o.am.transparent,[!1,!1,!1,!0],S.MIN);Ao(Se,p,r,c,f,Ie,rt,jt,gs.disabled,ve,"sdf",G,ee,J,se,le,We,k,be)}{const rt=ve?S.ZERO:S.ONE_MINUS_DST_ALPHA,jt=new Ss({func:S.EQUAL,mask:255},255,255,S.KEEP,S.DECR,S.DECR),$e=new Fs([rt,S.DST_ALPHA,S.ONE_MINUS_DST_ALPHA,S.ZERO],o.am.transparent,[!0,!0,!0,!0]);Ao(Se,p,r,c,f,Ie,jt,$e,gs.disabled,ve,"color",G,ee,J,se,le,We,k,be)}{const rt=new Fs([S.ONE,S.ONE,S.ONE,ve?S.ZERO:S.ONE],o.am.transparent,[!1,!1,!1,!0],ve?S.FUNC_ADD:S.MAX);Ao(Se,p,r,c,f,Ie,Ss.disabled,rt,gs.disabled,ve,"clear",G,ee,J,se,le,We,k,be,Ue)}};if(de||pe){let ve;if(p.prepareDrawTile(),N){const be=N.drapeBufferSize[0],Ue=N.drapeBufferSize[1];ve=N.framebufferCopyTexture,ve&&(!ve||ve.size[0]===be&&ve.size[1]===Ue)||(ve&&ve.destroy(),ve=N.framebufferCopyTexture=new o.T(v,new o.r({width:be,height:Ue}),S.RGBA8)),ve.bind(S.LINEAR,S.CLAMP_TO_EDGE),S.copyTexSubImage2D(S.TEXTURE_2D,0,0,0,0,0,be,Ue)}de&&_e(!0,!1,ve),pe&&_e(!1,!0,ve)}}else de&&Te(!0),pe&&Te(!1),(de||pe)&&p.resetStencilClippingMasks()}}},building:function(p,r,c,f){p.currentLayer<p.firstLightBeamLayer&&(p.firstLightBeamLayer=p.currentLayer);const y=c.paint.get("building-ambient-occlusion-ground-intensity"),v=c.paint.get("building-ambient-occlusion-ground-radius"),S=c.paint.get("building-ambient-occlusion-ground-attenuation");let N=y>0&&v>0,C=!0;const k=c.paint.get("building-vertical-scale");k<1&&(C=!1);const D=p.conflationActive&&p.style.isLayerClipped(c,r.getSource()),U=p.style.order.indexOf(c.fqid);if(function(O,G,ee,J,se,te){for(const le of te){const de=G.getTile(le).getBucket(ee);de&&(se&&de.updateReplacement(le,O.replacementSource,J),de.uploadUpdatedIndexBuffer(O.context))}}(p,r,c,U,D,f),function(O,G,ee,J){for(const se of J){const te=G.getTile(se).getBucket(ee);te&&te.needsEvaluation(O,ee)&&(te.evaluate(ee),te.uploadUpdatedColorBuffer(O.context))}}(p,r,c,f),c.resetLayerRenderingStats(p),p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!0),p.renderPass==="shadow"&&p.shadowRenderer){const O=p.shadowRenderer,G=[],ee=O.getShadowPassDepthMode();wm({painter:p,source:r,layer:c,coords:f,defines:G,blendMode:O.getShadowPassColorMode(),depthMode:ee,verticalScale:k})}else if(p.renderPass==="translucent"){N&&function(J,se,te,le,de,pe,ye,Se,Te,_e,ve,be,Ue){const Ie=J.context.gl,tt=J.depthModeForSublayer(1,Kt.ReadOnly,Ie.LEQUAL,!0),We=.1*(1-(rt=ve))+3*rt;var rt;const jt=J._showOverdrawInspector,$e=be,Ae=new Bl;jt||Ao(Ae,J,se,te,le,tt,new Ss({func:Ie.ALWAYS,mask:255},255,255,Ie.KEEP,Ie.KEEP,Ie.REPLACE),new Fs([Ie.ONE,Ie.ONE,Ie.ONE,Ie.ONE],o.am.transparent,[!1,!1,!1,!0],Ie.MIN),gs.disabled,de,"sdf",1,ye,Se,0,_e,We,$e,!1);{const Ke=jt?Ss.disabled:new Ss({func:Ie.EQUAL,mask:255},255,255,Ie.KEEP,Ie.DECR,Ie.DECR),Ge=jt?J.colorModeForRenderPass():new Fs([Ie.ONE_MINUS_DST_ALPHA,Ie.DST_ALPHA,Ie.ONE,Ie.ONE],o.am.transparent,[!0,!0,!0,!0]);Ao(Ae,J,se,te,le,tt,Ke,Ge,gs.disabled,de,"color",1,ye,Se,0,_e,We,$e,!1)}}(p,r,c,f,!0,0,y,v,0,[0,0,0],S,D);let O=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];C&&(O=O.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),p.shadowRenderer.useNormalOffset&&(O=O.concat("NORMAL_OFFSET"));const G=new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D),ee=p.colorModeForRenderPass();wm({painter:p,source:r,layer:c,coords:f,defines:O,blendMode:ee,depthMode:G,verticalScale:k})}else if(p.renderPass==="light-beam"){const O=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],G=new Kt(p.context.gl.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D);wm({painter:p,source:r,layer:c,coords:f,defines:O,blendMode:Fs.alphaBlended,depthMode:G,verticalScale:k})}p.shadowRenderer&&(p.shadowRenderer.useNormalOffset=!1),p.resetStencilClippingMasks()},hillshade:function(p,r,c,f){if(p.renderPass!=="offscreen"&&p.renderPass!=="translucent"||p.style.disableElevatedTerrain)return;const y=p.context,v=p.terrain&&p.terrain.renderingToTexture,[S,N]=p.renderPass!=="translucent"||v?[{},f]:p.stencilConfigForOverlap(f);for(const C of N){const k=r.getTile(C);if(k.needsHillshadePrepare&&p.renderPass==="offscreen")Rv(p,k,c);else if(p.renderPass==="translucent"){const D=p.depthModeForSublayer(0,Kt.ReadOnly),U=c.paint.get("hillshade-emissive-strength"),O=p.colorModeForDrapableLayerRenderPass(U),G=v&&p.terrain?p.terrain.stencilModeForRTTOverlap(C):S[C.overscaledZ];IS(p,C,k,c,D,G,O)}}y.viewport.set([0,0,p.width,p.height]),p.resetStencilClippingMasks()},raster:function(p,r,c,f,y,v){if(p.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const S=p.transform.projection.name==="globe",N=c.paint.get("raster-elevation")!==0,C=N&&S;if(p.renderElevatedRasterBackface&&!C)return;const k=p.context,D=k.gl,U=r.getSource(),O=function(Se,Te,_e,ve){const be=Te.paint.get("raster-color"),Ue=Se.type==="raster-array",Ie=[],tt=Te.paint.get("raster-resampling"),We=Te.paint.get("raster-color-mix");let rt=Te.paint.get("raster-color-range");const jt=[We[0],We[1],We[2],0],$e=We[3];let Ae=tt==="nearest"?ve.NEAREST:ve.LINEAR;if(Ue&&(Ie.push("RASTER_ARRAY"),be||Ie.push("RASTER_COLOR"),tt==="linear"&&Ie.push("RASTER_ARRAY_LINEAR"),Ae=ve.NEAREST,!rt&&Se.rasterLayers)){const Ke=Se.rasterLayers.find(({id:Ge})=>Ge===Te.sourceLayer);Ke&&Ke.fields&&Ke.fields.range&&(rt=Ke.fields.range)}if(rt=rt||[0,1],be){Ie.push("RASTER_COLOR"),_e.activeTexture.set(ve.TEXTURE2),Te.updateColorRamp(rt);let Ke=Te.colorRampTexture;Ke||(Ke=Te.colorRampTexture=new o.T(_e,Te.colorRamp,ve.RGBA8)),Ke.bind(ve.LINEAR,ve.CLAMP_TO_EDGE)}return{mix:jt,range:rt,offset:$e,defines:Ie,resampling:Ae}}(U,c,k,D);if(U instanceof o.aP&&!f.length&&!S)return;const G=c.paint.get("raster-emissive-strength"),ee=p.colorModeForDrapableLayerRenderPass(G),J=p.terrain&&p.terrain.renderingToTexture,se=!p.options.moving,te=c.paint.get("raster-resampling")==="nearest"?D.NEAREST:D.LINEAR;if(U instanceof o.aP&&!f.length&&(U.onNorthPole||U.onSouthPole)){const Se=N?p.stencilModeFor3D():Ss.disabled;return void Sm(!!U.onNorthPole,null,p,r,c,G,O,gs.disabled,Se)}if(!f.length)return;const[le,de]=U instanceof o.aP||J?[{},f]:p.stencilConfigForOverlap(f),pe=de[de.length-1].overscaledZ;C&&O.defines.push("PROJECTION_GLOBE_VIEW"),N&&O.defines.push("RENDER_CUTOFF");const ye=(Se,Te,_e)=>{for(const ve of Se){const be=ve.toUnwrapped(),Ue=r.getTile(ve);if(J&&(!Ue||!Ue.hasData()))continue;k.activeTexture.set(D.TEXTURE0);const Ie=HS(Ue,U,c,O);if(!Ie||!Ie.texture)continue;const{texture:tt,mix:We,offset:rt,tileSize:jt,buffer:$e}=Ie;let Ae,Ke;J?(Ae=Kt.disabled,Ke=ve.projMatrix):N?(Ae=new Kt(D.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D),Ke=S?Float32Array.from(p.transform.expandedFarZProjMatrix):p.transform.calculateProjMatrix(be,se)):(Ae=p.depthModeForSublayer(ve.overscaledZ-pe,c.paint.get("raster-opacity")===1?Kt.ReadWrite:Kt.ReadOnly,D.LESS),Ke=p.transform.calculateProjMatrix(be,se));const Ge=p.terrain&&J?p.terrain.stencilModeForRTTOverlap(ve):le[ve.overscaledZ],ht=v?0:c.paint.get("raster-fade-duration");Ue.registerFadeDuration(ht);const pt=r.findLoadedParent(ve,0),mt=Co(Ue,pt,r,p.transform,ht);let Pt,ns;p.terrain&&p.terrain.prepareDrawTile(),k.activeTexture.set(D.TEXTURE0),tt.bind(te,D.CLAMP_TO_EDGE),k.activeTexture.set(D.TEXTURE1),pt?(pt.texture&&pt.texture.bind(te,D.CLAMP_TO_EDGE),Pt=Math.pow(2,pt.tileID.overscaledZ-Ue.tileID.overscaledZ),ns=[Ue.tileID.canonical.x*Pt%1,Ue.tileID.canonical.y*Pt%1]):tt.bind(te,D.CLAMP_TO_EDGE),"useMipmap"in tt&&k.extTextureFilterAnisotropic&&p.transform.pitch>20&&D.texParameterf(D.TEXTURE_2D,k.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,k.extTextureFilterAnisotropicMax);const us=p.transform;let Wt;const as=N?GS(us):[0,0,0,0];let is,Cs,Ls,Ws,pn,Rs=0;if(C&&U instanceof o.aP&&U.coordinates.length>3)is=Float32Array.from(o.bh(o.dD(new o.cA(0,0,0)))),Cs=Float32Array.from(us.globeMatrix),Ls=Float32Array.from(o.dz(us)),Ws=[o.aD(us.center.lng),o.aH(us.center.lat)],Wt=U.elevatedGlobePerspectiveTransform,pn=U.elevatedGlobeGridMatrix||new Float32Array(9);else if(C){const $s=o.dA(ve.canonical);Rs=o.dB($s.getCenter().lat),is=Float32Array.from(o.bh(o.dD(ve.canonical))),Cs=Float32Array.from(us.globeMatrix),Ls=Float32Array.from(o.dz(us)),Ws=[o.aD(us.center.lng),o.aH(us.center.lat)],Wt=[0,0],pn=Float32Array.from(o.dC(ve.canonical,$s,Rs,us.worldSize/us._pixelsPerMercatorPixel))}else Wt=U instanceof o.aP?U.perspectiveTransform:[0,0],is=new Float32Array(16),Cs=new Float32Array(9),Ls=new Float32Array(16),Ws=[0,0],pn=new Float32Array(9);const fn=uy(Ke,is,Cs,Ls,pn,ns||[0,0],o.ah(p.transform.zoom),Ws,as,Pt||1,mt,c,Wt,N?c.paint.get("raster-elevation"):0,2,We,rt,O.range,jt,$e,G),yn=p.isTileAffectedByFog(ve),Hn=p.getOrCreateProgram("raster",{defines:O.defines,overrideFog:yn});if(p.uploadCommonUniforms(k,Hn,be),U instanceof o.aP){const $s=U.elevatedGlobeVertexBuffer,mn=U.elevatedGlobeIndexBuffer;if(J||!S)U.boundsBuffer&&U.boundsSegments&&Hn.draw(p,D.TRIANGLES,Ae,Ss.disabled,ee,gs.disabled,fn,c.id,U.boundsBuffer,p.quadTriangleIndexBuffer,U.boundsSegments);else if($s&&mn){const gn=us.zoom<=o.cX?U.elevatedGlobeSegments:U.getSegmentsForLongitude(us.center.lng);gn&&Hn.draw(p,D.TRIANGLES,Ae,Ss.disabled,ee,Te,fn,c.id,$s,mn,gn)}}else if(C){Ae=new Kt(D.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D);const $s=p.globeSharedBuffers;if($s){const[mn,gn,wn]=$s.getGridBuffers(Rs,!1);Hn.draw(p,D.TRIANGLES,Ae,_e||Ge,p.colorModeForRenderPass(),Te,fn,c.id,mn,gn,wn)}}else{const{tileBoundsBuffer:$s,tileBoundsIndexBuffer:mn,tileBoundsSegments:gn}=p.getTileBoundsBuffers(Ue);Hn.draw(p,D.TRIANGLES,Ae,Ge,ee,gs.disabled,fn,c.id,$s,mn,gn)}}if(!(U instanceof o.aP)&&C)for(const ve of Se){const be=ve.canonical.y===(1<<ve.canonical.z)-1;ve.canonical.y===0&&Sm(!0,ve,p,r,c,G,O,Te,_e||Ss.disabled),be&&Sm(!1,ve,p,r,c,G,O,Te===gs.frontCW?gs.backCW:gs.frontCW,_e||Ss.disabled)}};C?ye(de,p.renderElevatedRasterBackface?gs.backCW:gs.frontCW,p.stencilModeFor3D()):ye(de,gs.disabled,void 0),p.resetStencilClippingMasks()},"raster-particle":function(p,r,c,f,y,v){p.renderPass==="offscreen"&&function(S,N,C,k){if(!k.length)return;const D=S.context,U=D.gl,O=N.getSource();if(!(O instanceof xc))return;const G=Math.ceil(Math.sqrt(C.paint.get("raster-particle-count")));let ee=C.particlePositionRGBAImage;if(!ee||ee.width!==G){const de=function(pe){const ye=pe*pe,Se=new Uint8Array(4*ye),Te=function(ve){return ve|=0,ve=Math.imul(2747636419^ve,2654435769),ve=Math.imul(ve^ve>>>16,2654435769),((ve=Math.imul(ve^ve>>>16,2654435769))>>>0)/4294967296},_e=1/1.1;for(let ve=0;ve<ye;ve++){const be=_e*(Te(2*ve+0)+Cc),Ue=_e*(Te(2*ve+1)+Cc),Ie=255*be%1,tt=255*Ue%1,We=Ie,rt=Ue-tt/255,jt=tt;Se[4*ve+0]=255*(be-Ie/255),Se[4*ve+1]=255*We,Se[4*ve+2]=255*rt,Se[4*ve+3]=255*jt}return Se}(G);ee=C.particlePositionRGBAImage=new o.r({width:G,height:G},de)}let J=C.particleFramebuffer;J?J.width!==G&&(J.destroy(),J=C.particleFramebuffer=D.createFramebuffer(G,G,!0,null)):J=C.particleFramebuffer=D.createFramebuffer(G,G,!0,null);const se=[];for(const de of k){const pe=N.getTile(de);if(!(pe instanceof ad))continue;const ye=fo(pe,O,C);if(!ye)continue;const Se=[pe.tileSize,pe.tileSize];let Te=C.tileFramebuffer;Te||(Te=C.tileFramebuffer=D.createFramebuffer(Se[0],Se[1],!0,null));let _e=pe.rasterParticleState;_e||(_e=pe.rasterParticleState=new _y(D,de,Se,ee));const ve=_e.update(C.lastInvalidatedAt);_e.particleTextureDimension!==G&&_e.updateParticleTexture(de,ee);const be=_e.targetColorTexture;_e.targetColorTexture=_e.backgroundColorTexture,_e.backgroundColorTexture=be;const Ue=_e.particleTexture0;_e.particleTexture0=_e.particleTexture1,_e.particleTexture1=Ue,se.push([de,ye,_e,ve])}if(se.length===0)return;const te=o.q.now(),le=C.previousDrawTimestamp?.001*(te-C.previousDrawTimestamp):.0167;if(C.previousDrawTimestamp=te,C.hasColorMap()){D.activeTexture.set(U.TEXTURE0+2);let de=C.colorRampTexture;de||(de=C.colorRampTexture=new o.T(D,C.colorRamp,U.RGBA8)),de.bind(U.LINEAR,U.CLAMP_TO_EDGE)}D.bindFramebuffer.set(C.tileFramebuffer.framebuffer),function(de,pe,ye){const Se=de.context,Te=Se.gl,_e=pe.tileFramebuffer;Se.activeTexture.set(Te.TEXTURE0);const ve={u_texture:0,u_opacity:1.05*(Ue=pe.paint.get("raster-particle-fade-opacity-factor"))/(Ue+.05)},be=de.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var Ue;for(const Ie of ye){const[,,tt,We]=Ie;_e.colorAttachment.set(tt.targetColorTexture.texture),Se.viewport.set([0,0,_e.width,_e.height]),Se.clear({color:o.am.transparent}),We&&(tt.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),be.draw(de,Te.TRIANGLES,Kt.disabled,Ss.disabled,Fs.alphaBlended,gs.disabled,ve,pe.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments))}}(S,C,se),function(de,pe,ye,Se){const Te=de.context,_e=Te.gl,ve=ye.tileFramebuffer,be=de.transform.projection.name==="globe",Ue=ye.paint.get("raster-particle-max-speed");for(const Ie of Se){const[tt,We,rt]=Ie;Te.activeTexture.set(_e.TEXTURE0+0),We.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),ve.colorAttachment.set(rt.targetColorTexture.texture);const jt=de.getOrCreateProgram("rasterParticleDraw",{defines:We.defines,overrideFog:!1});Te.activeTexture.set(_e.TEXTURE0+1);const $e=We.scalarData?[]:[0,1,2,3].map(Ge=>o.e3[Ge](tt));$e.push(tt);const Ae=tt.canonical.x,Ke=tt.canonical.y;for(const Ge of $e){const ht=pe.getTile(be?Ge.wrapped():Ge);if(!ht)continue;const pt=ht.rasterParticleState;if(!pt)continue;const mt=Ge.canonical.x+(1<<Ge.canonical.z)*(Ge.wrap-tt.wrap),Pt=Ge.canonical.y;pt.particleTexture0.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const ns=Xv(1,pt.particleTexture0.size[0],[mt-Ae,Pt-Ke],0,We.texture.size,2,Ue,We.textureOffset,We.scale,We.offset);jt.draw(de,_e.POINTS,Kt.disabled,Ss.disabled,Fs.alphaBlended,gs.disabled,ns,ye.id,pt.particleIndexBuffer,void 0,pt.particleSegment)}}}(S,N,C,se),D.bindFramebuffer.set(C.particleFramebuffer.framebuffer),function(de,pe,ye,Se){const Te=de.context,_e=Te.gl,ve=pe.paint.get("raster-particle-max-speed"),be=Se*pe.paint.get("raster-particle-speed-factor")*.15,Ue=function(tt){return Math.pow(tt,6)}(.01+1*pe.paint.get("raster-particle-reset-rate-factor")),Ie=pe.particleFramebuffer;Te.viewport.set([0,0,Ie.width,Ie.height]);for(const tt of ye){const[,We,rt]=tt;Te.activeTexture.set(_e.TEXTURE0+0),We.texture.bind(_e.LINEAR,_e.CLAMP_TO_EDGE),Te.activeTexture.set(_e.TEXTURE0+1);const jt=rt.particleTexture0;jt.bind(_e.NEAREST,_e.CLAMP_TO_EDGE);const $e=Yv(1,jt.size[0],0,We.texture.size,ve,be,Ue,We.textureOffset,We.scale,We.offset);Ie.colorAttachment.set(rt.particleTexture1.texture),Te.clear({color:o.am.transparent}),de.getOrCreateProgram("rasterParticleUpdate",{defines:We.defines}).draw(de,_e.TRIANGLES,Kt.disabled,Ss.disabled,Fs.unblended,gs.disabled,$e,pe.id,de.viewportBuffer,de.quadTriangleIndexBuffer,de.viewportSegments)}}(S,C,se,le)}(p,r,c,f),p.renderPass==="translucent"&&(function(S,N,C,k,D){const U=S.context,O=U.gl,G=N.getSource().tileSize,ee=5*(1-o.af(o.cI,o.cI+1,S.transform.zoom))*G+C.paint.get("raster-particle-elevation"),J=!S.options.moving,se=S.transform.projection.name==="globe";if(!k.length)return;const[te,le]=S.stencilConfigForOverlap(k),de=[];se&&de.push("PROJECTION_GLOBE_VIEW");const pe=S.stencilModeFor3D();for(const ye of le){const Se=ye.toUnwrapped(),Te=N.getTile(ye);if(!Te.rasterParticleState)continue;const _e=Te.rasterParticleState,ve=100;Te.registerFadeDuration(ve);const be=N.findLoadedParent(ye,0),Ue=Co(Te,be,N,S.transform,ve);let Ie,tt;S.terrain&&S.terrain.prepareDrawTile(),U.activeTexture.set(O.TEXTURE0),_e.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),U.activeTexture.set(O.TEXTURE1),be&&be.rasterParticleState?(be.rasterParticleState.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE),Ie=Math.pow(2,be.tileID.overscaledZ-Te.tileID.overscaledZ),tt=[Te.tileID.canonical.x*Ie%1,Te.tileID.canonical.y*Ie%1]):_e.targetColorTexture.bind(O.LINEAR,O.CLAMP_TO_EDGE);const We=se?Float32Array.from(S.transform.expandedFarZProjMatrix):S.transform.calculateProjMatrix(Se,J),rt=S.transform,jt=Mc(rt),$e=o.dA(ye.canonical),Ae=o.dB($e.getCenter().lat);let Ke,Ge,ht,pt,mt;se?(Ke=Float32Array.from(o.bh(o.dD(ye.canonical))),Ge=Float32Array.from(rt.globeMatrix),ht=Float32Array.from(o.dz(rt)),pt=[o.aD(rt.center.lng),o.aH(rt.center.lat)],mt=Float32Array.from(o.dC(ye.canonical,$e,Ae,rt.worldSize/rt._pixelsPerMercatorPixel))):(Ke=new Float32Array(16),Ge=new Float32Array(9),ht=new Float32Array(16),pt=[0,0],mt=new Float32Array(9));const Pt=gm(We,Ke,Ge,ht,mt,tt||[0,0],o.ah(S.transform.zoom),pt,jt,Ie||1,Ue,ee),ns=S.isTileAffectedByFog(ye),us=S.getOrCreateProgram("rasterParticle",{defines:de,overrideFog:ns});if(S.uploadCommonUniforms(U,us,Se),se){const Wt=new Kt(O.LEQUAL,Kt.ReadOnly,S.depthRangeFor3D),as=0,is=S.globeSharedBuffers;if(is){const[Cs,Ls,Ws]=is.getGridBuffers(Ae,as!==0);us.draw(S,O.TRIANGLES,Wt,pe,Fs.alphaBlended,S.renderElevatedRasterBackface?gs.frontCCW:gs.backCCW,Pt,C.id,Cs,Ls,Ws)}}else{const Wt=S.depthModeForSublayer(0,Kt.ReadOnly),as=te[ye.overscaledZ],{tileBoundsBuffer:is,tileBoundsIndexBuffer:Cs,tileBoundsSegments:Ls}=S.getTileBoundsBuffers(Te);us.draw(S,O.TRIANGLES,Wt,as,Fs.alphaBlended,gs.disabled,Pt,C.id,is,Cs,Ls)}}S.resetStencilClippingMasks()}(p,r,c,f),p.style.map.triggerRepaint())},background:function(p,r,c,f){const y=c.paint.get("background-color"),v=c.paint.get("background-color-use-theme").constantOr("default")==="none",S=c.paint.get("background-opacity"),N=c.paint.get("background-emissive-strength"),C=c.paint.get("background-pitch-alignment")==="viewport";if(S===0)return;const k=p.context,D=k.gl,U=p.transform,O=U.tileSize,G=c.paint.get("background-pattern");let ee;if(G!==void 0&&(G===null||(ee=p.imageManager.getPattern(o.I.from(G.toString()),c.scope,p.style.getLut(c.scope)),!ee)))return;const J=!G&&y.a===1&&S===1&&p.opaquePassEnabledForLayer()?"opaque":"translucent";if(p.renderPass!==J)return;const se=Ss.disabled,te=p.depthModeForSublayer(0,J==="opaque"?Kt.ReadWrite:Kt.ReadOnly),le=p.colorModeForDrapableLayerRenderPass(N),de=G?"backgroundPattern":"background";let pe,ye=f;if(ye||(pe=p.getBackgroundTiles(),ye=Object.values(pe).map(Se=>Se.tileID)),G&&(k.activeTexture.set(D.TEXTURE0),p.imageManager.bind(p.context,c.scope)),C){const Se=p.getOrCreateProgram(de,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(o.bx([])),_e=new o.aM(0,0,0,0,0),ve=G?dy(Te,N,S,p,0,c.scope,ee,C,{tileID:_e,tileSize:O}):Jv(Te,N,S,y.toPremultipliedRenderColor(v?null:c.lut));Se.draw(p,D.TRIANGLES,te,se,le,gs.disabled,ve,c.id,p.viewportBuffer,p.quadTriangleIndexBuffer,p.viewportSegments)}else for(const Se of ye){const Te=p.isTileAffectedByFog(Se),_e=p.getOrCreateProgram(de,{overrideFog:Te}),ve=Se.toUnwrapped(),be=f?Se.projMatrix:p.transform.calculateProjMatrix(ve);p.prepareDrawTile();const Ue=r?r.getTile(Se):pe?pe[Se.key]:new pu(Se,O,U.zoom,p),Ie=G?dy(be,N,S,p,0,c.scope,ee,C,{tileID:Se,tileSize:O}):Jv(be,N,S,y.toPremultipliedRenderColor(v?null:c.lut));p.uploadCommonUniforms(k,_e,ve);const{tileBoundsBuffer:tt,tileBoundsIndexBuffer:We,tileBoundsSegments:rt}=p.getTileBoundsBuffers(Ue);_e.draw(p,D.TRIANGLES,te,se,le,gs.disabled,Ie,c.id,tt,We,rt)}},sky:function(p,r,c){const f=p._atmosphere?o.ah(p.transform.zoom):1,y=c.paint.get("sky-opacity")*f;if(y===0)return;const v=p.context,S=c.paint.get("sky-type"),N=new Kt(v.gl.LEQUAL,Kt.ReadOnly,[0,1]),C=p.frameCounter/1e3%1;S==="atmosphere"?p.renderPass==="offscreen"?c.needsSkyboxCapture(p)&&(function(k,D,U,O){const G=k.context,ee=G.gl;let J=D.skyboxFbo;if(!J){J=D.skyboxFbo=G.createFramebuffer(32,32,!0,null),D.skyboxGeometry=new Cu(G),D.skyboxTexture=G.gl.createTexture(),ee.bindTexture(ee.TEXTURE_CUBE_MAP,D.skyboxTexture),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_S,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_WRAP_T,ee.CLAMP_TO_EDGE),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MIN_FILTER,ee.LINEAR),ee.texParameteri(ee.TEXTURE_CUBE_MAP,ee.TEXTURE_MAG_FILTER,ee.LINEAR);for(let de=0;de<6;++de)ee.texImage2D(ee.TEXTURE_CUBE_MAP_POSITIVE_X+de,0,ee.RGBA,32,32,0,ee.RGBA,ee.UNSIGNED_BYTE,null)}G.bindFramebuffer.set(J.framebuffer),G.viewport.set([0,0,32,32]);const se=D.getCenter(k,!0),te=k.getOrCreateProgram("skyboxCapture"),le=new Float64Array(16);o.bx(le),o.eh(le,le,.5*-Math.PI),Wa(k,D,te,le,se,0),o.bx(le),o.eh(le,le,.5*Math.PI),Wa(k,D,te,le,se,1),o.bx(le),o.cR(le,le,.5*-Math.PI),Wa(k,D,te,le,se,2),o.bx(le),o.cR(le,le,.5*Math.PI),Wa(k,D,te,le,se,3),o.bx(le),Wa(k,D,te,le,se,4),o.bx(le),o.eh(le,le,Math.PI),Wa(k,D,te,le,se,5),G.viewport.set([0,0,k.width,k.height])}(p,c),c.markSkyboxValid(p)):p.renderPass==="sky"&&function(k,D,U,O,G){const ee=k.context,J=ee.gl,se=k.transform,te=k.getOrCreateProgram("skybox");ee.activeTexture.set(J.TEXTURE0),J.bindTexture(J.TEXTURE_CUBE_MAP,D.skyboxTexture);const le=((de,pe,ye,Se,Te)=>({u_matrix:de,u_sun_direction:pe,u_cubemap:0,u_opacity:Se,u_temporal_offset:Te}))(se.skyboxMatrix,D.getCenter(k,!1),0,O,G);k.uploadCommonUniforms(ee,te),te.draw(k,J.TRIANGLES,U,Ss.disabled,k.colorModeForRenderPass(),gs.backCW,le,"skybox",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,c,N,y,C):S==="gradient"&&p.renderPass==="sky"&&function(k,D,U,O,G){const ee=k.context,J=ee.gl,se=k.transform,te=k.getOrCreateProgram("skyboxGradient");D.skyboxGeometry||(D.skyboxGeometry=new Cu(ee)),ee.activeTexture.set(J.TEXTURE0);let le=D.colorRampTexture;le||(le=D.colorRampTexture=new o.T(ee,D.colorRamp,J.RGBA8)),le.bind(J.LINEAR,J.CLAMP_TO_EDGE);const de=((pe,ye,Se,Te,_e)=>({u_matrix:pe,u_color_ramp:0,u_center_direction:ye,u_radius:o.al(Se),u_opacity:Te,u_temporal_offset:_e}))(se.skyboxMatrix,D.getCenter(k,!1),D.paint.get("sky-gradient-radius"),O,G);k.uploadCommonUniforms(ee,te),te.draw(k,J.TRIANGLES,U,Ss.disabled,k.colorModeForRenderPass(),gs.backCW,de,"skyboxGradient",D.skyboxGeometry.vertexBuffer,D.skyboxGeometry.indexBuffer,D.skyboxGeometry.segment)}(p,c,N,y,C)},custom:function(p,r,c,f){const y=p.context,v=c.implementation;if(!p.transform.projection.unsupportedLayers||!p.transform.projection.unsupportedLayers.includes("custom")||p.terrain&&(p.terrain.renderingToTexture||p.renderPass==="offscreen")&&c.isDraped(r)){if(p.renderPass==="offscreen"){const S=v.prerender;if(S){if(p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),p.transform.projection.name==="globe"){const N=p.transform.pointMerc;S.call(v,y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.ah(p.transform.zoom),[N.x,N.y],p.transform.pixelsPerMeterRatio)}else S.call(v,y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState()}}else if(p.renderPass==="translucent"){if(p.terrain&&p.terrain.renderingToTexture){const N=v.renderToTile;if(N){const C=f[0].canonical,k={x:C.x+f[0].wrap*(v.wrapTileId?0:1<<C.z),y:C.y,z:C.z};y.setDepthMode(Kt.disabled),y.setStencilMode(Ss.disabled),y.setColorMode(p.colorModeForRenderPass()),p.setCustomLayerDefaults(),N.call(v,y.gl,k),y.setDirty(),p.setBaseState()}return}p.setCustomLayerDefaults(),y.setColorMode(p.colorModeForRenderPass()),y.setStencilMode(Ss.disabled);const S=v.renderingMode==="3d"?new Kt(p.context.gl.LEQUAL,Kt.ReadWrite,p.depthRangeFor3D):p.depthModeForSublayer(0,Kt.ReadOnly);if(y.setDepthMode(S),p.transform.projection.name==="globe"){const N=p.transform.pointMerc;v.render(y.gl,p.transform.customLayerMatrix(),p.transform.getProjection(),p.transform.globeToMercatorMatrix(),o.ah(p.transform.zoom),[N.x,N.y],p.transform.pixelsPerMeterRatio)}else v.render(y.gl,p.transform.customLayerMatrix());y.setDirty(),p.setBaseState(),y.bindFramebuffer.set(null)}}else o.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(p,r,c,f){if(p.renderPass==="opaque")return;const y=c.paint.get("model-opacity").constantOr(1);if(y===0)return;const v=c.paint.get("model-cast-shadows");if(p.renderPass==="shadow"&&(!v||p.terrain&&y<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof o.ab))return;const S=p.shadowRenderer,N=c.paint.get("model-receive-shadows");S&&(S.useNormalOffset=!0,N||(S.enabled=!1));const C=()=>{S&&(S.useNormalOffset=!0,N||(S.enabled=!0))},k=r.getSource();if(p.renderPass==="light-beam"&&k.type!=="batched-model")return;if(k.type==="vector"||k.type==="geojson")return function(te,le,de,pe,ye){const Se=te.transform;if(Se.projection.name!=="mercator")return void o.w(`Drawing 3D models for ${Se.projection.name} projection is not yet implemented`);const Te=Se.getFreeCameraOptions().position;if(!te.modelManager)return;const _e=te.modelManager;de.modelManager=_e;const ve=te.shadowRenderer;if(!de._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const be=de._unevaluatedLayout._values["model-id"],Ue=Object.assign({},de.layout.get("model-id").parameters),Ie=te.style.order.indexOf(de.fqid);for(const tt of pe){const We=le.getTile(tt).getBucket(de);if(!We||We.projection.name!==Se.projection.name)continue;const rt=We.getModelUris();rt&&!We.modelsRequested&&(_e.addModelsFromBucket(rt,ye),We.modelsRequested=!0);const jt=WS(tt,Se);Ue.zoom=jt;const $e=be.possiblyEvaluate(Ue);if(Pd(te,We,tt),ml.shadowUniformsInitialized=!1,ml.useSingleShadowCascade=!!ve&&ve.getMaxCascadeForTile(tt.toUnwrapped())===0,te.renderPass==="shadow"&&ve){if(te.currentShadowCascade===1&&We.isInsideFirstShadowMapFrustum)continue;const Ge=Se.calculatePosMatrix(tt.toUnwrapped(),Se.worldSize);if(ml.tileMatrix.set(Ge),ml.shadowTileMatrix=Float32Array.from(ve.calculateShadowPassMatrixFromMatrix(Ge)),ml.aabb.min.fill(0),ml.aabb.max[0]=ml.aabb.max[1]=o.aj,ml.aabb.max[2]=0,Ty(We,ml,te,de.scope))continue}const Ae=1<<tt.canonical.z,Ke=[((Te.x-tt.wrap)*Ae-tt.canonical.x)*o.aj,(Te.y*Ae-tt.canonical.y)*o.aj,Te.z*Ae*o.aj];te.conflationActive&&Object.keys(We.instancesPerModel).length>0&&te.style.isLayerClipped(de,le.getSource())&&We.updateReplacement(tt,te.replacementSource,Ie,ye)&&(We.uploaded=!1,We.upload(te.context));for(let Ge in We.instancesPerModel){const ht=We.instancesPerModel[Ge];ht.features.length>0&&(Ge=$e.evaluate(ht.features[0].feature,{}));const pt=_e.getModel(Ge,ye);if(pt||_e.hasURLBeenRequested(Ge)||We.modelUris.includes(Ge)||(We.modelUris.push(Ge),We.modelsRequested=!1),pt&&pt.uploaded)for(const mt of pt.nodes)jy(te,de,mt,ht,Ke,tt,ml)}}}(p,r,c,f,k.type==="vector"?c.scope:""),void C();if(!k.loaded())return;if(k.type==="batched-model")return function(te,le,de,pe){de.resetLayerRenderingStats(te);const ye=te.context,Se=te.transform,Te=te.style.fog,_e=te.shadowRenderer;if(Se.projection.name!=="mercator")return void o.w(`Drawing 3D landmark models for ${Se.projection.name} projection is not yet implemented`);const ve=te.transform.getFreeCameraOptions().position,be=o.c1([],[ve.x,ve.y,ve.z],te.transform.worldSize),Ue=o.eq([],be),Ie=o.bx([]),tt=o.e9(Se.center.lat,Se.zoom),We=o.bn([],[1,1,1/tt]);o.bo(Ie,Ie,Ue);const rt=de.paint.get("model-opacity").constantOr(1),jt=new Kt(ye.gl.LEQUAL,Kt.ReadWrite,te.depthRangeFor3D),$e=new Kt(ye.gl.LEQUAL,Kt.ReadOnly,te.depthRangeFor3D),Ae=new o.d6([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),Ke=te.renderPass==="shadow",Ge=Ke&&_e?_e.getCurrentCascadeFrustum():Se.getFrustum(Se.scaleZoom(Se.worldSize)),ht=de.paint.get("model-front-cutoff"),pt=ht[2]<1,mt=pl(te,de.paint.get("model-cutoff-fade-range")),Pt=de.getLayerRenderingStats();(function(ns,us,Wt,as){const is=ns.terrain?ns.terrain.exaggeration():0,Cs=ns.transform.zoom;for(const Ls of as){const Ws=us.getTile(Ls).getBucket(Wt);Ws&&(Ws.setFilter(Wt.filter),ns.conflationActive&&Ws.updateReplacement(Ls,ns.replacementSource),Ws.evaluateTransform(ns,Wt),ns.terrain&&is>0&&Ws.elevationUpdate(ns.terrain,is,Ls,Wt.source),Ws.needsReEvaluation(ns,Cs,Wt)&&Ws.evaluate(Wt))}})(te,le,de,pe),function(){let ns,us,Wt;pt?(ns=pe.length-1,us=-1,Wt=-1):(ns=0,us=pe.length,Wt=1);const as=new Float64Array(16),is=o.cx(),Cs=new o.P(0,0);for(let Ls=ns;Ls!==us;Ls+=Wt){const Ws=pe[Ls],pn=le.getTile(Ws).getBucket(de);if(!pn||!pn.uploaded)continue;let Rs=!1;_e&&(Rs=_e.getMaxCascadeForTile(Ws.toUnwrapped())===0);const fn=Se.calculatePosMatrix(Ws.toUnwrapped(),Se.worldSize),yn=pn.modelTraits;!Ke&&pt&&(o.bi(as,fn),o.ad(is,be,as),Cs.x=is[0],Cs.y=is[1]);const Hn=[];pn.setFilter(de.filter);for(const $s of pn.getNodesInfo()){if($s.hiddenByReplacement||!$s.node.meshes)continue;const mn=$s.node;let gn=0;te.terrain&&mn.elevation&&(gn=mn.elevation*te.terrain.exaggeration());const wn=(()=>{const vi=$s.aabb;return Ae.min=[...vi.min],Ae.max=[...vi.max],Ae.min[2]+=gn,Ae.max[2]+=gn,o.ad(Ae.min,Ae.min,fn),o.ad(Ae.max,Ae.max,fn),Ae})(),qs=$s.evaluatedScale;if(qs[0]<=1&&qs[1]<=1&&qs[2]<=1&&wn.intersects(Ge)===0)continue;if(!Ke&&pt){const vi=.16666666666666666;$s.cameraCollisionOpacity=be[0]>wn.min[0]&&be[0]<wn.max[0]&&be[1]>wn.min[1]&&be[1]<wn.max[1]&&be[2]*tt<wn.max[2]&&mn.footprint&&o.bY(Cs,mn.footprint)?Math.max($s.cameraCollisionOpacity-vi,0):Math.min(1,$s.cameraCollisionOpacity+vi)}const Pn=[...fn],_n=1/o.d4(Ws.canonical),gr=mn.anchor?mn.anchor[0]:0,dn=mn.anchor?mn.anchor[1]:0;o.bo(Pn,Pn,[gr*(qs[0]-1)+$s.evaluatedTranslation[0]*_n,dn*(qs[1]-1)+$s.evaluatedTranslation[1]*_n,gn+$s.evaluatedTranslation[2]]),o.cn(qs,o.es)||o.cP(Pn,Pn,qs);const Sn=o.az([],Pn,mn.matrix),zn=o.az([],Se.expandedFarZProjMatrix,Sn),Or=o.az([],Se.expandedFarZProjMatrix,Pn),Lr=o.aA([],[gr,dn,gn,1],zn)[2];mn.hidden=!1;let Br=rt;Ke||(pt&&(Br*=$s.cameraCollisionOpacity,Br*=c1(Pn,Se,$s.aabb,ht)),Br*=l1(mt,Lr)),Br!==0?Hn.push({nodeInfo:$s,depth:Lr,opacity:Br,wvpForNode:zn,wvpForTile:Or,nodeModelMatrix:Sn,tileModelMatrix:Pn}):mn.hidden=!0}Ke||Hn.sort(($s,mn)=>!pt||$s.opacity===1&&mn.opacity===1?$s.depth<mn.depth?-1:1:$s.opacity===1?-1:mn.opacity===1?1:$s.depth>mn.depth?-1:1);for(const $s of Hn){const mn=$s.nodeInfo,gn=mn.node;let wn=o.az([],We,$s.tileModelMatrix);o.az(wn,Ie,wn);const qs=o.bi([],wn);o.ea(qs,qs),o.cP(qs,qs,Nm),wn=o.az(wn,wn,gn.matrix);const Pn=te.renderPass==="light-beam",_n=de.paint.get("model-color-use-theme").constantOr("default")==="none",gr=yn&o.ex.HasMapboxMeshFeatures,dn=gr?0:mn.evaluatedRMEA[0][2];for(let Sn=0;Sn<gn.meshes.length;++Sn){const zn=gn.meshes[Sn],Or=Sn===gn.lightMeshIndex;let Lr=$s.wvpForNode;if(Or){if(!Pn&&!te.terrain&&te.shadowRenderer){te.currentLayer<te.firstLightBeamLayer&&(te.firstLightBeamLayer=te.currentLayer);continue}Lr=$s.wvpForTile}else if(Pn)continue;const Br={defines:[]},vi=[];if(!Ke&&_e&&(_e.useNormalOffset=!!zn.normalBuffer),Tp(Br.defines,vi,zn,te,_n?null:de.lut),gr||Br.defines.push("DIFFUSE_SHADED"),Rs&&Br.defines.push("SHADOWS_SINGLE_CASCADE"),Pt&&(Ke?Pt.numRenderedVerticesInShadowPass+=zn.vertexArray.length:Pt.numRenderedVerticesInTransparentPass+=zn.vertexArray.length),Ke){Tm(zn,$s.nodeModelMatrix,te,de);continue}let qa=null;if(Te){const Ui=jp($s.nodeModelMatrix,te.transform);if(qa=new Float32Array(Ui),Se.projection.name!=="globe"){const Pr=zn.aabb.min,Sr=zn.aabb.max,[Xn,Hr]=Te.getOpacityForBounds(Ui,Pr[0],Pr[1],Sr[0],Sr[1]);Br.overrideFog=Xn>=ut||Hr>=ut}}const go=zn.material;let Oo;go.occlusionTexture&&go.occlusionTexture.offsetScale&&(Oo=go.occlusionTexture.offsetScale,Br.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Vi=te.getOrCreateProgram("model",Br);!Ke&&_e&&_e.setupShadowsFromMatrix($s.tileModelMatrix,Vi,_e.useNormalOffset),te.uploadCommonUniforms(ye,Vi,null,qa);const oa=go.pbrMetallicRoughness;oa.metallicFactor=.9,oa.roughnessFactor=.5;const Pa=hy(new Float32Array(Lr),new Float32Array(wn),new Float32Array(qs),new Float32Array(gn.matrix),te,$s.opacity,oa.baseColorFactor,go.emissiveFactor,oa.metallicFactor,oa.roughnessFactor,go,dn,de,[0,0,0],Oo);!Or&&(mn.hasTranslucentParts||$s.opacity<1)&&Vi.draw(te,ye.gl.TRIANGLES,jt,Ss.disabled,Fs.disabled,gs.backCCW,Pa,de.id,zn.vertexBuffer,zn.indexBuffer,zn.segments,de.paint,te.transform.zoom,void 0,vi),Vi.draw(te,ye.gl.TRIANGLES,Or?$e:jt,Ss.disabled,Or||$s.opacity<1||mn.hasTranslucentParts?Fs.alphaBlended:Fs.unblended,gs.backCCW,Pa,de.id,zn.vertexBuffer,zn.indexBuffer,zn.segments,de.paint,te.transform.zoom,void 0,vi)}}}}()}(p,r,c,f),void C();if(k.type!=="model")return;const D=k.getModels(),U=[],O=p.transform.getFreeCameraOptions().position,G=o.c1([],[O.x,O.y,O.z],p.transform.worldSize);o.eq(G,G);const ee=[],J=[];let se=0;for(const te of D){const le=c.paint.get("model-rotation").constantOr(null),de=c.paint.get("model-scale").constantOr(null),pe=c.paint.get("model-translation").constantOr(null);te.computeModelMatrix(p,le,de,pe,!0,!0,!1);const ye=o.bx([]),Se=o.e9(te.position.lat,p.transform.zoom),Te=o.bn([],[1,1,1/Se]);o.bo(ye,ye,G),U.push({zScaleMatrix:Te,negCameraPosMatrix:ye});for(const _e of te.nodes)Sy(p.transform,_e,te.matrix,p.transform.expandedFarZProjMatrix,se,ee,J);se++}if(ee.sort((te,le)=>le.depth-te.depth),p.renderPass!=="shadow"){if(y===1)for(const te of J)Ad(te,p,c,U[te.modelIndex],Ss.disabled,p.colorModeForRenderPass());else{for(const te of J)Ad(te,p,c,U[te.modelIndex],Ss.disabled,Fs.disabled);for(const te of J)Ad(te,p,c,U[te.modelIndex],p.stencilModeFor3D(),p.colorModeForRenderPass());p.resetStencilClippingMasks()}for(const te of ee)Ad(te,p,c,U[te.modelIndex],Ss.disabled,p.colorModeForRenderPass());C()}else{for(const te of J)Tm(te.mesh,te.nodeModelMatrix,p,c);for(const te of ee)Tm(te.mesh,te.nodeModelMatrix,p,c);C()}}},Cm={line:function(p,r,c){if(p.hasElevatedBuckets=!1,p.hasNonElevatedBuckets=!1,p._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||p._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(r){const f=r.getVisibleCoordinates();for(const y of f){const v=r.getTile(y).getBucket(p);if(v&&(v.elevationType!=="none"?p.hasElevatedBuckets=!0:p.hasNonElevatedBuckets=!0,p.hasElevatedBuckets&&p.hasNonElevatedBuckets))break}}}else p.hasNonElevatedBuckets=!0},model:function(p,r,c){const f=r.getSource();if(!f.loaded())return;if(f.type==="vector"||f.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,f.type==="vector"?p.scope:""));if(f.type==="batched-model"||f.type!=="model")return;const y=f.getModels();for(const v of y)v.upload(c.context)},raster:function(p,r,c){const f=r.getSource();if(!(f instanceof xc&&f.loaded()))return;const y=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const v=p.paint.get("raster-array-band")||f.getInitialBand(y);if(v==null)return;const S=r.getIds().map(N=>r.getTileByID(N));for(const N of S)N.updateNeeded(p.id,v)&&f.prepareTile(N,y,p.id,v)},"raster-particle":function(p,r,c){const f=r.getSource();if(!(f instanceof xc&&f.loaded()))return;const y=p.sourceLayer||f.rasterLayerIds&&f.rasterLayerIds[0];if(!y)return;const v=p.paint.get("raster-particle-array-band")||f.getInitialBand(y);if(v==null)return;const S=r.getIds().map(N=>r.getTileByID(N));for(const N of S)N.updateNeeded(p.id,v)&&f.prepareTile(N,y,p.id,v)}},Am={fill:Yt},na={fill:function(p,r,c,f){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const y=p.context.gl,v=new Kt(y.LEQUAL,Kt.ReadOnly,p.depthRangeFor3D),S=new Ss({func:y.ALWAYS,mask:255},255,255,y.KEEP,y.KEEP,y.REPLACE),N=p.transform.getFreeCameraOptions().position,C=p.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const k of f){const D=r.getTile(k),U=D.getBucket(c);if(!U)continue;const O=U.elevatedStructures;if(!O||O.depthSegments.segments[0].primitiveLength===0)continue;const G=vp(k.toUnwrapped(),N),ee=p.translatePosMatrix(k.projMatrix,D,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),J=fm(ee,G,0,1,0);C.draw(p,y.TRIANGLES,v,S,Fs.disabled,gs.disabled,J,c.id,O.vertexBuffer,O.indexBuffer,O.depthSegments,c.paint,p.transform.zoom)}}};class kc{constructor(r,c,f,y,v,S){this.context=new _m(r,c),this.transform=f,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=v,this._timeStamp=o.q.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const N=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const k of N)this._debugParams.enabledLayers[k]=!0;v.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},()=>{this.style.map.triggerRepaint()}),v.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),v.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),v.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),v.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const k of N)v.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],k);this.occlusionParams=new Id(v),this.setup(),this.numSublayers=No.maxUnderzooming+No.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new o.eE,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new ES(this),this._wireframeDebugCache=new Np,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const C=new o.r({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new o.T(this.context,C,r.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=y,this.worldview=S}updateTerrain(r,c){const f=!!r&&!!r.terrain&&this.transform.projection.supportsTerrain;if(!(f||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new um(this,r));const y=this._terrain;this.transform.elevation=f?y:null,y.update(r,this.transform,c),this.transform.elevation&&!y.enabled&&(this.transform.elevation=null)}_updateFog(r){const c=r.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[f,y]=c.getFovAdjustedRange(this.transform._fov);if(f>y)return void(this.transform.fogCullDistSq=null);const v=f+.78*(y-f);this.transform.fogCullDistSq=v*v}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(r){r&&!this._terrain&&(this._terrain=new um(this,this.style)),this._forceTerrainMode=r}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(r,c){if(this.width=r*o.q.devicePixelRatio,this.height=c*o.q.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const f of this.style.order)this.style._mergedLayers[f].resize()}setup(){const r=this.context,c=new o.ba;c.emplaceBack(0,0),c.emplaceBack(o.aj,0),c.emplaceBack(0,o.aj),c.emplaceBack(o.aj,o.aj),this.tileExtentBuffer=r.createVertexBuffer(c,o.bc.members),this.tileExtentSegments=o.bd.simpleSegment(0,0,4,2);const f=new o.ba;f.emplaceBack(0,0),f.emplaceBack(o.aj,0),f.emplaceBack(0,o.aj),f.emplaceBack(o.aj,o.aj),this.debugBuffer=r.createVertexBuffer(f,o.bc.members),this.debugSegments=o.bd.simpleSegment(0,0,4,5);const y=new o.ba;y.emplaceBack(-1,-1),y.emplaceBack(1,-1),y.emplaceBack(-1,1),y.emplaceBack(1,1),this.viewportBuffer=r.createVertexBuffer(y,o.bc.members),this.viewportSegments=o.bd.simpleSegment(0,0,4,2);const v=new o.aZ;v.emplaceBack(0,0,0,0),v.emplaceBack(o.aj,0,o.aj,0),v.emplaceBack(0,o.aj,0,o.aj),v.emplaceBack(o.aj,o.aj,o.aj,o.aj),this.mercatorBoundsBuffer=r.createVertexBuffer(v,o.bf.members),this.mercatorBoundsSegments=o.bd.simpleSegment(0,0,4,2);const S=new o.a_;S.emplaceBack(0,1,2),S.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=r.createIndexBuffer(S);const N=new o.bb;for(const k of[0,1,3,2,0])N.emplaceBack(k);this.debugIndexBuffer=r.createIndexBuffer(N),this.emptyTexture=new o.T(r,new o.r({width:1,height:1},Uint8Array.of(0,0,0,0)),r.gl.RGBA8),this.identityMat=o.bz();const C=this.context.gl;this.stencilClearMode=new Ss({func:C.ALWAYS,mask:0},0,255,C.ZERO,C.ZERO,C.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(r){return r._makeTileBoundsBuffers(this.context,this.transform.projection),r._tileBoundsBuffer?{tileBoundsBuffer:r._tileBoundsBuffer,tileBoundsIndexBuffer:r._tileBoundsIndexBuffer,tileBoundsSegments:r._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const r=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,r.TRIANGLES,Kt.disabled,this.stencilClearMode,Fs.disabled,gs.disabled,lm(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(r,c,f){if(!c||this.currentStencilSource===c.id||!r.isTileClipped()||!f||f.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let N=!1;for(const C of f)if(this._tileClippingMaskIDs[C.key]===void 0){N=!0;break}if(!N)return}this.currentStencilSource=c.id;const y=this.context,v=y.gl;this.nextStencilID+f.length>256&&this.clearStencil(),y.setColorMode(Fs.disabled),y.setDepthMode(Kt.disabled);const S=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const N of f){const C=c.getTile(N),k=this._tileClippingMaskIDs[N.key]=this.nextStencilID++,{tileBoundsBuffer:D,tileBoundsIndexBuffer:U,tileBoundsSegments:O}=this.getTileBoundsBuffers(C);S.draw(this,v.TRIANGLES,Kt.disabled,new Ss({func:v.ALWAYS,mask:0},k,255,v.KEEP,v.KEEP,v.REPLACE),Fs.disabled,gs.disabled,lm(N.projMatrix),"$clipping",D,U,O)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const r=this.nextStencilID++,c=this.context.gl;return new Ss({func:c.NOTEQUAL,mask:255},r,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(r){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(r);const c=this.context.gl;return new Ss({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[r.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(r){const c=this.context.gl,f=r.sort((S,N)=>N.overscaledZ-S.overscaledZ),y=f[f.length-1].overscaledZ,v=f[0].overscaledZ-y+1;if(v>1){this.currentStencilSource=void 0,this.nextStencilID+v>256&&this.clearStencil();const S={};for(let N=0;N<v;N++)S[N+y]=new Ss({func:c.GEQUAL,mask:255},N+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=v,[S,f]}return[{[y]:Ss.disabled},f]}colorModeForRenderPass(){const r=this.context.gl;return this._showOverdrawInspector?new Fs([r.CONSTANT_COLOR,r.ONE,r.CONSTANT_COLOR,r.ONE],new o.am(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?Fs.unblended:Fs.alphaBlended}colorModeForDrapableLayerRenderPass(r){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new Fs([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new o.am(0,0,0,r===void 0?0:r),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(r,c,f,y=!1){if(this.depthOcclusion)return new Kt(this.context.gl.GREATER,Kt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!y)return Kt.disabled;const v=1-((1+this.currentLayer)*this.numSublayers+r)*this.depthEpsilon;return new Kt(f||this.context.gl.LEQUAL,c,[v,v])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const r=this.context.gl,c=Math.ceil(this.width),f=Math.ceil(this.height),y=this.context.bindFramebuffer.get(),v=r.getParameter(r.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===f||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&f!==0&&(this.depthFBO=new Nu(this.context,c,f,!1,"texture"),this.depthTexture=new o.T(this.context,{width:c,height:f,data:null},r.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(y),r.bindTexture(r.TEXTURE_2D,v),this.depthFBO&&(r.bindFramebuffer(r.READ_FRAMEBUFFER,null),r.bindFramebuffer(r.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),r.blitFramebuffer(0,0,c,f,0,0,c,f,r.DEPTH_BUFFER_BIT,r.NEAREST),r.bindFramebuffer(r.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce((r,c)=>r+c/this._fpsHistory.length,0))}render(r,c){const f=o.q.now();this._dt=f-this._timeStamp,this._timeStamp=f,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=r.map.repaint,this.style=r,this.options=c;const y=this.style._mergedLayers,v=!(!this.terrain||!this.terrain.enabled),S=()=>this.style._getOrder(v).filter($e=>{const Ae=y[$e];return!(Ae.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Ae.type]});let N=S(),C=!1,k=!1,D=null;for(const $e of N){const Ae=y[$e];Ae.type==="circle"?C=!0:Ae.type==="building"?D=Ae:Ae.type==="symbol"&&(Ae.hasInitialOcclusionOpacityProperties?k=!0:C=!0)}let U=N.map($e=>y[$e]);const O=this.style._mergedSourceCaches;this.imageManager=r.imageManager,this.modelManager=r.modelManager,this.symbolFadeChange=r.placement.symbolFadeChange(o.q.now()),this.imageManager.beginFrame();let G=0,ee=!1;for(const $e in O){const Ae=O[$e];Ae.used&&(Ae.prepare(this.context),Ae.getSource().usedInConflation&&++G)}let J=!1;for(const $e of U)$e.isHidden(this.transform.zoom)||($e.type==="clip"&&(J=!0),this.prepareLayer($e));const se={},te={},le={},de={},pe={};for(const $e in O){const Ae=O[$e];se[$e]=Ae.getVisibleCoordinates(),te[$e]=se[$e].slice().reverse(),le[$e]=Ae.getVisibleCoordinates(!0).reverse(),de[$e]=Ae.getShadowCasterCoordinates(),pe[$e]=Ae.sortCoordinatesByDistance(se[$e])}const ye=$e=>{const Ae=this.style.getLayerSourceCache($e);return Ae&&Ae.used?Ae.getSource():null};if(G||J||this._clippingActiveLastFrame){const $e=[],Ae=[];let Ke=0;for(const Ge of U)this.isSourceForClippingOrConflation(Ge,ye(Ge))&&($e.push(Ge),Ae.push(Ke)),Ke++;if($e&&(J||$e.length>1)||this._clippingActiveLastFrame){J=!1;const Ge=[];for(let ht=0;ht<$e.length;ht++){const pt=$e[ht],mt=Ae[ht],Pt=this.style.getLayerSourceCache(pt);if(!Pt||!Pt.used||!Pt.getSource().usedInConflation&&pt.type!=="clip"&&pt.type!=="building")continue;let ns=o.eF,us=o.bW.None;const Wt=[];let as=!0;if(pt.type==="building")ns=o.eH;else if(pt.type==="clip"){ns=mt;for(const is of pt.layout.get("clip-layer-types"))us|=is==="model"?o.bW.Model:is==="symbol"?o.bW.Symbol:o.bW.FillExtrusion;for(const is of pt.layout.get("clip-layer-scope"))Wt.push(is);pt.isHidden(this.transform.zoom)?as=!1:J=!0}as&&Ge.push({layer:pt.fqid,cache:Pt,order:ns,clipMask:us,clipScope:Wt})}this.replacementSource.setSources(Ge),ee=!0}}this._clippingActiveLastFrame=J,ee||this.replacementSource.clear(),this.conflationActive=ee,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let $e=0;$e<U.length;$e++){const Ae=U[$e],Ke=Ae.cutoffRange();if(this.longestCutoffRange=Math.max(Ke,this.longestCutoffRange),Ke>0){const Ge=ye(Ae);Ge&&(this.minCutoffZoom=Math.max(Ge.minzoom,this.minCutoffZoom)),Ae.minzoom&&(this.minCutoffZoom=Math.max(Ae.minzoom,this.minCutoffZoom))}Ae.is3D(v)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=$e),this._lastOcclusionLayer=$e)}const Se=this.style&&this.style.fog;Se?(this._fogVisible=Se.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=Se.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(le),this.opaquePassCutoff=0,N=S(),U=N.map($e=>y[$e]));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const $e in O)for(const Ae of se[$e]){let Ke={min:0,max:0};this.terrain&&(Ke=this.terrain.getMinMaxForTile(Ae)||Ke),Te.addShadowReceiver(Ae.toUnwrapped(),Ke.min,Ke.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new o.eG(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new Oe(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const _e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),ve=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(_e&&!this._snow&&(this._snow=new Ey(this)),!_e&&this._snow&&(this._snow.destroy(),delete this._snow),ve&&!this._rain&&(this._rain=new Rd(this)),!ve&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),D){this.buildingTileBorderManager||(this.buildingTileBorderManager=new a1);const $e=this.style.getLayerSourceCache(D);this.buildingTileBorderManager.updateBorders($e,D)}if(!tn.has(this.context.gl))return;this.renderPass="offscreen";for(const $e of U){const Ae=r.getLayerSourceCache($e);if(!$e.hasOffscreenPass()||$e.isHidden(this.transform.zoom))continue;const Ke=Ae?te[Ae.id]:void 0;($e.type==="custom"||$e.type==="raster"||$e.type==="raster-particle"||$e.isSky()||Ke&&Ke.length)&&this.renderLayer(this,Ae,$e,Ke)}this.depthRangeFor3D=[0,1-(U.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,de)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const be=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),Ue=(()=>{if(c.showOverdrawInspector)return o.am.black;const $e=this.style.fog;if($e&&this.transform.projection.supportsFog){const Ae=this.style.getLut($e.scope);if(!be){const Ke=$e.properties.get("color-use-theme")==="none",Ge=$e.properties.get("color").toNonPremultipliedRenderColor(Ke?null:Ae).toArray01();return new o.am(...Ge)}if(be){const Ke=$e.properties.get("space-color-use-theme")==="none",Ge=$e.properties.get("space-color").toNonPremultipliedRenderColor(Ke?null:Ae).toArray01();return new o.am(...Ge)}}return o.am.transparent})();if(this.context.clear({color:Ue,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=N.length-1;this.currentLayer>=0;this.currentLayer--){const $e=U[this.currentLayer],Ae=r.getLayerSourceCache($e);if($e.isSky())continue;const Ke=Ae?($e.is3D(v)?pe:te)[Ae.id]:void 0;this._renderTileClippingMasks($e,Ae,Ke),this.renderLayer(this,Ae,$e,Ke)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&be&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||o.ah(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<N.length;this.currentLayer++){const $e=U[this.currentLayer],Ae=r.getLayerSourceCache($e);$e.isSky()&&this.renderLayer(this,Ae,$e,Ae?te[Ae.id]:void 0)}function Ie($e,Ae){let Ke;return Ae&&(Ke=($e.type==="symbol"?le:$e.is3D(v)?pe:te)[Ae.id]),Ke}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<N.length;){const $e=U[this.currentLayer];if($e.type==="raster"||$e.type==="raster-particle"){const Ae=r.getLayerSourceCache($e);this.renderLayer(this,Ae,$e,Ie($e,Ae))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let tt=0;Te&&(tt=Te.getShadowCastingLayerCount());let We=!1,rt=-1;for(let $e=0;$e<N.length;++$e){const Ae=U[$e];Ae.isHidden(this.transform.zoom)||Ae.is3D(v)&&(rt=$e)}k&&rt===-1&&(C=!0);let jt=!1;for(;this.currentLayer<N.length;){const $e=U[this.currentLayer],Ae=r.getLayerSourceCache($e);if($e.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped($e)){if($e.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!jt&&$e.is3D(v)&&!v){const Ke=this.currentLayer,Ge=ht=>{for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const pt=U[this.currentLayer];if(Am[pt.type]){const mt=this.style.getLayerSourceCache(pt);Am[pt.type](this,mt,pt,Ie(pt,mt),ht)}}};Ge("initialize"),Ge("reset"),this.currentLayer=Ke,jt=!0}if(C&&!We&&this.terrain&&!this.transform.isOrthographic&&(We=!0,this.blitDepth()),k&&rt!==-1&&this.currentLayer===rt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks($e,Ae,Ae?se[Ae.id]:void 0),this.renderLayer(this,Ae,$e,Ie($e,Ae)),!this.terrain&&Te&&tt>0&&$e.hasShadowPass()&&--tt==0){{this.clearStencil(),this.resetStencilClippingMasks();const Ke=this.currentLayer;for(this.currentLayer=0;this.currentLayer<U.length;this.currentLayer++){const Ge=U[this.currentLayer];if(na[Ge.type]){const ht=this.style.getLayerSourceCache(Ge);na[Ge.type](this,ht,Ge,Ie(Ge,ht))}}this.currentLayer=Ke}if(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const Ke=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=Ke;this.currentLayer++){const Ge=U[this.currentLayer];if(!Ge.hasLightBeamPass())continue;const ht=r.getLayerSourceCache(Ge);this.renderLayer(this,ht,Ge,ht?te[ht.id]:void 0)}this.currentLayer=Ke,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const Ke=this.currentLayer;this.depthOcclusion=!0;for(const Ge of this.layersWithOcclusionOpacity){this.currentLayer=Ge;const ht=U[this.currentLayer],pt=r.getLayerSourceCache(ht),mt=pt?te[pt.id]:void 0;this.terrain||this._renderTileClippingMasks(ht,pt,pt?se[pt.id]:void 0),this.renderLayer(this,pt,ht,mt)}this.depthOcclusion=!1,this.currentLayer=Ke,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let $e=null;U.forEach(Ae=>{const Ke=r.getLayerSourceCache(Ae);Ke&&!Ae.isHidden(this.transform.zoom)&&Ke.getVisibleCoordinates().length&&(!$e||$e.getSource().maxzoom<Ke.getSource().maxzoom)&&($e=Ke)}),$e&&this.options.showTileBoundaries&&fl(this,$e,$e.getVisibleCoordinates(),o.am.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&fl(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new o.am(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&function($e){const Ae=$e.transform.padding;wp($e,$e.transform.height-(Ae.top||0),3,n1),wp($e,Ae.bottom||0,3,vy),jm($e,Ae.left||0,3,by),jm($e,$e.transform.width-(Ae.right||0),3,wy);const Ke=$e.transform.centerPoint;(function(Ge,ht,pt,mt){Sp(Ge,ht-1,pt-10,2,20,mt),Sp(Ge,ht-10,pt-1,20,2,mt)})($e,Ke.x,$e.transform.height-Ke.y,r1)}(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),ee||(this.conflationActive=!1)}prepareLayer(r){this.gpuTimingStart(r);const{unsupportedLayers:c}=this.transform.projection,f=!c||!c.includes(r.type);if(Cm[r.type]&&(f||this.terrain&&r.type==="custom")){const y=this.style.getLayerSourceCache(r);Cm[r.type](r,y,this)}this.gpuTimingEnd()}renderLayer(r,c,f,y){f.isHidden(this.transform.zoom)||(f.type==="background"||f.type==="sky"||f.type==="custom"||f.type==="model"||f.type==="raster"||f.type==="raster-particle"||y&&y.length)&&(this.id=f.id,this.gpuTimingStart(f),r.transform.projection.unsupportedLayers&&r.transform.projection.unsupportedLayers.includes(f.type)&&(!r.terrain||f.type!=="custom")||f.type==="clip"||Cy[f.type](r,c,f,y,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(r){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,f=this.context.gl;let y=this.gpuTimers[r.id];y||(y=this.gpuTimers[r.id]={calls:0,cpuTime:0,query:f.createQuery()}),y.calls++,f.beginQuery(c.TIME_ELAPSED_EXT,y.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const r=this.context.extTimerQuery,c=this.context.gl,f=c.createQuery();this.deferredRenderGpuTimeQueries.push(f),c.beginQuery(r.TIME_ELAPSED_EXT,f)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const r=this.gpuTimers;return this.gpuTimers={},r}collectDeferredRenderGpuQueries(){const r=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],r}queryGpuTimers(r){const c={};for(const f in r){const y=r[f],v=this.context.extTimerQuery,S=v.getQueryParameter(y.query,this.context.gl.QUERY_RESULT)/1e6;v.deleteQueryEXT(y.query),c[f]=S}return c}queryGpuTimeDeferredRender(r){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let f=0;for(const y of r)f+=c.getQueryParameter(y,c.QUERY_RESULT)/1e6,c.deleteQuery(y);return f}translatePosMatrix(r,c,f,y,v){if(!f[0]&&!f[1])return r;const S=v?y==="map"?this.transform.angle:0:y==="viewport"?-this.transform.angle:0;if(S){const k=Math.sin(S),D=Math.cos(S);f=[f[0]*D-f[1]*k,f[0]*k+f[1]*D]}const N=[v?f[0]:o.aw(c,f[0],this.transform.zoom),v?f[1]:o.aw(c,f[1],this.transform.zoom),0],C=new Float32Array(16);return o.bo(C,r,N),C}saveTileTexture(r){if(r.context!==this.context)return;const c=r.size[0],f=this._tileTextures[c];f?f.push(r):this._tileTextures[c]=[r]}getTileTexture(r){const c=this._tileTextures[r];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(r,c,f){const y=f===void 0?this.terrain&&this.terrain.renderingToTexture:f,v=[];return this.style&&this.style.enable3dLights()&&(r==="globeRaster"||r==="terrainRaster"?(v.push("LIGHTING_3D_MODE"),v.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):y||v.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||v.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(v.push("TERRAIN"),this.linearFloatFilteringSupported()&&v.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&v.push("GLOBE"),!this._fogVisible||y||c!==void 0&&!c||v.push("FOG","FOG_DITHERING"),y&&v.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&v.push("OVERDRAW_INSPECTOR"),v}getOrCreateProgram(r,c){this.cache=this.cache||{};const f=c&&c.defines||[],y=c&&c.config,v=this.currentGlobalDefines(r,c&&c.overrideFog,c&&c.overrideRtt).concat(f),S=hm.cacheKey(mp[r],r,v,y);return this.cache[S]||(this.cache[S]=new hm(this.context,r,mp[r],y,e1[r],v)),this.cache[S]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const r=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(r.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new o.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(r,c){if(this.style.enable3dLights()){const f=this.style.directionalLight,y=this.style.ambientLight;if(f&&y){const v=((S,N,C)=>{const k=S.properties.get("direction"),D=S.properties.get("color-use-theme")==="none",U=S.properties.get("color").toNonPremultipliedRenderColor(D?null:C.getLut(S.scope)).toArray01(),O=S.properties.get("intensity"),G=N.properties.get("color-use-theme")==="none",ee=N.properties.get("color").toNonPremultipliedRenderColor(G?null:C.getLut(N.scope)).toArray01(),J=N.properties.get("intensity"),se=[k.x,k.y,k.z],te=o.dI(ee,J),le=o.dI(U,O);return{u_lighting_ambient_color:te,u_lighting_directional_dir:se,u_lighting_directional_color:le,u_ground_radiance:ny(se,le,te)}})(f,y,this.style);c.setLightsUniformValues(r,v)}}}uploadCommonUniforms(r,c,f,y,v){if(this.uploadCommonLightUniforms(r,c),this.terrain&&this.terrain.renderingToTexture)return;const S=this.style.fog;if(S){const N=S.getOpacity(this.transform.pitch),C=((k,D,U,O,G,ee,J,se,te,le,de,pe)=>{const ye=k.transform,Se=D.properties.get("color-use-theme")==="none",Te=D.properties.get("color").toNonPremultipliedRenderColor(Se?null:k.style.getLut(D.scope)).toArray01();Te[3]=O;const _e=k.frameCounter/1e3%1,[ve,be]=D.properties.get("vertical-range");return{u_fog_matrix:U?ye.calculateFogTileMatrix(U):pe||k.identityMat,u_fog_range:D.getFovAdjustedRange(ye._fov),u_fog_color:Te,u_fog_horizon_blend:D.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(ve,be),be],u_fog_temporal_offset:_e,u_frustum_tl:G,u_frustum_tr:ee,u_frustum_br:J,u_frustum_bl:se,u_globe_pos:te,u_globe_radius:le,u_viewport:de,u_globe_transition:o.ah(ye.zoom),u_is_globe:+(ye.projection.name==="globe")}})(this,S,f,N,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*o.q.devicePixelRatio,this.transform.height*o.q.devicePixelRatio],y);c.setFogUniformValues(r,C)}v&&c.setCutoffUniformValues(r,v.uniformValues)}setTileLoadedFlag(r){this.tileLoaded=r}saveCanvasCopy(){const r=this.canvasCopy();r&&(this.frameCopies.push(r),this.tileLoaded=!1)}canvasCopy(){const r=this.context.gl,c=r.createTexture();return r.bindTexture(r.TEXTURE_2D,c),r.copyTexImage2D(r.TEXTURE_2D,0,r.RGBA,0,0,r.drawingBufferWidth,r.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const r=this.style&&this.style.fog;return!!r&&r.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const r=this._backgroundTiles,c=this._backgroundTiles={},f=this.transform.coveringTiles({tileSize:512});for(const y of f)c[y.key]=r[y.key]||new pu(y,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(r,c){return!(!r.is3D(!(!this.terrain||!this.terrain.enabled))||r.type!=="clip"&&r.type!=="building"&&(r.minzoom&&r.minzoom>this.transform.zoom||(this.style._clipLayerPresent||r.sourceLayer!=="building"&&r.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(r){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[r.key];return c||(this._cachedTileFogOpacities[r.key]=c=this.style.fog.getOpacityForTile(r)),c[0]>=ut||c[1]>=ut}setupDepthForOcclusion(r,c,f){const y=this.context,v=y.gl,S=!!f;var N;f||(f={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),y.activeTexture.set(v.TEXTURE3),r&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),f.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],f.u_depth_range_unpack=[2/((N=this.depthRangeFor3D)[1]-N[0]),-1-2*N[0]/(N[1]-N[0])],f.u_occluder_half_size=.5*this.occlusionParams.occluderSize,f.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(v.NEAREST,v.CLAMP_TO_EDGE),y.activeTexture.set(v.TEXTURE0),S||c.setTerrainUniformValues(y,f)}}function kd(p,r){let c=!1,f=null;const y=()=>{f=null,c&&(p(),f=setTimeout(y,r),c=!1)};return()=>(c=!0,f||y(),f)}class Pm{constructor(r){this._hashName=r&&encodeURIComponent(r),o.aV(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=kd(this._updateHashUnthrottled.bind(this),300)}addTo(r){return this._map=r,window.addEventListener("hashchange",this._onHashChange,!1),r.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const r=this._map;if(!r)return"";const c=Im(r);if(this._hashName){const f=this._hashName;let y=!1;const v=location.hash.slice(1).split("&").map(S=>{const N=S.split("=")[0];return N===f?(y=!0,`${N}=${c}`):S}).filter(S=>S);return y||v.push(`${f}=${c}`),`#${v.join("&")}`}return`#${c}`}_getCurrentHash(){const r=location.hash.replace("#","");if(this._hashName){let c;return r.split("&").map(f=>f.split("=")).forEach(f=>{f[0]===this._hashName&&(c=f)}),(c&&c[1]||"").split("/")}return r.split("/")}_onHashChange(){const r=this._map;if(!r)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some(f=>isNaN(Number(f)))){const f=r.dragRotate.isEnabled()&&r.touchZoomRotate.isEnabled()?+(c[3]||0):r.getBearing();return r.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:f,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Im(p,r){const c=p.getCenter(),f=Math.round(100*p.getZoom())/100,y=Math.ceil((f*Math.LN2+Math.log(512/360/.5))/Math.LN10),v=Math.pow(10,y),S=Math.round(c.lng*v)/v,N=Math.round(c.lat*v)/v,C=p.getBearing(),k=p.getPitch();let D=r?`/${S}/${N}/${f}`:`${f}/${N}/${S}`;return(C||k)&&(D+="/"+Math.round(10*C)/10),k&&(D+=`/${Math.round(k)}`),D}const Dd={linearity:.3,easing:o.eI(0,0,.3,1)},Dc=o.h({deceleration:2500,maxSpeed:1400},Dd),Ay=o.h({deceleration:20,maxSpeed:1400},Dd),gl=o.h({deceleration:1e3,maxSpeed:360},Dd),Py=o.h({deceleration:1e3,maxSpeed:90},Dd);class Mm{constructor(r){this._map=r,this.clear()}clear(){this._inertiaBuffer=[]}record(r){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:o.q.now(),settings:r})}_drainInertiaBuffer(){const r=this._inertiaBuffer,c=o.q.now();for(;r.length>0&&c-r[0].time>160;)r.shift()}_onMoveEnd(r){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new o.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:v}of this._inertiaBuffer)c.zoom+=v.zoomDelta||0,c.bearing+=v.bearingDelta||0,c.pitch+=v.pitchDelta||0,v.panDelta&&c.pan._add(v.panDelta),v.around&&(c.around=v.around),v.pinchAround&&(c.pinchAround=v.pinchAround);const f=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,y={};if(c.pan.mag()){const v=zd(c.pan.mag(),f,o.h({},Dc,r||{}));y.offset=c.pan.mult(v.amount/c.pan.mag()),y.center=this._map.transform.center,Ld(y,v)}if(c.zoom){const v=zd(c.zoom,f,Ay);y.zoom=this._map.transform.zoom+v.amount,Ld(y,v)}if(c.bearing){const v=zd(c.bearing,f,gl);y.bearing=this._map.transform.bearing+o.ay(v.amount,-179,179),Ld(y,v)}if(c.pitch){const v=zd(c.pitch,f,Py);y.pitch=this._map.transform.pitch+v.amount,Ld(y,v)}if(y.zoom||y.bearing){const v=c.pinchAround===void 0?c.around:c.pinchAround;y.around=v?this._map.unproject(v):this._map.getCenter()}return this.clear(),y.noMoveStart=!0,y}}function Ld(p,r){(!p.duration||p.duration<r.duration)&&(p.duration=r.duration,p.easing=r.easing)}function zd(p,r,c){const{maxSpeed:f,linearity:y,deceleration:v}=c,S=o.ay(p*y/(r/1e3),-f,f),N=Math.abs(S)/(v*y);return{easing:c.easing,duration:1e3*N,amount:S*(N/2)}}class ur extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,f,y={}){const v=Le(c.getCanvasContainer(),f),S=c.unproject(v);super(r,o.h({point:v,lngLat:S,originalEvent:f},y)),this._defaultPrevented=!1,this.target=c}}class Od extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c,f){const y=r==="touchend"?f.changedTouches:f.touches,v=ct(c.getCanvasContainer(),y),S=v.map(C=>c.unproject(C)),N=v.reduce((C,k,D,U)=>C.add(k.div(U.length)),new o.P(0,0));super(r,{points:v,point:N,lngLats:S,lngLat:c.unproject(N),originalEvent:f}),this._defaultPrevented=!1}}class Iy extends o.A{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(r,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class My{constructor(r,c){this._map=r,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(r){return this._firePreventable(new Iy(this._map,r))}mousedown(r,c){return this._mousedownPos=c,this._firePreventable(new ur(r.type,this._map,r))}mouseup(r){this._map.fire(new ur(r.type,this._map,r))}preclick(r){const c=o.h({},r);c.type="preclick",this._map.fire(new ur(c.type,this._map,c))}click(r,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(r),this._map.fire(new ur(r.type,this._map,r)))}dblclick(r){return this._firePreventable(new ur(r.type,this._map,r))}mouseover(r){this._map.fire(new ur(r.type,this._map,r))}mouseout(r){this._map.fire(new ur(r.type,this._map,r))}touchstart(r){return this._firePreventable(new Od(r.type,this._map,r))}touchmove(r){this._map.fire(new Od(r.type,this._map,r))}touchend(r){this._map.fire(new Od(r.type,this._map,r))}touchcancel(r){this._map.fire(new Od(r.type,this._map,r))}_firePreventable(r){if(this._map.fire(r),r.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Pu{constructor(r){this._map=r}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(r){this._map.fire(new ur(r.type,this._map,r))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new ur("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(r){this._delayContextMenu?this._contextMenuEvent=r:this._map.fire(new ur(r.type,this._map,r)),this._map.listens("contextmenu")&&r.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Ry{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._container=r.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(r,c){this.isEnabled()&&r.shiftKey&&r.button===0&&(oe(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(r,c){if(!this._active)return;const f=c,y=this._startPos,v=this._lastPos;if(!y||!v||v.equals(f)||!this._box&&f.dist(y)<this._clickTolerance)return;this._lastPos=f,this._box||(this._box=H("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",r));const S=Math.min(y.x,f.x),N=Math.max(y.x,f.x),C=Math.min(y.y,f.y),k=Math.max(y.y,f.y);this._map._requestDomTask(()=>{this._box&&(this._box.style.transform=`translate(${S}px,${C}px)`,this._box.style.width=N-S+"px",this._box.style.height=k-C+"px")})}mouseupWindow(r,c){if(!this._active)return;const f=this._startPos,y=c;if(f&&r.button===0){if(this.reset(),Pe(),f.x!==y.x||f.y!==y.y)return this._map.fire(new o.A("boxzoomend",{originalEvent:r})),{cameraAnimation:v=>v.fitScreenCoordinates(f,y,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",r)}}keydown(r){this._active&&r.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",r))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),ae(),delete this._startPos,delete this._lastPos}_fireEvent(r,c){return this._map.fire(new o.A(r,{originalEvent:c}))}}function Cp(p,r){const c={};for(let f=0;f<p.length;f++)c[p[f].identifier]=r[f];return c}class ky{constructor(r){this.reset(),this.numTouches=r.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(r,c,f){(this.centroid||f.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=r.timeStamp),f.length===this.numTouches&&(this.centroid=function(y){const v=new o.P(0,0);for(const S of y)v._add(S);return v.div(y.length)}(c),this.touches=Cp(f,c)))}touchmove(r,c,f){if(this.aborted||!this.centroid)return;const y=Cp(f,c);for(const v in this.touches){const S=y[v];(!S||S.dist(this.touches[v])>30)&&(this.aborted=!0)}}touchend(r,c,f){if((!this.centroid||r.timeStamp-this.startTime>500)&&(this.aborted=!0),f.length===0){const y=!this.aborted&&this.centroid;if(this.reset(),y)return y}}}class Lc{constructor(r){this.singleTap=new ky(r),this.numTaps=r.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(r,c,f){this.singleTap.touchstart(r,c,f)}touchmove(r,c,f){this.singleTap.touchmove(r,c,f)}touchend(r,c,f){const y=this.singleTap.touchend(r,c,f);if(y){const v=r.timeStamp-this.lastTime<500,S=!this.lastTap||this.lastTap.dist(y)<30;if(v&&S||this.reset(),this.count++,this.lastTime=r.timeStamp,this.lastTap=y,this.count===this.numTaps)return this.reset(),y}}}class Dy{constructor(){this._zoomIn=new Lc({numTouches:1,numTaps:2}),this._zoomOut=new Lc({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(r,c,f){this._zoomIn.touchstart(r,c,f),this._zoomOut.touchstart(r,c,f)}touchmove(r,c,f){this._zoomIn.touchmove(r,c,f),this._zoomOut.touchmove(r,c,f)}touchend(r,c,f){const y=this._zoomIn.touchend(r,c,f),v=this._zoomOut.touchend(r,c,f);return y?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()+1,around:S.unproject(y)},{originalEvent:r})}):v?(this._active=!0,r.preventDefault(),setTimeout(()=>this.reset(),0),{cameraAnimation:S=>S.easeTo({duration:300,zoom:S.getZoom()-1,around:S.unproject(v)},{originalEvent:r})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const Ly={0:1,2:2},Rm={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class Fd{constructor(r){this.reset(),this._clickTolerance=r.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(r,c){return!1}_move(r,c){return{}}mousedown(r,c){if(this._lastPoint)return;const f=xt(r);this._correctButton(r,f)&&(this._lastPoint=c,this._eventButton=f)}mousemoveWindow(r,c){const f=this._lastPoint;if(f){if(r.preventDefault(),this._eventButton!=null&&function(y,v){const S=Ly[v];return y.buttons===void 0||(y.buttons&S)!==S}(r,this._eventButton))this.reset();else if(this._moved||!(c.dist(f)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(f,c)}}mouseupWindow(r){this._lastPoint&&xt(r)===this._eventButton&&(this._moved&&Pe(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class zy extends Fd{mousedown(r,c){super.mousedown(r,c),this._lastPoint&&(this._active=!0)}_correctButton(r,c){return c===0&&!r.ctrlKey}_move(r,c){return{around:c,panDelta:c.sub(r)}}}class km extends Fd{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Rm[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const f=.8*(c.x-r.x);if(f)return this._active=!0,{bearingDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class Oy extends Fd{constructor(r){super(r),this._pitchRotateKey=r.pitchRotateKey?Rm[r.pitchRotateKey]:void 0}_correctButton(r,c){return this._pitchRotateKey?c===0&&r[this._pitchRotateKey]:c===0&&r.ctrlKey||c===2}_move(r,c){const f=-.5*(c.y-r.y);if(f)return this._active=!0,{pitchDelta:f}}contextmenu(r){this._pitchRotateKey||r.preventDefault()}}class d1{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),o.aV(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new o.P(0,0)}touchstart(r,c,f){return this._calculateTransform(r,c,f)}touchmove(r,c,f){if(this._active&&!(f.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(f.length===1&&!o.eJ())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return r.cancelable&&r.preventDefault(),this._calculateTransform(r,c,f)}}touchend(r,c,f){this._calculateTransform(r,c,f),this._active&&f.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(r,c,f){f.length>0&&(this._active=!0);const y=Cp(f,c),v=new o.P(0,0),S=new o.P(0,0);let N=0;for(const k in y){const D=y[k],U=this._touches[k];U&&(v._add(D),S._add(D.sub(U)),N++,y[k]=D)}if(this._touches=y,N<this._minTouches||!S.mag())return;const C=S.div(N);return this._sum._add(C),this._sum.mag()<this._clickTolerance?void 0:{around:v.div(N),panDelta:C}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")},500)}}class Dm{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(r){}_move(r,c,f){return{}}touchstart(r,c,f){this._firstTwoTouches||f.length<2||(this._firstTwoTouches=[f[0].identifier,f[1].identifier],this._start([c[0],c[1]]))}touchmove(r,c,f){const y=this._firstTwoTouches;if(!y)return;r.preventDefault();const[v,S]=y,N=Ap(f,c,v),C=Ap(f,c,S);if(!N||!C)return;const k=this._aroundCenter?null:N.add(C).div(2);return this._move([N,C],k,r)}touchend(r,c,f){if(!this._firstTwoTouches)return;const[y,v]=this._firstTwoTouches,S=Ap(f,c,y),N=Ap(f,c,v);S&&N||(this._active&&Pe(),this.reset())}touchcancel(){this.reset()}enable(r){this._enabled=!0,this._aroundCenter=!!r&&r.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function Ap(p,r,c){for(let f=0;f<p.length;f++)if(p[f].identifier===c)return r[f]}function Fy(p,r){return Math.log(p/r)/Math.LN2}class h1 extends Dm{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(r){this._startDistance=this._distance=r[0].dist(r[1])}_move(r,c){const f=this._distance;if(this._distance=r[0].dist(r[1]),this._active||!(Math.abs(Fy(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:Fy(this._distance,f),pinchAround:c}}}function By(p,r){return 180*p.angleWith(r)/Math.PI}class p1 extends Dm{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(r){this._startVector=this._vector=r[0].sub(r[1]),this._minDiameter=r[0].dist(r[1])}_move(r,c){const f=this._vector;if(this._vector=r[0].sub(r[1]),f&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:By(this._vector,f),pinchAround:c}}_isBelowThreshold(r){this._minDiameter=Math.min(this._minDiameter,r.mag());const c=25/(Math.PI*this._minDiameter)*360,f=this._startVector;if(!f)return!1;const y=By(r,f);return Math.abs(y)<c}}function Lm(p){return Math.abs(p.y)>Math.abs(p.x)}class f1 extends Dm{constructor(r){super(),this._map=r}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(r){this._lastPoints=r,Lm(r[0].sub(r[1]))&&(this._valid=!1)}_move(r,c,f){const y=this._lastPoints;if(!y)return;const v=r[0].sub(y[0]),S=r[1].sub(y[1]);return this._map._cooperativeGestures&&!o.eJ()&&f.touches.length<3||(this._valid=this.gestureBeginsVertically(v,S,f.timeStamp),!this._valid)?void 0:(this._lastPoints=r,this._active=!0,{pitchDelta:(v.y+S.y)/2*-.5})}gestureBeginsVertically(r,c,f){if(this._valid!==void 0)return this._valid;const y=r.mag()>=2,v=c.mag()>=2;if(!y&&!v)return;if(!y||!v)return this._firstMove==null&&(this._firstMove=f),f-this._firstMove<100&&void 0;const S=r.y>0==c.y>0;return Lm(r)&&Lm(c)&&S}}const m1={panStep:100,bearingStep:15,pitchStep:10};class g1{constructor(){const r=m1;this._panStep=r.panStep,this._bearingStep=r.bearingStep,this._pitchStep=r.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(r){if(r.altKey||r.ctrlKey||r.metaKey)return;let c=0,f=0,y=0,v=0,S=0;switch(r.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:r.shiftKey?f=-1:(r.preventDefault(),v=-1);break;case 39:r.shiftKey?f=1:(r.preventDefault(),v=1);break;case 38:r.shiftKey?y=1:(r.preventDefault(),S=-1);break;case 40:r.shiftKey?y=-1:(r.preventDefault(),S=1);break;default:return}return this._rotationDisabled&&(f=0,y=0),{cameraAnimation:N=>{const C=N.getZoom();N.easeTo({duration:300,easeId:"keyboardHandler",easing:x1,zoom:c?Math.round(C)+c*(r.shiftKey?2:1):C,bearing:N.getBearing()+f*this._bearingStep,pitch:N.getPitch()+y*this._pitchStep,offset:[-v*this._panStep,-S*this._panStep],center:N.getCenter()},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function x1(p){return p*(2-p)}const y1=4.000244140625,KS=1/450;class XS{constructor(r,c){this._map=r,this._el=r.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=KS,o.aV(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(r){this._defaultZoomRate=r}setWheelZoomRate(r){this._wheelZoomRate=r}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(r){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!r&&r.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(r){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(r.ctrlKey||r.metaKey||this.isZooming()||o.eJ()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=r.deltaMode===WheelEvent.DOM_DELTA_LINE?40*r.deltaY:r.deltaY;const f=o.q.now(),y=f-(this._lastWheelEventTime||0);this._lastWheelEventTime=f,c!==0&&c%y1==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":y>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,r)):this._type||(this._type=Math.abs(y*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),r.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=r,this._delta-=c,this._active||this._start(r)),r.preventDefault()}_onTimeout(r){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(r)}_start(r){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Le(this._el,r);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const r=this._map.transform;this._type==="wheel"&&r.projection.wrap&&(r._center.lng>=180||r._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>r._terrainEnabled()&&this._aroundCoord?r.computeZoomRelativeTo(this._aroundCoord):r.zoom;if(this._delta!==0){const k=this._type==="wheel"&&Math.abs(this._delta)>y1?this._wheelZoomRate:this._defaultZoomRate;let D=2/(1+Math.exp(-Math.abs(this._delta*k)));this._delta<0&&D!==0&&(D=1/D);const U=c(),O=Math.pow(2,U),G=typeof this._targetZoom=="number"?r.zoomScale(this._targetZoom):O;this._targetZoom=Math.min(r.maxZoom,Math.max(r.minZoom,r.scaleZoom(G*D))),this._type==="wheel"&&(this._startZoom=U,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const f=typeof this._targetZoom=="number"?this._targetZoom:c(),y=this._startZoom,v=this._easing;let S,N=!1;if(this._type==="wheel"&&y&&v){const k=Math.min((o.q.now()-this._lastWheelEventTime)/200,1),D=v(k);S=o.ai(y,f,D),k<1?this._frameId||(this._frameId=!0):N=!0}else S=f,N=!0;this._active=!0,N&&(this._active=!1,this._finishTimeout=window.setTimeout(()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout},200));let C=S-c();return C*this._lastDelta<0&&(C=0),{noInertia:!0,needsRenderFrame:!N,zoomDelta:C,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(r){let c=o.eK;if(this._prevEase){const f=this._prevEase,y=(o.q.now()-f.start)/f.duration,v=f.easing(y+.01)-f.easing(y),S=.27/Math.sqrt(v*v+1e-4)*.01,N=Math.sqrt(.0729-S*S);c=o.eI(S,N,.25,1)}return this._prevEase={start:o.q.now(),duration:r,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=H("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout(()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")},200)}}class mr{constructor(r,c){this._clickZoom=r,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class _1{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(r,c){return r.preventDefault(),{cameraAnimation:f=>{f.easeTo({duration:300,zoom:f.getZoom()+(r.shiftKey?-1:1),around:f.unproject(c)},{originalEvent:r})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class YS{constructor(){this._tap=new Lc({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(r,c,f){this._swipePoint||(this._tapTime&&r.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?f.length>0&&(this._swipePoint=c[0],this._swipeTouch=f[0].identifier):this._tap.touchstart(r,c,f))}touchmove(r,c,f){if(this._tapTime){if(this._swipePoint){if(f[0].identifier!==this._swipeTouch)return;const y=c[0],v=y.y-this._swipePoint.y;return this._swipePoint=y,r.preventDefault(),this._active=!0,{zoomDelta:v/128}}}else this._tap.touchmove(r,c,f)}touchend(r,c,f){this._tapTime?this._swipePoint&&f.length===0&&this.reset():this._tap.touchend(r,c,f)&&(this._tapTime=r.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Vy{constructor(r,c,f){this._el=r,this._mousePan=c,this._touchPan=f}enable(r){this._inertiaOptions=r||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class JS{constructor(r,c,f){this._pitchWithRotate=r.pitchWithRotate,this._mouseRotate=c,this._mousePitch=f}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class Pp{constructor(r,c,f,y){this._el=r,this._touchZoom=c,this._touchRotate=f,this._tapDragZoom=y,this._rotationDisabled=!1,this._enabled=!0}enable(r){this._touchZoom.enable(r),this._rotationDisabled||this._touchRotate.enable(r),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const Ip=p=>p.zoom||p.drag||p.pitch||p.rotate;class Uy extends o.A{}class zm{constructor(){this.constants=[1,1,.01],this.radius=0}setup(r,c){const f=o.at([],c,r);this.radius=o.ae(f[2]<0?o.eM([],f,this.constants):[f[0],f[1],0])}projectRay(r){o.eM(r,r,this.constants),o.au(r,r),o.eN(r,r,this.constants);const c=o.c1([],r,this.radius);if(c[2]>0){const f=o.c1([],[0,0,1],o.bG(c,[0,0,1])),y=o.c1([],o.au([],[c[0],c[1],0]),this.radius),v=o.d5([],c,o.c1([],o.at([],o.d5([],y,f),c),2));c[0]=v[0],c[1]=v[1]}return c}}function Ca(p){return p.panDelta&&p.panDelta.mag()||p.zoomDelta||p.bearingDelta||p.pitchDelta}class Om{constructor(r,c){this._map=r,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Mm(r),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new zm,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),o.aV(["handleEvent","handleWindowEvent"],this);const f=this._el;this._listeners=[[f,"touchstart",{passive:!0}],[f,"touchmove",{passive:!1}],[f,"touchend",void 0],[f,"touchcancel",void 0],[f,"mousedown",void 0],[f,"mousemove",void 0],[f,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[f,"mouseover",void 0],[f,"mouseout",void 0],[f,"dblclick",void 0],[f,"click",void 0],[f,"keydown",{capture:!1}],[f,"keyup",void 0],[f,"wheel",{passive:!1}],[f,"contextmenu",void 0],[window,"blur",void 0]];for(const[y,v,S]of this._listeners){const N=y===document?this.handleWindowEvent:this.handleEvent;y.addEventListener(v,N,S)}}destroy(){for(const[r,c,f]of this._listeners){const y=r===document?this.handleWindowEvent:this.handleEvent;r.removeEventListener(c,y,f)}}_addDefaultHandlers(r){const c=this._map,f=c.getCanvasContainer();this._add("mapEvent",new My(c,r));const y=c.boxZoom=new Ry(c,r);this._add("boxZoom",y);const v=new Dy,S=new _1;c.doubleClickZoom=new mr(S,v),this._add("tapZoom",v),this._add("clickZoom",S);const N=new YS;this._add("tapDragZoom",N);const C=c.touchPitch=new f1(c);this._add("touchPitch",C);const k=new km(r),D=new Oy(r);c.dragRotate=new JS(r,k,D),this._add("mouseRotate",k,["mousePitch"]),this._add("mousePitch",D,["mouseRotate"]);const U=new zy(r),O=new d1(c,r);c.dragPan=new Vy(f,U,O),this._add("mousePan",U),this._add("touchPan",O,["touchZoom","touchRotate"]);const G=new p1,ee=new h1;c.touchZoomRotate=new Pp(f,ee,G,N),this._add("touchRotate",G,["touchPan","touchZoom"]),this._add("touchZoom",ee,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Pu(c));const J=c.scrollZoom=new XS(c,this);this._add("scrollZoom",J,["mousePan"]);const se=c.keyboard=new g1;this._add("keyboard",se);for(const te of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])r.interactive&&r[te]&&c[te].enable(r[te])}_add(r,c,f){this._handlers.push({handlerName:r,handler:c,allowed:f}),this._handlersById[r]=c}stop(r){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},r),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:r}of this._handlers)if(r.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!Ip(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(r,c,f){for(const y in r)if(y!==f&&(!c||c.indexOf(y)<0))return!0;return!1}handleWindowEvent(r){this.handleEvent(r,`${r.type}Window`)}_getMapTouches(r){const c=[];for(const f of r)this._el.contains(f.target)&&c.push(f);return c}handleEvent(r,c){this._updatingCamera=!0;const f=r.type==="renderFrame",y=f?void 0:r,v={needsRenderFrame:!1},S={},N={},C=r.touches?this._getMapTouches(r.touches):void 0,k=C?ct(this._el,C):f?void 0:Le(this._el,r);for(const{handlerName:O,handler:G,allowed:ee}of this._handlers){if(!G.isEnabled())continue;let J;this._blockedByActive(N,ee,O)?G.reset():G[c||r.type]&&(J=G[c||r.type](r,k,C),this.mergeHandlerResult(v,S,J,O,y),J&&J.needsRenderFrame&&this._triggerRenderFrame()),(J||G.isActive())&&(N[O]=G)}const D={};for(const O in this._previousActiveHandlers)N[O]||(D[O]=y);this._previousActiveHandlers=N,(Object.keys(D).length||Ca(v))&&(this._changes.push([v,S,D]),this._triggerRenderFrame()),(Object.keys(N).length||Ca(v))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:U}=v;U&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],U(this._map))}mergeHandlerResult(r,c,f,y,v){if(!f)return;o.h(r,f);const S={handlerName:y,originalEvent:f.originalEvent||v};f.zoomDelta!==void 0&&(c.zoom=S),f.panDelta!==void 0&&(c.drag=S),f.pitchDelta!==void 0&&(c.pitch=S),f.bearingDelta!==void 0&&(c.rotate=S)}_applyChanges(){const r={},c={},f={};for(const[y,v,S]of this._changes)y.panDelta&&(r.panDelta=(r.panDelta||new o.P(0,0))._add(y.panDelta)),y.zoomDelta&&(r.zoomDelta=(r.zoomDelta||0)+y.zoomDelta),y.bearingDelta&&(r.bearingDelta=(r.bearingDelta||0)+y.bearingDelta),y.pitchDelta&&(r.pitchDelta=(r.pitchDelta||0)+y.pitchDelta),y.around!==void 0&&(r.around=y.around),y.aroundCoord!==void 0&&(r.aroundCoord=y.aroundCoord),y.pinchAround!==void 0&&(r.pinchAround=y.pinchAround),y.noInertia&&(r.noInertia=y.noInertia),o.h(c,v),o.h(f,S);this._updateMapTransform(r,c,f),this._changes=[]}_updateMapTransform(r,c,f){const y=this._map,v=y.transform,S=le=>[le.x,le.y,le.z];if((le=>{const de=this._eventsInProgress.drag;return de&&!this._handlersById[de.handlerName].isActive()})()&&!Ca(r)){const le=v.zoom;v.cameraElevationReference="sea",this._originalZoom!=null&&v._orthographicProjectionAtLowPitch&&v.projection.name!=="globe"&&v.pitch===0?(v.cameraElevationReference="ground",v.zoom=this._originalZoom):(v.recenterOnTerrain(),v.cameraElevationReference="ground"),le!==v.zoom&&this._map._update(!0)}if(v._isCameraConstrained&&y._stop(!0),!Ca(r))return void this._fireEvents(c,f,!0);let{panDelta:N,zoomDelta:C,bearingDelta:k,pitchDelta:D,around:U,aroundCoord:O,pinchAround:G}=r;v._isCameraConstrained&&(C>0&&(C=0),v._isCameraConstrained=!1),G!==void 0&&(U=G),(C||(le=>c[le]&&!this._eventsInProgress[le])("drag"))&&U&&(this._dragOrigin=S(v.pointCoordinate3D(U)),this._originalZoom=v.zoom,this._trackingEllipsoid.setup(v._camera.position,this._dragOrigin)),v.cameraElevationReference="sea",y._stop(!0),U=U||y.transform.centerPoint,k&&(v.bearing+=k),D&&(v.pitch+=D),v._updateCameraState();const ee=[0,0,0];if(N)if(v.projection.name==="mercator"){const le=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U).dir),de=this._trackingEllipsoid.projectRay(v.screenPointToMercatorRay(U.sub(N)).dir);ee[0]=de[0]-le[0],ee[1]=de[1]-le[1]}else{const le=v.pointCoordinate(U);if(v.projection.name==="globe"){N=N.rotate(-v.angle);const de=v._pixelsPerMercatorPixel/v.worldSize;ee[0]=-N.x*o.eL(o.aY(le.y))*de,ee[1]=-N.y*o.eL(v.center.lat)*de}else{const de=v.pointCoordinate(U.sub(N));le&&de&&(ee[0]=de.x-le.x,ee[1]=de.y-le.y)}}const J=v.zoom,se=[0,0,0];if(C){const le=S(O||v.pointCoordinate3D(U)),de={dir:o.au([],o.at([],le,v._camera.position))};if(de.dir[2]<0){const pe=v.zoomDeltaToMovement(le,C);o.c1(se,de.dir,pe)}}const te=o.d5(ee,ee,se);v._translateCameraConstrained(te),C&&Math.abs(v.zoom-J)>1e-4&&v.recenterOnTerrain(),v.cameraElevationReference="ground",this._map._update(),r.noInertia||this._inertia.record(r),this._fireEvents(c,f,!0)}_fireEvents(r,c,f){const y=Ip(this._eventsInProgress),v=Ip(r),S={};for(const D in r){const{originalEvent:U}=r[D];this._eventsInProgress[D]||(S[`${D}start`]=U),this._eventsInProgress[D]=r[D]}!y&&v&&this._fireEvent("movestart",v.originalEvent);for(const D in S)this._fireEvent(D,S[D]);v&&this._fireEvent("move",v.originalEvent);for(const D in r){const{originalEvent:U}=r[D];this._fireEvent(D,U)}const N={};let C;for(const D in this._eventsInProgress){const{handlerName:U,originalEvent:O}=this._eventsInProgress[D];this._handlersById[U].isActive()||(delete this._eventsInProgress[D],C=c[U]||O,N[`${D}end`]=C)}for(const D in N)this._fireEvent(D,N[D]);const k=Ip(this._eventsInProgress);if(f&&(y||v)&&!k){this._updatingCamera=!0;const D=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),U=O=>O!==0&&-this._bearingSnap<O&&O<this._bearingSnap;D?(U(D.bearing||this._map.getBearing())&&(D.bearing=0),this._map.easeTo(D,{originalEvent:C})):(this._map.fire(new o.A("moveend",{originalEvent:C})),U(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(r,c){this._map.fire(new o.A(r,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add(r=>{this._frameId=void 0,this.handleEvent(new Uy("renderFrame",{timeStamp:r})),this._applyChanges()})}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const zr="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class xl extends o.E{constructor(r,c){super(),this._moving=!1,this._zooming=!1,this.transform=r,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,o.aV(["_renderFrameCallback"],this)}getCenter(){return new o.ci(this.transform.center.lng,this.transform.center.lat)}setCenter(r,c){return this.jumpTo({center:r},c)}panBy(r,c,f){return r=o.P.convert(r).mult(-1),this.panTo(this.transform.center,o.h({offset:r},c),f)}panTo(r,c,f){return this.easeTo(o.h({center:r},c),f)}getZoom(){return this.transform.zoom}setZoom(r,c){return this.jumpTo({zoom:r},c),this}zoomTo(r,c,f){return this.easeTo(o.h({zoom:r},c),f)}zoomIn(r,c){return this.zoomTo(this.getZoom()+1,r,c),this}zoomOut(r,c){return this.zoomTo(this.getZoom()-1,r,c),this}getBearing(){return this.transform.bearing}setBearing(r,c){return this.jumpTo({bearing:r},c),this}getPadding(){return this.transform.padding}setPadding(r,c){return this.jumpTo({padding:r},c),this}rotateTo(r,c,f){return this.easeTo(o.h({bearing:r},c),f)}resetNorth(r,c){return this.rotateTo(0,o.h({duration:1e3},r),c),this}resetNorthPitch(r,c){return this.easeTo(o.h({bearing:0,pitch:0,duration:1e3},r),c),this}snapToNorth(r,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(r,c):this}getPitch(){return this.transform.pitch}setPitch(r,c){return this.jumpTo({pitch:r},c),this}cameraForBounds(r,c){r=o.aG.convert(r);const f=c&&c.bearing||0,y=c&&c.pitch||0,v=r.getNorthWest(),S=r.getSouthEast();return this._cameraForBounds(this.transform,v,S,f,y,c)}_extendPadding(r){const c={top:0,right:0,bottom:0,left:0};return r==null?o.h({},c,this.transform.padding):typeof r=="number"?{top:r,bottom:r,right:r,left:r}:o.h({},c,r)}_extendCameraOptions(r){return(r=o.h({offset:[0,0],maxZoom:this.transform.maxZoom},r)).padding=this._extendPadding(r.padding),r}_minimumAABBFrustumDistance(r,c){const f=c.max[0]-c.min[0],y=c.max[1]-c.min[1];return f/y>r.aspect?f/(2*Math.tan(.5*r.fovX)*r.aspect):y/(2*Math.tan(.5*r.fovY)*r.aspect)}_cameraForBoundsOnGlobe(r,c,f,y,v,S){const N=r.clone(),C=this._extendCameraOptions(S);N.bearing=y,N.pitch=v;const k=o.ci.convert(c),D=o.ci.convert(f),U=.5*(k.lat+D.lat),O=.5*(k.lng+D.lng),G=o.eO(U,O),ee=o.au([],G),J=o.au([],o.bF([],ee,[0,1,0])),se=o.bF([],J,ee),te=[J[0],J[1],J[2],0,se[0],se[1],se[2],0,ee[0],ee[1],ee[2],0,0,0,0,1],le=[G,o.eO(k.lat,k.lng),o.eO(D.lat,k.lng),o.eO(D.lat,D.lng),o.eO(k.lat,D.lng),o.eO(U,k.lng),o.eO(U,D.lng),o.eO(k.lat,O),o.eO(D.lat,O)];let de=o.d6.fromPoints(le.map(Ge=>[o.bG(J,Ge),o.bG(se,Ge),o.bG(ee,Ge)]));const pe=o.ad([],de.center,te);o.eP(pe)===0&&o.eQ(pe,0,0,1),o.au(pe,pe),o.c1(pe,pe,o.aB),N.center=o.eR(pe);const ye=N.getWorldToCameraMatrix(),Se=o.bi(new Float64Array(16),ye);de=o.d6.applyTransform(de,o.az([],ye,te));const Te=this._extendAABB(de,N,C,y);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");de=Te,o.ad(pe,pe,ye);const _e=.5*(de.max[2]-de.min[2]),ve=this._minimumAABBFrustumDistance(N,de),be=o.c1([],[0,0,1],_e),Ue=o.d5(be,pe,be),Ie=ve+(N.pitch===0?0:o.bD(pe,Ue)),tt=N.globeCenterInViewSpace,We=o.at([],pe,[tt[0],tt[1],tt[2]]);o.au(We,We),o.c1(We,We,Ie);const rt=o.d5([],pe,We);o.ad(rt,rt,Se);const jt=o.eB/o.aB,$e=o.ae(rt),Ae=o.cb(Math.max($e*jt-o.eB,Number.EPSILON),0),Ke=Math.min(N.zoomFromMercatorZAdjusted(Ae),C.maxZoom);return Ke>.5*(o.cX+o.cI)?(N.setProjection({name:"mercator"}),N.zoom=Ke,this._cameraForBounds(N,c,f,y,v,S)):{center:N.center,zoom:Ke,bearing:y,pitch:v}}_extendAABB(r,c,f,y){const v=.5*((f.padding.left||0)+(f.padding.right||0)),S=.5*((f.padding.top||0)+(f.padding.bottom||0)),N=S,C=v,k=v,D=S,U=c.width-(C+k),O=c.height-(N+D),G=o.at([],r.max,r.min),ee=Math.min(U/G[0],O/G[1]),J=Math.min(c.scaleZoom(c.scale*ee),f.maxZoom);if(isNaN(J))return null;const se=c.scale/c.zoomScale(J),te=new o.d6([r.min[0]-C*se,r.min[1]-D*se,r.min[2]],[r.max[0]+k*se,r.max[1]+N*se,r.max[2]]),le=(typeof f.offset.x=="number"&&typeof f.offset.y=="number"?new o.P(f.offset.x,f.offset.y):o.P.convert(f.offset)).rotate(-o.al(y));return te.center[0]-=le.x*se,te.center[1]+=le.y*se,te}queryTerrainElevation(r,c){const f=this.transform.elevation;return f?(c=o.h({},{exaggerated:!0},c),f.getAtPoint(o.ac.fromLngLat(r),null,c.exaggerated)):null}_cameraForBounds(r,c,f,y,v,S){if(r.projection.name==="globe")return this._cameraForBoundsOnGlobe(r,c,f,y,v,S);const N=r.clone(),C=this._extendCameraOptions(S);N.bearing=y,N.pitch=v;const k=o.ci.convert(c),D=o.ci.convert(f),U=new o.ci(k.lng,D.lat),O=new o.ci(D.lng,k.lat),G=N.project(k),ee=N.project(D),J=this.queryTerrainElevation(k),se=this.queryTerrainElevation(D),te=this.queryTerrainElevation(U),le=this.queryTerrainElevation(O),de=[[G.x,G.y,Math.min(J||0,se||0,te||0,le||0)],[ee.x,ee.y,Math.max(J||0,se||0,te||0,le||0)]];let pe=o.d6.fromPoints(de);const ye=N.getWorldToCameraMatrix(),Se=o.bi(new Float64Array(16),ye);pe=o.d6.applyTransform(pe,ye);const Te=this._extendAABB(pe,N,C,y);if(!Te)return void o.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");pe=Te;const _e=.5*o.at([],pe.max,pe.min)[2],ve=this._minimumAABBFrustumDistance(N,pe),be=[0,0,1,0];o.aA(be,be,ye),o.eS(be,be);const Ue=o.c1([],be,ve+_e),Ie=o.d5([],pe.center,Ue);o.ad(pe.center,pe.center,Se),o.ad(Ie,Ie,Se);const tt=N.unproject(new o.P(pe.center[0],pe.center[1])),We=o.eT(N.projection,tt),rt=Math.pow(2,We),jt=Math.min(N._zoomFromMercatorZ(Ie[2]*N.pixelsPerMeter*rt/N.worldSize),C.maxZoom);return N.mercatorFromTransition&&jt<.5*(o.cX+o.cI)?(N.setProjection({name:"globe"}),N.zoom=jt,this._cameraForBounds(N,c,f,y,v,S)):{center:tt,zoom:jt,bearing:y,pitch:v}}fitBounds(r,c,f){const y=this.cameraForBounds(r,c);return this._fitInternal(y,c,f)}fitScreenCoordinates(r,c,f,y,v){const S=o.P.convert(r),N=o.P.convert(c),C=new o.P(Math.min(S.x,N.x),Math.min(S.y,N.y)),k=new o.P(Math.max(S.x,N.x),Math.max(S.y,N.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(S,N))return this;const D=this.transform.pointLocation3D(C),U=this.transform.pointLocation3D(k),O=this.transform.pointLocation3D(new o.P(C.x,k.y)),G=this.transform.pointLocation3D(new o.P(k.x,C.y)),ee=[Math.min(D.lng,U.lng,O.lng,G.lng),Math.min(D.lat,U.lat,O.lat,G.lat)],J=[Math.max(D.lng,U.lng,O.lng,G.lng),Math.max(D.lat,U.lat,O.lat,G.lat)],se=y&&y.pitch?y.pitch:this.getPitch(),te=this._cameraForBounds(this.transform,ee,J,f,se,y);return this._fitInternal(te,y,v)}_fitInternal(r,c,f){return r?(c=o.h(r,c)).linear?this.easeTo(c,f):this.flyTo(c,f):this}jumpTo(r,c){this.stop();const f=r.preloadOnly?this.transform.clone():this.transform;let y=!1,v=!1,S=!1;"zoom"in r&&f.zoom!==+r.zoom&&(y=!0,f.zoom=+r.zoom),r.center!==void 0&&(f.center=o.ci.convert(r.center)),"bearing"in r&&f.bearing!==+r.bearing&&(v=!0,f.bearing=+r.bearing),"pitch"in r&&f.pitch!==+r.pitch&&(S=!0,f.pitch=+r.pitch);const N=typeof r.padding=="number"?this._extendPadding(r.padding):r.padding;if(r.padding!=null&&!f.isPaddingEqual(N))if(r.retainPadding===!1){const C=f.clone();C.padding=N,f.setLocationAtPoint(f.center,C.centerPoint)}else f.padding=N;return r.preloadOnly?(this._preloadTiles(f),this):(this.fire(new o.A("movestart",c)).fire(new o.A("move",c)),y&&this.fire(new o.A("zoomstart",c)).fire(new o.A("zoom",c)).fire(new o.A("zoomend",c)),v&&this.fire(new o.A("rotatestart",c)).fire(new o.A("rotate",c)).fire(new o.A("rotateend",c)),S&&this.fire(new o.A("pitchstart",c)).fire(new o.A("pitch",c)).fire(new o.A("pitchend",c)),this.fire(new o.A("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||o.w(zr),this.transform.getFreeCameraOptions()}setFreeCameraOptions(r,c){const f=this.transform;if(!f.projection.supportsFreeCamera)return o.w(zr),this;this.stop();const y=f.zoom,v=f.pitch,S=f.bearing;f.setFreeCameraOptions(r);const N=y!==f.zoom,C=v!==f.pitch,k=S!==f.bearing;return this.fire(new o.A("movestart",c)).fire(new o.A("move",c)),N&&this.fire(new o.A("zoomstart",c)).fire(new o.A("zoom",c)).fire(new o.A("zoomend",c)),k&&this.fire(new o.A("rotatestart",c)).fire(new o.A("rotate",c)).fire(new o.A("rotateend",c)),C&&this.fire(new o.A("pitchstart",c)).fire(new o.A("pitch",c)).fire(new o.A("pitchend",c)),this.fire(new o.A("moveend",c)),this}easeTo(r,c){this._stop(!1,r.easeId),((r=o.h({offset:[0,0],duration:500,easing:o.eK},r)).animate===!1||this._prefersReducedMotion(r))&&(r.duration=0);const f=this.transform,y=this.getZoom(),v=this.getBearing(),S=this.getPitch(),N=this.getPadding(),C="zoom"in r?+r.zoom:y,k="bearing"in r?this._normalizeBearing(r.bearing,v):v,D="pitch"in r?+r.pitch:S,U=this._extendPadding(r.padding),O=o.P.convert(r.offset);let G,ee,J;if(f.projection.name==="globe"){const be=o.ac.fromLngLat(f.center),Ue=O.rotate(-f.angle);be.x+=Ue.x/f.worldSize,be.y+=Ue.y/f.worldSize;const Ie=be.toLngLat(),tt=o.ci.convert(r.center||Ie);this._normalizeCenter(tt),G=f.centerPoint.add(Ue),ee=new o.P(be.x,be.y).mult(f.worldSize),J=new o.P(o.aD(tt.lng),o.aH(tt.lat)).mult(f.worldSize).sub(ee)}else{G=f.centerPoint.add(O);const be=f.pointLocation(G),Ue=o.ci.convert(r.center||be);this._normalizeCenter(Ue),ee=f.project(be),J=f.project(Ue).sub(ee)}const se=f.zoomScale(C-y);let te,le;r.around&&(te=o.ci.convert(r.around),le=f.locationPoint(te));const de=this._zooming||C!==y,pe=this._rotating||v!==k,ye=this._pitching||D!==S,Se=!f.isPaddingEqual(U),Te=r.retainPadding===!1?f.clone():f,_e=be=>Ue=>{if(de&&(be.zoom=o.ai(y,C,Ue)),pe&&(be.bearing=o.ai(v,k,Ue)),ye&&(be.pitch=o.ai(S,D,Ue)),Se&&(Te.interpolatePadding(N,U,Ue),G=Te.centerPoint.add(O)),te)be.setLocationAtPoint(te,le);else{const Ie=be.zoomScale(be.zoom-y),tt=C>y?Math.min(2,se):Math.max(.5,se),We=Math.pow(tt,1-Ue),rt=be.unproject(ee.add(J.mult(Ue*We)).mult(Ie));be.setLocationAtPoint(be.renderWorldCopies?rt.wrap():rt,G)}return r.preloadOnly||this._fireMoveEvents(c),be};if(r.preloadOnly){const be=this._emulate(_e,r.duration,f);return this._preloadTiles(be),this}const ve={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=de,this._rotating=pe,this._pitching=ye,this._padding=Se,this._easeId=r.easeId,this._prepareEase(c,r.noMoveStart,ve),this._ease(_e(f),be=>{f.cameraElevationReference==="sea"&&f.recenterOnTerrain(),this._afterEase(c,be)},r),this}_prepareEase(r,c,f={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||f.moving||this.fire(new o.A("movestart",r)),this._zooming&&!f.zooming&&this.fire(new o.A("zoomstart",r)),this._rotating&&!f.rotating&&this.fire(new o.A("rotatestart",r)),this._pitching&&!f.pitching&&this.fire(new o.A("pitchstart",r))}_fireMoveEvents(r){this.fire(new o.A("move",r)),this._zooming&&this.fire(new o.A("zoom",r)),this._rotating&&this.fire(new o.A("rotate",r)),this._pitching&&this.fire(new o.A("pitch",r))}_afterEase(r,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const f=this._zooming,y=this._rotating,v=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,f&&this.fire(new o.A("zoomend",r)),y&&this.fire(new o.A("rotateend",r)),v&&this.fire(new o.A("pitchend",r)),this.fire(new o.A("moveend",r))}flyTo(r,c){if(this._prefersReducedMotion(r)){const Ge=o.aF(r,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(Ge,c)}this.stop(),r=o.h({offset:[0,0],speed:1.2,curve:1.42,easing:o.eK},r);const f=this.transform,y=this.getZoom(),v=this.getBearing(),S=this.getPitch(),N=this.getPadding(),C="zoom"in r?o.ay(+r.zoom,f.minZoom,f.maxZoom):y,k="bearing"in r?this._normalizeBearing(r.bearing,v):v,D="pitch"in r?+r.pitch:S,U=this._extendPadding(r.padding),O=f.zoomScale(C-y),G=o.P.convert(r.offset);let ee=f.centerPoint.add(G);const J=f.pointLocation(ee),se=o.ci.convert(r.center||J);this._normalizeCenter(se);const te=f.project(J),le=f.project(se).sub(te);let de=r.curve;const pe=Math.max(f.width,f.height),ye=pe/O,Se=le.mag();if("minZoom"in r){const Ge=o.ay(Math.min(r.minZoom,y,C),f.minZoom,f.maxZoom),ht=pe/f.zoomScale(Ge-y);de=Math.sqrt(ht/Se*2)}const Te=de*de;function _e(Ge){const ht=(ye*ye-pe*pe+(Ge?-1:1)*Te*Te*Se*Se)/(2*(Ge?ye:pe)*Te*Se);return Math.log(Math.sqrt(ht*ht+1)-ht)}function ve(Ge){return(Math.exp(Ge)-Math.exp(-Ge))/2}function be(Ge){return(Math.exp(Ge)+Math.exp(-Ge))/2}const Ue=_e(0);let Ie=function(Ge){return be(Ue)/be(Ue+de*Ge)},tt=function(Ge){return pe*((be(Ue)*(ve(ht=Ue+de*Ge)/be(ht))-ve(Ue))/Te)/Se;var ht},We=(_e(1)-Ue)/de;if(Math.abs(Se)<1e-6||!isFinite(We)){if(Math.abs(pe-ye)<1e-6)return this.easeTo(r,c);const Ge=ye<pe?-1:1;We=Math.abs(Math.log(ye/pe))/de,tt=function(){return 0},Ie=function(ht){return Math.exp(Ge*de*ht)}}r.duration="duration"in r?+r.duration:1e3*We/("screenSpeed"in r?+r.screenSpeed/de:+r.speed),r.maxDuration&&r.duration>r.maxDuration&&(r.duration=0);const rt=v!==k,jt=D!==S,$e=!f.isPaddingEqual(U),Ae=r.retainPadding===!1?f.clone():f,Ke=Ge=>ht=>{const pt=ht*We,mt=1/Ie(pt);Ge.zoom=ht===1?C:y+Ge.scaleZoom(mt),rt&&(Ge.bearing=o.ai(v,k,ht)),jt&&(Ge.pitch=o.ai(S,D,ht)),$e&&(Ae.interpolatePadding(N,U,ht),ee=Ae.centerPoint.add(G));const Pt=ht===1?se:Ge.unproject(te.add(le.mult(tt(pt))).mult(mt));return Ge.setLocationAtPoint(Ge.renderWorldCopies?Pt.wrap():Pt,ee),Ge._updateCameraOnTerrain(),r.preloadOnly||this._fireMoveEvents(c),Ge};if(r.preloadOnly){const Ge=this._emulate(Ke,r.duration,f);return this._preloadTiles(Ge),this}return this._zooming=!0,this._rotating=rt,this._pitching=jt,this._padding=$e,this._prepareEase(c,!1),this._ease(Ke(f),()=>this._afterEase(c),r),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(r){}_cancelRenderFrame(r){}_stop(r,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const f=this._onEaseEnd;this._onEaseEnd=void 0,f.call(this,c)}if(!r){const f=this.handlers;f&&f.stop(!1)}return this}_ease(r,c,f){f.animate===!1||f.duration===0?(r(1),c()):(this._easeStart=o.q.now(),this._easeOptions=f,this._onEaseFrame=r,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const r=Math.min((o.q.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(r)),r<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(r,c){r=o.bQ(r,-180,180);const f=Math.abs(r-c);return Math.abs(r-360-c)<f&&(r-=360),Math.abs(r+360-c)<f&&(r+=360),r}_normalizeCenter(r){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const f=r.lng-c.center.lng;r.lng+=f>180?-360:f<-180?360:0}_prefersReducedMotion(r){return this._respectPrefersReducedMotion&&o.q.prefersReducedMotion&&!(r&&r.essential)}_emulate(r,c,f){const y=Math.ceil(15*c/1e3),v=[],S=r(f.clone());for(let N=0;N<=y;N++){const C=S(N/y);v.push(C.clone())}return v}_preloadTiles(r,c){}}class Bd{constructor(r={}){this.options=r,o.aV(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(r){const c=this.options&&this.options.compact,f=r._getUIString("AttributionControl.ToggleAttribution");this._map=r,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=H("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",f);const y=H("span","mapboxgl-ctrl-icon",this._compactButton);return y.setAttribute("aria-hidden","true"),y.setAttribute("title",f),this._innerContainer=H("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let r=this._editLink;r||(r=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||o.e.ACCESS_TOKEN}];if(r){const f=c.reduce((y,v,S)=>(v.value&&(y+=`${v.key}=${v.value}${S<c.length-1?"&":""}`),y),"?");r.href=`${o.e.FEEDBACK_URL}/${f}#${Im(this._map,!0)}`,r.rel="noopener nofollow"}}_updateData(r){!r||r.sourceDataType!=="metadata"&&r.sourceDataType!=="visibility"&&r.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let r=[];if(this._map.style.stylesheet){const y=this._map.style.stylesheet;this.styleOwner=y.owner,this.styleId=y.id}const c=this._map.style._mergedSourceCaches;for(const y in c){const v=c[y];if(v.used){const S=v.getSource();S.attribution&&r.indexOf(S.attribution)<0&&r.push(S.attribution)}}r.sort((y,v)=>y.length-v.length),r=r.filter((y,v)=>{for(let S=v+1;S<r.length;S++)if(r[S].indexOf(y)>=0)return!1;return!0}),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?r=[...this.options.customAttribution,...r]:r.unshift(this.options.customAttribution));const f=r.join(" | ");f!==this._attribHTML&&(this._attribHTML=f,r.length?(this._innerContainer.innerHTML=f,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class Mp{constructor(){o.aV(["_updateLogo","_updateCompact"],this)}onAdd(r){this._map=r,this._container=H("div","mapboxgl-ctrl");const c=H("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(r){r&&r.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const r=this._map.style._sourceCaches;if(Object.entries(r).length===0)return!0;for(const c in r){const f=r[c].getSource();if(f.hasOwnProperty("mapbox_logo")&&!f.mapbox_logo)return!1}return!0}_updateCompact(){const r=this._container.children;if(r.length){const c=r[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class $y{constructor(){o.aV(["_onIndoorUpdate"],this)}onAdd(r){return this._map=r,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",c=>this._onIndoorUpdate({selectedFloorId:c.selectedFloorId,floors:c.floors})),this._container}_createButton(r,c){const f=H("button",r,this._container);return f.type="button",f.addEventListener("click",c),f}_setButtonTitle(r,c){this._map&&(r.setAttribute("aria-label",c),r.innerHTML=`<strong>${c}</strong>`,r.firstElementChild&&r.firstElementChild.setAttribute("title",c))}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(r){if(!r||!r.floors)return void(this._container.style.display="none");const c=this._model;this._model=r,this._container.style.display="inline-block";const f=r.floors.sort((y,v)=>y.levelOrder-v.levelOrder);c?(Array.from(this._container.children).forEach(y=>y.remove()),this.addCurrentFloors(f)):this.addCurrentFloors(f)}addCurrentFloors(r){for(const c of r){const f=this._createButton("mapboxgl-ctrl-level-button",()=>{this._map._selectIndoorFloor(c.id),Array.from(this._container.children).forEach(y=>{y.classList.remove("mapboxgl-ctrl-level-button-selected")}),f.classList.add("mapboxgl-ctrl-level-button-selected")});this._setButtonTitle(f,c.shortName),this._model&&c.id===this._model.selectedFloorId&&(this._map._selectIndoorFloor(c.id),f.classList.add("mapboxgl-ctrl-level-button-selected")),this._container.append(f)}}}class v1{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(r){const c=++this._id;return this._queue.push({callback:r,id:c,cancelled:!1}),c}remove(r){const c=this._currentlyRunning,f=c?this._queue.concat(c):this._queue;for(const y of f)if(y.id===r)return void(y.cancelled=!0)}run(r=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const f of c)if(!f.cancelled&&(f.callback(r),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Rp{constructor(r){this.jumpTo(r)}getValue(r){if(r<=this._startTime)return this._start;if(r>=this._endTime)return this._end;const c=o.dx((r-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(r){return r>=this._startTime&&r<=this._endTime}jumpTo(r){this._startTime=-1/0,this._endTime=-1/0,this._start=r,this._end=r}easeTo(r,c,f){this._start=this.getValue(c),this._end=r,this._startTime=c,this._endTime=c+f}}const QS={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use  + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class b1 extends o.A{constructor(r,c,f,y){const{point:v,lngLat:S,originalEvent:N,target:C}=r;super(r.type,{point:v,lngLat:S,originalEvent:N,target:C}),this.preventDefault=()=>{r.preventDefault()},this.id=c,this.interaction=f,this.feature=y}}class Gy{constructor(r){this.map=r,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(r,c){if(this.typeById.has(r))throw new Error(`Interaction id "${r}" already exists.`);const f=c.filter;let y=c.type;f&&this.filters.set(r,o.b3(f)),y==="mouseover"&&(y="mouseenter"),y==="mouseout"&&(y="mouseleave");const v=this.interactionsByType.get(y)||new Map;y==="mouseenter"||y==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(r,c)):v.size===0&&this.map.on(y,this.handleType),v.size===0&&this.interactionsByType.set(y,v),v.set(r,c),this.typeById.set(r,y)}get(r){const c=this.typeById.get(r);if(!c)return;const f=this.interactionsByType.get(c);return f?f.get(r):void 0}remove(r){const c=this.typeById.get(r);if(!c)return;this.typeById.delete(r),this.filters.delete(r);const f=this.interactionsByType.get(c);f&&(f.delete(r),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(r),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):f.size===0&&this.map.off(c,this.handleType))}queryTargets(r,c){const f=[];for(const[y,v]of c)v.target&&f.push({targetId:y,target:v.target,filter:this.filters.get(y)});return this.map.style.queryRenderedTargets(r,f,this.map.transform)}handleMove(r){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(r.point,Array.from(this.delegatedInteractions).reverse());c.length&&(r.type="mouseenter",this.handleType(r,c));const f=new Map;for(const[y,{feature:v}]of this.prevHoveredFeatures)this.hoveredFeatures.has(y)||f.set(v.id,v);f.size&&(r.type="mouseleave",this.handleType(r,Array.from(f.values())))}handleOut(r){const c=Array.from(this.hoveredFeatures.values()).map(({feature:f})=>f);c.length&&(r.type="mouseleave",this.handleType(r,c)),this.hoveredFeatures.clear()}handleType(r,c){const f=r.type==="mouseenter";if(f&&!this.interactionsByType.has(r.type))return void o.w("mouseenter interaction required for mouseleave to work.");const y=Array.from(this.interactionsByType.get(r.type)).reverse(),v=!!c;c=c||this.queryTargets(r.point,y);let S=!1;const N=new Set;for(const C of c){for(const[k,D]of y){if(!D.target)continue;const U=C.variants?C.variants[k]:null;if(U){for(const O of U){if(Of(O,C,N,k))continue;const G=new o.dr(C,O),ee=Zh(O,C,k);v&&(G.state=this.map.getFeatureState(G));const J=f?this.prevHoveredFeatures.get(ee):null,se=new b1(r,k,D,G),te=J?J.stop:D.handler(se);if(f&&this.hoveredFeatures.set(ee,{feature:C,stop:te}),te!==!1){S=!0;break}}if(S)break}}if(S)break}if(!S)for(const[C,k]of y){const{handler:D,target:U}=k;if(!U&&D(new b1(r,C,k,null))!==!1)break}}}function Hy(p,r){if(Array.isArray(p)&&Array.isArray(r)){const c=new Set(p),f=new Set(r);return c.size===f.size&&p.every(y=>f.has(y))}return o.bv(p,r)}const kp={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Vd={showCompass:!0,showZoom:!0,visualizePitch:!1};class Vl{constructor(r,c,f=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new km({clickTolerance:r.dragRotate._mouseRotate._clickTolerance}),this.map=r,f&&(this.mousePitch=new Oy({clickTolerance:r.dragRotate._mousePitch._clickTolerance})),o.aV(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(r,c){this.mouseRotate.mousedown(r,c),this.mousePitch&&this.mousePitch.mousedown(r,c),oe()}move(r,c){const f=this.map,y=this.mouseRotate.mousemoveWindow(r,c),v=y&&y.bearingDelta;if(v&&f.setBearing(f.getBearing()+v),this.mousePitch){const S=this.mousePitch.mousemoveWindow(r,c),N=S&&S.pitchDelta;N&&f.setPitch(f.getPitch()+N)}}off(){const r=this.element;r.removeEventListener("mousedown",this.mousedown),r.removeEventListener("touchstart",this.touchstart),r.removeEventListener("touchmove",this.touchmove),r.removeEventListener("touchend",this.touchend),r.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){ae(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(r){this.down(o.h({},r,{ctrlKey:!0,preventDefault:()=>r.preventDefault()}),Le(this.element,r)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(r){this.move(r,Le(this.element,r))}mouseup(r){this.mouseRotate.mouseupWindow(r),this.mousePitch&&this.mousePitch.mouseupWindow(r),this.offTemp()}touchstart(r){r.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=ct(this.element,r.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>r.preventDefault()},this._startPos))}touchmove(r){r.targetTouches.length!==1?this.reset():(this._lastPos=ct(this.element,r.targetTouches)[0],this.move({preventDefault:()=>r.preventDefault()},this._lastPos))}touchend(r){r.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function Aa(p,r,c){if(p=new o.ci(p.lng,p.lat),r){const f=new o.ci(p.lng-360,p.lat),y=new o.ci(p.lng+360,p.lat),v=360*Math.ceil(Math.abs(p.lng-c.center.lng)/360),S=c.locationPoint3D(p).distSqr(r),N=r.x<0||r.y<0||r.x>c.width||r.y>c.height;c.locationPoint3D(f).distSqr(r)<S&&(N||Math.abs(f.lng-c.center.lng)<v)?p=f:c.locationPoint3D(y).distSqr(r)<S&&(N||Math.abs(y.lng-c.center.lng)<v)&&(p=y)}for(;Math.abs(p.lng-c.center.lng)>180;){const f=c.locationPoint3D(p);if(f.x>=0&&f.y>=0&&f.x<=c.width&&f.y<=c.height)break;p.lng>c.center.lng?p.lng-=360:p.lng+=360}return p}const ra={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},mo={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class ia extends o.E{constructor(r,c){super(),(r instanceof HTMLElement||c)&&(r=o.h({element:r},c)),o.aV(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:f="center",color:y="#3FB1CE",scale:v=1,draggable:S=!1,clickTolerance:N=0,rotation:C=mo.rotation,rotationAlignment:k=mo.rotationAlignment,pitchAlignment:D=mo.pitchAlignment,occludedOpacity:U=mo.occludedOpacity,altitude:O=mo.altitude}=r||{};this._anchor=f,this._color=y,this._scale=v,this._draggable=S,this._clickTolerance=N,this._rotation=C,this._rotationAlignment=k,this._pitchAlignment=D,this._occludedOpacity=U,this._altitude=O,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),r&&r.element?(this._element=r.element,this._offset=o.P.convert(r&&r.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=o.P.convert(r&&r.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",J=>{J.preventDefault()}),this._element.addEventListener("mousedown",J=>{J.preventDefault()});const G=this._element.classList;for(const J in ra)G.remove(`mapboxgl-marker-anchor-${J}`);G.add(`mapboxgl-marker-anchor-${this._anchor}`);const ee=r&&r.className?r.className.trim().split(/\s+/):[];G.add(...ee),this._popup=null}_createDefaultMarker(){const r=H("div"),c=X("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},r);if(this._altitude===0){const f=X("radialGradient",{id:"shadowGradient"},X("defs",{},c));X("stop",{offset:"10%","stop-opacity":.4},f),X("stop",{offset:"100%","stop-opacity":.05},f),X("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return X("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),X("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),X("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),r}addTo(r){return r===this._map||(this.remove(),this._map=r,r.getCanvasContainer().appendChild(this._element),r.on("move",this._updateMoving),r.on("moveend",this._update),r.on("remove",this._clearFadeTimer),r._addMarker(this),this.setDraggable(this._draggable),this._update(),r.on("click",this._onMapClick)),this}remove(){const r=this._map;return r&&(r.off("click",this._onMapClick),r.off("move",this._updateMoving),r.off("moveend",this._update),r.off("mousedown",this._addDragHandler),r.off("touchstart",this._addDragHandler),r.off("mouseup",this._onUp),r.off("touchend",this._onUp),r.off("mousemove",this._onMove),r.off("touchmove",this._onMove),r.off("remove",this._clearFadeTimer),r._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(r){return this._lngLat=o.ci.convert(r),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(r){return r===this._altitude||(this._defaultMarker&&(this._altitude===0&&r!==0||this._altitude!==0&&r===0)&&(this._element=this._createDefaultMarker()),this._altitude=r||mo.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(r){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),r){if(!("offset"in r.options)){const y=Math.sqrt(Math.pow(13.5,2)/2);r.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[y,-1*(38.1-13.5+y)],"bottom-right":[-y,-1*(38.1-13.5+y)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=r,r._marker=this,r._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(r){const c=r.code,f=r.charCode||r.keyCode;c!=="Space"&&c!=="Enter"&&f!==32&&f!==13||this.togglePopup()}_onMapClick(r){const c=r.originalEvent.target,f=this._element;this._popup&&(c===f||f.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const r=this._popup;return r?(r.isOpen()?(r.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(r.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const r=this._map,c=this._pos;if(!r||!c)return!1;const f=r.unproject(c,this._altitude),y=r.getFreeCameraOptions();if(!y.position)return!1;const v=y.position.toLngLat();return v.distanceTo(f)<.9*v.distanceTo(this._lngLat)}_evaluateOpacity(){const r=this._map;if(!r)return;const c=this._pos;if(!c||c.x<0||c.x>r.transform.width||c.y<0||c.y>r.transform.height)return void this._clearFadeTimer();const f=r.unproject(c,this._altitude);let y;r._showingGlobe()&&o.eW(r.transform,this._lngLat)?y=0:(y=1-r._queryFogOpacity(f),r.transform._terrainEnabled()&&r.getTerrain()&&this._behindTerrain()&&(y*=this._occludedOpacity)),this._element.style.opacity=`${y}`,this._element.style.pointerEvents=y>0?"auto":"none",this._popup&&this._popup._setOpacity(y),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const r=this._pos;if(!r||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${r.x}px,${r.y}px)
            ${ra[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const r=this._pos,c=this._map,f=this.getPitchAlignment();if(!c||!r||f!=="map")return"";if(!c._showingGlobe()){const C=c.getPitch();return C?`rotateX(${C}deg)`:""}const y=o.cU(o.eX(c.transform,this._lngLat)),v=r.sub(o.eY(c.transform)),S=Math.abs(v.x)+Math.abs(v.y);if(S===0)return"";const N=y/S;return`rotateX(${-v.y*N}deg) rotateY(${v.x*N}deg)`}_calculateZTransform(){const r=this._pos,c=this._map;if(!c||!r)return"";let f=0;const y=this.getRotationAlignment();if(y==="map")if(c._showingGlobe()){const v=c.project(new o.ci(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),S=c.project(new o.ci(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(v);f=o.cU(Math.atan2(S.y,S.x))-90}else f=-c.getBearing();else if(y==="horizon"){const v=o.af(4,6,c.getZoom()),S=o.eY(c.transform);S.y+=v*c.transform.height;const N=r.sub(S),C=o.cU(Math.atan2(N.y,N.x));f=(C>90?C-270:C+90)*(1-v)}return f+=this._rotation,f?`rotateZ(${f}deg)`:""}_update(r){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=Aa(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),r===!0?this._updateFrameId=requestAnimationFrame(()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())}):this._pos=this._pos.round(),c._requestDomTask(()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))}))}getOffset(){return this._offset}setOffset(r){return this._offset=o.P.convert(r),this._update(),this}addClassName(r){return this._element.classList.add(r),this}removeClassName(r){return this._element.classList.remove(r),this}toggleClassName(r){return this._element.classList.toggle(r)}_onMove(r){const c=this._map;if(!c)return;const f=this._pointerdownPos,y=this._positionDelta;if(f&&y){if(!this._isDragging){const v=this._clickTolerance||c._clickTolerance;if(r.point.dist(f)<v)return;this._isDragging=!0}this._pos=r.point.sub(y),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new o.A("dragstart"))),this.fire(new o.A("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const r=this._map;r&&(r.off("mousemove",this._onMove),r.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new o.A("dragend")),this._state="inactive"}_addDragHandler(r){const c=this._map,f=this._pos;c&&f&&this._element.contains(r.originalEvent.target)&&(r.preventDefault(),this._positionDelta=r.point.sub(f),this._pointerdownPos=r.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(r){this._draggable=!!r;const c=this._map;return c&&(r?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(r){return this._rotation=r||mo.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(r){return this._rotationAlignment=r||mo.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(r){return this._pitchAlignment=r||mo.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(r){return this._occludedOpacity=r||mo.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const ej={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},tj={maxWidth:100,unit:"metric"},sj={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},nj={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},w1=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function to(p=new o.P(0,0),r="bottom"){if(typeof p=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(p,2)));switch(r){case"top":return new o.P(0,p);case"top-left":return new o.P(c,c);case"top-right":return new o.P(-c,c);case"bottom":return new o.P(0,-p);case"bottom-left":return new o.P(c,-c);case"bottom-right":return new o.P(-c,-c);case"left":return new o.P(p,0);case"right":return new o.P(-p,0)}return new o.P(0,0)}return p instanceof o.P||Array.isArray(p)?o.P.convert(p):o.P.convert(p[r]||[0,0])}return{version:E,supported:Y.supported,setRTLTextPlugin:o.f0,getRTLTextPluginStatus:o.e$,Map:class extends xl{constructor(p){M.mark(P.create);const r=p;if((p=o.h({},kp,p)).minZoom!=null&&p.maxZoom!=null&&p.minZoom>p.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(p.minPitch!=null&&p.maxPitch!=null&&p.minPitch>p.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(p.minPitch!=null&&p.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(p.maxPitch!=null&&p.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(p.antialias&&o.eU(window)&&(p.antialias=!1,o.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new Fx(p.minZoom,p.maxZoom,p.minPitch,p.maxPitch,p.renderWorldCopies,null,null),p),this._repaint=!!p.repaint,this._interactive=p.interactive,this._minTileCacheSize=p.minTileCacheSize,this._maxTileCacheSize=p.maxTileCacheSize,this._failIfMajorPerformanceCaveat=p.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=p.preserveDrawingBuffer,this._antialias=p.antialias,this._trackResize=p.trackResize,this._bearingSnap=p.bearingSnap,this._refreshExpiredTiles=p.refreshExpiredTiles,this._fadeDuration=p.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=p.crossSourceCollisions,this._collectResourceTiming=p.collectResourceTiming,this._language=this._parseLanguage(p.language),this._worldview=p.worldview,this._renderTaskQueue=new v1,this._domRenderTaskQueue=new v1,this._controls=[],this._markers=[],this._popups=[],this._mapId=o.a$(),this._locale=o.h({},QS,p.locale),this._clickTolerance=p.clickTolerance,this._cooperativeGestures=p.cooperativeGestures,this._performanceMetricsCollection=p.performanceMetricsCollection,this._tessellationStep=p.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=p.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Rp(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=p.scaleFactor,this._requestManager=new wt(p.transformRequest,p.accessToken,p.testMode),this._silenceAuthErrors=!!p.testMode,this._contextCreateOptions=p.contextCreateOptions?Object.assign({},p.contextCreateOptions):{},typeof p.container=="string"){const c=document.getElementById(p.container);if(!c)throw new Error(`Container '${p.container.toString()}' not found.`);this._container=c}else{if(!(p.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=p.container}if(this._container.childNodes.length>0&&o.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),p.maxBounds&&this.setMaxBounds(p.maxBounds),this._spriteFormat=p.spriteFormat,o.aV(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new qS),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},()=>{this._update()}),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},()=>{this.setScaleFactor(this._scaleFactor)}),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",()=>this._update(!1)),this.on("moveend",()=>this._update(!1)),this.on("zoom",()=>this._update(!0)),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new Om(this,p),this._localFontFamily=p.localFontFamily,this._localIdeographFontFamily=p.localIdeographFontFamily,(p.style||!p.testMode)&&this.setStyle(p.style||o.e.DEFAULT_STYLE,{config:p.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),p.projection&&this.setProjection(p.projection),this.indoor=new AS(this),p.hash&&(this._hash=new Pm(typeof p.hash=="string"&&p.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){r.center==null&&r.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:p.center,zoom:p.zoom,bearing:p.bearing,pitch:p.pitch});const c=p.bounds;c&&(this.resize(),this.fitBounds(c,o.h({},p.fitBoundsOptions,{duration:0})))}this.resize(),p.attributionControl&&this.addControl(new Bd({customAttribution:p.customAttribution})),this._logoControl=new Mp,this.addControl(this._logoControl,p.logoPosition),this.on("style.load",()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()}),this.on("data",c=>{this._update(c.dataType==="style"),this.fire(new o.A(`${c.dataType}data`,c))}),this.on("dataloading",c=>{this.fire(new o.A(`${c.dataType}dataloading`,c))}),this._interactions=new Gy(this)}_getMapId(){return this._mapId}addControl(p,r){if(r===void 0&&(r=p.getDefaultPosition?p.getDefaultPosition():"top-right"),!p||!p.onAdd)return this.fire(new o.z(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=p.onAdd(this);this._controls.push(p);const f=this._controlPositions[r];return r.indexOf("bottom")!==-1?f.insertBefore(c,f.firstChild):f.appendChild(c),this}removeControl(p){if(!p||!p.onRemove)return this.fire(new o.z(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const r=this._controls.indexOf(p);return r>-1&&this._controls.splice(r,1),p.onRemove(this),this}hasControl(p){return this._controls.indexOf(p)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(p){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const r=!this._moving;return r&&this.fire(new o.A("movestart",p)).fire(new o.A("move",p)),this.fire(new o.A("resize",p)),r&&this.fire(new o.A("moveend",p)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(p){return this.transform.setMaxBounds(o.aG.convert(p)),this._update()}setMinZoom(p){if((p=p??-2)>=-2&&p<=this.transform.maxZoom)return this.transform.minZoom=p,this._update(),this.getZoom()<p?this.setZoom(p):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(p){if((p=p??22)>=this.transform.minZoom)return this.transform.maxZoom=p,this._update(),this.getZoom()>p?this.setZoom(p):this.fire(new o.A("zoomstart")).fire(new o.A("zoom")).fire(new o.A("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(p){if((p=p??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(p>=0&&p<=this.transform.maxPitch)return this.transform.minPitch=p,this._update(),this.getPitch()<p?this.setPitch(p):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(p){if((p=p??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(p>=this.transform.minPitch)return this.transform.maxPitch=p,this._update(),this.getPitch()>p?this.setPitch(p):this.fire(new o.A("pitchstart")).fire(new o.A("pitch")).fire(new o.A("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(p){return this._scaleFactor=p,this.painter.scaleFactor=p,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers(r=>r.type==="symbol"),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(p){return this.transform.renderWorldCopies=p,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(p){return p==="auto"?navigator.language:Array.isArray(p)?p.length===0?void 0:p.map(r=>r==="auto"?navigator.language:r):p}setLanguage(p){const r=this._parseLanguage(p);if(!this.style||r===this._language)return this;this._language=r,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(p){return this.style&&p!==this._worldview?(this._worldview=p,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(p){return this._lazyInitEmptyStyle(),p?typeof p=="string"&&(p={name:p}):p=null,this._useExplicitProjection=!!p,this._prioritizeAndUpdateProjection(p,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const p=this.transform,r=p.projection.name;let c;r==="globe"&&p.zoom>=o.cI?(p.setMercatorFromTransition(),c=!0):r==="mercator"&&p.zoom<o.cI&&(p.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(p,r){return this._updateProjection(p||r||{name:"mercator"})}_updateProjection(p){let r;return r=p.name==="globe"&&this.transform.zoom>=o.cI?this.transform.setMercatorFromTransition():this.transform.setProjection(p),this.style.applyProjectionUpdate(),r&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(p,r){return this.transform.locationPoint3D(o.ci.convert(p),r)}unproject(p,r){return this.transform.pointLocation3D(o.P.convert(p),r)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(p,r,c){const f=y=>{let v=[];if(Array.isArray(r)){const S=r.filter(N=>this.getLayer(N));v=S.length?this.queryRenderedFeatures(y,{layers:S}):[]}else v=this.queryRenderedFeatures(y,{target:r});return v};if(p==="mouseenter"||p==="mouseover"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:S=>{const N=f(S.point);N.length?y||(y=!0,c.call(this,new ur(p,this,S.originalEvent,{features:N}))):y=!1},mouseout:()=>{y=!1}}}}if(p==="mouseleave"||p==="mouseout"){let y=!1;return{listener:c,targets:r,delegates:{mousemove:N=>{f(N.point).length?y=!0:y&&(y=!1,c.call(this,new ur(p,this,N.originalEvent)))},mouseout:N=>{y&&(y=!1,c.call(this,new ur(p,this,N.originalEvent)))}}}}{const y=v=>{const S=f(v.point);S.length&&(v.features=S,c.call(this,v),delete v.features)};return{listener:c,targets:r,delegates:{[p]:y}}}}on(p,r,c){if(typeof r=="function"||c===void 0)return super.on(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(p,r,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[p]=this._delegatedListeners[p]||[],this._delegatedListeners[p].push(f);for(const y in f.delegates)this.on(y,f.delegates[y]);return this}once(p,r,c){if(typeof r=="function"||c===void 0)return super.once(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._createDelegatedListener(p,r,c);for(const y in f.delegates)this.once(y,f.delegates[y]);return this}off(p,r,c){if(typeof r=="function"||c===void 0)return super.off(p,r);if(typeof r=="string"&&(r=[r]),!this._areTargetsValid(r))return this;const f=this._delegatedListeners?this._delegatedListeners[p]:void 0;return f&&(y=>{for(let v=0;v<y.length;v++){const S=y[v];if(S.listener===c&&Hy(S.targets,r)){for(const N in S.delegates)this.off(N,S.delegates[N]);return y.splice(v,1),this}}})(f),this}queryRenderedFeatures(p,r){if(!this.style)return[];if(p===void 0||p instanceof o.P||Array.isArray(p)||r!==void 0||(r=p,p=void 0),p=p||[[0,0],[this.transform.width,this.transform.height]],!r){const v=this.style.queryRenderedFeatures(p,void 0,this.transform),S=this.style.queryRenderedFeatureset(p,void 0,this.transform);return v.concat(S)}let c=!0;if(r.target&&(c=this._isTargetValid(r.target),c&&!r.layers))return this.style.queryRenderedFeatureset(p,r,this.transform);let f=!0;if(r.layers&&Array.isArray(r.layers)){for(const v of r.layers)if(!this._isValidId(v)){f=!1;break}if(f&&!r.target)return this.style.queryRenderedFeatures(p,r,this.transform)}let y=[];return f&&(y=y.concat(this.style.queryRenderedFeatures(p,r,this.transform))),c&&(y=y.concat(this.style.queryRenderedFeatureset(p,r,this.transform))),y}querySourceFeatures(p,r){return!p||typeof p=="string"&&!this._isValidId(p)?[]:this.style.querySourceFeatures(p,r)}isPointOnSurface(p){const{name:r}=this.transform.projection;return r!=="globe"&&r!=="mercator"&&o.w(`${r} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(o.P.convert(p))}addInteraction(p,r){return this._interactions.add(p,r),this}removeInteraction(p){return this._interactions.remove(p),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(p){return this._cooperativeGestures=p,this}setStyle(p,r){return r=o.h({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},r),this.style&&p&&r.diff!==!1&&r.localFontFamily===this._localFontFamily&&r.localIdeographFontFamily===this._localIdeographFontFamily&&!r.config?(this.style._diffStyle(p,(c,f)=>{if(c){const y=typeof c=="string"?c:c instanceof Error?c.message:c.error;o.w(`Unable to perform style diff: ${y}. Rebuilding the style from scratch.`),this._updateStyle(p,r)}else f&&this._update(!0)},()=>this._postStyleLoadEvent()),this):(this._localIdeographFontFamily=r.localIdeographFontFamily,this._localFontFamily=r.localFontFamily,this._updateStyle(p,r))}_getUIString(p){const r=this._locale[p];if(r==null)throw new Error(`Missing UI string '${p}'`);return r}_updateStyle(p,r){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),p){const c=o.h({},r);r&&r.config&&(c.initialConfig=r.config,delete c.config),this.style=new Na(this,c).load(p),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new Na(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(o.w("There is no style added to the map."),!1)}_isValidId(p){return p==null?(this.fire(new o.z(new Error("IDs can't be empty."))),!1):!o.dk(p)||(this.fire(new o.z(new Error(`IDs can't contain special symbols: "${p}".`))),!1)}_isTargetValid(p){return"featuresetId"in p?this._isValidId("importId"in p?p.importId:p.featuresetId):"layerId"in p&&this._isValidId(p.layerId)}_areTargetsValid(p){if(Array.isArray(p)){for(const r of p)if(!this._isValidId(r))return!1;return!0}return this._isTargetValid(p)}addSource(p,r){return this._isValidId(p)?(this._lazyInitEmptyStyle(),this.style.addSource(p,r),this._update(!0)):this}isSourceLoaded(p){return!!this._isValidId(p)&&!!this.style&&this.style._isSourceCacheLoaded(p)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(p,r,c){this._lazyInitEmptyStyle(),this.style.addSourceType(p,r,c)}removeSource(p){return this._isValidId(p)?(this.style.removeSource(p),this._updateTerrain(),this._update(!0)):this}getSource(p){return this._isValidId(p)?this.style.getOwnSource(p):null}addImage(p,r,{pixelRatio:c=1,sdf:f=!1,stretchX:y,stretchY:v,content:S}={}){this._lazyInitEmptyStyle();const N=o.I.from(p);if(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap){const{width:C,height:k,data:D}=o.q.getImageData(r);this.style.addImage(N,{data:new o.r({width:C,height:k},D),pixelRatio:c,stretchX:y,stretchY:v,content:S,sdf:f,version:0,usvg:!1})}else if(r.width===void 0||r.height===void 0)this.fire(new o.z(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:C,height:k}=r,D=r;this.style.addImage(N,{data:new o.r({width:C,height:k},new Uint8Array(D.data)),pixelRatio:c,stretchX:y,stretchY:v,content:S,sdf:f,usvg:!1,version:0,userImage:D}),D.onAdd&&D.onAdd(this,p)}}updateImage(p,r){this._lazyInitEmptyStyle();const c=o.I.from(p),f=this.style.getImage(c);if(!f)return void this.fire(new o.z(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const y=r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap?o.q.getImageData(r):r,{width:v,height:S,data:N}=y;if(v===void 0||S===void 0)return void this.fire(new o.z(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(v!==(f.usvg?f.icon.usvg_tree.width:f.data.width)||S!==(f.usvg?f.icon.usvg_tree.height:f.data.height))return void this.fire(new o.z(new Error(`The width and height of the updated image (${v}, ${S})
                must be that same as the previous version of the image
                (${f.data.width}, ${f.data.height})`)));const C=!(r instanceof HTMLImageElement||ImageBitmap&&r instanceof ImageBitmap);let k=!1;f.usvg?(f.data=new o.r({width:v,height:S},new Uint8Array(N)),f.usvg=!1,f.icon=void 0,k=!0):f.data.replace(N,C),this.style.updateImage(c,f,k)}hasImage(p){return p?!!this.style&&!!this.style.getImage(o.I.from(p)):(this.fire(new o.z(new Error("Missing required image id"))),!1)}removeImage(p){this.style.removeImage(o.I.from(p))}loadImage(p,r){o.o(this._requestManager.transformRequest(p,o.R.Image),(c,f)=>{r(c,f instanceof HTMLImageElement?o.q.getImageData(f):f)})}listImages(){return this.style.listImages().map(p=>p.name)}addModel(p,r){this._lazyInitEmptyStyle(),this.style.addModel(p,r)}hasModel(p){return p?this.style.hasModel(p):(this.fire(new o.z(new Error("Missing required model id"))),!1)}removeModel(p){this.style.removeModel(p)}listModels(){return this.style.listModels()}addLayer(p,r){return this._isValidId(p.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(p,r),this._update(!0)):this}getSlot(p){const r=this.getLayer(p);return r&&r.slot||null}setSlot(p,r){return this.style.setSlot(p,r),this.style.mergeLayers(),this._update(!0)}addImport(p,r){return this.style.addImport(p,r).catch(c=>this.fire(new o.z(new Error("Failed to add import",c)))),this}updateImport(p,r){return typeof r!="string"&&r.id!==p?(this.removeImport(p),this.addImport(r)):(this.style.updateImport(p,r),this._update(!0))}removeImport(p){return this.style.removeImport(p),this}moveImport(p,r){return this.style.moveImport(p,r),this._update(!0)}moveLayer(p,r){return this._isValidId(p)?(this.style.moveLayer(p,r),this._update(!0)):this}removeLayer(p){return this._isValidId(p)?(this.style.removeLayer(p),this._update(!0)):this}getLayer(p){if(!this._isValidId(p))return null;const r=this.style.getOwnLayer(p);return r?r.type==="custom"?r.implementation:r.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(p,r,c){return this._isValidId(p)?(this.style.setLayerZoomRange(p,r,c),this._update(!0)):this}setFilter(p,r,c={}){return this._isValidId(p)?(this.style.setFilter(p,r,c),this._update(!0)):this}getFilter(p){return this._isValidId(p)?this.style.getFilter(p):null}setPaintProperty(p,r,c,f={}){return this._isValidId(p)?(this.style.setPaintProperty(p,r,c,f),this._update(!0)):this}getPaintProperty(p,r){return this._isValidId(p)?this.style.getPaintProperty(p,r):null}setLayoutProperty(p,r,c,f={}){return this._isValidId(p)?(this.style.setLayoutProperty(p,r,c,f),this._update(!0)):this}getLayoutProperty(p,r){return this._isValidId(p)?this.style.getLayoutProperty(p,r):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(p){return this.style.setGlyphsUrl(p),this._update(!0)}getSchema(p){return this.style.getSchema(p)}setSchema(p,r){return this.style.setSchema(p,r),this._update(!0)}getConfig(p){return this.style.getConfig(p)}setConfig(p,r){return this.style.setConfig(p,r),this._update(!0)}getConfigProperty(p,r){return this.style.getConfigProperty(p,r)}setConfigProperty(p,r,c){return this.style.setConfigProperty(p,r,c),this._update(!0)}getFeaturesetDescriptors(p){return this.style.getFeaturesetDescriptors(p)}setLights(p){if(this._lazyInitEmptyStyle(),p&&p.length===1&&p[0].type==="flat"){const r=p[0];r.properties?this.style.setFlatLight(r.properties,r.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(p),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const p=this.style.getLights()||[];return p.length===0&&p.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),p}setLight(p,r={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:p}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(p){return this._lazyInitEmptyStyle(),!p&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(p),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(p){return this._lazyInitEmptyStyle(),this.style.setFog(p),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(p){return this._lazyInitEmptyStyle(),this.style.setSnow(p),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(p){return this._lazyInitEmptyStyle(),this.style.setRain(p),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(p){return this._lazyInitEmptyStyle(),this.style.setColorTheme(p),this._update(!0)}setImportColorTheme(p,r){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(p,r),this._update(!0)}setCamera(p){return this.style.setCamera(p),this._triggerCameraUpdate(p)}_triggerCameraUpdate(p){return this._update(this.transform.setOrthographicProjectionAtLowPitch(p["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(p){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(o.ci.convert(p),this.transform):0}setFeatureState(p,r){return p.source&&!this._isValidId(p.source)?this:(this.style.setFeatureState(p,r),this._update())}removeFeatureState(p,r){return p.source&&!this._isValidId(p.source)?this:(this.style.removeFeatureState(p,r),this._update())}getFeatureState(p){return p.source&&!this._isValidId(p.source)?null:this.style.getFeatureState(p)}_selectIndoorFloor(p){this.indoor.selectFloor(p)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new $y),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const p=this._container.getBoundingClientRect().width||400,r=this._container.getBoundingClientRect().height||300;let c,f,y,v=this._container;for(;v&&(!f||!y);){const S=window.getComputedStyle(v).transform;S&&S!=="none"&&(c=S.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(f=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(y=c[3])),v=v.parentElement}this._containerWidth=f?Math.abs(p/f):p,this._containerHeight=y?Math.abs(r/y):r}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&o.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const p=this._container;p.classList.add("mapboxgl-map"),(this._missingCSSCanary=H("div","mapboxgl-canary",p)).style.visibility="hidden",this._detectMissingCSS();const r=this._canvasContainer=H("div","mapboxgl-canvas-container",p);this._canvas=H("canvas","mapboxgl-canvas",r),this._interactive&&(r.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=H("div","mapboxgl-control-container",p),f=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach(y=>{f[y]=H("div",`mapboxgl-ctrl-${y}`,c)}),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(p,r){const c=o.q.devicePixelRatio||1;this._canvas.width=c*Math.ceil(p),this._canvas.height=c*Math.ceil(r),this._canvas.style.width=`${p}px`,this._canvas.style.height=`${r}px`}_addMarker(p){this._markers.push(p)}_removeMarker(p){const r=this._markers.indexOf(p);r!==-1&&this._markers.splice(r,1)}_addPopup(p){this._popups.push(p)}_removePopup(p){const r=this._popups.indexOf(p);r!==-1&&this._popups.splice(r,1)}_setupPainter(){const p=o.h({},Y.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),r=this._canvas.getContext("webgl2",p);r?(cn(r,!0),this.painter=new kc(r,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)}),o.l.testSupport(r)):this.fire(new o.z(new Error("Failed to initialize WebGL")))}_contextLost(p){p.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new o.A("webglcontextlost",{originalEvent:p}))}_contextRestored(p){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new o.A("webglcontextrestored",{originalEvent:p}))}_onMapScroll(p){if(p.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(p){return this.style?(this._styleDirty=this._styleDirty||p,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(p){return this._update(),this._renderTaskQueue.add(p)}_cancelRenderFrame(p){this._renderTaskQueue.remove(p)}_requestDomTask(p){!this.loaded()||this.loaded()&&!this.isMoving()?p():this._domRenderTaskQueue.add(p)}_render(p){let r;this.fire(new o.A("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,f=o.q.now(),y=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(r=y.createQuery(),y.beginQuery(c.TIME_ELAPSED_EXT,r)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(p),this._domRenderTaskQueue.run(p),this._removed)return;this._updateProjectionTransition();const v=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const k=this.transform.zoom,D=this.transform.pitch,U=o.q.now(),O=new o.aa(k,{now:U,fadeDuration:v,pitch:D,transition:this.style.transition,worldview:this._worldview});this.style.update(O)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let S=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),S=this._updateAverageElevation(f),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):S=this._updateAverageElevation(f);const N=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,v,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),N&&(this._placementDirty=N.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:v,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new o.A("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,M.mark(P.load),this.fire(new o.A("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),r){const k=o.q.now()-f;y.endQuery(c.TIME_ELAPSED_EXT),setTimeout(()=>{const D=y.getQueryParameter(r,y.QUERY_RESULT)/1e6;y.deleteQuery(r),this.fire(new o.A("gpu-timing-frame",{cpuTime:k,gpuTime:D}))},50)}if(this.listens("gpu-timing-layer")){const k=this.painter.collectGpuTimers();setTimeout(()=>{const D=this.painter.queryGpuTimers(k);this.fire(new o.A("gpu-timing-layer",{layerTimes:D}))},50)}if(this.listens("gpu-timing-deferred-render")){const k=this.painter.collectDeferredRenderGpuQueries();setTimeout(()=>{const D=this.painter.queryGpuTimeDeferredRender(k);this.fire(new o.A("gpu-timing-deferred-render",{gpuTime:D}))},50)}const C=this._sourcesDirty||this._styleDirty||this._placementDirty||S;if(C||this._repaint)this.triggerRepaint();else{const k=this.idle();if(k&&(S=this._updateAverageElevation(f,!0)),S)this.triggerRepaint();else if(this._triggerFrame(!1),k&&(this.fire(new o.A("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const D=this._calculateSpeedIndex();this.fire(new o.A("speedindexcompleted",{speedIndex:D})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||C||(this._fullyLoaded=!0,M.mark(P.fullLoad),this._performanceMetricsCollection&&It(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(p){for(const r of this._markers)p&&!this.getRenderWorldCopies()&&(r._lngLat=r._lngLat.wrap()),r._update();for(const r of this._popups)!p||this.getRenderWorldCopies()||r._trackPointer||(r._lngLat=r._lngLat.wrap()),r._update()}_updateAverageElevation(p,r=!1){const c=y=>(this.transform.averageElevation=y,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const f=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(f||(r||p-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(p)){const y=this.transform.averageElevation;let v=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(v)?v=0:this._averageElevationLastSampledAt=p;const S=Math.abs(y-v);if(S>1){if(this._isInitialLoad||f)return this._averageElevation.jumpTo(v),c(v);this._averageElevation.easeTo(v,p,300)}else if(S>1e-4)return this._averageElevation.jumpTo(v),c(v)}return!!this._averageElevation.isEasing(p)&&c(this._averageElevation.getValue(p))}_authenticate(){ws(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,p=>{if(p&&(p.message===Dt||p.status===401)){const r=this.painter.context.gl;cn(r,!1),this._logoControl instanceof Mp&&this._logoControl._updateLogo(),r&&r.clear(r.DEPTH_BUFFER_BIT|r.COLOR_BUFFER_BIT|r.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new o.z(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}}),Ps(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,()=>{})}_postStyleLoadEvent(){this.style.globalId&&Ms(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const p=this._isDragging();this.painter.updateTerrain(this.style,p)}_calculateSpeedIndex(){const p=this.painter.canvasCopy(),r=this.painter.getCanvasCopiesAndTimestamps();r.timeStamps.push(performance.now());const c=this.painter.context.gl,f=c.createFramebuffer();function y(v){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,v,0);const S=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,S),S}return c.bindFramebuffer(c.FRAMEBUFFER,f),this._canvasPixelComparison(y(p),r.canvasCopies.map(y),r.timeStamps)}_canvasPixelComparison(p,r,c){let f=c[1]-c[0];const y=p.length/4;for(let v=0;v<r.length;v++){const S=r[v];let N=0;for(let C=0;C<S.length;C+=4)S[C]===p[C]&&S[C+1]===p[C+1]&&S[C+2]===p[C+2]&&S[C+3]===p[C+3]&&(N+=1);f+=(c[v+2]-c[v+1])*(1-N/y)}return f}remove(){this._hash&&this._hash.remove();for(const r of this._controls)r.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const p=this.painter.context.gl.getExtension("WEBGL_lose_context");p&&p.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),tn.delete(this.painter.context.gl),Ns.remove(),ss.remove(),this._removed=!0,this.fire(new o.A("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(p){this._renderNextFrame=this._renderNextFrame||p,this.style&&!this._frame&&(this._frame=o.q.frame(r=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(r)}))}_preloadTiles(p){const r=this.style?this.style.getSourceCaches():[];return o.bt(r,(c,f)=>c._preloadTiles(p,f),()=>{this.triggerRepaint()}),this}_onWindowOnline(){this._update()}_onWindowResize(p){this._trackResize&&this.resize({originalEvent:p})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(p){this._showTileBoundaries!==p&&(this._showTileBoundaries=p,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(p){this._showParseStatus!==p&&(this._showParseStatus=p,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(p){this._showTerrainWireframe!==p&&(this._showTerrainWireframe=p,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(p){this._showLayers2DWireframe!==p&&(this._showLayers2DWireframe=p,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(p){this._showLayers3DWireframe!==p&&(this._showLayers3DWireframe=p,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(p){this._speedIndexTiming!==p&&(this._speedIndexTiming=p,this._update())}get showPadding(){return!!this._showPadding}set showPadding(p){this._showPadding!==p&&(this._showPadding=p,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(p){this._showCollisionBoxes!==p&&(this._showCollisionBoxes=p,this._tp.refreshUI(),p?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(p){this._showOverdrawInspector!==p&&(this._showOverdrawInspector=p,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(p){this._repaint!==p&&(this._repaint=p,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(p){this._vertices=p,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(p){this._showTileAABBs!==p&&(this._showTileAABBs=p,this._tp.refreshUI(),p&&this._update())}_setCacheLimits(p,r){o.eV(p,r)}get version(){return E}},NavigationControl:class{constructor(p={}){this.options=o.h({},Vd,p),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",r=>r.preventDefault()),this.options.showZoom&&(o.aV(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",r=>{this._map&&this._map.zoomIn({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",r=>{this._map&&this._map.zoomOut({},{originalEvent:r})}),H("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(o.aV(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",r=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:r}):c.resetNorth({},{originalEvent:r}))}),this._compassIcon=H("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const p=this._map;if(!p)return;const r=p.getZoom(),c=r===p.getMaxZoom(),f=r===p.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=f,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",f.toString())}_rotateCompassArrow(){const p=this._map;if(!p)return;const r=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(p.transform.pitch*(Math.PI/180)),.5)}) rotateX(${p.transform.pitch}deg) rotateZ(${p.transform.angle*(180/Math.PI)}deg)`:`rotate(${p.transform.angle*(180/Math.PI)}deg)`;p._requestDomTask(()=>{this._compassIcon&&(this._compassIcon.style.transform=r)})}onAdd(p){return this._map=p,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),p.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&p.on("pitch",this._rotateCompassArrow),p.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new Vl(p,this._compass,this.options.visualizePitch)),this._container}onRemove(){const p=this._map;p&&(this._container.remove(),this.options.showZoom&&p.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&p.off("pitch",this._rotateCompassArrow),p.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(p,r){const c=H("button",p,this._container);return c.type="button",c.addEventListener("click",r),c}_setButtonTitle(p,r){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${r}`);p.setAttribute("aria-label",c),p.firstElementChild&&p.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends o.E{constructor(p={}){super();const r=navigator.geolocation;this.options=o.h({geolocation:r},ej,p),o.aV(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=kd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(p){return this._map=p,this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(p){const r=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,p(c)};this._supportsGeolocation!==void 0?p(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then(c=>r(c.state!=="denied")).catch(()=>r()):r()}_isOutOfMapMaxBounds(p){const r=this._map.getMaxBounds(),c=p.coords;return!!r&&(c.longitude<r.getWest()||c.longitude>r.getEast()||c.latitude<r.getSouth()||c.latitude>r.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(p){if(this._map){if(this._isOutOfMapMaxBounds(p))return this._setErrorState(),this.fire(new o.A("outofmaxbounds",p)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=p,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(p),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(p),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("geolocate",p)),this._finish()}}_updateCamera(p){const r=new o.ci(p.coords.longitude,p.coords.latitude),c=p.coords.accuracy,f=this._map.getBearing(),y=o.h({bearing:f},this.options.fitBoundsOptions);this._map.fitBounds(r.toBounds(c),y,{geolocateSource:!0})}_updateMarker(p){if(p){const r=new o.ci(p.coords.longitude,p.coords.latitude);this._accuracyCircleMarker.setLngLat(r).addTo(this._map),this._userLocationDotMarker.setLngLat(r).addTo(this._map),this._accuracy=p.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const p=this._map.transform,r=o.cb(1,p._center.lat)*p.worldSize,c=Math.ceil(2*this._accuracy*r);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(p){if(this._map){if(this.options.trackUserLocation)if(p.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(p.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new o.A("error",p)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(p){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",r=>r.preventDefault()),this._geolocateButton=H("button","mapboxgl-ctrl-geolocate",this._container),H("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",p===!1){o.w("Geolocation support is not available so the GeolocateControl will be disabled.");const r=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}else{const r=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",r),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",r)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=H("div","mapboxgl-user-location"),this._dotElement.appendChild(H("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(H("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new ia({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=H("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new ia({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",r=>{r.geolocateSource||this._watchState!=="ACTIVE_LOCK"||r.originalEvent&&r.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new o.A("trackuserlocationend")))})}}_onDeviceOrientation(p){this._userLocationDotMarker&&(p.webkitCompassHeading?this._heading=p.webkitCompassHeading:p.absolute===!0&&(this._heading=-1*p.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return o.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new o.A("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new o.A("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new o.A("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let p;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(p={maximumAge:6e5,timeout:0},this._noTimeout=!0):(p=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,p),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const p=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then(r=>{r==="granted"&&p()}).catch(console.error):p()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:Bd,ScaleControl:class{constructor(p={}){this.options=o.h({},tj,p),this._isNumberFormatSupported=function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}}(),o.aV(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const p=this.options.maxWidth||100,r=this._map,c=r._containerHeight/2,f=r._containerWidth/2-p/2,y=r.unproject([f,c]),v=r.unproject([f+p,c]),S=y.distanceTo(v);if(this.options.unit==="imperial"){const N=3.2808*S;N>5280?this._setScale(p,N/5280,"mile"):this._setScale(p,N,"foot")}else this.options.unit==="nautical"?this._setScale(p,S/1852,"nautical-mile"):S>=1e3?this._setScale(p,S/1e3,"kilometer"):this._setScale(p,S,"meter")}_setScale(p,r,c){this._map._requestDomTask(()=>{const f=function(v){const S=Math.pow(10,`${Math.floor(v)}`.length-1);let N=v/S;return N=N>=10?10:N>=5?5:N>=3?3:N>=2?2:N>=1?1:function(C){const k=Math.pow(10,Math.ceil(-Math.log(C)/Math.LN10));return Math.round(C*k)/k}(N),S*N}(r),y=f/r;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(f):`${f}&nbsp;${sj[c]}`,this._container.style.width=p*y+"px"})}onAdd(p){return this._map=p,this._language=p.getLanguage(),this._container=H("div","mapboxgl-ctrl mapboxgl-ctrl-scale",p.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(p){this._language=p,this._update()}setUnit(p){this.options.unit=p,this._update()}},FullscreenControl:class{constructor(p={}){this._fullscreen=!1,p&&p.container&&(p.container instanceof HTMLElement?this._container=p.container:o.w("Full screen control 'container' must be a DOM element.")),o.aV(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(p){return this._map=p,this._container||(this._container=this._map.getContainer()),this._controlContainer=H("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",o.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const p=this._fullscreenButton=H("button","mapboxgl-ctrl-fullscreen",this._controlContainer);H("span","mapboxgl-ctrl-icon",p).setAttribute("aria-hidden","true"),p.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const p=this._getTitle();this._fullscreenButton.setAttribute("aria-label",p),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",p)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:$y,Popup:class extends o.E{constructor(p){super(),this.options=o.h(Object.create(nj),p),this._altitude=this.options.altitude,o.aV(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(p&&p.className?p.className.trim().split(/\s+/):[])}addTo(p){return this._map&&this.remove(),this._map=p,this.options.closeOnClick&&p.on("preclick",this._onClose),this.options.closeOnMove&&p.on("move",this._onClose),p.on("remove",this.remove),this._update(),p._addPopup(this),this._focusFirstElement(),this._trackPointer?(p.on("mousemove",this._onMouseEvent),p.on("mouseup",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")):p.on("move",this._update),this.fire(new o.A("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const p=this._map;return p&&(p.off("move",this._update),p.off("move",this._onClose),p.off("preclick",this._onClose),p.off("click",this._onClose),p.off("remove",this.remove),p.off("mousemove",this._onMouseEvent),p.off("mouseup",this._onMouseEvent),p.off("drag",this._onMouseEvent),p._canvasContainer&&p._canvasContainer.classList.remove("mapboxgl-track-pointer"),p._removePopup(this),this._map=void 0),this.fire(new o.A("close")),this}getLngLat(){return this._lngLat}setLngLat(p){this._lngLat=o.ci.convert(p),this._pos=null,this._trackPointer=!1,this._update();const r=this._map;return r&&(r.on("move",this._update),r.off("mousemove",this._onMouseEvent),r._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(p){return this._altitude=p,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const p=this._map;return p&&(p.off("move",this._update),p.on("mousemove",this._onMouseEvent),p.on("drag",this._onMouseEvent),p._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(p){return this.setDOMContent(document.createTextNode(p))}setHTML(p){const r=document.createDocumentFragment(),c=document.createElement("body");let f;for(c.innerHTML=p;f=c.firstChild,f;)r.appendChild(f);return this.setDOMContent(r)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(p){return this.options.maxWidth=p,this._update(),this}setDOMContent(p){let r=this._content;if(r)for(;r.hasChildNodes();)r.firstChild&&r.removeChild(r.firstChild);else r=this._content=H("div","mapboxgl-popup-content",this._container||void 0);if(r.appendChild(p),this.options.closeButton){const c=this._closeButton=H("button","mapboxgl-popup-close-button",r);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(p){return this._classList.add(p),this._updateClassList(),this}removeClassName(p){return this._classList.delete(p),this._updateClassList(),this}setOffset(p){return this.options.offset=p,this._update(),this}toggleClassName(p){let r;return this._classList.delete(p)?r=!1:(this._classList.add(p),r=!0),this._updateClassList(),r}_onMouseEvent(p){this._update(p.point)}_getAnchor(p){if(this.options.anchor)return this.options.anchor;const r=this._map,c=this._container,f=this._pos;if(!r||!c||!f)return"bottom";const y=c.offsetWidth,v=c.offsetHeight,S=f.x<y/2,N=f.x>r.transform.width-y/2;if(f.y+p<v)return S?"top-left":N?"top-right":"top";if(f.y>r.transform.height-v){if(S)return"bottom-left";if(N)return"bottom-right"}return S?"left":N?"right":"bottom"}_updateClassList(){const p=this._container;if(!p)return;const r=[...this._classList];r.push("mapboxgl-popup"),this._anchor&&r.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&r.push("mapboxgl-popup-track-pointer"),p.className=r.join(" ")}_update(p){const r=this._map,c=this._content;if(!r||!this._lngLat&&!this._trackPointer||!c)return;let f=this._container;if(f||(f=this._container=H("div","mapboxgl-popup",r.getContainer()),this._tip=H("div","mapboxgl-popup-tip",f),f.appendChild(c)),this.options.maxWidth&&f.style.maxWidth!==this.options.maxWidth&&(f.style.maxWidth=this.options.maxWidth),r.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=Aa(this._lngLat,this._pos,r.transform)),!this._trackPointer||p){const y=this._pos=this._trackPointer&&p instanceof o.P?p:r.project(this._lngLat,this._altitude),v=to(this.options.offset),S=this._anchor=this._getAnchor(v.y),N=to(this.options.offset,S),C=y.add(N).round();r._requestDomTask(()=>{this._container&&S&&(this._container.style.transform=`${ra[S]} translate(${C.x}px,${C.y}px)`)})}if(!this._marker&&r._showingGlobe()){const y=o.eW(r.transform,this._lngLat)?0:1;this._setOpacity(y)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const p=this._container.querySelector(w1);p&&p.focus()}_onClose(){this.remove()}_setOpacity(p){this._container&&(this._container.style.opacity=`${p}`),this._content&&(this._content.style.pointerEvents=p?"auto":"none")}},Marker:ia,Style:Na,LngLat:o.ci,LngLatBounds:o.aG,Point:o.P,MercatorCoordinate:o.ac,FreeCameraOptions:Nv,Evented:o.E,config:o.e,prewarm:o.e_,clearPrewarmedResources:o.eZ,get accessToken(){return o.e.ACCESS_TOKEN},set accessToken(p){o.e.ACCESS_TOKEN=p},get baseApiUrl(){return o.e.API_URL},set baseApiUrl(p){o.e.API_URL=p},get workerCount(){return o.f7.workerCount},set workerCount(p){o.f7.workerCount=p},get maxParallelImageRequests(){return o.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(p){o.e.MAX_PARALLEL_IMAGE_REQUESTS=p},clearStorage(p){o.f6(p)},get workerUrl(){return o.f5.workerUrl},set workerUrl(p){o.f5.workerUrl=p},get workerClass(){return o.f5.workerClass},set workerClass(p){o.f5.workerClass=p},get workerParams(){return o.f5.workerParams},set workerParams(p){o.f5.workerParams=p},get dracoUrl(){return o.f4()},set dracoUrl(p){o.f3(p)},get meshoptUrl(){return o.f2()},set meshoptUrl(p){o.f1(p)},setNow:o.q.setNow,restoreNow:o.q.restoreNow}});var w=m;return w})})(r$);var oue=r$.exports;const Gp=bC(oue),wS=({className:e="",center:s=[36.8219,-1.2921],zoom:l=10,properties:d=[],onPinClick:m,onQuickView:_,selectedPropertyId:w,showMapToggle:o=!1})=>{const E="pk.eyJ1IjoiZ2l0aGluamktMjMiLCJhIjoiY21kZjBwYWxzMDhpbzJpc2t1ZWN4eTRtayJ9.Ry6ibRuMTO84NXNMCXM6mA",P=z.useRef(null),M=z.useRef(null),L=z.useRef(new Map),F=z.useRef(null),[$,Y]=z.useState("light"),[H,X]=z.useState(!1),[Z,W]=z.useState(null),[q,oe]=z.useState(0),ae=()=>{!M.current||!M.current.isStyleLoaded()||(L.current.forEach(Dt=>Dt.remove()),L.current.clear(),d.forEach(Dt=>{const wt=w===Dt.id,rs=document.createElement("div");rs.className="custom-marker",rs.innerHTML=`
        <div class="relative">
          <div class="w-6 h-6 rounded-full border-2 border-white shadow-lg 
                      flex items-center justify-center ${wt?"bg-blue-500 scale-125":"bg-green-500"}">
            <div class="w-2 h-2 bg-white rounded-full"></div>
          </div>
          ${wt?'<div class="absolute -top-1 -right-1 w-3 h-3 bg-blue-500 rounded-full border-2 border-white"></div>':""}
        </div>
      `;const Vt=new Gp.Marker({element:rs,anchor:"bottom"}).setLngLat([Dt.longitude,Dt.latitude]).addTo(M.current);L.current.set(Dt.id,Vt),Vt.getElement().addEventListener("click",()=>{W(Dt),oe(0),F.current&&F.current.remove();const Bt=xt(Dt),{anchor:ze,offset:Xe}=ct(Dt);F.current=new Gp.Popup({closeButton:!0,closeOnClick:!1,maxWidth:"220px",offset:Xe,className:"custom-popup",anchor:ze}).setLngLat([Dt.longitude,Dt.latitude]).setDOMContent(Bt).addTo(M.current),m&&m(Dt.id)})}))},Ne=Dt=>{if(!M.current)return;const wt={light:"mapbox://styles/mapbox/light-v11",dark:"mapbox://styles/mapbox/dark-v11",satellite:"mapbox://styles/mapbox/satellite-v9"};M.current.setStyle(wt[Dt]),Y(Dt)},Pe=()=>{Z!=null&&Z.images&&Z.images.length>0&&oe(Dt=>Dt===Z.images.length-1?0:Dt+1)},Le=()=>{Z!=null&&Z.images&&Z.images.length>0&&oe(Dt=>Dt===0?Z.images.length-1:Dt-1)},ct=Dt=>{if(!M.current)return{anchor:"bottom",offset:{top:[0,-5],bottom:[0,10],left:[0,0],right:[0,0]}};const wt=M.current.project([Dt.longitude,Dt.latitude]),rs=M.current.getContainer(),Vt=rs.offsetWidth,Bt=rs.offsetHeight,ze=wt[1];Bt-wt[1];const Xe=wt[0],Ot=Vt-wt[0];let nt="bottom",Mt={top:[0,-5],bottom:[0,10],left:[0,0],right:[0,0]};return ze<120&&(nt="top",Mt={top:[0,10],bottom:[0,-5],left:[0,0],right:[0,0]}),Xe<110&&(Mt.left=[110-Xe,0]),Ot<110&&(Mt.right=[110-Ot,0]),{anchor:nt,offset:Mt}},xt=Dt=>{const wt=document.createElement("div");if(wt.className="p-0",Dt.images&&Dt.images.length>0){const Ot=document.createElement("div");Ot.className="relative";const nt=document.createElement("img");nt.src=Dt.images[q],nt.alt=`${Dt.title} - Image ${q+1}`,nt.className="w-full h-32 object-cover rounded-t-lg";const Mt=document.createElement("div");Mt.className="absolute inset-0 bg-black/20 flex items-center justify-center";const ss=document.createElement("button");if(ss.className="bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2 shadow-lg",ss.innerHTML=`
        <svg class="h-4 w-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 12a3 3 0 11-6 0 3 3 0 016 0z"></path>
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M2.458 12C3.732 7.943 7.523 5 12 5c4.478 0 8.268 2.943 9.542 7-1.274 4.057-5.064 7-9.542 7-4.477 0-8.268-2.943-9.542-7z"></path>
        </svg>
        <span class="text-sm font-medium">Quick View</span>
      `,ss.addEventListener("click",()=>{_&&_(Dt.id),F.current&&F.current.remove()}),Mt.appendChild(ss),Ot.appendChild(nt),Ot.appendChild(Mt),Dt.images.length>1){const Ps=document.createElement("div");Ps.className="absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",Dt.images.forEach((xn,Ms)=>{const Xt=document.createElement("button");Xt.className=`w-2 h-2 rounded-full transition-colors ${Ms===q?"bg-white":"bg-white/50"}`,Xt.addEventListener("click",()=>oe(Ms)),Ps.appendChild(Xt)}),Ot.appendChild(Ps)}wt.appendChild(Ot)}const rs=document.createElement("div");rs.className="p-2 bg-gray-50 rounded-b-lg";const Vt=document.createElement("h3");Vt.className="font-medium text-gray-800 text-xs line-clamp-1 mb-1",Vt.textContent=Dt.title;const Bt=document.createElement("div");Bt.className="flex items-center justify-between";const ze=document.createElement("div");ze.className="text-sm font-bold text-green-600",ze.textContent=Dt.price;const Xe=document.createElement("span");return Xe.className="text-xs text-gray-500 capitalize bg-white px-2 py-1 rounded-full border",Xe.textContent=Dt.propertyType||"Property",Bt.appendChild(ze),Bt.appendChild(Xe),rs.appendChild(Vt),rs.appendChild(Bt),wt.appendChild(rs),wt},yt=()=>{F.current&&(F.current.remove(),F.current=null),W(null),oe(0)},Ht=()=>{_&&Z&&_(Z.id)};return z.useEffect(()=>{if(!P.current)return;const Dt="pk.eyJ1IjoiZ2l0aGluamktMjMiLCJhIjoiY21kZjBwYWxzMDhpbzJpc2t1ZWN4eTRtayJ9.Ry6ibRuMTO84NXNMCXM6mA";return Gp.accessToken=Dt,M.current=new Gp.Map({container:P.current,style:"mapbox://styles/mapbox/light-v11",center:s,zoom:l,minZoom:5,maxZoom:18,attributionControl:!0,customAttribution:" Keja Yangu Kenya"}),M.current.addControl(new Gp.NavigationControl({visualizePitch:!0,showZoom:!0,showCompass:!0}),"top-right"),M.current.addControl(new Gp.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-left"),M.current.addControl(new Gp.FullscreenControl,"top-right"),M.current.on("load",()=>{X(!0),ae()}),M.current.on("styledata",()=>{M.current&&M.current.isStyleLoaded()&&ae()}),M.current.on("move",()=>{F.current&&Z&&F.current.setLngLat([Z.longitude,Z.latitude])}),M.current.on("zoom",()=>{F.current&&Z&&F.current.setLngLat([Z.longitude,Z.latitude])}),()=>{var wt;F.current&&F.current.remove(),(wt=M.current)==null||wt.remove(),L.current.clear()}},[s,l,E]),z.useEffect(()=>{M.current&&M.current.isStyleLoaded()&&H&&ae()},[d,H]),z.useEffect(()=>{if(w){const Dt=d.find(wt=>wt.id===w);Dt&&(W(Dt),oe(0))}else W(null),oe(0)},[w,d]),n.jsxs("div",{className:`relative w-full h-full ${e}`,children:[n.jsx("style",{children:`
        .custom-popup .mapboxgl-popup-content {
          padding: 0 !important;
          border-radius: 8px !important;
          box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15) !important;
          border: 1px solid #e5e7eb !important;
        }
        .custom-popup .mapboxgl-popup-tip {
          border-top-color: #e5e7eb !important;
        }
        .custom-popup .mapboxgl-popup-close-button {
          background: rgba(255, 255, 255, 0.9) !important;
          border-radius: 50% !important;
          width: 20px !important;
          height: 20px !important;
          font-size: 14px !important;
          line-height: 1 !important;
          padding: 0 !important;
          right: 8px !important;
          top: 8px !important;
          z-index: 10 !important;
        }
        .custom-popup .mapboxgl-popup-close-button:hover {
          background: white !important;
        }
      `}),n.jsx("div",{ref:P,className:"absolute inset-0"}),o&&H&&n.jsx("div",{className:"absolute top-4 left-4 z-10",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg p-1 flex flex-col space-y-1",children:[n.jsx("button",{onClick:()=>Ne("light"),className:`p-2 rounded text-xs font-medium transition-colors ${$==="light"?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Light"}),n.jsx("button",{onClick:()=>Ne("dark"),className:`p-2 rounded text-xs font-medium transition-colors ${$==="dark"?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Dark"}),n.jsx("button",{onClick:()=>Ne("satellite"),className:`p-2 rounded text-xs font-medium transition-colors ${$==="satellite"?"bg-blue-500 text-white":"bg-white text-gray-700 hover:bg-gray-100"}`,children:"Satellite"})]})}),d.length>0&&n.jsx("div",{className:"absolute top-4 right-4 z-10",children:n.jsxs("div",{className:"bg-white rounded-lg shadow-lg px-3 py-2",children:[n.jsxs("div",{className:"text-sm font-medium text-gray-700",children:[" ",d.length," Properties"]}),w&&n.jsx("div",{className:"text-xs text-blue-600 font-medium",children:" Selected"})]})}),Z&&n.jsx("div",{className:"absolute z-20",style:{left:`${M.current?M.current.project([Z.longitude,Z.latitude])[0]-110:0}px`,top:`${M.current?M.current.project([Z.longitude,Z.latitude])[1]-220:0}px`},children:n.jsxs("div",{className:"bg-white rounded-lg shadow-xl border max-w-[220px]",children:[n.jsx("button",{onClick:yt,className:"absolute top-1 right-1 z-30 bg-white/90 backdrop-blur-sm rounded-full p-0.5 hover:bg-white transition-colors",children:n.jsx(ol,{className:"h-3 w-3 text-gray-600"})}),Z.images&&Z.images.length>0&&n.jsxs("div",{className:"relative",children:[n.jsxs("div",{className:"aspect-[4/3] rounded-t-lg overflow-hidden",children:[n.jsx("img",{src:Z.images[q],alt:`${Z.title} - Image ${q+1}`,className:"w-full h-full object-cover"}),n.jsx("div",{className:"absolute inset-0 bg-black/20 flex items-center justify-center",children:n.jsxs("button",{onClick:Ht,className:"bg-blue-600 text-white px-3 py-2 rounded-lg hover:bg-blue-700 transition-colors flex items-center space-x-2 shadow-lg backdrop-blur-sm",children:[n.jsx(pi,{className:"h-4 w-4"}),n.jsx("span",{className:"text-sm font-medium",children:"Quick View"})]})}),Z.images.length>1&&n.jsxs(n.Fragment,{children:[n.jsx("button",{onClick:Le,className:"absolute left-1 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm rounded-full p-0.5 hover:bg-white transition-colors",children:n.jsx(q2,{className:"h-3 w-3 text-gray-600"})}),n.jsx("button",{onClick:Pe,className:"absolute right-1 top-1/2 transform -translate-y-1/2 bg-white/90 backdrop-blur-sm rounded-full p-0.5 hover:bg-white transition-colors",children:n.jsx(tv,{className:"h-3 w-3 text-gray-600"})})]})]}),Z.images.length>1&&n.jsx("div",{className:"absolute bottom-2 left-1/2 transform -translate-x-1/2 flex space-x-1",children:Z.images.map((Dt,wt)=>n.jsx("button",{onClick:()=>oe(wt),className:`w-2 h-2 rounded-full transition-colors ${wt===q?"bg-white":"bg-white/50"}`},wt))})]}),n.jsxs("div",{className:"p-2 border-t bg-gray-50 rounded-b-lg",children:[n.jsx("h3",{className:"font-medium text-gray-800 text-xs line-clamp-1 mb-1",children:Z.title}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("div",{className:"text-sm font-bold text-green-600",children:Z.price}),n.jsx("span",{className:"text-xs text-gray-500 capitalize bg-white px-2 py-1 rounded-full border",children:Z.propertyType||"Property"})]})]}),n.jsx("div",{className:"absolute top-full left-1/2 transform -translate-x-1/2 w-0 h-0 border-l-4 border-r-4 border-t-4 border-transparent border-t-white"})]})}),E==="YOUR_MAPBOX_ACCESS_TOKEN_HERE",!H&&n.jsx("div",{className:"absolute inset-0 bg-background/80 flex items-center justify-center",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Loading map..."})]})})]})},aue=({placeholder:e="Search properties, locations, or keywords...",initialQuery:s="",initialFilters:l={},onSearch:d,onResultsChange:m,className:_="",showFilters:w=!0,listingType:o="SALE"})=>{const[E,P]=z.useState(s),[M,L]=z.useState(!1),[F,$]=z.useState(10),Y=z.useRef(null),H=z.useRef(null),{searchQuery:X,debouncedQuery:Z,filters:W,results:q,isLoading:oe,error:ae,updateSearchQuery:Ne,updateFilters:Pe,performSearch:Le,resetSearch:ct,totalResults:xt}=jP({...l,listingType:o});z.useEffect(()=>(E&&E!==Z?($(10),Y.current&&clearInterval(Y.current),Y.current=setInterval(()=>{$(Bt=>Bt<=1?(Ne(E),10):Bt-1)},1e3)):($(10),Y.current&&clearInterval(Y.current)),()=>{Y.current&&clearInterval(Y.current)}),[E,Z,Ne]),z.useEffect(()=>{m&&q&&m(q.properties)},[q,m]);const yt=Bt=>{const ze=Bt.target.value;P(ze),ze?L(!0):(ct(),L(!1))},Ht=()=>{var Bt;Ne(E),L(!1),(Bt=H.current)==null||Bt.blur()},Dt=Bt=>{Bt.key==="Enter"&&Ht()},wt=()=>{var Bt;P(""),ct(),L(!1),$(10),(Bt=H.current)==null||Bt.focus()},Vt=E?[{type:"location",text:`${E}, Nairobi`,icon:""},{type:"property",text:`${E} apartments`,icon:""},{type:"feature",text:`${E} properties`,icon:""}].filter(ze=>ze.text.toLowerCase().includes(E.toLowerCase())):[];return n.jsxs("div",{className:`relative ${_}`,children:[n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 h-4 w-4 text-muted-foreground"}),n.jsx(Es,{ref:H,type:"text",placeholder:e,value:E,onChange:yt,onKeyPress:Dt,onFocus:()=>E&&L(!0),className:"pl-10 pr-20 h-12 text-base"}),E&&E!==Z&&n.jsx("div",{className:"absolute right-16 top-1/2 transform -translate-y-1/2",children:n.jsxs(ls,{variant:"secondary",className:"text-xs",children:[n.jsx(Ko,{className:"h-3 w-3 mr-1"}),F,"s"]})}),n.jsx(dt,{onClick:Ht,disabled:!E||oe,size:"sm",className:"absolute right-2 top-1/2 transform -translate-y-1/2 h-8 px-3",children:oe?n.jsx(e2,{className:"h-4 w-4 animate-spin"}):n.jsx(Li,{className:"h-4 w-4"})}),E&&n.jsx(dt,{onClick:wt,variant:"ghost",size:"sm",className:"absolute right-24 top-1/2 transform -translate-y-1/2 h-8 w-8 p-0 hover:bg-muted",children:n.jsx(ol,{className:"h-4 w-4"})})]}),M&&E&&n.jsx("div",{className:"absolute top-full left-0 right-0 mt-1 bg-white border border-border rounded-lg shadow-lg z-50 max-h-60 overflow-y-auto",children:Vt.length>0?n.jsx("div",{className:"p-2",children:Vt.map((Bt,ze)=>n.jsxs("button",{onClick:()=>{P(Bt.text),Ne(Bt.text),L(!1)},className:"w-full text-left p-2 hover:bg-muted rounded-md flex items-center space-x-2 transition-colors",children:[n.jsx("span",{className:"text-lg",children:Bt.icon}),n.jsx("span",{className:"text-sm",children:Bt.text})]},ze))}):n.jsxs("div",{className:"p-4 text-center text-muted-foreground",children:[n.jsx(Ei,{className:"h-8 w-8 mx-auto mb-2 text-muted-foreground/50"}),n.jsx("p",{className:"text-sm",children:"No suggestions found"})]})}),q&&n.jsxs("div",{className:"mt-2 flex items-center justify-between text-sm text-muted-foreground",children:[n.jsx("span",{children:oe?n.jsxs("span",{className:"flex items-center",children:[n.jsx(e2,{className:"h-3 w-3 animate-spin mr-1"}),"Searching..."]}):`${xt} properties found`}),ae&&n.jsx("span",{className:"text-destructive text-xs",children:ae})]}),w&&Object.keys(W).length>0&&n.jsx("div",{className:"mt-2 flex flex-wrap gap-2",children:Object.entries(W).map(([Bt,ze])=>ze?n.jsxs(ls,{variant:"secondary",className:"text-xs cursor-pointer hover:bg-secondary/80",onClick:()=>Pe({[Bt]:void 0}),children:[Bt,": ",ze,n.jsx(ol,{className:"h-3 w-3 ml-1"})]},Bt):null)})]})},lue=()=>{var Xt;const[e,s]=z.useState("grid"),[l,d]=z.useState(1),[m,_]=z.useState("newest"),[w,o]=z.useState(null),[E,P]=z.useState(!1),[M,L]=z.useState(null),[F,$]=z.useState([]),Y=10,[H]=k2(),{searchQuery:X,filters:Z,results:W,isLoading:q,error:oe,hasInitialized:ae,updateSearchQuery:Ne,updateFilters:Pe,resetSearch:Le,totalResults:ct}=jP({listingType:"SALE"});z.useEffect(()=>{const It=H.get("search"),Ns=H.get("propertyType"),ws=H.get("location"),tn=H.get("priceRange"),cn=H.get("bedrooms"),wr=H.get("bathrooms"),cr=H.get("area");if(It&&Ne(It),Ns&&Pe({propertyType:Ns}),ws&&Pe({city:ws}),tn){const[vn,Js]=tn.split("-").map(Rr=>Rr.replace(/[^\d]/g,"")===""?void 0:parseInt(Rr.replace(/[^\d]/g,"")));Pe({minPrice:vn,maxPrice:Js})}if(cn&&Pe({minBedrooms:parseInt(cn)}),It||Ns||ws||tn||cn||wr||cr){const vn=window.location.pathname;window.history.replaceState({},"",vn)}},[H,Ne,Pe]);const xt=[{id:"1",title:"Modern Villa in Karen",location:"Karen, Nairobi",price:"25,000,000",image:"/src/assets/property-1.jpg",bedrooms:4,bathrooms:3,area:350,rating:4.8,type:"For Sale",propertyType:"VILLA",longitude:36.6855,latitude:-1.3197},{id:"2",title:"Luxury Apartment in Westlands",location:"Westlands, Nairobi",price:"15,000,000",image:"/src/assets/property-2.jpg",bedrooms:3,bathrooms:2,area:180,rating:4.6,type:"For Sale",propertyType:"APARTMENT",longitude:36.8094,latitude:-1.2681},{id:"3",title:"Family Home in Runda",location:"Runda, Nairobi",price:"35,000,000",image:"/src/assets/property-3.jpg",bedrooms:5,bathrooms:4,area:450,rating:4.9,type:"For Sale",propertyType:"HOUSE",longitude:36.7626,latitude:-1.2176},{id:"4",title:"Spacious Townhouse in Kileleshwa",location:"Kileleshwa, Nairobi",price:"22,000,000",image:"/src/assets/property-1.jpg",bedrooms:4,bathrooms:3,area:280,rating:4.7,type:"For Sale",propertyType:"TOWNHOUSE",longitude:36.7878,latitude:-1.2921},{id:"5",title:"Modern Duplex in Kilimani",location:"Kilimani, Nairobi",price:"18,000,000",image:"/src/assets/property-2.jpg",bedrooms:3,bathrooms:2,area:150,rating:4.5,type:"For Sale",propertyType:"DUPLEX",longitude:36.7989,latitude:-1.2589},{id:"6",title:"Plot for Sale in Malindi",location:"Malindi, Coast",price:"8,000,000",image:"/src/assets/property-3.jpg",bedrooms:0,bathrooms:0,area:500,rating:4.2,type:"For Sale",propertyType:"LAND",longitude:40.1167,latitude:-3.2167},{id:"7",title:"Contemporary Home in Lavington",location:"Lavington, Nairobi",price:"30,000,000",image:"/src/assets/property-1.jpg",bedrooms:5,bathrooms:4,area:400,rating:4.9,type:"For Sale",propertyType:"HOUSE",longitude:36.7519,latitude:-1.2707},{id:"8",title:"Beachfront Plot in Diani",location:"Diani, Coast",price:"45,000,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:0,area:1e3,rating:4.8,type:"For Sale",propertyType:"LAND",longitude:39.5667,latitude:-4.2833},{id:"9",title:"Apartment in Upper Hill",location:"Upper Hill, Nairobi",price:"12,000,000",image:"/src/assets/property-3.jpg",bedrooms:2,bathrooms:2,area:100,rating:4.4,type:"For Sale",propertyType:"APARTMENT",longitude:36.8219,latitude:-1.2864},{id:"10",title:"Rural Farmhouse in Naivasha",location:"Naivasha, Rift Valley",price:"10,000,000",image:"/src/assets/property-1.jpg",bedrooms:4,bathrooms:3,area:600,rating:4.3,type:"For Sale",propertyType:"FARMHOUSE",longitude:36.4333,latitude:-.7167},{id:"11",title:"Luxury Penthouse in Kilimani",location:"Kilimani, Nairobi",price:"50,000,000",image:"/src/assets/property-2.jpg",bedrooms:4,bathrooms:4,area:300,rating:5,type:"For Sale",propertyType:"PENTHOUSE",longitude:36.7989,latitude:-1.2589},{id:"12",title:"Commercial Building in CBD",location:"CBD, Nairobi",price:"120,000,000",image:"/src/assets/property-3.jpg",bedrooms:0,bathrooms:0,area:800,rating:4.7,type:"For Sale",propertyType:"COMMERCIAL",longitude:36.8219,latitude:-1.2864},{id:"13",title:"Office Space in Westlands",location:"Westlands, Nairobi",price:"85,000,000",image:"/src/assets/property-1.jpg",bedrooms:0,bathrooms:2,area:600,rating:4.6,type:"For Sale",propertyType:"COMMERCIAL",longitude:36.8094,latitude:-1.2681},{id:"14",title:"Retail Space in Kilimani Mall",location:"Kilimani, Nairobi",price:"65,000,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:1,area:400,rating:4.5,type:"For Sale",propertyType:"COMMERCIAL",longitude:36.7989,latitude:-1.2589},{id:"15",title:"Student Hostel in Westlands",location:"Westlands, Nairobi",price:"45,000,000",image:"/src/assets/property-3.jpg",bedrooms:20,bathrooms:15,area:800,rating:4.3,type:"For Sale",propertyType:"STUDENT_HOSTEL",longitude:36.8094,latitude:-1.2681},{id:"16",title:"Student Accommodation in Kilimani",location:"Kilimani, Nairobi",price:"38,000,000",image:"/src/assets/property-1.jpg",bedrooms:15,bathrooms:12,area:600,rating:4.4,type:"For Sale",propertyType:"STUDENT_HOSTEL",longitude:36.7989,latitude:-1.2589},{id:"17",title:"Campus Hostel in Upper Hill",location:"Upper Hill, Nairobi",price:"42,000,000",image:"/src/assets/property-2.jpg",bedrooms:18,bathrooms:14,area:700,rating:4.2,type:"For Sale",propertyType:"STUDENT_HOSTEL",longitude:36.8219,latitude:-1.2864},{id:"18",title:"Warehouse in Industrial Area",location:"Industrial Area, Nairobi",price:"75,000,000",image:"/src/assets/property-3.jpg",bedrooms:0,bathrooms:2,area:1200,rating:4.1,type:"For Sale",propertyType:"INDUSTRIAL",longitude:36.8219,latitude:-1.2864},{id:"19",title:"Manufacturing Facility in Athi River",location:"Athi River, Nairobi",price:"95,000,000",image:"/src/assets/property-1.jpg",bedrooms:0,bathrooms:3,area:1500,rating:4,type:"For Sale",propertyType:"INDUSTRIAL",longitude:36.8219,latitude:-1.2864},{id:"20",title:"Storage Facility in Ruiru",location:"Ruiru, Nairobi",price:"55,000,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:1,area:900,rating:4.2,type:"For Sale",propertyType:"INDUSTRIAL",longitude:36.8219,latitude:-1.2864}];z.useEffect(()=>{ae&&W&&W.properties?$(W.properties):$(xt)},[ae,W,xt]);const yt=ae&&W&&W.properties?W.properties:xt,Ht=[...yt].sort((It,Ns)=>{switch(m){case"price-low":return parseInt(It.price.replace(/,/g,""))-parseInt(Ns.price.replace(/,/g,""));case"price-high":return parseInt(Ns.price.replace(/,/g,""))-parseInt(It.price.replace(/,/g,""));case"rating":return Ns.rating-It.rating;default:return 0}}),Dt=Math.ceil(Ht.length/Y),wt=Ht.slice((l-1)*Y,l*Y),rs=It=>{o(It);const Ns=Ht.findIndex(ws=>ws.id===It);if(Ns!==-1){const ws=Math.floor(Ns/Y)+1;d(ws)}},Vt=It=>{L(It),P(!0)},Bt=()=>{o(null),d(1)},ze=It=>{if(!It)Pe({minPrice:void 0,maxPrice:void 0});else{const[Ns,ws]=It.split("-").map(tn=>tn.replace(/[^\d]/g,"")===""?void 0:parseInt(tn.replace(/[^\d]/g,"")));Pe({minPrice:Ns,maxPrice:ws})}Bt()},Xe=It=>{Pe({propertyType:It||void 0}),Bt()},Ot=It=>{Pe({minBedrooms:It?parseInt(It):void 0}),Bt()},nt=()=>{Le(),Bt()},[Mt,ss]=z.useState({propertyPrice:"",downPayment:"",interestRate:"",loanTerm:15}),[Ps,xn]=z.useState({monthlyPayment:0,principalInterest:0,propertyTax:0,insurance:0,totalLoan:0,totalInterest:0}),Ms=()=>{const It=parseInt(Mt.propertyPrice.replace(/,/g,"")),Ns=parseInt(Mt.downPayment.replace(/,/g,"")),ws=It-Ns,tn=parseFloat(Mt.interestRate)/100,cn=Mt.loanTerm;if(isNaN(It)||isNaN(Ns)||isNaN(tn)||isNaN(cn)){alert("Please enter valid numbers for all fields.");return}if(Ns<.2*It){alert("Down payment must be at least 20% of the property price.");return}if(ws<=0){alert("Loan amount must be positive.");return}if(tn<=0){alert("Interest rate must be positive.");return}if(cn<=0){alert("Loan term must be positive.");return}const wr=tn/12,cr=cn*12,vn=ws*wr*Math.pow(1+wr,cr)/(Math.pow(1+wr,cr)-1),Js=vn*cr-ws,Rr=.005*It,Jo=.001*It;xn({monthlyPayment:Math.round(vn),principalInterest:Math.round(vn*cr-Js),propertyTax:Math.round(Rr),insurance:Math.round(Jo),totalLoan:Math.round(ws),totalInterest:Math.round(Js)})};return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Buy Property"}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Find your perfect home in Kenya"})]}),n.jsxs("div",{className:"bg-card border rounded-lg p-6 mb-8",children:[!ae&&n.jsx("div",{className:"mb-4 p-3 bg-gray-50 border border-gray-200 rounded-lg flex items-center gap-2",children:n.jsx("span",{className:"text-gray-800 text-sm",children:"Use the search bar or filters to find properties"})}),q&&n.jsxs("div",{className:"mb-4 p-3 bg-blue-50 border border-blue-200 rounded-lg flex items-center gap-2",children:[n.jsx(e2,{className:"h-4 w-4 animate-spin text-blue-600"}),n.jsx("span",{className:"text-blue-800 text-sm",children:"Searching properties..."})]}),oe&&n.jsxs("div",{className:"mb-4 p-3 bg-red-50 border border-red-200 rounded-lg flex items-center gap-2",children:[n.jsx(rl,{className:"h-4 w-4 text-red-600"}),n.jsx("span",{className:"text-red-800 text-sm",children:oe})]}),ae&&!q&&!oe&&W&&W.properties&&W.properties.length>0&&n.jsxs("div",{className:"mb-4 p-3 bg-green-50 border border-green-200 rounded-lg flex items-center gap-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-600"}),n.jsxs("span",{className:"text-green-800 text-sm",children:["Found ",W.total," properties matching your search criteria"]})]}),ae&&!q&&!oe&&W&&W.properties&&W.properties.length===0&&n.jsxs("div",{className:"mb-4 p-3 bg-yellow-50 border border-yellow-200 rounded-lg flex items-center gap-2",children:[n.jsx(rl,{className:"h-4 w-4 text-yellow-600"}),n.jsx("span",{className:"text-yellow-800 text-sm",children:"No properties found matching your criteria"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(aue,{placeholder:"Search by location, property name...",initialQuery:X,onResultsChange:It=>{},listingType:"SALE",className:"w-full"})]})}),n.jsxs(qn,{value:Z.minPrice&&Z.maxPrice?`${Z.minPrice}-${Z.maxPrice}`:"",onValueChange:ze,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Price Range"})}),n.jsxs($n,{children:[n.jsx(it,{value:"5m-15m",children:"KSh 5M - 15M"}),n.jsx(it,{value:"15m-25m",children:"KSh 15M - 25M"}),n.jsx(it,{value:"25m-50m",children:"KSh 25M - 50M"}),n.jsx(it,{value:"50m+",children:"KSh 50M+"})]})]}),n.jsxs(qn,{value:Z.propertyType||"",onValueChange:Xe,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Property Type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"HOUSE",children:"House"}),n.jsx(it,{value:"APARTMENT",children:"Apartment"}),n.jsx(it,{value:"VILLA",children:"Villa"}),n.jsx(it,{value:"TOWNHOUSE",children:"Townhouse"}),n.jsx(it,{value:"LAND",children:"Land"}),n.jsx(it,{value:"DUPLEX",children:"Duplex"}),n.jsx(it,{value:"FARMHOUSE",children:"Farmhouse"}),n.jsx(it,{value:"PENTHOUSE",children:"Penthouse"}),n.jsx(it,{value:"COMMERCIAL",children:"Commercial"}),n.jsx(it,{value:"STUDENT_HOSTEL",children:"Student Hostel"}),n.jsx(it,{value:"INDUSTRIAL",children:"Industrial"})]})]}),n.jsxs(qn,{value:((Xt=Z.minBedrooms)==null?void 0:Xt.toString())||"",onValueChange:Ot,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Bedrooms"})}),n.jsxs($n,{children:[n.jsx(it,{value:"1",children:"1+ Bedrooms"}),n.jsx(it,{value:"2",children:"2+ Bedrooms"}),n.jsx(it,{value:"3",children:"3+ Bedrooms"}),n.jsx(it,{value:"4",children:"4+ Bedrooms"}),n.jsx(it,{value:"5",children:"5+ Bedrooms"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(dt,{className:"bg-primary hover:bg-primary/90 flex-1",children:[n.jsx(wx,{className:"h-4 w-4 mr-2"}),"Filter"]}),n.jsx(dt,{variant:"outline",onClick:nt,className:"px-3",title:"Reset all filters",children:n.jsx($A,{className:"h-4 w-4"})})]})]})]}),n.jsxs("div",{className:"flex h-[calc(100vh-300px)] min-h-[600px] gap-6 mb-12",children:[n.jsx("div",{className:"w-1/2 border rounded-lg overflow-hidden",children:n.jsx(wS,{className:"h-full",properties:F.map(It=>({id:It.id,longitude:It.longitude,latitude:It.latitude,title:It.title,price:`KSh ${It.price}`,propertyType:It.propertyType,bedrooms:It.bedrooms,bathrooms:It.bathrooms,area:It.area,images:[It.image],amenities:["Swimming Pool","Security System","Garden","Parking","Modern Kitchen","Balcony"],rating:It.rating})),onPinClick:rs,onQuickView:It=>{const Ns=F.find(ws=>ws.id===It);Ns&&(L(Ns),P(!0))},selectedPropertyId:w,showMapToggle:!0})}),n.jsxs("div",{className:"w-1/2 flex flex-col",children:[n.jsx("div",{className:"bg-card border rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs(ls,{variant:"secondary",children:[ae?(W==null?void 0:W.total)||0:yt.length," ","properties found"]}),n.jsx("span",{className:"text-muted-foreground text-sm",children:"in Kenya"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex bg-muted rounded-lg p-1",children:[n.jsx(dt,{variant:e==="grid"?"default":"ghost",size:"sm",onClick:()=>s("grid"),className:"px-3",children:n.jsx(D5,{className:"h-4 w-4"})}),n.jsx(dt,{variant:e==="list"?"default":"ghost",size:"sm",onClick:()=>s("list"),className:"px-3",children:n.jsx(L5,{className:"h-4 w-4"})})]}),n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{className:"w-44",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"newest",children:"Newest First"}),n.jsx(it,{value:"price-low",children:"Price: Low to High"}),n.jsx(it,{value:"price-high",children:"Price: High to Low"}),n.jsx(it,{value:"rating",children:"Highest Rated"})]})]})]})]})}),n.jsxs("div",{className:"flex-1 overflow-y-auto",children:[e==="grid"?n.jsx("div",{className:"grid grid-cols-2 gap-4",children:wt.map(It=>n.jsx("div",{className:`transition-all duration-200 ${w===It.id?"ring-2 ring-primary ring-offset-2":""}`,children:n.jsx(aI,{id:It.id,title:It.title,location:It.location,price:It.price,priceType:"sale",image:It.image,bedrooms:It.bedrooms,bathrooms:It.bathrooms,area:It.area,rating:It.rating,isFeatured:It.rating>=4.8,isLuxury:parseInt(It.price.replace(/,/g,""))>=3e7,isVerified:Math.random()<.7,isPaid:Math.random()<.6})},It.id))}):n.jsx("div",{className:"space-y-4",children:wt.map(It=>n.jsx("div",{className:`transition-all duration-200 ${w===It.id?"ring-2 ring-primary ring-offset-2":""}`,children:n.jsx(ot,{className:"hover:shadow-md transition-shadow",children:n.jsx(at,{className:"p-4",children:n.jsxs("div",{className:"flex gap-4",children:[n.jsx("img",{src:It.image,alt:It.title,className:"w-32 h-24 object-cover rounded-lg"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-lg mb-1",children:It.title}),n.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:It.location}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[n.jsxs("span",{children:[It.bedrooms," beds"]}),n.jsxs("span",{children:[It.bedrooms," baths"]}),n.jsxs("span",{children:[It.area," m"]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"font-bold text-primary",children:["KSh ",It.price]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ls,{variant:"outline",children:[" ",It.rating]}),Math.random()<.7&&n.jsx(ls,{className:"bg-green-500 text-green-50 text-xs",children:"Verified"}),Math.random()<.6&&n.jsx(ls,{className:"bg-blue-500 text-blue-50 text-xs",children:"Paid"}),n.jsx(dt,{size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground",onClick:()=>Vt(It),children:"Quick View"})]})]})]})]})})})},It.id))}),Dt>1&&n.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t",children:[n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>d(It=>Math.max(1,It-1)),disabled:l===1,children:[n.jsx(q2,{className:"h-4 w-4"}),"Previous"]}),n.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:Dt},(It,Ns)=>Ns+1).map(It=>n.jsx(dt,{variant:l===It?"default":"outline",size:"sm",onClick:()=>d(It),className:"w-10",children:It},It))}),n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>d(It=>Math.min(Dt,It+1)),disabled:l===Dt,children:["Next",n.jsx(tv,{className:"h-4 w-4"})]})]})]})]})]}),n.jsx("div",{className:"mb-12",children:n.jsx(ot,{className:"border-0 bg-gradient-to-r from-primary/5 to-secondary/5",children:n.jsxs(at,{className:"p-8",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold text-gradient-primary mb-4",children:"Mortgage Calculator"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-2xl mx-auto",children:"Calculate your monthly mortgage payments and understand the total cost of homeownership in Kenya"})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-8",children:[n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:"Property Price (KSh)"}),n.jsx(Es,{placeholder:"25,000,000",className:"text-lg",value:Mt.propertyPrice,onChange:It=>ss(Ns=>({...Ns,propertyPrice:It.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:"Down Payment (KSh)"}),n.jsx(Es,{placeholder:"5,000,000",className:"text-lg",value:Mt.downPayment,onChange:It=>ss(Ns=>({...Ns,downPayment:It.target.value}))})]})]}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:"Interest Rate (%)"}),n.jsx(Es,{placeholder:"12.5",className:"text-lg",value:Mt.interestRate,onChange:It=>ss(Ns=>({...Ns,interestRate:It.target.value}))})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium text-muted-foreground mb-2 block",children:"Loan Term (Years)"}),n.jsxs(qn,{value:Mt.loanTerm.toString(),onValueChange:It=>ss(Ns=>({...Ns,loanTerm:parseInt(It)})),children:[n.jsx(Un,{className:"text-lg",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"15",children:"15 Years"}),n.jsx(it,{value:"20",children:"20 Years"}),n.jsx(it,{value:"25",children:"25 Years"}),n.jsx(it,{value:"30",children:"30 Years"})]})]})]})]}),n.jsx(dt,{className:"w-full bg-primary hover:bg-primary/90 text-lg py-3",onClick:Ms,children:"Calculate Mortgage"})]}),n.jsxs("div",{className:"bg-background/50 rounded-lg p-6 space-y-4",children:[n.jsx("h3",{className:"text-xl font-semibold text-center mb-6",children:"Your Monthly Payment"}),Ps.monthlyPayment>0&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"text-4xl font-bold text-primary mb-2",children:["KSh ",Ps.monthlyPayment.toLocaleString()]}),n.jsx("div",{className:"text-muted-foreground",children:"per month"})]}),n.jsxs("div",{className:"space-y-3 pt-4 border-t",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Principal & Interest:"}),n.jsxs("span",{className:"font-medium",children:["KSh"," ",Ps.principalInterest.toLocaleString()]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Property Tax:"}),n.jsxs("span",{className:"font-medium",children:["KSh ",Ps.propertyTax.toLocaleString()]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Insurance:"}),n.jsxs("span",{className:"font-medium",children:["KSh ",Ps.insurance.toLocaleString()]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Total Loan Amount:"}),n.jsxs("span",{className:"font-medium",children:["KSh ",Ps.totalLoan.toLocaleString()]})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Total Interest:"}),n.jsxs("span",{className:"font-medium",children:["KSh ",Ps.totalInterest.toLocaleString()]})]})]})]}),Ps.monthlyPayment===0&&n.jsx("div",{className:"text-center text-muted-foreground py-8",children:"Enter property details above to calculate your mortgage"})]})]})]})})}),n.jsx("div",{className:"mb-12",children:n.jsx(ot,{className:"border-0 bg-gradient-to-r from-muted/30 to-background",children:n.jsxs(at,{className:"p-8",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold text-gradient-primary mb-4",children:"Kenyan Real Estate Market Trends"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Stay informed about the latest trends, opportunities, and insights in Kenya's dynamic real estate market"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.jsx(ot,{className:"border-0 bg-primary/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:n.jsx(Ei,{className:"h-6 w-6 text-primary"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Market Overview"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Average Price:"}),n.jsx("span",{className:"font-medium",children:"KSh 18.5M"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Price Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+8.2% YoY"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Days on Market:"}),n.jsx("span",{className:"font-medium",children:"45 days"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-secondary/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:n.jsx(Ai,{className:"h-6 w-6 text-secondary"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Popular Areas"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Westlands:"}),n.jsx("span",{className:"font-medium text-success",children:"+12.5%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Karen:"}),n.jsx("span",{className:"font-medium text-success",children:"+9.8%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Runda:"}),n.jsx("span",{className:"font-medium text-success",children:"+7.3%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-warning/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:n.jsx(hi,{className:"h-6 w-6 text-warning"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Investment Insights"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"ROI Potential:"}),n.jsx("span",{className:"font-medium text-success",children:"15-25%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Rental Yield:"}),n.jsx("span",{className:"font-medium",children:"6-8%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Market Cycle:"}),n.jsx("span",{className:"font-medium text-success",children:"Growth Phase"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-success/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center",children:n.jsx(UA,{className:"h-6 w-6 text-success"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Financing Trends"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Avg. Interest Rate:"}),n.jsx("span",{className:"font-medium",children:"12.5%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Loan Approval:"}),n.jsx("span",{className:"font-medium text-success",children:"78%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Down Payment:"}),n.jsx("span",{className:"font-medium",children:"20-30%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-info/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-info/10 rounded-lg flex items-center justify-center",children:n.jsx(ac,{className:"h-6 w-6 text-info"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Government Support"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Boma Yangu:"}),n.jsx("span",{className:"font-medium text-success",children:"Active"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Tax Incentives:"}),n.jsx("span",{className:"font-medium text-success",children:"Available"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Infrastructure:"}),n.jsx("span",{className:"font-medium text-success",children:"Expanding"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-purple/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-purple/10 rounded-lg flex items-center justify-center",children:n.jsx(Rh,{className:"h-6 w-6 text-purple"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Future Outlook"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"2024 Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+10-15%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"New Developments:"}),n.jsx("span",{className:"font-medium text-success",children:"+25%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Market Confidence:"}),n.jsx("span",{className:"font-medium text-success",children:"High"})]})]})]})})]})]})})})]}),n.jsx(Oi,{}),M&&n.jsx(oI,{isOpen:E,onClose:()=>P(!1),property:M})]})},cue=()=>{const[e,s]=z.useState(""),[l,d]=z.useState(""),[m,_]=z.useState(""),[w,o]=z.useState(""),[E,P]=z.useState("grid"),[M,L]=z.useState(1),[F,$]=z.useState("newest"),[Y,H]=z.useState([]),[X,Z]=z.useState(null),[W,q]=z.useState(!1),[oe,ae]=z.useState(null),Ne=10,[Pe]=k2();z.useEffect(()=>{const ze=Pe.get("search"),Xe=Pe.get("propertyType"),Ot=Pe.get("location"),nt=Pe.get("priceRange"),Mt=Pe.get("bedrooms"),ss=Pe.get("bathrooms"),Ps=Pe.get("area");if(ze&&s(ze),Xe&&_(Xe),nt&&d(nt),ze||Xe||Ot||nt||Mt||ss||Ps){const xn=window.location.pathname;window.history.replaceState({},"",xn)}},[Pe]);const ct=[{id:"1",title:"Modern Apartment in Westlands",location:"Westlands, Nairobi",price:"120,000",image:"/src/assets/property-1.jpg",bedrooms:2,bathrooms:2,area:120,rating:4.7,type:"For Rent",propertyType:"apartment",longitude:36.8094,latitude:-1.2681},{id:"2",title:"Spacious House in Lavington",location:"Lavington, Nairobi",price:"250,000",image:"/src/assets/property-2.jpg",bedrooms:4,bathrooms:3,area:280,rating:4.8,type:"For Rent",propertyType:"house",longitude:36.7519,latitude:-1.2707},{id:"3",title:"Luxury Villa in Karen",location:"Karen, Nairobi",price:"450,000",image:"/src/assets/property-3.jpg",bedrooms:5,bathrooms:4,area:400,rating:4.9,type:"For Rent",propertyType:"villa",longitude:36.6855,latitude:-1.3197},{id:"4",title:"Townhouse in Kileleshwa",location:"Kileleshwa, Nairobi",price:"180,000",image:"/src/assets/property-1.jpg",bedrooms:3,bathrooms:2,area:200,rating:4.6,type:"For Rent",propertyType:"townhouse",longitude:36.7878,latitude:-1.2921},{id:"5",title:"Studio Apartment in Kilimani",location:"Kilimani, Nairobi",price:"85,000",image:"/src/assets/property-2.jpg",bedrooms:1,bathrooms:1,area:80,rating:4.4,type:"For Rent",propertyType:"studio",longitude:36.7989,latitude:-1.2589},{id:"6",title:"Penthouse in Upper Hill",location:"Upper Hill, Nairobi",price:"350,000",image:"/src/assets/property-3.jpg",bedrooms:3,bathrooms:3,area:250,rating:4.9,type:"For Rent",propertyType:"penthouse",longitude:36.8219,latitude:-1.2864},{id:"7",title:"Duplex in Runda",location:"Runda, Nairobi",price:"280,000",image:"/src/assets/property-1.jpg",bedrooms:4,bathrooms:3,area:300,rating:4.7,type:"For Rent",propertyType:"duplex",longitude:36.7626,latitude:-1.2176},{id:"8",title:"Student Room in Westlands",location:"Westlands, Nairobi",price:"45,000",image:"/src/assets/property-2.jpg",bedrooms:1,bathrooms:1,area:60,rating:4.2,type:"For Rent",propertyType:"student-hostel",longitude:36.8094,latitude:-1.2681},{id:"9",title:"Shared Student Accommodation",location:"Kilimani, Nairobi",price:"35,000",image:"/src/assets/property-3.jpg",bedrooms:1,bathrooms:1,area:50,rating:4.1,type:"For Rent",propertyType:"student-hostel",longitude:36.7989,latitude:-1.2589},{id:"10",title:"Campus Hostel Room",location:"Upper Hill, Nairobi",price:"40,000",image:"/src/assets/property-1.jpg",bedrooms:1,bathrooms:1,area:55,rating:4,type:"For Rent",propertyType:"student-hostel",longitude:36.8219,latitude:-1.2864},{id:"11",title:"Office Space in CBD",location:"CBD, Nairobi",price:"180,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:2,area:150,rating:4.5,type:"For Rent",propertyType:"commercial",longitude:36.8219,latitude:-1.2864},{id:"12",title:"Retail Shop in Westlands",location:"Westlands, Nairobi",price:"120,000",image:"/src/assets/property-3.jpg",bedrooms:0,bathrooms:1,area:100,rating:4.3,type:"For Rent",propertyType:"commercial",longitude:36.8094,latitude:-1.2681},{id:"13",title:"Warehouse Space",location:"Industrial Area, Nairobi",price:"95,000",image:"/src/assets/property-1.jpg",bedrooms:0,bathrooms:1,area:300,rating:4.1,type:"For Rent",propertyType:"industrial",longitude:36.8219,latitude:-1.2864},{id:"14",title:"Manufacturing Unit",location:"Athi River, Nairobi",price:"150,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:2,area:500,rating:4,type:"For Rent",propertyType:"industrial",longitude:36.8219,latitude:-1.2864},{id:"15",title:"Storage Facility",location:"Ruiru, Nairobi",price:"75,000",image:"/src/assets/property-3.jpg",bedrooms:0,bathrooms:1,area:200,rating:4.2,type:"For Rent",propertyType:"industrial",longitude:36.8219,latitude:-1.2864},{id:"16",title:"Beach House in Diani",location:"Diani, Coast",price:"200,000",image:"/src/assets/property-1.jpg",bedrooms:3,bathrooms:2,area:180,rating:4.8,type:"For Rent",propertyType:"beach-house",longitude:39.5667,latitude:-4.2833},{id:"17",title:"Coastal Villa in Malindi",location:"Malindi, Coast",price:"180,000",image:"/src/assets/property-2.jpg",bedrooms:4,bathrooms:3,area:250,rating:4.6,type:"For Rent",propertyType:"beach-house",longitude:40.1167,latitude:-3.2167},{id:"18",title:"Seaside Apartment",location:"Nyali, Mombasa",price:"150,000",image:"/src/assets/property-3.jpg",bedrooms:2,bathrooms:2,area:120,rating:4.7,type:"For Rent",propertyType:"beach-house",longitude:39.6682,latitude:-4.0435},{id:"19",title:"Serviced Apartment",location:"Westlands, Nairobi",price:"200,000",image:"/src/assets/property-1.jpg",bedrooms:2,bathrooms:2,area:140,rating:4.8,type:"For Rent",propertyType:"serviced",longitude:36.8094,latitude:-1.2681},{id:"20",title:"Luxury Serviced Suite",location:"Kilimani, Nairobi",price:"300,000",image:"/src/assets/property-2.jpg",bedrooms:1,bathrooms:1,area:100,rating:4.9,type:"For Rent",propertyType:"serviced",longitude:36.7989,latitude:-1.2589},{id:"21",title:"Cozy Studio in Hurlingham",location:"Hurlingham, Nairobi",price:"65,000",image:"/src/assets/property-3.jpg",bedrooms:1,bathrooms:1,area:70,rating:4.3,type:"For Rent",propertyType:"studio",longitude:36.7989,latitude:-1.2589},{id:"22",title:"Compact Studio in South C",location:"South C, Nairobi",price:"55,000",image:"/src/assets/property-1.jpg",bedrooms:1,bathrooms:1,area:55,rating:4.1,type:"For Rent",propertyType:"studio",longitude:36.8219,latitude:-1.2864},{id:"23",title:"Family House in Spring Valley",location:"Spring Valley, Nairobi",price:"220,000",image:"/src/assets/property-2.jpg",bedrooms:4,bathrooms:3,area:320,rating:4.6,type:"For Rent",propertyType:"house",longitude:36.7989,latitude:-1.2589},{id:"24",title:"Garden House in Gigiri",location:"Gigiri, Nairobi",price:"280,000",image:"/src/assets/property-3.jpg",bedrooms:5,bathrooms:4,area:380,rating:4.7,type:"For Rent",propertyType:"house",longitude:36.8144,latitude:-1.2354},{id:"25",title:"Executive Penthouse in Westlands",location:"Westlands, Nairobi",price:"400,000",image:"/src/assets/property-1.jpg",bedrooms:3,bathrooms:3,area:280,rating:4.8,type:"For Rent",propertyType:"penthouse",longitude:36.8094,latitude:-1.2681},{id:"26",title:"Luxury Penthouse in Kilimani",location:"Kilimani, Nairobi",price:"380,000",image:"/src/assets/property-2.jpg",bedrooms:2,bathrooms:2,area:200,rating:4.9,type:"For Rent",propertyType:"penthouse",longitude:36.7989,latitude:-1.2589},{id:"27",title:"Modern Duplex in Lavington",location:"Lavington, Nairobi",price:"320,000",image:"/src/assets/property-3.jpg",bedrooms:4,bathrooms:3,area:350,rating:4.8,type:"For Rent",propertyType:"duplex",longitude:36.7519,latitude:-1.2707},{id:"28",title:"Townhouse in Runda",location:"Runda, Nairobi",price:"240,000",image:"/src/assets/property-1.jpg",bedrooms:3,bathrooms:2,area:250,rating:4.5,type:"For Rent",propertyType:"townhouse",longitude:36.7626,latitude:-1.2176},{id:"29",title:"Commercial Office in Upper Hill",location:"Upper Hill, Nairobi",price:"220,000",image:"/src/assets/property-2.jpg",bedrooms:0,bathrooms:2,area:180,rating:4.4,type:"For Rent",propertyType:"commercial",longitude:36.8219,latitude:-1.2864},{id:"30",title:"Villa in Muthaiga",location:"Muthaiga, Nairobi",price:"500,000",image:"/src/assets/property-3.jpg",bedrooms:6,bathrooms:5,area:450,rating:4.9,type:"For Rent",propertyType:"villa",longitude:36.8144,latitude:-1.2354}].filter(ze=>{const Xe=ze.title.toLowerCase().includes(e.toLowerCase())||ze.location.toLowerCase().includes(e.toLowerCase()),Ot=!m||ze.propertyType===m,nt=!l||(()=>{const ss=parseInt(ze.price.replace(/,/g,""));switch(l){case"20k-50k":return ss>=2e4&&ss<=5e4;case"50k-80k":return ss>=5e4&&ss<=8e4;case"80k-120k":return ss>=8e4&&ss<=12e4;case"120k+":return ss>=12e4;default:return!0}})();return Xe&&Ot&&nt&&(!w||!0)}),xt=[...ct].sort((ze,Xe)=>{switch(F){case"price-low":return parseInt(ze.price.replace(/,/g,""))-parseInt(Xe.price.replace(/,/g,""));case"price-high":return parseInt(Xe.price.replace(/,/g,""))-parseInt(ze.price.replace(/,/g,""));case"rating":return Xe.rating-ze.rating;default:return 0}}),yt=Math.ceil(xt.length/Ne),Ht=xt.slice((M-1)*Ne,M*Ne),Dt=ze=>{H(Xe=>Xe.includes(ze)?Xe.filter(Ot=>Ot!==ze):[...Xe,ze]),L(1),Z(null)},wt=ze=>{Z(ze);const Xe=xt.findIndex(Ot=>Ot.id===ze);if(Xe!==-1){const Ot=Math.floor(Xe/Ne)+1;L(Ot)}},rs=ze=>{ae(ze),q(!0)},Vt=()=>{Z(null),L(1)},Bt=()=>{s(""),d(""),_(""),o(""),H([]),Vt()};return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("div",{className:"container mx-auto px-4 py-6",children:[n.jsxs("div",{className:"mb-6",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Rent Property"}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Find your next rental home in Kenya"})]}),n.jsx("div",{className:"bg-card border rounded-lg p-6 mb-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-6 gap-4",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search by location, property name...",value:e,onChange:ze=>{s(ze.target.value),Vt()},className:"pl-10"})]})}),n.jsxs(qn,{value:l,onValueChange:ze=>{d(ze),Vt()},children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Monthly Rent"})}),n.jsxs($n,{children:[n.jsx(it,{value:"20k-50k",children:"KSh 20K - 50K"}),n.jsx(it,{value:"50k-80k",children:"KSh 50K - 80K"}),n.jsx(it,{value:"80k-120k",children:"KSh 80K - 120K"}),n.jsx(it,{value:"120k+",children:"KSh 120K+"})]})]}),n.jsxs(qn,{value:m,onValueChange:ze=>{_(ze),Vt()},children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Property Type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"apartment",children:"Apartment"}),n.jsx(it,{value:"house",children:"House"}),n.jsx(it,{value:"villa",children:"Villa"}),n.jsx(it,{value:"townhouse",children:"Townhouse"}),n.jsx(it,{value:"studio",children:"Studio"}),n.jsx(it,{value:"penthouse",children:"Penthouse"}),n.jsx(it,{value:"duplex",children:"Duplex"}),n.jsx(it,{value:"student-hostel",children:"Student Hostel"}),n.jsx(it,{value:"commercial",children:"Commercial"}),n.jsx(it,{value:"industrial",children:"Industrial"}),n.jsx(it,{value:"beach-house",children:"Beach House"}),n.jsx(it,{value:"serviced",children:"Serviced"})]})]}),n.jsxs(qn,{value:w,onValueChange:ze=>{o(ze),Vt()},children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Duration"})}),n.jsxs($n,{children:[n.jsx(it,{value:"short",children:"Short Term (1-6 months)"}),n.jsx(it,{value:"medium",children:"Medium Term (6-12 months)"}),n.jsx(it,{value:"long",children:"Long Term (1+ years)"})]})]}),n.jsxs("div",{className:"flex gap-2",children:[n.jsxs(dt,{className:"bg-primary hover:bg-primary/90 flex-1",children:[n.jsx(wx,{className:"h-4 w-4 mr-2"}),"Filter"]}),n.jsx(dt,{variant:"outline",onClick:Bt,className:"px-3",title:"Reset all filters",children:n.jsx($A,{className:"h-4 w-4"})})]})]})}),n.jsx("div",{className:"flex flex-wrap gap-2 mb-6",children:["Furnished","Pet Friendly","Parking","Swimming Pool","Gym","Garden","Security"].map(ze=>n.jsx(ls,{variant:Y.includes(ze)?"default":"outline",className:"cursor-pointer hover:bg-primary hover:text-primary-foreground transition-colors",onClick:()=>Dt(ze),children:ze},ze))})]}),n.jsxs("div",{className:"flex h-[calc(100vh-300px)] min-h-[600px] gap-6 px-4 mb-12",children:[n.jsx("div",{className:"w-1/2 border rounded-lg overflow-hidden",children:n.jsx(wS,{className:"h-full",properties:ct.map(ze=>({id:ze.id,longitude:ze.longitude,latitude:ze.latitude,title:ze.title,price:`KSh ${ze.price}/month`,propertyType:ze.propertyType,bedrooms:ze.bedrooms,bathrooms:ze.bathrooms,area:ze.area,images:[ze.image],amenities:["Swimming Pool","Security System","Garden","Parking","Modern Kitchen","Balcony"],rating:ze.rating})),onPinClick:wt,onQuickView:ze=>{const Xe=ct.find(Ot=>Ot.id===ze);Xe&&(ae(Xe),q(!0))},selectedPropertyId:X,showMapToggle:!0})}),n.jsxs("div",{className:"w-1/2 flex flex-col",children:[n.jsx("div",{className:"bg-card border rounded-lg p-4 mb-4",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center gap-4",children:[n.jsxs(ls,{variant:"secondary",children:[ct.length," rentals found"]}),n.jsx("span",{className:"text-muted-foreground text-sm",children:"in Kenya"})]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs("div",{className:"flex bg-muted rounded-lg p-1",children:[n.jsx(dt,{variant:E==="grid"?"default":"ghost",size:"sm",onClick:()=>P("grid"),className:"px-3",children:n.jsx(D5,{className:"h-4 w-4"})}),n.jsx(dt,{variant:E==="list"?"default":"ghost",size:"sm",onClick:()=>P("list"),className:"px-3",children:n.jsx(L5,{className:"h-4 w-4"})})]}),n.jsxs(qn,{value:F,onValueChange:$,children:[n.jsx(Un,{className:"w-44",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"newest",children:"Newest First"}),n.jsx(it,{value:"price-low",children:"Rent: Low to High"}),n.jsx(it,{value:"price-high",children:"Rent: High to Low"}),n.jsx(it,{value:"rating",children:"Highest Rated"})]})]})]})]})}),n.jsxs("div",{className:"flex-1 overflow-y-auto",children:[E==="grid"?n.jsx("div",{className:"grid grid-cols-2 gap-4",children:Ht.map(ze=>n.jsx("div",{className:`transition-all duration-200 ${X===ze.id?"ring-2 ring-primary ring-offset-2":""}`,children:n.jsx(aI,{id:ze.id,title:ze.title,location:ze.location,price:ze.price,priceType:"rent",image:ze.image,bedrooms:ze.bedrooms,bathrooms:ze.bathrooms,area:ze.area,rating:ze.rating,isFeatured:ze.rating>=4.8,isLuxury:parseInt(ze.price.replace(/,/g,""))>=15e4,isVerified:Math.random()<.7,isPaid:Math.random()<.6})},ze.id))}):n.jsx("div",{className:"space-y-4",children:Ht.map(ze=>n.jsx("div",{className:`transition-all duration-200 ${X===ze.id?"ring-2 ring-primary ring-offset-2":""}`,children:n.jsx(ot,{className:"hover:shadow-md transition-shadow",children:n.jsx(at,{className:"p-4",children:n.jsxs("div",{className:"flex gap-4",children:[n.jsx("img",{src:ze.image,alt:ze.title,className:"w-32 h-24 object-cover rounded-lg"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("h3",{className:"font-semibold text-lg mb-1",children:ze.title}),n.jsx("p",{className:"text-muted-foreground text-sm mb-2",children:ze.location}),n.jsxs("div",{className:"flex items-center gap-4 text-sm text-muted-foreground mb-2",children:[n.jsxs("span",{children:[ze.bedrooms," beds"]}),n.jsxs("span",{children:[ze.bathrooms," baths"]}),n.jsxs("span",{children:[ze.area," m"]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"font-bold text-primary",children:["KSh ",ze.price,"/month"]}),n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsxs(ls,{variant:"outline",children:[" ",ze.rating]}),Math.random()<.7&&n.jsx(ls,{className:"bg-green-500 text-green-50 text-xs",children:"Verified"}),Math.random()<.6&&n.jsx(ls,{className:"bg-blue-500 text-blue-50 text-xs",children:"Paid"}),n.jsx(dt,{size:"sm",className:"bg-primary hover:bg-primary/90 text-primary-foreground",onClick:()=>rs(ze),children:"Quick View"})]})]})]})]})})})},ze.id))}),yt>1&&n.jsxs("div",{className:"flex items-center justify-center gap-2 mt-6 pt-4 border-t",children:[n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>L(ze=>Math.max(1,ze-1)),disabled:M===1,children:[n.jsx(q2,{className:"h-4 w-4"}),"Previous"]}),n.jsx("div",{className:"flex items-center gap-1",children:Array.from({length:yt},(ze,Xe)=>Xe+1).map(ze=>n.jsx(dt,{variant:M===ze?"default":"outline",size:"sm",onClick:()=>L(ze),className:"w-10",children:ze},ze))}),n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>L(ze=>Math.min(yt,ze+1)),disabled:M===yt,children:["Next",n.jsx(tv,{className:"h-4 w-4"})]})]})]})]})]}),n.jsx("div",{className:"mb-12 px-4",children:n.jsx(ot,{className:"border-0 bg-gradient-to-r from-muted/30 to-background",children:n.jsxs(at,{className:"p-8",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold text-gradient-primary mb-4",children:"Kenyan Rental Market Trends"}),n.jsx("p",{className:"text-lg text-muted-foreground max-w-3xl mx-auto",children:"Stay informed about the latest rental trends, opportunities, and insights in Kenya's dynamic rental market"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:[n.jsx(ot,{className:"border-0 bg-primary/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-lg flex items-center justify-center",children:n.jsx(Ei,{className:"h-6 w-6 text-primary"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Rental Market Overview"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Average Rent:"}),n.jsx("span",{className:"font-medium",children:"KSh 85,000/month"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Rent Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+6.8% YoY"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Vacancy Rate:"}),n.jsx("span",{className:"font-medium",children:"8.5%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-secondary/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-secondary/10 rounded-lg flex items-center justify-center",children:n.jsx(Ai,{className:"h-6 w-6 text-secondary"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Popular Rental Areas"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Kilimani:"}),n.jsx("span",{className:"font-medium text-success",children:"+9.2%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Westlands:"}),n.jsx("span",{className:"font-medium text-success",children:"+7.8%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Lavington:"}),n.jsx("span",{className:"font-medium text-success",children:"+6.5%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-warning/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-warning/10 rounded-lg flex items-center justify-center",children:n.jsx(hi,{className:"h-6 w-6 text-warning"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Rental Yields"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Apartments:"}),n.jsx("span",{className:"font-medium text-success",children:"7.2%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Houses:"}),n.jsx("span",{className:"font-medium text-success",children:"6.8%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Studios:"}),n.jsx("span",{className:"font-medium text-success",children:"8.1%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-success/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-success/10 rounded-lg flex items-center justify-center",children:n.jsx(_o,{className:"h-6 w-6 text-success"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Tenant Demographics"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Young Professionals:"}),n.jsx("span",{className:"font-medium text-success",children:"45%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Expatriates:"}),n.jsx("span",{className:"font-medium",children:"28%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Students:"}),n.jsx("span",{className:"font-medium",children:"27%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-info/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-info/10 rounded-lg flex items-center justify-center",children:n.jsx(bo,{className:"h-6 w-6 text-info"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Rental Preferences"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Furnished Units:"}),n.jsx("span",{className:"font-medium text-success",children:"65%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Security Features:"}),n.jsx("span",{className:"font-medium text-success",children:"92%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Parking Space:"}),n.jsx("span",{className:"font-medium text-success",children:"78%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-purple/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-purple/10 rounded-lg flex items-center justify-center",children:n.jsx(Rh,{className:"h-6 w-6 text-purple"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Market Outlook"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"2024 Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+8-12%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"New Supply:"}),n.jsx("span",{className:"font-medium text-success",children:"+18%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Demand Trend:"}),n.jsx("span",{className:"font-medium text-success",children:"Strong"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-orange/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-orange/10 rounded-lg flex items-center justify-center",children:n.jsx(bx,{className:"h-6 w-6 text-orange"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Short-term Rentals"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Airbnb Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+35%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Daily Rates:"}),n.jsx("span",{className:"font-medium",children:"KSh 8,500"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Occupancy Rate:"}),n.jsx("span",{className:"font-medium text-success",children:"72%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-teal/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-teal/10 rounded-lg flex items-center justify-center",children:n.jsx(UA,{className:"h-6 w-6 text-teal"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Corporate Rentals"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Company Demand:"}),n.jsx("span",{className:"font-medium text-success",children:"+22%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Avg. Contract:"}),n.jsx("span",{className:"font-medium",children:"18 months"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Premium Rate:"}),n.jsx("span",{className:"font-medium text-success",children:"+15%"})]})]})]})}),n.jsx(ot,{className:"border-0 bg-pink/5",children:n.jsxs(at,{className:"p-6",children:[n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-pink/10 rounded-lg flex items-center justify-center",children:n.jsx(O5,{className:"h-6 w-6 text-pink"})}),n.jsx("h3",{className:"text-lg font-semibold",children:"Student Housing"})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Enrollment Growth:"}),n.jsx("span",{className:"font-medium text-success",children:"+12%"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Avg. Rent:"}),n.jsx("span",{className:"font-medium",children:"KSh 45,000"})]}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx("span",{className:"text-muted-foreground",children:"Shared Units:"}),n.jsx("span",{className:"font-medium text-success",children:"85%"})]})]})]})})]})]})})}),n.jsx(Oi,{}),oe&&n.jsx(oI,{isOpen:W,onClose:()=>q(!1),property:oe})]})},uue=({isOpen:e,onClose:s,propertyTitle:l,agentName:d="Sarah Wanjiku"})=>{const[m,_]=z.useState([{id:"1",text:`Hi! I'm ${d}, your real estate agent. I'm here to help you with any questions about ${l||"this property"}. How can I assist you today?`,sender:"agent",timestamp:new Date}]),[w,o]=z.useState(""),E=()=>{if(!w.trim())return;const P={id:Date.now().toString(),text:w,sender:"user",timestamp:new Date};_(M=>[...M,P]),o(""),setTimeout(()=>{const M={id:(Date.now()+1).toString(),text:"Thank you for your question! I'll be happy to help you with that. Let me get back to you with the details.",sender:"agent",timestamp:new Date};_(L=>[...L,M])},1e3)};return e?n.jsx("div",{className:"fixed inset-0 z-50 bg-black/50 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md h-[600px] flex flex-col",children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsxs($t,{className:"text-lg font-semibold flex items-center gap-2",children:[n.jsx(sv,{className:"h-5 w-5 text-primary"}),"Chat with ",d]}),n.jsx(dt,{variant:"ghost",size:"icon",onClick:s,children:n.jsx(ol,{className:"h-4 w-4"})})]}),n.jsxs(at,{className:"flex-1 flex flex-col p-0",children:[n.jsx("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:m.map(P=>n.jsxs("div",{className:`flex gap-3 ${P.sender==="user"?"flex-row-reverse":""}`,children:[n.jsx(al,{className:"h-8 w-8",children:n.jsx(ll,{children:P.sender==="user"?n.jsx(lu,{className:"h-4 w-4"}):n.jsx(RJ,{className:"h-4 w-4"})})}),n.jsxs("div",{className:`max-w-[70%] p-3 rounded-lg ${P.sender==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[n.jsx("p",{className:"text-sm",children:P.text}),n.jsx("p",{className:"text-xs opacity-70 mt-1",children:P.timestamp.toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]})]},P.id))}),n.jsx("div",{className:"p-4 border-t",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Es,{placeholder:"Type your message...",value:w,onChange:P=>o(P.target.value),onKeyPress:P=>P.key==="Enter"&&E(),className:"flex-1"}),n.jsx(dt,{onClick:E,disabled:!w.trim(),size:"icon",children:n.jsx(K2,{className:"h-4 w-4"})})]})})]})]})}):null},due=()=>{const[e,s]=z.useState(!1),[l,d]=z.useState(!1),m={id:"1",title:"Luxury Villa with Ocean Views",location:"Nyali, Mombasa",price:"25,000,000",priceType:"sale",propertyType:"villa",images:[Tg,Tg,Tg],bedrooms:4,bathrooms:3,area:350,yearBuilt:2022,longitude:39.6682,latitude:-4.0435,description:"This stunning luxury villa offers breathtaking ocean views and modern amenities. Located in the prestigious Nyali area, this property features spacious rooms, a private pool, and beautifully landscaped gardens.",features:["Private swimming pool","Ocean view from all bedrooms","Modern kitchen with granite countertops","Master suite with walk-in closet","Three-car garage","Security system","Landscaped gardens","Backup generator"],agent:{name:"Sarah Wanjiku",phone:"+254 700 123 456",email:"sarah@kejayangu.com",image:Tg}};return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs(dt,{variant:"ghost",className:"mb-6",children:[n.jsx(Cf,{className:"h-4 w-4 mr-2"}),"Back to Search"]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsxs("div",{className:"lg:col-span-2 space-y-6",children:[n.jsxs("div",{className:"relative",children:[n.jsx("div",{className:"aspect-[4/3] rounded-xl overflow-hidden",children:n.jsx("img",{src:m.images[0],alt:m.title,className:"w-full h-full object-cover"})}),n.jsxs("div",{className:"absolute top-4 left-4 flex gap-2",children:[n.jsx(ls,{className:"bg-secondary text-secondary-foreground",children:"Featured"}),n.jsx(ls,{className:"luxury-gradient text-luxury-foreground",children:"Luxury"})]}),n.jsxs("div",{className:"absolute top-4 right-4 flex gap-2",children:[n.jsx(dt,{variant:"ghost",size:"icon",className:`bg-white/80 backdrop-blur-sm hover:bg-white ${l?"text-red-500":"text-gray-600"}`,onClick:()=>d(!l),children:n.jsx(su,{className:`h-5 w-5 ${l?"fill-current":""}`})}),n.jsx(dt,{variant:"ghost",size:"icon",className:"bg-white/80 backdrop-blur-sm hover:bg-white text-gray-600",children:n.jsx(F5,{className:"h-5 w-5"})})]})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-start justify-between mb-4",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-card-foreground mb-2",children:m.title}),n.jsxs("div",{className:"flex items-center gap-1 text-muted-foreground",children:[n.jsx(Ai,{className:"h-4 w-4"}),n.jsx("span",{children:m.location})]})]}),n.jsx("div",{className:"text-right",children:n.jsxs("div",{className:"text-3xl font-bold text-primary",children:["KSh ",m.price]})})]}),n.jsxs("div",{className:"grid grid-cols-4 gap-4 p-4 bg-muted/30 rounded-lg",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(nx,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:m.bedrooms})]}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Bedrooms"})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(sx,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:m.bathrooms})]}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Bathrooms"})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(ix,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:m.area})]}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"m"})]}),n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"flex items-center justify-center gap-1 mb-1",children:[n.jsx(bx,{className:"h-4 w-4"}),n.jsx("span",{className:"font-semibold",children:m.yearBuilt})]}),n.jsx("div",{className:"text-xs text-muted-foreground",children:"Built"})]})]})]}),n.jsxs(Ix,{defaultValue:"description",className:"w-full",children:[n.jsxs(Rf,{className:"grid w-full grid-cols-3",children:[n.jsx(io,{value:"description",children:"Description"}),n.jsx(io,{value:"features",children:"Features"}),n.jsx(io,{value:"location",children:"Location"})]}),n.jsx(oo,{value:"description",className:"space-y-4",children:n.jsx("p",{className:"text-muted-foreground leading-relaxed",children:m.description})}),n.jsx(oo,{value:"features",className:"space-y-4",children:n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-3",children:m.features.map((_,w)=>n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-2 h-2 bg-primary rounded-full"}),n.jsx("span",{className:"text-sm",children:_})]},w))})}),n.jsx(oo,{value:"location",className:"space-y-4",children:n.jsx("div",{className:"h-64",children:n.jsx(wS,{className:"rounded-lg",center:[m.longitude,m.latitude],zoom:15,properties:[{id:m.id,longitude:m.longitude,latitude:m.latitude,title:m.title,price:`KSh ${m.price}`,propertyType:m.propertyType,bedrooms:m.bedrooms,bathrooms:m.bathrooms,area:m.area,images:m.images,amenities:m.features,rating:4.8}],selectedPropertyId:m.id,onQuickView:_=>{console.log("Quick view for property:",_)},showMapToggle:!0})})})]})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsx(ot,{children:n.jsxs(at,{className:"p-6",children:[n.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Contact Agent"}),n.jsxs("div",{className:"flex items-center gap-3 mb-4",children:[n.jsx("div",{className:"w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center",children:n.jsx("span",{className:"text-primary font-semibold",children:"SW"})}),n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:m.agent.name}),n.jsx("div",{className:"text-sm text-muted-foreground",children:"Licensed Agent"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(dt,{className:"w-full",onClick:()=>s(!0),children:[n.jsx(sv,{className:"h-4 w-4 mr-2"}),"Send Message"]}),n.jsxs(dt,{variant:"outline",className:"w-full",children:[n.jsx(Uh,{className:"h-4 w-4 mr-2"}),"Call Now"]})]})]})}),n.jsx(ot,{children:n.jsxs(at,{className:"p-6",children:[n.jsx("h3",{className:"text-lg font-semibold mb-4",children:"Mortgage Calculator"}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm text-muted-foreground",children:"Monthly Payment"}),n.jsx("div",{className:"text-2xl font-bold text-primary",children:"KSh 150,000"})]}),n.jsx(dt,{variant:"outline",className:"w-full",children:"Calculate Details"})]})]})})]})]})]}),n.jsx(Oi,{}),n.jsx(uue,{isOpen:e,onClose:()=>s(!1),propertyTitle:m.title,agentName:m.agent.name})]})},hue=()=>{const e=cc();return z.useEffect(()=>{console.error("404 Error: User attempted to access non-existent route:",e.pathname)},[e.pathname]),n.jsx("div",{className:"min-h-screen flex items-center justify-center bg-gray-100",children:n.jsxs("div",{className:"text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-4",children:"404"}),n.jsx("p",{className:"text-xl text-gray-600 mb-4",children:"Oops! Page not found"}),n.jsx("a",{href:"/",className:"text-blue-500 hover:text-blue-700 underline",children:"Return to Home"})]})})},pue=ev("relative w-full rounded-lg border p-4 [&>svg~*]:pl-7 [&>svg+div]:translate-y-[-3px] [&>svg]:absolute [&>svg]:left-4 [&>svg]:top-4 [&>svg]:text-foreground",{variants:{variant:{default:"bg-background text-foreground",destructive:"border-destructive/50 text-destructive dark:border-destructive [&>svg]:text-destructive"}},defaultVariants:{variant:"default"}}),nd=z.forwardRef(({className:e,variant:s,...l},d)=>n.jsx("div",{ref:d,role:"alert",className:Ds(pue({variant:s}),e),...l}));nd.displayName="Alert";const fue=z.forwardRef(({className:e,...s},l)=>n.jsx("h5",{ref:l,className:Ds("mb-1 font-medium leading-none tracking-tight",e),...s}));fue.displayName="AlertTitle";const rd=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{ref:l,className:Ds("text-sm [&_p]:leading-relaxed",e),...s}));rd.displayName="AlertDescription";const mue=()=>{const e=Xr(),s=cc(),{signIn:l,isLoading:d}=mi(),[m,_]=z.useState({email:"",password:""}),[w,o]=z.useState(!1),[E,P]=z.useState(!1),[M,L]=z.useState(!1),[F,$]=z.useState(""),[Y,H]=z.useState("");z.useEffect(()=>{var oe;(oe=s.state)!=null&&oe.message&&(H(s.state.message),e(s.pathname,{replace:!0}))},[s.state,e,s.pathname]);const X=oe=>{const{name:ae,value:Ne}=oe.target;_(Pe=>({...Pe,[ae]:Ne})),F&&$("")},Z=async oe=>{if(oe.preventDefault(),$(""),H(""),!m.email||!m.password){$("Please fill in all fields");return}if(!m.email.includes("@")){$("Please enter a valid email address");return}L(!0);try{const ae=await l({email:m.email,password:m.password});ae.success?(H("Sign in successful! Redirecting..."),setTimeout(()=>{var Pe,Le;const Ne=(Le=(Pe=ae.data)==null?void 0:Pe.user)==null?void 0:Le.role;e(Ne==="ADMIN"?"/system-admin":Ne==="AGENT"?"/agent/dashboard":Ne==="CONTENT_CREATOR"?"/content-creator-dashboard":"/")},1500)):$(ae.error||"Sign in failed")}catch{$("An unexpected error occurred. Please try again.")}finally{L(!1)}},W=()=>{e("/auth/forgot-password")},q=()=>{e("/auth/register")};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(HD,{className:"w-8 h-8 text-blue-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Welcome Back"}),n.jsx(Zs,{className:"text-gray-600",children:"Sign in to your KejaYangu account to continue"})]}),n.jsxs(at,{children:[Y&&n.jsxs(nd,{className:"mb-4 border-green-200 bg-green-50",children:[n.jsx(dr,{className:"h-4 w-4 text-green-600"}),n.jsx(rd,{className:"text-green-800",children:Y})]}),F&&n.jsxs(nd,{className:"mb-4 border-red-200 bg-red-50",children:[n.jsx(rl,{className:"h-4 w-4 text-red-600"}),n.jsx(rd,{className:"text-red-800",children:F})]}),n.jsxs("form",{onSubmit:Z,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"email",name:"email",type:"email",value:m.email,onChange:X,placeholder:"Enter your email address",className:"pl-10",required:!0,disabled:M}),n.jsx(il,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"password",name:"password",type:w?"text":"password",value:m.password,onChange:X,placeholder:"Enter your password",className:"pl-10 pr-10",required:!0,disabled:M}),n.jsx(R0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("button",{type:"button",onClick:()=>o(!w),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:M,children:w?n.jsx(Hu,{className:"w-4 h-4"}):n.jsx(pi,{className:"w-4 h-4"})})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(sl,{id:"rememberMe",checked:E,onCheckedChange:oe=>P(oe),disabled:M}),n.jsx(ds,{htmlFor:"rememberMe",className:"text-sm text-gray-600",children:"Remember me"})]}),n.jsx("button",{type:"button",onClick:W,className:"text-sm text-blue-600 hover:text-blue-700 hover:underline disabled:opacity-50",disabled:M,children:"Forgot password?"})]}),n.jsx(dt,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:M||d,size:"lg",children:M?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Signing In..."]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(HD,{className:"w-4 h-4"}),"Sign In"]})})]}),n.jsxs("div",{className:"relative my-6",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-gray-300"})}),n.jsx("div",{className:"relative flex justify-center text-sm",children:n.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(dt,{type:"button",variant:"outline",className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",disabled:M,children:[n.jsxs("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:[n.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),n.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),n.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),n.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),n.jsxs(dt,{type:"button",variant:"outline",className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",disabled:M,children:[n.jsx("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:n.jsx("path",{fill:"currentColor",d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),"Continue with Facebook"]})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",n.jsx("button",{onClick:q,className:"text-blue-600 hover:text-blue-700 font-medium hover:underline",disabled:M,children:"Sign up here"})]})})]})]})})},gue=()=>{const e=Xr(),{signUp:s,isLoading:l}=mi(),[d,m]=z.useState({firstName:"",lastName:"",email:"",phone:"",password:"",confirmPassword:"",userType:"USER",agreeToTerms:!1}),[_,w]=z.useState(!1),[o,E]=z.useState(!1),[P,M]=z.useState(!1),[L,F]=z.useState(""),[$,Y]=z.useState({score:0,feedback:[]}),H=ae=>{const Ne=[];let Pe=0;ae.length>=8?(Pe+=1,Ne.push("At least 8 characters")):Ne.push("Need at least 8 characters"),/[a-z]/.test(ae)?(Pe+=1,Ne.push("Contains lowercase letter")):Ne.push("Need lowercase letter"),/[A-Z]/.test(ae)?(Pe+=1,Ne.push("Contains uppercase letter")):Ne.push("Need uppercase letter"),/[0-9]/.test(ae)?(Pe+=1,Ne.push("Contains number")):Ne.push("Need number"),/[^A-Za-z0-9]/.test(ae)?(Pe+=1,Ne.push("Contains special character")):Ne.push("Need special character"),Y({score:Pe,feedback:Ne})},X=ae=>{const{name:Ne,value:Pe}=ae.target;m(Le=>({...Le,[Ne]:Pe})),Ne==="password"&&H(Pe),L&&F("")},Z=ae=>{m(Ne=>({...Ne,agreeToTerms:ae}))},W=()=>!d.firstName||!d.lastName||!d.email||!d.phone||!d.password||!d.confirmPassword?(F("Please fill in all required fields"),!1):d.password!==d.confirmPassword?(F("Passwords do not match"),!1):$.score<3?(F("Password is too weak. Please choose a stronger password."),!1):d.agreeToTerms?d.email.includes("@")?/^(\+254|0)[17]\d{8}$/.test(d.phone)?!0:(F("Please enter a valid Kenyan phone number starting with +254 or 0"),!1):(F("Please enter a valid email address"),!1):(F("Please agree to the terms and conditions"),!1),q=async ae=>{if(ae.preventDefault(),F(""),!!W()){M(!0);try{const Ne=await s({firstName:d.firstName,lastName:d.lastName,email:d.email,phone:d.phone,password:d.password,role:d.userType});Ne.success?e("/auth/verify-email",{state:{message:"Registration successful! Please check your email for verification code.",email:d.email}}):F(Ne.error||"Registration failed")}catch{F("An unexpected error occurred. Please try again.")}finally{M(!1)}}},oe=()=>{e("/auth/signin")};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-lg",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(t2,{className:"w-8 h-8 text-green-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Create Your Account"}),n.jsx(Zs,{className:"text-gray-600",children:"Join KejaYangu and start your real estate journey"})]}),n.jsxs(at,{children:[L&&n.jsxs(nd,{className:"mb-4 border-red-200 bg-red-50",children:[n.jsx(rl,{className:"h-4 w-4 text-red-600"}),n.jsx(rd,{className:"text-red-800",children:L})]}),n.jsxs("form",{onSubmit:q,className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"firstName",className:"text-sm font-medium text-gray-700",children:"First Name *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"firstName",name:"firstName",value:d.firstName,onChange:X,placeholder:"Enter your first name",className:"pl-10",required:!0,disabled:P}),n.jsx(lu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"lastName",className:"text-sm font-medium text-gray-700",children:"Last Name *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"lastName",name:"lastName",value:d.lastName,onChange:X,placeholder:"Enter your last name",className:"pl-10",required:!0,disabled:P}),n.jsx(lu,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"email",name:"email",type:"email",value:d.email,onChange:X,placeholder:"Enter your email address",className:"pl-10",required:!0,disabled:P}),n.jsx(il,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"phone",className:"text-sm font-medium text-gray-700",children:"Phone Number *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"phone",name:"phone",value:d.phone,onChange:X,placeholder:"+254 700 123 456",className:"pl-10",required:!0,disabled:P}),n.jsx(Uh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]}),n.jsx("p",{className:"text-xs text-gray-500",children:"Use Kenyan format: +254 700 123 456 or 0700 123 456"}),n.jsx("p",{className:"text-xs text-blue-600",children:" Tip: Use the same format as your Twilio number (+254...)"})]})]}),n.jsx("input",{type:"hidden",name:"userType",value:"USER"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"password",name:"password",type:_?"text":"password",value:d.password,onChange:X,placeholder:"Create a strong password",className:"pl-10 pr-10",required:!0,disabled:P}),n.jsx(R0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("button",{type:"button",onClick:()=>w(!_),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:P,children:_?n.jsx(Hu,{className:"w-4 h-4"}):n.jsx(pi,{className:"w-4 h-4"})})]}),d.password&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"flex gap-1 mb-2",children:[1,2,3,4,5].map(ae=>n.jsx("div",{className:`h-2 flex-1 rounded-full transition-colors ${ae<=$.score?ae<=2?"bg-red-400":ae<=3?"bg-yellow-400":"bg-green-400":"bg-gray-200"}`},ae))}),n.jsxs("div",{className:"text-xs text-gray-600",children:[$.score<3&&"Password is weak",$.score===3&&"Password is moderate",$.score>3&&"Password is strong"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"confirmPassword",className:"text-sm font-medium text-gray-700",children:"Confirm Password *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"confirmPassword",name:"confirmPassword",type:o?"text":"password",value:d.confirmPassword,onChange:X,placeholder:"Confirm your password",className:"pl-10 pr-10",required:!0,disabled:P}),n.jsx(R0,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"}),n.jsx("button",{type:"button",onClick:()=>E(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600 disabled:opacity-50",disabled:P,children:o?n.jsx(Hu,{className:"w-4 h-4"}):n.jsx(pi,{className:"w-4 h-4"})})]}),d.confirmPassword&&n.jsx("div",{className:"text-xs mt-2",children:d.password===d.confirmPassword?n.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[n.jsx(dr,{className:"w-3 h-3"}),"Passwords match"]}):n.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[n.jsx(rl,{className:"w-3 h-3"}),"Passwords do not match"]})})]})]}),n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(sl,{id:"agreeToTerms",checked:d.agreeToTerms,onCheckedChange:Z,disabled:P,className:"mt-1"}),n.jsxs(ds,{htmlFor:"agreeToTerms",className:"text-sm text-gray-600 leading-relaxed",children:["I agree to the"," ",n.jsx(_r,{to:"/terms",className:"text-green-600 hover:text-green-700 underline",target:"_blank",rel:"noopener noreferrer",children:"Terms and Conditions"})," ","and"," ",n.jsx(_r,{to:"/privacy",className:"text-green-600 hover:text-green-700 underline",target:"_blank",rel:"noopener noreferrer",children:"Privacy Policy"})]})]}),n.jsx(dt,{type:"submit",className:"w-full bg-green-600 hover:bg-green-700 text-white",disabled:P||l,size:"lg",children:P?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Creating Account..."]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(t2,{className:"w-4 h-4"}),"Create Account"]})})]}),n.jsxs("div",{className:"relative my-6",children:[n.jsx("div",{className:"absolute inset-0 flex items-center",children:n.jsx("div",{className:"w-full border-t border-gray-300"})}),n.jsx("div",{className:"relative flex justify-center text-sm",children:n.jsx("span",{className:"px-2 bg-white text-gray-500",children:"Or continue with"})})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(dt,{type:"button",variant:"outline",className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",disabled:P,children:[n.jsxs("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:[n.jsx("path",{fill:"currentColor",d:"M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"}),n.jsx("path",{fill:"currentColor",d:"M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"}),n.jsx("path",{fill:"currentColor",d:"M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"}),n.jsx("path",{fill:"currentColor",d:"M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"})]}),"Continue with Google"]}),n.jsxs(dt,{type:"button",variant:"outline",className:"w-full border-gray-300 text-gray-700 hover:bg-gray-50",disabled:P,children:[n.jsx("svg",{className:"w-4 h-4 mr-2",viewBox:"0 0 24 24",children:n.jsx("path",{fill:"currentColor",d:"M24 12.073c0-6.627-5.373-12-12-12s-12 5.373-12 12c0 5.99 4.388 10.954 10.125 11.854v-8.385H7.078v-3.47h3.047V9.43c0-3.007 1.792-4.669 4.533-4.669 1.312 0 2.686.235 2.686.235v2.953H15.83c-1.491 0-1.956.925-1.956 1.874v2.25h3.328l-.532 3.47h-2.796v8.385C19.612 23.027 24 18.062 24 12.073z"})}),"Continue with Facebook"]})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Already have an account?"," ",n.jsx("button",{onClick:oe,className:"text-green-600 hover:text-green-700 font-medium hover:underline",disabled:P,children:"Sign in here"})]})})]})]})})},xue=()=>{const e=Xr(),{forgotPassword:s}=mi(),[l,d]=z.useState(""),[m,_]=z.useState(!1),[w,o]=z.useState(""),[E,P]=z.useState(!1),M=async $=>{if($.preventDefault(),o(""),!l){o("Please enter your email address");return}if(!l.includes("@")){o("Please enter a valid email address");return}_(!0);try{const Y=await s(l);Y.success?P(!0):o(Y.error||"Failed to send password reset email")}catch{o("An unexpected error occurred. Please try again.")}finally{_(!1)}},L=()=>{e("/auth/signin")},F=()=>{P(!1),d(""),o("")};return E?n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4",children:n.jsx(ot,{className:"w-full max-w-md text-center",children:n.jsxs(at,{className:"pt-6",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(dr,{className:"w-8 h-8 text-green-600"})}),n.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Check Your Email"}),n.jsxs("p",{className:"text-green-600 mb-4",children:["We've sent a password reset link to ",n.jsx("strong",{children:l})]}),n.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4 mb-6",children:[n.jsx("h3",{className:"font-semibold text-green-800 mb-2",children:"What happens next?"}),n.jsxs("ul",{className:"text-sm text-green-700 space-y-1 text-left",children:[n.jsx("li",{children:" Check your email inbox (and spam folder)"}),n.jsx("li",{children:" Click the password reset link in the email"}),n.jsx("li",{children:" The link expires in 30 seconds for security"}),n.jsx("li",{children:" Create a new password on the reset page"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsx(dt,{onClick:F,variant:"outline",className:"w-full border-green-200 text-green-700 hover:bg-green-50",children:"Send to Different Email"}),n.jsx(dt,{onClick:L,className:"w-full bg-green-600 hover:bg-green-700 text-white",children:"Back to Sign In"})]})]})})}):n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(il,{className:"w-8 h-8 text-blue-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Forgot Password?"}),n.jsx(Zs,{className:"text-gray-600",children:"Enter your email address and we'll send you a link to reset your password"})]}),n.jsxs(at,{children:[w&&n.jsxs(nd,{className:"mb-4 border-red-200 bg-red-50",children:[n.jsx(rl,{className:"h-4 w-4 text-red-600"}),n.jsx(rd,{className:"text-red-800",children:w})]}),n.jsxs("form",{onSubmit:M,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"email",className:"text-sm font-medium text-gray-700",children:"Email Address"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"email",type:"email",value:l,onChange:$=>d($.target.value),placeholder:"Enter your email address",className:"pl-10",required:!0,disabled:m}),n.jsx(il,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 w-4 h-4 text-gray-400"})]})]}),n.jsx(dt,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:m,size:"lg",children:m?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Sending Reset Link..."]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(K2,{className:"w-4 h-4"}),"Send Reset Link"]})})]}),n.jsxs("div",{className:"mt-6 p-4 bg-blue-50 border border-blue-200 rounded-lg",children:[n.jsx("h3",{className:"font-semibold text-blue-800 mb-2 text-sm",children:" Security Features"}),n.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[n.jsx("li",{children:" Reset links expire in 30 seconds"}),n.jsx("li",{children:" Links are tied to your specific account"}),n.jsx("li",{children:" Only sent to verified email addresses"}),n.jsx("li",{children:" Secure token-based verification"})]})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("button",{onClick:L,className:"inline-flex items-center gap-2 text-blue-600 hover:text-blue-700 font-medium hover:underline",disabled:m,children:[n.jsx(Cf,{className:"w-4 h-4"}),"Back to Sign In"]})}),n.jsx("div",{className:"mt-4 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Don't have an account?"," ",n.jsx("button",{onClick:()=>e("/auth/register"),className:"text-blue-600 hover:text-blue-700 font-medium hover:underline",disabled:m,children:"Sign up here"})]})})]})]})})},yue=()=>{const e=Xr(),s=cc(),{toast:l}=Bi(),{verifyEmail:d,resendVerification:m}=mi(),[_,w]=z.useState(""),[o,E]=z.useState(""),[P,M]=z.useState(!1),[L,F]=z.useState(!1),[$,Y]=z.useState(0),[H,X]=z.useState("");z.useEffect(()=>{var Le;const ae=(Le=s.state)==null?void 0:Le.email,Ne=localStorage.getItem("pendingVerificationEmail");if(ae)E(ae),localStorage.setItem("pendingVerificationEmail",ae);else if(Ne)E(Ne);else{e("/auth/register");return}Y(60);const Pe=setInterval(()=>{Y(ct=>ct<=1?(clearInterval(Pe),0):ct-1)},1e3);return()=>clearInterval(Pe)},[s.state,e]);const Z=ae=>{const Ne=ae.target.value.replace(/\D/g,"").slice(0,6);w(Ne),X("")},W=async ae=>{if(ae.preventDefault(),_.length!==6){X("Please enter a 6-digit verification code"),l({title:"Invalid Code",description:"Please enter a 6-digit verification code",variant:"destructive"});return}M(!0),X("");try{const Ne=await d(o,_);Ne.success?(l({title:"Email Verified!",description:"Your email has been verified successfully. Redirecting to sign in...",variant:"default"}),localStorage.removeItem("pendingVerificationEmail"),setTimeout(()=>{e("/auth/signin")},2e3)):(X(Ne.error||"Verification failed"),l({title:"Verification Failed",description:Ne.error||"Failed to verify your email. Please try again.",variant:"destructive"}))}catch{X("An unexpected error occurred"),l({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{M(!1)}},q=async()=>{if(!($>0)){F(!0),X("");try{const ae=await m(o);if(ae.success){l({title:"Code Sent!",description:"A new verification code has been sent to your email.",variant:"default"}),Y(60);const Ne=setInterval(()=>{Y(Pe=>Pe<=1?(clearInterval(Ne),0):Pe-1)},1e3)}else X(ae.error||"Failed to resend code"),l({title:"Resend Failed",description:ae.error||"Failed to resend verification code. Please try again.",variant:"destructive"})}catch{X("An unexpected error occurred"),l({title:"Error",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{F(!1)}}},oe=()=>{localStorage.removeItem("pendingVerificationEmail"),e("/auth/register")};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 via-indigo-50 to-purple-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md",children:[n.jsxs(Ut,{className:"text-center space-y-4",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center",children:n.jsx(il,{className:"w-8 h-8 text-blue-600"})}),n.jsxs("div",{children:[n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Verify Your Email"}),n.jsx(Zs,{className:"text-gray-600 mt-2",children:"We've sent a 6-digit verification code to"}),n.jsx("p",{className:"text-sm font-medium text-blue-600 mt-1",children:o})]})]}),n.jsxs(at,{className:"space-y-6",children:[H&&n.jsxs(nd,{variant:"destructive",children:[n.jsx(rl,{className:"h-4 w-4"}),n.jsx(rd,{children:H})]}),n.jsxs("form",{onSubmit:W,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"verificationCode",children:"Verification Code"}),n.jsx(Es,{id:"verificationCode",type:"text",placeholder:"Enter 6-digit code",value:_,onChange:Z,className:"text-center text-lg tracking-widest font-mono",maxLength:6,required:!0}),n.jsx("p",{className:"text-xs text-gray-500 text-center",children:"Enter the 6-digit code sent to your email"})]}),n.jsx(dt,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700",disabled:P||_.length!==6,children:P?n.jsxs(n.Fragment,{children:[n.jsx(Wu,{className:"mr-2 h-4 w-4 animate-spin"}),"Verifying..."]}):n.jsxs(n.Fragment,{children:[n.jsx(dr,{className:"mr-2 h-4 w-4"}),"Verify Email"]})})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-gray-600 mb-2",children:"Didn't receive the code?"}),n.jsx(dt,{variant:"outline",onClick:q,disabled:$>0||L,className:"w-full",children:L?n.jsxs(n.Fragment,{children:[n.jsx(Wu,{className:"mr-2 h-4 w-4 animate-spin"}),"Sending..."]}):$>0?n.jsxs(n.Fragment,{children:[n.jsx(oQ,{className:"mr-2 h-4 w-4"}),"Resend in ",$,"s"]}):n.jsxs(n.Fragment,{children:[n.jsx(Wu,{className:"mr-2 h-4 w-4"}),"Resend Code"]})})]}),n.jsx("div",{className:"text-center",children:n.jsxs(dt,{variant:"ghost",onClick:oe,className:"text-gray-600 hover:text-gray-800",children:[n.jsx(Cf,{className:"mr-2 h-4 w-4"}),"Back to Register"]})})]}),n.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[n.jsx("h4",{className:"text-sm font-medium text-blue-800 mb-2",children:" Check Your Email"}),n.jsxs("ul",{className:"text-xs text-blue-700 space-y-1",children:[n.jsx("li",{children:" Look for an email from KejaYangu"}),n.jsx("li",{children:" Check your spam folder if you don't see it"}),n.jsx("li",{children:" The code expires in 10 minutes"})]})]})]})]})})},_ue=()=>{const e=Xr(),[s]=k2(),[l,d]=z.useState(5),[m,_]=z.useState(!0),[w,o]=z.useState("verifying");z.useEffect(()=>{const M=s.get("token");if(!M){o("error"),_(!1);return}(async()=>{try{const F=await fetch("http://localhost:5000/api/v1/auth/verify-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({token:M})}),$=await F.json();if(F.ok&&$.status==="success"){o("success"),_(!1);const Y=setInterval(()=>{d(H=>H<=1?(clearInterval(Y),e("/auth/signin"),0):H-1)},1e3);return()=>clearInterval(Y)}else o("error"),_(!1)}catch(F){console.error("Email verification error:",F),o("error"),_(!1)}})()},[s,e]);const E=()=>{e("/auth/signin")},P=()=>{e("/auth/register")};return m?n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-lg",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(il,{className:"w-8 h-8 text-blue-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Verifying Your Email"}),n.jsx(Zs,{className:"text-gray-600",children:"Please wait while we verify your email address..."})]}),n.jsx(at,{className:"text-center",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600 mx-auto"})})]})}):w==="error"?n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-rose-50 to-pink-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-lg",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-red-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(il,{className:"w-8 h-8 text-red-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Verification Failed"}),n.jsx(Zs,{className:"text-gray-600",children:"We couldn't verify your email address. The link may be invalid or expired."})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"text-center space-y-4",children:[n.jsx("p",{className:"text-sm text-gray-600",children:"Please try registering again or contact support if the problem persists."}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:[n.jsx(dt,{onClick:P,variant:"outline",children:"Try Again"}),n.jsx(dt,{onClick:E,variant:"default",children:"Sign In"})]})]})})]})}):n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 via-emerald-50 to-teal-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-lg",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(dr,{className:"w-8 h-8 text-green-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Email Verified Successfully!"}),n.jsx(Zs,{className:"text-gray-600",children:"Your email address has been verified. You can now sign in to your account."})]}),n.jsx(at,{className:"space-y-6",children:n.jsxs("div",{className:"text-center space-y-4",children:[n.jsx("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:n.jsx("p",{className:"text-sm text-green-800",children:" Welcome to KejaYangu! Your account is now active and ready to use."})}),n.jsx("div",{className:"text-sm text-gray-600",children:n.jsxs("p",{children:["Redirecting to sign in page in"," ",n.jsx("span",{className:"font-semibold text-blue-600",children:l})," ","seconds..."]})}),n.jsx("div",{className:"flex flex-col sm:flex-row gap-3 justify-center",children:n.jsxs(dt,{onClick:E,className:"bg-green-600 hover:bg-green-700",children:["Sign In Now",n.jsx(Dg,{className:"ml-2 h-4 w-4"})]})})]})})]})})},vue=()=>{const e=Xr(),[s]=k2(),{resetPassword:l}=mi(),[d,m]=z.useState({password:"",confirmPassword:""}),[_,w]=z.useState(!1),[o,E]=z.useState(!1),[P,M]=z.useState(!1),[L,F]=z.useState(""),[$,Y]=z.useState(!1),[H,X]=z.useState({score:0,feedback:[]}),Z=s.get("token");z.useEffect(()=>{if(!Z){F("Invalid or missing reset token. Please request a new password reset link.");return}},[Z]);const W=ae=>{const Ne=[];let Pe=0;ae.length>=8?(Pe+=1,Ne.push("At least 8 characters")):Ne.push("Need at least 8 characters"),/[a-z]/.test(ae)?(Pe+=1,Ne.push("Contains lowercase letter")):Ne.push("Need lowercase letter"),/[A-Z]/.test(ae)?(Pe+=1,Ne.push("Contains uppercase letter")):Ne.push("Need uppercase letter"),/[0-9]/.test(ae)?(Pe+=1,Ne.push("Contains number")):Ne.push("Need number"),/[^A-Za-z0-9]/.test(ae)?(Pe+=1,Ne.push("Contains special character")):Ne.push("Need special character"),X({score:Pe,feedback:Ne})},q=ae=>{const{name:Ne,value:Pe}=ae.target;m(Le=>({...Le,[Ne]:Pe})),Ne==="password"&&W(Pe)},oe=async ae=>{if(ae.preventDefault(),F(""),!d.password){F("Password is required");return}if(d.password!==d.confirmPassword){F("Passwords do not match");return}if(H.score<3){F("Password is too weak. Please choose a stronger password.");return}if(!Z){F("Invalid reset token");return}M(!0);try{const Ne=await l(Z,d.password);Ne.success?(Y(!0),setTimeout(()=>{e("/auth/signin",{state:{message:"Password reset successful! Please sign in with your new password."}})},3e3)):F(Ne.error||"Password reset failed")}catch{F("An unexpected error occurred. Please try again.")}finally{M(!1)}};return $?n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-emerald-100 flex items-center justify-center p-4",children:n.jsx(ot,{className:"w-full max-w-md text-center",children:n.jsxs(at,{className:"pt-6",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-green-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(dr,{className:"w-8 h-8 text-green-600"})}),n.jsx("h2",{className:"text-2xl font-bold text-green-800 mb-2",children:"Password Reset Successful!"}),n.jsx("p",{className:"text-green-600 mb-4",children:"Your password has been successfully reset. You will be redirected to the login page shortly."}),n.jsx("div",{className:"animate-pulse",children:n.jsx("div",{className:"w-4 h-4 bg-green-400 rounded-full mx-auto"})})]})})}):n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto w-16 h-16 bg-blue-100 rounded-full flex items-center justify-center mb-4",children:n.jsx(ac,{className:"w-8 h-8 text-blue-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"Reset Your Password"}),n.jsx(Zs,{className:"text-gray-600",children:"Enter your new password below to complete the reset process"})]}),n.jsxs(at,{children:[L&&n.jsxs(nd,{className:"mb-4 border-red-200 bg-red-50",children:[n.jsx(rl,{className:"h-4 w-4 text-red-600"}),n.jsx(rd,{className:"text-red-800",children:L})]}),n.jsxs("form",{onSubmit:oe,className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"password",className:"text-sm font-medium text-gray-700",children:"New Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"password",name:"password",type:_?"text":"password",value:d.password,onChange:q,placeholder:"Enter your new password",className:"pr-10",required:!0}),n.jsx("button",{type:"button",onClick:()=>w(!_),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:_?n.jsx(Hu,{className:"w-4 h-4"}):n.jsx(pi,{className:"w-4 h-4"})})]}),d.password&&n.jsxs("div",{className:"mt-2",children:[n.jsx("div",{className:"flex gap-1 mb-2",children:[1,2,3,4,5].map(ae=>n.jsx("div",{className:`h-2 flex-1 rounded-full transition-colors ${ae<=H.score?ae<=2?"bg-red-400":ae<=3?"bg-yellow-400":"bg-green-400":"bg-gray-200"}`},ae))}),n.jsxs("div",{className:"text-xs text-gray-600",children:[H.score<3&&"Password is weak",H.score===3&&"Password is moderate",H.score>3&&"Password is strong"]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"confirmPassword",className:"text-sm font-medium text-gray-700",children:"Confirm New Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"confirmPassword",name:"confirmPassword",type:o?"text":"password",value:d.confirmPassword,onChange:q,placeholder:"Confirm your new password",className:"pr-10",required:!0}),n.jsx("button",{type:"button",onClick:()=>E(!o),className:"absolute right-3 top-1/2 transform -translate-y-1/2 text-gray-400 hover:text-gray-600",children:o?n.jsx(Hu,{className:"w-4 h-4"}):n.jsx(pi,{className:"w-4 h-4"})})]}),d.confirmPassword&&n.jsx("div",{className:"text-xs",children:d.password===d.confirmPassword?n.jsxs("span",{className:"text-green-600 flex items-center gap-1",children:[n.jsx(dr,{className:"w-3 h-3"}),"Passwords match"]}):n.jsxs("span",{className:"text-red-600 flex items-center gap-1",children:[n.jsx(rl,{className:"w-3 h-3"}),"Passwords do not match"]})})]}),n.jsx(dt,{type:"submit",className:"w-full bg-blue-600 hover:bg-blue-700 text-white",disabled:P||!Z,children:P?n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx("div",{className:"w-4 h-4 border-2 border-white border-t-transparent rounded-full animate-spin"}),"Resetting Password..."]}):n.jsxs("div",{className:"flex items-center gap-2",children:[n.jsx(R0,{className:"w-4 h-4"}),"Reset Password"]})})]}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs("p",{className:"text-sm text-gray-600",children:["Remember your password?"," ",n.jsx("button",{onClick:()=>e("/auth/signin"),className:"text-blue-600 hover:text-blue-700 font-medium",children:"Sign in here"})]})})]})]})})},bue=()=>{const e=Xr(),[s,l]=z.useState(!1);return z.useEffect(()=>{const d=setTimeout(()=>l(!0),100);return()=>clearTimeout(d)},[]),n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-red-50 via-orange-50 to-yellow-50 flex items-center justify-center p-4",children:n.jsxs("div",{className:"w-full max-w-2xl",children:[n.jsxs(ot,{className:`transform transition-all duration-1000 ${s?"translate-y-0 opacity-100":"translate-y-8 opacity-0"}`,children:[n.jsxs(Ut,{className:"text-center pb-8",children:[n.jsx("div",{className:`mx-auto w-24 h-24 bg-red-100 rounded-full flex items-center justify-center mb-6 transition-all duration-700 ${s?"scale-100 rotate-0":"scale-0 rotate-180"}`,children:n.jsx(k0,{className:"w-12 h-12 text-red-600"})}),n.jsx($t,{className:`text-3xl font-bold text-red-800 mb-3 transition-all duration-700 delay-200 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:"User Not Found"}),n.jsx(Zs,{className:`text-lg text-red-600 transition-all duration-700 delay-400 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:"We couldn't verify your identity with the provided information"})]}),n.jsxs(at,{className:"space-y-6",children:[n.jsx("div",{className:`bg-red-50 border border-red-200 rounded-lg p-4 transition-all duration-700 delay-500 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(ed,{className:"w-5 h-5 text-red-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-red-800 mb-2",children:"What happened?"}),n.jsxs("ul",{className:"text-sm text-red-700 space-y-1",children:[n.jsx("li",{children:" The verification link may have expired"}),n.jsx("li",{children:" The user account might not exist"}),n.jsx("li",{children:" The verification token could be invalid"}),n.jsx("li",{children:" The account may have been deleted"})]})]})]})}),n.jsx("div",{className:`bg-blue-50 border border-blue-200 rounded-lg p-4 transition-all duration-700 delay-600 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:n.jsxs("div",{className:"flex items-start gap-3",children:[n.jsx(ac,{className:"w-5 h-5 text-blue-600 mt-0.5 flex-shrink-0"}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold text-blue-800 mb-2",children:"Security Notice"}),n.jsx("p",{className:"text-sm text-blue-700",children:"This is a security feature to protect your account. If you believe this is an error, please contact our support team."})]})]})}),n.jsxs("div",{className:`flex flex-col sm:flex-row gap-3 transition-all duration-700 delay-700 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:[n.jsxs(dt,{onClick:()=>e("/auth/register"),className:"flex-1 bg-blue-600 hover:bg-blue-700 text-white group",size:"lg",children:[n.jsx(t2,{className:"w-4 h-4 mr-2 group-hover:scale-110 transition-transform"}),"Create New Account",n.jsx(Dg,{className:"w-4 h-4 ml-2 group-hover:translate-x-1 transition-transform"})]}),n.jsxs(dt,{onClick:()=>e("/"),variant:"outline",className:"flex-1 border-blue-200 text-blue-700 hover:bg-blue-50 group",size:"lg",children:[n.jsx(bo,{className:"w-4 h-4 mr-2 group-hover:scale-110 transition-transform"}),"Go to Homepage"]})]}),n.jsxs("div",{className:`text-center pt-4 transition-all duration-700 delay-800 ${s?"translate-y-0 opacity-100":"translate-y-4 opacity-0"}`,children:[n.jsx("p",{className:"text-sm text-gray-600 mb-3",children:"Need help? Here are some options:"}),n.jsxs("div",{className:"flex flex-wrap justify-center gap-4 text-xs",children:[n.jsxs("button",{onClick:()=>e("/auth/forgot-password"),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:[n.jsx(il,{className:"w-3 h-3"}),"Forgot Password"]}),n.jsxs("button",{onClick:()=>e("/auth/signin"),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:[n.jsx(t2,{className:"w-3 h-3"}),"Sign In"]}),n.jsxs("button",{onClick:()=>e("/"),className:"flex items-center gap-1 text-blue-600 hover:text-blue-700 hover:underline transition-colors",children:[n.jsx(bo,{className:"w-3 h-3"}),"Homepage"]})]})]})]})]}),n.jsxs("div",{className:`fixed inset-0 pointer-events-none transition-all duration-1000 delay-1000 ${s?"opacity-100":"opacity-0"}`,children:[n.jsx("div",{className:"absolute top-20 left-10 animate-bounce",children:n.jsx("div",{className:"w-8 h-8 bg-red-200 rounded-full flex items-center justify-center",children:n.jsx(k0,{className:"w-4 h-4 text-red-600"})})}),n.jsx("div",{className:"absolute top-40 right-20 animate-bounce",style:{animationDelay:"0.5s"},children:n.jsx("div",{className:"w-6 h-6 bg-orange-200 rounded-full flex items-center justify-center",children:n.jsx(ed,{className:"w-3 h-3 text-orange-600"})})}),n.jsx("div",{className:"absolute bottom-40 left-20 animate-bounce",style:{animationDelay:"1s"},children:n.jsx("div",{className:"w-7 h-7 bg-yellow-200 rounded-full flex items-center justify-center",children:n.jsx(Ko,{className:"w-3 h-3 text-yellow-600"})})}),n.jsx("div",{className:"absolute bottom-20 right-10 animate-bounce",style:{animationDelay:"1.5s"},children:n.jsx("div",{className:"w-5 h-5 bg-blue-200 rounded-full flex items-center justify-center",children:n.jsx(ac,{className:"w-2 h-2 text-blue-600"})})})]})]})})},wue=()=>{var X,Z;const e=Xr(),{user:s,isAuthenticated:l,updateProfile:d,isLoading:m}=mi(),{toast:_}=Bi(),[w,o]=z.useState(!1),[E,P]=z.useState(!1),[M,L]=z.useState({firstName:"",lastName:"",email:"",phone:"",dateOfBirth:"",gender:"",nationality:"",bio:""});z.useEffect(()=>{if(!l){e("/auth/signin");return}s&&L({firstName:s.firstName||"",lastName:s.lastName||"",email:s.email||"",phone:s.phone||"",dateOfBirth:s.dateOfBirth?new Date(s.dateOfBirth).toISOString().split("T")[0]:"",gender:s.gender||"",nationality:s.nationality||"",bio:s.bio||""})},[s,l,e]);const F=W=>{const{name:q,value:oe}=W.target;L(ae=>({...ae,[q]:oe}))},$=(W,q)=>{L(oe=>({...oe,[W]:q}))},Y=async()=>{P(!0);try{const W=await d(M);W.success?(_({title:"Profile updated successfully",description:"Your profile has been updated.",variant:"default"}),o(!1)):_({title:"Update failed",description:W.error||"Failed to update profile. Please try again.",variant:"destructive"})}catch{_({title:"Update failed",description:"An unexpected error occurred. Please try again.",variant:"destructive"})}finally{P(!1)}},H=()=>{L({firstName:(s==null?void 0:s.firstName)||"",lastName:(s==null?void 0:s.lastName)||"",email:(s==null?void 0:s.email)||"",phone:(s==null?void 0:s.phone)||"",dateOfBirth:s!=null&&s.dateOfBirth?new Date(s.dateOfBirth).toISOString().split("T")[0]:"",gender:(s==null?void 0:s.gender)||"",nationality:(s==null?void 0:s.nationality)||"",bio:(s==null?void 0:s.bio)||""}),o(!1)};return m?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("div",{className:"container mx-auto px-4 py-8",children:n.jsxs("div",{className:"animate-pulse",children:[n.jsx("div",{className:"h-8 bg-muted rounded w-1/4 mb-8"}),n.jsxs("div",{className:"space-y-6",children:[n.jsx("div",{className:"h-64 bg-muted rounded"}),n.jsx("div",{className:"h-32 bg-muted rounded"})]})]})}),n.jsx(Oi,{})]}):s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Profile"}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Manage your personal information and preferences"})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs(ot,{className:"sticky top-24",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsxs("div",{className:"relative mx-auto mb-4",children:[n.jsxs(al,{className:"w-24 h-24 mx-auto",children:[n.jsx(Il,{src:s.avatar,alt:`${s.firstName} ${s.lastName}`}),n.jsxs(ll,{className:"text-2xl font-semibold bg-primary text-primary-foreground",children:[(X=s.firstName)==null?void 0:X.charAt(0),(Z=s.lastName)==null?void 0:Z.charAt(0)]})]}),n.jsx(dt,{size:"icon",variant:"secondary",className:"absolute -bottom-2 -right-2 h-8 w-8 rounded-full",disabled:!w,children:n.jsx(kJ,{className:"h-4 w-4"})})]}),n.jsxs($t,{className:"text-xl",children:[s.firstName," ",s.lastName]}),n.jsx(Zs,{children:s.email}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 mt-2",children:[n.jsx(ls,{variant:s.isVerified?"default":"secondary",children:s.isVerified?n.jsxs(n.Fragment,{children:[n.jsx(dr,{className:"h-3 w-3 mr-1"}),"Verified"]}):n.jsxs(n.Fragment,{children:[n.jsx(rl,{className:"h-3 w-3 mr-1"}),"Unverified"]})}),n.jsx(ls,{variant:"outline",children:s.role})]})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[n.jsx(Uh,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{children:s.phone||"No phone number"})]}),n.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[n.jsx(bx,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{children:s.dateOfBirth?new Date(s.dateOfBirth).toLocaleDateString():"No date of birth"})]}),s.gender&&n.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[n.jsx(lu,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{className:"capitalize",children:s.gender})]}),s.nationality&&n.jsxs("div",{className:"flex items-center space-x-2 text-sm",children:[n.jsx(Ai,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{children:s.nationality})]})]})})]})}),n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx($t,{children:"Personal Information"}),n.jsx(Zs,{children:"Update your personal details and preferences"})]}),n.jsx("div",{className:"flex space-x-2",children:w?n.jsxs(n.Fragment,{children:[n.jsxs(dt,{variant:"outline",onClick:H,disabled:E,children:[n.jsx(ol,{className:"h-4 w-4 mr-2"}),"Cancel"]}),n.jsx(dt,{onClick:Y,disabled:E,children:E?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(GA,{className:"h-4 w-4 mr-2"}),"Save Changes"]})})]}):n.jsxs(dt,{onClick:()=>o(!0),children:[n.jsx(JJ,{className:"h-4 w-4 mr-2"}),"Edit Profile"]})})]})}),n.jsx(at,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"firstName",children:"First Name"}),n.jsx(Es,{id:"firstName",name:"firstName",value:M.firstName,onChange:F,disabled:!w,placeholder:"Enter your first name"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"lastName",children:"Last Name"}),n.jsx(Es,{id:"lastName",name:"lastName",value:M.lastName,onChange:F,disabled:!w,placeholder:"Enter your last name"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"email",children:"Email"}),n.jsx(Es,{id:"email",name:"email",type:"email",value:M.email,onChange:F,disabled:!w,placeholder:"Enter your email"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"phone",children:"Phone Number"}),n.jsx(Es,{id:"phone",name:"phone",value:M.phone,onChange:F,disabled:!w,placeholder:"+254 700 123 456"})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"dateOfBirth",children:"Date of Birth"}),n.jsx(Es,{id:"dateOfBirth",name:"dateOfBirth",type:"date",value:M.dateOfBirth,onChange:F,disabled:!w})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"gender",children:"Gender"}),n.jsxs(qn,{value:M.gender,onValueChange:W=>$("gender",W),disabled:!w,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Select gender"})}),n.jsxs($n,{children:[n.jsx(it,{value:"male",children:"Male"}),n.jsx(it,{value:"female",children:"Female"}),n.jsx(it,{value:"other",children:"Other"}),n.jsx(it,{value:"prefer-not-to-say",children:"Prefer not to say"})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"nationality",children:"Nationality"}),n.jsx(Es,{id:"nationality",name:"nationality",value:M.nationality,onChange:F,disabled:!w,placeholder:"Enter your nationality"})]}),n.jsxs("div",{className:"md:col-span-2 space-y-2",children:[n.jsx(ds,{htmlFor:"bio",children:"Bio"}),n.jsx(Af,{id:"bio",name:"bio",value:M.bio,onChange:F,disabled:!w,placeholder:"Tell us about yourself...",rows:4})]})]})})]})})]})]})}),n.jsx(Oi,{})]}):null};var SS="Switch",[Sue,Kde]=Xo(SS),[jue,Tue]=Sue(SS),o$=z.forwardRef((e,s)=>{const{__scopeSwitch:l,name:d,checked:m,defaultChecked:_,required:w,disabled:o,value:E="on",onCheckedChange:P,form:M,...L}=e,[F,$]=z.useState(null),Y=Gn(s,q=>$(q)),H=z.useRef(!1),X=F?M||!!F.closest("form"):!0,[Z,W]=Qu({prop:m,defaultProp:_??!1,onChange:P,caller:SS});return n.jsxs(jue,{scope:l,checked:Z,disabled:o,children:[n.jsx(Ys.button,{type:"button",role:"switch","aria-checked":Z,"aria-required":w,"data-state":u$(Z),"data-disabled":o?"":void 0,disabled:o,value:E,...L,ref:Y,onClick:bs(e.onClick,q=>{W(oe=>!oe),X&&(H.current=q.isPropagationStopped(),H.current||q.stopPropagation())})}),X&&n.jsx(c$,{control:F,bubbles:!H.current,name:d,value:E,checked:Z,required:w,disabled:o,form:M,style:{transform:"translateX(-100%)"}})]})});o$.displayName=SS;var a$="SwitchThumb",l$=z.forwardRef((e,s)=>{const{__scopeSwitch:l,...d}=e,m=Tue(a$,l);return n.jsx(Ys.span,{"data-state":u$(m.checked),"data-disabled":m.disabled?"":void 0,...d,ref:s})});l$.displayName=a$;var Nue="SwitchBubbleInput",c$=z.forwardRef(({__scopeSwitch:e,control:s,checked:l,bubbles:d=!0,...m},_)=>{const w=z.useRef(null),o=Gn(w,_),E=aP(l),P=IA(s);return z.useEffect(()=>{const M=w.current;if(!M)return;const L=window.HTMLInputElement.prototype,$=Object.getOwnPropertyDescriptor(L,"checked").set;if(E!==l&&$){const Y=new Event("click",{bubbles:d});$.call(M,l),M.dispatchEvent(Y)}},[E,l,d]),n.jsx("input",{type:"checkbox","aria-hidden":!0,defaultChecked:l,...m,tabIndex:-1,ref:o,style:{...m.style,...P,position:"absolute",pointerEvents:"none",opacity:0,margin:0}})});c$.displayName=Nue;function u$(e){return e?"checked":"unchecked"}var d$=o$,Eue=l$;const Bu=z.forwardRef(({className:e,...s},l)=>n.jsx(d$,{className:Ds("peer inline-flex h-6 w-11 shrink-0 cursor-pointer items-center rounded-full border-2 border-transparent transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 focus-visible:ring-offset-background disabled:cursor-not-allowed disabled:opacity-50 data-[state=checked]:bg-primary data-[state=unchecked]:bg-input",e),...s,ref:l,children:n.jsx(Eue,{className:Ds("pointer-events-none block h-5 w-5 rounded-full bg-background shadow-lg ring-0 transition-transform data-[state=checked]:translate-x-5 data-[state=unchecked]:translate-x-0")})}));Bu.displayName=d$.displayName;var Cue="Separator",O4="horizontal",Aue=["horizontal","vertical"],h$=z.forwardRef((e,s)=>{const{decorative:l,orientation:d=O4,...m}=e,_=Pue(d)?d:O4,o=l?{role:"none"}:{"aria-orientation":_==="vertical"?_:void 0,role:"separator"};return n.jsx(Ys.div,{"data-orientation":_,...o,...m,ref:s})});h$.displayName=Cue;function Pue(e){return Aue.includes(e)}var p$=h$;const $u=z.forwardRef(({className:e,orientation:s="horizontal",decorative:l=!0,...d},m)=>n.jsx(p$,{ref:m,decorative:l,orientation:s,className:Ds("shrink-0 bg-border",s==="horizontal"?"h-[1px] w-full":"h-full w-[1px]",e),...d}));$u.displayName=p$.displayName;var f$="AlertDialog",[Iue,Xde]=Xo(f$,[PB]),od=PB(),m$=e=>{const{__scopeAlertDialog:s,...l}=e,d=od(s);return n.jsx(WB,{...d,...l,modal:!0})};m$.displayName=f$;var Mue="AlertDialogTrigger",g$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,m=od(l);return n.jsx(qB,{...m,...d,ref:s})});g$.displayName=Mue;var Rue="AlertDialogPortal",x$=e=>{const{__scopeAlertDialog:s,...l}=e,d=od(s);return n.jsx(ZB,{...d,...l})};x$.displayName=Rue;var kue="AlertDialogOverlay",y$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,m=od(l);return n.jsx(sP,{...m,...d,ref:s})});y$.displayName=kue;var Og="AlertDialogContent",[Due,Lue]=Iue(Og),zue=NF("AlertDialogContent"),_$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,children:d,...m}=e,_=od(l),w=z.useRef(null),o=Gn(s,w),E=z.useRef(null);return n.jsx(Tse,{contentName:Og,titleName:v$,docsSlug:"alert-dialog",children:n.jsx(Due,{scope:l,cancelRef:E,children:n.jsxs(nP,{role:"alertdialog",..._,...m,ref:o,onOpenAutoFocus:bs(m.onOpenAutoFocus,P=>{var M;P.preventDefault(),(M=E.current)==null||M.focus({preventScroll:!0})}),onPointerDownOutside:P=>P.preventDefault(),onInteractOutside:P=>P.preventDefault(),children:[n.jsx(zue,{children:d}),n.jsx(Fue,{contentRef:w})]})})})});_$.displayName=Og;var v$="AlertDialogTitle",b$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,m=od(l);return n.jsx(rP,{...m,...d,ref:s})});b$.displayName=v$;var w$="AlertDialogDescription",S$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,m=od(l);return n.jsx(iP,{...m,...d,ref:s})});S$.displayName=w$;var Oue="AlertDialogAction",j$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,m=od(l);return n.jsx(oP,{...m,...d,ref:s})});j$.displayName=Oue;var T$="AlertDialogCancel",N$=z.forwardRef((e,s)=>{const{__scopeAlertDialog:l,...d}=e,{cancelRef:m}=Lue(T$,l),_=od(l),w=Gn(s,m);return n.jsx(oP,{..._,...d,ref:w})});N$.displayName=T$;var Fue=({contentRef:e})=>{const s=`\`${Og}\` requires a description for the component to be accessible for screen reader users.

You can add a description to the \`${Og}\` by passing a \`${w$}\` component as a child, which also benefits sighted users by adding visible context to the dialog.

Alternatively, you can use your own component as a description by assigning it an \`id\` and passing the same value to the \`aria-describedby\` prop in \`${Og}\`. If the description is confusing or duplicative for sighted users, you can use the \`@radix-ui/react-visually-hidden\` primitive as a wrapper around your description component.

For more information, see https://radix-ui.com/primitives/docs/components/alert-dialog`;return z.useEffect(()=>{var d;document.getElementById((d=e.current)==null?void 0:d.getAttribute("aria-describedby"))||console.warn(s)},[s,e]),null},Bue=m$,Vue=g$,Uue=x$,E$=y$,C$=_$,A$=j$,P$=N$,I$=b$,M$=S$;const $ue=Bue,Gue=Vue,Hue=Uue,R$=z.forwardRef(({className:e,...s},l)=>n.jsx(E$,{className:Ds("fixed inset-0 z-50 bg-black/80  data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0",e),...s,ref:l}));R$.displayName=E$.displayName;const k$=z.forwardRef(({className:e,...s},l)=>n.jsxs(Hue,{children:[n.jsx(R$,{}),n.jsx(C$,{ref:l,className:Ds("fixed left-[50%] top-[50%] z-50 grid w-full max-w-lg translate-x-[-50%] translate-y-[-50%] gap-4 border bg-background p-6 shadow-lg duration-200 data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[state=closed]:slide-out-to-left-1/2 data-[state=closed]:slide-out-to-top-[48%] data-[state=open]:slide-in-from-left-1/2 data-[state=open]:slide-in-from-top-[48%] sm:rounded-lg",e),...s})]}));k$.displayName=C$.displayName;const D$=({className:e,...s})=>n.jsx("div",{className:Ds("flex flex-col space-y-2 text-center sm:text-left",e),...s});D$.displayName="AlertDialogHeader";const L$=({className:e,...s})=>n.jsx("div",{className:Ds("flex flex-col-reverse sm:flex-row sm:justify-end sm:space-x-2",e),...s});L$.displayName="AlertDialogFooter";const z$=z.forwardRef(({className:e,...s},l)=>n.jsx(I$,{ref:l,className:Ds("text-lg font-semibold",e),...s}));z$.displayName=I$.displayName;const O$=z.forwardRef(({className:e,...s},l)=>n.jsx(M$,{ref:l,className:Ds("text-sm text-muted-foreground",e),...s}));O$.displayName=M$.displayName;const F$=z.forwardRef(({className:e,...s},l)=>n.jsx(A$,{ref:l,className:Ds(WA(),e),...s}));F$.displayName=A$.displayName;const B$=z.forwardRef(({className:e,...s},l)=>n.jsx(P$,{ref:l,className:Ds(WA({variant:"outline"}),"mt-2 sm:mt-0",e),...s}));B$.displayName=P$.displayName;const Wue=()=>{const e=Xr(),{user:s,isAuthenticated:l,updateProfile:d,logout:m}=mi(),{toast:_}=Bi(),[w,o]=z.useState(!1),[E,P]=z.useState(!1),[M,L]=z.useState(!1),[F,$]=z.useState(!1),[Y,H]=z.useState({currentPassword:"",newPassword:"",confirmPassword:""}),[X,Z]=z.useState({emailNotifications:!0,smsNotifications:!0,pushNotifications:!0,marketingEmails:!1,propertyAlerts:!0,messageNotifications:!0}),[W,q]=z.useState(!1);z.useEffect(()=>{if(!l){e("/auth/signin");return}},[l,e]);const oe=async()=>{if(Y.newPassword!==Y.confirmPassword){_({title:"Passwords don't match",description:"Please make sure your new passwords match.",variant:"destructive"});return}if(Y.newPassword.length<8){_({title:"Password too short",description:"Password must be at least 8 characters long.",variant:"destructive"});return}o(!0);try{_({title:"Password updated successfully",description:"Your password has been changed.",variant:"default"}),H({currentPassword:"",newPassword:"",confirmPassword:""})}catch{_({title:"Password update failed",description:"Failed to update password. Please try again.",variant:"destructive"})}finally{o(!1)}},ae=async()=>{o(!0);try{_({title:"Preferences updated",description:"Your preferences have been saved.",variant:"default"})}catch{_({title:"Update failed",description:"Failed to update preferences. Please try again.",variant:"destructive"})}finally{o(!1)}},Ne=async()=>{q(!0);try{_({title:"Account deleted",description:"Your account has been permanently deleted.",variant:"default"}),await m(),e("/")}catch{_({title:"Deletion failed",description:"Failed to delete account. Please try again.",variant:"destructive"})}finally{q(!1)}};return s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Account & Settings"}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Manage your account settings, security, and preferences"})]}),n.jsxs(Ix,{defaultValue:"account",className:"space-y-6",children:[n.jsxs(Rf,{className:"grid w-full grid-cols-4",children:[n.jsxs(io,{value:"account",className:"flex items-center space-x-2",children:[n.jsx(lu,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Account"})]}),n.jsxs(io,{value:"security",className:"flex items-center space-x-2",children:[n.jsx(ac,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Security"})]}),n.jsxs(io,{value:"notifications",className:"flex items-center space-x-2",children:[n.jsx(au,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Notifications"})]}),n.jsxs(io,{value:"danger",className:"flex items-center space-x-2 text-red-600",children:[n.jsx(ed,{className:"h-4 w-4"}),n.jsx("span",{className:"hidden sm:inline",children:"Danger Zone"})]})]}),n.jsx(oo,{value:"account",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(lu,{className:"h-5 w-5"}),n.jsx("span",{children:"Account Information"})]}),n.jsx(Zs,{children:"Your basic account details and verification status"})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{children:"Email"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Es,{value:s.email,disabled:!0}),n.jsx(ls,{variant:s.isVerified?"default":"secondary",children:s.isVerified?"Verified":"Unverified"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{children:"Phone"}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(Es,{value:s.phone||"Not provided",disabled:!0}),n.jsx(ls,{variant:"outline",children:"Primary"})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{children:"Account Type"}),n.jsx(Es,{value:s.role,disabled:!0})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{children:"Member Since"}),n.jsx(Es,{value:s.createdAt?new Date(s.createdAt).toLocaleDateString():"Unknown",disabled:!0})]})]})})]})}),n.jsx(oo,{value:"security",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(R0,{className:"h-5 w-5"}),n.jsx("span",{children:"Change Password"})]}),n.jsx(Zs,{children:"Update your password to keep your account secure"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"currentPassword",children:"Current Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"currentPassword",type:E?"text":"password",value:Y.currentPassword,onChange:Pe=>H(Le=>({...Le,currentPassword:Pe.target.value})),placeholder:"Enter current password"}),n.jsx(dt,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>P(!E),children:E?n.jsx(Hu,{className:"h-4 w-4"}):n.jsx(pi,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"newPassword",children:"New Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"newPassword",type:M?"text":"password",value:Y.newPassword,onChange:Pe=>H(Le=>({...Le,newPassword:Pe.target.value})),placeholder:"Enter new password"}),n.jsx(dt,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>L(!M),children:M?n.jsx(Hu,{className:"h-4 w-4"}):n.jsx(pi,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"confirmPassword",children:"Confirm New Password"}),n.jsxs("div",{className:"relative",children:[n.jsx(Es,{id:"confirmPassword",type:F?"text":"password",value:Y.confirmPassword,onChange:Pe=>H(Le=>({...Le,confirmPassword:Pe.target.value})),placeholder:"Confirm new password"}),n.jsx(dt,{type:"button",variant:"ghost",size:"icon",className:"absolute right-0 top-0 h-full px-3 hover:bg-transparent",onClick:()=>$(!F),children:F?n.jsx(Hu,{className:"h-4 w-4"}):n.jsx(pi,{className:"h-4 w-4"})})]})]}),n.jsx(dt,{onClick:oe,disabled:w||!Y.currentPassword||!Y.newPassword||!Y.confirmPassword,className:"w-full",children:w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Updating..."]}):n.jsxs(n.Fragment,{children:[n.jsx(qJ,{className:"h-4 w-4 mr-2"}),"Update Password"]})})]})]})}),n.jsx(oo,{value:"notifications",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(au,{className:"h-5 w-5"}),n.jsx("span",{children:"Notification Preferences"})]}),n.jsx(Zs,{children:"Choose how and when you want to be notified"})]}),n.jsxs(at,{className:"space-y-6",children:[n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Email Notifications"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via email"})]}),n.jsx(Bu,{checked:X.emailNotifications,onCheckedChange:Pe=>Z(Le=>({...Le,emailNotifications:Pe}))})]}),n.jsx($u,{}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"SMS Notifications"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive notifications via SMS"})]}),n.jsx(Bu,{checked:X.smsNotifications,onCheckedChange:Pe=>Z(Le=>({...Le,smsNotifications:Pe}))})]}),n.jsx($u,{}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Push Notifications"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Receive push notifications in your browser"})]}),n.jsx(Bu,{checked:X.pushNotifications,onCheckedChange:Pe=>Z(Le=>({...Le,pushNotifications:Pe}))})]}),n.jsx($u,{}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Property Alerts"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new properties matching your criteria"})]}),n.jsx(Bu,{checked:X.propertyAlerts,onCheckedChange:Pe=>Z(Le=>({...Le,propertyAlerts:Pe}))})]}),n.jsx($u,{}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Message Notifications"}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Get notified about new messages from agents"})]}),n.jsx(Bu,{checked:X.messageNotifications,onCheckedChange:Pe=>Z(Le=>({...Le,messageNotifications:Pe}))})]})]}),n.jsx(dt,{onClick:ae,disabled:w,className:"w-full",children:w?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Saving..."]}):n.jsxs(n.Fragment,{children:[n.jsx(GA,{className:"h-4 w-4 mr-2"}),"Save Preferences"]})})]})]})}),n.jsx(oo,{value:"danger",className:"space-y-6",children:n.jsxs(ot,{className:"border-red-200",children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center space-x-2 text-red-600",children:[n.jsx(ed,{className:"h-5 w-5"}),n.jsx("span",{children:"Danger Zone"})]}),n.jsx(Zs,{children:"Irreversible and destructive actions"})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"p-4 bg-red-50 border border-red-200 rounded-lg",children:[n.jsx("h4",{className:"font-semibold text-red-800 mb-2",children:"Delete Account"}),n.jsx("p",{className:"text-sm text-red-700 mb-4",children:"Once you delete your account, there is no going back. Please be certain."}),n.jsxs($ue,{children:[n.jsx(Gue,{asChild:!0,children:n.jsxs(dt,{variant:"destructive",size:"sm",children:[n.jsx(ox,{className:"h-4 w-4 mr-2"}),"Delete Account"]})}),n.jsxs(k$,{children:[n.jsxs(D$,{children:[n.jsx(z$,{children:"Are you absolutely sure?"}),n.jsx(O$,{children:"This action cannot be undone. This will permanently delete your account and remove all your data from our servers."})]}),n.jsxs(L$,{children:[n.jsx(B$,{children:"Cancel"}),n.jsx(F$,{onClick:Ne,className:"bg-red-600 hover:bg-red-700",disabled:W,children:W?n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white mr-2"}),"Deleting..."]}):"Yes, delete my account"})]})]})]})]})})]})})]})]})}),n.jsx(Oi,{})]}):null},que=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi();Bi();const[d,m]=z.useState({propertiesViewed:0,propertiesSaved:0,inquiriesSent:0,messagesReceived:0}),[_,w]=z.useState([{id:1,type:"view",property:"Modern 3-Bedroom Apartment",location:"Westlands, Nairobi",price:"KES 25,000,000",date:"2 hours ago",image:"/api/placeholder/60/60"},{id:2,type:"save",property:"Luxury Villa with Pool",location:"Karen, Nairobi",price:"KES 45,000,000",date:"1 day ago",image:"/api/placeholder/60/60"},{id:3,type:"inquiry",property:"Studio Apartment",location:"Kilimani, Nairobi",price:"KES 8,500,000",date:"3 days ago",image:"/api/placeholder/60/60"}]),[o]=z.useState([{title:"Search Properties",description:"Find your dream home",icon:Li,action:()=>e("/buy"),color:"bg-blue-500"},{title:"View Favorites",description:"Check saved properties",icon:su,action:()=>e("/favorites"),color:"bg-red-500"},{title:"Messages",description:"Chat with agents",icon:tl,action:()=>e("/messages"),color:"bg-green-500"},{title:"Account Settings",description:"Manage your profile",icon:rx,action:()=>e("/account"),color:"bg-purple-500"}]);z.useEffect(()=>{if(!l){e("/auth/signin");return}},[l,e]);const E=M=>{switch(M){case"view":return n.jsx(pi,{className:"h-4 w-4 text-blue-500"});case"save":return n.jsx(su,{className:"h-4 w-4 text-red-500"});case"inquiry":return n.jsx(tl,{className:"h-4 w-4 text-green-500"});default:return n.jsx(pi,{className:"h-4 w-4 text-gray-500"})}},P=M=>{switch(M){case"view":return"bg-blue-100 text-blue-800";case"save":return"bg-red-100 text-red-800";case"inquiry":return"bg-green-100 text-green-800";default:return"bg-gray-100 text-gray-800"}};return s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("h1",{className:"text-4xl font-bold mb-2",children:["Welcome back, ",s.firstName,"! "]}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Here's what's happening with your account today"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.1},children:n.jsx(ot,{className:"hover:shadow-lg transition-shadow",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"p-3 bg-blue-100 rounded-lg",children:n.jsx(pi,{className:"h-6 w-6 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Properties Viewed"}),n.jsx("p",{className:"text-2xl font-bold",children:d.propertiesViewed})]})]})})})}),n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.2},children:n.jsx(ot,{className:"hover:shadow-lg transition-shadow",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"p-3 bg-red-100 rounded-lg",children:n.jsx(su,{className:"h-6 w-6 text-red-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Properties Saved"}),n.jsx("p",{className:"text-2xl font-bold",children:d.propertiesSaved})]})]})})})}),n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.3},children:n.jsx(ot,{className:"hover:shadow-lg transition-shadow",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"p-3 bg-green-100 rounded-lg",children:n.jsx(tl,{className:"h-6 w-6 text-green-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Inquiries Sent"}),n.jsx("p",{className:"text-2xl font-bold",children:d.inquiriesSent})]})]})})})}),n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.4},children:n.jsx(ot,{className:"hover:shadow-lg transition-shadow",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"p-3 bg-purple-100 rounded-lg",children:n.jsx(au,{className:"h-6 w-6 text-purple-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium text-muted-foreground",children:"Messages"}),n.jsx("p",{className:"text-2xl font-bold",children:d.messagesReceived})]})]})})})})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Quick Actions"}),n.jsx(Zs,{children:"Access frequently used features"})]}),n.jsx(at,{className:"space-y-3",children:o.map((M,L)=>n.jsx(ci.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},transition:{duration:.3,delay:.1*L},children:n.jsxs(dt,{variant:"ghost",className:"w-full justify-start h-auto p-3 hover:bg-accent",onClick:M.action,children:[n.jsx("div",{className:`p-2 rounded-lg mr-3 ${M.color}`,children:n.jsx(M.icon,{className:"h-4 w-4 text-white"})}),n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-medium",children:M.title}),n.jsx("div",{className:"text-sm text-muted-foreground",children:M.description})]}),n.jsx(Dg,{className:"h-4 w-4 ml-auto text-muted-foreground"})]})},M.title))})]})}),n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Activities"}),n.jsx(Zs,{children:"Your latest property interactions"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"space-y-4",children:_.map((M,L)=>n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.3,delay:.1*L},children:[n.jsxs("div",{className:"flex items-center space-x-4 p-3 rounded-lg hover:bg-accent transition-colors",children:[n.jsxs(al,{className:"h-12 w-12",children:[n.jsx(Il,{src:M.image,alt:M.property}),n.jsx(ll,{children:E(M.type)})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-1",children:[n.jsx(ls,{variant:"secondary",className:P(M.type),children:M.type.charAt(0).toUpperCase()+M.type.slice(1)}),n.jsx("span",{className:"text-sm text-muted-foreground",children:M.date})]}),n.jsx("h4",{className:"font-medium text-sm truncate",children:M.property}),n.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(Ai,{className:"h-3 w-3 mr-1"}),M.location]}),n.jsxs("span",{className:"flex items-center",children:[n.jsx(hi,{className:"h-3 w-3 mr-1"}),M.price]})]})]}),n.jsx(dt,{variant:"ghost",size:"sm",onClick:()=>e("/property-details"),children:n.jsx(Dg,{className:"h-4 w-4"})})]}),L<_.length-1&&n.jsx($u,{})]},M.id))}),n.jsx("div",{className:"mt-6 text-center",children:n.jsxs(dt,{variant:"outline",onClick:()=>e("/buy"),children:["View All Properties",n.jsx(Dg,{className:"h-4 w-4 ml-2"})]})})]})]})})]}),n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5,delay:.6},className:"mt-8",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(Ei,{className:"h-5 w-5"}),n.jsx("span",{children:"Market Insights"})]}),n.jsx(Zs,{children:"Stay updated with the latest real estate trends"})]}),n.jsx(at,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6",children:[n.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-blue-50 to-blue-100 rounded-lg",children:[n.jsx(Ei,{className:"h-8 w-8 text-blue-600 mx-auto mb-2"}),n.jsx("h4",{className:"font-semibold text-blue-900",children:"Market Trends"}),n.jsx("p",{className:"text-sm text-blue-700 mt-1",children:"Property prices are trending upward in Nairobi"})]}),n.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-green-50 to-green-100 rounded-lg",children:[n.jsx(bo,{className:"h-8 w-8 text-green-600 mx-auto mb-2"}),n.jsx("h4",{className:"font-semibold text-green-900",children:"New Listings"}),n.jsx("p",{className:"text-sm text-green-700 mt-1",children:"45 new properties added this week"})]}),n.jsxs("div",{className:"text-center p-4 bg-gradient-to-br from-purple-50 to-purple-100 rounded-lg",children:[n.jsx(_o,{className:"h-8 w-8 text-purple-600 mx-auto mb-2"}),n.jsx("h4",{className:"font-semibold text-purple-900",children:"Agent Activity"}),n.jsx("p",{className:"text-sm text-purple-700 mt-1",children:"High agent response rates this month"})]})]})})]})})]})}),n.jsx(Oi,{})]}):null},Zue=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi(),{toast:d}=Bi(),[m,_]=z.useState(""),[w,o]=z.useState("recent"),[E,P]=z.useState("all"),[M,L]=z.useState([{id:1,title:"Modern 3-Bedroom Apartment",type:"Apartment",location:"Westlands, Nairobi",price:25e6,priceType:"sale",bedrooms:3,bathrooms:2,area:120,image:"/api/placeholder/300/200",agent:{name:"Sarah Kamau",avatar:"/api/placeholder/40/40",rating:4.8},addedDate:"2024-01-15",description:"Beautiful modern apartment with stunning city views, fully furnished and ready to move in."},{id:2,title:"Luxury Villa with Pool",type:"Villa",location:"Karen, Nairobi",price:45e6,priceType:"sale",bedrooms:4,bathrooms:3,area:250,image:"/api/placeholder/300/200",agent:{name:"John Ochieng",avatar:"/api/placeholder/40/40",rating:4.9},addedDate:"2024-01-10",description:"Spacious luxury villa featuring a private pool, garden, and modern amenities in an exclusive neighborhood."},{id:3,title:"Studio Apartment",type:"Studio",location:"Kilimani, Nairobi",price:85e5,priceType:"sale",bedrooms:1,bathrooms:1,area:45,image:"/api/placeholder/300/200",agent:{name:"Grace Wanjiku",avatar:"/api/placeholder/40/40",rating:4.7},addedDate:"2024-01-05",description:"Cozy studio apartment perfect for young professionals, located in a vibrant neighborhood."}]);z.useEffect(()=>{if(!l){e("/auth/signin");return}},[l,e]);const F=W=>{L(q=>q.filter(oe=>oe.id!==W)),d({title:"Removed from favorites",description:"Property has been removed from your favorites.",variant:"default"})},$=W=>{e(`/property/${W}`)},Y=W=>{d({title:"Contact Agent",description:`Redirecting to chat with ${W}...`,variant:"default"})},X=[...M.filter(W=>{const q=W.title.toLowerCase().includes(m.toLowerCase())||W.location.toLowerCase().includes(m.toLowerCase()),oe=E==="all"||W.type.toLowerCase()===E.toLowerCase();return q&&oe})].sort((W,q)=>{switch(w){case"price-low":return W.price-q.price;case"price-high":return q.price-W.price;case"recent":return new Date(q.addedDate).getTime()-new Date(W.addedDate).getTime();case"oldest":return new Date(W.addedDate).getTime()-new Date(q.addedDate).getTime();default:return 0}}),Z=W=>W>=1e6?`KES ${(W/1e6).toFixed(1)}M`:W>=1e3?`KES ${(W/1e3).toFixed(0)}K`:`KES ${W.toLocaleString()}`;return s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx(su,{className:"h-8 w-8 text-red-500"}),n.jsx("h1",{className:"text-4xl font-bold",children:"My Favorites"})]}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Your saved properties and dream homes"})]}),n.jsx(ot,{className:"mb-8",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search favorites...",value:m,onChange:W=>_(W.target.value),className:"pl-10"})]}),n.jsxs(qn,{value:E,onValueChange:P,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Property Type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"all",children:"All Types"}),n.jsx(it,{value:"apartment",children:"Apartment"}),n.jsx(it,{value:"villa",children:"Villa"}),n.jsx(it,{value:"house",children:"House"}),n.jsx(it,{value:"studio",children:"Studio"})]})]}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Sort by"})}),n.jsxs($n,{children:[n.jsx(it,{value:"recent",children:"Most Recent"}),n.jsx(it,{value:"oldest",children:"Oldest First"}),n.jsx(it,{value:"price-low",children:"Price: Low to High"}),n.jsx(it,{value:"price-high",children:"Price: High to Low"})]})]}),n.jsxs(dt,{variant:"outline",className:"flex items-center space-x-2",children:[n.jsx(wx,{className:"h-4 w-4"}),n.jsx("span",{children:"More Filters"})]})]})})}),n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(ls,{variant:"secondary",children:[X.length," favorites"]}),n.jsx("span",{className:"text-muted-foreground",children:"found"})]}),X.length>0&&n.jsxs(dt,{variant:"outline",onClick:()=>e("/buy"),children:[n.jsx(bo,{className:"h-4 w-4 mr-2"}),"Browse More Properties"]})]}),n.jsx(KP,{children:X.length===0?n.jsxs(ci.div,{initial:{opacity:0,scale:.9},animate:{opacity:1,scale:1},className:"text-center py-16",children:[n.jsx(su,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),n.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No favorites yet"}),n.jsx("p",{className:"text-muted-foreground mb-6",children:"Start exploring properties and save your favorites to see them here"}),n.jsxs(dt,{onClick:()=>e("/buy"),children:[n.jsx(Li,{className:"h-4 w-4 mr-2"}),"Explore Properties"]})]}):n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:X.map((W,q)=>n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,scale:.9},transition:{duration:.3,delay:q*.1},children:n.jsxs(ot,{className:"hover:shadow-lg transition-all duration-200 group",children:[n.jsxs("div",{className:"relative",children:[n.jsx("img",{src:W.image,alt:W.title,className:"w-full h-48 object-cover rounded-t-lg"}),n.jsx("div",{className:"absolute top-3 right-3",children:n.jsx(dt,{size:"icon",variant:"destructive",className:"h-8 w-8 opacity-0 group-hover:opacity-100 transition-opacity",onClick:()=>F(W.id),children:n.jsx(ox,{className:"h-4 w-4"})})}),n.jsx("div",{className:"absolute top-3 left-3",children:n.jsx(ls,{variant:"secondary",className:"bg-white/90 text-foreground",children:W.priceType==="sale"?"For Sale":"For Rent"})})]}),n.jsxs(at,{className:"p-4",children:[n.jsxs("div",{className:"mb-3",children:[n.jsx("h3",{className:"font-semibold text-lg mb-1 line-clamp-1",children:W.title}),n.jsxs("div",{className:"flex items-center space-x-1 text-muted-foreground mb-2",children:[n.jsx(Ai,{className:"h-3 w-3"}),n.jsx("span",{className:"text-sm",children:W.location})]})]}),n.jsxs("div",{className:"flex items-center justify-between mb-3",children:[n.jsx("span",{className:"text-2xl font-bold text-primary",children:Z(W.price)}),n.jsx(ls,{variant:"outline",children:W.type})]}),n.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mb-4",children:[n.jsxs("span",{className:"flex items-center",children:[n.jsx(nx,{className:"h-4 w-4 mr-1"}),W.bedrooms]}),n.jsxs("span",{className:"flex items-center",children:[n.jsx(sx,{className:"h-4 w-4 mr-1"}),W.bathrooms]}),n.jsxs("span",{className:"flex items-center",children:[n.jsx(ix,{className:"h-4 w-4 mr-1"}),W.area,"m"]})]}),n.jsxs("div",{className:"flex items-center space-x-2 mb-4",children:[n.jsxs(al,{className:"h-8 w-8",children:[n.jsx(Il,{src:W.agent.avatar,alt:W.agent.name}),n.jsx(ll,{className:"text-xs",children:W.agent.name.split(" ").map(oe=>oe[0]).join("")})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:W.agent.name}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(lc,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),n.jsx("span",{className:"text-xs text-muted-foreground",children:W.agent.rating})]})]})]}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsxs(dt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>$(W.id),children:[n.jsx(pi,{className:"h-4 w-4 mr-2"}),"View"]}),n.jsxs(dt,{variant:"outline",size:"sm",className:"flex-1",onClick:()=>Y(W.agent.name),children:[n.jsx(sv,{className:"h-4 w-4 mr-2"}),"Contact"]})]}),n.jsxs("div",{className:"mt-3 pt-3 border-t text-xs text-muted-foreground",children:["Added"," ",new Date(W.addedDate).toLocaleDateString()]})]})]})},W.id))})})]})}),n.jsx(Oi,{})]}):null},Kue=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi(),{toast:d}=Bi(),[m,_]=z.useState(""),[w,o]=z.useState(null),[E,P]=z.useState(""),[M,L]=z.useState(!1),[F,$]=z.useState([{id:1,agent:{id:1,name:"Sarah Kamau",avatar:"/api/placeholder/40/40",company:"Prime Properties Kenya",rating:4.8,phone:"+254 700 123 456",email:"sarah@primeproperties.co.ke"},property:{id:1,title:"Modern 3-Bedroom Apartment",location:"Westlands, Nairobi",price:"KES 25,000,000",image:"/api/placeholder/60/60"},lastMessage:"Thank you for your interest! When would you like to schedule a viewing?",lastMessageTime:"2 hours ago",unreadCount:2,isOnline:!0},{id:2,agent:{id:2,name:"John Ochieng",avatar:"/api/placeholder/40/40",company:"Urban Living Realty",rating:4.9,phone:"+254 700 234 567",email:"john@urbanliving.co.ke"},property:{id:2,title:"Luxury Villa with Pool",location:"Karen, Nairobi",price:"KES 45,000,000",image:"/api/placeholder/60/60"},lastMessage:"The property is still available. Would you like to see it this weekend?",lastMessageTime:"1 day ago",unreadCount:0,isOnline:!1},{id:3,agent:{id:3,name:"Grace Wanjiku",avatar:"/api/placeholder/40/40",company:"Keja Solutions",rating:4.7,phone:"+254 700 345 678",email:"grace@kejasolutions.co.ke"},property:{id:3,title:"Studio Apartment",location:"Kilimani, Nairobi",price:"KES 8,500,000",image:"/api/placeholder/60/60"},lastMessage:"I've sent you the floor plan. Let me know if you have any questions!",lastMessageTime:"3 days ago",unreadCount:1,isOnline:!0}]),[Y,H]=z.useState([{id:1,senderId:1,senderType:"agent",content:"Hello! Thank you for your interest in the Modern 3-Bedroom Apartment in Westlands. How can I help you today?",timestamp:"2024-01-15T10:00:00Z",isRead:!0},{id:2,senderId:s==null?void 0:s.id,senderType:"user",content:"Hi Sarah! I'm interested in viewing this apartment. Is it still available?",timestamp:"2024-01-15T10:05:00Z",isRead:!0},{id:3,senderId:1,senderType:"agent",content:"Yes, it's still available! The apartment is in excellent condition and ready for viewing. When would you like to schedule a viewing?",timestamp:"2024-01-15T10:10:00Z",isRead:!0},{id:4,senderId:s==null?void 0:s.id,senderType:"user",content:"That sounds great! I'm available this weekend. What times do you have available?",timestamp:"2024-01-15T10:15:00Z",isRead:!1},{id:5,senderId:1,senderType:"agent",content:"Thank you for your interest! When would you like to schedule a viewing?",timestamp:"2024-01-15T12:00:00Z",isRead:!1}]);z.useEffect(()=>{if(!l){e("/auth/signin");return}},[l,e]);const X=async()=>{if(!(!E.trim()||!w)){L(!0);try{const ae={id:Date.now(),senderId:s==null?void 0:s.id,senderType:"user",content:E.trim(),timestamp:new Date().toISOString(),isRead:!1};H(Ne=>[...Ne,ae]),P(""),d({title:"Message sent",description:"Your message has been sent successfully.",variant:"default"})}catch{d({title:"Failed to send message",description:"Please try again.",variant:"destructive"})}finally{L(!1)}}},Z=ae=>{o(ae),$(Ne=>Ne.map(Pe=>Pe.id===ae?{...Pe,unreadCount:0}:Pe))},W=F.filter(ae=>ae.agent.name.toLowerCase().includes(m.toLowerCase())||ae.property.title.toLowerCase().includes(m.toLowerCase())),q=F.find(ae=>ae.id===w),oe=w?Y:[];return s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx(tl,{className:"h-8 w-8 text-blue-500"}),n.jsx("h1",{className:"text-4xl font-bold",children:"Messages"})]}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Chat with agents and manage your property inquiries"})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6 h-[600px]",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs(ot,{className:"h-full",children:[n.jsxs(Ut,{children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx($t,{children:"Conversations"}),n.jsx(dt,{size:"sm",variant:"outline",children:n.jsx(wx,{className:"h-4 w-4"})})]}),n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search conversations...",value:m,onChange:ae=>_(ae.target.value),className:"pl-10"})]})]}),n.jsx(at,{className:"p-0",children:n.jsx(kh,{className:"h-[500px]",children:n.jsx("div",{className:"space-y-1",children:W.map(ae=>n.jsx(ci.div,{initial:{opacity:0,x:-20},animate:{opacity:1,x:0},whileHover:{scale:1.02},className:`p-4 cursor-pointer transition-colors ${w===ae.id?"bg-accent":"hover:bg-muted/50"}`,onClick:()=>Z(ae.id),children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsxs("div",{className:"relative",children:[n.jsxs(al,{className:"h-10 w-10",children:[n.jsx(Il,{src:ae.agent.avatar,alt:ae.agent.name}),n.jsx(ll,{className:"text-xs",children:ae.agent.name.split(" ").map(Ne=>Ne[0]).join("")})]}),n.jsx("div",{className:`absolute -bottom-1 -right-1 w-3 h-3 rounded-full border-2 border-background ${ae.isOnline?"bg-green-500":"bg-gray-400"}`})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center justify-between mb-1",children:[n.jsx("h4",{className:"font-medium text-sm truncate",children:ae.agent.name}),n.jsx("span",{className:"text-xs text-muted-foreground",children:ae.lastMessageTime})]}),n.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:ae.agent.company}),n.jsx("p",{className:"text-sm text-muted-foreground line-clamp-2 mb-2",children:ae.lastMessage}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("img",{src:ae.property.image,alt:ae.property.title,className:"w-6 h-6 rounded object-cover"}),n.jsx("span",{className:"text-xs text-muted-foreground truncate max-w-[120px]",children:ae.property.title})]}),ae.unreadCount>0&&n.jsx(ls,{variant:"default",className:"h-5 px-2 text-xs",children:ae.unreadCount})]})]})]})},ae.id))})})})]})}),n.jsx("div",{className:"lg:col-span-2",children:n.jsx(ot,{className:"h-full",children:w?n.jsxs(n.Fragment,{children:[n.jsxs(Ut,{className:"border-b",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs(al,{className:"h-10 w-10",children:[n.jsx(Il,{src:q==null?void 0:q.agent.avatar,alt:q==null?void 0:q.agent.name}),n.jsx(ll,{className:"text-xs",children:q==null?void 0:q.agent.name.split(" ").map(ae=>ae[0]).join("")})]}),n.jsxs("div",{children:[n.jsx($t,{className:"text-lg",children:q==null?void 0:q.agent.name}),n.jsxs(Zs,{className:"flex items-center space-x-2",children:[n.jsx(Ya,{className:"h-3 w-3"}),n.jsx("span",{children:q==null?void 0:q.agent.company}),n.jsx("span",{children:""}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(lc,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),n.jsx("span",{children:q==null?void 0:q.agent.rating})]})]})]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dt,{size:"sm",variant:"outline",children:n.jsx(Uh,{className:"h-4 w-4"})}),n.jsx(dt,{size:"sm",variant:"outline",children:n.jsx(il,{className:"h-4 w-4"})}),n.jsx(dt,{size:"sm",variant:"outline",children:n.jsx(UJ,{className:"h-4 w-4"})})]})]}),n.jsxs("div",{className:"flex items-center space-x-3 p-3 bg-muted rounded-lg",children:[n.jsx("img",{src:q==null?void 0:q.property.image,alt:q==null?void 0:q.property.title,className:"w-12 h-12 rounded object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"font-medium text-sm truncate",children:q==null?void 0:q.property.title}),n.jsxs("div",{className:"flex items-center space-x-2 text-xs text-muted-foreground",children:[n.jsx(Ai,{className:"h-3 w-3"}),n.jsx("span",{children:q==null?void 0:q.property.location}),n.jsx("span",{children:""}),n.jsx("span",{className:"font-medium text-primary",children:q==null?void 0:q.property.price})]})]}),n.jsx(dt,{size:"sm",variant:"outline",children:n.jsx(pi,{className:"h-4 w-4"})})]})]}),n.jsx(at,{className:"p-0 h-[400px]",children:n.jsx(kh,{className:"h-full p-4",children:n.jsx("div",{className:"space-y-4",children:oe.map(ae=>n.jsx(ci.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},className:`flex ${ae.senderType==="user"?"justify-end":"justify-start"}`,children:n.jsx("div",{className:`max-w-[70%] ${ae.senderType==="user"?"order-2":"order-1"}`,children:n.jsxs("div",{className:`rounded-lg px-4 py-2 ${ae.senderType==="user"?"bg-primary text-primary-foreground":"bg-muted"}`,children:[n.jsx("p",{className:"text-sm",children:ae.content}),n.jsxs("div",{className:`flex items-center justify-end space-x-1 mt-1 text-xs ${ae.senderType==="user"?"text-primary-foreground/70":"text-muted-foreground"}`,children:[n.jsx("span",{children:new Date(ae.timestamp).toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})}),ae.senderType==="user"&&(ae.isRead?n.jsx(DJ,{className:"h-3 w-3"}):n.jsx(Eh,{className:"h-3 w-3"}))]})]})})},ae.id))})})}),n.jsx("div",{className:"p-4 border-t",children:n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(Es,{placeholder:"Type your message...",value:E,onChange:ae=>P(ae.target.value),onKeyPress:ae=>ae.key==="Enter"&&X(),disabled:M}),n.jsx(dt,{onClick:X,disabled:!E.trim()||M,size:"icon",children:M?n.jsx("div",{className:"animate-spin rounded-full h-4 w-4 border-b-2 border-white"}):n.jsx(K2,{className:"h-4 w-4"})})]})})]}):n.jsx("div",{className:"flex items-center justify-center h-full",children:n.jsxs("div",{className:"text-center",children:[n.jsx(tl,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),n.jsx("h3",{className:"text-xl font-semibold mb-2",children:"Select a conversation"}),n.jsx("p",{className:"text-muted-foreground",children:"Choose a conversation from the list to start chatting"})]})})})})]})]})}),n.jsx(Oi,{})]}):null},Xue=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi(),{toast:d}=Bi(),[m,_]=z.useState([]),[w,o]=z.useState([]),[E,P]=z.useState(""),[M,L]=z.useState("all"),[F,$]=z.useState("all"),[Y,H]=z.useState("all"),[X,Z]=z.useState("newest"),[W,q]=z.useState("list");z.useState(!1);const[oe,ae]=z.useState([]),Ne=[{id:"1",type:"message",category:"urgent",title:"New Message from Agent",message:"Sarah Kamau sent you a message about the property in Karen. She's available for a viewing this weekend.",timestamp:new Date(Date.now()-5*60*1e3),isRead:!1,isArchived:!1,isPinned:!0,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-001",agentId:"agent-001",location:"Karen, Nairobi"},action:()=>e("/messages")},{id:"2",type:"property",category:"important",title:"Property View Update",message:"Your property in Westlands received 15 new views today and 3 new inquiries.",timestamp:new Date(Date.now()-30*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-002",location:"Westlands, Nairobi",views:15,inquiries:3},action:()=>e("/dashboard")},{id:"3",type:"payment",category:"normal",title:"Payment Received",message:"KES 2,500 has been credited to your account for property views this month.",timestamp:new Date(Date.now()-2*60*60*1e3),isRead:!0,isArchived:!1,isPinned:!1,avatar:"/api/placeholder/40/40",metadata:{amount:2500,currency:"KES"},action:()=>e("/account")},{id:"4",type:"system",category:"low",title:"Welcome to KejaYangu",message:"Your account has been successfully created. Start exploring properties and earning rewards!",timestamp:new Date(Date.now()-24*60*60*1e3),isRead:!0,isArchived:!1,isPinned:!1,action:()=>e("/dashboard")},{id:"5",type:"inquiry",category:"urgent",title:"New Property Inquiry",message:"John Doe is interested in your 3-bedroom apartment in Kilimani. Contact them within 24 hours.",timestamp:new Date(Date.now()-1*60*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,avatar:"/api/placeholder/40/40",metadata:{propertyId:"prop-003",location:"Kilimani, Nairobi",contact:"john@example.com"},action:()=>e("/messages")},{id:"6",type:"reminder",category:"important",title:"Property Viewing Reminder",message:"You have a property viewing scheduled for tomorrow at 2:00 PM in Westlands.",timestamp:new Date(Date.now()-4*60*60*1e3),isRead:!1,isArchived:!1,isPinned:!1,metadata:{propertyId:"prop-004",location:"Westlands, Nairobi",scheduledTime:"2024-01-16T14:00:00Z"},action:()=>e("/dashboard")}];z.useEffect(()=>{if(!l){e("/auth/signin");return}_(Ne)},[l,e]),z.useEffect(()=>{let nt=[...m];E&&(nt=nt.filter(Mt=>Mt.title.toLowerCase().includes(E.toLowerCase())||Mt.message.toLowerCase().includes(E.toLowerCase()))),M!=="all"&&(nt=nt.filter(Mt=>Mt.category===M)),F!=="all"&&(nt=nt.filter(Mt=>Mt.type===F)),Y!=="all"&&(Y==="unread"?nt=nt.filter(Mt=>!Mt.isRead):Y==="read"?nt=nt.filter(Mt=>Mt.isRead):Y==="pinned"&&(nt=nt.filter(Mt=>Mt.isPinned))),nt.sort((Mt,ss)=>{if(X==="newest")return ss.timestamp.getTime()-Mt.timestamp.getTime();if(X==="oldest")return Mt.timestamp.getTime()-ss.timestamp.getTime();if(X==="priority"){const Ps={urgent:4,important:3,normal:2,low:1};return Ps[ss.category]-Ps[Mt.category]}return 0}),o(nt)},[m,E,M,F,Y,X]);const Pe=nt=>{switch(nt){case"message":return n.jsx(tl,{className:"h-5 w-5 text-blue-500"});case"property":return n.jsx(bo,{className:"h-5 w-5 text-green-500"});case"payment":return n.jsx(hi,{className:"h-5 w-5 text-yellow-500"});case"system":return n.jsx(Qw,{className:"h-5 w-5 text-purple-500"});case"inquiry":return n.jsx(lu,{className:"h-5 w-5 text-orange-500"});case"reminder":return n.jsx(Ko,{className:"h-5 w-5 text-indigo-500"});default:return n.jsx(rl,{className:"h-5 w-5 text-gray-500"})}},Le=nt=>{switch(nt){case"urgent":return"bg-red-100 text-red-800 border-red-200";case"important":return"bg-orange-100 text-orange-800 border-orange-200";case"normal":return"bg-blue-100 text-blue-800 border-blue-200";case"low":return"bg-gray-100 text-gray-800 border-gray-200";default:return"bg-gray-100 text-gray-800 border-gray-200"}},ct=nt=>{const ss=new Date().getTime()-nt.getTime(),Ps=Math.floor(ss/(1e3*60)),xn=Math.floor(ss/(1e3*60*60)),Ms=Math.floor(ss/(1e3*60*60*24));return Ps<1?"Just now":Ps<60?`${Ps}m ago`:xn<24?`${xn}h ago`:Ms<7?`${Ms}d ago`:nt.toLocaleDateString()},xt=nt=>{_(Mt=>Mt.map(ss=>ss.id===nt?{...ss,isRead:!0}:ss)),d({title:"Marked as read",description:"Notification marked as read",variant:"default"})},yt=()=>{_(nt=>nt.map(Mt=>({...Mt,isRead:!0}))),d({title:"All marked as read",description:"All notifications marked as read",variant:"default"})},Ht=nt=>{_(Mt=>Mt.map(ss=>ss.id===nt?{...ss,isPinned:!ss.isPinned}:ss))},Dt=nt=>{_(Mt=>Mt.map(ss=>ss.id===nt?{...ss,isArchived:!0}:ss)),d({title:"Archived",description:"Notification moved to archive",variant:"default"})},wt=nt=>{_(Mt=>Mt.filter(ss=>ss.id!==nt)),d({title:"Deleted",description:"Notification deleted successfully",variant:"default"})},rs=nt=>{if(oe.length===0){d({title:"No selection",description:"Please select notifications first",variant:"destructive"});return}switch(nt){case"read":_(Mt=>Mt.map(ss=>oe.includes(ss.id)?{...ss,isRead:!0}:ss)),d({title:"Bulk action completed",description:`${oe.length} notifications marked as read`,variant:"default"});break;case"archive":_(Mt=>Mt.map(ss=>oe.includes(ss.id)?{...ss,isArchived:!0}:ss)),d({title:"Bulk action completed",description:`${oe.length} notifications archived`,variant:"default"});break;case"delete":_(Mt=>Mt.filter(ss=>!oe.includes(ss.id))),d({title:"Bulk action completed",description:`${oe.length} notifications deleted`,variant:"default"});break}ae([])},Vt=nt=>{nt.isRead||xt(nt.id),nt.action&&nt.action()},Bt=nt=>{ae(Mt=>Mt.includes(nt)?Mt.filter(ss=>ss!==nt):[...Mt,nt])},ze=()=>{oe.length===w.length?ae([]):ae(w.map(nt=>nt.id))},Xe=m.filter(nt=>!nt.isRead).length,Ot=m.filter(nt=>nt.isPinned).length;return s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx(au,{className:"h-8 w-8 text-blue-500"}),n.jsx("h1",{className:"text-4xl font-bold",children:"Notifications"})]}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Stay updated with your property activities and messages"}),n.jsxs("div",{className:"flex items-center space-x-6 mt-4",children:[n.jsx("div",{className:"flex items-center space-x-2",children:n.jsxs(ls,{variant:"secondary",className:"text-sm",children:[m.length," Total"]})}),n.jsx("div",{className:"flex items-center space-x-2",children:n.jsxs(ls,{variant:"destructive",className:"text-sm",children:[Xe," Unread"]})}),n.jsx("div",{className:"flex items-center space-x-2",children:n.jsxs(ls,{variant:"outline",className:"text-sm",children:[Ot," Pinned"]})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(Ut,{children:n.jsxs("div",{className:"flex flex-col lg:flex-row gap-4 items-start lg:items-center justify-between",children:[n.jsx("div",{className:"flex-1 max-w-md",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search notifications...",value:E,onChange:nt=>P(nt.target.value),className:"pl-10"})]})}),n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs(qn,{value:M,onValueChange:L,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{placeholder:"Category"})}),n.jsxs($n,{children:[n.jsx(it,{value:"all",children:"All Categories"}),n.jsx(it,{value:"urgent",children:"Urgent"}),n.jsx(it,{value:"important",children:"Important"}),n.jsx(it,{value:"normal",children:"Normal"}),n.jsx(it,{value:"low",children:"Low"})]})]}),n.jsxs(qn,{value:F,onValueChange:$,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{placeholder:"Type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"all",children:"All Types"}),n.jsx(it,{value:"message",children:"Messages"}),n.jsx(it,{value:"property",children:"Properties"}),n.jsx(it,{value:"payment",children:"Payments"}),n.jsx(it,{value:"system",children:"System"}),n.jsx(it,{value:"inquiry",children:"Inquiries"}),n.jsx(it,{value:"reminder",children:"Reminders"})]})]}),n.jsxs(qn,{value:Y,onValueChange:H,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{placeholder:"Status"})}),n.jsxs($n,{children:[n.jsx(it,{value:"all",children:"All Status"}),n.jsx(it,{value:"unread",children:"Unread"}),n.jsx(it,{value:"read",children:"Read"}),n.jsx(it,{value:"pinned",children:"Pinned"})]})]}),n.jsxs(qn,{value:X,onValueChange:Z,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{placeholder:"Sort by"})}),n.jsxs($n,{children:[n.jsx(it,{value:"newest",children:"Newest First"}),n.jsx(it,{value:"oldest",children:"Oldest First"}),n.jsx(it,{value:"priority",children:"Priority"})]})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(dt,{variant:W==="list"?"default":"outline",size:"icon",onClick:()=>q("list"),children:n.jsx(pi,{className:"h-4 w-4"})}),n.jsx(dt,{variant:W==="grid"?"default":"outline",size:"icon",onClick:()=>q("grid"),children:n.jsx(Hu,{className:"h-4 w-4"})})]})]})]})})}),oe.length>0&&n.jsx(ci.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},className:"mb-4 p-4 bg-muted rounded-lg border",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("span",{className:"text-sm font-medium",children:[oe.length," notification(s) selected"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>rs("read"),children:[n.jsx(Eh,{className:"h-4 w-4 mr-2"}),"Mark as Read"]}),n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>rs("archive"),children:[n.jsx(GD,{className:"h-4 w-4 mr-2"}),"Archive"]}),n.jsxs(dt,{variant:"destructive",size:"sm",onClick:()=>rs("delete"),children:[n.jsx(ox,{className:"h-4 w-4 mr-2"}),"Delete"]})]})]})}),n.jsx("div",{className:"space-y-4",children:w.length===0?n.jsx(ot,{children:n.jsxs(at,{className:"text-center py-12",children:[n.jsx(au,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),n.jsx("h3",{className:"text-xl font-semibold mb-2",children:"No notifications found"}),n.jsx("p",{className:"text-muted-foreground mb-4",children:E||M!=="all"||F!=="all"||Y!=="all"?"Try adjusting your filters or search query":"You're all caught up! Check back later for new notifications"}),(E||M!=="all"||F!=="all"||Y!=="all")&&n.jsx(dt,{variant:"outline",onClick:()=>{P(""),L("all"),$("all"),H("all")},children:"Clear Filters"})]})}):n.jsx(KP,{children:w.map((nt,Mt)=>n.jsx(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},exit:{opacity:0,y:-20},transition:{duration:.2,delay:Mt*.05},children:n.jsx(ot,{className:`transition-all duration-200 hover:shadow-md ${nt.isPinned?"border-l-4 border-l-blue-500 bg-blue-50/50":""} ${nt.isRead?"":"border-l-4 border-l-orange-500 bg-orange-50/50"}`,children:n.jsx(at,{className:"p-4",children:n.jsxs("div",{className:"flex items-start space-x-4",children:[n.jsx("div",{className:"flex-shrink-0 mt-1",children:n.jsx("input",{type:"checkbox",checked:oe.includes(nt.id),onChange:()=>Bt(nt.id),className:"h-4 w-4 text-primary border-gray-300 rounded focus:ring-primary"})}),n.jsx("div",{className:"flex-shrink-0",children:n.jsx("div",{className:"h-10 w-10 rounded-full bg-muted flex items-center justify-center",children:Pe(nt.type)})}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-start justify-between mb-2",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("h3",{className:`font-medium ${nt.isRead?"text-muted-foreground":"text-foreground"}`,children:nt.title}),nt.isPinned&&n.jsx(lc,{className:"h-4 w-4 text-yellow-500 fill-yellow-500"}),n.jsx(ls,{variant:"outline",className:`text-xs ${Le(nt.category)}`,children:nt.category})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(dt,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Ht(nt.id),children:n.jsx(lc,{className:`h-4 w-4 ${nt.isPinned?"text-yellow-500 fill-yellow-500":"text-muted-foreground"}`})}),n.jsx(dt,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>Dt(nt.id),children:n.jsx(GD,{className:"h-4 w-4"})}),n.jsx(dt,{variant:"ghost",size:"icon",className:"h-8 w-8",onClick:()=>wt(nt.id),children:n.jsx(ox,{className:"h-4 w-4"})})]})]}),n.jsx("p",{className:`text-sm mb-3 ${nt.isRead?"text-muted-foreground":"text-foreground"}`,children:nt.message}),nt.metadata&&n.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground mb-3",children:[nt.metadata.location&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(Ai,{className:"h-3 w-3"}),n.jsx("span",{children:nt.metadata.location})]}),nt.metadata.amount&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(hi,{className:"h-3 w-3"}),n.jsxs("span",{children:["KES"," ",nt.metadata.amount.toLocaleString()]})]}),nt.metadata.scheduledTime&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(bx,{className:"h-3 w-3"}),n.jsx("span",{children:new Date(nt.metadata.scheduledTime).toLocaleDateString()})]})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("span",{className:"text-xs text-muted-foreground",children:ct(nt.timestamp)}),!nt.isRead&&n.jsxs(dt,{variant:"ghost",size:"sm",onClick:()=>xt(nt.id),className:"text-xs h-6 px-2",children:[n.jsx(Eh,{className:"h-3 w-3 mr-1"}),"Mark as read"]})]}),n.jsx(dt,{variant:"outline",size:"sm",onClick:()=>Vt(nt),className:"text-xs",children:nt.type==="message"?"View Message":"View Details"})]})]})]})})})},nt.id))})}),n.jsxs("div",{className:"flex items-center justify-between mt-8",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dt,{variant:"outline",onClick:ze,className:"text-sm",children:oe.length===w.length?"Deselect All":"Select All"}),oe.length>0&&n.jsxs("span",{className:"text-sm text-muted-foreground",children:[oe.length," of"," ",w.length," selected"]})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(dt,{variant:"outline",onClick:yt,disabled:Xe===0,children:[n.jsx(Eh,{className:"h-4 w-4 mr-2"}),"Mark All as Read"]}),n.jsxs(dt,{variant:"outline",onClick:()=>window.location.reload(),children:[n.jsx(Wu,{className:"h-4 w-4 mr-2"}),"Refresh"]})]})]})]})}),n.jsx(Oi,{})]}):null};var lI="Progress",cI=100,[Yue,Yde]=Xo(lI),[Jue,Que]=Yue(lI),V$=z.forwardRef((e,s)=>{const{__scopeProgress:l,value:d=null,max:m,getValueLabel:_=ede,...w}=e;(m||m===0)&&!F4(m)&&console.error(tde(`${m}`,"Progress"));const o=F4(m)?m:cI;d!==null&&!B4(d,o)&&console.error(sde(`${d}`,"Progress"));const E=B4(d,o)?d:null,P=g2(E)?_(E,o):void 0;return n.jsx(Jue,{scope:l,value:E,max:o,children:n.jsx(Ys.div,{"aria-valuemax":o,"aria-valuemin":0,"aria-valuenow":g2(E)?E:void 0,"aria-valuetext":P,role:"progressbar","data-state":G$(E,o),"data-value":E??void 0,"data-max":o,...w,ref:s})})});V$.displayName=lI;var U$="ProgressIndicator",$$=z.forwardRef((e,s)=>{const{__scopeProgress:l,...d}=e,m=Que(U$,l);return n.jsx(Ys.div,{"data-state":G$(m.value,m.max),"data-value":m.value??void 0,"data-max":m.max,...d,ref:s})});$$.displayName=U$;function ede(e,s){return`${Math.round(e/s*100)}%`}function G$(e,s){return e==null?"indeterminate":e===s?"complete":"loading"}function g2(e){return typeof e=="number"}function F4(e){return g2(e)&&!isNaN(e)&&e>0}function B4(e,s){return g2(e)&&!isNaN(e)&&e<=s&&e>=0}function tde(e,s){return`Invalid prop \`max\` of value \`${e}\` supplied to \`${s}\`. Only numbers greater than 0 are valid max values. Defaulting to \`${cI}\`.`}function sde(e,s){return`Invalid prop \`value\` of value \`${e}\` supplied to \`${s}\`. The \`value\` prop must be:
  - a positive number
  - less than the value passed to \`max\` (or ${cI} if no \`max\` prop is set)
  - \`null\` or \`undefined\` if the progress is indeterminate.

Defaulting to \`null\`.`}var H$=V$,nde=$$;const xh=z.forwardRef(({className:e,value:s,...l},d)=>n.jsx(H$,{ref:d,className:Ds("relative h-4 w-full overflow-hidden rounded-full bg-secondary",e),...l,children:n.jsx(nde,{className:"h-full w-full flex-1 bg-primary transition-all",style:{transform:`translateX(-${100-(s||0)}%)`}})}));xh.displayName=H$.displayName;const rde=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi(),{toast:d}=Bi(),[m,_]=z.useState(!0),[w,o]=z.useState(null),[E,P]=z.useState([]),[M,L]=z.useState([]),[F,$]=z.useState({}),[Y,H]=z.useState({});z.useEffect(()=>{if(!l){e("/auth/signin");return}if((s==null?void 0:s.role)!=="CONTENT_CREATOR"){e("/dashboard");return}X()},[l,e,s]);const X=async()=>{try{_(!0);const q={profile:{id:"1",isEnrolled:!0,enrollmentStatus:"APPROVED",totalEarnings:2500.75,availableBalance:850.25,totalPayouts:1650.5,complianceScore:95,viewRate:.01,inquiryRate:.5,premiumListingRate:.1,adRevenueRate:.7,minimumPayout:100,enrollmentDate:"2024-01-01T00:00:00Z"},earnings:[{id:"1",propertyId:"1",earningsType:"VIEW_BASED",amount:15.5,views:1550,inquiries:8,calculationDate:"2024-01-15T00:00:00Z",property:{title:"Modern 3-Bedroom Apartment",slug:"modern-3-bedroom-apartment",images:[{url:"/api/placeholder/60/60"}]}},{id:"2",propertyId:"2",earningsType:"INQUIRY_BASED",amount:25,views:1200,inquiries:50,calculationDate:"2024-01-14T00:00:00Z",property:{title:"Luxury Villa with Pool",slug:"luxury-villa-pool",images:[{url:"/api/placeholder/60/60"}]}}],payouts:[{id:"1",amount:500,method:"MPESA",status:"COMPLETED",createdAt:"2024-01-10T00:00:00Z",processedAt:"2024-01-12T00:00:00Z",mpesaReference:"MPESA_REF_123456"},{id:"2",amount:1150.5,method:"BANK_TRANSFER",status:"PENDING",createdAt:"2024-01-15T00:00:00Z"}],stats:{period:"30 days",totalEarnings:2500.75,earningsCount:15,totalPayouts:1650.5,payoutsCount:3,activeProperties:5,totalViews:15e3,totalInquiries:250},compliance:{violations:{total:2,resolved:1,unresolved:1,bySeverity:{LOW:1,MEDIUM:1,HIGH:0,CRITICAL:0},byType:{MISLEADING_INFORMATION:1,SPAM:1}},profile:{complianceScore:95,lastComplianceCheck:"2024-01-15T00:00:00Z",enrollmentStatus:"APPROVED"}}};o(q.profile),P(q.earnings),L(q.payouts),$(q.stats),H(q.compliance)}catch{d({title:"Error",description:"Failed to fetch dashboard data",variant:"destructive"})}finally{_(!1)}},Z=async()=>{try{d({title:"Payout Requested",description:"Your payout request has been submitted successfully",variant:"default"})}catch{d({title:"Error",description:"Failed to request payout",variant:"destructive"})}},W=q=>{switch(q){case"COMPLETED":return"bg-green-100 text-green-800";case"PENDING":return"bg-yellow-100 text-yellow-800";case"PROCESSING":return"bg-blue-100 text-blue-800";case"FAILED":return"bg-red-100 text-red-800";default:return"bg-gray-100 text-gray-800"}};return m?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsx("div",{className:"flex items-center justify-center h-64",children:n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary"})})}),n.jsx(Oi,{})]}):w?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs(ci.div,{initial:{opacity:0,y:20},animate:{opacity:1,y:0},transition:{duration:.5},children:[n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center space-x-2 mb-2",children:[n.jsx(hi,{className:"h-8 w-8 text-green-500"}),n.jsx("h1",{className:"text-4xl font-bold",children:"Content Creator Dashboard"})]}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Monitor your earnings, manage payouts, and track compliance"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Earnings"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsxs("div",{className:"text-2xl font-bold",children:["KES ",w.totalEarnings.toLocaleString()]}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:["+",F.totalEarnings," this month"]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Available Balance"}),n.jsx(Ei,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsxs("div",{className:"text-2xl font-bold",children:["KES ",w.availableBalance.toLocaleString()]}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for payout"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Compliance Score"}),n.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsxs("div",{className:"text-2xl font-bold",children:[w.complianceScore,"/100"]}),n.jsx(xh,{value:w.complianceScore,className:"mt-2"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Active Properties"}),n.jsx(Ya,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:F.activeProperties}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Generating revenue"})]})]})]}),n.jsxs(Ix,{defaultValue:"overview",className:"space-y-6",children:[n.jsxs(Rf,{className:"grid w-full grid-cols-4",children:[n.jsx(io,{value:"overview",children:"Overview"}),n.jsx(io,{value:"earnings",children:"Earnings"}),n.jsx(io,{value:"payouts",children:"Payouts"}),n.jsx(io,{value:"compliance",children:"Compliance"})]}),n.jsxs(oo,{value:"overview",className:"space-y-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Quick Actions"}),n.jsx(Zs,{children:"Manage your content creator account"})]}),n.jsxs(at,{className:"flex flex-wrap gap-4",children:[n.jsxs(dt,{onClick:Z,disabled:w.availableBalance<w.minimumPayout,className:"flex items-center space-x-2",children:[n.jsx(Jw,{className:"h-4 w-4"}),n.jsx("span",{children:"Request Payout"})]}),n.jsxs(dt,{variant:"outline",className:"flex items-center space-x-2",children:[n.jsx(V5,{className:"h-4 w-4"}),n.jsx("span",{children:"Add Property"})]}),n.jsxs(dt,{variant:"outline",className:"flex items-center space-x-2",children:[n.jsx(rx,{className:"h-4 w-4"}),n.jsx("span",{children:"Account Settings"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Earnings"}),n.jsx(Zs,{children:"Your latest property earnings"})]}),n.jsx(at,{children:n.jsx(kh,{className:"h-64",children:n.jsx("div",{className:"space-y-4",children:E.slice(0,5).map(q=>{var oe;return n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("img",{src:(oe=q.property.images[0])==null?void 0:oe.url,alt:q.property.title,className:"w-10 h-10 rounded object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("p",{className:"text-sm font-medium truncate",children:q.property.title}),n.jsx("p",{className:"text-xs text-muted-foreground",children:new Date(q.calculationDate).toLocaleDateString()})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-sm font-medium",children:["KES ",q.amount]}),n.jsx(ls,{variant:"secondary",className:"text-xs",children:q.earningsType.replace("_"," ")})]})]},q.id)})})})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Performance Metrics"}),n.jsx(Zs,{children:"Your content performance this month"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(pi,{className:"h-4 w-4 text-blue-500"}),n.jsx("span",{className:"text-sm",children:"Total Views"})]}),n.jsx("span",{className:"font-medium",children:F.totalViews.toLocaleString()})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(tl,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Total Inquiries"})]}),n.jsx("span",{className:"font-medium",children:F.totalInquiries.toLocaleString()})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(lc,{className:"h-4 w-4 text-yellow-500"}),n.jsx("span",{className:"text-sm",children:"Earnings Count"})]}),n.jsx("span",{className:"font-medium",children:F.earningsCount})]}),n.jsx($u,{}),n.jsxs("div",{className:"text-center",children:[n.jsxs("p",{className:"text-2xl font-bold text-green-600",children:["KES ",F.totalEarnings.toLocaleString()]}),n.jsx("p",{className:"text-sm text-muted-foreground",children:"Total Earnings"})]})]})]})]})]}),n.jsx(oo,{value:"earnings",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Earnings History"}),n.jsx(Zs,{children:"Track your property earnings over time"})]}),n.jsx(at,{children:n.jsx(kh,{className:"h-96",children:n.jsx("div",{className:"space-y-4",children:E.map(q=>{var oe;return n.jsxs("div",{className:"flex items-center space-x-4 p-4 border rounded-lg",children:[n.jsx("img",{src:(oe=q.property.images[0])==null?void 0:oe.url,alt:q.property.title,className:"w-16 h-16 rounded object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"font-medium truncate",children:q.property.title}),n.jsxs("div",{className:"flex items-center space-x-4 text-sm text-muted-foreground mt-1",children:[n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(pi,{className:"h-3 w-3"}),n.jsx("span",{children:q.views.toLocaleString()})]}),n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(tl,{className:"h-3 w-3"}),n.jsx("span",{children:q.inquiries})]}),n.jsxs("span",{className:"flex items-center space-x-1",children:[n.jsx(bx,{className:"h-3 w-3"}),n.jsx("span",{children:new Date(q.calculationDate).toLocaleDateString()})]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsxs("p",{className:"text-lg font-bold text-green-600",children:["KES ",q.amount.toFixed(2)]}),n.jsx(ls,{variant:"outline",className:"mt-1",children:q.earningsType.replace("_"," ")})]})]},q.id)})})})})]})}),n.jsx(oo,{value:"payouts",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{children:[n.jsx($t,{children:"Payout History"}),n.jsx(Zs,{children:"Track your payout requests and transactions"})]}),n.jsxs(dt,{onClick:Z,disabled:w.availableBalance<w.minimumPayout,className:"flex items-center space-x-2",children:[n.jsx(Jw,{className:"h-4 w-4"}),n.jsx("span",{children:"Request Payout"})]})]})}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:M.map(q=>n.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(hi,{className:"h-5 w-5 text-green-500"}),n.jsxs("span",{className:"font-medium",children:["KES ",q.amount.toFixed(2)]})]}),n.jsx(ls,{className:W(q.status),children:q.status})]}),n.jsxs("div",{className:"text-right text-sm text-muted-foreground",children:[n.jsx("p",{children:new Date(q.createdAt).toLocaleDateString()}),n.jsx("p",{className:"capitalize",children:q.method.toLowerCase().replace("_"," ")}),q.mpesaReference&&n.jsxs("p",{className:"text-xs",children:["Ref: ",q.mpesaReference]})]})]},q.id))})})]})}),n.jsx(oo,{value:"compliance",className:"space-y-6",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Compliance Overview"}),n.jsx(Zs,{children:"Monitor your compliance score and violations"})]}),n.jsxs(at,{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsxs("div",{className:"text-4xl font-bold mb-2",children:[w.complianceScore,"/100"]}),n.jsx(xh,{value:w.complianceScore,className:"h-3"}),n.jsxs("p",{className:"text-sm text-muted-foreground mt-2",children:["Last checked:"," ",new Date(Y.profile.lastComplianceCheck).toLocaleDateString()]})]}),n.jsx($u,{}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-4",children:"Violations Summary"}),n.jsxs("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"text-center p-3 bg-red-50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-red-600",children:Y.violations.total}),n.jsx("div",{className:"text-sm text-red-600",children:"Total"})]}),n.jsxs("div",{className:"text-center p-3 bg-green-50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-green-600",children:Y.violations.resolved}),n.jsx("div",{className:"text-sm text-green-600",children:"Resolved"})]}),n.jsxs("div",{className:"text-center p-3 bg-yellow-50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:Y.violations.unresolved}),n.jsx("div",{className:"text-sm text-yellow-600",children:"Unresolved"})]}),n.jsxs("div",{className:"text-center p-3 bg-blue-50 rounded-lg",children:[n.jsx("div",{className:"text-2xl font-bold text-blue-600",children:w.complianceScore}),n.jsx("div",{className:"text-sm text-blue-600",children:"Score"})]})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-4",children:"Violation Types"}),n.jsx("div",{className:"space-y-3",children:Object.entries(Y.violations.byType).map(([q,oe])=>n.jsxs("div",{className:"flex items-center justify-between p-3 bg-gray-50 rounded-lg",children:[n.jsx("span",{className:"capitalize",children:q.toLowerCase().replace("_"," ")}),n.jsx(ls,{variant:"secondary",children:oe})]},q))})]})]})]})})]})]})}),n.jsx(Oi,{})]}):n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs("div",{className:"text-center",children:[n.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Content Creator Profile Not Found"}),n.jsx("p",{className:"text-muted-foreground mb-4",children:"You need to enroll as a content creator to access this dashboard."}),n.jsx(dt,{onClick:()=>e("/content-creators/enroll"),children:"Enroll Now"})]})}),n.jsx(Oi,{})]})},ide=()=>{const e=Xr(),{user:s,isAuthenticated:l}=mi(),{toast:d}=Bi(),[m,_]=z.useState(1),[w,o]=z.useState({taxId:"",mpesaNumber:"",payoutMethod:"MPESA",agreeToTerms:!1,agreeToCompliance:!1,agreeToTaxReporting:!1}),E=4;z.useEffect(()=>{if(console.log("ContentCreatorEnrollment mounted"),console.log("User:",s),console.log("Is authenticated:",l),!l){console.log("Not authenticated, redirecting to signin"),e("/auth/signin");return}},[l,e,s]);const P=($,Y)=>{o(H=>({...H,[$]:Y}))},M=()=>{m<E&&_($=>$+1)},L=()=>{m>1&&_($=>$-1)},F=async()=>{try{d({title:"Enrollment Submitted",description:"Your application has been submitted successfully!",variant:"default"}),e("/content-creator-dashboard")}catch{d({title:"Enrollment Failed",description:"Please try again.",variant:"destructive"})}};return l?s?n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsxs("div",{className:"flex items-center justify-center space-x-2 mb-2",children:[n.jsx(hi,{className:"h-8 w-8 text-green-500"}),n.jsx("h1",{className:"text-4xl font-bold",children:"Content Creator Enrollment"})]}),n.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Join our content creator program and start earning from your property listings."})]}),n.jsxs("div",{className:"mb-8",children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-sm font-medium",children:["Step ",m," of ",E]}),n.jsxs("span",{className:"text-sm text-muted-foreground",children:[Math.round(m/E*100),"% Complete"]})]}),n.jsx(xh,{value:m/E*100,className:"h-2"})]}),n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:[m===1&&"Tax Information",m===2&&"Payment Method",m===3&&"Terms & Compliance",m===4&&"Document Verification"]}),n.jsxs(Zs,{children:[m===1&&"Provide your tax identification information",m===2&&"Choose how you'd like to receive payments",m===3&&"Review and agree to our terms",m===4&&"Upload required verification documents"]})]}),n.jsxs(at,{children:[m===1&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"taxId",children:"Tax ID / KRA PIN"}),n.jsx(Es,{id:"taxId",placeholder:"Enter your KRA PIN or Tax ID",value:w.taxId,onChange:$=>P("taxId",$.target.value)})]}),n.jsxs(nd,{children:[n.jsx(Qw,{className:"h-4 w-4"}),n.jsx(rd,{children:"Your tax information is required for compliance with Kenyan tax laws."})]})]}),m===2&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(ds,{children:"Payout Method"}),n.jsxs(qn,{value:w.payoutMethod,onValueChange:$=>P("payoutMethod",$),children:[n.jsx(Un,{children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"MPESA",children:"M-Pesa"}),n.jsx(it,{value:"BANK_TRANSFER",children:"Bank Transfer"}),n.jsx(it,{value:"PAYPAL",children:"PayPal"}),n.jsx(it,{value:"STRIPE",children:"Stripe"})]})]})]}),w.payoutMethod==="MPESA"&&n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"mpesaNumber",children:"M-Pesa Number"}),n.jsx(Es,{id:"mpesaNumber",placeholder:"254XXXXXXXXX",value:w.mpesaNumber,onChange:$=>P("mpesaNumber",$.target.value)}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Enter your M-Pesa number in international format (254XXXXXXXXX)"})]})]}),m===3&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(sl,{id:"agreeToTerms",checked:w.agreeToTerms,onCheckedChange:$=>P("agreeToTerms",$)}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(ds,{htmlFor:"agreeToTerms",className:"text-sm font-medium",children:"I agree to the Content Creator Terms and Conditions"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"By checking this box, you agree to our platform's terms of service."})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(sl,{id:"agreeToCompliance",checked:w.agreeToCompliance,onCheckedChange:$=>P("agreeToCompliance",$)}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(ds,{htmlFor:"agreeToCompliance",className:"text-sm font-medium",children:"I agree to comply with all platform policies and quality standards"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"You must maintain high-quality property listings and follow all platform guidelines."})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx(sl,{id:"agreeToTaxReporting",checked:w.agreeToTaxReporting,onCheckedChange:$=>P("agreeToTaxReporting",$)}),n.jsxs("div",{className:"space-y-1",children:[n.jsx(ds,{htmlFor:"agreeToTaxReporting",className:"text-sm font-medium",children:"I agree to tax reporting and compliance requirements"}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"All earnings will be reported to KRA as required by Kenyan tax law."})]})]}),n.jsxs(nd,{children:[n.jsx(ac,{className:"h-4 w-4"}),n.jsxs(rd,{children:[n.jsx("strong",{children:"Important:"})," By enrolling as a content creator, you agree to comply with all Kenyan real estate laws, tax regulations, and platform policies."]})]})]}),m===4&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"idDocument",children:"Government ID Document"}),n.jsx(Es,{id:"idDocument",type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"mt-2"}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Upload a clear copy of your National ID, Passport, or Driver's License"})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"proofOfAddress",children:"Proof of Address"}),n.jsx(Es,{id:"proofOfAddress",type:"file",accept:".pdf,.jpg,.jpeg,.png",className:"mt-2"}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"Upload a recent utility bill, bank statement, or rental agreement"})]})]})]})]})}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(lc,{className:"h-5 w-5 text-yellow-500"}),n.jsx("span",{children:"Program Benefits"})]})}),n.jsxs(at,{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Earn KES 0.01 per property view"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Earn KES 0.50 per inquiry"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"10% of premium listing fees"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"70% of ad revenue share"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Minimum payout: KES 100"})]})]})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(ac,{className:"h-5 w-5 text-blue-500"}),n.jsx("span",{children:"Requirements"})]})}),n.jsxs(at,{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"At least 1 verified property"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Valid government ID"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Proof of address"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Tax ID (KRA PIN)"})]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(dr,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm",children:"Compliance with platform policies"})]})]})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(Qw,{className:"h-5 w-5 text-blue-500"}),n.jsx("span",{children:"Current Status"})]})}),n.jsxs(at,{className:"space-y-3",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm",children:"Properties"}),n.jsx(ls,{variant:"default",children:"Verified"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm",children:"Identity"}),n.jsx(ls,{variant:"secondary",children:"Pending"})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm",children:"Compliance"}),n.jsx(ls,{variant:"secondary",children:"Pending"})]})]})]})]})]}),n.jsxs("div",{className:"flex items-center justify-between mt-8",children:[n.jsx(dt,{variant:"outline",onClick:L,disabled:m===1,children:"Previous"}),n.jsx("div",{className:"flex items-center space-x-2",children:m<E?n.jsx(dt,{onClick:M,children:"Next Step"}):n.jsx(dt,{onClick:F,children:"Submit Application"})})]})]})]}),n.jsx(Oi,{})]}):n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs("div",{className:"text-center",children:[n.jsx("h1",{className:"text-2xl font-bold mb-4",children:"Authentication Error"}),n.jsx("p",{className:"text-muted-foreground mb-4",children:"Please log in to access this page."}),n.jsx(dt,{onClick:()=>e("/auth/signin"),children:"Go to Sign In"})]})}),n.jsx(Oi,{})]}):n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"animate-spin rounded-full h-8 w-8 border-b-2 border-primary mx-auto mb-4"}),n.jsx("p",{children:"Loading..."})]})}),n.jsx(Oi,{})]})},ode=()=>{const[e,s]=z.useState(null),l=[{id:"1",title:"Luxury Villa with Ocean Views",location:"Nyali, Mombasa",price:"25,000,000",propertyType:"villa",longitude:39.6682,latitude:-4.0435,bedrooms:4,bathrooms:3,area:350,rating:4.8,images:["/src/assets/property-1.jpg","/src/assets/property-2.jpg","/src/assets/property-3.jpg","/src/assets/property-1.jpg"],amenities:["Private Swimming Pool","Ocean View","Security System","Garden","Modern Kitchen","Balcony","Parking","Backup Generator"]},{id:"2",title:"Modern Apartment in Westlands",location:"Westlands, Nairobi",price:"15,000,000",propertyType:"apartment",longitude:36.8094,latitude:-1.2681,bedrooms:3,bathrooms:2,area:180,rating:4.6,images:["/src/assets/property-2.jpg","/src/assets/property-3.jpg","/src/assets/property-1.jpg"],amenities:["Swimming Pool","Gym","Security","Parking","Balcony","Modern Kitchen"]},{id:"3",title:"Family Home in Runda",location:"Runda, Nairobi",price:"35,000,000",propertyType:"house",longitude:36.7626,latitude:-1.2176,bedrooms:5,bathrooms:4,area:450,rating:4.9,images:["/src/assets/property-3.jpg","/src/assets/property-1.jpg","/src/assets/property-2.jpg"],amenities:["Swimming Pool","Garden","Security System","Parking","Modern Kitchen","Study Room","Servant Quarters"]},{id:"4",title:"Beachfront Plot in Diani",location:"Diani, Coast",price:"45,000,000",propertyType:"land",longitude:39.5833,latitude:-4.3167,bedrooms:0,bathrooms:0,area:1e3,rating:4.7,images:["/src/assets/property-1.jpg","/src/assets/property-2.jpg"],amenities:["Beach Access","Ocean View","Security","Road Access","Water Connection"]}],d=_=>{s(_)},m=l.find(_=>_.id===e);return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-4",children:" Enhanced Map Demo"}),n.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Experience the enhanced PropertyMap with interactive popups, image carousels, and detailed property information."})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-8",children:[n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsxs($t,{className:"flex items-center space-x-2",children:[n.jsx(Ai,{className:"h-5 w-5 text-blue-500"}),n.jsx("span",{children:"Interactive Property Map"})]})}),n.jsx(at,{className:"p-0",children:n.jsx("div",{className:"h-[600px]",children:n.jsx(wS,{className:"h-full",properties:l.map(_=>({id:_.id,longitude:_.longitude,latitude:_.latitude,title:_.title,price:`KSh ${_.price}`,propertyType:_.propertyType,bedrooms:_.bedrooms,bathrooms:_.bathrooms,area:_.area,images:_.images,amenities:_.amenities,rating:_.rating})),onPinClick:d,onQuickView:_=>{l.find(o=>o.id===_)&&(s(_),console.log("Quick view for property:",_))},selectedPropertyId:e,showMapToggle:!0})})})]})}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Properties on Map"})}),n.jsx(at,{children:n.jsx("div",{className:"space-y-3",children:l.map(_=>n.jsx("div",{className:`p-3 rounded-lg border cursor-pointer transition-all ${e===_.id?"border-blue-500 bg-blue-50":"border-gray-200 hover:border-gray-300"}`,onClick:()=>s(_.id),children:n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("img",{src:_.images[0],alt:_.title,className:"w-16 h-16 rounded object-cover"}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsx("h4",{className:"font-medium text-sm truncate",children:_.title}),n.jsx("p",{className:"text-xs text-muted-foreground mb-1",children:_.location}),n.jsxs("div",{className:"text-sm font-bold text-green-600",children:["KSh ",_.price]}),n.jsxs("div",{className:"flex items-center space-x-3 mt-1 text-xs text-muted-foreground",children:[_.bedrooms>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(nx,{className:"h-3 w-3"}),n.jsx("span",{children:_.bedrooms})]}),_.bathrooms>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(sx,{className:"h-3 w-3"}),n.jsx("span",{children:_.bathrooms})]}),_.area>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(ix,{className:"h-3 w-3"}),n.jsxs("span",{children:[_.area," sqm"]})]})]})]}),n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(lc,{className:"h-3 w-3 fill-yellow-400 text-yellow-400"}),n.jsx("span",{className:"text-xs",children:_.rating})]})]})},_.id))})})]}),m&&n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Selected Property"})}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-3",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium text-sm",children:m.title}),n.jsx("p",{className:"text-xs text-muted-foreground",children:m.location})]}),n.jsxs("div",{className:"text-lg font-bold text-green-600",children:["KSh ",m.price]}),n.jsxs("div",{className:"flex items-center space-x-4 text-xs text-muted-foreground",children:[m.bedrooms>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(nx,{className:"h-3 w-3"}),n.jsx("span",{children:m.bedrooms})]}),m.bathrooms>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(sx,{className:"h-3 w-3"}),n.jsx("span",{children:m.bathrooms})]}),m.area>0&&n.jsxs("div",{className:"flex items-center space-x-1",children:[n.jsx(ix,{className:"h-3 w-3"}),n.jsxs("span",{children:[m.area," sqm"]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Amenities"}),n.jsxs("div",{className:"flex flex-wrap gap-1",children:[m.amenities.slice(0,6).map((_,w)=>n.jsx(ls,{variant:"secondary",className:"text-xs",children:_},w)),m.amenities.length>6&&n.jsxs(ls,{variant:"secondary",className:"text-xs",children:["+",m.amenities.length-6," more"]})]})]}),n.jsxs("div",{children:[n.jsx("h5",{className:"text-xs font-medium text-gray-700 mb-2",children:"Images"}),n.jsx("div",{className:"flex space-x-2 overflow-x-auto",children:m.images.map((_,w)=>n.jsx("img",{src:_,alt:`${m.title} - Image ${w+1}`,className:"w-12 h-12 rounded object-cover flex-shrink-0"},w))})]})]})})]})]})]}),n.jsx("div",{className:"mt-8",children:n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"How to Use the Enhanced Map"})}),n.jsx(at,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:" Interactive Features"}),n.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[n.jsx("li",{children:" Click on any property marker to see detailed popup"}),n.jsx("li",{children:" Navigate through property images using carousel controls"}),n.jsx("li",{children:" View property details, amenities, and stats"}),n.jsx("li",{children:" Switch between map styles (Light, Dark, Satellite)"}),n.jsx("li",{children:" Use navigation controls for zoom and pan"})]})]}),n.jsxs("div",{children:[n.jsx("h4",{className:"font-medium mb-2",children:" Popup Information"}),n.jsxs("ul",{className:"text-sm text-muted-foreground space-y-1",children:[n.jsx("li",{children:" Property title and price"}),n.jsx("li",{children:" Image carousel with navigation"}),n.jsx("li",{children:" Bedrooms, bathrooms, and area"}),n.jsx("li",{children:" Property rating"}),n.jsx("li",{children:" Key amenities (up to 4 shown)"}),n.jsx("li",{children:" Property type and view details link"})]})]})]})})]})})]}),n.jsx(Oi,{})]})},ade=()=>n.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx(_r,{to:"/auth/register",children:n.jsxs(dt,{variant:"ghost",className:"mb-4",children:[n.jsx(Cf,{className:"w-4 h-4 mr-2"}),"Back to Registration"]})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(k5,{className:"w-8 h-8 text-blue-600"}),n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Terms and Conditions"})]}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Last updated: November 3, 2024"})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Terms and Conditions for KejaYangu Kenya"})}),n.jsxs(at,{className:"prose max-w-none",children:[n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"1. Acceptance of Terms"}),n.jsx("p",{className:"text-gray-700 mb-4",children:'By accessing and using KejaYangu Kenya ("the Platform"), you accept and agree to be bound by the terms and provision of this agreement. If you do not agree to abide by the above, please do not use this service.'})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"2. Use License"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"Permission is granted to temporarily access the materials (information or software) on KejaYangu Kenya's platform for personal, non-commercial transitory viewing only. This is the grant of a license, not a transfer of title, and under this license you may not:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"modify or copy the materials"}),n.jsx("li",{children:"use the materials for any commercial purpose or for any public display (commercial or non-commercial)"}),n.jsx("li",{children:"attempt to decompile or reverse engineer any software contained on the platform"}),n.jsx("li",{children:"remove any copyright or other proprietary notations from the materials"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"3. User Accounts"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"When you create an account with us, you must provide information that is accurate, complete, and current at all times. You are responsible for safeguarding the password and for all activities that occur under your account."}),n.jsx("p",{className:"text-gray-700 mb-4",children:"You agree not to disclose your password to any third party. You must notify us immediately upon becoming aware of any breach of security or unauthorized use of your account."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"4. Property Listings"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"KejaYangu Kenya acts as a platform connecting property owners, agents, and buyers/renters. We do not guarantee the accuracy of property listings or the legitimacy of transactions conducted through our platform."}),n.jsx("p",{className:"text-gray-700 mb-4",children:"Users are responsible for verifying all information regarding properties and conducting due diligence before entering into any agreements."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"5. Prohibited Uses"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"You may not use our platform:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"For any unlawful purpose or to solicit others to perform unlawful acts"}),n.jsx("li",{children:"To violate any international, federal, provincial, or state regulations, rules, laws, or local ordinances"}),n.jsx("li",{children:"To infringe upon or violate our intellectual property rights or the intellectual property rights of others"}),n.jsx("li",{children:"To harass, abuse, insult, harm, defame, slander, disparage, intimidate, or discriminate"}),n.jsx("li",{children:"To submit false or misleading information"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"6. Termination"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We may terminate or suspend your account and bar access to the service immediately, without prior notice or liability, under our sole discretion, for any reason whatsoever and without limitation, including but not limited to a breach of the Terms."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"7. Limitation of Liability"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"In no event shall KejaYangu Kenya, nor its directors, employees, partners, agents, suppliers, or affiliates, be liable for any indirect, incidental, special, consequential, or punitive damages, including without limitation, loss of profits, data, use, goodwill, or other intangible losses, resulting from your use of the service."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"8. Governing Law"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"These Terms shall be interpreted and governed by the laws of the Republic of Kenya. Our failure to enforce any right or provision of these Terms will not be considered a waiver of those rights."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"9. Changes to Terms"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We reserve the right, at our sole discretion, to modify or replace these Terms at any time. If a revision is material, we will try to provide at least 30 days notice prior to any new terms taking effect."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"10. Contact Information"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"If you have any questions about these Terms and Conditions, please contact us at:"}),n.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[n.jsx("p",{className:"text-gray-700",children:"Email: legal@kejayangukenya.com"}),n.jsx("p",{className:"text-gray-700",children:"Phone: +254 700 000 000"}),n.jsx("p",{className:"text-gray-700",children:"Address: Nairobi, Kenya"})]})]})]})]})]})}),lde=()=>n.jsx("div",{className:"min-h-screen bg-gray-50 py-12 px-4 sm:px-6 lg:px-8",children:n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx(_r,{to:"/auth/register",children:n.jsxs(dt,{variant:"ghost",className:"mb-4",children:[n.jsx(Cf,{className:"w-4 h-4 mr-2"}),"Back to Registration"]})}),n.jsxs("div",{className:"flex items-center gap-3",children:[n.jsx(ac,{className:"w-8 h-8 text-blue-600"}),n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Privacy Policy"})]}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Last updated: November 3, 2024"})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Privacy Policy for KejaYangu Kenya"})}),n.jsxs(at,{className:"prose max-w-none",children:[n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"1. Information We Collect"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We collect information you provide directly to us, such as when you create an account, use our services, or contact us for support. This may include:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"Name, email address, phone number, and password"}),n.jsx("li",{children:"Profile information and preferences"}),n.jsx("li",{children:"Property search history and saved properties"}),n.jsx("li",{children:"Communication data when you contact us"}),n.jsx("li",{children:"Payment information for transactions"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"2. How We Use Your Information"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We use the information we collect to:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"Provide, maintain, and improve our services"}),n.jsx("li",{children:"Process transactions and send related information"}),n.jsx("li",{children:"Send you technical notices, updates, and support messages"}),n.jsx("li",{children:"Respond to your comments, questions, and requests"}),n.jsx("li",{children:"Communicate with you about products, services, and promotions"}),n.jsx("li",{children:"Monitor and analyze trends and usage"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"3. Information Sharing"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We do not sell, trade, or otherwise transfer your personal information to third parties without your consent, except as described in this policy:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"With service providers who assist us in operating our platform"}),n.jsx("li",{children:"When required by law or to protect our rights"}),n.jsx("li",{children:"In connection with a business transfer or acquisition"}),n.jsx("li",{children:"With your explicit consent"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"4. Data Security"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We implement appropriate technical and organizational measures to protect your personal information against unauthorized access, alteration, disclosure, or destruction. However, no method of transmission over the internet is 100% secure."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"5. Cookies and Tracking"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We use cookies and similar technologies to enhance your experience on our platform. You can control cookie settings through your browser preferences."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"6. Your Rights"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"You have the right to:"}),n.jsxs("ul",{className:"list-disc list-inside text-gray-700 mb-4 space-y-2",children:[n.jsx("li",{children:"Access and update your personal information"}),n.jsx("li",{children:"Request deletion of your data"}),n.jsx("li",{children:"Object to or restrict certain processing"}),n.jsx("li",{children:"Data portability"}),n.jsx("li",{children:"Withdraw consent where applicable"})]})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"7. Data Retention"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"We retain your personal information for as long as necessary to provide our services and fulfill the purposes outlined in this policy, unless a longer retention period is required by law."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"8. International Data Transfers"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"Your information may be transferred to and processed in countries other than Kenya. We ensure appropriate safeguards are in place for such transfers."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"9. Children's Privacy"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"Our services are not intended for children under 18. We do not knowingly collect personal information from children under 18."})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"10. Changes to This Policy"}),n.jsx("p",{className:"text-gray-700 mb-4",children:'We may update this Privacy Policy from time to time. We will notify you of any changes by posting the new policy on this page and updating the "Last updated" date.'})]}),n.jsxs("section",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"11. Contact Us"}),n.jsx("p",{className:"text-gray-700 mb-4",children:"If you have any questions about this Privacy Policy, please contact us at:"}),n.jsxs("div",{className:"bg-gray-50 p-4 rounded-lg",children:[n.jsx("p",{className:"text-gray-700",children:"Email: privacy@kejayangukenya.com"}),n.jsx("p",{className:"text-gray-700",children:"Phone: +254 700 000 000"}),n.jsx("p",{className:"text-gray-700",children:"Address: Nairobi, Kenya"})]})]})]})]})]})}),cde=()=>{const e=()=>{const s=new CustomEvent("openBecomeAgentModal");window.dispatchEvent(s)};return n.jsx("div",{className:"min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100 flex items-center justify-center p-4",children:n.jsxs(ot,{className:"w-full max-w-md",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"mx-auto mb-4 w-16 h-16 bg-red-100 rounded-full flex items-center justify-center",children:n.jsx(nQ,{className:"w-8 h-8 text-red-600"})}),n.jsx($t,{className:"text-2xl font-bold text-gray-900",children:"401 - Unauthorized Access"}),n.jsx(Zs,{className:"text-gray-600",children:"You don't have permission to access this page. This area is restricted to verified agents only."})]}),n.jsxs(at,{className:"space-y-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("p",{className:"text-sm text-gray-500 mb-4",children:"To access the agent dashboard and related features, you need to become a verified agent."}),n.jsxs("div",{className:"flex items-center justify-center space-x-2 text-blue-600 mb-4",children:[n.jsx(_o,{className:"w-5 h-5"}),n.jsx("span",{className:"font-medium",children:"Join our network of professional agents"})]})]}),n.jsxs("div",{className:"space-y-3",children:[n.jsxs(dt,{onClick:e,className:"w-full bg-blue-600 hover:bg-blue-700 text-white",size:"lg",children:[n.jsx(_o,{className:"w-5 h-5 mr-2"}),"Partner With Us",n.jsx(Dg,{className:"w-5 h-5 ml-2"})]}),n.jsx(dt,{variant:"outline",className:"w-full",onClick:()=>window.history.back(),children:"Go Back"})]}),n.jsx("div",{className:"text-center",children:n.jsx("p",{className:"text-xs text-gray-400",children:"By becoming an agent, you'll gain access to property listings, client management, and revenue opportunities."})})]})]})})},ude=({className:e})=>{var w,o;const s=cc(),{user:l,logout:d}=mi(),m=[{title:"Dashboard",path:"/system-admin",icon:ZJ},{title:"User Management",path:"/system-admin/users",icon:_o},...(l==null?void 0:l.role)==="ADMIN"?[{title:"Agent Applications",path:"/system-admin/agents",icon:_o}]:[],{title:"Property Oversight",path:"/system-admin/properties",icon:bo},{title:"Financial Reports",path:"/system-admin/finance",icon:hi},{title:"System Health",path:"/system-admin/health",icon:vf},{title:"Messages",path:"/system-admin/messages",icon:tl},{title:"System Settings",path:"/system-admin/settings",icon:rx}],_=async()=>{await d()};return n.jsxs("div",{className:Ds("flex flex-col h-full bg-white border-r",e),children:[n.jsxs("div",{className:"p-6 border-b",children:[n.jsx("h2",{className:"text-xl font-bold text-gray-900",children:"System Admin"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Administrator Dashboard"})]}),n.jsx("nav",{className:"flex-1 p-4",children:n.jsx("ul",{className:"space-y-2",children:m.map(E=>{const P=s.pathname===E.path;return n.jsx("li",{children:n.jsx(_r,{to:E.path,children:n.jsxs(dt,{variant:P?"default":"ghost",className:Ds("w-full justify-start",P&&"bg-blue-50 text-blue-700 hover:bg-blue-100"),children:[n.jsx(E.icon,{className:"mr-3 h-4 w-4"}),E.title]})})},E.path)})})}),n.jsxs("div",{className:"p-4 border-t",children:[n.jsxs("div",{className:"flex items-center space-x-3 mb-4",children:[n.jsxs(al,{children:[n.jsx(Il,{src:l==null?void 0:l.profilePicture}),n.jsxs(ll,{children:[(w=l==null?void 0:l.firstName)==null?void 0:w[0],(o=l==null?void 0:l.lastName)==null?void 0:o[0]]})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("p",{className:"text-sm font-medium text-gray-900 truncate",children:[l==null?void 0:l.firstName," ",l==null?void 0:l.lastName]}),n.jsx("p",{className:"text-xs text-gray-500 truncate",children:l==null?void 0:l.email}),n.jsx("p",{className:"text-xs font-medium text-blue-600 uppercase",children:l==null?void 0:l.role})]})]}),n.jsxs(dt,{variant:"outline",size:"sm",onClick:_,className:"w-full",children:[n.jsx(LE,{className:"mr-2 h-4 w-4"}),"Logout"]})]})]})},wo=({children:e})=>n.jsxs("div",{className:"flex h-screen bg-gray-50",children:[n.jsx("div",{className:"w-64 flex-shrink-0",children:n.jsx(ude,{})}),n.jsx("div",{className:"flex-1 overflow-auto",children:e})]}),dde=()=>n.jsx(wo,{children:n.jsx(hde,{})}),hde=()=>{const e=[{title:"Total Properties",value:"1,234",description:"Active listings",icon:bo,color:"text-blue-600"},{title:"Total Users",value:"5,678",description:"Registered users",icon:_o,color:"text-green-600"},{title:"Active Agents",value:"156",description:"Verified agents",icon:_o,color:"text-purple-600"},{title:"Revenue",value:"KES 2.4M",description:"This month",icon:hi,color:"text-yellow-600"},{title:"Messages",value:"89",description:"Unread messages",icon:tl,color:"text-red-600"},{title:"System Health",value:"98.5%",description:"Uptime this month",icon:vf,color:"text-green-600"}],s=[{title:"User Management",description:"Manage users and permissions",icon:_o,path:"/system-admin/users",color:"bg-blue-500 hover:bg-blue-600"},{title:"Agent Applications",description:"Review and approve agents",icon:_o,path:"/system-admin/agents",color:"bg-purple-500 hover:bg-purple-600"},{title:"Property Oversight",description:"Monitor and moderate listings",icon:bo,path:"/system-admin/properties",color:"bg-green-500 hover:bg-green-600"},{title:"System Settings",description:"Configure platform settings",icon:rx,path:"/system-admin/settings",color:"bg-gray-500 hover:bg-gray-600"},{title:"Financial Reports",description:"View revenue and analytics",icon:hi,path:"/system-admin/finance",color:"bg-yellow-500 hover:bg-yellow-600"},{title:"System Health",description:"Monitor system performance",icon:vf,path:"/system-admin/health",color:"bg-red-500 hover:bg-red-600"}];return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Administrator Dashboard"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Manage users, agents, properties, and system settings"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 xl:grid-cols-6 gap-6 mb-8",children:e.map((l,d)=>n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row space-x-1 items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:l.title}),n.jsx(l.icon,{className:`h-4 w-4 ${l.color}`})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:l.value}),n.jsx("p",{className:"text-xs text-muted-foreground",children:l.description})]})]},d))}),n.jsxs("div",{className:"mb-8",children:[n.jsx("h2",{className:"text-xl font-semibold mb-4",children:"Quick Actions"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4",children:s.map((l,d)=>n.jsx(_r,{to:l.path,children:n.jsx(ot,{className:"hover:shadow-lg transition-shadow cursor-pointer",children:n.jsx(at,{className:"p-6",children:n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:`p-3 rounded-lg ${l.color} text-white`,children:n.jsx(l.icon,{className:"h-6 w-6"})}),n.jsxs("div",{children:[n.jsx("h3",{className:"font-semibold",children:l.title}),n.jsx("p",{className:"text-sm text-gray-600",children:l.description})]})]})})})},d))})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 xl:grid-cols-3 gap-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"System Status"}),n.jsx(Zs,{children:"Current system health and performance"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Database"}),n.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Healthy"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"API Services"}),n.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Online"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Email Service"}),n.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Active"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"File Storage"}),n.jsx("span",{className:"text-sm text-yellow-600 font-medium",children:"Warning"})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Activity"}),n.jsx(Zs,{children:"Latest system events and user actions"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Agent application approved"}),n.jsx("p",{className:"text-xs text-gray-600",children:"2 hours ago"})]})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"New user registration"}),n.jsx("p",{className:"text-xs text-gray-600",children:"4 hours ago"})]})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Property listing moderated"}),n.jsx("p",{className:"text-xs text-gray-600",children:"6 hours ago"})]})]}),n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"System backup completed"}),n.jsx("p",{className:"text-xs text-gray-600",children:"8 hours ago"})]})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center gap-2",children:[n.jsx(au,{className:"w-5 h-5"}),"System Notifications"]}),n.jsx(Zs,{children:"Important alerts and notifications for administrators"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-red-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"High CPU usage detected"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Server load: 95%"}),n.jsx("p",{className:"text-xs text-gray-500",children:"5 min ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Database backup overdue"}),n.jsx("p",{className:"text-xs text-gray-600",children:"Last backup: 48h ago"}),n.jsx("p",{className:"text-xs text-gray-500",children:"2 hours ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"New agent applications pending"}),n.jsx("p",{className:"text-xs text-gray-600",children:"3 applications waiting"}),n.jsx("p",{className:"text-xs text-gray-500",children:"4 hours ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"System maintenance completed"}),n.jsx("p",{className:"text-xs text-gray-600",children:"All services operational"}),n.jsx("p",{className:"text-xs text-gray-500",children:"6 hours ago"})]})]})]})})]})]})]})},kf=z.forwardRef(({className:e,...s},l)=>n.jsx("div",{className:"relative w-full overflow-auto",children:n.jsx("table",{ref:l,className:Ds("w-full caption-bottom text-sm",e),...s})}));kf.displayName="Table";const Df=z.forwardRef(({className:e,...s},l)=>n.jsx("thead",{ref:l,className:Ds("[&_tr]:border-b",e),...s}));Df.displayName="TableHeader";const Lf=z.forwardRef(({className:e,...s},l)=>n.jsx("tbody",{ref:l,className:Ds("[&_tr:last-child]:border-0",e),...s}));Lf.displayName="TableBody";const pde=z.forwardRef(({className:e,...s},l)=>n.jsx("tfoot",{ref:l,className:Ds("border-t bg-muted/50 font-medium [&>tr]:last:border-b-0",e),...s}));pde.displayName="TableFooter";const cl=z.forwardRef(({className:e,...s},l)=>n.jsx("tr",{ref:l,className:Ds("border-b transition-colors hover:bg-muted/50 data-[state=selected]:bg-muted",e),...s}));cl.displayName="TableRow";const Bn=z.forwardRef(({className:e,...s},l)=>n.jsx("th",{ref:l,className:Ds("h-12 px-4 text-left align-middle font-medium text-muted-foreground [&:has([role=checkbox])]:pr-0",e),...s}));Bn.displayName="TableHead";const Vn=z.forwardRef(({className:e,...s},l)=>n.jsx("td",{ref:l,className:Ds("p-4 align-middle [&:has([role=checkbox])]:pr-0",e),...s}));Vn.displayName="TableCell";const fde=z.forwardRef(({className:e,...s},l)=>n.jsx("caption",{ref:l,className:Ds("mt-4 text-sm text-muted-foreground",e),...s}));fde.displayName="TableCaption";const mde=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState(""),[w,o]=z.useState("ALL"),[E,P]=z.useState(1),[M,L]=z.useState(1),[F,$]=z.useState(0),[Y]=z.useState(10),{toast:H}=Bi(),X=async(oe=E)=>{try{d(!0);const ae={page:oe,limit:Y};w!=="ALL"&&(ae.role=w),m&&(ae.search=m);const Ne=await Ni.users.getAllUsers(ae);s(Ne.data.data),L(Ne.data.pagination.totalPages),$(Ne.data.pagination.totalDocs),P(Ne.data.pagination.page)}catch(ae){console.error("Error fetching users:",ae),H({title:"Error",description:"Failed to fetch users. Please try again.",variant:"destructive"})}finally{d(!1)}};z.useEffect(()=>{X(1),P(1)},[w,m]);const Z=oe=>{oe>=1&&oe<=M&&(P(oe),X(oe))},W=oe=>{switch(oe){case"ADMIN":return n.jsx(ls,{variant:"destructive",children:"Admin"});case"AGENT":return n.jsx(ls,{variant:"secondary",children:"Agent"});default:return n.jsx(ls,{variant:"outline",children:"User"})}},q=(oe,ae)=>oe?ae?n.jsx(ls,{variant:"default",children:"Active"}):n.jsx(ls,{variant:"secondary",children:"Unverified"}):n.jsx(ls,{variant:"destructive",children:"Inactive"});return n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"User Management"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Manage users, agents, and administrators"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Users"}),n.jsx(_o,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:F})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Active Users"}),n.jsx(HA,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:e.filter(oe=>oe.isActive).length})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Agents"}),n.jsx(ac,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:e.filter(oe=>oe.role==="AGENT").length})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Unverified"}),n.jsx(k0,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:e.filter(oe=>!oe.isVerified).length})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(at,{className:"pt-6",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),n.jsx(Es,{placeholder:"Search users...",value:m,onChange:oe=>_(oe.target.value),className:"pl-10"})]})}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsx(Un,{className:"w-full md:w-48",children:n.jsx(Zn,{placeholder:"Filter by role"})}),n.jsxs($n,{children:[n.jsx(it,{value:"ALL",children:"All Roles"}),n.jsx(it,{value:"USER",children:"Users"}),n.jsx(it,{value:"AGENT",children:"Agents"}),n.jsx(it,{value:"ADMIN",children:"Admins"})]})]}),n.jsxs(dt,{variant:"outline",onClick:()=>X(),disabled:l,className:"self-start",children:[n.jsx(Wu,{className:`h-4 w-4 mr-2 ${l?"animate-spin":""}`}),"Refresh"]})]})})}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:["Users (",F,")"]}),n.jsx(Zs,{children:"Manage user accounts and permissions"})]}),n.jsx(at,{children:l?n.jsxs("div",{className:"text-center py-8",children:[n.jsx(Wu,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),n.jsx("p",{children:"Loading users..."})]}):e.length===0?n.jsxs("div",{className:"text-center py-12",children:[n.jsx(_o,{className:"w-12 h-12 text-gray-400 mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-medium text-gray-900 mb-2",children:"No users found"}),n.jsx("p",{className:"text-gray-600",children:m||w!=="ALL"?"No users match your current filters. Try adjusting your search criteria.":"There are no users in the system yet. New users will appear here when they register."})]}):n.jsxs(n.Fragment,{children:[n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Name"}),n.jsx(Bn,{children:"Email"}),n.jsx(Bn,{children:"Phone"}),n.jsx(Bn,{children:"Role"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{children:"Joined"}),n.jsx(Bn,{className:"text-right",children:"Actions"})]})}),n.jsx(Lf,{children:e.map(oe=>n.jsxs(cl,{children:[n.jsxs(Vn,{className:"font-medium",children:[oe.firstName," ",oe.lastName]}),n.jsx(Vn,{children:oe.email}),n.jsx(Vn,{children:oe.phone||"N/A"}),n.jsx(Vn,{children:W(oe.role)}),n.jsx(Vn,{children:q(oe.isActive,oe.isVerified)}),n.jsx(Vn,{children:new Date(oe.createdAt).toLocaleDateString()}),n.jsx(Vn,{className:"text-right",children:n.jsxs(Nx,{children:[n.jsx(Ex,{asChild:!0,children:n.jsx(dt,{variant:"ghost",className:"h-8 w-8 p-0",children:n.jsx(Z2,{className:"h-4 w-4"})})}),n.jsxs(Mf,{align:"end",children:[n.jsx(ti,{children:"View Profile"}),n.jsx(ti,{children:"Edit User"}),n.jsx(ti,{children:"Change Role"}),n.jsx(ti,{className:"text-red-600",children:oe.isActive?"Deactivate":"Activate"})]})]})})]},oe.id))})]}),M>1&&n.jsxs("div",{className:"flex items-center justify-between mt-6",children:[n.jsxs("div",{className:"text-sm text-gray-600",children:["Showing ",(E-1)*Y+1," to"," ",Math.min(E*Y,F)," of"," ",F," users"]}),n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>Z(E-1),disabled:E===1,children:[n.jsx(q2,{className:"h-4 w-4"}),"Previous"]}),n.jsx("div",{className:"flex items-center space-x-1",children:Array.from({length:Math.min(5,M)},(oe,ae)=>{const Ne=Math.max(1,Math.min(M-4,E-2))+ae;return Ne>M?null:n.jsx(dt,{variant:Ne===E?"default":"outline",size:"sm",onClick:()=>Z(Ne),className:"w-8 h-8 p-0",children:Ne},Ne)})}),n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>Z(E+1),disabled:E===M,children:["Next",n.jsx(tv,{className:"h-4 w-4"})]})]})]})]})})]})]})})},gde=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState(""),[w,o]=z.useState("all"),[E,P]=z.useState(null),{toast:M}=Bi();z.useEffect(()=>{L()},[]);const L=async()=>{try{d(!0),s([{id:"1",firstName:"Sarah",lastName:"Kamau",email:"sarah.kamau@example.com",phone:"+254712345678",status:"PENDING",createdAt:"2024-11-05T10:00:00Z",agentProfile:{company:"Kamau Properties Ltd",licenseNumber:"KE-REAL-2024-001",experience:"5 years",specialization:["Residential","Commercial"]}},{id:"2",firstName:"David",lastName:"Njenga",email:"david.njenga@example.com",phone:"+254723456789",status:"APPROVED",createdAt:"2024-11-04T14:30:00Z",agentProfile:{company:"Njenga Real Estate",licenseNumber:"KE-REAL-2024-002",experience:"8 years",specialization:["Luxury Homes","Land"]}}])}catch(X){console.error("Error fetching applications:",X),M({title:"Error",description:"Failed to load agent applications",variant:"destructive"})}finally{d(!1)}},F=async(X,Z)=>{try{s(W=>W.map(q=>q.id===X?{...q,status:Z}:q)),M({title:"Success",description:`Application ${Z.toLowerCase()} successfully`})}catch{M({title:"Error",description:"Failed to update application status",variant:"destructive"})}},$=X=>{switch(X){case"PENDING":return n.jsxs(ls,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[n.jsx(Ko,{className:"w-3 h-3 mr-1"}),"Pending"]});case"APPROVED":return n.jsxs(ls,{variant:"secondary",className:"bg-green-100 text-green-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Approved"]});case"REJECTED":return n.jsxs(ls,{variant:"secondary",className:"bg-red-100 text-red-800",children:[n.jsx(tu,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return n.jsx(ls,{variant:"secondary",children:X})}},Y=e.filter(X=>{const Z=`${X.firstName} ${X.lastName} ${X.email}`.toLowerCase().includes(m.toLowerCase()),W=w==="all"||X.status===w;return Z&&W}),H={total:e.length,pending:e.filter(X=>X.status==="PENDING").length,approved:e.filter(X=>X.status==="APPROVED").length,rejected:e.filter(X=>X.status==="REJECTED").length};return l?n.jsx(wo,{children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"animate-pulse space-y-6",children:[n.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:Array.from({length:4}).map((X,Z)=>n.jsx("div",{className:"h-24 bg-gray-200 rounded"},Z))}),n.jsx("div",{className:"h-96 bg-gray-200 rounded"})]})})}):n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Agent Applications"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Review and manage agent registration applications"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Applications"}),n.jsx(_o,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:H.total})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Review"}),n.jsx(Ko,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:H.pending})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Approved"}),n.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold text-green-600",children:H.approved})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Rejected"}),n.jsx(tu,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold text-red-600",children:H.rejected})})]})]}),n.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 mb-6",children:[n.jsxs("div",{className:"relative flex-1",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),n.jsx(Es,{placeholder:"Search applications...",value:m,onChange:X=>_(X.target.value),className:"pl-10"})]}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsxs(Un,{className:"w-full sm:w-48",children:[n.jsx(wx,{className:"h-4 w-4 mr-2"}),n.jsx(Zn,{placeholder:"Filter by status"})]}),n.jsxs($n,{children:[n.jsx(it,{value:"all",children:"All Status"}),n.jsx(it,{value:"PENDING",children:"Pending"}),n.jsx(it,{value:"APPROVED",children:"Approved"}),n.jsx(it,{value:"REJECTED",children:"Rejected"})]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Applications"}),n.jsx(Zs,{children:"Review and manage agent applications"})]}),n.jsxs(at,{children:[n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Applicant"}),n.jsx(Bn,{children:"Contact"}),n.jsx(Bn,{children:"Company"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{children:"Applied Date"}),n.jsx(Bn,{children:"Actions"})]})}),n.jsx(Lf,{children:Y.map(X=>{var Z;return n.jsxs(cl,{children:[n.jsx(Vn,{children:n.jsxs("div",{className:"font-medium",children:[X.firstName," ",X.lastName]})}),n.jsxs(Vn,{children:[n.jsx("div",{className:"text-sm text-gray-600",children:X.email}),n.jsx("div",{className:"text-sm text-gray-600",children:X.phone})]}),n.jsx(Vn,{children:((Z=X.agentProfile)==null?void 0:Z.company)||"N/A"}),n.jsx(Vn,{children:$(X.status)}),n.jsx(Vn,{children:new Date(X.createdAt).toLocaleDateString()}),n.jsx(Vn,{children:n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsxs(oS,{children:[n.jsx(Ase,{asChild:!0,children:n.jsxs(dt,{variant:"outline",size:"sm",onClick:()=>P(X),children:[n.jsx(pi,{className:"h-4 w-4 mr-1"}),"View"]})}),n.jsxs(av,{className:"max-w-2xl",children:[n.jsxs(lv,{children:[n.jsx(cv,{children:"Application Details"}),n.jsx(uv,{children:"Review the agent application details"})]}),E&&n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Full Name"}),n.jsxs("p",{children:[E.firstName," ",E.lastName]})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Email"}),n.jsx("p",{children:E.email})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Phone"}),n.jsx("p",{children:E.phone})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Status"}),n.jsx("div",{children:$(E.status)})]})]}),E.agentProfile&&n.jsxs("div",{className:"space-y-4",children:[n.jsx("h4",{className:"font-medium",children:"Agent Profile"}),n.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Company"}),n.jsx("p",{children:E.agentProfile.company})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"License Number"}),n.jsx("p",{children:E.agentProfile.licenseNumber})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Experience"}),n.jsx("p",{children:E.agentProfile.experience})]}),n.jsxs("div",{children:[n.jsx("label",{className:"text-sm font-medium",children:"Specialization"}),n.jsx("p",{children:E.agentProfile.specialization.join(", ")})]})]})]}),E.status==="PENDING"&&n.jsxs("div",{className:"flex space-x-2 pt-4",children:[n.jsxs(dt,{onClick:()=>F(E.id,"APPROVED"),className:"bg-green-600 hover:bg-green-700",children:[n.jsx(HA,{className:"h-4 w-4 mr-1"}),"Approve"]}),n.jsxs(dt,{onClick:()=>F(E.id,"REJECTED"),variant:"destructive",children:[n.jsx(k0,{className:"h-4 w-4 mr-1"}),"Reject"]})]})]})]})]}),X.status==="PENDING"&&n.jsxs(n.Fragment,{children:[n.jsx(dt,{variant:"outline",size:"sm",onClick:()=>F(X.id,"APPROVED"),className:"text-green-600 hover:text-green-700",children:n.jsx(dr,{className:"h-4 w-4"})}),n.jsx(dt,{variant:"outline",size:"sm",onClick:()=>F(X.id,"REJECTED"),className:"text-red-600 hover:text-red-700",children:n.jsx(tu,{className:"h-4 w-4"})})]})]})})]},X.id)})})]}),Y.length===0&&n.jsx("div",{className:"text-center py-8 text-gray-500",children:"No applications found matching your criteria."})]})]})]})})},xde=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState(""),[w,o]=z.useState("ALL");z.useEffect(()=>{s([{id:"1",title:"Modern Family Home in Westlands",propertyType:"HOUSE",listingType:"SALE",price:25e6,city:"Nairobi",status:"ACTIVE",isVerified:!0,isPremium:!0,views:245,ownerName:"John Kamau",createdAt:"2024-10-15"},{id:"2",title:"Luxury Apartment in Kilimani",propertyType:"APARTMENT",listingType:"RENT",price:85e3,city:"Nairobi",status:"PENDING",isVerified:!1,isPremium:!1,views:89,ownerName:"Grace Wanjiku",createdAt:"2024-11-01"},{id:"3",title:"Commercial Office Space",propertyType:"COMMERCIAL",listingType:"SALE",price:45e6,city:"Mombasa",status:"ACTIVE",isVerified:!0,isPremium:!1,views:156,ownerName:"Peter Ochieng",createdAt:"2024-09-20"},{id:"4",title:"Student Hostel in Westlands",propertyType:"STUDENT_HOSTEL",listingType:"RENT",price:12e3,city:"Nairobi",status:"INACTIVE",isVerified:!0,isPremium:!0,views:78,ownerName:"Mary Njeri",createdAt:"2024-08-10"}]),d(!1)},[]);const E=e.filter(F=>{const $=F.title.toLowerCase().includes(m.toLowerCase())||F.ownerName.toLowerCase().includes(m.toLowerCase())||F.city.toLowerCase().includes(m.toLowerCase()),Y=w==="ALL"||F.status===w;return $&&Y}),P=F=>{switch(F){case"ACTIVE":return n.jsxs(ls,{variant:"default",className:"bg-green-100 text-green-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Active"]});case"PENDING":return n.jsxs(ls,{variant:"secondary",children:[n.jsx(ed,{className:"w-3 h-3 mr-1"}),"Pending"]});case"INACTIVE":return n.jsxs(ls,{variant:"destructive",children:[n.jsx(tu,{className:"w-3 h-3 mr-1"}),"Inactive"]});default:return n.jsx(ls,{variant:"outline",children:F})}},M=(F,$)=>{const Y=new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(F);return $==="RENT"?`${Y}/month`:Y},L={total:e.length,active:e.filter(F=>F.status==="ACTIVE").length,pending:e.filter(F=>F.status==="PENDING").length,inactive:e.filter(F=>F.status==="INACTIVE").length,premium:e.filter(F=>F.isPremium).length,verified:e.filter(F=>F.isVerified).length};return n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Property Oversight"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor and manage property listings"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 lg:grid-cols-6 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Properties"}),n.jsx(bo,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.total})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Active"}),n.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.active})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Review"}),n.jsx(ed,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.pending})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Premium"}),n.jsx(bo,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.premium})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Verified"}),n.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.verified})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Inactive"}),n.jsx(tu,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:L.inactive})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(at,{className:"pt-6",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4",children:[n.jsx("div",{className:"flex-1",children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-3 h-4 w-4 text-gray-400"}),n.jsx(Es,{placeholder:"Search properties...",value:m,onChange:F=>_(F.target.value),className:"pl-10"})]})}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsx(Un,{className:"w-full md:w-48",children:n.jsx(Zn,{placeholder:"Filter by status"})}),n.jsxs($n,{children:[n.jsx(it,{value:"ALL",children:"All Properties"}),n.jsx(it,{value:"ACTIVE",children:"Active"}),n.jsx(it,{value:"PENDING",children:"Pending"}),n.jsx(it,{value:"INACTIVE",children:"Inactive"})]})]})]})})}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:["Properties (",E.length,")"]}),n.jsx(Zs,{children:"Manage property listings and monitor performance"})]}),n.jsx(at,{children:l?n.jsx("div",{className:"text-center py-8",children:"Loading properties..."}):n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Property"}),n.jsx(Bn,{children:"Type"}),n.jsx(Bn,{children:"Price"}),n.jsx(Bn,{children:"Location"}),n.jsx(Bn,{children:"Owner"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{children:"Views"}),n.jsx(Bn,{className:"text-right",children:"Actions"})]})}),n.jsx(Lf,{children:E.map(F=>n.jsxs(cl,{children:[n.jsx(Vn,{children:n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:F.title}),n.jsxs("div",{className:"text-sm text-gray-500",children:[F.listingType,"  ",F.propertyType]})]})}),n.jsx(Vn,{children:n.jsx(ls,{variant:"outline",children:F.propertyType})}),n.jsx(Vn,{className:"font-medium",children:M(F.price,F.listingType)}),n.jsx(Vn,{children:F.city}),n.jsx(Vn,{children:F.ownerName}),n.jsx(Vn,{children:P(F.status)}),n.jsx(Vn,{children:F.views}),n.jsx(Vn,{className:"text-right",children:n.jsxs(Nx,{children:[n.jsx(Ex,{asChild:!0,children:n.jsx(dt,{variant:"ghost",className:"h-8 w-8 p-0",children:n.jsx(Z2,{className:"h-4 w-4"})})}),n.jsxs(Mf,{align:"end",children:[n.jsxs(ti,{children:[n.jsx(pi,{className:"w-4 h-4 mr-2"}),"View Details"]}),n.jsxs(ti,{children:[n.jsx(B5,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),n.jsxs(ti,{className:"text-red-600",children:[n.jsx(ox,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},F.id))})]})})]})]})})},yde=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState("30d");z.useEffect(()=>{s([{id:"1",type:"REVENUE",amount:25e4,description:"Premium listing fee - Modern Family Home",user:"John Kamau",date:"2024-11-01",status:"COMPLETED",method:"MPESA"},{id:"2",type:"REVENUE",amount:15e4,description:"Agent commission - Apartment sale",user:"Grace Wanjiku",date:"2024-10-30",status:"COMPLETED",method:"BANK_TRANSFER"},{id:"3",type:"EXPENSE",amount:-5e4,description:"Server maintenance costs",user:"System",date:"2024-10-28",status:"COMPLETED",method:"BANK_TRANSFER"},{id:"4",type:"REVENUE",amount:75e3,description:"Ad revenue - Property impressions",user:"System",date:"2024-10-25",status:"PENDING",method:"STRIPE"}]),d(!1)},[]);const w={totalRevenue:425e4,monthlyRevenue:125e4,totalExpenses:15e4,netProfit:41e5,pendingPayments:75e3,transactions:e.length},o=M=>new Intl.NumberFormat("en-KE",{style:"currency",currency:"KES",minimumFractionDigits:0}).format(M),E=M=>{switch(M){case"COMPLETED":return n.jsx(ls,{variant:"default",className:"bg-green-100 text-green-800",children:"Completed"});case"PENDING":return n.jsx(ls,{variant:"secondary",children:"Pending"});case"FAILED":return n.jsx(ls,{variant:"destructive",children:"Failed"});default:return n.jsx(ls,{variant:"outline",children:M})}},P=(M,L)=>M==="REVENUE"?n.jsxs(ls,{variant:"default",className:"bg-green-100 text-green-800",children:[n.jsx(Ei,{className:"w-3 h-3 mr-1"}),"Revenue"]}):n.jsxs(ls,{variant:"destructive",children:[n.jsx(zE,{className:"w-3 h-3 mr-1"}),"Expense"]});return n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Financial Reports"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor revenue, expenses, and financial performance"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Revenue"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:o(w.totalRevenue)}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:[n.jsx("span",{className:"text-green-600",children:"+12.5%"})," from last month"]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Monthly Revenue"}),n.jsx(Ei,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:o(w.monthlyRevenue)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Current month"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Net Profit"}),n.jsx(vf,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:o(w.netProfit)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"After expenses"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Payments"}),n.jsx(BJ,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:o(w.pendingPayments)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting processing"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Revenue Sources"}),n.jsx(Zs,{children:"Breakdown by category"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Premium Listings"}),n.jsx("span",{className:"font-medium",children:o(21e5)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Agent Commissions"}),n.jsx("span",{className:"font-medium",children:o(15e5)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Ad Revenue"}),n.jsx("span",{className:"font-medium",children:o(5e5)})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Other"}),n.jsx("span",{className:"font-medium",children:o(15e4)})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Payment Methods"}),n.jsx(Zs,{children:"Distribution of payment types"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"M-Pesa"}),n.jsx("span",{className:"font-medium",children:"65%"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Bank Transfer"}),n.jsx("span",{className:"font-medium",children:"25%"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Card Payment"}),n.jsx("span",{className:"font-medium",children:"8%"})]}),n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsx("span",{className:"text-sm",children:"Cash"}),n.jsx("span",{className:"font-medium",children:"2%"})]})]})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(at,{className:"pt-6",children:n.jsxs("div",{className:"flex flex-col md:flex-row gap-4 items-center justify-between",children:[n.jsxs("div",{children:[n.jsx("h3",{className:"text-lg font-medium",children:"Transaction History"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Recent financial transactions"})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"7d",children:"Last 7 days"}),n.jsx(it,{value:"30d",children:"Last 30 days"}),n.jsx(it,{value:"90d",children:"Last 90 days"}),n.jsx(it,{value:"1y",children:"Last year"})]})]}),n.jsxs(dt,{variant:"outline",children:[n.jsx(Jw,{className:"w-4 h-4 mr-2"}),"Export"]})]})]})})}),n.jsx(ot,{children:n.jsx(at,{className:"pt-6",children:l?n.jsx("div",{className:"text-center py-8",children:"Loading transactions..."}):n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Type"}),n.jsx(Bn,{children:"Description"}),n.jsx(Bn,{children:"User"}),n.jsx(Bn,{children:"Amount"}),n.jsx(Bn,{children:"Method"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{children:"Date"})]})}),n.jsx(Lf,{children:e.map(M=>n.jsxs(cl,{children:[n.jsx(Vn,{children:P(M.type,M.amount)}),n.jsx(Vn,{className:"max-w-xs truncate",children:M.description}),n.jsx(Vn,{children:M.user}),n.jsx(Vn,{className:`font-medium ${M.amount<0?"text-red-600":"text-green-600"}`,children:o(M.amount)}),n.jsx(Vn,{children:n.jsx(ls,{variant:"outline",children:M.method})}),n.jsx(Vn,{children:E(M.status)}),n.jsx(Vn,{children:M.date})]},M.id))})]})})})]})})},_de=()=>{var o,E,P,M,L,F,$,Y,H,X,Z,W,q,oe;const[e,s]=z.useState({overall:{status:"HEALTHY",uptime:"15 days, 8 hours",responseTime:"245ms",lastChecked:new Date().toISOString()},services:[],metrics:{cpu:0,memory:0,disk:0,network:0},alerts:[]}),[l,d]=z.useState(!0);z.useEffect(()=>{const ae={overall:{status:"HEALTHY",uptime:"15 days, 8 hours",responseTime:"245ms",lastChecked:new Date().toISOString()},services:[{name:"API Server",status:"HEALTHY",uptime:"99.8%",responseTime:"145ms",lastChecked:"2 minutes ago",icon:sQ},{name:"Database",status:"HEALTHY",uptime:"99.9%",responseTime:"23ms",lastChecked:"1 minute ago",icon:VJ},{name:"Email Service",status:"HEALTHY",uptime:"98.5%",responseTime:"890ms",lastChecked:"5 minutes ago",icon:il},{name:"File Storage",status:"WARNING",uptime:"97.2%",responseTime:"1250ms",lastChecked:"3 minutes ago",icon:OJ}],metrics:{cpu:45,memory:68,disk:72,network:23},alerts:[{id:"1",type:"WARNING",message:"File storage response time is above threshold",timestamp:"2024-11-02T10:30:00Z",resolved:!1},{id:"2",type:"INFO",message:"Database backup completed successfully",timestamp:"2024-11-02T06:00:00Z",resolved:!0}]};s(ae),d(!1)},[]);const m=ae=>{switch(ae){case"HEALTHY":return n.jsxs(ls,{variant:"default",className:"bg-green-100 text-green-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Healthy"]});case"WARNING":return n.jsxs(ls,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[n.jsx(ed,{className:"w-3 h-3 mr-1"}),"Warning"]});case"CRITICAL":return n.jsxs(ls,{variant:"destructive",children:[n.jsx(tu,{className:"w-3 h-3 mr-1"}),"Critical"]});default:return n.jsx(ls,{variant:"outline",children:ae})}},_=ae=>{switch(ae){case"CRITICAL":return n.jsx(ls,{variant:"destructive",children:ae});case"WARNING":return n.jsx(ls,{variant:"secondary",children:ae});case"INFO":return n.jsx(ls,{variant:"outline",children:ae});default:return n.jsx(ls,{variant:"outline",children:ae})}},w=()=>{d(!0),setTimeout(()=>{d(!1)},2e3)};return l?n.jsx(wo,{children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"text-center py-12",children:[n.jsx(Wu,{className:"w-8 h-8 animate-spin mx-auto mb-4"}),n.jsx("p",{children:"Loading system health..."})]})})}):n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"System Health"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Monitor system performance and service status"})]}),n.jsxs(dt,{onClick:w,disabled:l,children:[n.jsx(Wu,{className:`w-4 h-4 mr-2 ${l?"animate-spin":""}`}),"Refresh"]})]}),n.jsxs(ot,{className:"mb-8",children:[n.jsxs(Ut,{children:[n.jsxs($t,{className:"flex items-center gap-2",children:[n.jsx(kg,{className:"w-5 h-5"}),"Overall System Status"]}),n.jsx(Zs,{children:"Current health status of the entire platform"})]}),n.jsx(at,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:[n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"mb-2",children:m((o=e.overall)==null?void 0:o.status)}),n.jsx("p",{className:"text-sm text-gray-600",children:"System Status"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(E=e.overall)==null?void 0:E.uptime}),n.jsx("p",{className:"text-sm text-gray-600",children:"Uptime"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-2xl font-bold text-gray-900",children:(P=e.overall)==null?void 0:P.responseTime}),n.jsx("p",{className:"text-sm text-gray-600",children:"Avg Response Time"})]}),n.jsxs("div",{className:"text-center",children:[n.jsx("div",{className:"text-lg font-medium text-gray-900",children:"Last checked"}),n.jsx("p",{className:"text-sm text-gray-600",children:(M=e.overall)!=null&&M.lastChecked?new Date(e.overall.lastChecked).toLocaleTimeString():"N/A"})]})]})})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:(L=e.services)==null?void 0:L.map((ae,Ne)=>n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsxs($t,{className:"text-sm font-medium flex items-center gap-2",children:[n.jsx(ae.icon,{className:"w-4 h-4"}),ae.name]}),m(ae.status)]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Uptime:"}),n.jsx("span",{className:"font-medium",children:ae.uptime})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Response Time:"}),n.jsx("span",{className:"font-medium",children:ae.responseTime})]}),n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{children:"Last Checked:"}),n.jsx("span",{className:"font-medium",children:ae.lastChecked})]})]})})]},Ne))}),n.jsxs(ot,{className:"mb-8",children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"System Metrics"}),n.jsx(Zs,{children:"Current resource utilization"})]}),n.jsx(at,{children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6",children:[n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-sm font-medium flex items-center gap-2",children:[n.jsx(FJ,{className:"w-4 h-4"}),"CPU Usage"]}),n.jsxs("span",{className:"text-sm text-gray-600",children:[(F=e.metrics)==null?void 0:F.cpu,"%"]})]}),n.jsx(xh,{value:($=e.metrics)==null?void 0:$.cpu,className:"h-2"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-sm font-medium flex items-center gap-2",children:[n.jsx(kg,{className:"w-4 h-4"}),"Memory Usage"]}),n.jsxs("span",{className:"text-sm text-gray-600",children:[(Y=e.metrics)==null?void 0:Y.memory,"%"]})]}),n.jsx(xh,{value:(H=e.metrics)==null?void 0:H.memory,className:"h-2"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-sm font-medium flex items-center gap-2",children:[n.jsx(GJ,{className:"w-4 h-4"}),"Disk Usage"]}),n.jsxs("span",{className:"text-sm text-gray-600",children:[(X=e.metrics)==null?void 0:X.disk,"%"]})]}),n.jsx(xh,{value:(Z=e.metrics)==null?void 0:Z.disk,className:"h-2"})]}),n.jsxs("div",{children:[n.jsxs("div",{className:"flex items-center justify-between mb-2",children:[n.jsxs("span",{className:"text-sm font-medium flex items-center gap-2",children:[n.jsx(uQ,{className:"w-4 h-4"}),"Network I/O"]}),n.jsxs("span",{className:"text-sm text-gray-600",children:[(W=e.metrics)==null?void 0:W.network,"%"]})]}),n.jsx(xh,{value:(q=e.metrics)==null?void 0:q.network,className:"h-2"})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"System Alerts"}),n.jsx(Zs,{children:"Recent system events and notifications"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:(oe=e.alerts)==null?void 0:oe.map(ae=>n.jsxs("div",{className:"flex items-start space-x-4 p-4 border rounded-lg",children:[n.jsx("div",{className:"flex-shrink-0",children:_(ae.type)}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:ae.message}),n.jsx("p",{className:"text-xs text-gray-600",children:new Date(ae.timestamp).toLocaleString()})]}),n.jsx("div",{className:"flex-shrink-0",children:ae.resolved?n.jsxs(ls,{variant:"outline",className:"text-green-600",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Resolved"]}):n.jsxs(ls,{variant:"outline",className:"text-orange-600",children:[n.jsx(ed,{className:"w-3 h-3 mr-1"}),"Active"]})})]},ae.id))})})]})]})})},vde=()=>n.jsx(wo,{children:n.jsx(bde,{})}),bde=()=>{var o,E;const[e,s]=z.useState(null),[l,d]=z.useState(""),m=[{id:1,user:{name:"John Doe",email:"john@example.com",avatar:""},lastMessage:"I'm interested in the property...",timestamp:"2 hours ago",unread:!0},{id:2,user:{name:"Jane Smith",email:"jane@example.com",avatar:""},lastMessage:"When can we schedule a viewing?",timestamp:"1 day ago",unread:!1},{id:3,user:{name:"Bob Johnson",email:"bob@example.com",avatar:""},lastMessage:"Thank you for the information",timestamp:"2 days ago",unread:!1}],_=[{id:1,sender:"user",content:"Hi, I'm interested in the 3-bedroom apartment in Westlands.",timestamp:"2 hours ago"},{id:2,sender:"admin",content:"Hello! Thank you for your interest. The property is still available.",timestamp:"2 hours ago"},{id:3,sender:"user",content:"Great! Can we schedule a viewing for tomorrow?",timestamp:"1 hour ago"}],w=()=>{l.trim()&&(console.log("Sending message:",l),d(""))};return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-6",children:[n.jsxs(_r,{to:"/admin",className:"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[n.jsx(Cf,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Messages"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your conversations"})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-3 gap-6",children:[n.jsx("div",{className:"lg:col-span-1",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Conversations"}),n.jsx(Zs,{children:"All your message threads"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:m.map(P=>n.jsx("div",{className:`p-4 rounded-lg cursor-pointer transition-colors ${e===P.id?"bg-blue-50 border-blue-200":"hover:bg-gray-50"}`,onClick:()=>s(P.id),children:n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsxs(al,{children:[n.jsx(Il,{src:P.user.avatar}),n.jsx(ll,{children:P.user.name.split(" ").map(M=>M[0]).join("")})]}),n.jsxs("div",{className:"flex-1 min-w-0",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("p",{className:"text-sm font-medium text-gray-900 truncate",children:P.user.name}),P.unread&&n.jsx(ls,{variant:"destructive",className:"text-xs",children:"New"})]}),n.jsx("p",{className:"text-sm text-gray-500 truncate",children:P.lastMessage}),n.jsx("p",{className:"text-xs text-gray-400",children:P.timestamp})]})]})},P.id))})})]})}),n.jsx("div",{className:"lg:col-span-2",children:n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:e?(o=m.find(P=>P.id===e))==null?void 0:o.user.name:"Select a conversation"}),n.jsx(Zs,{children:e?(E=m.find(P=>P.id===e))==null?void 0:E.user.email:"Choose a conversation from the list"})]}),n.jsx(at,{children:e?n.jsxs("div",{className:"space-y-4",children:[n.jsx("div",{className:"space-y-4 max-h-96 overflow-y-auto",children:_.map(P=>n.jsx("div",{className:`flex ${P.sender==="admin"?"justify-end":"justify-start"}`,children:n.jsxs("div",{className:`max-w-xs lg:max-w-md px-4 py-2 rounded-lg ${P.sender==="admin"?"bg-blue-500 text-white":"bg-gray-200 text-gray-900"}`,children:[n.jsx("p",{className:"text-sm",children:P.content}),n.jsx("p",{className:`text-xs mt-1 ${P.sender==="admin"?"text-blue-100":"text-gray-500"}`,children:P.timestamp})]})},P.id))}),n.jsxs("div",{className:"flex space-x-2",children:[n.jsx(Af,{value:l,onChange:P=>d(P.target.value),placeholder:"Type your message...",className:"flex-1",rows:3}),n.jsx(dt,{onClick:w,className:"self-end",children:n.jsx(K2,{className:"h-4 w-4"})})]})]}):n.jsx("div",{className:"text-center py-8 text-gray-500",children:n.jsx("p",{children:"Select a conversation to view messages"})})})]})})]})]})},wde=()=>n.jsx(wo,{children:n.jsx(Sde,{})}),Sde=()=>{const[e,s]=z.useState({siteName:"Keja Yangu Kenya",siteDescription:"Find your dream home in Kenya",contactEmail:"admin@kejayangu.co.ke",contactPhone:"+254 700 000 000",currency:"KES",defaultLanguage:"en",maintenanceMode:!1,emailNotifications:!0,smsNotifications:!1,maxFileSize:"10",allowedFileTypes:"jpg,jpeg,png,pdf",commissionRate:"5",featuredListingPrice:"1000",premiumListingPrice:"2500"}),l=(m,_)=>{s(w=>({...w,[m]:_}))},d=()=>{console.log("Saving settings:",e)};return n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-6",children:[n.jsxs(_r,{to:"/admin",className:"inline-flex items-center text-blue-600 hover:text-blue-800 mb-4",children:[n.jsx(Cf,{className:"h-4 w-4 mr-2"}),"Back to Dashboard"]}),n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Settings"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Configure system settings and preferences"})]}),n.jsxs("div",{className:"space-y-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"General Settings"}),n.jsx(Zs,{children:"Basic site configuration"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"siteName",children:"Site Name"}),n.jsx(Es,{id:"siteName",value:e.siteName,onChange:m=>l("siteName",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"contactEmail",children:"Contact Email"}),n.jsx(Es,{id:"contactEmail",type:"email",value:e.contactEmail,onChange:m=>l("contactEmail",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"contactPhone",children:"Contact Phone"}),n.jsx(Es,{id:"contactPhone",value:e.contactPhone,onChange:m=>l("contactPhone",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"currency",children:"Default Currency"}),n.jsxs(qn,{value:e.currency,onValueChange:m=>l("currency",m),children:[n.jsx(Un,{children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"KES",children:"KES - Kenyan Shilling"}),n.jsx(it,{value:"USD",children:"USD - US Dollar"}),n.jsx(it,{value:"EUR",children:"EUR - Euro"})]})]})]})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"siteDescription",children:"Site Description"}),n.jsx(Af,{id:"siteDescription",value:e.siteDescription,onChange:m=>l("siteDescription",m.target.value),rows:3})]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Notification Settings"}),n.jsx(Zs,{children:"Configure notification preferences"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Email Notifications"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Send email notifications for important events"})]}),n.jsx(Bu,{checked:e.emailNotifications,onCheckedChange:m=>l("emailNotifications",m)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"SMS Notifications"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Send SMS notifications for urgent matters"})]}),n.jsx(Bu,{checked:e.smsNotifications,onCheckedChange:m=>l("smsNotifications",m)})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"space-y-0.5",children:[n.jsx(ds,{children:"Maintenance Mode"}),n.jsx("p",{className:"text-sm text-gray-600",children:"Put the site in maintenance mode"})]}),n.jsx(Bu,{checked:e.maintenanceMode,onCheckedChange:m=>l("maintenanceMode",m)})]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"File Upload Settings"}),n.jsx(Zs,{children:"Configure file upload restrictions"})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"maxFileSize",children:"Max File Size (MB)"}),n.jsx(Es,{id:"maxFileSize",type:"number",value:e.maxFileSize,onChange:m=>l("maxFileSize",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"allowedFileTypes",children:"Allowed File Types"}),n.jsx(Es,{id:"allowedFileTypes",value:e.allowedFileTypes,onChange:m=>l("allowedFileTypes",m.target.value),placeholder:"jpg,jpeg,png,pdf"})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Pricing Settings"}),n.jsx(Zs,{children:"Configure pricing and commission rates"})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"commissionRate",children:"Commission Rate (%)"}),n.jsx(Es,{id:"commissionRate",type:"number",value:e.commissionRate,onChange:m=>l("commissionRate",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"featuredListingPrice",children:"Featured Listing (KES)"}),n.jsx(Es,{id:"featuredListingPrice",type:"number",value:e.featuredListingPrice,onChange:m=>l("featuredListingPrice",m.target.value)})]}),n.jsxs("div",{className:"space-y-2",children:[n.jsx(ds,{htmlFor:"premiumListingPrice",children:"Premium Listing (KES)"}),n.jsx(Es,{id:"premiumListingPrice",type:"number",value:e.premiumListingPrice,onChange:m=>l("premiumListingPrice",m.target.value)})]})]})})]}),n.jsx("div",{className:"flex justify-end",children:n.jsxs(dt,{onClick:d,children:[n.jsx(GA,{className:"h-4 w-4 mr-2"}),"Save Settings"]})})]})]})},jde=()=>{const[e,s]=z.useState(1),[l,d]=z.useState(!1),[m,_]=z.useState({firstName:"",lastName:"",email:"",phone:"",location:"",experience:"",specialization:"",licenseNumber:"",company:"",bio:"",idDocument:null,licenseDocument:null,certifications:[],agreeToTerms:!1,agreeToBackgroundCheck:!1});mi();const w=[{number:1,title:"Personal Information",description:"Basic details about yourself"},{number:2,title:"Professional Background",description:"Your real estate experience"},{number:3,title:"Documents & Verification",description:"Upload required documents"},{number:4,title:"Review & Submit",description:"Review your application"}],o=($,Y)=>{_(H=>({...H,[$]:Y}))},E=($,Y)=>{_(H=>({...H,[$]:Y}))},P=$=>{_(Y=>({...Y,certifications:Y.certifications.includes($)?Y.certifications.filter(H=>H!==$):[...Y.certifications,$]}))},M=async()=>{const Y=["firstName","lastName","email","phone","location","experience","specialization","bio"].filter(H=>!m[H]);if(Y.length>0){_g({title:"Missing information",description:`Please fill in: ${Y.join(", ")}`,variant:"destructive"});return}if(!m.agreeToTerms||!m.agreeToBackgroundCheck){_g({title:"Agreement required",description:"Please agree to the terms and background check.",variant:"destructive"});return}d(!0);try{let H=null,X=null;m.idDocument&&(H=(await Ni.upload.uploadDocument(m.idDocument,"agent-documents")).data.data.url),m.licenseDocument&&(X=(await Ni.upload.uploadDocument(m.licenseDocument,"agent-documents")).data.data.url);const Z={firstName:m.firstName,lastName:m.lastName,email:m.email,phone:m.phone,location:m.location,experience:m.experience,specialization:m.specialization,licenseNumber:m.licenseNumber,company:m.company,bio:m.bio,idDocument:H,licenseDocument:X,certifications:m.certifications};await Ni.agents.apply(Z),_g({title:"Application submitted!",description:"Your agent application has been submitted for review. We'll contact you within 3-5 business days."}),_({firstName:"",lastName:"",email:"",phone:"",location:"",experience:"",specialization:"",licenseNumber:"",company:"",bio:"",idDocument:null,licenseDocument:null,certifications:[],agreeToTerms:!1,agreeToBackgroundCheck:!1}),s(1)}catch(H){console.error("Application error:",H),_g({title:"Application failed",description:"There was an error submitting your application. Please try again.",variant:"destructive"})}finally{d(!1)}},L=[{icon:n.jsx(Ei,{className:"h-6 w-6"}),title:"Commission Earnings",description:"Earn competitive commissions on property sales and rentals"},{icon:n.jsx(_o,{className:"h-6 w-6"}),title:"Client Network",description:"Access to a large database of verified buyers and sellers"},{icon:n.jsx(Rh,{className:"h-6 w-6"}),title:"Professional Development",description:"Training programs and certification opportunities"},{icon:n.jsx(ac,{className:"h-6 w-6"}),title:"Platform Support",description:"Marketing tools, CRM system, and dedicated support"}],F=["Valid real estate license (where required)","Minimum 2 years of real estate experience","Clean background check","Professional liability insurance","Strong communication and negotiation skills","Commitment to ethical practices"];return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Become a KejaYangu Agent"}),n.jsx("p",{className:"text-muted-foreground text-lg max-w-2xl mx-auto",children:"Join Kenya's leading property platform and grow your real estate career with us"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12",children:L.map(($,Y)=>n.jsx(ot,{className:"text-center",children:n.jsxs(Ut,{children:[n.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:n.jsx("div",{className:"text-primary",children:$.icon})}),n.jsx($t,{className:"text-lg",children:$.title}),n.jsx(Zs,{children:$.description})]})},Y))}),n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsx("div",{className:"mb-8",children:n.jsx("div",{className:"flex items-center justify-between",children:w.map(($,Y)=>n.jsxs("div",{className:"flex items-center",children:[n.jsx("div",{className:`flex items-center justify-center w-10 h-10 rounded-full border-2 ${e>=$.number?"bg-primary border-primary text-primary-foreground":"border-muted-foreground text-muted-foreground"}`,children:$.number}),n.jsxs("div",{className:"ml-4 hidden sm:block",children:[n.jsx("p",{className:`font-medium ${e>=$.number?"text-primary":"text-muted-foreground"}`,children:$.title}),n.jsx("p",{className:"text-sm text-muted-foreground",children:$.description})]}),Y<w.length-1&&n.jsx("div",{className:`w-12 h-0.5 mx-4 ${e>$.number?"bg-primary":"bg-muted"}`})]},$.number))})}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:["Step ",e,": ",w[e-1].title]}),n.jsx(Zs,{children:w[e-1].description})]}),n.jsxs(at,{className:"space-y-6",children:[e===1&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"firstName",children:"First Name *"}),n.jsx(Es,{id:"firstName",placeholder:"Enter your first name",value:m.firstName,onChange:$=>o("firstName",$.target.value)})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"lastName",children:"Last Name *"}),n.jsx(Es,{id:"lastName",placeholder:"Enter your last name",value:m.lastName,onChange:$=>o("lastName",$.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"email",children:"Email Address *"}),n.jsxs("div",{className:"relative",children:[n.jsx(il,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{id:"email",type:"email",placeholder:"your.email@example.com",className:"pl-10",value:m.email,onChange:$=>o("email",$.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"phone",children:"Phone Number *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Uh,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{id:"phone",placeholder:"+254 XXX XXX XXX",className:"pl-10",value:m.phone,onChange:$=>o("phone",$.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"location",children:"Location/City *"}),n.jsxs("div",{className:"relative",children:[n.jsx(Ai,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{id:"location",placeholder:"e.g., Nairobi, Kenya",className:"pl-10",value:m.location,onChange:$=>o("location",$.target.value)})]})]})]}),e===2&&n.jsxs(n.Fragment,{children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"experience",children:"Years of Experience *"}),n.jsxs(qn,{value:m.experience,onValueChange:$=>o("experience",$),children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Select your experience level"})}),n.jsxs($n,{children:[n.jsx(it,{value:"0-2",children:"0-2 years"}),n.jsx(it,{value:"3-5",children:"3-5 years"}),n.jsx(it,{value:"6-10",children:"6-10 years"}),n.jsx(it,{value:"10+",children:"10+ years"})]})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"specialization",children:"Specialization *"}),n.jsxs(qn,{value:m.specialization,onValueChange:$=>o("specialization",$),children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Select your specialization"})}),n.jsxs($n,{children:[n.jsx(it,{value:"residential",children:"Residential Properties"}),n.jsx(it,{value:"commercial",children:"Commercial Properties"}),n.jsx(it,{value:"land",children:"Land & Plots"}),n.jsx(it,{value:"luxury",children:"Luxury Properties"}),n.jsx(it,{value:"rental",children:"Rental Properties"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"licenseNumber",children:"License Number"}),n.jsx(Es,{id:"licenseNumber",placeholder:"Your real estate license number",value:m.licenseNumber,onChange:$=>o("licenseNumber",$.target.value)})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"company",children:"Company/Agency"}),n.jsx(Es,{id:"company",placeholder:"Current company or agency",value:m.company,onChange:$=>o("company",$.target.value)})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"bio",children:"Professional Bio *"}),n.jsx(Af,{id:"bio",placeholder:"Tell us about your experience, achievements, and why you want to join KejaYangu...",rows:4,value:m.bio,onChange:$=>o("bio",$.target.value)})]}),n.jsxs("div",{children:[n.jsx(ds,{children:"Certifications (Optional)"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-2 mt-2",children:["Certified Residential Specialist","Certified Commercial Investment Member","Accredited Buyer's Representative","Certified Property Manager","Certified International Property Specialist","Certified Luxury Home Marketing Specialist"].map($=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(sl,{id:$,checked:m.certifications.includes($),onCheckedChange:()=>P($)}),n.jsx(ds,{htmlFor:$,className:"text-sm",children:$})]},$))})]})]}),e===3&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx(ds,{children:"Identity Document *"}),n.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center",children:[n.jsx(k5,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Upload a copy of your National ID or Passport"}),n.jsx(Es,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:$=>{var Y;return E("idDocument",((Y=$.target.files)==null?void 0:Y[0])||null)},className:"max-w-xs mx-auto"}),m.idDocument&&n.jsxs("p",{className:"text-sm text-green-600 mt-2",children:[" ",m.idDocument.name]})]})]}),n.jsxs("div",{children:[n.jsx(ds,{children:"Real Estate License (if applicable)"}),n.jsxs("div",{className:"border-2 border-dashed border-muted-foreground/25 rounded-lg p-6 text-center",children:[n.jsx(Rh,{className:"h-8 w-8 text-muted-foreground mx-auto mb-2"}),n.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Upload a copy of your real estate license"}),n.jsx(Es,{type:"file",accept:".pdf,.jpg,.jpeg,.png",onChange:$=>{var Y;return E("licenseDocument",((Y=$.target.files)==null?void 0:Y[0])||null)},className:"max-w-xs mx-auto"}),m.licenseDocument&&n.jsxs("p",{className:"text-sm text-green-600 mt-2",children:[" ",m.licenseDocument.name]})]})]}),n.jsxs("div",{className:"bg-blue-50 border border-blue-200 rounded-lg p-4",children:[n.jsx("h4",{className:"font-medium text-blue-900 mb-2",children:"Document Requirements"}),n.jsxs("ul",{className:"text-sm text-blue-800 space-y-1",children:[n.jsx("li",{children:" Clear, readable copies of documents"}),n.jsx("li",{children:" PDF, JPG, PNG formats accepted"}),n.jsx("li",{children:" Maximum file size: 10MB per document"}),n.jsx("li",{children:" Documents will be verified during background check"})]})]})]}),e===4&&n.jsxs("div",{className:"space-y-6",children:[n.jsxs("div",{className:"bg-muted/50 rounded-lg p-6",children:[n.jsx("h3",{className:"font-medium mb-4",children:"Application Summary"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4 text-sm",children:[n.jsxs("div",{children:[n.jsx("strong",{children:"Name:"})," ",m.firstName," ",m.lastName]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Email:"})," ",m.email]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Phone:"})," ",m.phone]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Location:"})," ",m.location]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Experience:"})," ",m.experience]}),n.jsxs("div",{children:[n.jsx("strong",{children:"Specialization:"})," ",m.specialization]})]})]}),n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(sl,{id:"terms",checked:m.agreeToTerms,onCheckedChange:$=>o("agreeToTerms",$?"true":"false")}),n.jsxs(ds,{htmlFor:"terms",className:"text-sm",children:["I agree to the"," ",n.jsx("a",{href:"#",className:"text-primary underline",children:"Terms of Service"})," ","and",n.jsx("a",{href:"#",className:"text-primary underline ml-1",children:"Agent Agreement"})]})]}),n.jsxs("div",{className:"flex items-start space-x-2",children:[n.jsx(sl,{id:"background",checked:m.agreeToBackgroundCheck,onCheckedChange:$=>o("agreeToBackgroundCheck",$?"true":"false")}),n.jsx(ds,{htmlFor:"background",className:"text-sm",children:"I consent to a background check and verification of my credentials"})]})]}),n.jsxs("div",{className:"bg-green-50 border border-green-200 rounded-lg p-4",children:[n.jsxs("h4",{className:"font-medium text-green-900 mb-2 flex items-center",children:[n.jsx(Ko,{className:"h-4 w-4 mr-2"}),"What happens next?"]}),n.jsxs("ul",{className:"text-sm text-green-800 space-y-1",children:[n.jsx("li",{children:" Application review: 3-5 business days"}),n.jsx("li",{children:" Background check: 5-7 business days"}),n.jsx("li",{children:" Interview scheduling (if approved)"}),n.jsx("li",{children:" Training and onboarding (if successful)"})]})]})]}),n.jsx($u,{}),n.jsxs("div",{className:"flex justify-between",children:[n.jsx(dt,{variant:"outline",onClick:()=>s(Math.max(1,e-1)),disabled:e===1,children:"Previous"}),e<4?n.jsx(dt,{onClick:()=>s(Math.min(4,e+1)),children:"Next Step"}):n.jsx(dt,{onClick:M,disabled:l,className:"bg-primary hover:bg-primary/90",children:l?"Submitting...":"Submit Application"})]})]})]})]}),n.jsxs("div",{className:"mt-16",children:[n.jsxs("div",{className:"text-center mb-8",children:[n.jsx("h2",{className:"text-3xl font-bold mb-2",children:"Agent Requirements"}),n.jsx("p",{className:"text-muted-foreground",children:"What we look for in our agents"})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:F.map(($,Y)=>n.jsx(ot,{children:n.jsxs(at,{className:"flex items-center space-x-3 p-6",children:[n.jsx(dr,{className:"h-5 w-5 text-green-600 flex-shrink-0"}),n.jsx("span",{className:"text-sm",children:$})]})},Y))})]})]}),n.jsx(Oi,{})]})},Tde=()=>{const e=Xr(),{toast:s}=Bi(),[l,d]=z.useState(!1),[m,_]=z.useState([]),[w,o]=z.useState({title:"",description:"",price:"",propertyType:"",listingType:"",bedrooms:"",bathrooms:"",area:"",city:"",county:"",address:"",latitude:"",longitude:"",features:[],amenities:[]}),E=["APARTMENT","HOUSE","CONDO","TOWNHOUSE","VILLA","LAND","COMMERCIAL"],P=["SALE","RENT"],M=["Parking","Garden","Balcony","Terrace","Swimming Pool","Gym","Security","Elevator"],L=["WiFi","Air Conditioning","Heating","Dishwasher","Washing Machine","Dryer","Microwave","Oven"],F=(W,q)=>{o(oe=>({...oe,[W]:q}))},$=W=>{o(q=>({...q,features:q.features.includes(W)?q.features.filter(oe=>oe!==W):[...q.features,W]}))},Y=W=>{o(q=>({...q,amenities:q.amenities.includes(W)?q.amenities.filter(oe=>oe!==W):[...q.amenities,W]}))},H=W=>{const oe=Array.from(W.target.files).map(ae=>({file:ae,preview:URL.createObjectURL(ae)}));_(ae=>[...ae,...oe])},X=W=>{_(q=>q.filter((oe,ae)=>ae!==W))},Z=async W=>{var q,oe,ae,Ne;if(W.preventDefault(),!w.title||!w.description||!w.price||!w.propertyType||!w.listingType||!w.city||!w.county||!w.latitude||!w.longitude){s({title:"Validation Error",description:"Please fill in all required fields.",variant:"destructive"});return}d(!0);try{const Pe={title:w.title,description:w.description,price:parseFloat(w.price),propertyType:w.propertyType,listingType:w.listingType,bedrooms:w.bedrooms?parseInt(w.bedrooms):null,bathrooms:w.bathrooms?parseInt(w.bathrooms):null,areaSize:w.area?parseFloat(w.area):null,city:w.city,county:w.county,address:w.address,latitude:parseFloat(w.latitude),longitude:parseFloat(w.longitude),features:w.features,amenities:w.amenities,slug:w.title.toLowerCase().replace(/[^a-z0-9]+/g,"-").replace(/^-+|-+$/g,""),status:"ACTIVE"};let Le=[];if(console.log(`Starting upload of ${m.length} images`),m.length>0)try{const yt=m.map(Dt=>Dt.file);console.log(`Uploading ${yt.length} images:`,yt.map((Dt,wt)=>({index:wt+1,fileName:Dt.name,fileSize:Dt.size,fileType:Dt.type}))),console.log("Sending files to /images endpoint");const Ht=await Ni.upload.uploadImages(yt);console.log("Multiple upload response:",Ht),Ht.data&&Array.isArray(Ht.data.data)?(Le=Ht.data.data.map((Dt,wt)=>({url:Dt.url,caption:"",isPrimary:wt===0,order:wt})),console.log("Processed uploadedImages array:",Le)):console.error("Unexpected response format:",Ht.data)}catch(yt){console.error("Error uploading images:",yt),console.error("Error response:",(q=yt.response)==null?void 0:q.data);return}if(console.log(`Upload complete. Successfully uploaded ${Le.length}/${m.length} images`),Le.length===0&&m.length>0){s({title:"Upload Error",description:"Failed to upload images. Please try again.",variant:"destructive"});return}const ct={...Pe,...Le.length>0&&{images:{create:Le}}};console.log("Property data being sent:",ct);const xt=await Ni.properties.create(ct);s({title:"Success",description:"Property added successfully!"}),e("/agent/dashboard")}catch(Pe){console.error("Error creating property:",Pe),console.error("Error response:",(oe=Pe.response)==null?void 0:oe.data),s({title:"Error",description:((Ne=(ae=Pe.response)==null?void 0:ae.data)==null?void 0:Ne.message)||"Failed to add property. Please try again.",variant:"destructive"})}finally{d(!1)}};return n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsx("main",{className:"container mx-auto px-4 py-8",children:n.jsxs("div",{className:"max-w-4xl mx-auto",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold mb-2",children:"Add New Property"}),n.jsx("p",{className:"text-muted-foreground",children:"Fill in the details below to list your property"})]}),n.jsxs("form",{onSubmit:Z,className:"space-y-8",children:[n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Basic Information"})}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"title",children:"Property Title *"}),n.jsx(Es,{id:"title",value:w.title,onChange:W=>F("title",W.target.value),placeholder:"e.g., Modern 3BR Apartment in Westlands",required:!0})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"propertyType",children:"Property Type *"}),n.jsxs(qn,{value:w.propertyType,onValueChange:W=>F("propertyType",W),children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Select property type"})}),n.jsx($n,{children:E.map(W=>n.jsx(it,{value:W,children:W.charAt(0)+W.slice(1).toLowerCase()},W))})]})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"description",children:"Description *"}),n.jsx(Af,{id:"description",value:w.description,onChange:W=>F("description",W.target.value),placeholder:"Describe your property...",rows:4,required:!0})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"listingType",children:"Listing Type *"}),n.jsxs(qn,{value:w.listingType,onValueChange:W=>F("listingType",W),children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"For sale or rent"})}),n.jsx($n,{children:P.map(W=>n.jsx(it,{value:W,children:W},W))})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"price",children:"Price (KES) *"}),n.jsx(Es,{id:"price",type:"number",value:w.price,onChange:W=>F("price",W.target.value),placeholder:"e.g., 5000000",required:!0})]})]})]})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Property Details"})}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"bedrooms",children:"Bedrooms"}),n.jsx(Es,{id:"bedrooms",type:"number",value:w.bedrooms,onChange:W=>F("bedrooms",W.target.value),placeholder:"e.g., 3"})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"bathrooms",children:"Bathrooms"}),n.jsx(Es,{id:"bathrooms",type:"number",value:w.bathrooms,onChange:W=>F("bathrooms",W.target.value),placeholder:"e.g., 2"})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"area",children:"Area (sq ft)"}),n.jsx(Es,{id:"area",type:"number",value:w.area,onChange:W=>F("area",W.target.value),placeholder:"e.g., 1200"})]})]})})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Location"})}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"city",children:"City *"}),n.jsx(Es,{id:"city",value:w.city,onChange:W=>F("city",W.target.value),placeholder:"e.g., Nairobi",required:!0})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"county",children:"County *"}),n.jsx(Es,{id:"county",value:w.county,onChange:W=>F("county",W.target.value),placeholder:"e.g., Nairobi",required:!0})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"address",children:"Full Address"}),n.jsx(Es,{id:"address",value:w.address,onChange:W=>F("address",W.target.value),placeholder:"Street address, building, etc."})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"latitude",children:"Latitude *"}),n.jsx(Es,{id:"latitude",type:"number",step:"any",value:w.latitude,onChange:W=>F("latitude",W.target.value),placeholder:"e.g., -1.2864",required:!0})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"longitude",children:"Longitude *"}),n.jsx(Es,{id:"longitude",type:"number",step:"any",value:w.longitude,onChange:W=>F("longitude",W.target.value),placeholder:"e.g., 36.8172",required:!0})]})]})]})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Features & Amenities"})}),n.jsxs(at,{className:"space-y-6",children:[n.jsxs("div",{children:[n.jsx(ds,{className:"text-base font-medium",children:"Features"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-2",children:M.map(W=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(sl,{id:`feature-${W}`,checked:w.features.includes(W),onCheckedChange:()=>$(W)}),n.jsx(ds,{htmlFor:`feature-${W}`,className:"text-sm",children:W})]},W))})]}),n.jsxs("div",{children:[n.jsx(ds,{className:"text-base font-medium",children:"Amenities"}),n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-3 mt-2",children:L.map(W=>n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx(sl,{id:`amenity-${W}`,checked:w.amenities.includes(W),onCheckedChange:()=>Y(W)}),n.jsx(ds,{htmlFor:`amenity-${W}`,className:"text-sm",children:W})]},W))})]})]})]}),n.jsxs(ot,{children:[n.jsx(Ut,{children:n.jsx($t,{children:"Property Images"})}),n.jsxs(at,{className:"space-y-4",children:[n.jsx("div",{className:"border-2 border-dashed border-gray-300 rounded-lg p-6",children:n.jsxs("div",{className:"text-center",children:[n.jsx(V5,{className:"mx-auto h-12 w-12 text-gray-400"}),n.jsxs("div",{className:"mt-4",children:[n.jsxs(ds,{htmlFor:"image-upload",className:"cursor-pointer",children:[n.jsx("span",{className:"text-sm font-medium text-primary hover:text-primary/80",children:"Upload images"}),n.jsx("input",{id:"image-upload",type:"file",multiple:!0,accept:"image/*",onChange:H,className:"hidden"})]}),n.jsx("p",{className:"text-xs text-muted-foreground mt-1",children:"PNG, JPG up to 10MB each"})]})]})}),m.length>0&&n.jsx("div",{className:"grid grid-cols-2 md:grid-cols-4 gap-4",children:m.map((W,q)=>n.jsxs("div",{className:"relative",children:[n.jsx("img",{src:W.preview,alt:`Property ${q+1}`,className:"w-full h-24 object-cover rounded-lg"}),n.jsx(dt,{type:"button",variant:"destructive",size:"sm",className:"absolute -top-2 -right-2 h-6 w-6 p-0",onClick:()=>X(q),children:n.jsx(ol,{className:"h-3 w-3"})})]},q))})]})]}),n.jsxs("div",{className:"flex justify-end space-x-4",children:[n.jsx(dt,{type:"button",variant:"outline",onClick:()=>e("/agent/dashboard"),children:"Cancel"}),n.jsx(dt,{type:"submit",disabled:l,children:l?"Adding Property...":"Add Property"})]})]})]})}),n.jsx(Oi,{})]})},Nde=()=>{const[e,s]=z.useState(""),[l,d]=z.useState(""),[m,_]=z.useState(""),[w,o]=z.useState([]),[E,P]=z.useState(!0),[M,L]=z.useState(null),{toast:F}=Bi();return z.useEffect(()=>{(async()=>{try{P(!0);const Y=await Ni.agents.getAll({search:e,city:l,specialization:m,limit:20});o(Y.data.data||[])}catch(Y){console.error("Error fetching agents:",Y),L("Failed to load agents. Please try again."),F({title:"Error",description:"Failed to load agents. Please try again.",variant:"destructive"})}finally{P(!1)}})()},[e,l,m,F]),n.jsxs("div",{className:"min-h-screen bg-background",children:[n.jsx(zi,{}),n.jsxs("main",{className:"container mx-auto px-4 py-8",children:[n.jsxs("div",{className:"mb-8 text-center",children:[n.jsx("h1",{className:"text-4xl font-bold mb-2",children:"Find Real Estate Agents"}),n.jsx("p",{className:"text-muted-foreground text-lg",children:"Connect with experienced agents who know the Kenyan market"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-12",children:[n.jsx(ot,{className:"text-center",children:n.jsxs(Ut,{children:[n.jsx("div",{className:"mx-auto w-12 h-12 bg-primary/10 rounded-full flex items-center justify-center mb-4",children:n.jsx(_o,{className:"h-6 w-6 text-primary"})}),n.jsx($t,{children:"500+ Agents"}),n.jsx(Zs,{children:"Verified real estate professionals across Kenya"})]})}),n.jsx(ot,{className:"text-center",children:n.jsxs(Ut,{children:[n.jsx("div",{className:"mx-auto w-12 h-12 bg-secondary/10 rounded-full flex items-center justify-center mb-4",children:n.jsx(Rh,{className:"h-6 w-6 text-secondary"})}),n.jsx($t,{children:"Expert Knowledge"}),n.jsx(Zs,{children:"Local market expertise and professional certifications"})]})}),n.jsx(ot,{className:"text-center",children:n.jsxs(Ut,{children:[n.jsx("div",{className:"mx-auto w-12 h-12 bg-tertiary/10 rounded-full flex items-center justify-center mb-4",children:n.jsx(Ei,{className:"h-6 w-6 text-tertiary"})}),n.jsx($t,{children:"Proven Results"}),n.jsx(Zs,{children:"Track record of successful property transactions"})]})})]}),n.jsx("div",{className:"bg-card border rounded-lg p-6 mb-8",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsx("div",{children:n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-muted-foreground h-4 w-4"}),n.jsx(Es,{placeholder:"Search by name or company...",value:e,onChange:$=>s($.target.value),className:"pl-10"})]})}),n.jsxs(qn,{value:l,onValueChange:d,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Location"})}),n.jsxs($n,{children:[n.jsx(it,{value:"nairobi",children:"Nairobi"}),n.jsx(it,{value:"mombasa",children:"Mombasa"}),n.jsx(it,{value:"kisumu",children:"Kisumu"}),n.jsx(it,{value:"nakuru",children:"Nakuru"}),n.jsx(it,{value:"eldoret",children:"Eldoret"})]})]}),n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Specialization"})}),n.jsxs($n,{children:[n.jsx(it,{value:"luxury",children:"Luxury Homes"}),n.jsx(it,{value:"commercial",children:"Commercial"}),n.jsx(it,{value:"residential",children:"Residential"}),n.jsx(it,{value:"investment",children:"Investment Properties"}),n.jsx(it,{value:"rentals",children:"Rentals"})]})]}),n.jsx(dt,{className:"bg-primary hover:bg-primary/90",children:"Search Agents"})]})}),n.jsxs("div",{className:"flex items-center justify-between mb-6",children:[n.jsxs("div",{className:"flex items-center gap-2",children:[E?n.jsx(ls,{variant:"secondary",children:"Loading agents..."}):M?n.jsx(ls,{variant:"destructive",children:"Error loading agents"}):n.jsxs(ls,{variant:"secondary",children:[w.length," agents found"]}),n.jsx("span",{className:"text-muted-foreground",children:"in your area"})]}),n.jsxs(qn,{defaultValue:"rating",children:[n.jsx(Un,{className:"w-48",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"rating",children:"Highest Rated"}),n.jsx(it,{value:"experience",children:"Most Experienced"}),n.jsx(it,{value:"sales",children:"Most Sales"}),n.jsx(it,{value:"reviews",children:"Most Reviews"})]})]})]}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6 mb-12",children:E?Array.from({length:6}).map(($,Y)=>n.jsxs(ot,{className:"hover:shadow-lg transition-shadow",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsx("div",{className:"w-20 h-20 mx-auto mb-4 bg-gray-200 rounded-full animate-pulse"}),n.jsx("div",{className:"h-6 bg-gray-200 rounded animate-pulse mb-2"}),n.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse mb-2"}),n.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),n.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"}),n.jsx("div",{className:"h-4 bg-gray-200 rounded animate-pulse"})]})]},Y)):M?n.jsxs("div",{className:"col-span-full text-center py-12",children:[n.jsx("p",{className:"text-muted-foreground mb-4",children:M}),n.jsx(dt,{onClick:()=>window.location.reload(),children:"Try Again"})]}):w.length===0?n.jsx("div",{className:"col-span-full text-center py-12",children:n.jsxs("div",{className:"max-w-md mx-auto",children:[n.jsx(_o,{className:"h-16 w-16 text-muted-foreground mx-auto mb-4"}),n.jsx("h3",{className:"text-lg font-semibold mb-2",children:"No Agents Available"}),n.jsx("p",{className:"text-muted-foreground mb-6",children:"There are currently no approved agents in our network. Check back later or consider becoming an agent yourself."}),n.jsx(dt,{onClick:()=>window.open("/become-agent","_blank"),children:"Become an Agent"})]})}):w.map($=>{var Y,H,X,Z,W;return n.jsxs(ot,{className:"hover:shadow-lg transition-shadow",children:[n.jsxs(Ut,{className:"text-center",children:[n.jsxs(al,{className:"w-20 h-20 mx-auto mb-4",children:[n.jsx(Il,{src:$.avatar,alt:`${$.firstName} ${$.lastName}`}),n.jsx(ll,{children:`${((Y=$.firstName)==null?void 0:Y[0])||""}${((H=$.lastName)==null?void 0:H[0])||""}`})]}),n.jsx($t,{className:"text-xl",children:`${$.firstName} ${$.lastName}`}),n.jsx(Zs,{children:"Real Estate Agent"}),((X=$.agentProfile)==null?void 0:X.company)&&n.jsx("p",{className:"text-sm font-medium text-primary",children:$.agentProfile.company}),((Z=$.agentProfile)==null?void 0:Z.isVerified)&&n.jsxs("div",{className:"flex items-center justify-center gap-1 mt-2",children:[n.jsx(Rh,{className:"h-4 w-4 text-green-500"}),n.jsx("span",{className:"text-sm text-green-600 font-medium",children:"Verified Agent"})]})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center gap-2 text-sm",children:[n.jsx(Ai,{className:"h-4 w-4 text-muted-foreground"}),n.jsx("span",{children:"Nairobi, Kenya"})," "]}),$.agentProfile&&n.jsxs(n.Fragment,{children:[n.jsx("div",{className:"space-y-2",children:n.jsxs("div",{className:"flex justify-between text-sm",children:[n.jsx("span",{className:"text-muted-foreground",children:"Experience:"}),n.jsxs("span",{className:"font-medium",children:[$.agentProfile.experience," years"]})]})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Specializations:"}),n.jsx("div",{className:"flex flex-wrap gap-1",children:((W=$.agentProfile.specializations)==null?void 0:W.map(q=>n.jsx(ls,{variant:"outline",className:"text-xs",children:q},q)))||n.jsx("span",{className:"text-sm text-muted-foreground",children:"Not specified"})})]}),$.agentProfile.languages&&n.jsxs("div",{children:[n.jsx("p",{className:"text-sm text-muted-foreground mb-2",children:"Languages:"}),n.jsx("p",{className:"text-sm",children:$.agentProfile.languages.join(", ")})]})]}),n.jsxs("div",{className:"grid grid-cols-3 gap-2 pt-4",children:[n.jsx(dt,{variant:"outline",size:"sm",onClick:()=>window.open(`tel:${$.phone}`),children:n.jsx(Uh,{className:"h-4 w-4"})}),n.jsx(dt,{variant:"outline",size:"sm",onClick:()=>window.open(`mailto:${$.email}`),children:n.jsx(il,{className:"h-4 w-4"})}),n.jsx(dt,{variant:"outline",size:"sm",children:n.jsx(sv,{className:"h-4 w-4"})})]}),n.jsx(dt,{className:"w-full bg-primary hover:bg-primary/90",children:"View Profile"})]})]},$.id)})}),n.jsx(ot,{className:"bg-gradient-to-r from-primary/10 to-secondary/10 border-none",children:n.jsxs(at,{className:"text-center py-12",children:[n.jsx("h3",{className:"text-2xl font-bold mb-4",children:"Are you a Real Estate Agent?"}),n.jsx("p",{className:"text-muted-foreground mb-6 max-w-2xl mx-auto",children:"Join KejaYangu and connect with thousands of potential clients. Build your professional profile and grow your business."}),n.jsx(dt,{size:"lg",className:"bg-primary hover:bg-primary/90",children:"Join as an Agent"})]})})]}),n.jsx(Oi,{})]})},CN=()=>{const[e,s]=z.useState(null),[l,d]=z.useState(!0),{toast:m}=Bi(),{user:_}=mi(),w=Xr();return z.useEffect(()=>{const o=async()=>{var E,P;try{d(!0);const[M,L]=await Promise.allSettled([((P=(E=Ni.properties).getAll)==null?void 0:P.call(E,{agentId:_==null?void 0:_.id,limit:1e3}))||Promise.resolve({data:{data:[],pagination:{totalDocs:0}}}),Promise.resolve({data:{totalEarnings:0,monthlyEarnings:0}})]),F=M.status==="fulfilled"?M.value.data.data:[],$={totalProperties:F.length,activeProperties:F.filter(Y=>Y.status==="ACTIVE").length,pendingProperties:F.filter(Y=>Y.status==="PENDING").length,soldProperties:F.filter(Y=>Y.status==="SOLD").length,totalViews:F.reduce((Y,H)=>Y+(H.views||0),0),totalEarnings:L.status==="fulfilled"?L.value.data.totalEarnings:0,monthlyEarnings:L.status==="fulfilled"?L.value.data.monthlyEarnings:0,monthlyGrowth:8.5};s($)}catch(M){console.error("Error fetching dashboard stats:",M),m({title:"Error",description:"Failed to load dashboard statistics",variant:"destructive"})}finally{d(!1)}};_!=null&&_.id&&o()},[m,_==null?void 0:_.id]),l?n.jsx(wo,{children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"animate-pulse space-y-6",children:[n.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:Array.from({length:8}).map((o,E)=>n.jsx("div",{className:"h-32 bg-gray-200 rounded"},E))})]})})}):n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Agent Dashboard"}),n.jsxs("p",{className:"text-gray-600 mt-2",children:["Welcome back, ",_==null?void 0:_.firstName,"! Here's your property portfolio overview."]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Properties"}),n.jsx(Ya,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:(e==null?void 0:e.totalProperties)||0}),n.jsxs("p",{className:"text-xs text-muted-foreground",children:[(e==null?void 0:e.activeProperties)||0," active listings"]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Views"}),n.jsx(pi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:(e==null?void 0:e.totalViews)||0}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Across all your properties"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Monthly Earnings"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsxs("div",{className:"text-2xl font-bold",children:["KES ",((e==null?void 0:e.monthlyEarnings)||0).toLocaleString()]}),n.jsxs("p",{className:"text-xs text-green-600",children:["+",(e==null?void 0:e.monthlyGrowth)||0,"% from last month"]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Success Rate"}),n.jsx(Ei,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsxs("div",{className:"text-2xl font-bold",children:[(e==null?void 0:e.totalProperties)>0?Math.round(e.soldProperties/e.totalProperties*100):0,"%"]}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Properties sold/rented"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Active Listings"}),n.jsx(dr,{className:"h-4 w-4 text-green-600"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold text-green-600",children:(e==null?void 0:e.activeProperties)||0}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Currently live on platform"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Approval"}),n.jsx(Ko,{className:"h-4 w-4 text-yellow-600"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold text-yellow-600",children:(e==null?void 0:e.pendingProperties)||0}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Awaiting admin review"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Sold/Rented"}),n.jsx(kg,{className:"h-4 w-4 text-blue-600"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold text-blue-600",children:(e==null?void 0:e.soldProperties)||0}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Successfully closed deals"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Quick Actions"}),n.jsx(Zs,{children:"Common agent tasks"})]}),n.jsx(at,{className:"space-y-4",children:n.jsxs("div",{className:"grid grid-cols-1 gap-4",children:[n.jsxs(dt,{onClick:()=>w("/add-property"),className:"p-4 h-auto justify-start",variant:"outline",children:[n.jsx(z5,{className:"h-6 w-6 text-blue-600 mr-3"}),n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-medium",children:"Add New Property"}),n.jsx("div",{className:"text-sm text-gray-500",children:"List a new property for sale or rent"})]})]}),n.jsxs(dt,{onClick:()=>w("/agent/properties"),className:"p-4 h-auto justify-start",variant:"outline",children:[n.jsx(Ya,{className:"h-6 w-6 text-green-600 mr-3"}),n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-medium",children:"Manage Properties"}),n.jsx("div",{className:"text-sm text-gray-500",children:"View and edit your property listings"})]})]}),n.jsxs(dt,{onClick:()=>w("/agent/finance"),className:"p-4 h-auto justify-start",variant:"outline",children:[n.jsx(vf,{className:"h-6 w-6 text-orange-600 mr-3"}),n.jsxs("div",{className:"text-left",children:[n.jsx("div",{className:"font-medium",children:"View Earnings"}),n.jsx("div",{className:"text-sm text-gray-500",children:"Check your commission and payouts"})]})]})]})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Activity"}),n.jsx(Zs,{children:"Your latest property activities"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-green-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"New property listed"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Modern 3BR Apartment in Westlands"}),n.jsx("p",{className:"text-xs text-gray-400",children:"2 hours ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Property viewed"}),n.jsx("p",{className:"text-xs text-gray-500",children:"5-bedroom villa received 15 views"}),n.jsx("p",{className:"text-xs text-gray-400",children:"4 hours ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-yellow-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Inquiry received"}),n.jsx("p",{className:"text-xs text-gray-500",children:"New inquiry for commercial space"}),n.jsx("p",{className:"text-xs text-gray-400",children:"6 hours ago"})]})]}),n.jsxs("div",{className:"flex items-start space-x-3",children:[n.jsx("div",{className:"w-2 h-2 bg-purple-500 rounded-full mt-2"}),n.jsxs("div",{className:"flex-1",children:[n.jsx("p",{className:"text-sm font-medium",children:"Commission earned"}),n.jsx("p",{className:"text-xs text-gray-500",children:"KES 25,000 from property sale"}),n.jsx("p",{className:"text-xs text-gray-400",children:"1 day ago"})]})]})]})})]})]})]})})},Ede=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState(""),[w,o]=z.useState("ALL"),[E,P]=z.useState("ALL"),{toast:M}=Bi(),{user:L}=mi(),F=Xr();z.useEffect(()=>{const H=async()=>{var X;try{d(!0);const Z=await Ni.properties.getAll({search:m,status:w!=="ALL"?w:void 0,propertyType:E!=="ALL"?E:void 0,agentId:L==null?void 0:L.id,limit:50});s(((X=Z.data)==null?void 0:X.data)||[])}catch(Z){console.error("Error fetching properties:",Z),M({title:"Error",description:"Failed to load properties",variant:"destructive"})}finally{d(!1)}};L!=null&&L.id&&H()},[m,w,E,M,L==null?void 0:L.id]);const $=H=>{switch(H){case"ACTIVE":return n.jsxs(ls,{variant:"default",className:"bg-green-100 text-green-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Active"]});case"PENDING":return n.jsxs(ls,{variant:"secondary",className:"bg-yellow-100 text-yellow-800",children:[n.jsx(Ko,{className:"w-3 h-3 mr-1"}),"Pending"]});case"SOLD":return n.jsxs(ls,{variant:"outline",className:"bg-blue-100 text-blue-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Sold"]});case"REJECTED":return n.jsxs(ls,{variant:"destructive",children:[n.jsx(tu,{className:"w-3 h-3 mr-1"}),"Rejected"]});default:return n.jsx(ls,{variant:"secondary",children:H})}},Y={total:e.length,active:e.filter(H=>H.status==="ACTIVE").length,pending:e.filter(H=>H.status==="PENDING").length,sold:e.filter(H=>H.status==="SOLD").length};return n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsx("div",{className:"mb-8",children:n.jsxs("div",{className:"flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Properties"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Manage your property listings and track performance"})]}),n.jsxs(dt,{onClick:()=>F("/add-property"),children:[n.jsx(z5,{className:"h-4 w-4 mr-2"}),"Add Property"]})]})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Properties"}),n.jsx(Ya,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:Y.total})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Active Listings"}),n.jsx(dr,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:Y.active})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Review"}),n.jsx(Ko,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:Y.pending})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Sold Properties"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:Y.sold})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(at,{className:"pt-6",children:n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-4",children:[n.jsxs("div",{className:"relative",children:[n.jsx(Li,{className:"absolute left-3 top-1/2 transform -translate-y-1/2 text-gray-400 h-4 w-4"}),n.jsx(Es,{placeholder:"Search properties...",value:m,onChange:H=>_(H.target.value),className:"pl-10"})]}),n.jsxs(qn,{value:w,onValueChange:o,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Filter by status"})}),n.jsxs($n,{children:[n.jsx(it,{value:"ALL",children:"All Status"}),n.jsx(it,{value:"ACTIVE",children:"Active"}),n.jsx(it,{value:"PENDING",children:"Pending"}),n.jsx(it,{value:"SOLD",children:"Sold"}),n.jsx(it,{value:"REJECTED",children:"Rejected"})]})]}),n.jsxs(qn,{value:E,onValueChange:P,children:[n.jsx(Un,{children:n.jsx(Zn,{placeholder:"Filter by type"})}),n.jsxs($n,{children:[n.jsx(it,{value:"ALL",children:"All Types"}),n.jsx(it,{value:"APARTMENT",children:"Apartment"}),n.jsx(it,{value:"HOUSE",children:"House"}),n.jsx(it,{value:"LAND",children:"Land"}),n.jsx(it,{value:"COMMERCIAL",children:"Commercial"})]})]}),n.jsxs(dt,{variant:"outline",children:[n.jsx(wx,{className:"h-4 w-4 mr-2"}),"More Filters"]})]})})}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:["Properties (",e.length,")"]}),n.jsx(Zs,{children:"Manage property listings and approvals"})]}),n.jsx(at,{children:l?n.jsx("div",{className:"text-center py-8",children:"Loading properties..."}):n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Property"}),n.jsx(Bn,{children:"Location"}),n.jsx(Bn,{children:"Type"}),n.jsx(Bn,{children:"Price"}),n.jsx(Bn,{children:"Views"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{className:"text-right",children:"Actions"})]})}),n.jsx(Lf,{children:e.map(H=>{var X;return n.jsxs(cl,{children:[n.jsx(Vn,{children:n.jsxs("div",{children:[n.jsx("div",{className:"font-medium",children:H.title}),n.jsxs("div",{className:"text-sm text-gray-500",children:["ID: ",H.id.slice(-8)]})]})}),n.jsx(Vn,{children:n.jsxs("div",{className:"flex items-center",children:[n.jsx(Ai,{className:"h-4 w-4 text-gray-400 mr-1"}),n.jsxs("span",{children:[H.city,", ",H.county]})]})}),n.jsx(Vn,{children:n.jsx(ls,{variant:"outline",children:H.propertyType})}),n.jsx(Vn,{children:n.jsxs("div",{className:"font-medium",children:["KES ",(X=H.price)==null?void 0:X.toLocaleString()]})}),n.jsx(Vn,{children:n.jsxs("div",{className:"text-sm",children:[H.views||0," views"]})}),n.jsx(Vn,{children:$(H.status)}),n.jsx(Vn,{className:"text-right",children:n.jsxs(Nx,{children:[n.jsx(Ex,{asChild:!0,children:n.jsx(dt,{variant:"ghost",className:"h-8 w-8 p-0",children:n.jsx(Z2,{className:"h-4 w-4"})})}),n.jsxs(Mf,{align:"end",children:[n.jsxs(ti,{children:[n.jsx(pi,{className:"w-4 h-4 mr-2"}),"View Details"]}),n.jsxs(ti,{children:[n.jsx(B5,{className:"w-4 h-4 mr-2"}),"Edit Property"]}),n.jsxs(ti,{className:"text-red-600",children:[n.jsx(ox,{className:"w-4 h-4 mr-2"}),"Delete"]})]})]})})]},H.id)})})]})})]})]})})},Cde=()=>{var P,M;const[e,s]=z.useState(null),[l,d]=z.useState(!0),[m,_]=z.useState("30d"),{toast:w}=Bi(),{user:o}=mi();z.useEffect(()=>{const L=async()=>{try{d(!0),s({totalEarnings:45e4,monthlyEarnings:85e3,availableBalance:125e3,pendingPayouts:35e3,totalCommissions:12,monthlyCommissions:3,averageCommission:70833,earningsBreakdown:{propertySales:32e4,referrals:85e3,bonuses:45e3},monthlyGrowth:15.2,recentCommissions:[{id:"COMM001",property:"Modern 3BR Apartment in Westlands",amount:125e3,date:"2024-11-01",status:"paid",type:"Sale Commission"},{id:"COMM002",property:"Luxury Villa in Karen",amount:95e3,date:"2024-10-28",status:"paid",type:"Sale Commission"},{id:"COMM003",property:"Commercial Space in CBD",amount:75e3,date:"2024-10-25",status:"pending",type:"Lease Commission"}],payoutHistory:[{id:"PAYOUT001",amount:2e5,date:"2024-10-31",method:"M-Pesa",status:"completed"},{id:"PAYOUT002",amount:15e4,date:"2024-09-30",method:"Bank Transfer",status:"completed"}]})}catch(F){console.error("Error fetching finance data:",F),w({title:"Error",description:"Failed to load financial data",variant:"destructive"})}finally{d(!1)}};o!=null&&o.id&&L()},[m,w,o==null?void 0:o.id]);const E=L=>`KES ${L.toLocaleString()}`;return l?n.jsx(wo,{children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"animate-pulse space-y-6",children:[n.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:Array.from({length:8}).map((L,F)=>n.jsx("div",{className:"h-32 bg-gray-200 rounded"},F))})]})})}):n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"My Earnings"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Track your commissions, payouts, and financial performance"})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{className:"w-32",children:n.jsx(Zn,{})}),n.jsxs($n,{children:[n.jsx(it,{value:"7d",children:"Last 7 days"}),n.jsx(it,{value:"30d",children:"Last 30 days"}),n.jsx(it,{value:"90d",children:"Last 90 days"}),n.jsx(it,{value:"1y",children:"Last year"})]})]}),n.jsxs(dt,{variant:"outline",children:[n.jsx(Jw,{className:"h-4 w-4 mr-2"}),"Export Report"]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Earnings"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:E(e==null?void 0:e.totalEarnings)}),n.jsxs("p",{className:"text-xs text-green-600 flex items-center",children:[n.jsx(Ei,{className:"h-3 w-3 mr-1"}),"+",e==null?void 0:e.monthlyGrowth,"% from last month"]})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Available Balance"}),n.jsx(WD,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:E(e==null?void 0:e.availableBalance)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Ready for payout"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Monthly Earnings"}),n.jsx(vf,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:E(e==null?void 0:e.monthlyEarnings)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"This month's commissions"})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Payouts"}),n.jsx(Ko,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:E(e==null?void 0:e.pendingPayouts)}),n.jsx("p",{className:"text-xs text-muted-foreground",children:"Processing payments"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Earnings by Source"}),n.jsx(Zs,{children:"Breakdown of your commission sources"})]}),n.jsx(at,{className:"space-y-4",children:Object.entries((e==null?void 0:e.earningsBreakdown)||{}).map(([L,F])=>n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:"w-3 h-3 bg-green-500 rounded-full"}),n.jsx("span",{className:"text-sm font-medium capitalize",children:L.replace(/([A-Z])/g," $1").trim()})]}),n.jsx("span",{className:"text-sm font-bold",children:E(F)})]},L))})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Earnings Summary"}),n.jsx(Zs,{children:"Your performance metrics"})]}),n.jsx(at,{children:n.jsxs("div",{className:"space-y-4",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-8 h-8 bg-blue-100 rounded-full flex items-center justify-center",children:n.jsx(tQ,{className:"h-4 w-4 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium",children:"Total Commissions"}),n.jsx("p",{className:"text-xs text-gray-500",children:"All time"})]})]}),n.jsx("span",{className:"text-sm font-bold",children:e==null?void 0:e.totalCommissions})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-8 h-8 bg-green-100 rounded-full flex items-center justify-center",children:n.jsx(Ei,{className:"h-4 w-4 text-green-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium",children:"Monthly Commissions"}),n.jsx("p",{className:"text-xs text-gray-500",children:"This month"})]})]}),n.jsx("span",{className:"text-sm font-bold",children:e==null?void 0:e.monthlyCommissions})]}),n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-3",children:[n.jsx("div",{className:"w-8 h-8 bg-purple-100 rounded-full flex items-center justify-center",children:n.jsx(QJ,{className:"h-4 w-4 text-purple-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"text-sm font-medium",children:"Average Commission"}),n.jsx("p",{className:"text-xs text-gray-500",children:"Per deal"})]})]}),n.jsx("span",{className:"text-sm font-bold",children:E(e==null?void 0:e.averageCommission)})]})]})})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Commissions"}),n.jsx(Zs,{children:"Latest commission earnings"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:(P=e==null?void 0:e.recentCommissions)==null?void 0:P.map(L=>n.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:`w-10 h-10 rounded-full flex items-center justify-center ${L.status==="paid"?"bg-green-100":"bg-yellow-100"}`,children:L.status==="paid"?n.jsx(hi,{className:"h-5 w-5 text-green-600"}):n.jsx(Ko,{className:"h-5 w-5 text-yellow-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium text-sm",children:L.property}),n.jsxs("p",{className:"text-xs text-gray-500",children:[L.type,"  ",L.date]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-bold",children:E(L.amount)}),n.jsx(ls,{variant:L.status==="paid"?"default":"secondary",children:L.status})]})]},L.id))})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Payout History"}),n.jsx(Zs,{children:"Recent payments to your account"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:(M=e==null?void 0:e.payoutHistory)==null?void 0:M.map(L=>n.jsxs("div",{className:"flex items-center justify-between p-4 border rounded-lg",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:"w-10 h-10 bg-blue-100 rounded-full flex items-center justify-center",children:n.jsx(WD,{className:"h-5 w-5 text-blue-600"})}),n.jsxs("div",{children:[n.jsx("p",{className:"font-medium",children:L.method}),n.jsxs("p",{className:"text-sm text-gray-500",children:[L.id,"  ",L.date]})]})]}),n.jsxs("div",{className:"text-right",children:[n.jsx("p",{className:"font-bold",children:E(L.amount)}),n.jsx(ls,{variant:"default",children:L.status})]})]},L.id))})})]})]})]})})},Ade=()=>{var L,F,$,Y,H,X,Z,W,q,oe,ae,Ne,Pe,Le,ct,xt,yt,Ht,Dt,wt,rs,Vt,Bt,ze,Xe,Ot,nt,Mt,ss,Ps,xn,Ms,Xt,It,Ns,ws,tn,cn,wr,cr,vn;const[e,s]=z.useState(null),[l,d]=z.useState(!0),[m,_]=z.useState(!1),{toast:w}=Bi();mi();const o=async()=>{try{_(!0);const Js={overall:{status:"excellent",performance:"Top 10% of agents",lastChecked:new Date().toISOString()},metrics:[{name:"Properties Listed",value:12,target:15,status:"on_track",change:"+2 this month"},{name:"Properties Sold",value:8,target:10,status:"on_track",change:"+1 this month"},{name:"Client Inquiries",value:45,target:50,status:"on_track",change:"+8 this month"},{name:"Response Time",value:"2.3 hours",target:"< 4 hours",status:"excellent",change:"-0.5 hours"}],performance:{listingQuality:92,clientSatisfaction:88,marketReach:76,salesConversion:67},recentAchievements:[{id:"ACH001",title:"Top Seller Badge",description:"Sold 8 properties this month",date:"2024-11-01",type:"badge"},{id:"ACH002",title:"Quick Response Award",description:"Responded to 95% of inquiries within 2 hours",date:"2024-10-28",type:"award"}],goals:[{id:"GOAL001",title:"List 15 properties this month",progress:80,target:15,current:12,deadline:"2024-11-30"},{id:"GOAL002",title:"Achieve 90% client satisfaction",progress:98,target:90,current:88,deadline:"2024-12-31"}]};s(Js)}catch(Js){console.error("Error fetching health data:",Js),w({title:"Error",description:"Failed to load performance data",variant:"destructive"})}finally{d(!1),_(!1)}};z.useEffect(()=>{o()},[w]);const E=Js=>{switch(Js){case"excellent":return"text-green-600 bg-green-50";case"on_track":return"text-blue-600 bg-blue-50";case"warning":return"text-yellow-600 bg-yellow-50";case"critical":return"text-red-600 bg-red-50";default:return"text-gray-600 bg-gray-50"}},P=Js=>{switch(Js){case"excellent":return n.jsx(dr,{className:"h-4 w-4"});case"on_track":return n.jsx(iQ,{className:"h-4 w-4"});case"warning":return n.jsx(ed,{className:"h-4 w-4"});default:return n.jsx(kg,{className:"h-4 w-4"})}},M=Js=>Js>=90?"text-green-600 bg-green-50":Js>=75?"text-blue-600 bg-blue-50":Js>=60?"text-yellow-600 bg-yellow-50":"text-red-600 bg-red-50";return l?n.jsx(wo,{children:n.jsx("div",{className:"p-6",children:n.jsxs("div",{className:"animate-pulse space-y-6",children:[n.jsx("div",{className:"h-8 bg-gray-200 rounded w-1/4"}),n.jsx("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6",children:Array.from({length:8}).map((Js,Rr)=>n.jsx("div",{className:"h-32 bg-gray-200 rounded"},Rr))})]})})}):n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8 flex justify-between items-center",children:[n.jsxs("div",{children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Performance Analytics"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Track your performance metrics and achievements"})]}),n.jsxs(dt,{onClick:o,disabled:m,className:"flex items-center gap-2",children:[n.jsx(Wu,{className:`h-4 w-4 ${m?"animate-spin":""}`}),m?"Refreshing...":"Refresh"]})]}),n.jsx(ot,{className:"mb-8",children:n.jsx(at,{className:"pt-6",children:n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-4",children:[n.jsx("div",{className:`p-3 rounded-full ${E((L=e==null?void 0:e.overall)==null?void 0:L.status)}`,children:P((F=e==null?void 0:e.overall)==null?void 0:F.status)}),n.jsxs("div",{children:[n.jsxs("h3",{className:"text-lg font-semibold",children:["Performance Status: ",($=e==null?void 0:e.overall)==null?void 0:$.status]}),n.jsxs("p",{className:"text-sm text-gray-600",children:[(Y=e==null?void 0:e.overall)==null?void 0:Y.performance," | Last updated:"," ",new Date((H=e==null?void 0:e.overall)==null?void 0:H.lastChecked).toLocaleString()]})]})]}),n.jsx(ls,{className:E((X=e==null?void 0:e.overall)==null?void 0:X.status),children:(Z=e==null?void 0:e.overall)==null?void 0:Z.status})]})})}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Properties Listed"}),n.jsx(Ya,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:((q=(W=e==null?void 0:e.metrics)==null?void 0:W[0])==null?void 0:q.value)||0}),n.jsx("p",{className:"text-xs text-green-600",children:((ae=(oe=e==null?void 0:e.metrics)==null?void 0:oe[0])==null?void 0:ae.change)||""}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:n.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${(((Pe=(Ne=e==null?void 0:e.metrics)==null?void 0:Ne[0])==null?void 0:Pe.value)||0)/(((ct=(Le=e==null?void 0:e.metrics)==null?void 0:Le[0])==null?void 0:ct.target)||1)*100}%`}})})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Properties Sold"}),n.jsx(hi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:((yt=(xt=e==null?void 0:e.metrics)==null?void 0:xt[1])==null?void 0:yt.value)||0}),n.jsx("p",{className:"text-xs text-green-600",children:((Dt=(Ht=e==null?void 0:e.metrics)==null?void 0:Ht[1])==null?void 0:Dt.change)||""}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:n.jsx("div",{className:"bg-green-600 h-2 rounded-full",style:{width:`${(((rs=(wt=e==null?void 0:e.metrics)==null?void 0:wt[1])==null?void 0:rs.value)||0)/(((Bt=(Vt=e==null?void 0:e.metrics)==null?void 0:Vt[1])==null?void 0:Bt.target)||1)*100}%`}})})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Client Inquiries"}),n.jsx(pi,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:((Xe=(ze=e==null?void 0:e.metrics)==null?void 0:ze[2])==null?void 0:Xe.value)||0}),n.jsx("p",{className:"text-xs text-green-600",children:((nt=(Ot=e==null?void 0:e.metrics)==null?void 0:Ot[2])==null?void 0:nt.change)||""}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2 mt-2",children:n.jsx("div",{className:"bg-yellow-600 h-2 rounded-full",style:{width:`${(((ss=(Mt=e==null?void 0:e.metrics)==null?void 0:Mt[2])==null?void 0:ss.value)||0)/(((xn=(Ps=e==null?void 0:e.metrics)==null?void 0:Ps[2])==null?void 0:xn.target)||1)*100}%`}})})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Response Time"}),n.jsx(kg,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsxs(at,{children:[n.jsx("div",{className:"text-2xl font-bold",children:((Xt=(Ms=e==null?void 0:e.metrics)==null?void 0:Ms[3])==null?void 0:Xt.value)||"N/A"}),n.jsx("p",{className:"text-xs text-green-600",children:((Ns=(It=e==null?void 0:e.metrics)==null?void 0:It[3])==null?void 0:Ns.change)||""}),n.jsx(ls,{className:E((tn=(ws=e==null?void 0:e.metrics)==null?void 0:ws[3])==null?void 0:tn.status),children:((wr=(cn=e==null?void 0:e.metrics)==null?void 0:cn[3])==null?void 0:wr.status)||"unknown"})]})]})]}),n.jsxs("div",{className:"grid grid-cols-1 lg:grid-cols-2 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Performance Scores"}),n.jsx(Zs,{children:"Your key performance indicators"})]}),n.jsx(at,{className:"space-y-4",children:Object.entries((e==null?void 0:e.performance)||{}).map(([Js,Rr])=>n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("div",{className:`p-2 rounded-full ${M(Rr)}`,children:Rr>=90?n.jsx(Rh,{className:"h-4 w-4"}):Rr>=75?n.jsx(Ei,{className:"h-4 w-4"}):n.jsx(kg,{className:"h-4 w-4"})}),n.jsx("span",{className:"text-sm font-medium capitalize",children:Js.replace(/([A-Z])/g," $1").trim()})]}),n.jsxs("span",{className:"text-sm font-bold",children:[Rr,"%"]})]},Js))})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Monthly Goals"}),n.jsx(Zs,{children:"Track your progress towards targets"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:(cr=e==null?void 0:e.goals)==null?void 0:cr.map(Js=>n.jsxs("div",{className:"space-y-2",children:[n.jsxs("div",{className:"flex items-center justify-between",children:[n.jsx("span",{className:"text-sm font-medium",children:Js.title}),n.jsxs("span",{className:"text-sm text-gray-500",children:[Js.current,"/",Js.target]})]}),n.jsx("div",{className:"w-full bg-gray-200 rounded-full h-2",children:n.jsx("div",{className:"bg-blue-600 h-2 rounded-full",style:{width:`${Js.progress}%`}})}),n.jsxs("p",{className:"text-xs text-gray-500",children:["Due: ",new Date(Js.deadline).toLocaleDateString()]})]},Js.id))})})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:"Recent Achievements"}),n.jsx(Zs,{children:"Your latest milestones and awards"})]}),n.jsx(at,{children:n.jsx("div",{className:"space-y-4",children:(vn=e==null?void 0:e.recentAchievements)==null?void 0:vn.map(Js=>n.jsx("div",{className:"flex items-start justify-between p-4 border rounded-lg",children:n.jsxs("div",{className:"flex items-start space-x-4",children:[n.jsx("div",{className:"p-2 rounded-full bg-yellow-100 mt-1",children:n.jsx(Rh,{className:"h-4 w-4 text-yellow-600"})}),n.jsxs("div",{className:"flex-1",children:[n.jsxs("div",{className:"flex items-center space-x-2",children:[n.jsx("h4",{className:"font-medium",children:Js.title}),n.jsx(ls,{variant:"outline",className:"text-yellow-600",children:Js.type})]}),n.jsx("p",{className:"text-sm text-gray-600 mt-1",children:Js.description}),n.jsx("p",{className:"text-xs text-gray-500 mt-1",children:new Date(Js.date).toLocaleDateString()})]})]})},Js.id))})})]})]})})},Pde=()=>{const[e,s]=z.useState([]),[l,d]=z.useState(!0),[m,_]=z.useState("ALL");z.useEffect(()=>{(async()=>{try{d(!0);const F=await Ni.agents.getApplications({status:m,limit:100});F.status==="success"?s(F.data):(console.error("Failed to fetch applications:",F.message),s([]))}catch(F){console.error("Error fetching applications:",F),s([])}finally{d(!1)}})()},[m]);const w=e.filter(L=>m==="ALL"||L.status===m),o=L=>{switch(L){case"APPROVED":return n.jsxs(ls,{variant:"default",className:"bg-green-100 text-green-800",children:[n.jsx(dr,{className:"w-3 h-3 mr-1"}),"Approved"]});case"REJECTED":return n.jsxs(ls,{variant:"destructive",children:[n.jsx(tu,{className:"w-3 h-3 mr-1"}),"Rejected"]});case"PENDING":default:return n.jsxs(ls,{variant:"secondary",children:[n.jsx(Ko,{className:"w-3 h-3 mr-1"}),"Pending"]})}},E=async L=>{try{(await fetch(`/api/v1/agents/${L}/verify`,{method:"POST",headers:{"Content-Type":"application/json",Authorization:`Bearer ${localStorage.getItem("accessToken")}`}})).ok?s($=>$.map(Y=>Y.id===L?{...Y,status:"APPROVED",approvedAt:new Date().toISOString().split("T")[0]}:Y)):console.error("Failed to approve agent")}catch(F){console.error("Error approving agent:",F)}},P=async L=>{s(F=>F.map($=>$.id===L?{...$,status:"REJECTED",rejectedAt:new Date().toISOString().split("T")[0]}:$))},M={total:e.length,pending:e.filter(L=>L.status==="PENDING").length,approved:e.filter(L=>L.status==="APPROVED").length,rejected:e.filter(L=>L.status==="REJECTED").length};return n.jsx(wo,{children:n.jsxs("div",{className:"p-6",children:[n.jsxs("div",{className:"mb-8",children:[n.jsx("h1",{className:"text-3xl font-bold text-gray-900",children:"Agent Applications"}),n.jsx("p",{className:"text-gray-600 mt-2",children:"Review and manage agent applications"})]}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-4 gap-6 mb-8",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Total Applications"}),n.jsx(_o,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:M.total})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Pending Review"}),n.jsx(Ko,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:M.pending})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Approved"}),n.jsx(HA,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:M.approved})})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[n.jsx($t,{className:"text-sm font-medium",children:"Rejected"}),n.jsx(k0,{className:"h-4 w-4 text-muted-foreground"})]}),n.jsx(at,{children:n.jsx("div",{className:"text-2xl font-bold",children:M.rejected})})]})]}),n.jsx(ot,{className:"mb-6",children:n.jsx(at,{className:"pt-6",children:n.jsx("div",{className:"flex flex-col md:flex-row gap-4",children:n.jsxs(qn,{value:m,onValueChange:_,children:[n.jsx(Un,{className:"w-full md:w-48",children:n.jsx(Zn,{placeholder:"Filter by status"})}),n.jsxs($n,{children:[n.jsx(it,{value:"ALL",children:"All Applications"}),n.jsx(it,{value:"PENDING",children:"Pending"}),n.jsx(it,{value:"APPROVED",children:"Approved"}),n.jsx(it,{value:"REJECTED",children:"Rejected"})]})]})})})}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsxs($t,{children:["Applications (",w.length,")"]}),n.jsx(Zs,{children:"Review agent applications and make decisions"})]}),n.jsx(at,{children:l?n.jsx("div",{className:"text-center py-8",children:"Loading applications..."}):n.jsxs(kf,{children:[n.jsx(Df,{children:n.jsxs(cl,{children:[n.jsx(Bn,{children:"Applicant"}),n.jsx(Bn,{children:"Company"}),n.jsx(Bn,{children:"Experience"}),n.jsx(Bn,{children:"Specializations"}),n.jsx(Bn,{children:"Status"}),n.jsx(Bn,{children:"Submitted"}),n.jsx(Bn,{className:"text-right",children:"Actions"})]})}),n.jsx(Lf,{children:w.map(L=>n.jsxs(cl,{children:[n.jsx(Vn,{children:n.jsxs("div",{children:[n.jsxs("div",{className:"font-medium",children:[L.firstName," ",L.lastName]}),n.jsx("div",{className:"text-sm text-gray-500",children:L.email})]})}),n.jsx(Vn,{children:L.company}),n.jsxs(Vn,{children:[L.experience," years"]}),n.jsx(Vn,{children:n.jsxs("div",{className:"flex flex-wrap gap-1",children:[L.specializations.slice(0,2).map((F,$)=>n.jsx(ls,{variant:"outline",className:"text-xs",children:F},$)),L.specializations.length>2&&n.jsxs(ls,{variant:"outline",className:"text-xs",children:["+",L.specializations.length-2]})]})}),n.jsx(Vn,{children:o(L.status)}),n.jsx(Vn,{children:L.submittedAt}),n.jsx(Vn,{className:"text-right",children:n.jsxs(Nx,{children:[n.jsx(Ex,{asChild:!0,children:n.jsx(dt,{variant:"ghost",className:"h-8 w-8 p-0",children:n.jsx(Z2,{className:"h-4 w-4"})})}),n.jsxs(Mf,{align:"end",children:[n.jsxs(ti,{children:[n.jsx(pi,{className:"w-4 h-4 mr-2"}),"View Details"]}),L.status==="PENDING"&&n.jsxs(n.Fragment,{children:[n.jsxs(ti,{onClick:()=>E(L.id),className:"text-green-600",children:[n.jsx(dr,{className:"w-4 h-4 mr-2"}),"Approve"]}),n.jsxs(ti,{onClick:()=>P(L.id),className:"text-red-600",children:[n.jsx(tu,{className:"w-4 h-4 mr-2"}),"Reject"]})]})]})]})})]},L.id))})]})})]})]})})},Ide=()=>{const{user:e,isAuthenticated:s,signIn:l,signUp:d,logout:m}=mi(),[_,w]=z.useState({}),[o,E]=z.useState(!1),[P,M]=z.useState("test@example.com"),L=async()=>{E(!0);try{const W=await(await fetch("http://localhost:5000/health")).json();w(q=>({...q,connection:{success:!0,data:W}}))}catch(Z){w(W=>({...W,connection:{success:!1,error:Z.message}}))}finally{E(!1)}},F=async()=>{E(!0);try{const W=await(await fetch("http://localhost:5000/api/v1/auth/email-test")).json();w(q=>({...q,emailService:{success:!0,data:W}}))}catch(Z){w(W=>({...W,emailService:{success:!1,error:Z.message}}))}finally{E(!1)}},$=async()=>{E(!0);try{const W=await(await fetch("http://localhost:5000/api/v1/auth/send-test-email",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:P})})).json();w(q=>({...q,testEmail:{success:!0,data:W}}))}catch(Z){w(W=>({...W,testEmail:{success:!1,error:Z.message}}))}finally{E(!1)}},Y=Z=>{setFormData(W=>({...W,[Z.target.name]:Z.target.value}))},H=async()=>{E(!0);try{const Z=await d({firstName:formData.firstName,lastName:formData.lastName,email:formData.email,phone:formData.phone,password:formData.password,role:"USER"});Z.success?w(W=>({...W,auth:{success:!0,message:"User registered successfully"}})):w(W=>({...W,auth:{success:!1,error:Z.error}}))}catch(Z){w(W=>{var q;return{...W,auth:{success:!1,error:Z.message,details:((q=Z.response)==null?void 0:q.data)||"No response data"}}})}finally{E(!1)}},X=async()=>{E(!0);try{const Z=await l({email:formData.email,password:formData.password});Z.success?w(W=>({...W,login:{success:!0,message:"User logged in successfully"}})):w(W=>({...W,login:{success:!1,error:Z.error}}))}catch(Z){w(W=>{var q;return{...W,login:{success:!1,error:Z.message,details:((q=Z.response)==null?void 0:q.data)||"No response data"}}})}finally{E(!1)}};return n.jsxs("div",{className:"container mx-auto p-6 space-y-6",children:[n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:" API Integration Test"}),n.jsx(Zs,{children:"Test the connection between frontend and backend APIs"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsx("h3",{className:"text-lg font-semibold",children:"API Testing"}),n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsx(dt,{onClick:L,disabled:o,variant:"outline",children:"Test API Connection"}),n.jsx(dt,{onClick:F,disabled:o,variant:"outline",children:"Test Email Service"})]}),n.jsx("div",{className:"space-y-4",children:n.jsxs("div",{className:"flex gap-2",children:[n.jsx(Es,{type:"email",placeholder:"Enter email for test",value:P,onChange:Z=>M(Z.target.value),className:"flex-1"}),n.jsx(dt,{onClick:$,disabled:o,variant:"outline",children:"Send Test Email"})]})}),n.jsx("div",{className:"space-y-4",children:Object.entries(_).map(([Z,W])=>n.jsxs("div",{className:"p-4 border rounded-lg",children:[n.jsx("h4",{className:"font-medium mb-2 capitalize",children:Z.replace(/([A-Z])/g," $1")}),W.success?n.jsxs("div",{className:"text-green-600",children:[n.jsx("p",{children:" Success"}),n.jsx("pre",{className:"text-xs mt-2 bg-gray-100 p-2 rounded overflow-auto",children:JSON.stringify(W.data,null,2)})]}):n.jsx("div",{className:"text-red-600",children:n.jsxs("p",{children:[" Error: ",W.error]})})]},Z))})]})]}),n.jsxs(ot,{children:[n.jsxs(Ut,{children:[n.jsx($t,{children:" Authentication Test"}),n.jsx(Zs,{children:"Test user registration and login functionality"})]}),n.jsxs(at,{className:"space-y-4",children:[n.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-4",children:[n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"firstName",children:"First Name"}),n.jsx(Es,{id:"firstName",name:"firstName",value:formData.firstName,onChange:Y,placeholder:"First Name"})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"lastName",children:"Last Name"}),n.jsx(Es,{id:"lastName",name:"lastName",value:formData.lastName,onChange:Y,placeholder:"Last Name"})]})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"email",children:"Email"}),n.jsx(Es,{id:"email",name:"email",type:"email",value:formData.email,onChange:Y,placeholder:"Email"})]}),n.jsxs("div",{children:[n.jsx(ds,{htmlFor:"password",children:"Password"}),n.jsx(Es,{id:"password",name:"password",type:"password",value:formData.password,onChange:Y,placeholder:"Password"})]}),n.jsxs("div",{className:"flex gap-4",children:[n.jsx(dt,{onClick:H,disabled:o,children:"Test Registration"}),n.jsx(dt,{onClick:X,disabled:o,variant:"outline",children:"Test Login"}),s&&n.jsx(dt,{onClick:m,variant:"destructive",children:"Logout"})]}),e&&n.jsxs("div",{className:"p-3 bg-green-50 border border-green-200 rounded-lg",children:[n.jsx("h4",{className:"font-medium text-green-800",children:"Current User:"}),n.jsxs("p",{className:"text-sm text-green-700",children:[e.firstName," ",e.lastName," (",e.email,")"]}),n.jsxs("p",{className:"text-xs text-green-600",children:["Role: ",e.role]})]})]})]})]})},Mde=new gK({defaultOptions:{queries:{retry:1,refetchOnWindowFocus:!1}}});function Rde(){const[e,s]=vs.useState(!1);return vs.useEffect(()=>{const l=()=>{s(!0)};return window.addEventListener("openBecomeAgentModal",l),()=>{window.removeEventListener("openBecomeAgentModal",l)}},[]),n.jsx(yK,{client:Mde,children:n.jsx(Nte,{children:n.jsx(oJ,{children:n.jsxs(ZQ,{children:[n.jsxs(GZ,{future:{v7_startTransition:!0,v7_relativeSplatPath:!0},children:[n.jsxs(LZ,{children:[n.jsx(Dn,{path:"/",element:n.jsx(iue,{})}),n.jsx(Dn,{path:"/buy",element:n.jsx(lue,{})}),n.jsx(Dn,{path:"/rent",element:n.jsx(cue,{})}),n.jsx(Dn,{path:"/property/:id",element:n.jsx(due,{})}),n.jsx(Dn,{path:"/agents",element:n.jsx(Nde,{})}),n.jsx(Dn,{path:"/auth/signin",element:n.jsx(mue,{})}),n.jsx(Dn,{path:"/auth/register",element:n.jsx(gue,{})}),n.jsx(Dn,{path:"/auth/verify-email",element:n.jsx(yue,{})}),n.jsx(Dn,{path:"/auth/forgot-password",element:n.jsx(xue,{})}),n.jsx(Dn,{path:"/auth/email-verified",element:n.jsx(_ue,{})}),n.jsx(Dn,{path:"/auth/reset-password",element:n.jsx(vue,{})}),n.jsx(Dn,{path:"/auth/user-not-found",element:n.jsx(bue,{})}),n.jsx(Dn,{path:"/profile",element:n.jsx(ri,{children:n.jsx(wue,{})})}),n.jsx(Dn,{path:"/account",element:n.jsx(ri,{children:n.jsx(Wue,{})})}),n.jsx(Dn,{path:"/dashboard",element:n.jsx(ri,{children:n.jsx(que,{})})}),n.jsx(Dn,{path:"/favorites",element:n.jsx(ri,{children:n.jsx(Zue,{})})}),n.jsx(Dn,{path:"/messages",element:n.jsx(ri,{children:n.jsx(Kue,{})})}),n.jsx(Dn,{path:"/notifications",element:n.jsx(ri,{children:n.jsx(Xue,{})})}),n.jsx(Dn,{path:"/content-creator-dashboard",element:n.jsx(ri,{children:n.jsx(rde,{})})}),n.jsx(Dn,{path:"/content-creator-enrollment",element:n.jsx(ri,{children:n.jsx(ide,{})})}),n.jsx(Dn,{path:"/map-demo",element:n.jsx(ode,{})}),n.jsx(Dn,{path:"/system-admin",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(dde,{})})}),n.jsx(Dn,{path:"/system-admin/users",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(mde,{})})}),n.jsx(Dn,{path:"/system-admin/agents",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(gde,{})})}),n.jsx(Dn,{path:"/system-admin/properties",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(xde,{})})}),n.jsx(Dn,{path:"/system-admin/finance",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(yde,{})})}),n.jsx(Dn,{path:"/system-admin/health",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(_de,{})})}),n.jsx(Dn,{path:"/system-admin/messages",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(vde,{})})}),n.jsx(Dn,{path:"/system-admin/settings",element:n.jsx(ri,{requiredRole:"ADMIN",children:n.jsx(wde,{})})}),n.jsx(Dn,{path:"/become-agent",element:n.jsx(jde,{})}),n.jsx(Dn,{path:"/add-property",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(Tde,{})})}),n.jsx(Dn,{path:"/agent",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(CN,{})})}),n.jsx(Dn,{path:"/agent/*",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(CN,{})})}),n.jsx(Dn,{path:"/agent/dashboard",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(CN,{})})}),n.jsx(Dn,{path:"/agent/properties",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(Ede,{})})}),n.jsx(Dn,{path:"/agent/finance",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(Cde,{})})}),n.jsx(Dn,{path:"/agent/health",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(Ade,{})})}),n.jsx(Dn,{path:"/agent/applications",element:n.jsx(ri,{requiredRole:"AGENT",children:n.jsx(Pde,{})})}),n.jsx(Dn,{path:"/unauthorized",element:n.jsx(cde,{})}),n.jsx(Dn,{path:"/api-test",element:n.jsx(Ide,{})}),n.jsx(Dn,{path:"/terms",element:n.jsx(ade,{})}),n.jsx(Dn,{path:"/privacy",element:n.jsx(lde,{})}),n.jsx(Dn,{path:"*",element:n.jsx(hue,{})})]}),n.jsx(Ane,{isOpen:e,onClose:()=>s(!1)})]}),n.jsx(fQ,{}),n.jsx(WQ,{})]})})})})}lF(document.getElementById("root")).render(n.jsx(Rde,{}));
